{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","awayjs-core/lib/base/bitmapdatachannel.ts","awayjs-core/lib/base/bitmapdata.ts","awayjs-core/lib/base/blendmode.ts","awayjs-core/lib/errors/abstractmethoderror.ts","awayjs-core/lib/errors/argumenterror.ts","awayjs-core/lib/errors/documenterror.ts","awayjs-core/lib/errors/error.ts","awayjs-core/lib/errors/partialimplementationerror.ts","awayjs-core/lib/errors/rangeerror.ts","awayjs-core/lib/events/assetevent.ts","awayjs-core/lib/events/eventdispatcher.ts","awayjs-core/lib/events/event.ts","awayjs-core/lib/events/httpstatusevent.ts","awayjs-core/lib/events/ioerrorevent.ts","awayjs-core/lib/events/loaderevent.ts","awayjs-core/lib/events/parserevent.ts","awayjs-core/lib/events/progressevent.ts","awayjs-core/lib/events/projectionevent.ts","awayjs-core/lib/events/timerevent.ts","awayjs-core/lib/geom/box.ts","awayjs-core/lib/geom/colortransform.ts","awayjs-core/lib/geom/mathconsts.ts","awayjs-core/lib/geom/matrix3dutils.ts","awayjs-core/lib/geom/matrix3d.ts","awayjs-core/lib/geom/matrix.ts","awayjs-core/lib/geom/orientation3d.ts","awayjs-core/lib/geom/perspectiveprojection.ts","awayjs-core/lib/geom/plane3d.ts","awayjs-core/lib/geom/planeclassification.ts","awayjs-core/lib/geom/point.ts","awayjs-core/lib/geom/poissonlookup.ts","awayjs-core/lib/geom/quaternion.ts","awayjs-core/lib/geom/rectangle.ts","awayjs-core/lib/geom/sphere.ts","awayjs-core/lib/geom/uvtransform.ts","awayjs-core/lib/geom/vector3d.ts","awayjs-core/lib/library/assetlibrarybundle.ts","awayjs-core/lib/library/assetlibraryiterator.ts","awayjs-core/lib/library/assetlibrary.ts","awayjs-core/lib/library/assetloadercontext.ts","awayjs-core/lib/library/assetloadertoken.ts","awayjs-core/lib/library/assetloader.ts","awayjs-core/lib/library/assettype.ts","awayjs-core/lib/library/conflictprecedence.ts","awayjs-core/lib/library/conflictstrategybase.ts","awayjs-core/lib/library/conflictstrategy.ts","awayjs-core/lib/library/errorconflictstrategy.ts","awayjs-core/lib/library/idutil.ts","awayjs-core/lib/library/ignoreconflictstrategy.ts","awayjs-core/lib/library/namedassetbase.ts","awayjs-core/lib/library/numsuffixconflictstrategy.ts","awayjs-core/lib/net/crossdomainpolicy.ts","awayjs-core/lib/net/urlloaderdataformat.ts","awayjs-core/lib/net/urlloader.ts","awayjs-core/lib/net/urlrequestmethod.ts","awayjs-core/lib/net/urlrequest.ts","awayjs-core/lib/net/urlvariables.ts","awayjs-core/lib/parsers/cubetextureparser.ts","awayjs-core/lib/parsers/parserbase.ts","awayjs-core/lib/parsers/parserdataformat.ts","awayjs-core/lib/parsers/parserutils.ts","awayjs-core/lib/parsers/resourcedependency.ts","awayjs-core/lib/parsers/texture2dparser.ts","awayjs-core/lib/projections/coordinatesystem.ts","awayjs-core/lib/projections/freematrixprojection.ts","awayjs-core/lib/projections/obliquenearplaneprojection.ts","awayjs-core/lib/projections/orthographicoffcenterprojection.ts","awayjs-core/lib/projections/orthographicprojection.ts","awayjs-core/lib/projections/perspectiveprojection.ts","awayjs-core/lib/projections/projectionbase.ts","awayjs-core/lib/textures/bitmapcubetexture.ts","awayjs-core/lib/textures/bitmaptexture.ts","awayjs-core/lib/textures/cubetexturebase.ts","awayjs-core/lib/textures/imagecubetexture.ts","awayjs-core/lib/textures/imagetexture.ts","awayjs-core/lib/textures/mipmapgenerator.ts","awayjs-core/lib/textures/rendertexture.ts","awayjs-core/lib/textures/specularbitmaptexture.ts","awayjs-core/lib/textures/texture2dbase.ts","awayjs-core/lib/textures/textureproxybase.ts","awayjs-core/lib/ui/keyboard.ts","awayjs-core/lib/utils/bytearraybase.ts","awayjs-core/lib/utils/bytearraybuffer.ts","awayjs-core/lib/utils/bytearray.ts","awayjs-core/lib/utils/css.ts","awayjs-core/lib/utils/colorutils.ts","awayjs-core/lib/utils/debug.ts","awayjs-core/lib/utils/requestanimationframe.ts","awayjs-core/lib/utils/textureutils.ts","awayjs-core/lib/utils/timer.ts","awayjs-core/lib/utils/gettimer.ts","awayjs-display/lib/animators/nodes/animationnodebase.ts","awayjs-display/lib/base/alignmentmode.ts","awayjs-display/lib/base/capsstyle.ts","awayjs-display/lib/base/displayobject.ts","awayjs-display/lib/base/geometry.ts","awayjs-display/lib/base/gradienttype.ts","awayjs-display/lib/base/graphicspathwinding.ts","awayjs-display/lib/base/graphics.ts","awayjs-display/lib/base/interpolationmethod.ts","awayjs-display/lib/base/jointstyle.ts","awayjs-display/lib/base/lightbase.ts","awayjs-display/lib/base/linescalemode.ts","awayjs-display/lib/base/linesubgeometry.ts","awayjs-display/lib/base/linesubmesh.ts","awayjs-display/lib/base/loaderinfo.ts","awayjs-display/lib/base/orientationmode.ts","awayjs-display/lib/base/pixelsnapping.ts","awayjs-display/lib/base/spreadmethod.ts","awayjs-display/lib/base/subgeometrybase.ts","awayjs-display/lib/base/submeshbase.ts","awayjs-display/lib/base/transform.ts","awayjs-display/lib/base/triangleculling.ts","awayjs-display/lib/base/trianglesubgeometry.ts","awayjs-display/lib/base/trianglesubmesh.ts","awayjs-display/lib/bounds/axisalignedboundingbox.ts","awayjs-display/lib/bounds/boundingsphere.ts","awayjs-display/lib/bounds/boundingvolumebase.ts","awayjs-display/lib/bounds/boundstype.ts","awayjs-display/lib/bounds/nullbounds.ts","awayjs-display/lib/containers/displayobjectcontainer.ts","awayjs-display/lib/containers/loader.ts","awayjs-display/lib/containers/scene.ts","awayjs-display/lib/containers/view.ts","awayjs-display/lib/controllers/controllerbase.ts","awayjs-display/lib/controllers/firstpersoncontroller.ts","awayjs-display/lib/controllers/followcontroller.ts","awayjs-display/lib/controllers/hovercontroller.ts","awayjs-display/lib/controllers/lookatcontroller.ts","awayjs-display/lib/controllers/springcontroller.ts","awayjs-display/lib/display/contextmode.ts","awayjs-display/lib/entities/billboard.ts","awayjs-display/lib/entities/camera.ts","awayjs-display/lib/entities/directionallight.ts","awayjs-display/lib/entities/lightprobe.ts","awayjs-display/lib/entities/linesegment.ts","awayjs-display/lib/entities/mesh.ts","awayjs-display/lib/entities/pointlight.ts","awayjs-display/lib/entities/shape.ts","awayjs-display/lib/entities/skybox.ts","awayjs-display/lib/entities/textfield.ts","awayjs-display/lib/errors/casterror.ts","awayjs-display/lib/events/cameraevent.ts","awayjs-display/lib/events/displayobjectevent.ts","awayjs-display/lib/events/geometryevent.ts","awayjs-display/lib/events/lightevent.ts","awayjs-display/lib/events/materialevent.ts","awayjs-display/lib/events/mouseevent.ts","awayjs-display/lib/events/renderableownerevent.ts","awayjs-display/lib/events/rendererevent.ts","awayjs-display/lib/events/resizeevent.ts","awayjs-display/lib/events/sceneevent.ts","awayjs-display/lib/events/stageevent.ts","awayjs-display/lib/events/subgeometryevent.ts","awayjs-display/lib/managers/defaultmaterialmanager.ts","awayjs-display/lib/managers/mousemanager.ts","awayjs-display/lib/materials/basicmaterial.ts","awayjs-display/lib/materials/cssmaterialbase.ts","awayjs-display/lib/materials/lightsources.ts","awayjs-display/lib/materials/materialbase.ts","awayjs-display/lib/materials/lightpickers/lightpickerbase.ts","awayjs-display/lib/materials/lightpickers/staticlightpicker.ts","awayjs-display/lib/materials/shadowmappers/cascadeshadowmapper.ts","awayjs-display/lib/materials/shadowmappers/cubemapshadowmapper.ts","awayjs-display/lib/materials/shadowmappers/directionalshadowmapper.ts","awayjs-display/lib/materials/shadowmappers/neardirectionalshadowmapper.ts","awayjs-display/lib/materials/shadowmappers/shadowmapperbase.ts","awayjs-display/lib/partition/cameranode.ts","awayjs-display/lib/partition/directionallightnode.ts","awayjs-display/lib/partition/entitynode.ts","awayjs-display/lib/partition/lightprobenode.ts","awayjs-display/lib/partition/nodebase.ts","awayjs-display/lib/partition/nullnode.ts","awayjs-display/lib/partition/partition.ts","awayjs-display/lib/partition/pointlightnode.ts","awayjs-display/lib/partition/skyboxnode.ts","awayjs-display/lib/pick/pickingcollisionvo.ts","awayjs-display/lib/pick/raycastpicker.ts","awayjs-display/lib/pool/cssbillboardrenderable.ts","awayjs-display/lib/pool/csslinesegmentrenderable.ts","awayjs-display/lib/pool/cssrenderablebase.ts","awayjs-display/lib/pool/cssskyboxrenderable.ts","awayjs-display/lib/pool/entitylistitempool.ts","awayjs-display/lib/pool/entitylistitem.ts","awayjs-display/lib/pool/entitynodepool.ts","awayjs-display/lib/prefabs/prefabbase.ts","awayjs-display/lib/prefabs/primitivecapsuleprefab.ts","awayjs-display/lib/prefabs/primitiveconeprefab.ts","awayjs-display/lib/prefabs/primitivecubeprefab.ts","awayjs-display/lib/prefabs/primitivecylinderprefab.ts","awayjs-display/lib/prefabs/primitiveplaneprefab.ts","awayjs-display/lib/prefabs/primitivepolygonprefab.ts","awayjs-display/lib/prefabs/primitiveprefabbase.ts","awayjs-display/lib/prefabs/primitivesphereprefab.ts","awayjs-display/lib/prefabs/primitivetorusprefab.ts","awayjs-display/lib/render/cssdefaultrenderer.ts","awayjs-display/lib/render/cssrendererbase.ts","awayjs-display/lib/sort/renderablemergesort.ts","awayjs-display/lib/text/antialiastype.ts","awayjs-display/lib/text/gridfittype.ts","awayjs-display/lib/text/textfieldautosize.ts","awayjs-display/lib/text/textfieldtype.ts","awayjs-display/lib/text/textformatalign.ts","awayjs-display/lib/text/textformat.ts","awayjs-display/lib/text/textinteractionmode.ts","awayjs-display/lib/text/textlinemetrics.ts","awayjs-display/lib/traverse/cssentitycollector.ts","awayjs-display/lib/traverse/collectorbase.ts","awayjs-display/lib/traverse/entitycollector.ts","awayjs-display/lib/traverse/raycastcollector.ts","awayjs-display/lib/traverse/shadowcastercollector.ts","awayjs-display/lib/utils/cast.ts","awayjs-methodmaterials/lib/MethodMaterialMode.ts","awayjs-methodmaterials/lib/MethodMaterial.ts","awayjs-methodmaterials/lib/compilation/RenderMethodMaterialObject.ts","awayjs-methodmaterials/lib/data/MethodVO.ts","awayjs-methodmaterials/lib/methods/AmbientBasicMethod.ts","awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod.ts","awayjs-methodmaterials/lib/methods/DiffuseBasicMethod.ts","awayjs-methodmaterials/lib/methods/DiffuseCelMethod.ts","awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod.ts","awayjs-methodmaterials/lib/methods/DiffuseDepthMethod.ts","awayjs-methodmaterials/lib/methods/DiffuseGradientMethod.ts","awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod.ts","awayjs-methodmaterials/lib/methods/DiffuseSubSurfaceMethod.ts","awayjs-methodmaterials/lib/methods/DiffuseWrapMethod.ts","awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod.ts","awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod.ts","awayjs-methodmaterials/lib/methods/EffectColorTransformMethod.ts","awayjs-methodmaterials/lib/methods/EffectEnvMapMethod.ts","awayjs-methodmaterials/lib/methods/EffectFogMethod.ts","awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod.ts","awayjs-methodmaterials/lib/methods/EffectLightMapMethod.ts","awayjs-methodmaterials/lib/methods/EffectMethodBase.ts","awayjs-methodmaterials/lib/methods/EffectRefractionEnvMapMethod.ts","awayjs-methodmaterials/lib/methods/EffectRimLightMethod.ts","awayjs-methodmaterials/lib/methods/LightingMethodBase.ts","awayjs-methodmaterials/lib/methods/NormalBasicMethod.ts","awayjs-methodmaterials/lib/methods/NormalHeightMapMethod.ts","awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod.ts","awayjs-methodmaterials/lib/methods/ShadingMethodBase.ts","awayjs-methodmaterials/lib/methods/ShadowCascadeMethod.ts","awayjs-methodmaterials/lib/methods/ShadowDitheredMethod.ts","awayjs-methodmaterials/lib/methods/ShadowFilteredMethod.ts","awayjs-methodmaterials/lib/methods/ShadowHardMethod.ts","awayjs-methodmaterials/lib/methods/ShadowMapMethodBase.ts","awayjs-methodmaterials/lib/methods/ShadowMethodBase.ts","awayjs-methodmaterials/lib/methods/ShadowNearMethod.ts","awayjs-methodmaterials/lib/methods/ShadowSoftMethod.ts","awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod.ts","awayjs-methodmaterials/lib/methods/SpecularBasicMethod.ts","awayjs-methodmaterials/lib/methods/SpecularCelMethod.ts","awayjs-methodmaterials/lib/methods/SpecularCompositeMethod.ts","awayjs-methodmaterials/lib/methods/SpecularFresnelMethod.ts","awayjs-methodmaterials/lib/methods/SpecularPhongMethod.ts","awayjs-methodmaterials/lib/passes/MethodPassMode.ts","awayjs-methodmaterials/lib/passes/MethodPass.ts","awayjs-methodmaterials/lib/passes/SingleObjectDepthPass.ts","awayjs-methodmaterials/lib/pool/MethodRenderablePool.ts","awayjs-methodmaterials/lib/pool/MethodRendererPool.ts","awayjs-parsers/lib/AWDParser.ts","awayjs-parsers/lib/MD2Parser.ts","awayjs-parsers/lib/MD5AnimParser.ts","awayjs-parsers/lib/MD5MeshParser.ts","awayjs-parsers/lib/Max3DSParser.ts","awayjs-parsers/lib/OBJParser.ts","awayjs-parsers/lib/Parsers.ts","node_modules/awayjs-player/lib/fl/adapters/AS2MovieClipAdapter.js","node_modules/awayjs-player/lib/fl/adapters/AS2SymbolAdapter.js","node_modules/awayjs-player/lib/fl/adapters/SymbolAdapter.js","node_modules/awayjs-player/lib/fl/display/MovieClip.js","node_modules/awayjs-player/lib/fl/factories/AS2SceneGraphFactory.js","node_modules/awayjs-player/lib/fl/timeline/InterpolationObject.js","node_modules/awayjs-player/lib/fl/timeline/TimelineKeyFrame.js","node_modules/awayjs-player/lib/fl/timeline/commands/AddChildCommand.js","node_modules/awayjs-player/lib/fl/timeline/commands/RemoveChildCommand.js","node_modules/awayjs-player/lib/fl/timeline/commands/UpdatePropertyCommand.js","awayjs-renderergl/lib/defaultrenderer.ts","awayjs-renderergl/lib/depthrenderer.ts","awayjs-renderergl/lib/distancerenderer.ts","awayjs-renderergl/lib/filter3drenderer.ts","awayjs-renderergl/lib/animators/animationsetbase.ts","awayjs-renderergl/lib/animators/animatorbase.ts","awayjs-renderergl/lib/animators/particleanimationset.ts","awayjs-renderergl/lib/animators/particleanimator.ts","awayjs-renderergl/lib/animators/skeletonanimationset.ts","awayjs-renderergl/lib/animators/skeletonanimator.ts","awayjs-renderergl/lib/animators/vertexanimationset.ts","awayjs-renderergl/lib/animators/vertexanimator.ts","awayjs-renderergl/lib/animators/data/animationregistercache.ts","awayjs-renderergl/lib/animators/data/animationsubgeometry.ts","awayjs-renderergl/lib/animators/data/colorsegmentpoint.ts","awayjs-renderergl/lib/animators/data/jointpose.ts","awayjs-renderergl/lib/animators/data/particleanimationdata.ts","awayjs-renderergl/lib/animators/data/particledata.ts","awayjs-renderergl/lib/animators/data/particlepropertiesmode.ts","awayjs-renderergl/lib/animators/data/particleproperties.ts","awayjs-renderergl/lib/animators/data/skeletonjoint.ts","awayjs-renderergl/lib/animators/data/skeletonpose.ts","awayjs-renderergl/lib/animators/data/skeleton.ts","awayjs-renderergl/lib/animators/data/vertexanimationmode.ts","awayjs-renderergl/lib/animators/nodes/animationclipnodebase.ts","awayjs-renderergl/lib/animators/nodes/particleaccelerationnode.ts","awayjs-renderergl/lib/animators/nodes/particlebeziercurvenode.ts","awayjs-renderergl/lib/animators/nodes/particlebillboardnode.ts","awayjs-renderergl/lib/animators/nodes/particlecolornode.ts","awayjs-renderergl/lib/animators/nodes/particlefollownode.ts","awayjs-renderergl/lib/animators/nodes/particleinitialcolornode.ts","awayjs-renderergl/lib/animators/nodes/particlenodebase.ts","awayjs-renderergl/lib/animators/nodes/particleorbitnode.ts","awayjs-renderergl/lib/animators/nodes/particleoscillatornode.ts","awayjs-renderergl/lib/animators/nodes/particlepositionnode.ts","awayjs-renderergl/lib/animators/nodes/particlerotatetoheadingnode.ts","awayjs-renderergl/lib/animators/nodes/particlerotatetopositionnode.ts","awayjs-renderergl/lib/animators/nodes/particlerotationalvelocitynode.ts","awayjs-renderergl/lib/animators/nodes/particlescalenode.ts","awayjs-renderergl/lib/animators/nodes/particlesegmentedcolornode.ts","awayjs-renderergl/lib/animators/nodes/particlespritesheetnode.ts","awayjs-renderergl/lib/animators/nodes/particletimenode.ts","awayjs-renderergl/lib/animators/nodes/particleuvnode.ts","awayjs-renderergl/lib/animators/nodes/particlevelocitynode.ts","awayjs-renderergl/lib/animators/nodes/skeletonbinarylerpnode.ts","awayjs-renderergl/lib/animators/nodes/skeletonclipnode.ts","awayjs-renderergl/lib/animators/nodes/skeletondifferencenode.ts","awayjs-renderergl/lib/animators/nodes/skeletondirectionalnode.ts","awayjs-renderergl/lib/animators/nodes/skeletonnarylerpnode.ts","awayjs-renderergl/lib/animators/nodes/vertexclipnode.ts","awayjs-renderergl/lib/animators/states/animationclipstate.ts","awayjs-renderergl/lib/animators/states/animationstatebase.ts","awayjs-renderergl/lib/animators/states/particleaccelerationstate.ts","awayjs-renderergl/lib/animators/states/particlebeziercurvestate.ts","awayjs-renderergl/lib/animators/states/particlebillboardstate.ts","awayjs-renderergl/lib/animators/states/particlecolorstate.ts","awayjs-renderergl/lib/animators/states/particlefollowstate.ts","awayjs-renderergl/lib/animators/states/particleinitialcolorstate.ts","awayjs-renderergl/lib/animators/states/particleorbitstate.ts","awayjs-renderergl/lib/animators/states/particleoscillatorstate.ts","awayjs-renderergl/lib/animators/states/particlepositionstate.ts","awayjs-renderergl/lib/animators/states/particlerotatetoheadingstate.ts","awayjs-renderergl/lib/animators/states/particlerotatetopositionstate.ts","awayjs-renderergl/lib/animators/states/particlerotationalvelocitystate.ts","awayjs-renderergl/lib/animators/states/particlescalestate.ts","awayjs-renderergl/lib/animators/states/particlesegmentedcolorstate.ts","awayjs-renderergl/lib/animators/states/particlespritesheetstate.ts","awayjs-renderergl/lib/animators/states/particlestatebase.ts","awayjs-renderergl/lib/animators/states/particletimestate.ts","awayjs-renderergl/lib/animators/states/particleuvstate.ts","awayjs-renderergl/lib/animators/states/particlevelocitystate.ts","awayjs-renderergl/lib/animators/states/skeletonbinarylerpstate.ts","awayjs-renderergl/lib/animators/states/skeletonclipstate.ts","awayjs-renderergl/lib/animators/states/skeletondifferencestate.ts","awayjs-renderergl/lib/animators/states/skeletondirectionalstate.ts","awayjs-renderergl/lib/animators/states/skeletonnarylerpstate.ts","awayjs-renderergl/lib/animators/states/vertexclipstate.ts","awayjs-renderergl/lib/animators/transitions/crossfadetransitionnode.ts","awayjs-renderergl/lib/animators/transitions/crossfadetransitionstate.ts","awayjs-renderergl/lib/animators/transitions/crossfadetransition.ts","awayjs-renderergl/lib/base/particlegeometry.ts","awayjs-renderergl/lib/base/rendererbase.ts","awayjs-renderergl/lib/compilation/depthrenderobject.ts","awayjs-renderergl/lib/compilation/distancerenderobject.ts","awayjs-renderergl/lib/compilation/registerpool.ts","awayjs-renderergl/lib/compilation/renderbasicmaterialobject.ts","awayjs-renderergl/lib/compilation/renderobjectbase.ts","awayjs-renderergl/lib/compilation/renderobjectpool.ts","awayjs-renderergl/lib/compilation/shadercompilerbase.ts","awayjs-renderergl/lib/compilation/shaderlightingcompiler.ts","awayjs-renderergl/lib/compilation/shaderlightingobject.ts","awayjs-renderergl/lib/compilation/shaderobjectbase.ts","awayjs-renderergl/lib/compilation/shaderregistercache.ts","awayjs-renderergl/lib/compilation/shaderregisterdata.ts","awayjs-renderergl/lib/compilation/shaderregisterelement.ts","awayjs-renderergl/lib/compilation/skyboxrenderobject.ts","awayjs-renderergl/lib/errors/animationseterror.ts","awayjs-renderergl/lib/events/animationstateevent.ts","awayjs-renderergl/lib/events/animatorevent.ts","awayjs-renderergl/lib/events/shadingmethodevent.ts","awayjs-renderergl/lib/filters/filter3dbase.ts","awayjs-renderergl/lib/filters/tasks/filter3dtaskbase.ts","awayjs-renderergl/lib/managers/defaultmaterialmanager.ts","awayjs-renderergl/lib/managers/rttbuffermanager.ts","awayjs-renderergl/lib/passes/basicmaterialpass.ts","awayjs-renderergl/lib/passes/depthpass.ts","awayjs-renderergl/lib/passes/distancepass.ts","awayjs-renderergl/lib/passes/renderpassbase.ts","awayjs-renderergl/lib/passes/skyboxpass.ts","awayjs-renderergl/lib/pick/jspickingcollider.ts","awayjs-renderergl/lib/pick/pickingcolliderbase.ts","awayjs-renderergl/lib/pick/shaderpicker.ts","awayjs-renderergl/lib/pool/billboardrenderable.ts","awayjs-renderergl/lib/pool/linesegmentrenderable.ts","awayjs-renderergl/lib/pool/linesubmeshrenderable.ts","awayjs-renderergl/lib/pool/renderablebase.ts","awayjs-renderergl/lib/pool/renderablepoolbase.ts","awayjs-renderergl/lib/pool/rendererpoolbase.ts","awayjs-renderergl/lib/pool/skyboxrenderable.ts","awayjs-renderergl/lib/pool/trianglesubmeshrenderable.ts","awayjs-renderergl/lib/tools/commands/merge.ts","awayjs-renderergl/lib/tools/data/particlegeometrytransform.ts","awayjs-renderergl/lib/utils/particlegeometryhelper.ts","awayjs-renderergl/lib/utils/perspectivematrix3d.ts","awayjs-renderergl/lib/utils/shadercompilerhelper.ts","awayjs-stagegl/lib/aglsl/agaltokenizer.ts","awayjs-stagegl/lib/aglsl/aglslparser.ts","awayjs-stagegl/lib/aglsl/description.ts","awayjs-stagegl/lib/aglsl/destination.ts","awayjs-stagegl/lib/aglsl/header.ts","awayjs-stagegl/lib/aglsl/mapping.ts","awayjs-stagegl/lib/aglsl/oplut.ts","awayjs-stagegl/lib/aglsl/sampler.ts","awayjs-stagegl/lib/aglsl/token.ts","awayjs-stagegl/lib/aglsl/assembler/agalminiassembler.ts","awayjs-stagegl/lib/aglsl/assembler/fs.ts","awayjs-stagegl/lib/aglsl/assembler/flags.ts","awayjs-stagegl/lib/aglsl/assembler/opcodemap.ts","awayjs-stagegl/lib/aglsl/assembler/opcode.ts","awayjs-stagegl/lib/aglsl/assembler/part.ts","awayjs-stagegl/lib/aglsl/assembler/regmap.ts","awayjs-stagegl/lib/aglsl/assembler/samplermap.ts","awayjs-stagegl/lib/aglsl/assembler/sampler.ts","awayjs-stagegl/lib/base/contextglblendfactor.ts","awayjs-stagegl/lib/base/contextglclearmask.ts","awayjs-stagegl/lib/base/contextglcomparemode.ts","awayjs-stagegl/lib/base/contextglmipfilter.ts","awayjs-stagegl/lib/base/contextglprofile.ts","awayjs-stagegl/lib/base/contextglprogramtype.ts","awayjs-stagegl/lib/base/contextglstencilaction.ts","awayjs-stagegl/lib/base/contextgltexturefilter.ts","awayjs-stagegl/lib/base/contextgltextureformat.ts","awayjs-stagegl/lib/base/contextgltriangleface.ts","awayjs-stagegl/lib/base/contextglvertexbufferformat.ts","awayjs-stagegl/lib/base/contextglwrapmode.ts","awayjs-stagegl/lib/base/contextstage3d.ts","awayjs-stagegl/lib/base/contextwebgl.ts","awayjs-stagegl/lib/base/cubetextureflash.ts","awayjs-stagegl/lib/base/cubetexturewebgl.ts","awayjs-stagegl/lib/base/indexbufferflash.ts","awayjs-stagegl/lib/base/indexbufferwebgl.ts","awayjs-stagegl/lib/base/opcodes.ts","awayjs-stagegl/lib/base/programflash.ts","awayjs-stagegl/lib/base/programwebgl.ts","awayjs-stagegl/lib/base/resourcebaseflash.ts","awayjs-stagegl/lib/base/samplerstate.ts","awayjs-stagegl/lib/base/stage.ts","awayjs-stagegl/lib/base/texturebasewebgl.ts","awayjs-stagegl/lib/base/textureflash.ts","awayjs-stagegl/lib/base/texturewebgl.ts","awayjs-stagegl/lib/base/vertexbufferflash.ts","awayjs-stagegl/lib/base/vertexbufferwebgl.ts","awayjs-stagegl/lib/managers/stagemanager.ts","awayjs-stagegl/lib/pool/indexdatapool.ts","awayjs-stagegl/lib/pool/indexdata.ts","awayjs-stagegl/lib/pool/programdatapool.ts","awayjs-stagegl/lib/pool/programdata.ts","awayjs-stagegl/lib/pool/texturedatapool.ts","awayjs-stagegl/lib/pool/texturedata.ts","awayjs-stagegl/lib/pool/vertexdatapool.ts","awayjs-stagegl/lib/pool/vertexdata.ts","node_modules/awayjs-stagegl/lib/swfobject.js"],"names":[],"mappings":"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","file":"awayjs-dist-require.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","class BitmapDataChannel\n{\n\tpublic static ALPHA:number /*uint*/ = 8;\n\tpublic static BLUE:number /*uint*/ = 4;\n\tpublic static GREEN:number /*uint*/ = 2;\n\tpublic static RED:number /*uint*/ = 1;\n}\n\nexport = BitmapDataChannel;","import BlendMode\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\nimport ColorTransform\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\nimport Matrix\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\nimport Rectangle\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport Point\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\nimport ColorUtils\t\t\t\t= require(\"awayjs-core/lib/utils/ColorUtils\");\n\n/**\n * The BitmapData class lets you work with the data(pixels) of a Bitmap\n * object. You can use the methods of the BitmapData class to create\n * arbitrarily sized transparent or opaque bitmap images and manipulate them\n * in various ways at runtime. You can also access the BitmapData for a bitmap\n * image that you load with the <code>flash.Assets</code> or\n * <code>flash.display.Loader</code> classes.\n *\n * <p>This class lets you separate bitmap rendering operations from the\n * internal display updating routines of flash. By manipulating a\n * BitmapData object directly, you can create complex images without incurring\n * the per-frame overhead of constantly redrawing the content from vector\n * data.</p>\n *\n * <p>The methods of the BitmapData class support effects that are not\n * available through the filters available to non-bitmap display objects.</p>\n *\n * <p>A BitmapData object contains an array of pixel data. This data can\n * represent either a fully opaque bitmap or a transparent bitmap that\n * contains alpha channel data. Either type of BitmapData object is stored as\n * a buffer of 32-bit integers. Each 32-bit integer determines the properties\n * of a single pixel in the bitmap.</p>\n *\n * <p>Each 32-bit integer is a combination of four 8-bit channel values(from\n * 0 to 255) that describe the alpha transparency and the red, green, and blue\n * (ARGB) values of the pixel.(For ARGB values, the most significant byte\n * represents the alpha channel value, followed by red, green, and blue.)</p>\n *\n * <p>The four channels(alpha, red, green, and blue) are represented as\n * numbers when you use them with the <code>BitmapData.copyChannel()</code>\n * method or the <code>DisplacementMapFilter.componentX</code> and\n * <code>DisplacementMapFilter.componentY</code> properties, and these numbers\n * are represented by the following constants in the BitmapDataChannel\n * class:</p>\n *\n * <ul>\n *   <li><code>BitmapDataChannel.ALPHA</code></li>\n *   <li><code>BitmapDataChannel.RED</code></li>\n *   <li><code>BitmapDataChannel.GREEN</code></li>\n *   <li><code>BitmapDataChannel.BLUE</code></li>\n * </ul>\n *\n * <p>You can attach BitmapData objects to a Bitmap object by using the\n * <code>bitmapData</code> property of the Bitmap object.</p>\n *\n * <p>You can use a BitmapData object to fill a Graphics object by using the\n * <code>Graphics.beginBitmapFill()</code> method.</p>\n *\n * <p>You can also use a BitmapData object to perform batch tile rendering\n * using the <code>flash.display.Tilesheet</code> class.</p>\n *\n * <p>In Flash Player 10, the maximum size for a BitmapData object\n * is 8,191 pixels in width or height, and the total number of pixels cannot\n * exceed 16,777,215 pixels.(So, if a BitmapData object is 8,191 pixels wide,\n * it can only be 2,048 pixels high.) In Flash Player 9 and earlier, the limitation\n * is 2,880 pixels in height and 2,880 in width.</p>\n */\nclass BitmapData\n{\n\tprivate _imageCanvas:HTMLCanvasElement;\n\tprivate _context:CanvasRenderingContext2D;\n\tprivate _imageData:ImageData;\n\tprivate _rect:Rectangle;\n\tprivate _transparent:boolean;\n\tprivate _locked:boolean = false;\n\n\t/**\n\t * The height of the bitmap image in pixels.\n\t */\n\tpublic get height():number\n\t{\n\t\treturn this._rect.height;\n\t}\n\n\tpublic set height(value:number)\n\t{\n\t\tif (this._rect.height == value)\n\t\t\treturn;\n\n\t\tthis._rect.height = value;\n\n\t\tif (this._locked)\n\t\t\tthis._context.putImageData(this._imageData, 0, 0);\n\n\t\tthis._imageCanvas.height = value;\n\n\t\tif (this._locked)\n\t\t\tthis._imageData = this._context.getImageData(0, 0, this._rect.width, this._rect.height);\n\t}\n\n\t/**\n\t * The rectangle that defines the size and location of the bitmap image. The\n\t * top and left of the rectangle are 0; the width and height are equal to the\n\t * width and height in pixels of the BitmapData object.\n\t */\n\tpublic get rect():Rectangle\n\t{\n\t\treturn this._rect;\n\t}\n\n\t/**\n\t * Defines whether the bitmap image supports per-pixel transparency. You can\n\t * set this value only when you construct a BitmapData object by passing in\n\t * <code>true</code> for the <code>transparent</code> parameter of the\n\t * constructor. Then, after you create a BitmapData object, you can check\n\t * whether it supports per-pixel transparency by determining if the value of\n\t * the <code>transparent</code> property is <code>true</code>.\n\t */\n\tpublic get transparent():boolean\n\t{\n\t\treturn this._transparent;\n\t}\n\n\tpublic set transparent(value:boolean)\n\t{\n\t\tthis._transparent = value;\n\t}\n\n\t/**\n\t * The width of the bitmap image in pixels.\n\t */\n\tpublic get width():number\n\t{\n\t\treturn this._rect.width;\n\t}\n\n\tpublic set width(value:number)\n\t{\n\t\tif (this._rect.width == value)\n\t\t\treturn;\n\n\t\tthis._rect.width = value;\n\n\t\tif (this._locked)\n\t\t\tthis._context.putImageData(this._imageData, 0, 0);\n\n\t\tthis._imageCanvas.width = value;\n\n\t\tif (this._locked)\n\t\t\tthis._imageData = this._context.getImageData(0, 0, this._rect.width, this._rect.height);\n\t}\n\n\t/**\n\t * Creates a BitmapData object with a specified width and height. If you\n\t * specify a value for the <code>fillColor</code> parameter, every pixel in\n\t * the bitmap is set to that color.\n\t *\n\t * <p>By default, the bitmap is created as transparent, unless you pass\n\t * the value <code>false</code> for the transparent parameter. After you\n\t * create an opaque bitmap, you cannot change it to a transparent bitmap.\n\t * Every pixel in an opaque bitmap uses only 24 bits of color channel\n\t * information. If you define the bitmap as transparent, every pixel uses 32\n\t * bits of color channel information, including an alpha transparency\n\t * channel.</p>\n\t *\n\t * @param width       The width of the bitmap image in pixels.\n\t * @param height      The height of the bitmap image in pixels.\n\t * @param transparent Specifies whether the bitmap image supports per-pixel\n\t *                    transparency. The default value is <code>true</code>\n\t *                    (transparent). To create a fully transparent bitmap,\n\t *                    set the value of the <code>transparent</code>\n\t *                    parameter to <code>true</code> and the value of the\n\t *                    <code>fillColor</code> parameter to 0x00000000(or to\n\t *                    0). Setting the <code>transparent</code> property to\n\t *                    <code>false</code> can result in minor improvements\n\t *                    in rendering performance.\n\t * @param fillColor   A 32-bit ARGB color value that you use to fill the\n\t *                    bitmap image area. The default value is\n\t *                    0xFFFFFFFF(solid white).\n\t */\n\tconstructor(width:number, height:number, transparent:boolean = true, fillColor:number = null)\n\t{\n\t\tthis._transparent = transparent;\n\t\tthis._imageCanvas = <HTMLCanvasElement> document.createElement(\"canvas\");\n\t\tthis._imageCanvas.width = width;\n\t\tthis._imageCanvas.height = height;\n\t\tthis._context = this._imageCanvas.getContext(\"2d\");\n\t\tthis._rect = new Rectangle(0, 0, width, height);\n\n\t\tif (fillColor != null)\n\t\t\tthis.fillRect(this._rect, fillColor);\n\t}\n\n\t/**\n\t * Returns a new BitmapData object that is a clone of the original instance\n\t * with an exact copy of the contained bitmap.\n\t *\n\t * @return A new BitmapData object that is identical to the original.\n\t */\n\tpublic clone():BitmapData\n\t{\n\t\tvar t:BitmapData = new BitmapData(this.width, this.height, this.transparent);\n\t\tt.draw(this);\n\t\treturn t;\n\t}\n\n\t/**\n\t * Adjusts the color values in a specified area of a bitmap image by using a\n\t * <code>ColorTransform</code> object. If the rectangle matches the\n\t * boundaries of the bitmap image, this method transforms the color values of\n\t * the entire image.\n\t *\n\t * @param rect           A Rectangle object that defines the area of the\n\t *                       image in which the ColorTransform object is applied.\n\t * @param colorTransform A ColorTransform object that describes the color\n\t *                       transformation values to apply.\n\t */\n\tpublic colorTransform(rect:Rectangle, colorTransform:ColorTransform)\n\t{\n\t\tif (!this._locked)\n\t\t\tthis._imageData = this._context.getImageData(0, 0, this._rect.width, this._rect.height);\n\n\t\tvar data:Array<number> = this._imageData.data;\n\n\t\tvar i:number /*uint*/, j:number /*uint*/, index:number /*uint*/;\n\t\tfor (i = 0; i < rect.width; ++i) {\n\t\t\tfor (j = 0; j < rect.height; ++j) {\n\t\t\t\tindex = (i + rect.x + (j + rect.y)*this.width)*4;\n\n\t\t\t\tdata[index] = data[index]*colorTransform.redMultiplier + colorTransform.redOffset;\n\t\t\t\tdata[index + 1] = data[index + 1]*colorTransform.greenMultiplier + colorTransform.greenOffset;\n\t\t\t\tdata[index + 2] = data[index + 2]*colorTransform.blueMultiplier + colorTransform.blueOffset;\n\t\t\t\tdata[index + 3] = data[index + 3]*colorTransform.alphaMultiplier + colorTransform.alphaOffset;\n\t\t\t}\n\t\t}\n\n\t\tif (!this._locked) {\n\t\t\tthis._context.putImageData(this._imageData, 0, 0);\n\t\t\tthis._imageData = null;\n\t\t}\n\t}\n\n\t/**\n\t * Transfers data from one channel of another BitmapData object or the\n\t * current BitmapData object into a channel of the current BitmapData object.\n\t * All of the data in the other channels in the destination BitmapData object\n\t * are preserved.\n\t *\n\t * <p>The source channel value and destination channel value can be one of\n\t * following values: </p>\n\t *\n\t * <ul>\n\t *   <li><code>BitmapDataChannel.RED</code></li>\n\t *   <li><code>BitmapDataChannel.GREEN</code></li>\n\t *   <li><code>BitmapDataChannel.BLUE</code></li>\n\t *   <li><code>BitmapDataChannel.ALPHA</code></li>\n\t * </ul>\n\t *\n\t * @param sourceBitmapData The input bitmap image to use. The source image\n\t *                         can be a different BitmapData object or it can\n\t *                         refer to the current BitmapData object.\n\t * @param sourceRect       The source Rectangle object. To copy only channel\n\t *                         data from a smaller area within the bitmap,\n\t *                         specify a source rectangle that is smaller than\n\t *                         the overall size of the BitmapData object.\n\t * @param destPoint        The destination Point object that represents the\n\t *                         upper-left corner of the rectangular area where\n\t *                         the new channel data is placed. To copy only\n\t *                         channel data from one area to a different area in\n\t *                         the destination image, specify a point other than\n\t *                        (0,0).\n\t * @param sourceChannel    The source channel. Use a value from the\n\t *                         BitmapDataChannel class\n\t *                        (<code>BitmapDataChannel.RED</code>,\n\t *                         <code>BitmapDataChannel.BLUE</code>,\n\t *                         <code>BitmapDataChannel.GREEN</code>,\n\t *                         <code>BitmapDataChannel.ALPHA</code>).\n\t * @param destChannel      The destination channel. Use a value from the\n\t *                         BitmapDataChannel class\n\t *                        (<code>BitmapDataChannel.RED</code>,\n\t *                         <code>BitmapDataChannel.BLUE</code>,\n\t *                         <code>BitmapDataChannel.GREEN</code>,\n\t *                         <code>BitmapDataChannel.ALPHA</code>).\n\t * @throws TypeError The sourceBitmapData, sourceRect or destPoint are null.\n\t */\n\tpublic copyChannel(sourceBitmap:BitmapData, sourceRect:Rectangle, destPoint:Point, sourceChannel:number, destChannel:number)\n\t{\n\t\tvar imageData:ImageData = sourceBitmap.imageData;\n\n\t\tif (!this._locked)\n\t\t\tthis._imageData = this._context.getImageData(0, 0, this._rect.width, this._rect.height);\n\n\t\tvar sourceData:Array<number> = sourceBitmap.imageData.data;\n\t\tvar destData:Array<number> = this._imageData.data;\n\n\t\tvar sourceOffset:number = Math.round(Math.log(sourceChannel)/Math.log(2));\n\t\tvar destOffset:number = Math.round(Math.log(destChannel)/Math.log(2));\n\n\t\tvar i:number /*uint*/, j:number /*uint*/, sourceIndex:number /*uint*/, destIndex:number /*uint*/;\n\t\tfor (i = 0; i < sourceRect.width; ++i) {\n\t\t\tfor (j = 0; j < sourceRect.height; ++j) {\n\t\t\t\tsourceIndex = (i + sourceRect.x + (j + sourceRect.y)*sourceBitmap.width)*4;\n\t\t\t\tdestIndex = (i + destPoint.x + (j + destPoint.y)*this.width)*4;\n\n\t\t\t\tdestData[destIndex + destOffset] = sourceData[sourceIndex + sourceOffset];\n\t\t\t}\n\t\t}\n\n\t\tif (!this._locked) {\n\t\t\tthis._context.putImageData(this._imageData, 0, 0);\n\t\t\tthis._imageData = null;\n\t\t}\n\t}\n\n\t/**\n\t * Provides a fast routine to perform pixel manipulation between images with\n\t * no stretching, rotation, or color effects. This method copies a\n\t * rectangular area of a source image to a rectangular area of the same size\n\t * at the destination point of the destination BitmapData object.\n\t *\n\t * <p>If you include the <code>alphaBitmap</code> and <code>alphaPoint</code>\n\t * parameters, you can use a secondary image as an alpha source for the\n\t * source image. If the source image has alpha data, both sets of alpha data\n\t * are used to composite pixels from the source image to the destination\n\t * image. The <code>alphaPoint</code> parameter is the point in the alpha\n\t * image that corresponds to the upper-left corner of the source rectangle.\n\t * Any pixels outside the intersection of the source image and alpha image\n\t * are not copied to the destination image.</p>\n\t *\n\t * <p>The <code>mergeAlpha</code> property controls whether or not the alpha\n\t * channel is used when a transparent image is copied onto another\n\t * transparent image. To copy pixels with the alpha channel data, set the\n\t * <code>mergeAlpha</code> property to <code>true</code>. By default, the\n\t * <code>mergeAlpha</code> property is <code>false</code>.</p>\n\t *\n\t * @param sourceBitmapData The input bitmap image from which to copy pixels.\n\t *                         The source image can be a different BitmapData\n\t *                         instance, or it can refer to the current\n\t *                         BitmapData instance.\n\t * @param sourceRect       A rectangle that defines the area of the source\n\t *                         image to use as input.\n\t * @param destPoint        The destination point that represents the\n\t *                         upper-left corner of the rectangular area where\n\t *                         the new pixels are placed.\n\t * @param alphaBitmapData  A secondary, alpha BitmapData object source.\n\t * @param alphaPoint       The point in the alpha BitmapData object source\n\t *                         that corresponds to the upper-left corner of the\n\t *                         <code>sourceRect</code> parameter.\n\t * @param mergeAlpha       To use the alpha channel, set the value to\n\t *                         <code>true</code>. To copy pixels with no alpha\n\t *                         channel, set the value to <code>false</code>.\n\t * @throws TypeError The sourceBitmapData, sourceRect, destPoint are null.\n\t */\n\tpublic copyPixels(bmpd:BitmapData, sourceRect:Rectangle, destRect:Rectangle);\n\tpublic copyPixels(bmpd:HTMLImageElement, sourceRect:Rectangle, destRect:Rectangle);\n\tpublic copyPixels(bmpd:any, sourceRect:Rectangle, destRect:Rectangle)\n\t{\n\n\t\tif (this._locked) {\n\n\t\t\t// If canvas is locked:\n\t\t\t//\n\t\t\t//      1) copy image data back to canvas\n\t\t\t//      2) draw object\n\t\t\t//      3) read _imageData back out\n\n\t\t\tif (this._imageData)\n\t\t\t\tthis._context.putImageData(this._imageData, 0, 0); // at coords 0,0\n\n\t\t\tthis._copyPixels(bmpd, sourceRect, destRect);\n\n\t\t\tif (this._imageData)\n\t\t\t\tthis._imageData = this._context.getImageData(0, 0, this._rect.width, this._rect.height);\n\n\t\t} else {\n\t\t\tthis._copyPixels(bmpd, sourceRect, destRect);\n\t\t}\n\t}\n\n\t/**\n\t * Frees memory that is used to store the BitmapData object.\n\t *\n\t * <p>When the <code>dispose()</code> method is called on an image, the width\n\t * and height of the image are set to 0. All subsequent calls to methods or\n\t * properties of this BitmapData instance fail, and an exception is thrown.\n\t * </p>\n\t *\n\t * <p><code>BitmapData.dispose()</code> releases the memory occupied by the\n\t * actual bitmap data, immediately(a bitmap can consume up to 64 MB of\n\t * memory). After using <code>BitmapData.dispose()</code>, the BitmapData\n\t * object is no longer usable and an exception may be thrown if\n\t * you call functions on the BitmapData object. However,\n\t * <code>BitmapData.dispose()</code> does not garbage collect the BitmapData\n\t * object(approximately 128 bytes); the memory occupied by the actual\n\t * BitmapData object is released at the time the BitmapData object is\n\t * collected by the garbage collector.</p>\n\t *\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._context = null;\n\t\tthis._imageCanvas = null;\n\t\tthis._imageData = null;\n\t\tthis._rect = null;\n\t\tthis._transparent = null;\n\t\tthis._locked = null;\n\t}\n\n\t/**\n\t * Draws the <code>source</code> display object onto the bitmap image, using\n\t * the NME software renderer. You can specify <code>matrix</code>,\n\t * <code>colorTransform</code>, <code>blendMode</code>, and a destination\n\t * <code>clipRect</code> parameter to control how the rendering performs.\n\t * Optionally, you can specify whether the bitmap should be smoothed when\n\t * scaled(this works only if the source object is a BitmapData object).\n\t *\n\t * <p>The source display object does not use any of its applied\n\t * transformations for this call. It is treated as it exists in the library\n\t * or file, with no matrix transform, no color transform, and no blend mode.\n\t * To draw a display object(such as a movie clip) by using its own transform\n\t * properties, you can copy its <code>transform</code> property object to the\n\t * <code>transform</code> property of the Bitmap object that uses the\n\t * BitmapData object.</p>\n\t *\n\t * @param source         The display object or BitmapData object to draw to\n\t *                       the BitmapData object.(The DisplayObject and\n\t *                       BitmapData classes implement the IBitmapDrawable\n\t *                       interface.)\n\t * @param matrix         A Matrix object used to scale, rotate, or translate\n\t *                       the coordinates of the bitmap. If you do not want to\n\t *                       apply a matrix transformation to the image, set this\n\t *                       parameter to an identity matrix, created with the\n\t *                       default <code>new Matrix()</code> constructor, or\n\t *                       pass a <code>null</code> value.\n\t * @param colorTransform A ColorTransform object that you use to adjust the\n\t *                       color values of the bitmap. If no object is\n\t *                       supplied, the bitmap image's colors are not\n\t *                       transformed. If you must pass this parameter but you\n\t *                       do not want to transform the image, set this\n\t *                       parameter to a ColorTransform object created with\n\t *                       the default <code>new ColorTransform()</code>\n\t *                       constructor.\n\t * @param blendMode      A string value, from the flash.display.BlendMode\n\t *                       class, specifying the blend mode to be applied to\n\t *                       the resulting bitmap.\n\t * @param clipRect       A Rectangle object that defines the area of the\n\t *                       source object to draw. If you do not supply this\n\t *                       value, no clipping occurs and the entire source\n\t *                       object is drawn.\n\t * @param smoothing      A Boolean value that determines whether a BitmapData\n\t *                       object is smoothed when scaled or rotated, due to a\n\t *                       scaling or rotation in the <code>matrix</code>\n\t *                       parameter. The <code>smoothing</code> parameter only\n\t *                       applies if the <code>source</code> parameter is a\n\t *                       BitmapData object. With <code>smoothing</code> set\n\t *                       to <code>false</code>, the rotated or scaled\n\t *                       BitmapData image can appear pixelated or jagged. For\n\t *                       example, the following two images use the same\n\t *                       BitmapData object for the <code>source</code>\n\t *                       parameter, but the <code>smoothing</code> parameter\n\t *                       is set to <code>true</code> on the left and\n\t *                       <code>false</code> on the right:\n\t *\n\t *                       <p>Drawing a bitmap with <code>smoothing</code> set\n\t *                       to <code>true</code> takes longer than doing so with\n\t *                       <code>smoothing</code> set to\n\t *                       <code>false</code>.</p>\n\t * @throws ArgumentError The <code>source</code> parameter is not a\n\t *                       BitmapData or DisplayObject object.\n\t * @throws ArgumentError The source is null or not a valid IBitmapDrawable\n\t *                       object.\n\t * @throws SecurityError The <code>source</code> object and(in the case of a\n\t *                       Sprite or MovieClip object) all of its child objects\n\t *                       do not come from the same domain as the caller, or\n\t *                       are not in a content that is accessible to the\n\t *                       caller by having called the\n\t *                       <code>Security.allowDomain()</code> method. This\n\t *                       restriction does not apply to AIR content in the\n\t *                       application security sandbox.\n\t */\n\tpublic draw(source:BitmapData, matrix?:Matrix, colorTransform?:ColorTransform, blendMode?:BlendMode, clipRect?:Rectangle, smoothing?:boolean);\n\tpublic draw(source:HTMLElement, matrix?:Matrix, colorTransform?:ColorTransform, blendMode?:BlendMode, clipRect?:Rectangle, smoothing?:boolean);\n\tpublic draw(source:any, matrix?:Matrix, colorTransform?:ColorTransform, blendMode?:BlendMode, clipRect?:Rectangle, smoothing?:boolean)\n\t{\n\t\tif (this._locked) {\n\n\t\t\t// If canvas is locked:\n\t\t\t//\n\t\t\t//      1) copy image data back to canvas\n\t\t\t//      2) draw object\n\t\t\t//      3) read _imageData back out\n\n\t\t\tthis._context.putImageData(this._imageData, 0, 0); // at coords 0,0\n\t\t\tthis._draw(source, matrix, colorTransform, blendMode, clipRect, smoothing);\n\t\t\tthis._imageData = this._context.getImageData(0, 0, this._rect.width, this._rect.height);\n\t\t} else {\n\t\t\tthis._draw(source, matrix, colorTransform, blendMode, clipRect, smoothing);\n\t\t}\n\t}\n\n\t/**\n\t * Fills a rectangular area of pixels with a specified ARGB color.\n\t *\n\t * @param rect  The rectangular area to fill.\n\t * @param color The ARGB color value that fills the area. ARGB colors are\n\t *              often specified in hexadecimal format; for example,\n\t *              0xFF336699.\n\t * @throws TypeError The rect is null.\n\t */\n\tpublic fillRect(rect:Rectangle, color:number)\n\t{\n\t\tif (this._locked) {\n\n\t\t\t// If canvas is locked:\n\t\t\t//\n\t\t\t//      1) copy image data back to canvas\n\t\t\t//      2) apply fill\n\t\t\t//      3) read _imageData back out\n\n\t\t\tif (this._imageData)\n\t\t\t\tthis._context.putImageData(this._imageData, 0, 0); // at coords 0,0\n\n\t\t\tthis._fillRect(rect, color);\n\n\t\t\tif (this._imageData)\n\t\t\t\tthis._imageData = this._context.getImageData(0, 0, this._rect.width, this._rect.height);\n\t\t} else {\n\t\t\tthis._fillRect(rect, color);\n\t\t}\n\t}\n\n\t/**\n\t * Returns an integer that represents an RGB pixel value from a BitmapData\n\t * object at a specific point(<i>x</i>, <i>y</i>). The\n\t * <code>getPixel()</code> method returns an unmultiplied pixel value. No\n\t * alpha information is returned.\n\t *\n\t * <p>All pixels in a BitmapData object are stored as premultiplied color\n\t * values. A premultiplied image pixel has the red, green, and blue color\n\t * channel values already multiplied by the alpha data. For example, if the\n\t * alpha value is 0, the values for the RGB channels are also 0, independent\n\t * of their unmultiplied values. This loss of data can cause some problems\n\t * when you perform operations. All BitmapData methods take and return\n\t * unmultiplied values. The internal pixel representation is converted from\n\t * premultiplied to unmultiplied before it is returned as a value. During a\n\t * set operation, the pixel value is premultiplied before the raw image pixel\n\t * is set.</p>\n\t *\n\t * @param x The <i>x</i> position of the pixel.\n\t * @param y The <i>y</i> position of the pixel.\n\t * @return A number that represents an RGB pixel value. If the(<i>x</i>,\n\t *         <i>y</i>) coordinates are outside the bounds of the image, the\n\t *         method returns 0.\n\t */\n\tpublic getPixel(x, y):number\n\t{\n\t\tvar r:number;\n\t\tvar g:number;\n\t\tvar b:number;\n\t\tvar a:number;\n\n\t\tif (!this._locked) {\n\t\t\tvar pixelData:ImageData = this._context.getImageData(x, y, 1, 1);\n\n\t\t\tr = pixelData.data[0];\n\t\t\tg = pixelData.data[1];\n\t\t\tb = pixelData.data[2];\n\t\t\ta = pixelData.data[3];\n\n\t\t} else {\n\t\t\tvar index:number = (x + y*this._imageCanvas.width)*4;\n\n\t\t\tr = this._imageData.data[index + 0];\n\t\t\tg = this._imageData.data[index + 1];\n\t\t\tb = this._imageData.data[index + 2];\n\t\t\ta = this._imageData.data[index + 3];\n\t\t}\n\n\t\t//returns black if fully transparent\n\t\tif (!a)\n\t\t\treturn 0x0;\n\n\t\treturn (r << 16) | (g << 8) | b;\n\t}\n\n\t/**\n\t * Returns an ARGB color value that contains alpha channel data and RGB data.\n\t * This method is similar to the <code>getPixel()</code> method, which\n\t * returns an RGB color without alpha channel data.\n\t *\n\t * <p>All pixels in a BitmapData object are stored as premultiplied color\n\t * values. A premultiplied image pixel has the red, green, and blue color\n\t * channel values already multiplied by the alpha data. For example, if the\n\t * alpha value is 0, the values for the RGB channels are also 0, independent\n\t * of their unmultiplied values. This loss of data can cause some problems\n\t * when you perform operations. All BitmapData methods take and return\n\t * unmultiplied values. The internal pixel representation is converted from\n\t * premultiplied to unmultiplied before it is returned as a value. During a\n\t * set operation, the pixel value is premultiplied before the raw image pixel\n\t * is set.</p>\n\t *\n\t * @param x The <i>x</i> position of the pixel.\n\t * @param y The <i>y</i> position of the pixel.\n\t * @return A number representing an ARGB pixel value. If the(<i>x</i>,\n\t *         <i>y</i>) coordinates are outside the bounds of the image, 0 is\n\t *         returned.\n\t */\n\tpublic getPixel32(x, y):number\n\t{\n\t\tvar r:number;\n\t\tvar g:number;\n\t\tvar b:number;\n\t\tvar a:number;\n\n\t\tif (!this._locked) {\n\t\t\tvar pixelData:ImageData = this._context.getImageData(x, y, 1, 1);\n\n\t\t\tr = pixelData.data[0];\n\t\t\tg = pixelData.data[1];\n\t\t\tb = pixelData.data[2];\n\t\t\ta = pixelData.data[3];\n\n\t\t} else {\n\t\t\tvar index:number = (x + y*this._imageCanvas.width)*4;\n\n\t\t\tr = this._imageData.data[index + 0];\n\t\t\tg = this._imageData.data[index + 1];\n\t\t\tb = this._imageData.data[index + 2];\n\t\t\ta = this._imageData.data[index + 3];\n\t\t}\n\n\t\treturn (a << 24) | (r << 16) | (g << 8) | b;\n\t}\n\n\t/**\n\t * Locks an image so that any objects that reference the BitmapData object,\n\t * such as Bitmap objects, are not updated when this BitmapData object\n\t * changes. To improve performance, use this method along with the\n\t * <code>unlock()</code> method before and after numerous calls to the\n\t * <code>setPixel()</code> or <code>setPixel32()</code> method.\n\t *\n\t */\n\tpublic lock()\n\t{\n\t\tif (this._locked)\n\t\t\treturn;\n\n\t\tthis._locked = true;\n\t\tthis._imageData = this._context.getImageData(0, 0, this._rect.width, this._rect.height);\n\t}\n\n\t/**\n\t * Converts an Array into a rectangular region of pixel data. For each pixel,\n\t * an Array element is read and written into the BitmapData pixel. The data\n\t * in the Array is expected to be 32-bit ARGB pixel values.\n\t *\n\t * @param rect        Specifies the rectangular region of the BitmapData\n\t *                    object.\n\t * @param inputArray  An Array that consists of 32-bit unmultiplied pixel\n\t *                    values to be used in the rectangular region.\n\t * @throws RangeError The vector array is not large enough to read all the\n\t *                    pixel data.\n\t */\n\tpublic setArray(rect:Rectangle, inputArray:Array<number>)\n\t{\n\t\tif (!this._locked)\n\t\t\tthis._imageData = this._context.getImageData(0, 0, this._rect.width, this._rect.height);\n\n\t\tvar i:number /*uint*/, j:number /*uint*/, index:number /*uint*/, argb:number[] /*uint*/;\n\t\tfor (i = 0; i < rect.width; ++i) {\n\t\t\tfor (j = 0; j < rect.height; ++j) {\n\t\t\t\targb = ColorUtils.float32ColorToARGB(inputArray[i + j*rect.width]);\n\t\t\t\tindex = (i + rect.x + (j + rect.y)*this._imageCanvas.width)*4;\n\n\t\t\t\tthis._imageData.data[index + 0] = argb[1];\n\t\t\t\tthis._imageData.data[index + 1] = argb[2];\n\t\t\t\tthis._imageData.data[index + 2] = argb[3];\n\t\t\t\tthis._imageData.data[index + 3] = argb[0];\n\t\t\t}\n\t\t}\n\n\t\tif (!this._locked) {\n\t\t\tthis._context.putImageData(this._imageData, 0, 0);\n\t\t\tthis._imageData = null;\n\t\t}\n\t}\n\n\t/**\n\t * Sets a single pixel of a BitmapData object. The current alpha channel\n\t * value of the image pixel is preserved during this operation. The value of\n\t * the RGB color parameter is treated as an unmultiplied color value.\n\t *\n\t * <p><b>Note:</b> To increase performance, when you use the\n\t * <code>setPixel()</code> or <code>setPixel32()</code> method repeatedly,\n\t * call the <code>lock()</code> method before you call the\n\t * <code>setPixel()</code> or <code>setPixel32()</code> method, and then call\n\t * the <code>unlock()</code> method when you have made all pixel changes.\n\t * This process prevents objects that reference this BitmapData instance from\n\t * updating until you finish making the pixel changes.</p>\n\t *\n\t * @param x     The <i>x</i> position of the pixel whose value changes.\n\t * @param y     The <i>y</i> position of the pixel whose value changes.\n\t * @param color The resulting RGB color for the pixel.\n\t */\n\tpublic setPixel(x:number, y:number, color:number)\n\t{\n\t\tvar argb:number[] = ColorUtils.float32ColorToARGB(color);\n\n\t\tif (!this._locked)\n\t\t\tthis._imageData = this._context.getImageData(0, 0, this._rect.width, this._rect.height);\n\n\t\tvar index:number = (x + y*this._imageCanvas.width)*4;\n\n\t\tthis._imageData.data[index + 0] = argb[1];\n\t\tthis._imageData.data[index + 1] = argb[2];\n\t\tthis._imageData.data[index + 2] = argb[3];\n\t\tthis._imageData.data[index + 3] = 255;\n\n\t\tif (!this._locked) {\n\t\t\tthis._context.putImageData(this._imageData, 0, 0);\n\t\t\tthis._imageData = null;\n\t\t}\n\t}\n\n\t/**\n\t * Sets the color and alpha transparency values of a single pixel of a\n\t * BitmapData object. This method is similar to the <code>setPixel()</code>\n\t * method; the main difference is that the <code>setPixel32()</code> method\n\t * takes an ARGB color value that contains alpha channel information.\n\t *\n\t * <p>All pixels in a BitmapData object are stored as premultiplied color\n\t * values. A premultiplied image pixel has the red, green, and blue color\n\t * channel values already multiplied by the alpha data. For example, if the\n\t * alpha value is 0, the values for the RGB channels are also 0, independent\n\t * of their unmultiplied values. This loss of data can cause some problems\n\t * when you perform operations. All BitmapData methods take and return\n\t * unmultiplied values. The internal pixel representation is converted from\n\t * premultiplied to unmultiplied before it is returned as a value. During a\n\t * set operation, the pixel value is premultiplied before the raw image pixel\n\t * is set.</p>\n\t *\n\t * <p><b>Note:</b> To increase performance, when you use the\n\t * <code>setPixel()</code> or <code>setPixel32()</code> method repeatedly,\n\t * call the <code>lock()</code> method before you call the\n\t * <code>setPixel()</code> or <code>setPixel32()</code> method, and then call\n\t * the <code>unlock()</code> method when you have made all pixel changes.\n\t * This process prevents objects that reference this BitmapData instance from\n\t * updating until you finish making the pixel changes.</p>\n\t *\n\t * @param x     The <i>x</i> position of the pixel whose value changes.\n\t * @param y     The <i>y</i> position of the pixel whose value changes.\n\t * @param color The resulting ARGB color for the pixel. If the bitmap is\n\t *              opaque(not transparent), the alpha transparency portion of\n\t *              this color value is ignored.\n\t */\n\tpublic setPixel32(x, y, color:number)\n\t{\n\t\tvar argb:number[] = ColorUtils.float32ColorToARGB(color);\n\n\t\tif (!this._locked)\n\t\t\tthis._imageData = this._context.getImageData(0, 0, this._rect.width, this._rect.height);\n\n\t\tvar index:number = (x + y*this._imageCanvas.width)*4;\n\n\t\tthis._imageData.data[index + 0] = argb[1];\n\t\tthis._imageData.data[index + 1] = argb[2];\n\t\tthis._imageData.data[index + 2] = argb[3];\n\t\tthis._imageData.data[index + 3] = argb[0];\n\n\t\tif (!this._locked) {\n\t\t\tthis._context.putImageData(this._imageData, 0, 0);\n\t\t\tthis._imageData = null;\n\t\t}\n\t}\n\n\t/**\n\t * Converts a byte array into a rectangular region of pixel data. For each\n\t * pixel, the <code>ByteArray.readUnsignedInt()</code> method is called and\n\t * the return value is written into the pixel. If the byte array ends before\n\t * the full rectangle is written, the function returns. The data in the byte\n\t * array is expected to be 32-bit ARGB pixel values. No seeking is performed\n\t * on the byte array before or after the pixels are read.\n\t *\n\t * @param rect           Specifies the rectangular region of the BitmapData\n\t *                       object.\n\t * @param inputByteArray A ByteArray object that consists of 32-bit\n\t *                       unmultiplied pixel values to be used in the\n\t *                       rectangular region.\n\t * @throws EOFError  The <code>inputByteArray</code> object does not include\n\t *                   enough data to fill the area of the <code>rect</code>\n\t *                   rectangle. The method fills as many pixels as possible\n\t *                   before throwing the exception.\n\t * @throws TypeError The rect or inputByteArray are null.\n\t */\n\tpublic setPixels(rect:Rectangle, inputByteArray:ByteArray)\n\t{\n\t\tif (!this._locked)\n\t\t\tthis._imageData = this._context.getImageData(0, 0, this._rect.width, this._rect.height);\n\n\t\tinputByteArray.position = 0;\n\t\tvar i:number /*uint*/, j:number /*uint*/, index:number /*uint*/;\n\t\tfor (i = 0; i < rect.width; ++i) {\n\t\t\tfor (j = 0; j < rect.height; ++j) {\n\t\t\t\tindex = (i + rect.x + (j + rect.y)*this._imageCanvas.width)*4;\n\n\t\t\t\tthis._imageData.data[index + 0] = inputByteArray.readUnsignedInt();\n\t\t\t\tthis._imageData.data[index + 1] = inputByteArray.readUnsignedInt();\n\t\t\t\tthis._imageData.data[index + 2] = inputByteArray.readUnsignedInt();\n\t\t\t\tthis._imageData.data[index + 3] = inputByteArray.readUnsignedInt();\n\t\t\t}\n\t\t}\n\n\t\tif (!this._locked) {\n\t\t\tthis._context.putImageData(this._imageData, 0, 0);\n\t\t\tthis._imageData = null;\n\t\t}\n\t}\n\n\t/**\n\t * Unlocks an image so that any objects that reference the BitmapData object,\n\t * such as Bitmap objects, are updated when this BitmapData object changes.\n\t * To improve performance, use this method along with the <code>lock()</code>\n\t * method before and after numerous calls to the <code>setPixel()</code> or\n\t * <code>setPixel32()</code> method.\n\t *\n\t * @param changeRect The area of the BitmapData object that has changed. If\n\t *                   you do not specify a value for this parameter, the\n\t *                   entire area of the BitmapData object is considered\n\t *                   changed.\n\t */\n\tpublic unlock()\n\t{\n\t\tif (!this._locked)\n\t\t\treturn;\n\n\t\tthis._locked = false;\n\n\t\tthis._context.putImageData(this._imageData, 0, 0); // at coords 0,0\n\t\tthis._imageData = null;\n\t}\n\n\tprivate _copyPixels(bmpd:BitmapData, sourceRect:Rectangle, destRect:Rectangle);\n\tprivate _copyPixels(bmpd:HTMLImageElement, sourceRect:Rectangle, destRect:Rectangle);\n\tprivate _copyPixels(bmpd:any, sourceRect:Rectangle, destRect:Rectangle)\n\t{\n\n\t\tif (bmpd instanceof BitmapData) {\n\t\t\tthis._context.drawImage(bmpd.canvas, sourceRect.x, sourceRect.y, sourceRect.width, sourceRect.height, destRect.x, destRect.y, destRect.width, destRect.height);\n\t\t} else if (bmpd instanceof HTMLImageElement) {\n\t\t\tthis._context.drawImage(bmpd, sourceRect.x, sourceRect.y, sourceRect.width, sourceRect.height, destRect.x, destRect.y, destRect.width, destRect.height);\n\t\t}\n\n\t}\n\n\tprivate _draw(source:BitmapData, matrix:Matrix, colorTransform:ColorTransform, blendMode:BlendMode, clipRect:Rectangle, smoothing:boolean);\n\tprivate _draw(source:HTMLElement, matrix:Matrix, colorTransform:ColorTransform, blendMode:BlendMode, clipRect:Rectangle, smoothing:boolean);\n\tprivate _draw(source:any, matrix:Matrix, colorTransform:ColorTransform, blendMode:BlendMode, clipRect:Rectangle, smoothing:boolean)\n\t{\n\t\tif (source instanceof BitmapData) {\n\t\t\tthis._context.save();\n\n\t\t\tif (matrix != null)\n\t\t\t\tthis._context.setTransform(matrix.a, matrix.b, matrix.c, matrix.d, matrix.tx, matrix.ty);\n\n\t\t\tif (clipRect != null)\n\t\t\t\tthis._context.drawImage(source.canvas, clipRect.x, clipRect.y, clipRect.width, clipRect.height);\n\t\t\telse\n\t\t\t\tthis._context.drawImage(source.canvas, 0, 0);\n\n\t\t\tthis._context.restore();\n\n\t\t} else if (source instanceof HTMLElement) {\n\t\t\tthis._context.save();\n\n\t\t\tif (matrix != null)\n\t\t\t\tthis._context.setTransform(matrix.a, matrix.b, matrix.c, matrix.d, matrix.tx, matrix.ty);\n\n\t\t\tif (clipRect != null)\n\t\t\t\tthis._context.drawImage(source, clipRect.x, clipRect.y, clipRect.width, clipRect.height);\n\t\t\telse\n\t\t\t\tthis._context.drawImage(source, 0, 0);\n\n\t\t\tthis._context.restore();\n\t\t}\n\t}\n\n\tprivate _fillRect(rect:Rectangle, color:number)\n\t{\n\t\tif (color == 0x0 && this._transparent) {\n\t\t\tthis._context.clearRect(rect.x, rect.y, rect.width, rect.height);\n\t\t} else {\n\t\t\tvar argb:number[] = ColorUtils.float32ColorToARGB(color);\n\n\t\t\tif (this._transparent)\n\t\t\t\tthis._context.fillStyle = 'rgba(' + argb[1] + ',' + argb[2] + ',' + argb[3] + ',' + argb[0]/255 + ')';\n\t\t\telse\n\t\t\t\tthis._context.fillStyle = 'rgba(' + argb[1] + ',' + argb[2] + ',' + argb[3] + ',1)';\n\n\t\t\tthis._context.fillRect(rect.x, rect.y, rect.width, rect.height);\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @returns {ImageData}\n\t */\n\tpublic get imageData():ImageData\n\t{\n\t\tif (!this._locked)\n\t\t\treturn this._context.getImageData(0, 0, this._rect.width, this._rect.height);\n\n\t\treturn this._imageData;\n\t}\n\n\t/**\n\t *\n\t * @returns {HTMLCanvasElement}\n\t */\n\tpublic get canvas()\n\t{\n\t\treturn this._imageCanvas;\n\t}\n}\n\nexport = BitmapData;","/**\n * A class that provides constant values for visual blend mode effects. These\n * constants are used in the following:\n * <ul>\n *   <li> The <code>blendMode</code> property of the\n * flash.display.DisplayObject class.</li>\n *   <li> The <code>blendMode</code> parameter of the <code>draw()</code>\n * method of the flash.display.BitmapData class</li>\n * </ul>\n */\nclass BlendMode\n{\n\t/**\n\t * Adds the values of the constituent colors of the display object to the\n\t * colors of its background, applying a ceiling of 0xFF. This setting is\n\t * commonly used for animating a lightening dissolve between two objects.\n\t *\n\t * <p>For example, if the display object has a pixel with an RGB value of\n\t * 0xAAA633, and the background pixel has an RGB value of 0xDD2200, the\n\t * resulting RGB value for the displayed pixel is 0xFFC833(because 0xAA +\n\t * 0xDD > 0xFF, 0xA6 + 0x22 = 0xC8, and 0x33 + 0x00 = 0x33).</p>\n\t */\n\tpublic static ADD:string = \"add\";\n\n\t/**\n\t * Applies the alpha value of each pixel of the display object to the\n\t * background. This requires the <code>blendMode</code> property of the\n\t * parent display object be set to\n\t * <code>away.base.BlendMode.LAYER</code>.\n\t *\n\t * <p>Not supported under GPU rendering.</p>\n\t */\n\tpublic static ALPHA:string = \"alpha\";\n\n\t/**\n\t * Selects the darker of the constituent colors of the display object and the\n\t * colors of the background(the colors with the smaller values). This\n\t * setting is commonly used for superimposing type.\n\t *\n\t * <p>For example, if the display object has a pixel with an RGB value of\n\t * 0xFFCC33, and the background pixel has an RGB value of 0xDDF800, the\n\t * resulting RGB value for the displayed pixel is 0xDDCC00(because 0xFF >\n\t * 0xDD, 0xCC < 0xF8, and 0x33 > 0x00 = 33).</p>\n\t *\n\t * <p>Not supported under GPU rendering.</p>\n\t */\n\tpublic static DARKEN:string = \"darken\";\n\n\t/**\n\t * Compares the constituent colors of the display object with the colors of\n\t * its background, and subtracts the darker of the values of the two\n\t * constituent colors from the lighter value. This setting is commonly used\n\t * for more vibrant colors.\n\t *\n\t * <p>For example, if the display object has a pixel with an RGB value of\n\t * 0xFFCC33, and the background pixel has an RGB value of 0xDDF800, the\n\t * resulting RGB value for the displayed pixel is 0x222C33(because 0xFF -\n\t * 0xDD = 0x22, 0xF8 - 0xCC = 0x2C, and 0x33 - 0x00 = 0x33).</p>\n\t */\n\tpublic static DIFFERENCE:string = \"difference\";\n\n\t/**\n\t * Erases the background based on the alpha value of the display object. This\n\t * process requires that the <code>blendMode</code> property of the parent\n\t * display object be set to <code>flash.display.BlendMode.LAYER</code>.\n\t *\n\t * <p>Not supported under GPU rendering.</p>\n\t */\n\tpublic static ERASE:string = \"erase\";\n\n\t/**\n\t * Adjusts the color of each pixel based on the darkness of the display\n\t * object. If the display object is lighter than 50% gray, the display object\n\t * and background colors are screened, which results in a lighter color. If\n\t * the display object is darker than 50% gray, the colors are multiplied,\n\t * which results in a darker color. This setting is commonly used for shading\n\t * effects.\n\t *\n\t * <p>Not supported under GPU rendering.</p>\n\t */\n\tpublic static HARDLIGHT:string = \"hardlight\";\n\n\t/**\n\t * Inverts the background.\n\t */\n\tpublic static INVERT:string = \"invert\";\n\n\t/**\n\t * Forces the creation of a transparency group for the display object. This\n\t * means that the display object is precomposed in a temporary buffer before\n\t * it is processed further. The precomposition is done automatically if the\n\t * display object is precached by means of bitmap caching or if the display\n\t * object is a display object container that has at least one child object\n\t * with a <code>blendMode</code> setting other than <code>\"normal\"</code>.\n\t *\n\t * <p>Not supported under GPU rendering.</p>\n\t */\n\tpublic static LAYER:string = \"layer\";\n\n\t/**\n\t * Selects the lighter of the constituent colors of the display object and\n\t * the colors of the background(the colors with the larger values). This\n\t * setting is commonly used for superimposing type.\n\t *\n\t * <p>For example, if the display object has a pixel with an RGB value of\n\t * 0xFFCC33, and the background pixel has an RGB value of 0xDDF800, the\n\t * resulting RGB value for the displayed pixel is 0xFFF833(because 0xFF >\n\t * 0xDD, 0xCC < 0xF8, and 0x33 > 0x00 = 33).</p>\n\t *\n\t * <p>Not supported under GPU rendering.</p>\n\t */\n\tpublic static LIGHTEN:string = \"lighten\";\n\n\t/**\n\t * Multiplies the values of the display object constituent colors by the\n\t * constituent colors of the background color, and normalizes by dividing by\n\t * 0xFF, resulting in darker colors. This setting is commonly used for\n\t * shadows and depth effects.\n\t *\n\t * <p>For example, if a constituent color(such as red) of one pixel in the\n\t * display object and the corresponding color of the pixel in the background\n\t * both have the value 0x88, the multiplied result is 0x4840. Dividing by\n\t * 0xFF yields a value of 0x48 for that constituent color, which is a darker\n\t * shade than the color of the display object or the color of the\n\t * background.</p>\n\t */\n\tpublic static MULTIPLY:string = \"multiply\";\n\n\t/**\n\t * The display object appears in front of the background. Pixel values of the\n\t * display object override the pixel values of the background. Where the\n\t * display object is transparent, the background is visible.\n\t */\n\tpublic static NORMAL:string = \"normal\";\n\n\t/**\n\t * Adjusts the color of each pixel based on the darkness of the background.\n\t * If the background is lighter than 50% gray, the display object and\n\t * background colors are screened, which results in a lighter color. If the\n\t * background is darker than 50% gray, the colors are multiplied, which\n\t * results in a darker color. This setting is commonly used for shading\n\t * effects.\n\t *\n\t * <p>Not supported under GPU rendering.</p>\n\t */\n\tpublic static OVERLAY:string = \"overlay\";\n\n\t/**\n\t * Multiplies the complement(inverse) of the display object color by the\n\t * complement of the background color, resulting in a bleaching effect. This\n\t * setting is commonly used for highlights or to remove black areas of the\n\t * display object.\n\t */\n\tpublic static SCREEN:string = \"screen\";\n\n\t/**\n\t * Uses a shader to define the blend between objects.\n\t *\n\t * <p>Setting the <code>blendShader</code> property to a Shader instance\n\t * automatically sets the display object's <code>blendMode</code> property to\n\t * <code>BlendMode.SHADER</code>. If the <code>blendMode</code> property is\n\t * set to <code>BlendMode.SHADER</code> without first setting the\n\t * <code>blendShader</code> property, the <code>blendMode</code> property is\n\t * set to <code>BlendMode.NORMAL</code> instead. If the\n\t * <code>blendShader</code> property is set(which sets the\n\t * <code>blendMode</code> property to <code>BlendMode.SHADER</code>), then\n\t * later the value of the <code>blendMode</code> property is changed, the\n\t * blend mode can be reset to use the blend shader simply by setting the\n\t * <code>blendMode</code> property to <code>BlendMode.SHADER</code>. The\n\t * <code>blendShader</code> property does not need to be set again except to\n\t * change the shader that's used to define the blend mode.</p>\n\t *\n\t * <p>Not supported under GPU rendering.</p>\n\t */\n\tpublic static SHADER:string = \"shader\";\n\n\t/**\n\t * Subtracts the values of the constituent colors in the display object from\n\t * the values of the background color, applying a floor of 0. This setting is\n\t * commonly used for animating a darkening dissolve between two objects.\n\t *\n\t * <p>For example, if the display object has a pixel with an RGB value of\n\t * 0xAA2233, and the background pixel has an RGB value of 0xDDA600, the\n\t * resulting RGB value for the displayed pixel is 0x338400(because 0xDD -\n\t * 0xAA = 0x33, 0xA6 - 0x22 = 0x84, and 0x00 - 0x33 < 0x00).</p>\n\t */\n\tpublic static SUBTRACT:string = \"subtract\";\n}\n\nexport = BlendMode;","import Error\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\n\n/**\n * AbstractMethodError is thrown when an abstract method is called. The method in question should be overridden\n * by a concrete subclass.\n */\nclass AbstractMethodError extends Error\n{\n\t/**\n\t * Create a new AbstractMethodError.\n\t * @param message An optional message to override the default error message.\n\t * @param id The id of the error.\n\t */\n\tconstructor(message:string = null, id:number = 0)\n\t{\n\t\tsuper(message || \"An abstract method was called! Either an instance of an abstract class was created, or an abstract method was not overridden by the subclass.\", id);\n\t}\n}\n\nexport = AbstractMethodError;","import Error\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\n\n/**\n * AbstractMethodError is thrown when an abstract method is called. The method in question should be overridden\n * by a concrete subclass.\n */\nclass ArgumentError extends Error\n{\n\t/**\n\t * Create a new ArgumentError.\n\t *\n\t * @param message An optional message to override the default error message.\n\t * @param id The id of the error.\n\t */\n\tconstructor(message:string = null, id:number = 0)\n\t{\n\t\tsuper(message || \"ArgumentError\", id);\n\t}\n}\n\nexport = ArgumentError;","import Error\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\n\nclass DocumentError extends Error\n{\n\tpublic static DOCUMENT_DOES_NOT_EXIST:string = \"documentDoesNotExist\";\n\n\tconstructor(message:string = \"DocumentError\", id:number = 0)\n\t{\n\t\tsuper(message, id);\n\t}\n}\n\nexport = DocumentError;","class Error\n{\n\n\tprivate _errorID:number = 0;   //Contains the reference number associated with the specific error message.\n\tprivate _messsage:string = '';  //Contains the message associated with the Error object.\n\tprivate _name:string = '';  // Contains the name of the Error object.\n\n\tconstructor(message:string = '', id:number = 0, _name:string = '')\n\t{\n\n\t\tthis._messsage = message;\n\t\tthis._name = name;\n\t\tthis._errorID = id;\n\n\t}\n\n\t/**\n\t *\n\t * @returns {string}\n\t */\n\tpublic get message():string\n\t{\n\n\t\treturn this._messsage;\n\n\t}\n\n\t/**\n\t *\n\t * @param value\n\t */\n\tpublic set message(value:string)\n\t{\n\n\t\tthis._messsage = value;\n\n\t}\n\n\t/**\n\t *\n\t * @returns {string}\n\t */\n\tpublic get name():string\n\t{\n\n\t\treturn this._name;\n\n\t}\n\n\t/**\n\t *\n\t * @param value\n\t */\n\tpublic set name(value:string)\n\t{\n\n\t\tthis._name = value;\n\n\t}\n\n\t/**\n\t *\n\t * @returns {number}\n\t */\n\tpublic get errorID():number\n\t{\n\n\t\treturn this._errorID;\n\n\t}\n\n}\n\nexport = Error;","import Error\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\n\n/**\n * AbstractMethodError is thrown when an abstract method is called. The method in question should be overridden\n * by a concrete subclass.\n */\nclass PartialImplementationError extends Error\n{\n\t/**\n\t * Create a new AbstractMethodError.\n\t * @param message An optional message to override the default error message.\n\t * @param id The id of the error.\n\t */\n\tconstructor(dependency:string = '', id:number = 0)\n\t{\n\t\tsuper(\"PartialImplementationError - this function is in development. Required Dependency: \" + dependency, id);\n\t}\n}\n\nexport = PartialImplementationError;","import Error\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\n\n/**\n * RangeError is thrown when an index is accessed out of range of the number of\n * available indices on an Array.\n */\nclass RangeError extends Error\n{\n\t/**\n\t * Create a new RangeError.\n\t *\n\t * @param message An optional message to override the default error message.\n\t * @param id The id of the error.\n\t */\n\tconstructor(message:string = null, id:number = 0)\n\t{\n\t\tsuper(message || \"RangeError\", id);\n\t}\n}\n\nexport = RangeError;","import IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\n/**\n * @class away.events.AssetEvent\n */\nclass AssetEvent extends Event\n{\n\t/**\n\t *\n\t */\n\tpublic static ASSET_COMPLETE:string = \"assetComplete\";\n\n\t/**\n\t *\n\t */\n\tpublic static ASSET_RENAME:string = 'assetRename';\n\n\t/**\n\t *\n\t */\n\tpublic static ASSET_CONFLICT_RESOLVED:string = 'assetConflictResolved';\n\n\t/**\n\t *\n\t */\n\tpublic static TEXTURE_SIZE_ERROR:string = 'textureSizeError';\n\n\tprivate _asset:IAsset;\n\tprivate _prevName:string;\n\n\t/**\n\t *\n\t */\n\tconstructor(type:string, asset:IAsset = null, prevName:string = null)\n\t{\n\t\tsuper(type);\n\n\t\tthis._asset = asset;\n\t\tthis._prevName = prevName || (this._asset? this._asset.name : null);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get asset():IAsset\n\t{\n\t\treturn this._asset;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get assetPrevName():string\n\t{\n\t\treturn this._prevName;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic clone():Event\n\t{\n\t\treturn <Event> new AssetEvent(this.type, this.asset, this.assetPrevName);\n\t}\n}\n\nexport = AssetEvent;","import Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\n/**\n * Base class for dispatching events\n*\n* @class away.events.EventDispatcher\n*\n*/\nclass EventDispatcher\n{\n\tprivate listeners:Array<Array<Function>> = new Array<Array<Function>>();\n\tprivate target:any;\n\n\tconstructor(target:any = null)\n\t{\n\t\tthis.target = target || this;\n\t}\n\n\t/**\n\t * Add an event listener\n\t * @method addEventListener\n\t * @param {String} Name of event to add a listener for\n\t * @param {Function} Callback function\n\t */\n\tpublic addEventListener(type:string, listener:Function)\n\t{\n\t\tif (this.listeners[ type ] === undefined)\n\t\t\tthis.listeners[ type ] = new Array<Function>();\n\n\t\tif (this.getEventListenerIndex(type, listener) === -1)\n\t\t\tthis.listeners[ type ].push(listener);\n\t}\n\n\t/**\n\t * Remove an event listener\n\t * @method removeEventListener\n\t * @param {String} Name of event to remove a listener for\n\t * @param {Function} Callback function\n\t */\n\tpublic removeEventListener(type:string, listener:Function)\n\t{\n\t\tvar index:number = this.getEventListenerIndex(type, listener);\n\n\t\tif (index !== -1)\n\t\t\tthis.listeners[ type ].splice(index, 1);\n\t}\n\n\t/**\n\t * Dispatch an event\n\t * @method dispatchEvent\n\t * @param {Event} Event to dispatch\n\t */\n\tpublic dispatchEvent(event:Event)\n\t{\n\t\tvar listenerArray:Array<Function> = this.listeners[ event.type ];\n\n\t\tif (listenerArray !== undefined) {\n\t\t\tvar l:number = listenerArray.length;\n\n\t\t\tevent.target = this.target;\n\n\t\t\tfor (var i:number = 0; i < l; i++)\n\t\t\t\tlistenerArray[i](event);\n\t\t}\n\t}\n\n\t/**\n\t * get Event Listener Index in array. Returns -1 if no listener is added\n\t * @method getEventListenerIndex\n\t * @param {String} Name of event to remove a listener for\n\t * @param {Function} Callback function\n\t */\n\tprivate getEventListenerIndex(type:string, listener:Function):number\n\t{\n\t\tif (this.listeners[ type ] !== undefined) {\n\t\t\tvar a:Array<Function> = this.listeners[ type ];\n\t\t\tvar l:number = a.length;\n\n\t\t\tfor (var i:number = 0; i < l; i++)\n\t\t\t\tif (listener == a[i])\n\t\t\t\t\treturn i;\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\t/**\n\t * check if an object has an event listener assigned to it\n\t * @method hasListener\n\t * @param {String} Name of event to remove a listener for\n\t * @param {Function} Callback function\n\t */\n\tpublic hasEventListener(type:string, listener?:Function):boolean\n\t{\n\t\tif (listener != null) {\n\t\t\treturn ( this.getEventListenerIndex(type, listener) !== -1 );\n\t\t} else {\n\t\t\tif (this.listeners[ type ] !== undefined)\n\t\t\t\treturn ( this.listeners[ type ].length > 0 );\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn false;\n\t}\n}\n\nexport = EventDispatcher;","class Event\n{\n\n\tpublic static COMPLETE:string = 'complete';\n\tpublic static OPEN:string = 'open';\n\n\tpublic static ENTER_FRAME:string = 'enterFrame';\n\tpublic static EXIT_FRAME:string = 'exitFrame';\n\n\n\tpublic static RESIZE:string = \"resize\";\n\tpublic static ERROR:string = \"error\";\n\tpublic static CHANGE:string = \"change\";\n\n\t/**\n\t * Type of event\n\t * @property type\n\t * @type String\n\t */\n\tpublic type:string = undefined;\n\n\t/**\n\t * Reference to target object\n\t * @property target\n\t * @type Object\n\t */\n\tpublic target:any = undefined;\n\n\tconstructor(type:string)\n\t{\n\t\tthis.type = type;\n\t}\n\n\t/**\n\t * Clones the current event.\n\t * @return An exact duplicate of the current event.\n\t */\n\tpublic clone():Event\n\t{\n\t\treturn new Event(this.type);\n\t}\n}\n\nexport = Event;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\n/**\n * @class away.events.HTTPStatusEvent\n */\nclass HTTPStatusEvent extends Event\n{\n\n\tpublic static HTTP_STATUS:string = \"httpStatus\";\n\n\tpublic status:number;\n\n\tconstructor(type:string, status:number = null)\n\t{\n\t\tsuper(type);\n\n\t\tthis.status = status;\n\n\t}\n}\n\nexport = HTTPStatusEvent;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nclass IOErrorEvent extends Event\n{\n\n\tpublic static IO_ERROR:string = \"ioError\";\n\n\tconstructor(type:string)\n\t{\n\t\tsuper(type);\n\n\t}\n}\n\nexport = IOErrorEvent;","import IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nclass LoaderEvent extends Event\n{\n\t/**\n\t * Dispatched when a resource and all of its dependencies is retrieved.\n\t */\n\tpublic static RESOURCE_COMPLETE:string = \"resourceComplete\";\n\n\tprivate _url:string;\n\tprivate _content:IAsset;\n\tprivate _assets:IAsset[];\n\n\t/**\n\t * Create a new LoaderEvent object.\n\t *\n\t * @param type The event type.\n\t * @param url The url of the loaded resource.\n\t * @param assets The assets of the loaded resource.\n\t */\n\tconstructor(type:string, url:string = null, content:IAsset = null, assets:Array<IAsset> = null)\n\t{\n\t\tsuper(type);\n\n\t\tthis._url = url;\n\t\tthis._content = content;\n\t\tthis._assets = assets;\n\t}\n\n\t/**\n\t * The content returned if the resource has been loaded inside a <code>Loader</code> object.\n\t */\n\tpublic get content():IAsset\n\t{\n\t\treturn this._content;\n\t}\n\n\t/**\n\t * The url of the loaded resource.\n\t */\n\tpublic get url():string\n\t{\n\t\treturn this._url;\n\t}\n\n\t/**\n\t * The error string on loadError.\n\t */\n\tpublic get assets():IAsset[]\n\t{\n\t\treturn this._assets;\n\t}\n\n\t/**\n\t * Clones the current event.\n\t * @return An exact duplicate of the current event.\n\t */\n\tpublic clone():Event\n\t{\n\t\treturn <Event> new LoaderEvent(this.type, this._url, this._content, this._assets);\n\t}\n}\n\nexport = LoaderEvent;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nclass ParserEvent extends Event\n{\n\tprivate _message:string;\n\n\t/**\n\t * Dispatched when parsing of an asset completed.\n\t */\n\tpublic static PARSE_COMPLETE:string = 'parseComplete';\n\n\t/**\n\t * Dispatched when an error occurs while parsing the data (e.g. because it's\n\t * incorrectly formatted.)\n\t */\n\tpublic static PARSE_ERROR:string = 'parseError';\n\n\n\t/**\n\t * Dispatched when a parser is ready to have dependencies retrieved and resolved.\n\t * This is an internal event that should rarely (if ever) be listened for by\n\t * external classes.\n\t */\n\tpublic static READY_FOR_DEPENDENCIES:string = 'readyForDependencies';\n\n\n\tconstructor(type:string, message:string = '')\n\t{\n\t\tsuper(type);\n\n\t\tthis._message = message;\n\t}\n\n\n\t/**\n\t * Additional human-readable message. Usually supplied for ParserEvent.PARSE_ERROR events.\n\t */\n\tpublic get message():string\n\t{\n\t\treturn this._message;\n\t}\n\n\n\tpublic clone():Event\n\t{\n\t\treturn new ParserEvent(this.type, this.message);\n\t}\n}\n\nexport = ParserEvent;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nclass ProgressEvent extends Event\n{\n\tpublic static PROGRESS:string = \"progress\";\n\n\tpublic bytesLoaded:number;\n\n\tpublic bytesTotal:number;\n\n\tconstructor(type:string)\n\t{\n\t\tsuper(type);\n\t}\n}\n\nexport = ProgressEvent;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\nimport IProjection\t\t\t\t= require(\"awayjs-core/lib/projections/IProjection\");\n\nclass ProjectionEvent extends Event\n{\n\tpublic static MATRIX_CHANGED:string = \"matrixChanged\";\n\n\tprivate _projection:IProjection;\n\n\tconstructor(type:string, projection:IProjection)\n\t{\n\t\tsuper(type);\n\t\tthis._projection = projection;\n\t}\n\n\tpublic get projection():IProjection\n\t{\n\t\treturn this._projection;\n\t}\n}\n\nexport = ProjectionEvent;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nclass TimerEvent extends Event\n{\n\n\tpublic static TIMER:string = \"timer\";\n\tpublic static TIMER_COMPLETE:string = \"timerComplete\";\n\n\tconstructor(type:string)\n\t{\n\t\tsuper(type);\n\n\t}\n}\n\nexport = TimerEvent","import Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\n/**\n * A Box object is an area defined by its position, as indicated by its\n * top-left-front corner point(<i>x</i>, <i>y</i>, <i>z</i>) and by its width,\n * height and depth.\n *\n *\n * <p>The <code>x</code>, <code>y</code>, <code>z</code>, <code>width</code>,\n * <code>height</code> <code>depth</code> properties of the Box class are\n * independent of each other; changing the value of one property has no effect\n * on the others. However, the <code>right</code>, <code>bottom</code> and\n * <code>back</code> properties are integrally related to those six\n * properties. For example, if you change the value of the <code>right</code>\n * property, the value of the <code>width</code> property changes; if you\n * change the <code>bottom</code> property, the value of the\n * <code>height</code> property changes. </p>\n *\n * <p>The following methods and properties use Box objects:</p>\n *\n * <ul>\n *   <li>The <code>bounds</code> property of the DisplayObject class</li>\n * </ul>\n *\n * <p>You can use the <code>new Box()</code> constructor to create a\n * Box object.</p>\n *\n * <p><b>Note:</b> The Box class does not define a cubic Shape\n * display object.\n */\nclass Box\n{\n\tprivate _size:Vector3D;\n\tprivate _bottomRightBack:Vector3D;\n\tprivate _topLeftFront:Vector3D;\n\n\t/**\n\t * The height of the box, in pixels. Changing the <code>height</code> value\n\t * of a Box object has no effect on the <code>x</code>, <code>y</code>,\n\t * <code>z</code>, <code>depth</code> and <code>width</code> properties.\n\t */\n\tpublic height:number;\n\n\t/**\n\t * The width of the box, in pixels. Changing the <code>width</code> value\n\t * of a Box object has no effect on the <code>x</code>, <code>y</code>,\n\t * <code>z</code>, <code>depth</code> and <code>height</code> properties.\n\t */\n\tpublic width:number;\n\n\t/**\n\t * The deoth of the box, in pixels. Changing the <code>depth</code> value\n\t * of a Box object has no effect on the <code>x</code>, <code>y</code>,\n\t * <code>z</code>, <code>width</code> and <code>height</code> properties.\n\t */\n\tpublic depth:number;\n\n\t/**\n\t * The <i>x</i> coordinate of the top-left-front corner of the box.\n\t * Changing the value of the <code>x</code> property of a Box object has no\n\t * effect on the <code>y</code>, <code>z</code>, <code>width</code>,\n\t * <code>height</code> and <code>depth</code> properties.\n\t *\n\t * <p>The value of the <code>x</code> property is equal to the value of the\n\t * <code>left</code> property.</p>\n\t */\n\tpublic x:number;\n\n\t/**\n\t * The <i>y</i> coordinate of the top-left-front corner of the box.\n\t * Changing the value of the <code>y</code> property of a Box object has no\n\t * effect on the <code>x</code>, <code>z</code>, <code>width</code>,\n\t * <code>height</code> and <code>depth</code> properties.\n\t *\n\t * <p>The value of the <code>y</code> property is equal to the value of the\n\t * <code>top</code> property.</p>\n\t */\n\tpublic y:number;\n\n\t/**\n\t * The <i>y</i> coordinate of the top-left-front corner of the box.\n\t * Changing the value of the <code>z</code> property of a Box object has no\n\t * effect on the <code>x</code>, <code>y</code>, <code>width</code>,\n\t * <code>height</code> and <code>depth</code> properties.\n\t *\n\t * <p>The value of the <code>z</code> property is equal to the value of the\n\t * <code>front</code> property.</p>\n\t */\n\tpublic z:number\n\n\t/**\n\t * The sum of the <code>z</code> and <code>height</code> properties.\n\t */\n\tpublic get back():number\n\t{\n\t\treturn this.z + this.depth;\n\t}\n\n\tpublic set back(val:number)\n\t{\n\t\tthis.depth = val - this.z;\n\t}\n\n\t/**\n\t * The sum of the <code>y</code> and <code>height</code> properties.\n\t */\n\tpublic get bottom():number\n\t{\n\t\treturn this.y + this.height;\n\t}\n\n\tpublic set bottom(val:number)\n\t{\n\t\tthis.height = val - this.y;\n\t}\n\n\t/**\n\t * The location of the Box object's bottom-right corner, determined by the\n\t * values of the <code>right</code> and <code>bottom</code> properties.\n\t */\n\tpublic get bottomRightBack():Vector3D\n\t{\n\t\tif (this._bottomRightBack == null)\n\t\t\tthis._bottomRightBack = new Vector3D();\n\n\t\tthis._bottomRightBack.x = this.x + this.width;\n\t\tthis._bottomRightBack.y = this.y + this.height;\n\t\tthis._bottomRightBack.z = this.z + this.depth;\n\n\t\treturn this._bottomRightBack;\n\t}\n\n\t/**\n\t * The <i>z</i> coordinate of the top-left-front corner of the box. Changing\n\t * the <code>front</code> property of a Box object has no effect on the\n\t * <code>x</code>, <code>y</code>, <code>width</code> and <code>height</code>\n\t * properties. However it does affect the <code>depth</code> property,\n\t * whereas changing the <code>z</code> value does <i>not</i> affect the\n\t * <code>depth</code> property.\n\t *\n\t * <p>The value of the <code>left</code> property is equal to the value of\n\t * the <code>x</code> property.</p>\n\t */\n\tpublic get front():number\n\t{\n\t\treturn this.z;\n\t}\n\n\tpublic set front(val:number)\n\t{\n\t\tthis.depth += this.z - val;\n\t\tthis.z = val;\n\t}\n\n\t/**\n\t * The <i>x</i> coordinate of the top-left corner of the box. Changing the\n\t * <code>left</code> property of a Box object has no effect on the\n\t * <code>y</code> and <code>height</code> properties. However it does affect\n\t * the <code>width</code> property, whereas changing the <code>x</code> value\n\t * does <i>not</i> affect the <code>width</code> property.\n\t *\n\t * <p>The value of the <code>left</code> property is equal to the value of\n\t * the <code>x</code> property.</p>\n\t */\n\tpublic get left():number\n\t{\n\t\treturn this.x;\n\t}\n\n\tpublic set left(val:number)\n\t{\n\t\tthis.width += this.x - val;\n\t\tthis.x = val;\n\t}\n\n\t/**\n\t * The sum of the <code>x</code> and <code>width</code> properties.\n\t */\n\tpublic get right():number\n\t{\n\t\treturn this.x + this.width;\n\t}\n\n\tpublic set right(val:number)\n\t{\n\t\tthis.width = val - this.x;\n\t}\n\n\t/**\n\t * The size of the Box object, expressed as a Vector3D object with the\n\t * values of the <code>width</code>, <code>height</code> and\n\t * <code>depth</code> properties.\n\t */\n\tpublic get size():Vector3D\n\t{\n\t\tif (this._size == null)\n\t\t\tthis._size = new Vector3D();\n\n\t\tthis._size.x = this.width;\n\t\tthis._size.y = this.height;\n\t\tthis._size.z = this.depth;\n\n\t\treturn this._size;\n\t}\n\n\t/**\n\t * The <i>y</i> coordinate of the top-left-front corner of the box. Changing\n\t * the <code>top</code> property of a Box object has no effect on the\n\t * <code>x</code> and <code>width</code> properties. However it does affect\n\t * the <code>height</code> property, whereas changing the <code>y</code>\n\t * value does <i>not</i> affect the <code>height</code> property.\n\t *\n\t * <p>The value of the <code>top</code> property is equal to the value of the\n\t * <code>y</code> property.</p>\n\t */\n\tpublic get top():number\n\t{\n\t\treturn this.y;\n\t}\n\n\tpublic set top(val:number)\n\t{\n\t\tthis.height += (this.y - val);\n\t\tthis.y = val;\n\t}\n\n\t/**\n\t * The location of the Box object's top-left-front corner, determined by the\n\t * <i>x</i>, <i>y</i> and <i>z</i> coordinates of the point.\n\t */\n\tpublic get topLeftFront():Vector3D\n\t{\n\t\tif (this._topLeftFront == null)\n\t\t\tthis._topLeftFront = new Vector3D();\n\n\t\tthis._topLeftFront.x = this.x;\n\t\tthis._topLeftFront.y = this.y;\n\t\tthis._topLeftFront.z = this.z;\n\n\t\treturn this._topLeftFront;\n\t}\n\n\t/**\n\t * Creates a new Box object with the top-left-front corner specified by the\n\t * <code>x</code>, <code>y</code> and <code>z</code> parameters and with the\n\t * specified <code>width</code>, <code>height</code> and <code>depth</code>\n\t * parameters. If you call this public without parameters, a box with\n\t * <code>x</code>, <code>y</code>, <code>z</code>, <code>width</code>,\n\t * <code>height</code> and <code>depth</code> properties set to 0 is created.\n\t *\n\t * @param x      The <i>x</i> coordinate of the top-left-front corner of the\n\t *               box.\n\t * @param y      The <i>y</i> coordinate of the top-left-front corner of the\n\t *               box.\n\t * @param z      The <i>z</i> coordinate of the top-left-front corner of the\n\t *               box.\n\t * @param width  The width of the box, in pixels.\n\t * @param height The height of the box, in pixels.\n\t * @param depth The depth of the box, in pixels.\n\t */\n\tconstructor(x:number = 0, y:number = 0, z:number = 0, width:number = 0, height:number = 0, depth:number = 0)\n\t{\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.depth = depth;\n\t}\n\n\t/**\n\t * Returns a new Box object with the same values for the <code>x</code>,\n\t * <code>y</code>, <code>z</code>, <code>width</code>, <code>height</code>\n\t * and <code>depth</code> properties as the original Box object.\n\t *\n\t * @return A new Box object with the same values for the <code>x</code>,\n\t *         <code>y</code>, <code>z</code>, <code>width</code>,\n\t *         <code>height</code> and <code>depth</code> properties as the\n\t *         original Box object.\n\t */\n\tpublic clone():Box\n\t{\n\t\treturn new Box(this.x, this.y, this.z, this.width, this.height, this.depth);\n\t}\n\n\t/**\n\t * Determines whether the specified position is contained within the cubic\n\t * region defined by this Box object.\n\t *\n\t * @param x The <i>x</i> coordinate(horizontal component) of the position.\n\t * @param y The <i>y</i> coordinate(vertical component) of the position.\n\t * @param z The <i>z</i> coordinate(longitudinal component) of the position.\n\t * @return A value of <code>true</code> if the Box object contains the\n\t *         specified position; otherwise <code>false</code>.\n\t */\n\tpublic contains(x:number, y:number, z:number):boolean\n\t{\n\t\treturn (this.x <= x && this.x + this.width >= x && this.y <= y && this.y + this.height >= y && this.z <= z && this.z + this.depth >= z);\n\t}\n\n\t/**\n\t * Determines whether the specified position is contained within the cubic\n\t * region defined by this Box object. This method is similar to the\n\t * <code>Box.contains()</code> method, except that it takes a Vector3D\n\t * object as a parameter.\n\t *\n\t * @param position The position, as represented by its <i>x</i>, <i>y</i> and\n\t *                 <i>z</i> coordinates.\n\t * @return A value of <code>true</code> if the Box object contains the\n\t *         specified position; otherwise <code>false</code>.\n\t */\n\tpublic containsPoint(position:Vector3D):boolean\n\t{\n\t\treturn (this.x <= position.x && this.x + this.width >= position.x && this.y <= position.y && this.y + this.height >= position.y && this.z <= position.z && this.z + this.depth >= position.z);\n\t}\n\n\t/**\n\t * Determines whether the Box object specified by the <code>box</code>\n\t * parameter is contained within this Box object. A Box object is said to\n\t * contain another if the second Box object falls entirely within the\n\t * boundaries of the first.\n\t *\n\t * @param box The Box object being checked.\n\t * @return A value of <code>true</code> if the Box object that you specify\n\t *         is contained by this Box object; otherwise <code>false</code>.\n\t */\n\tpublic containsBox(box:Box):boolean\n\t{\n\t\treturn (this.x <= box.x && this.x + this.width >= box.x + box.width && this.y <= box.y && this.y + this.height >= box.y + box.height && this.z <= box.z && this.z + this.depth >= box.z + box.depth)\n\t}\n\n\t/**\n\t * Copies all of box data from the source Box object into the calling\n\t * Box object.\n\t *\n\t * @param sourceBox The Box object from which to copy the data.\n\t */\n\tpublic copyFrom(sourceBox:Box)\n\t{\n\t\tthis.x = sourceBox.x;\n\t\tthis.y = sourceBox.y;\n\t\tthis.z = sourceBox.z;\n\t\tthis.width = sourceBox.width;\n\t\tthis.height = sourceBox.height;\n\t\tthis.depth = sourceBox.depth;\n\t}\n\n\t/**\n\t * Determines whether the object specified in the <code>toCompare</code>\n\t * parameter is equal to this Box object. This method compares the\n\t * <code>x</code>, <code>y</code>, <code>z</code>, <code>width</code>,\n\t * <code>height</code> and <code>depth</code> properties of an object against\n\t * the same properties of this Box object.\n\t *\n\t * @param toCompare The box to compare to this Box object.\n\t * @return A value of <code>true</code> if the object has exactly the same\n\t *         values for the <code>x</code>, <code>y</code>, <code>z</code>,\n\t *         <code>width</code>, <code>height</code> and <code>depth</code>\n\t *         properties as this Box object; otherwise <code>false</code>.\n\t */\n\tpublic equals(toCompare:Box):boolean\n\t{\n\t\treturn (this.x == toCompare.x && this.y == toCompare.y && this.z == toCompare.z && this.width == toCompare.width && this.height == toCompare.height && this.depth == toCompare.depth)\n\t}\n\n\t/**\n\t * Increases the size of the Box object by the specified amounts, in\n\t * pixels. The center point of the Box object stays the same, and its\n\t * size increases to the left and right by the <code>dx</code> value, to\n\t * the top and the bottom by the <code>dy</code> value, and to\n\t * the front and the back by the <code>dz</code> value.\n\t *\n\t * @param dx The value to be added to the left and the right of the Box\n\t *           object. The following equation is used to calculate the new\n\t *           width and position of the box:\n\t * @param dy The value to be added to the top and the bottom of the Box\n\t *           object. The following equation is used to calculate the new\n\t *           height and position of the box:\n\t * @param dz The value to be added to the front and the back of the Box\n\t *           object. The following equation is used to calculate the new\n\t *           depth and position of the box:\n\t */\n\tpublic inflate(dx:number, dy:number, dz:number)\n\t{\n\t\tthis.x -= dx/2;\n\t\tthis.y -= dy/2;\n\t\tthis.z -= dz/2;\n\t\tthis.width += dx/2;\n\t\tthis.height += dy/2;\n\t\tthis.depth += dz/2;\n\t}\n\n\t/**\n\t * Increases the size of the Box object. This method is similar to the\n\t * <code>Box.inflate()</code> method except it takes a Vector3D object as\n\t * a parameter.\n\t *\n\t * <p>The following two code examples give the same result:</p>\n\t *\n\t * @param delta The <code>x</code> property of this Vector3D object is used to\n\t *              increase the horizontal dimension of the Box object.\n\t *              The <code>y</code> property is used to increase the vertical\n\t *              dimension of the Box object.\n\t *              The <code>z</code> property is used to increase the\n\t *              longitudinal dimension of the Box object.\n\t */\n\tpublic inflatePoint(delta:Vector3D)\n\t{\n\t\tthis.x -= delta.x/2;\n\t\tthis.y -= delta.y/2;\n\t\tthis.z -= delta.z/2;\n\t\tthis.width += delta.x/2;\n\t\tthis.height += delta.y/2;\n\t\tthis.depth += delta.z/2;\n\t}\n\n\t/**\n\t * If the Box object specified in the <code>toIntersect</code> parameter\n\t * intersects with this Box object, returns the area of intersection\n\t * as a Box object. If the boxes do not intersect, this method returns an\n\t * empty Box object with its properties set to 0.\n\t *\n\t * @param toIntersect The Box object to compare against to see if it\n\t *                    intersects with this Box object.\n\t * @return A Box object that equals the area of intersection. If the\n\t *         boxes do not intersect, this method returns an empty Box\n\t *         object; that is, a box with its <code>x</code>, <code>y</code>,\n\t *         <code>z</code>, <code>width</code>,  <code>height</code>, and\n\t *         <code>depth</code> properties set to 0.\n\t */\n\tpublic intersection(toIntersect:Box):Box\n\t{\n\t\tif (this.intersects(toIntersect)) {\n\t\t\tvar i:Box = new Box();\n\n\t\t\tif (this.x > toIntersect.x) {\n\t\t\t\ti.x = this.x;\n\t\t\t\ti.width = toIntersect.x - this.x + toIntersect.width;\n\n\t\t\t\tif (i.width > this.width)\n\t\t\t\t\ti.width = this.width;\n\t\t\t} else {\n\t\t\t\ti.x = toIntersect.x;\n\t\t\t\ti.width = this.x - toIntersect.x + this.width;\n\n\t\t\t\tif (i.width > toIntersect.width)\n\t\t\t\t\ti.width = toIntersect.width;\n\t\t\t}\n\n\t\t\tif (this.y > toIntersect.y) {\n\t\t\t\ti.y = this.y;\n\t\t\t\ti.height = toIntersect.y - this.y + toIntersect.height;\n\n\t\t\t\tif (i.height > this.height)\n\t\t\t\t\ti.height = this.height;\n\t\t\t} else {\n\t\t\t\ti.y = toIntersect.y;\n\t\t\t\ti.height = this.y - toIntersect.y + this.height;\n\n\t\t\t\tif (i.height > toIntersect.height)\n\t\t\t\t\ti.height = toIntersect.height;\n\t\t\t}\n\n\n\t\t\tif (this.z > toIntersect.z) {\n\t\t\t\ti.z = this.z;\n\t\t\t\ti.depth = toIntersect.z - this.z + toIntersect.depth;\n\n\t\t\t\tif (i.depth > this.depth)\n\t\t\t\t\ti.depth = this.depth;\n\t\t\t} else {\n\t\t\t\ti.z = toIntersect.z;\n\t\t\t\ti.depth = this.z - toIntersect.z + this.depth;\n\n\t\t\t\tif (i.depth > toIntersect.depth)\n\t\t\t\t\ti.depth = toIntersect.depth;\n\t\t\t}\n\n\t\t\treturn i;\n\t\t}\n\n\t\treturn new Box();\n\t}\n\n\t/**\n\t * Determines whether the object specified in the <code>toIntersect</code>\n\t * parameter intersects with this Box object. This method checks the\n\t * <code>x</code>, <code>y</code>, <code>z</code>, <code>width</code>,\n\t * <code>height</code>, and <code>depth</code> properties of the specified\n\t * Box object to see if it intersects with this Box object.\n\t *\n\t * @param toIntersect The Box object to compare against this Box object.\n\t * @return A value of <code>true</code> if the specified object intersects\n\t *         with this Box object; otherwise <code>false</code>.\n\t */\n\tpublic intersects(toIntersect:Box):boolean\n\t{\n\t\treturn (this.x + this.width > toIntersect.x && this.x < toIntersect.x + toIntersect.width && this.y + this.height > toIntersect.y && this.y < toIntersect.y + toIntersect.height && this.z + this.depth > toIntersect.z && this.z < toIntersect.z + toIntersect.depth);\n\t}\n\n\tpublic rayIntersection(position:Vector3D, direction:Vector3D, targetNormal:Vector3D):number\n\t{\n\t\tif (this.containsPoint(position))\n\t\t\treturn 0;\n\n\t\tvar halfExtentsX:number = this.width/2;\n\t\tvar halfExtentsY:number = this.height/2;\n\t\tvar halfExtentsZ:number = this.depth/2;\n\n\t\tvar centerX:number = this.x + halfExtentsX;\n\t\tvar centerY:number = this.y + halfExtentsY;\n\t\tvar centerZ:number = this.z + halfExtentsZ;\n\n\t\tvar px:number = position.x - centerX;\n\t\tvar py:number = position.y - centerY;\n\t\tvar pz:number = position.z - centerZ;\n\n\t\tvar vx:number = direction.x\n\t\tvar vy:number = direction.y\n\t\tvar vz:number = direction.z;\n\n\t\tvar ix:number;\n\t\tvar iy:number;\n\t\tvar iz:number;\n\t\tvar rayEntryDistance:number;\n\n\t\t// ray-plane tests\n\t\tvar intersects:boolean;\n\t\tif (vx < 0) {\n\t\t\trayEntryDistance = ( halfExtentsX - px )/vx;\n\t\t\tif (rayEntryDistance > 0) {\n\t\t\t\tiy = py + rayEntryDistance*vy;\n\t\t\t\tiz = pz + rayEntryDistance*vz;\n\t\t\t\tif (iy > -halfExtentsY && iy < halfExtentsY && iz > -halfExtentsZ && iz < halfExtentsZ) {\n\t\t\t\t\ttargetNormal.x = 1;\n\t\t\t\t\ttargetNormal.y = 0;\n\t\t\t\t\ttargetNormal.z = 0;\n\n\t\t\t\t\tintersects = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!intersects && vx > 0) {\n\t\t\trayEntryDistance = ( -halfExtentsX - px )/vx;\n\t\t\tif (rayEntryDistance > 0) {\n\t\t\t\tiy = py + rayEntryDistance*vy;\n\t\t\t\tiz = pz + rayEntryDistance*vz;\n\t\t\t\tif (iy > -halfExtentsY && iy < halfExtentsY && iz > -halfExtentsZ && iz < halfExtentsZ) {\n\t\t\t\t\ttargetNormal.x = -1;\n\t\t\t\t\ttargetNormal.y = 0;\n\t\t\t\t\ttargetNormal.z = 0;\n\t\t\t\t\tintersects = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!intersects && vy < 0) {\n\t\t\trayEntryDistance = ( halfExtentsY - py )/vy;\n\t\t\tif (rayEntryDistance > 0) {\n\t\t\t\tix = px + rayEntryDistance*vx;\n\t\t\t\tiz = pz + rayEntryDistance*vz;\n\t\t\t\tif (ix > -halfExtentsX && ix < halfExtentsX && iz > -halfExtentsZ && iz < halfExtentsZ) {\n\t\t\t\t\ttargetNormal.x = 0;\n\t\t\t\t\ttargetNormal.y = 1;\n\t\t\t\t\ttargetNormal.z = 0;\n\t\t\t\t\tintersects = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!intersects && vy > 0) {\n\t\t\trayEntryDistance = ( -halfExtentsY - py )/vy;\n\t\t\tif (rayEntryDistance > 0) {\n\t\t\t\tix = px + rayEntryDistance*vx;\n\t\t\t\tiz = pz + rayEntryDistance*vz;\n\t\t\t\tif (ix > -halfExtentsX && ix < halfExtentsX && iz > -halfExtentsZ && iz < halfExtentsZ) {\n\t\t\t\t\ttargetNormal.x = 0;\n\t\t\t\t\ttargetNormal.y = -1;\n\t\t\t\t\ttargetNormal.z = 0;\n\t\t\t\t\tintersects = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!intersects && vz < 0) {\n\t\t\trayEntryDistance = ( halfExtentsZ - pz )/vz;\n\t\t\tif (rayEntryDistance > 0) {\n\t\t\t\tix = px + rayEntryDistance*vx;\n\t\t\t\tiy = py + rayEntryDistance*vy;\n\t\t\t\tif (iy > -halfExtentsY && iy < halfExtentsY && ix > -halfExtentsX && ix < halfExtentsX) {\n\t\t\t\t\ttargetNormal.x = 0;\n\t\t\t\t\ttargetNormal.y = 0;\n\t\t\t\t\ttargetNormal.z = 1;\n\t\t\t\t\tintersects = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!intersects && vz > 0) {\n\t\t\trayEntryDistance = ( -halfExtentsZ - pz )/vz;\n\t\t\tif (rayEntryDistance > 0) {\n\t\t\t\tix = px + rayEntryDistance*vx;\n\t\t\t\tiy = py + rayEntryDistance*vy;\n\t\t\t\tif (iy > -halfExtentsY && iy < halfExtentsY && ix > -halfExtentsX && ix < halfExtentsX) {\n\t\t\t\t\ttargetNormal.x = 0;\n\t\t\t\t\ttargetNormal.y = 0;\n\t\t\t\t\ttargetNormal.z = -1;\n\t\t\t\t\tintersects = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn intersects? rayEntryDistance : -1;\n\t}\n\n\t/**\n\t * Finds the closest point on the Box to another given point. This can be used for maximum error calculations for content within a given Box.\n\t *\n\t * @param point The point for which to find the closest point on the Box\n\t * @param target An optional Vector3D to store the result to prevent creating a new object.\n\t * @return\n\t */\n\tpublic closestPointToPoint(point:Vector3D, target:Vector3D = null):Vector3D\n\t{\n\t\tvar p:number;\n\n\t\tif (target == null)\n\t\t\ttarget = new Vector3D();\n\n\t\tp = point.x;\n\t\tif (p < this.x)\n\t\t\tp = this.x;\n\t\tif (p > this.x + this.width)\n\t\t\tp = this.x + this.width;\n\t\ttarget.x = p;\n\n\t\tp = point.y;\n\t\tif (p < this.y + this.height)\n\t\t\tp = this.y + this.height;\n\t\tif (p > this.y)\n\t\t\tp = this.y;\n\t\ttarget.y = p;\n\n\t\tp = point.z;\n\t\tif (p < this.z)\n\t\t\tp = this.z;\n\t\tif (p > this.z + this.depth)\n\t\t\tp = this.z + this.depth;\n\t\ttarget.z = p;\n\n\t\treturn target;\n\t}\n\n\t/**\n\t * Determines whether or not this Box object is empty.\n\t *\n\t * @return A value of <code>true</code> if the Box object's width, height or\n\t *         depth is less than or equal to 0; otherwise <code>false</code>.\n\t */\n\tpublic isEmpty():boolean\n\t{\n\t\treturn (this.x == 0 && this.y == 0 && this.z == 0 && this.width == 0 && this.height == 0 && this.depth == 0);\n\t}\n\n\t/**\n\t * Adjusts the location of the Box object, as determined by its\n\t * top-left-front corner, by the specified amounts.\n\t *\n\t * @param dx Moves the <i>x</i> value of the Box object by this amount.\n\t * @param dy Moves the <i>y</i> value of the Box object by this amount.\n\t * @param dz Moves the <i>z</i> value of the Box object by this amount.\n\t */\n\tpublic offset(dx:number, dy:number, dz:number)\n\t{\n\t\tthis.x += dx;\n\t\tthis.y += dy;\n\t\tthis.z += dz;\n\t}\n\n\t/**\n\t * Adjusts the location of the Box object using a Vector3D object as a\n\t * parameter. This method is similar to the <code>Box.offset()</code>\n\t * method, except that it takes a Vector3D object as a parameter.\n\t *\n\t * @param position A Vector3D object to use to offset this Box object.\n\t */\n\tpublic offsetPosition(position:Vector3D)\n\t{\n\t\tthis.x += position.x;\n\t\tthis.y += position.y;\n\t\tthis.z += position.z;\n\t}\n\n\t/**\n\t * Sets all of the Box object's properties to 0. A Box object is empty if its\n\t * width, height or depth is less than or equal to 0.\n\t *\n\t * <p> This method sets the values of the <code>x</code>, <code>y</code>,\n\t * <code>z</code>, <code>width</code>, <code>height</code>, and\n\t * <code>depth</code> properties to 0.</p>\n\t *\n\t */\n\tpublic setEmpty()\n\t{\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\t\tthis.z = 0;\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t\tthis.depth = 0;\n\t}\n\n\t/**\n\t * Sets the members of Box to the specified values\n\t *\n\t * @param xa      The <i>x</i> coordinate of the top-left-front corner of the\n\t *                box.\n\t * @param ya      The <i>y</i> coordinate of the top-left-front corner of the\n\t *                box.\n\t * @param yz      The <i>z</i> coordinate of the top-left-front corner of the\n\t *                box.\n\t * @param widtha  The width of the box, in pixels.\n\t * @param heighta The height of the box, in pixels.\n\t * @param deptha  The depth of the box, in pixels.\n\t */\n\tpublic setTo(xa:number, ya:number, za:number, widtha:number, heighta:number, deptha:number)\n\t{\n\t\tthis.x = xa;\n\t\tthis.y = ya;\n\t\tthis.z = za;\n\t\tthis.width = widtha;\n\t\tthis.height = heighta;\n\t\tthis.depth = deptha;\n\t}\n\n\t/**\n\t * Builds and returns a string that lists the horizontal, vertical and\n\t * longitudinal positions and the width, height and depth of the Box object.\n\t *\n\t * @return A string listing the value of each of the following properties of\n\t *         the Box object: <code>x</code>, <code>y</code>, <code>z</code>,\n\t *         <code>width</code>, <code>height</code>, and <code>depth</code>.\n\t */\n\tpublic toString():string\n\t{\n\t\treturn \"[Box] (x=\" + this.x + \", y=\" + this.y + \", z=\" + this.z + \", width=\" + this.width + \", height=\" + this.height + \", depth=\" + this.depth + \")\";\n\t}\n\n\t/**\n\t * Adds two boxes together to create a new Box object, by filling\n\t * in the horizontal, vertical and longitudinal space between the two boxes.\n\t *\n\t * <p><b>Note:</b> The <code>union()</code> method ignores boxes with\n\t * <code>0</code> as the height, width or depth value, such as: <code>var\n\t * box2:Box = new Box(300,300,300,50,50,0);</code></p>\n\t *\n\t * @param toUnion A Box object to add to this Box object.\n\t * @return A new Box object that is the union of the two boxes.\n\t */\n\tpublic union(toUnion:Box):Box\n\t{\n\t\tvar u:Box = new Box();\n\n\t\tif (this.x < toUnion.x) {\n\t\t\tu.x = this.x;\n\t\t\tu.width = toUnion.x - this.x + toUnion.width;\n\n\t\t\tif (u.width < this.width)\n\t\t\t\tu.width = this.width;\n\t\t} else {\n\t\t\tu.x = toUnion.x;\n\t\t\tu.width = this.x - toUnion.x + this.width;\n\n\t\t\tif (u.width < toUnion.width)\n\t\t\t\tu.width = toUnion.width;\n\t\t}\n\n\t\tif (this.y < toUnion.y) {\n\t\t\tu.y = this.y;\n\t\t\tu.height = toUnion.y - this.y + toUnion.height;\n\n\t\t\tif (u.height < this.height)\n\t\t\t\tu.height = this.height;\n\t\t} else {\n\t\t\tu.y = toUnion.y;\n\t\t\tu.height = this.y - toUnion.y + this.height;\n\n\t\t\tif (u.height < toUnion.height)\n\t\t\t\tu.height = toUnion.height;\n\t\t}\n\n\t\tif (this.z < toUnion.z) {\n\t\t\tu.z = this.z;\n\t\t\tu.depth = toUnion.z - this.z + toUnion.depth;\n\n\t\t\tif (u.depth < this.depth)\n\t\t\t\tu.depth = this.depth;\n\t\t} else {\n\t\t\tu.z = toUnion.z;\n\t\t\tu.depth = this.z - toUnion.z + this.depth;\n\n\t\t\tif (u.depth < toUnion.depth)\n\t\t\t\tu.depth = toUnion.depth;\n\t\t}\n\n\t\treturn u;\n\t}\n}\n\nexport = Box;","import ColorUtils\t\t\t\t= require(\"awayjs-core/lib/utils/ColorUtils\");\n\n/**\n * The ColorTransform class lets you adjust the color values in a display\n * object. The color adjustment or <i>color transformation</i> can be applied\n * to all four channels: red, green, blue, and alpha transparency.\n *\n * <p>When a ColorTransform object is applied to a display object, a new value\n * for each color channel is calculated like this:</p>\n *\n * <ul>\n *   <li>New red value = (old red value * <code>redMultiplier</code>) +\n * <code>redOffset</code></li>\n *   <li>New green value = (old green value * <code>greenMultiplier</code>) +\n * <code>greenOffset</code></li>\n *   <li>New blue value = (old blue value * <code>blueMultiplier</code>) +\n * <code>blueOffset</code></li>\n *   <li>New alpha value = (old alpha value * <code>alphaMultiplier</code>) +\n * <code>alphaOffset</code></li>\n * </ul>\n *\n * <p>If any of the color channel values is greater than 255 after the\n * calculation, it is set to 255. If it is less than 0, it is set to 0.</p>\n *\n * <p>You can use ColorTransform objects in the following ways:</p>\n *\n * <ul>\n *   <li>In the <code>colorTransform</code> parameter of the\n * <code>colorTransform()</code> method of the BitmapData class</li>\n *   <li>As the <code>colorTransform</code> property of a Transform object\n * (which can be used as the <code>transform</code> property of a display\n * object)</li>\n * </ul>\n *\n * <p>You must use the <code>new ColorTransform()</code> constructor to create\n * a ColorTransform object before you can call the methods of the\n * ColorTransform object.</p>\n *\n * <p>Color transformations do not apply to the background color of a movie\n * clip(such as a loaded SWF object). They apply only to graphics and symbols\n * that are attached to the movie clip.</p>\n */\nclass ColorTransform\n{\n\t/**\n\t * A decimal value that is multiplied with the alpha transparency channel\n\t * value.\n\t *\n\t * <p>If you set the alpha transparency value of a display object directly by\n\t * using the <code>alpha</code> property of the DisplayObject instance, it\n\t * affects the value of the <code>alphaMultiplier</code> property of that\n\t * display object's <code>transform.colorTransform</code> property.</p>\n\t */\n\tpublic alphaMultiplier:number;\n\n\t/**\n\t * A number from -255 to 255 that is added to the alpha transparency channel\n\t * value after it has been multiplied by the <code>alphaMultiplier</code>\n\t * value.\n\t */\n\tpublic alphaOffset:number;\n\n\t/**\n\t * A decimal value that is multiplied with the blue channel value.\n\t */\n\tpublic blueMultiplier:number;\n\n\t/**\n\t * A number from -255 to 255 that is added to the blue channel value after it\n\t * has been multiplied by the <code>blueMultiplier</code> value.\n\t */\n\tpublic blueOffset:number;\n\n\t/**\n\t * A decimal value that is multiplied with the green channel value.\n\t */\n\tpublic greenMultiplier:number;\n\n\t/**\n\t * A number from -255 to 255 that is added to the green channel value after\n\t * it has been multiplied by the <code>greenMultiplier</code> value.\n\t */\n\tpublic greenOffset:number;\n\n\t/**\n\t * A decimal value that is multiplied with the red channel value.\n\t */\n\tpublic redMultiplier:number;\n\n\t/**\n\t * A number from -255 to 255 that is added to the red channel value after it\n\t * has been multiplied by the <code>redMultiplier</code> value.\n\t */\n\tpublic redOffset:number;\n\n\t/**\n\t * The RGB color value for a ColorTransform object.\n\t *\n\t * <p>When you set this property, it changes the three color offset values\n\t * (<code>redOffset</code>, <code>greenOffset</code>, and\n\t * <code>blueOffset</code>) accordingly, and it sets the three color\n\t * multiplier values(<code>redMultiplier</code>,\n\t * <code>greenMultiplier</code>, and <code>blueMultiplier</code>) to 0. The\n\t * alpha transparency multiplier and offset values do not change.</p>\n\t *\n\t * <p>When you pass a value for this property, use the format\n\t * 0x<i>RRGGBB</i>. <i>RR</i>, <i>GG</i>, and <i>BB</i> each consist of two\n\t * hexadecimal digits that specify the offset of each color component. The 0x\n\t * tells the ActionScript compiler that the number is a hexadecimal\n\t * value.</p>\n\t */\n\tpublic get color():number\n\t{\n\t\treturn((this.redOffset << 16) | ( this.greenOffset << 8) | this.blueOffset);\n\t}\n\n\tpublic set color(value:number)\n\t{\n\t\tvar argb:number[] = ColorUtils.float32ColorToARGB(value);\n\n\t\tthis.redOffset = argb[1];  //(value >> 16) & 0xFF;\n\t\tthis.greenOffset = argb[2];  //(value >> 8) & 0xFF;\n\t\tthis.blueOffset = argb[3];  //value & 0xFF;\n\n\t\tthis.redMultiplier = 0;\n\t\tthis.greenMultiplier = 0;\n\t\tthis.blueMultiplier = 0;\n\t}\n\n\t/**\n\t * Creates a ColorTransform object for a display object with the specified\n\t * color channel values and alpha values.\n\t *\n\t * @param redMultiplier   The value for the red multiplier, in the range from\n\t *                        0 to 1.\n\t * @param greenMultiplier The value for the green multiplier, in the range\n\t *                        from 0 to 1.\n\t * @param blueMultiplier  The value for the blue multiplier, in the range\n\t *                        from 0 to 1.\n\t * @param alphaMultiplier The value for the alpha transparency multiplier, in\n\t *                        the range from 0 to 1.\n\t * @param redOffset       The offset value for the red color channel, in the\n\t *                        range from -255 to 255.\n\t * @param greenOffset     The offset value for the green color channel, in\n\t *                        the range from -255 to 255.\n\t * @param blueOffset      The offset for the blue color channel value, in the\n\t *                        range from -255 to 255.\n\t * @param alphaOffset     The offset for alpha transparency channel value, in\n\t *                        the range from -255 to 255.\n\t */\n\tconstructor(redMultiplier:number = 1, greenMultiplier:number = 1, blueMultiplier:number = 1, alphaMultiplier:number = 1, redOffset:number = 0, greenOffset:number = 0, blueOffset:number = 0, alphaOffset:number = 0)\n\t{\n\t\tthis.redMultiplier = redMultiplier;\n\t\tthis.greenMultiplier = greenMultiplier;\n\t\tthis.blueMultiplier = blueMultiplier;\n\t\tthis.alphaMultiplier = alphaMultiplier;\n\t\tthis.redOffset = redOffset;\n\t\tthis.greenOffset = greenOffset;\n\t\tthis.blueOffset = blueOffset;\n\t\tthis.alphaOffset = alphaOffset;\n\t}\n\n\t/**\n\t * Concatenates the ColorTranform object specified by the <code>second</code>\n\t * parameter with the current ColorTransform object and sets the current\n\t * object as the result, which is an additive combination of the two color\n\t * transformations. When you apply the concatenated ColorTransform object,\n\t * the effect is the same as applying the <code>second</code> color\n\t * transformation after the <i>original</i> color transformation.\n\t *\n\t * @param second The ColorTransform object to be combined with the current\n\t *               ColorTransform object.\n\t */\n\tpublic concat(second:ColorTransform):void\n\t{\n\t\tthis.redMultiplier += second.redMultiplier;\n\t\tthis.greenMultiplier += second.greenMultiplier;\n\t\tthis.blueMultiplier += second.blueMultiplier;\n\t\tthis.alphaMultiplier += second.alphaMultiplier;\n\t}\n}\n\nexport = ColorTransform;","/**\n* MathConsts provides some commonly used mathematical constants\n*/\nclass MathConsts\n{\n\t/**\n\t * The amount to multiply with when converting radians to degrees.\n\t */\n\tpublic static RADIANS_TO_DEGREES:number = 180/Math.PI;\n\n\t/**\n\t * The amount to multiply with when converting degrees to radians.\n\t */\n\tpublic static DEGREES_TO_RADIANS:number = Math.PI/180;\n}\n\nexport = MathConsts;","import Quaternion\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\nimport Matrix3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Plane3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Plane3D\");\nimport Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\n\n/**\n * away.geom.Matrix3DUtils provides additional Matrix3D functions.\n */\nclass Matrix3DUtils\n{\n\t/**\n\t * A reference to a Vector to be used as a temporary raw data container, to prevent object creation.\n\t */\n\tpublic static RAW_DATA_CONTAINER:number[] = new Array<number>(16);\n\t//public static RAW_DATA_CONTAINER:number[] = new Array<number>(16);\n\n\tpublic static CALCULATION_MATRIX:Matrix3D = new Matrix3D();\n\n\t/**\n\t * Fills the 3d matrix object with values representing the transformation made by the given quaternion.\n\t *\n\t * @param    quarternion    The quarterion object to convert.\n\t */\n\tpublic static quaternion2matrix(quarternion:Quaternion, m:Matrix3D = null):Matrix3D\n\t{\n\t\tvar x:number = quarternion.x;\n\t\tvar y:number = quarternion.y;\n\t\tvar z:number = quarternion.z;\n\t\tvar w:number = quarternion.w;\n\n\t\tvar xx:number = x*x;\n\t\tvar xy:number = x*y;\n\t\tvar xz:number = x*z;\n\t\tvar xw:number = x*w;\n\n\t\tvar yy:number = y*y;\n\t\tvar yz:number = y*z;\n\t\tvar yw:number = y*w;\n\n\t\tvar zz:number = z*z;\n\t\tvar zw:number = z*w;\n\n\t\tvar raw:number[] = Matrix3DUtils.RAW_DATA_CONTAINER;\n\t\traw[0] = 1 - 2*(yy + zz);\n\t\traw[1] = 2*(xy + zw);\n\t\traw[2] = 2*(xz - yw);\n\t\traw[4] = 2*(xy - zw);\n\t\traw[5] = 1 - 2*(xx + zz);\n\t\traw[6] = 2*(yz + xw);\n\t\traw[8] = 2*(xz + yw);\n\t\traw[9] = 2*(yz - xw);\n\t\traw[10] = 1 - 2*(xx + yy);\n\t\traw[3] = raw[7] = raw[11] = raw[12] = raw[13] = raw[14] = 0;\n\t\traw[15] = 1;\n\n\t\tif (m) {\n\t\t\tm.copyRawDataFrom(raw);\n\t\t\treturn m;\n\t\t} else\n\t\t\treturn new Matrix3D(raw);\n\t}\n\n\t/**\n\t * Returns a normalised <code>Vector3D</code> object representing the forward vector of the given matrix.\n\t * @param    m        The Matrix3D object to use to get the forward vector\n\t * @param    v        [optional] A vector holder to prevent make new Vector3D instance if already exists. Default is null.\n\t * @return            The forward vector\n\t */\n\tpublic static getForward(m:Matrix3D, v:Vector3D = null):Vector3D\n\t{\n\t\t//v ||= new Vector3D(0.0, 0.0, 0.0);\n\t\tif (v === null) {\n\n\t\t\tv = new Vector3D(0.0, 0.0, 0.0);\n\n\t\t}\n\n\t\tm.copyColumnTo(2, v);\n\t\tv.normalize();\n\n\t\treturn v;\n\t}\n\n\t/**\n\t * Returns a normalised <code>Vector3D</code> object representing the up vector of the given matrix.\n\t * @param    m        The Matrix3D object to use to get the up vector\n\t * @param    v        [optional] A vector holder to prevent make new Vector3D instance if already exists. Default is null.\n\t * @return            The up vector\n\t */\n\tpublic static getUp(m:Matrix3D, v:Vector3D = null):Vector3D\n\t{\n\t\t//v ||= new Vector3D(0.0, 0.0, 0.0);\n\n\t\tif (v === null) {\n\n\t\t\tv = new Vector3D(0.0, 0.0, 0.0);\n\n\t\t}\n\n\t\tm.copyColumnTo(1, v);\n\t\tv.normalize();\n\n\t\treturn v;\n\t}\n\n\t/**\n\t * Returns a normalised <code>Vector3D</code> object representing the right vector of the given matrix.\n\t * @param    m        The Matrix3D object to use to get the right vector\n\t * @param    v        [optional] A vector holder to prevent make new Vector3D instance if already exists. Default is null.\n\t * @return            The right vector\n\t */\n\tpublic static getRight(m:Matrix3D, v:Vector3D = null):Vector3D\n\t{\n\t\t//v ||= new Vector3D(0.0, 0.0, 0.0);\n\t\tif (v === null) {\n\n\t\t\tv = new Vector3D(0.0, 0.0, 0.0);\n\n\t\t}\n\n\t\tm.copyColumnTo(0, v);\n\t\tv.normalize();\n\n\t\treturn v;\n\t}\n\n\t/**\n\t * Returns a boolean value representing whether there is any significant difference between the two given 3d matrices.\n\t */\n\tpublic static compare(m1:Matrix3D, m2:Matrix3D):boolean\n\t{\n\t\tvar r1:number[] = Matrix3DUtils.RAW_DATA_CONTAINER;\n\t\tvar r2:number[] = m2.rawData;\n\t\tm1.copyRawDataTo(r1);\n\n\t\tfor (var i:number = 0; i < 16; ++i) {\n\t\t\tif (r1[i] != r2[i])\n\t\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tpublic static lookAt(matrix:Matrix3D, pos:Vector3D, dir:Vector3D, up:Vector3D)\n\t{\n\t\tvar dirN:Vector3D;\n\t\tvar upN:Vector3D;\n\t\tvar lftN:Vector3D;\n\t\tvar raw:number[] = Matrix3DUtils.RAW_DATA_CONTAINER;\n\n\t\tlftN = dir.crossProduct(up);\n\t\tlftN.normalize();\n\n\t\tupN = lftN.crossProduct(dir);\n\t\tupN.normalize();\n\t\tdirN = dir.clone();\n\t\tdirN.normalize();\n\n\t\traw[0] = lftN.x;\n\t\traw[1] = upN.x;\n\t\traw[2] = -dirN.x;\n\t\traw[3] = 0.0;\n\n\t\traw[4] = lftN.y;\n\t\traw[5] = upN.y;\n\t\traw[6] = -dirN.y;\n\t\traw[7] = 0.0;\n\n\t\traw[8] = lftN.z;\n\t\traw[9] = upN.z;\n\t\traw[10] = -dirN.z;\n\t\traw[11] = 0.0;\n\n\t\traw[12] = -lftN.dotProduct(pos);\n\t\traw[13] = -upN.dotProduct(pos);\n\t\traw[14] = dirN.dotProduct(pos);\n\t\traw[15] = 1.0;\n\n\t\tmatrix.copyRawDataFrom(raw);\n\t}\n\n\tpublic static reflection(plane:Plane3D, target:Matrix3D = null):Matrix3D\n\t{\n\t\tif (target === null)\n\t\t\ttarget = new Matrix3D();\n\n\t\tvar a:number = plane.a, b:number = plane.b, c:number = plane.c, d:number = plane.d;\n\t\tvar rawData:number[] = Matrix3DUtils.RAW_DATA_CONTAINER;\n\t\tvar ab2:number = -2*a*b;\n\t\tvar ac2:number = -2*a*c;\n\t\tvar bc2:number = -2*b*c;\n\t\t// reflection matrix\n\t\trawData[0] = 1 - 2*a*a;\n\t\trawData[4] = ab2;\n\t\trawData[8] = ac2;\n\t\trawData[12] = -2*a*d;\n\t\trawData[1] = ab2;\n\t\trawData[5] = 1 - 2*b*b;\n\t\trawData[9] = bc2;\n\t\trawData[13] = -2*b*d;\n\t\trawData[2] = ac2;\n\t\trawData[6] = bc2;\n\t\trawData[10] = 1 - 2*c*c;\n\t\trawData[14] = -2*c*d;\n\t\trawData[3] = 0;\n\t\trawData[7] = 0;\n\t\trawData[11] = 0;\n\t\trawData[15] = 1;\n\t\ttarget.copyRawDataFrom(rawData);\n\n\t\treturn target;\n\t}\n\n\n\tpublic static transformVector(matrix:Matrix3D, vector:Vector3D, result:Vector3D = null):Vector3D\n\t{\n\t\tif (!result)\n\t\t\tresult = new Vector3D();\n\n\t\tvar raw:Array<number> = Matrix3DUtils.RAW_DATA_CONTAINER;\n\t\tmatrix.copyRawDataTo(raw);\n\t\tvar a:number = raw[0];\n\t\tvar e:number = raw[1];\n\t\tvar i:number = raw[2];\n\t\tvar m:number = raw[3];\n\t\tvar b:number = raw[4];\n\t\tvar f:number = raw[5];\n\t\tvar j:number = raw[6];\n\t\tvar n:number = raw[7];\n\t\tvar c:number = raw[8];\n\t\tvar g:number = raw[9];\n\t\tvar k:number = raw[10];\n\t\tvar o:number = raw[11];\n\t\tvar d:number = raw[12];\n\t\tvar h:number = raw[13];\n\t\tvar l:number = raw[14];\n\t\tvar p:number = raw[15];\n\n\t\tvar x:number = vector.x;\n\t\tvar y:number = vector.y;\n\t\tvar z:number = vector.z;\n\t\tresult.x = a * x + b * y + c * z + d;\n\t\tresult.y = e * x + f * y + g * z + h;\n\t\tresult.z = i * x + j * y + k * z + l;\n\t\tresult.w = m * x + n * y + o * z + p;\n\t\treturn result;\n\t}\n\n\tpublic static deltaTransformVector(matrix:Matrix3D, vector:Vector3D, result:Vector3D = null):Vector3D\n\t{\n\t\tif (!result)\n\t\t\tresult = new Vector3D();\n\n\t\tvar raw:Array<number> = Matrix3DUtils.RAW_DATA_CONTAINER;\n\t\tmatrix.copyRawDataTo(raw);\n\t\tvar a:number = raw[0];\n\t\tvar e:number = raw[1];\n\t\tvar i:number = raw[2];\n\t\tvar m:number = raw[3];\n\t\tvar b:number = raw[4];\n\t\tvar f:number = raw[5];\n\t\tvar j:number = raw[6];\n\t\tvar n:number = raw[7];\n\t\tvar c:number = raw[8];\n\t\tvar g:number = raw[9];\n\t\tvar k:number = raw[10];\n\t\tvar o:number = raw[11];\n\t\tvar x:number = vector.x;\n\t\tvar y:number = vector.y;\n\t\tvar z:number = vector.z;\n\t\tresult.x = a * x + b * y + c * z;\n\t\tresult.y = e * x + f * y + g * z;\n\t\tresult.z = i * x + j * y + k * z;\n\t\tresult.w = m * x + n * y + o * z;\n\t\treturn result;\n\t}\n\n\tpublic static getTranslation(transform:Matrix3D, result:Vector3D = null):Vector3D\n\t{\n\t\tif(!result)\n\t\t\tresult = new Vector3D();\n\n\t\ttransform.copyColumnTo(3, result);\n\t\treturn result;\n\t}\n\n\tpublic static deltaTransformVectors(matrix:Matrix3D, vin:Array<number>, vout:Array<number>)\n\t{\n\t\tvar raw:Array<number> = Matrix3DUtils.RAW_DATA_CONTAINER;\n\t\tmatrix.copyRawDataTo(raw);\n\t\tvar a:number = raw[0];\n\t\tvar e:number = raw[1];\n\t\tvar i:number = raw[2];\n\t\tvar m:number = raw[3];\n\t\tvar b:number = raw[4];\n\t\tvar f:number = raw[5];\n\t\tvar j:number = raw[6];\n\t\tvar n:number = raw[7];\n\t\tvar c:number = raw[8];\n\t\tvar g:number = raw[9];\n\t\tvar k:number = raw[10];\n\t\tvar o:number = raw[11];\n\t\tvar outIndex:number = 0;\n\t\tvar length:number = vin.length;\n\t\tfor(var index:number = 0; index<length; index+=3) {\n\t\t\tvar x:number = vin[index];\n\t\t\tvar y:number = vin[index+1];\n\t\t\tvar z:number = vin[index+2];\n\t\t\tvout[outIndex++] = a * x + b * y + c * z;\n\t\t\tvout[outIndex++] = e * x + f * y + g * z;\n\t\t\tvout[outIndex++] = i * x + j * y + k * z;\n\t\t}\n\t}\n}\n\nexport = Matrix3DUtils;","import Orientation3D\t\t\t= require(\"awayjs-core/lib/geom/Orientation3D\");\nimport Quaternion\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\nimport Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport ArgumentError\t\t\t= require(\"awayjs-core/lib/errors/ArgumentError\");\n\nclass Matrix3D\n{\n\t/**\n\t * A Vector of 16 Numbers, where every four elements is a column of a 4x4 matrix.\n\t *\n\t * <p>An exception is thrown if the rawData property is set to a matrix that is not invertible. The Matrix3D\n\t * object must be invertible. If a non-invertible matrix is needed, create a subclass of the Matrix3D object.</p>\n\t */\n\tpublic rawData:number[];\n\n\t/**\n\t * Creates a Matrix3D object.\n\t */\n\tconstructor(v:number[] = null)\n\t{\n\t\tif (v != null && v.length == 16)\n\t\t\tthis.rawData = v.concat();\n\t\telse\n\t\t\tthis.rawData = [ 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1 ];\n\t}\n\n\t/**\n\t * Appends the matrix by multiplying another Matrix3D object by the current Matrix3D object.\n\t */\n\tpublic append(lhs:Matrix3D)\n\t{\n\t\tvar m111:number = this.rawData[0], m121:number = this.rawData[4], m131:number = this.rawData[8], m141:number = this.rawData[12], m112:number = this.rawData[1], m122:number = this.rawData[5], m132:number = this.rawData[9], m142:number = this.rawData[13], m113:number = this.rawData[2], m123:number = this.rawData[6], m133:number = this.rawData[10], m143:number = this.rawData[14], m114:number = this.rawData[3], m124:number = this.rawData[7], m134:number = this.rawData[11], m144:number = this.rawData[15], m211:number = lhs.rawData[0], m221:number = lhs.rawData[4], m231:number = lhs.rawData[8], m241:number = lhs.rawData[12], m212:number = lhs.rawData[1], m222:number = lhs.rawData[5], m232:number = lhs.rawData[9], m242:number = lhs.rawData[13], m213:number = lhs.rawData[2], m223:number = lhs.rawData[6], m233:number = lhs.rawData[10], m243:number = lhs.rawData[14], m214:number = lhs.rawData[3], m224:number = lhs.rawData[7], m234:number = lhs.rawData[11], m244:number = lhs.rawData[15];\n\n\t\tthis.rawData[0] = m111*m211 + m112*m221 + m113*m231 + m114*m241;\n\t\tthis.rawData[1] = m111*m212 + m112*m222 + m113*m232 + m114*m242;\n\t\tthis.rawData[2] = m111*m213 + m112*m223 + m113*m233 + m114*m243;\n\t\tthis.rawData[3] = m111*m214 + m112*m224 + m113*m234 + m114*m244;\n\n\t\tthis.rawData[4] = m121*m211 + m122*m221 + m123*m231 + m124*m241;\n\t\tthis.rawData[5] = m121*m212 + m122*m222 + m123*m232 + m124*m242;\n\t\tthis.rawData[6] = m121*m213 + m122*m223 + m123*m233 + m124*m243;\n\t\tthis.rawData[7] = m121*m214 + m122*m224 + m123*m234 + m124*m244;\n\n\t\tthis.rawData[8] = m131*m211 + m132*m221 + m133*m231 + m134*m241;\n\t\tthis.rawData[9] = m131*m212 + m132*m222 + m133*m232 + m134*m242;\n\t\tthis.rawData[10] = m131*m213 + m132*m223 + m133*m233 + m134*m243;\n\t\tthis.rawData[11] = m131*m214 + m132*m224 + m133*m234 + m134*m244;\n\n\t\tthis.rawData[12] = m141*m211 + m142*m221 + m143*m231 + m144*m241;\n\t\tthis.rawData[13] = m141*m212 + m142*m222 + m143*m232 + m144*m242;\n\t\tthis.rawData[14] = m141*m213 + m142*m223 + m143*m233 + m144*m243;\n\t\tthis.rawData[15] = m141*m214 + m142*m224 + m143*m234 + m144*m244;\n\t}\n\n\t/**\n\t * Appends an incremental rotation to a Matrix3D object.\n\t */\n\tpublic appendRotation(degrees:number, axis:Vector3D):void //, pivot:Vector3D = null )\n\t{\n\t\tvar m:Matrix3D = Matrix3D.getAxisRotation(axis.x, axis.y, axis.z, degrees);\n\n\t\tthis.append(m);\n\t}\n\n\t/**\n\t * Appends an incremental scale change along the x, y, and z axes to a Matrix3D object.\n\t */\n\tpublic appendScale(xScale:number, yScale:number, zScale:number)\n\t{\n\t\tthis.append(new Matrix3D([ xScale, 0.0, 0.0, 0.0, 0.0, yScale, 0.0, 0.0, 0.0, 0.0, zScale, 0.0, 0.0, 0.0, 0.0, 1.0 ]));\n\t}\n\n\t/**\n\t * Appends an incremental translation, a repositioning along the x, y, and z axes, to a Matrix3D object.\n\t */\n\tpublic appendTranslation(x:number, y:number, z:number)\n\t{\n\t\tthis.rawData[12] += x;\n\t\tthis.rawData[13] += y;\n\t\tthis.rawData[14] += z;\n\t}\n\n\t/**\n\t * Returns a new Matrix3D object that is an exact copy of the current Matrix3D object.\n\t */\n\tpublic clone():Matrix3D\n\t{\n\t\treturn new Matrix3D(this.rawData.slice(0));\n\t}\n\n\t/**\n\t * Copies a Vector3D object into specific column of the calling Matrix3D object.\n\t */\n\tpublic copyColumnFrom(column:number, vector3D:Vector3D)\n\t{\n\t\tswitch (column) {\n\t\t\tcase 0:\n\t\t\t\tthis.rawData[ 0 ] = vector3D.x;\n\t\t\t\tthis.rawData[ 1 ] = vector3D.y;\n\t\t\t\tthis.rawData[ 2 ] = vector3D.z;\n\t\t\t\tthis.rawData[ 3 ] = vector3D.w;\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tthis.rawData[ 4 ] = vector3D.x;\n\t\t\t\tthis.rawData[ 5 ] = vector3D.y;\n\t\t\t\tthis.rawData[ 6 ] = vector3D.z;\n\t\t\t\tthis.rawData[ 7 ] = vector3D.w;\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tthis.rawData[ 8 ] = vector3D.x;\n\t\t\t\tthis.rawData[ 9 ] = vector3D.y;\n\t\t\t\tthis.rawData[ 10 ] = vector3D.z;\n\t\t\t\tthis.rawData[ 11 ] = vector3D.w;\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tthis.rawData[ 12 ] = vector3D.x;\n\t\t\t\tthis.rawData[ 13 ] = vector3D.y;\n\t\t\t\tthis.rawData[ 14 ] = vector3D.z;\n\t\t\t\tthis.rawData[ 15 ] = vector3D.w;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new ArgumentError(\"ArgumentError, Column \" + column + \" out of bounds [0, ..., 3]\");\n\t\t}\n\t}\n\n\t/**\n\t * Copies specific column of the calling Matrix3D object into the Vector3D object.\n\t */\n\tpublic copyColumnTo(column:number, vector3D:Vector3D)\n\t{\n\t\tswitch (column) {\n\t\t\tcase 0:\n\t\t\t\tvector3D.x = this.rawData[ 0 ];\n\t\t\t\tvector3D.y = this.rawData[ 1 ];\n\t\t\t\tvector3D.z = this.rawData[ 2 ];\n\t\t\t\tvector3D.w = this.rawData[ 3 ];\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tvector3D.x = this.rawData[ 4 ];\n\t\t\t\tvector3D.y = this.rawData[ 5 ];\n\t\t\t\tvector3D.z = this.rawData[ 6 ];\n\t\t\t\tvector3D.w = this.rawData[ 7 ];\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tvector3D.x = this.rawData[ 8 ];\n\t\t\t\tvector3D.y = this.rawData[ 9 ];\n\t\t\t\tvector3D.z = this.rawData[ 10 ];\n\t\t\t\tvector3D.w = this.rawData[ 11 ];\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tvector3D.x = this.rawData[ 12 ];\n\t\t\t\tvector3D.y = this.rawData[ 13 ];\n\t\t\t\tvector3D.z = this.rawData[ 14 ];\n\t\t\t\tvector3D.w = this.rawData[ 15 ];\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new ArgumentError(\"ArgumentError, Column \" + column + \" out of bounds [0, ..., 3]\");\n\t\t}\n\t}\n\n\t/**\n\t * Copies all of the matrix data from the source Matrix3D object into the calling Matrix3D object.\n\t */\n\tpublic copyFrom(sourceMatrix3D:Matrix3D)\n\t{\n\t\tvar len:number = sourceMatrix3D.rawData.length;\n\t\tfor (var c:number = 0; c < len; c++)\n\t\t\tthis.rawData[c] = sourceMatrix3D.rawData[c];\n\t}\n\n\tpublic copyRawDataFrom(vector:number[], index:number = 0, transpose:boolean = false):void\n\t{\n\t\tif (transpose)\n\t\t\tthis.transpose();\n\n\t\tvar len:number = vector.length - index;\n\t\tfor (var c:number = 0; c < len; c++)\n\t\t\tthis.rawData[c] = vector[c + index];\n\n\t\tif (transpose)\n\t\t\tthis.transpose();\n\t}\n\n\tpublic copyRawDataTo(vector:number[], index:number = 0, transpose:boolean = false)\n\t{\n\t\tif (transpose)\n\t\t\tthis.transpose();\n\n\t\tvar len:number = this.rawData.length\n\t\tfor (var c:number = 0; c < len; c++)\n\t\t\tvector[c + index ] = this.rawData[c];\n\n\t\tif (transpose)\n\t\t\tthis.transpose();\n\t}\n\n\t/**\n\t * Copies a Vector3D object into specific row of the calling Matrix3D object.\n\t */\n\tpublic copyRowFrom(row:number, vector3D:Vector3D)\n\t{\n\t\tswitch (row) {\n\t\t\tcase 0:\n\t\t\t\tthis.rawData[ 0 ] = vector3D.x;\n\t\t\t\tthis.rawData[ 4 ] = vector3D.y;\n\t\t\t\tthis.rawData[ 8 ] = vector3D.z;\n\t\t\t\tthis.rawData[ 12 ] = vector3D.w;\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tthis.rawData[ 1 ] = vector3D.x;\n\t\t\t\tthis.rawData[ 5 ] = vector3D.y;\n\t\t\t\tthis.rawData[ 9 ] = vector3D.z;\n\t\t\t\tthis.rawData[ 13 ] = vector3D.w;\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tthis.rawData[ 2 ] = vector3D.x;\n\t\t\t\tthis.rawData[ 6 ] = vector3D.y;\n\t\t\t\tthis.rawData[ 10 ] = vector3D.z;\n\t\t\t\tthis.rawData[ 14 ] = vector3D.w;\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tthis.rawData[ 3 ] = vector3D.x;\n\t\t\t\tthis.rawData[ 7 ] = vector3D.y;\n\t\t\t\tthis.rawData[ 11 ] = vector3D.z;\n\t\t\t\tthis.rawData[ 15 ] = vector3D.w;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new ArgumentError(\"ArgumentError, Row \" + row + \" out of bounds [0, ..., 3]\");\n\t\t}\n\t}\n\n\t/**\n\t * Copies specific row of the calling Matrix3D object into the Vector3D object.\n\t */\n\tpublic copyRowTo(row:number, vector3D:Vector3D)\n\t{\n\t\tswitch (row) {\n\t\t\tcase 0:\n\t\t\t\tvector3D.x = this.rawData[ 0 ];\n\t\t\t\tvector3D.y = this.rawData[ 4 ];\n\t\t\t\tvector3D.z = this.rawData[ 8 ];\n\t\t\t\tvector3D.w = this.rawData[ 12 ];\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tvector3D.x = this.rawData[ 1 ];\n\t\t\t\tvector3D.y = this.rawData[ 5 ];\n\t\t\t\tvector3D.z = this.rawData[ 9 ];\n\t\t\t\tvector3D.w = this.rawData[ 13 ];\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tvector3D.x = this.rawData[ 2 ];\n\t\t\t\tvector3D.y = this.rawData[ 6 ];\n\t\t\t\tvector3D.z = this.rawData[ 10 ];\n\t\t\t\tvector3D.w = this.rawData[ 14 ];\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tvector3D.x = this.rawData[ 3 ];\n\t\t\t\tvector3D.y = this.rawData[ 7 ];\n\t\t\t\tvector3D.z = this.rawData[ 11 ];\n\t\t\t\tvector3D.w = this.rawData[ 15 ]\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new ArgumentError(\"ArgumentError, Row \" + row + \" out of bounds [0, ..., 3]\");\n\t\t}\n\t}\n\n\t/**\n\t * Copies this Matrix3D object into a destination Matrix3D object.\n\t */\n\tpublic copyToMatrix3D(dest:Matrix3D)\n\t{\n\t\tdest.rawData = this.rawData.slice(0);\n\t}\n\n\t/**\n\t * Returns the transformation matrix's translation, rotation, and scale settings as a Vector of three Vector3D objects.\n\t */\n\tpublic decompose(orientationStyle:string = \"eulerAngles\"):Vector3D[]\n\t{\n\t\tvar q:Quaternion;\n\n\t\t// Initial Tests - Not OK\n\n\t\tvar vec:Vector3D[] = [];\n\t\tvar m = this.clone();\n\t\tvar mr = m.rawData;\n\n\t\tvar pos:Vector3D = new Vector3D(mr[12], mr[13], mr[14]);\n\t\tmr[12] = 0;\n\t\tmr[13] = 0;\n\t\tmr[14] = 0;\n\n\t\tvar scale:Vector3D = new Vector3D();\n\n\t\tscale.x = Math.sqrt(mr[0]*mr[0] + mr[1]*mr[1] + mr[2]*mr[2]);\n\t\tscale.y = Math.sqrt(mr[4]*mr[4] + mr[5]*mr[5] + mr[6]*mr[6]);\n\t\tscale.z = Math.sqrt(mr[8]*mr[8] + mr[9]*mr[9] + mr[10]*mr[10]);\n\n\t\tif (mr[0]*(mr[5]*mr[10] - mr[6]*mr[9]) - mr[1]*(mr[4]*mr[10] - mr[6]*mr[8]) + mr[2]*(mr[4]*mr[9] - mr[5]*mr[8]) < 0)\n\t\t\tscale.z = -scale.z;\n\n\t\tmr[0] /= scale.x;\n\t\tmr[1] /= scale.x;\n\t\tmr[2] /= scale.x;\n\t\tmr[4] /= scale.y;\n\t\tmr[5] /= scale.y;\n\t\tmr[6] /= scale.y;\n\t\tmr[8] /= scale.z;\n\t\tmr[9] /= scale.z;\n\t\tmr[10] /= scale.z;\n\n\t\tvar rot = new Vector3D();\n\n\t\tswitch (orientationStyle) {\n\t\t\tcase Orientation3D.AXIS_ANGLE:\n\n\t\t\t\trot.w = Math.acos((mr[0] + mr[5] + mr[10] - 1)/2);\n\n\t\t\t\tvar len:number = Math.sqrt((mr[6] - mr[9])*(mr[6] - mr[9]) + (mr[8] - mr[2])*(mr[8] - mr[2]) + (mr[1] - mr[4])*(mr[1] - mr[4]));\n\t\t\t\trot.x = (mr[6] - mr[9])/len;\n\t\t\t\trot.y = (mr[8] - mr[2])/len;\n\t\t\t\trot.z = (mr[1] - mr[4])/len;\n\n\t\t\t\tbreak;\n\t\t\tcase Orientation3D.QUATERNION:\n\n\t\t\t\tvar tr = mr[0] + mr[5] + mr[10];\n\n\t\t\t\tif (tr > 0) {\n\t\t\t\t\trot.w = Math.sqrt(1 + tr)/2;\n\n\t\t\t\t\trot.x = (mr[6] - mr[9])/(4*rot.w);\n\t\t\t\t\trot.y = (mr[8] - mr[2])/(4*rot.w);\n\t\t\t\t\trot.z = (mr[1] - mr[4])/(4*rot.w);\n\t\t\t\t} else if ((mr[0] > mr[5]) && (mr[0] > mr[10])) {\n\t\t\t\t\trot.x = Math.sqrt(1 + mr[0] - mr[5] - mr[10])/2;\n\n\t\t\t\t\trot.w = (mr[6] - mr[9])/(4*rot.x);\n\t\t\t\t\trot.y = (mr[1] + mr[4])/(4*rot.x);\n\t\t\t\t\trot.z = (mr[8] + mr[2])/(4*rot.x);\n\t\t\t\t} else if (mr[5] > mr[10]) {\n\t\t\t\t\trot.y = Math.sqrt(1 + mr[5] - mr[0] - mr[10])/2;\n\n\t\t\t\t\trot.x = (mr[1] + mr[4])/(4*rot.y);\n\t\t\t\t\trot.w = (mr[8] - mr[2])/(4*rot.y);\n\t\t\t\t\trot.z = (mr[6] + mr[9])/(4*rot.y);\n\t\t\t\t} else {\n\t\t\t\t\trot.z = Math.sqrt(1 + mr[10] - mr[0] - mr[5])/2;\n\n\t\t\t\t\trot.x = (mr[8] + mr[2])/(4*rot.z);\n\t\t\t\t\trot.y = (mr[6] + mr[9])/(4*rot.z);\n\t\t\t\t\trot.w = (mr[1] - mr[4])/(4*rot.z);\n\t\t\t\t}\n\n\n\t\t\t\tbreak;\n\t\t\tcase Orientation3D.EULER_ANGLES:\n\n\t\t\t\trot.y = Math.asin(-mr[2]);\n\n\t\t\t\t//var cos:number = Math.cos(rot.y);\n\n\t\t\t\tif (mr[2] != 1 && mr[2] != -1) {\n\t\t\t\t\trot.x = Math.atan2(mr[6], mr[10]);\n\t\t\t\t\trot.z = Math.atan2(mr[1], mr[0]);\n\t\t\t\t} else {\n\t\t\t\t\trot.z = 0;\n\t\t\t\t\trot.x = Math.atan2(mr[4], mr[5]);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\n\t\tvec.push(pos);\n\t\tvec.push(rot);\n\t\tvec.push(scale);\n\n\t\treturn vec;\n\t}\n\n\t/**\n\t * Uses the transformation matrix without its translation elements to transform a Vector3D object from one space\n\t * coordinate to another.\n\t */\n\tpublic deltaTransformVector(v:Vector3D):Vector3D\n\t{\n\t\tvar x:number = v.x;\n\t\tvar y:number = v.y;\n\t\tvar z:number = v.z;\n\n\t\treturn new Vector3D((x*this.rawData[0] + y*this.rawData[4] + z*this.rawData[8]), (x*this.rawData[1] + y*this.rawData[5] + z*this.rawData[9]), (x*this.rawData[2] + y*this.rawData[6] + z*this.rawData[10]), (x*this.rawData[3] + y*this.rawData[7] + z*this.rawData[11]));\n\t}\n\n\t/**\n\t * Converts the current matrix to an identity or unit matrix.\n\t */\n\tpublic identity()\n\t{\n\t\tthis.rawData = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1 ];\n\t}\n\n\t/**\n\t * [static] Interpolates the translation, rotation, and scale transformation of one matrix toward those of the target matrix.\n\t */\n\tstatic interpolate(thisMat:Matrix3D, toMat:Matrix3D, percent:number):Matrix3D\n\t{\n\t\tvar m:Matrix3D = new Matrix3D();\n\t\tfor (var i:number = 0; i < 16; ++i)\n\t\t\tm.rawData[i] = thisMat.rawData[i] + (toMat.rawData[i] - thisMat.rawData[i])*percent;\n\n\t\treturn m;\n\t}\n\n\t/**\n\t * Interpolates this matrix towards the translation, rotation, and scale transformations of the target matrix.\n\t */\n\tpublic interpolateTo(toMat:Matrix3D, percent:number)\n\t{\n\t\tfor (var i:number = 0; i < 16; ++i)\n\t\t\tthis.rawData[i] = this.rawData[i] + (toMat.rawData[i] - this.rawData[i])*percent;\n\t}\n\n\t/**\n\t * Inverts the current matrix.\n\t */\n\tpublic invert():boolean\n\t{\n\t\tvar d = this.determinant;\n\t\tvar invertable = Math.abs(d) > 0.00000000001;\n\n\t\tif (invertable) {\n\t\t\td = 1/d;\n\t\t\tvar m11:number = this.rawData[0];\n\t\t\tvar m21:number = this.rawData[4];\n\t\t\tvar m31:number = this.rawData[8];\n\t\t\tvar m41:number = this.rawData[12];\n\t\t\tvar m12:number = this.rawData[1];\n\t\t\tvar m22:number = this.rawData[5];\n\t\t\tvar m32:number = this.rawData[9];\n\t\t\tvar m42:number = this.rawData[13];\n\t\t\tvar m13:number = this.rawData[2];\n\t\t\tvar m23:number = this.rawData[6];\n\t\t\tvar m33:number = this.rawData[10];\n\t\t\tvar m43:number = this.rawData[14];\n\t\t\tvar m14:number = this.rawData[3];\n\t\t\tvar m24:number = this.rawData[7];\n\t\t\tvar m34:number = this.rawData[11];\n\t\t\tvar m44:number = this.rawData[15];\n\n\t\t\tthis.rawData[0] = d*(m22*(m33*m44 - m43*m34) - m32*(m23*m44 - m43*m24) + m42*(m23*m34 - m33*m24));\n\t\t\tthis.rawData[1] = -d*(m12*(m33*m44 - m43*m34) - m32*(m13*m44 - m43*m14) + m42*(m13*m34 - m33*m14));\n\t\t\tthis.rawData[2] = d*(m12*(m23*m44 - m43*m24) - m22*(m13*m44 - m43*m14) + m42*(m13*m24 - m23*m14));\n\t\t\tthis.rawData[3] = -d*(m12*(m23*m34 - m33*m24) - m22*(m13*m34 - m33*m14) + m32*(m13*m24 - m23*m14));\n\t\t\tthis.rawData[4] = -d*(m21*(m33*m44 - m43*m34) - m31*(m23*m44 - m43*m24) + m41*(m23*m34 - m33*m24));\n\t\t\tthis.rawData[5] = d*(m11*(m33*m44 - m43*m34) - m31*(m13*m44 - m43*m14) + m41*(m13*m34 - m33*m14));\n\t\t\tthis.rawData[6] = -d*(m11*(m23*m44 - m43*m24) - m21*(m13*m44 - m43*m14) + m41*(m13*m24 - m23*m14));\n\t\t\tthis.rawData[7] = d*(m11*(m23*m34 - m33*m24) - m21*(m13*m34 - m33*m14) + m31*(m13*m24 - m23*m14));\n\t\t\tthis.rawData[8] = d*(m21*(m32*m44 - m42*m34) - m31*(m22*m44 - m42*m24) + m41*(m22*m34 - m32*m24));\n\t\t\tthis.rawData[9] = -d*(m11*(m32*m44 - m42*m34) - m31*(m12*m44 - m42*m14) + m41*(m12*m34 - m32*m14));\n\t\t\tthis.rawData[10] = d*(m11*(m22*m44 - m42*m24) - m21*(m12*m44 - m42*m14) + m41*(m12*m24 - m22*m14));\n\t\t\tthis.rawData[11] = -d*(m11*(m22*m34 - m32*m24) - m21*(m12*m34 - m32*m14) + m31*(m12*m24 - m22*m14));\n\t\t\tthis.rawData[12] = -d*(m21*(m32*m43 - m42*m33) - m31*(m22*m43 - m42*m23) + m41*(m22*m33 - m32*m23));\n\t\t\tthis.rawData[13] = d*(m11*(m32*m43 - m42*m33) - m31*(m12*m43 - m42*m13) + m41*(m12*m33 - m32*m13));\n\t\t\tthis.rawData[14] = -d*(m11*(m22*m43 - m42*m23) - m21*(m12*m43 - m42*m13) + m41*(m12*m23 - m22*m13));\n\t\t\tthis.rawData[15] = d*(m11*(m22*m33 - m32*m23) - m21*(m12*m33 - m32*m13) + m31*(m12*m23 - m22*m13));\n\t\t}\n\t\treturn invertable;\n\t}\n\n\t/* TODO implement pointAt\n\t public pointAt( pos:Vector3D, at:Vector3D = null, up:Vector3D = null )\n\t {\n\t }\n\t */\n\n\t/**\n\t * Prepends a matrix by multiplying the current Matrix3D object by another Matrix3D object.\n\t */\n\tpublic prepend(rhs:Matrix3D)\n\t{\n\t\tvar m111:number = rhs.rawData[0], m121:number = rhs.rawData[4], m131:number = rhs.rawData[8], m141:number = rhs.rawData[12], m112:number = rhs.rawData[1], m122:number = rhs.rawData[5], m132:number = rhs.rawData[9], m142:number = rhs.rawData[13], m113:number = rhs.rawData[2], m123:number = rhs.rawData[6], m133:number = rhs.rawData[10], m143:number = rhs.rawData[14], m114:number = rhs.rawData[3], m124:number = rhs.rawData[7], m134:number = rhs.rawData[11], m144:number = rhs.rawData[15], m211:number = this.rawData[0], m221:number = this.rawData[4], m231:number = this.rawData[8], m241:number = this.rawData[12], m212:number = this.rawData[1], m222:number = this.rawData[5], m232:number = this.rawData[9], m242:number = this.rawData[13], m213:number = this.rawData[2], m223:number = this.rawData[6], m233:number = this.rawData[10], m243:number = this.rawData[14], m214:number = this.rawData[3], m224:number = this.rawData[7], m234:number = this.rawData[11], m244:number = this.rawData[15];\n\n\t\tthis.rawData[0] = m111*m211 + m112*m221 + m113*m231 + m114*m241;\n\t\tthis.rawData[1] = m111*m212 + m112*m222 + m113*m232 + m114*m242;\n\t\tthis.rawData[2] = m111*m213 + m112*m223 + m113*m233 + m114*m243;\n\t\tthis.rawData[3] = m111*m214 + m112*m224 + m113*m234 + m114*m244;\n\n\t\tthis.rawData[4] = m121*m211 + m122*m221 + m123*m231 + m124*m241;\n\t\tthis.rawData[5] = m121*m212 + m122*m222 + m123*m232 + m124*m242;\n\t\tthis.rawData[6] = m121*m213 + m122*m223 + m123*m233 + m124*m243;\n\t\tthis.rawData[7] = m121*m214 + m122*m224 + m123*m234 + m124*m244;\n\n\t\tthis.rawData[8] = m131*m211 + m132*m221 + m133*m231 + m134*m241;\n\t\tthis.rawData[9] = m131*m212 + m132*m222 + m133*m232 + m134*m242;\n\t\tthis.rawData[10] = m131*m213 + m132*m223 + m133*m233 + m134*m243;\n\t\tthis.rawData[11] = m131*m214 + m132*m224 + m133*m234 + m134*m244;\n\n\t\tthis.rawData[12] = m141*m211 + m142*m221 + m143*m231 + m144*m241;\n\t\tthis.rawData[13] = m141*m212 + m142*m222 + m143*m232 + m144*m242;\n\t\tthis.rawData[14] = m141*m213 + m142*m223 + m143*m233 + m144*m243;\n\t\tthis.rawData[15] = m141*m214 + m142*m224 + m143*m234 + m144*m244;\n\t}\n\n\t/**\n\t * Prepends an incremental rotation to a Matrix3D object.\n\t */\n\tpublic prependRotation(degrees:number, axis:Vector3D) //, pivot:Vector3D = null )\n\t{\n\t\tvar m:Matrix3D = Matrix3D.getAxisRotation(axis.x, axis.y, axis.z, degrees);\n\n\t\t/*\n\t\t if ( pivot != null )\n\t\t {\n\t\t var p:Vector3D = pivot;\n\t\t m.appendTranslation( p.x, p.y, p.z );\n\t\t }\n\t\t */\n\t\tthis.prepend(m);\n\t}\n\n\t/**\n\t * Prepends an incremental scale change along the x, y, and z axes to a Matrix3D object.\n\t */\n\tpublic prependScale(xScale:number, yScale:number, zScale:number)\n\t{\n\n\t\t// Initial Tests - OK\n\n\t\tthis.prepend(new Matrix3D([ xScale, 0, 0, 0, 0, yScale, 0, 0, 0, 0, zScale, 0, 0, 0, 0, 1 ]));\n\t}\n\n\t/**\n\t * Prepends an incremental translation, a repositioning along the x, y, and z axes, to a Matrix3D object.\n\t */\n\tpublic prependTranslation(x:number, y:number, z:number)\n\t{\n\n\t\t// Initial Tests - OK\n\n\t\tvar m = new Matrix3D();\n\t\tm.position = new Vector3D(x, y, z);\n\t\tthis.prepend(m);\n\t}\n\n\t// TODO orientationStyle\n\t/**\n\t * Sets the transformation matrix's translation, rotation, and scale settings.\n\t */\n\tpublic recompose(components:Vector3D[]):boolean\n\t{\n\n\t\t// Initial Tests - OK\n\n\t\tif (components.length < 3) return false\n\n\t\t//components[2].x == 0 || components[2].y == 0 || components[2].z == 0) return false;\n\n\t\tthis.identity();\n\t\tthis.appendScale(components[2].x, components[2].y, components[2].z);\n\n\t\tvar angle:number;\n\t\tangle = -components[1].x;\n\t\tthis.append(new Matrix3D([1, 0, 0, 0, 0, Math.cos(angle), -Math.sin(angle), 0, 0, Math.sin(angle), Math.cos(angle), 0, 0, 0, 0 , 0]));\n\t\tangle = -components[1].y;\n\t\tthis.append(new Matrix3D([Math.cos(angle), 0, Math.sin(angle), 0, 0, 1, 0, 0, -Math.sin(angle), 0, Math.cos(angle), 0, 0, 0, 0, 0]));\n\t\tangle = -components[1].z;\n\t\tthis.append(new Matrix3D([Math.cos(angle), -Math.sin(angle), 0, 0, Math.sin(angle), Math.cos(angle), 0, 0, 0, 0, 1, 0, 0, 0, 0, 0]));\n\n\t\tthis.position = components[0];\n\t\tthis.rawData[15] = 1;\n\n\t\treturn true;\n\t}\n\n\tpublic transformVector(v:Vector3D):Vector3D\n\t{\n\t\tif (v == null)\n\t\t\treturn new Vector3D();\n\n\t\tvar x:number = v.x;\n\t\tvar y:number = v.y;\n\t\tvar z:number = v.z;\n\n\t\treturn new Vector3D((x*this.rawData[0] + y*this.rawData[4] + z*this.rawData[8] + this.rawData[12]), (x*this.rawData[1] + y*this.rawData[5] + z*this.rawData[9] + this.rawData[13]), (x*this.rawData[2] + y*this.rawData[6] + z*this.rawData[10] + this.rawData[14]), (x*this.rawData[3] + y*this.rawData[7] + z*this.rawData[11] + this.rawData[15]));\n\t}\n\n\t/**\n\t * Uses the transformation matrix to transform a Vector of Numbers from one coordinate space to another.\n\t */\n\tpublic transformVectors(vin:number[], vout:number[])\n\t{\n\n\t\t// Initial Tests - OK\n\n\t\tvar i:number = 0;\n\t\tvar x:number = 0, y:number = 0, z:number = 0;\n\n\t\twhile (i + 3 <= vin.length) {\n\t\t\tx = vin[i];\n\t\t\ty = vin[i + 1];\n\t\t\tz = vin[i + 2];\n\t\t\tvout[i] = x*this.rawData[0] + y*this.rawData[4] + z*this.rawData[8] + this.rawData[12];\n\t\t\tvout[i + 1] = x*this.rawData[1] + y*this.rawData[5] + z*this.rawData[9] + this.rawData[13];\n\t\t\tvout[i + 2] = x*this.rawData[2] + y*this.rawData[6] + z*this.rawData[10] + this.rawData[14];\n\t\t\ti += 3;\n\t\t}\n\t}\n\n\t/**\n\t * Converts the current Matrix3D object to a matrix where the rows and columns are swapped.\n\t */\n\tpublic transpose()\n\t{\n\n\t\t// Initial Tests - OK\n\n\t\tvar oRawData:number[] = this.rawData.slice(0);\n\n\t\tthis.rawData[1] = oRawData[4];\n\t\tthis.rawData[2] = oRawData[8];\n\t\tthis.rawData[3] = oRawData[12];\n\t\tthis.rawData[4] = oRawData[1];\n\t\tthis.rawData[6] = oRawData[9];\n\t\tthis.rawData[7] = oRawData[13];\n\t\tthis.rawData[8] = oRawData[2];\n\t\tthis.rawData[9] = oRawData[6];\n\t\tthis.rawData[11] = oRawData[14];\n\t\tthis.rawData[12] = oRawData[3];\n\t\tthis.rawData[13] = oRawData[7];\n\t\tthis.rawData[14] = oRawData[11];\n\t}\n\n\tstatic getAxisRotation(x:number, y:number, z:number, degrees:number):Matrix3D\n\t{\n\n\t\t// internal class use by rotations which have been tested\n\n\t\tvar m:Matrix3D = new Matrix3D();\n\n\t\tvar rad = degrees*( Math.PI/180 );\n\t\tvar c:number = Math.cos(rad);\n\t\tvar s:number = Math.sin(rad);\n\t\tvar t:number = 1 - c;\n\t\tvar tmp1:number, tmp2:number;\n\n\t\tm.rawData[0] = c + x*x*t;\n\t\tm.rawData[5] = c + y*y*t;\n\t\tm.rawData[10] = c + z*z*t;\n\n\t\ttmp1 = x*y*t;\n\t\ttmp2 = z*s;\n\t\tm.rawData[1] = tmp1 + tmp2;\n\t\tm.rawData[4] = tmp1 - tmp2;\n\t\ttmp1 = x*z*t;\n\t\ttmp2 = y*s;\n\t\tm.rawData[8] = tmp1 + tmp2;\n\t\tm.rawData[2] = tmp1 - tmp2;\n\t\ttmp1 = y*z*t;\n\t\ttmp2 = x*s;\n\t\tm.rawData[9] = tmp1 - tmp2;\n\t\tm.rawData[6] = tmp1 + tmp2;\n\n\t\treturn m;\n\t}\n\n\t/**\n\t * [read-only] A Number that determines whether a matrix is invertible.\n\t */\n\tpublic get determinant():number\n\t{\n\t\treturn    ((this.rawData[0]*this.rawData[5] - this.rawData[4]*this.rawData[1])*(this.rawData[10]*this.rawData[15] - this.rawData[14]*this.rawData[11]) - (this.rawData[0]*this.rawData[9] - this.rawData[8]*this.rawData[1])*(this.rawData[6]*this.rawData[15] - this.rawData[14]*this.rawData[7]) + (this.rawData[0]*this.rawData[13] - this.rawData[12]*this.rawData[1])*(this.rawData[6]*this.rawData[11] - this.rawData[10]*this.rawData[7]) + (this.rawData[4]*this.rawData[9] - this.rawData[8]*this.rawData[5])*(this.rawData[2]*this.rawData[15] - this.rawData[14]*this.rawData[3]) - (this.rawData[4]*this.rawData[13] - this.rawData[12]*this.rawData[5])*(this.rawData[2]*this.rawData[11] - this.rawData[10]*this.rawData[3]) + (this.rawData[8]*this.rawData[13] - this.rawData[12]*this.rawData[9])*(this.rawData[2]*this.rawData[7] - this.rawData[6]*this.rawData[3]));\n\t}\n\n\t/**\n\t * A Vector3D object that holds the position, the 3D coordinate (x,y,z) of a display object within the\n\t * transformation's frame of reference.\n\t */\n\tpublic get position():Vector3D\n\t{\n\t\treturn new Vector3D(this.rawData[12], this.rawData[13], this.rawData[14]);\n\t}\n\n\tpublic set position(value:Vector3D)\n\t{\n\t\tthis.rawData[12] = value.x;\n\t\tthis.rawData[13] = value.y;\n\t\tthis.rawData[14] = value.z;\n\t}\n\n\tpublic toFixed(decimalPlace:number):string\n\t{\n\t\tvar magnitude:number = Math.pow(10, decimalPlace);\n\t\treturn \"matrix3d(\" + Math.round(this.rawData[0]*magnitude)/magnitude + \",\" + Math.round(this.rawData[1]*magnitude)/magnitude + \",\" + Math.round(this.rawData[2]*magnitude)/magnitude + \",\" + Math.round(this.rawData[3]*magnitude)/magnitude + \",\" + Math.round(this.rawData[4]*magnitude)/magnitude + \",\" + Math.round(this.rawData[5]*magnitude)/magnitude + \",\" + Math.round(this.rawData[6]*magnitude)/magnitude + \",\" + Math.round(this.rawData[7]*magnitude)/magnitude + \",\" + Math.round(this.rawData[8]*magnitude)/magnitude + \",\" + Math.round(this.rawData[9]*magnitude)/magnitude + \",\" + Math.round(this.rawData[10]*magnitude)/magnitude + \",\" + Math.round(this.rawData[11]*magnitude)/magnitude + \",\" + Math.round(this.rawData[12]*magnitude)/magnitude + \",\" + Math.round(this.rawData[13]*magnitude)/magnitude + \",\" + Math.round(this.rawData[14]*magnitude)/magnitude + \",\" + Math.round(this.rawData[15]*magnitude)/magnitude + \")\";\n\t}\n\n\tpublic toString():string\n\t{\n\t\treturn \"matrix3d(\" + Math.round(this.rawData[0]*1000)/1000 + \",\" + Math.round(this.rawData[1]*1000)/1000 + \",\" + Math.round(this.rawData[2]*1000)/1000 + \",\" + Math.round(this.rawData[3]*1000)/1000 + \",\" + Math.round(this.rawData[4]*1000)/1000 + \",\" + Math.round(this.rawData[5]*1000)/1000 + \",\" + Math.round(this.rawData[6]*1000)/1000 + \",\" + Math.round(this.rawData[7]*1000)/1000 + \",\" + Math.round(this.rawData[8]*1000)/1000 + \",\" + Math.round(this.rawData[9]*1000)/1000 + \",\" + Math.round(this.rawData[10]*1000)/1000 + \",\" + Math.round(this.rawData[11]*1000)/1000 + \",\" + Math.round(this.rawData[12]*1000)/1000 + \",\" + Math.round(this.rawData[13]*1000)/1000 + \",\" + Math.round(this.rawData[14]*1000)/1000 + \",\" + Math.round(this.rawData[15]*1000)/1000 + \")\";\n\t}\n}\n\nexport = Matrix3D;","import Point\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\nimport Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport ArgumentError\t\t\t= require(\"awayjs-core/lib/errors/ArgumentError\");\n\n/**\n * The Matrix class represents a transformation matrix that determines how to\n * map points from one coordinate space to another. You can perform various\n * graphical transformations on a display object by setting the properties of\n * a Matrix object, applying that Matrix object to the <code>matrix</code>\n * property of a Transform object, and then applying that Transform object as\n * the <code>transform</code> property of the display object. These\n * transformation functions include translation(<i>x</i> and <i>y</i>\n * repositioning), rotation, scaling, and skewing.\n *\n * <p>Together these types of transformations are known as <i>affine\n * transformations</i>. Affine transformations preserve the straightness of\n * lines while transforming, so that parallel lines stay parallel.</p>\n *\n * <p>To apply a transformation matrix to a display object, you create a\n * Transform object, set its <code>matrix</code> property to the\n * transformation matrix, and then set the <code>transform</code> property of\n * the display object to the Transform object. Matrix objects are also used as\n * parameters of some methods, such as the following:</p>\n *\n * <ul>\n *   <li>The <code>draw()</code> method of a BitmapData object</li>\n *   <li>The <code>beginBitmapFill()</code> method,\n * <code>beginGradientFill()</code> method, or\n * <code>lineGradientStyle()</code> method of a Graphics object</li>\n * </ul>\n *\n * <p>A transformation matrix object is a 3 x 3 matrix with the following\n * contents:</p>\n *\n * <p>In traditional transformation matrixes, the <code>u</code>,\n * <code>v</code>, and <code>w</code> properties provide extra capabilities.\n * The Matrix class can only operate in two-dimensional space, so it always\n * assumes that the property values <code>u</code> and <code>v</code> are 0.0,\n * and that the property value <code>w</code> is 1.0. The effective values of\n * the matrix are as follows:</p>\n *\n * <p>You can get and set the values of all six of the other properties in a\n * Matrix object: <code>a</code>, <code>b</code>, <code>c</code>,\n * <code>d</code>, <code>tx</code>, and <code>ty</code>.</p>\n *\n * <p>The Matrix class supports the four major types of transformations:\n * translation, scaling, rotation, and skewing. You can set three of these\n * transformations by using specialized methods, as described in the following\n * table: </p>\n *\n * <p>Each transformation function alters the current matrix properties so\n * that you can effectively combine multiple transformations. To do this, you\n * call more than one transformation function before applying the matrix to\n * its display object target(by using the <code>transform</code> property of\n * that display object).</p>\n *\n * <p>Use the <code>new Matrix()</code> constructor to create a Matrix object\n * before you can call the methods of the Matrix object.</p>\n */\nclass Matrix\n{\n\t/**\n\t * The value that affects the positioning of pixels along the <i>x</i> axis\n\t * when scaling or rotating an image.\n\t */\n\tpublic a:number;\n\n\t/**\n\t * The value that affects the positioning of pixels along the <i>y</i> axis\n\t * when rotating or skewing an image.\n\t */\n\tpublic b:number;\n\n\t/**\n\t * The value that affects the positioning of pixels along the <i>x</i> axis\n\t * when rotating or skewing an image.\n\t */\n\tpublic c:number;\n\n\t/**\n\t * The value that affects the positioning of pixels along the <i>y</i> axis\n\t * when scaling or rotating an image.\n\t */\n\tpublic d:number;\n\n\t/**\n\t * The distance by which to translate each point along the <i>x</i> axis.\n\t */\n\tpublic tx:number;\n\n\t/**\n\t * The distance by which to translate each point along the <i>y</i> axis.\n\t */\n\tpublic ty:number;\n\n\t/**\n\t * Creates a new Matrix object with the specified parameters. In matrix\n\t * notation, the properties are organized like this:\n\t *\n\t * <p>If you do not provide any parameters to the <code>new Matrix()</code>\n\t * constructor, it creates an <i>identity matrix</i> with the following\n\t * values:</p>\n\t *\n\t * <p>In matrix notation, the identity matrix looks like this:</p>\n\t *\n\t * @param a  The value that affects the positioning of pixels along the\n\t *           <i>x</i> axis when scaling or rotating an image.\n\t * @param b  The value that affects the positioning of pixels along the\n\t *           <i>y</i> axis when rotating or skewing an image.\n\t * @param c  The value that affects the positioning of pixels along the\n\t *           <i>x</i> axis when rotating or skewing an image.\n\t * @param d  The value that affects the positioning of pixels along the\n\t *           <i>y</i> axis when scaling or rotating an image..\n\t * @param tx The distance by which to translate each point along the <i>x</i>\n\t *           axis.\n\t * @param ty The distance by which to translate each point along the <i>y</i>\n\t *           axis.\n\t */\n\tconstructor(a:number = 1, b:number = 0, c:number = 0, d:number = 1, tx:number = 0, ty:number = 0)\n\t{\n\t\tthis.a = a;\n\t\tthis.b = b;\n\t\tthis.c = c;\n\t\tthis.d = d;\n\t\tthis.tx = tx;\n\t\tthis.ty = ty;\n\t}\n\n\t/**\n\t * Returns a new Matrix object that is a clone of this matrix, with an exact\n\t * copy of the contained object.\n\t *\n\t * @return A Matrix object.\n\t */\n\tpublic clone():Matrix\n\t{\n\t\treturn new Matrix(this.a, this.b, this.c, this.d, this.tx, this.ty);\n\t}\n\n\t/**\n\t * Concatenates a matrix with the current matrix, effectively combining the\n\t * geometric effects of the two. In mathematical terms, concatenating two\n\t * matrixes is the same as combining them using matrix multiplication.\n\t *\n\t * <p>For example, if matrix <code>m1</code> scales an object by a factor of\n\t * four, and matrix <code>m2</code> rotates an object by 1.5707963267949\n\t * radians(<code>Math.PI/2</code>), then <code>m1.concat(m2)</code>\n\t * transforms <code>m1</code> into a matrix that scales an object by a factor\n\t * of four and rotates the object by <code>Math.PI/2</code> radians. </p>\n\t *\n\t * <p>This method replaces the source matrix with the concatenated matrix. If\n\t * you want to concatenate two matrixes without altering either of the two\n\t * source matrixes, first copy the source matrix by using the\n\t * <code>clone()</code> method, as shown in the Class Examples section.</p>\n\t *\n\t * @param matrix The matrix to be concatenated to the source matrix.\n\t */\n\tpublic concat(matrix:Matrix):void\n\t{\n\t\tvar a1 = this.a*matrix.a + this.b*matrix.c;\n\t\tthis.b = this.a*matrix.b + this.b*matrix.d;\n\t\tthis.a = a1;\n\n\t\tvar c1 = this.c*matrix.a + this.d*matrix.c;\n\t\tthis.d = this.c*matrix.b + this.d*matrix.d;\n\n\t\tthis.c = c1;\n\n\t\tvar tx1 = this.tx*matrix.a + this.ty*matrix.c + matrix.tx;\n\t\tthis.ty = this.tx*matrix.b + this.ty*matrix.d + matrix.ty;\n\t\tthis.tx = tx1;\n\t}\n\n\t/**\n\t * Copies a Vector3D object into specific column of the calling Matrix3D\n\t * object.\n\t *\n\t * @param column   The column from which to copy the data from.\n\t * @param vector3D The Vector3D object from which to copy the data.\n\t */\n\tpublic copyColumnFrom(column:number, vector3D:Vector3D):void\n\t{\n\t\tif (column > 2) {\n\t\t\tthrow \"Column \" + column + \" out of bounds (2)\";\n\t\t} else if (column == 0) {\n\t\t\tthis.a = vector3D.x;\n\t\t\tthis.c = vector3D.y;\n\t\t} else if (column == 1) {\n\t\t\tthis.b = vector3D.x;\n\t\t\tthis.d = vector3D.y;\n\t\t} else {\n\t\t\tthis.tx = vector3D.x;\n\t\t\tthis.ty = vector3D.y;\n\t\t}\n\t}\n\n\t/**\n\t * Copies specific column of the calling Matrix object into the Vector3D\n\t * object. The w element of the Vector3D object will not be changed.\n\t *\n\t * @param column   The column from which to copy the data from.\n\t * @param vector3D The Vector3D object from which to copy the data.\n\t */\n\tpublic copyColumnTo(column:number, vector3D:Vector3D):void\n\t{\n\t\tif (column > 2) {\n\t\t\tthrow new ArgumentError(\"ArgumentError, Column \" + column + \" out of bounds [0, ..., 2]\");\n\t\t} else if (column == 0) {\n\t\t\tvector3D.x = this.a;\n\t\t\tvector3D.y = this.c;\n\t\t\tvector3D.z = 0;\n\t\t} else if (column == 1) {\n\t\t\tvector3D.x = this.b;\n\t\t\tvector3D.y = this.d;\n\t\t\tvector3D.z = 0;\n\t\t} else {\n\t\t\tvector3D.x = this.tx;\n\t\t\tvector3D.y = this.ty;\n\t\t\tvector3D.z = 1;\n\t\t}\n\t}\n\n\t/**\n\t * Copies all of the matrix data from the source Point object into the\n\t * calling Matrix object.\n\t *\n\t * @param sourceMatrix The Matrix object from which to copy the data.\n\t */\n\tpublic copyFrom(sourceMatrix:Matrix):void\n\t{\n\t\tthis.a = sourceMatrix.a;\n\t\tthis.b = sourceMatrix.b;\n\t\tthis.c = sourceMatrix.c;\n\t\tthis.d = sourceMatrix.d;\n\t\tthis.tx = sourceMatrix.tx;\n\t\tthis.ty = sourceMatrix.ty;\n\t}\n\n\t/**\n\t * Copies a Vector3D object into specific row of the calling Matrix object.\n\t *\n\t * @param row      The row from which to copy the data from.\n\t * @param vector3D The Vector3D object from which to copy the data.\n\t */\n\tpublic copyRowFrom(row:number, vector3D:Vector3D):void\n\t{\n\t\tif (row > 2) {\n\t\t\tthrow new ArgumentError(\"ArgumentError, Row \" + row + \" out of bounds [0, ..., 2]\");\n\t\t} else if (row == 0) {\n\t\t\tthis.a = vector3D.x;\n\t\t\tthis.c = vector3D.y;\n\t\t} else if (row == 1) {\n\t\t\tthis.b = vector3D.x;\n\t\t\tthis.d = vector3D.y;\n\t\t} else {\n\t\t\tthis.tx = vector3D.x;\n\t\t\tthis.ty = vector3D.y;\n\t\t}\n\t}\n\n\t/**\n\t * Copies specific row of the calling Matrix object into the Vector3D object.\n\t * The w element of the Vector3D object will not be changed.\n\t *\n\t * @param row      The row from which to copy the data from.\n\t * @param vector3D The Vector3D object from which to copy the data.\n\t */\n\tpublic copyRowTo(row:number, vector3D:Vector3D):void\n\t{\n\t\tif (row > 2) {\n\t\t\tthrow new ArgumentError(\"ArgumentError, Row \" + row + \" out of bounds [0, ..., 2]\");\n\t\t} else if (row == 0) {\n\t\t\tvector3D.x = this.a;\n\t\t\tvector3D.y = this.b;\n\t\t\tvector3D.z = this.tx;\n\t\t} else if (row == 1) {\n\t\t\tvector3D.x = this.c;\n\t\t\tvector3D.y = this.d;\n\t\t\tvector3D.z = this.ty;\n\t\t} else {\n\t\t\tvector3D.setTo(0, 0, 1);\n\t\t}\n\t}\n\n\t/**\n\t * Includes parameters for scaling, rotation, and translation. When applied\n\t * to a matrix it sets the matrix's values based on those parameters.\n\t *\n\t * <p>Using the <code>createBox()</code> method lets you obtain the same\n\t * matrix as you would if you applied the <code>identity()</code>,\n\t * <code>rotate()</code>, <code>scale()</code>, and <code>translate()</code>\n\t * methods in succession. For example, <code>mat1.createBox(2,2,Math.PI/4,\n\t * 100, 100)</code> has the same effect as the following:</p>\n\t *\n\t * @param scaleX   The factor by which to scale horizontally.\n\t * @param scaleY   The factor by which scale vertically.\n\t * @param rotation The amount to rotate, in radians.\n\t * @param tx       The number of pixels to translate(move) to the right\n\t *                 along the <i>x</i> axis.\n\t * @param ty       The number of pixels to translate(move) down along the\n\t *                 <i>y</i> axis.\n\t */\n\tpublic createBox(scaleX:number, scaleY:number, rotation:number = 0, tx:number = 0, ty:number = 0):void\n\t{\n\t\tthis.a = scaleX;\n\t\tthis.d = scaleY;\n\t\tthis.b = rotation;\n\t\tthis.tx = tx;\n\t\tthis.ty = ty;\n\t}\n\n\t/**\n\t * Creates the specific style of matrix expected by the\n\t * <code>beginGradientFill()</code> and <code>lineGradientStyle()</code>\n\t * methods of the Graphics class. Width and height are scaled to a\n\t * <code>scaleX</code>/<code>scaleY</code> pair and the\n\t * <code>tx</code>/<code>ty</code> values are offset by half the width and\n\t * height.\n\t *\n\t * <p>For example, consider a gradient with the following\n\t * characteristics:</p>\n\t *\n\t * <ul>\n\t *   <li><code>GradientType.LINEAR</code></li>\n\t *   <li>Two colors, green and blue, with the ratios array set to <code>[0,\n\t * 255]</code></li>\n\t *   <li><code>SpreadMethod.PAD</code></li>\n\t *   <li><code>InterpolationMethod.LINEAR_RGB</code></li>\n\t * </ul>\n\t *\n\t * <p>The following illustrations show gradients in which the matrix was\n\t * defined using the <code>createGradientBox()</code> method with different\n\t * parameter settings:</p>\n\t *\n\t * @param width    The width of the gradient box.\n\t * @param height   The height of the gradient box.\n\t * @param rotation The amount to rotate, in radians.\n\t * @param tx       The distance, in pixels, to translate to the right along\n\t *                 the <i>x</i> axis. This value is offset by half of the\n\t *                 <code>width</code> parameter.\n\t * @param ty       The distance, in pixels, to translate down along the\n\t *                 <i>y</i> axis. This value is offset by half of the\n\t *                 <code>height</code> parameter.\n\t */\n\tpublic createGradientBox(width:number, height:number, rotation:number = 0, tx:number = 0, ty:number = 0):void\n\t{\n\t\tthis.a = width/1638.4;\n\t\tthis.d = height/1638.4;\n\n\t\tif (rotation != 0.0) {\n\t\t\tvar cos = Math.cos(rotation);\n\t\t\tvar sin = Math.sin(rotation);\n\n\t\t\tthis.b = sin*this.d;\n\t\t\tthis.c = -sin*this.a;\n\t\t\tthis.a *= cos;\n\t\t\tthis.d *= cos;\n\t\t} else {\n\t\t\tthis.b = this.c = 0;\n\t\t}\n\n\t\tthis.tx = tx + width/2;\n\t\tthis.ty = ty + height/2;\n\t}\n\n\t/**\n\t * Given a point in the pretransform coordinate space, returns the\n\t * coordinates of that point after the transformation occurs. Unlike the\n\t * standard transformation applied using the <code>transformPoint()</code>\n\t * method, the <code>deltaTransformPoint()</code> method's transformation\n\t * does not consider the translation parameters <code>tx</code> and\n\t * <code>ty</code>.\n\t *\n\t * @param point The point for which you want to get the result of the matrix\n\t *              transformation.\n\t * @return The point resulting from applying the matrix transformation.\n\t */\n\tpublic deltaTransformPoint(point:Point):Point\n\t{\n\t\treturn new Point(point.x*this.a + point.y*this.c, point.x*this.b + point.y*this.d);\n\t}\n\n\t/**\n\t * Sets each matrix property to a value that causes a null transformation. An\n\t * object transformed by applying an identity matrix will be identical to the\n\t * original.\n\t *\n\t * <p>After calling the <code>identity()</code> method, the resulting matrix\n\t * has the following properties: <code>a</code>=1, <code>b</code>=0,\n\t * <code>c</code>=0, <code>d</code>=1, <code>tx</code>=0,\n\t * <code>ty</code>=0.</p>\n\t *\n\t * <p>In matrix notation, the identity matrix looks like this:</p>\n\t *\n\t */\n\tpublic identity():void\n\t{\n\t\tthis.a = 1;\n\t\tthis.b = 0;\n\t\tthis.c = 0;\n\t\tthis.d = 1;\n\t\tthis.tx = 0;\n\t\tthis.ty = 0;\n\t}\n\n\t/**\n\t * Performs the opposite transformation of the original matrix. You can apply\n\t * an inverted matrix to an object to undo the transformation performed when\n\t * applying the original matrix.\n\t */\n\tpublic invert():void\n\t{\n\t\tvar norm = this.a*this.d - this.b*this.c;\n\n\t\tif (norm == 0) {\n\t\t\tthis.a = this.b = this.c = this.d = 0;\n\t\t\tthis.tx = -this.tx;\n\t\t\tthis.ty = -this.ty;\n\t\t} else {\n\t\t\tnorm = 1.0/norm;\n\t\t\tvar a1 = this.d*norm;\n\t\t\tthis.d = this.a*norm;\n\t\t\tthis.a = a1;\n\t\t\tthis.b *= -norm;\n\t\t\tthis.c *= -norm;\n\n\t\t\tvar tx1 = -this.a*this.tx - this.c*this.ty;\n\t\t\tthis.ty = -this.b*this.tx - this.d*this.ty;\n\t\t\tthis.tx = tx1;\n\t\t}\n\t}\n\n\n\t/**\n\t * Returns a new Matrix object that is a clone of this matrix, with an exact\n\t * copy of the contained object.\n\t *\n\t * @param matrix The matrix for which you want to get the result of the matrix\n\t *               transformation.\n\t * @return A Matrix object.\n\t */\n\tpublic multiply(matrix:Matrix):Matrix\n\t{\n\t\tvar result = new Matrix();\n\n\t\tresult.a = this.a*matrix.a + this.b*matrix.c;\n\t\tresult.b = this.a*matrix.b + this.b*matrix.d;\n\t\tresult.c = this.c*matrix.a + this.d*matrix.c;\n\t\tresult.d = this.c*matrix.b + this.d*matrix.d;\n\n\t\tresult.tx = this.tx*matrix.a + this.ty*matrix.c + matrix.tx;\n\t\tresult.ty = this.tx*matrix.b + this.ty*matrix.d + matrix.ty;\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Applies a rotation transformation to the Matrix object.\n\t *\n\t * <p>The <code>rotate()</code> method alters the <code>a</code>,\n\t * <code>b</code>, <code>c</code>, and <code>d</code> properties of the\n\t * Matrix object. In matrix notation, this is the same as concatenating the\n\t * current matrix with the following:</p>\n\t *\n\t * @param angle The rotation angle in radians.\n\t */\n\tpublic rotate(angle:number):void\n\t{\n\t\tvar cos = Math.cos(angle);\n\t\tvar sin = Math.sin(angle);\n\n\t\tvar a1 = this.a*cos - this.b*sin;\n\t\tthis.b = this.a*sin + this.b*cos;\n\t\tthis.a = a1;\n\n\t\tvar c1 = this.c*cos - this.d*sin;\n\t\tthis.d = this.c*sin + this.d*cos;\n\t\tthis.c = c1;\n\n\t\tvar tx1 = this.tx*cos - this.ty*sin;\n\t\tthis.ty = this.tx*sin + this.ty*cos;\n\t\tthis.tx = tx1;\n\t}\n\n\t/**\n\t * Applies a scaling transformation to the matrix. The <i>x</i> axis is\n\t * multiplied by <code>sx</code>, and the <i>y</i> axis it is multiplied by\n\t * <code>sy</code>.\n\t *\n\t * <p>The <code>scale()</code> method alters the <code>a</code> and\n\t * <code>d</code> properties of the Matrix object. In matrix notation, this\n\t * is the same as concatenating the current matrix with the following\n\t * matrix:</p>\n\t *\n\t * @param sx A multiplier used to scale the object along the <i>x</i> axis.\n\t * @param sy A multiplier used to scale the object along the <i>y</i> axis.\n\t */\n\tpublic scale(sx:number, sy:number):void\n\t{\n\t\tthis.a *= sx;\n\t\tthis.b *= sy;\n\n\t\tthis.c *= sx;\n\t\tthis.d *= sy;\n\n\t\tthis.tx *= sx;\n\t\tthis.ty *= sy;\n\t}\n\n\t/**\n\t * Sets the members of Matrix to the specified values.\n\t *\n\t * @param a  The value that affects the positioning of pixels along the\n\t *           <i>x</i> axis when scaling or rotating an image.\n\t * @param b  The value that affects the positioning of pixels along the\n\t *           <i>y</i> axis when rotating or skewing an image.\n\t * @param c  The value that affects the positioning of pixels along the\n\t *           <i>x</i> axis when rotating or skewing an image.\n\t * @param d  The value that affects the positioning of pixels along the\n\t *           <i>y</i> axis when scaling or rotating an image..\n\t * @param tx The distance by which to translate each point along the <i>x</i>\n\t *           axis.\n\t * @param ty The distance by which to translate each point along the <i>y</i>\n\t *           axis.\n\t */\n\tpublic setTo(a:number, b:number, c:number, d:number, tx:number, ty:number):void\n\t{\n\t\tthis.a = a;\n\t\tthis.b = b;\n\t\tthis.c = c;\n\t\tthis.d = d;\n\t\tthis.tx = tx;\n\t\tthis.ty = ty;\n\t}\n\n\t/**\n\t * Returns a text value listing the properties of the Matrix object.\n\t *\n\t * @return A string containing the values of the properties of the Matrix\n\t *         object: <code>a</code>, <code>b</code>, <code>c</code>,\n\t *         <code>d</code>, <code>tx</code>, and <code>ty</code>.\n\t */\n\tpublic toString():string\n\t{\n\t\treturn \"[Matrix] (a=\" + this.a + \", b=\" + this.b + \", c=\" + this.c + \", d=\" + this.d + \", tx=\" + this.tx + \", ty=\" + this.ty + \")\";\n\t}\n\n\t/**\n\t * Returns the result of applying the geometric transformation represented by\n\t * the Matrix object to the specified point.\n\t *\n\t * @param point The point for which you want to get the result of the Matrix\n\t *              transformation.\n\t * @return The point resulting from applying the Matrix transformation.\n\t */\n\tpublic transformPoint(point:Point):Point\n\t{\n\t\treturn new Point(point.x*this.a + point.y*this.c + this.tx, point.x*this.b + point.y*this.d + this.ty);\n\t}\n\n\t/**\n\t * Translates the matrix along the <i>x</i> and <i>y</i> axes, as specified\n\t * by the <code>dx</code> and <code>dy</code> parameters.\n\t *\n\t * @param dx The amount of movement along the <i>x</i> axis to the right, in\n\t *           pixels.\n\t * @param dy The amount of movement down along the <i>y</i> axis, in pixels.\n\t */\n\tpublic translate(dx:number, dy:number):void\n\t{\n\t\tthis.tx += dx;\n\t\tthis.ty += dy;\n\t}\n}\n\nexport = Matrix;","/**\n * A Quaternion object which can be used to represent rotations.\n */\nclass Orientation3D\n{\n\t/**\n\t * The axis angle orientation uses a combination of an axis and an angle to determine the orientation.\n\t * @type {string}\n\t */\n\tpublic static AXIS_ANGLE:string = \"axisAngle\";\n\n\t/**\n\t * The default orientation for decompose() and recompose() methods, defines the orientation with three separate angles of rotation for each axis.\n\t * @type {string}\n\t */\n\tpublic static EULER_ANGLES:string = \"eulerAngles\";\n\n\t/**\n\t * The quaternion orientation uses complex numbers.\n\t * @type {string}\n\t */\n\tpublic static QUATERNION:string = \"quaternion\";\n}\n\nexport = Orientation3D;","import Matrix3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Point\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\n\n/**\n * <p>The PerspectiveProjection class provides an easy way to assign or modify\n * the perspective transformations of a display object and all of its\n * children. For more complex or custom perspective transformations, use the\n * Matrix3D class. While the PerspectiveProjection class provides basic\n * three-dimensional presentation properties, the Matrix3D class provides more\n * detailed control over the three-dimensional presentation of display objects.\n * </p>\n *\n * <p>Projection is a way of representing a three-dimensional object in a\n * two-dimensional space, like a cube projected onto a computer screen.\n * Perspective projection uses a viewing frustum (a rectangular pyramid) to\n * model and project a three-dimensional world and its objects on the screen.\n * The viewing frustum becomes increasingly wider as it moves further from the\n * origin of the viewpoint. The origin of the viewpoint could be a camera or\n * the eyes of an observer facing the screen. The projected perspective\n * produces the illusion of three dimensions with depth and distance, where\n * the objects closer to the screen appear larger than the objects farther\n * from the screen.</p>\n *\n * <p>A default PerspectiveProjection object is a framework defined for\n * perspective transformation of the root object, based on the field of view\n * and aspect ratio (dimensions) of the stage. The projection center, the\n * vanishing point, is set to the center of the stage, which means the\n * three-dimensional display objects disappear toward the center of the stage\n * as they move back in the z axis. The default viewpoint is at point (0,0)\n * looking down the positive z axis. The y-axis points down toward the bottom\n * of the screen. You can gain access to the root display object's perspective\n * projection settings and change the field of view and projection center\n * properties of the perspectiveProjection property through the root object's\n * <code>DisplayObject.transform</code> property.</p>\n *\n * <p>You can also set a different perspective projection setting for a\n * display object through the parent's perspective projection. First, create a\n * PerspectiveProjection object and set its <code>fieldOfView</code> and\n * <code>projectionCenter</code> properties. Next, assign the\n * PerspectiveProjection object to the parent display object using the\n * <code>DisplayObject.transform</code> property. The specified projection\n * matrix and transformation will then apply to all the display object's\n * three-dimensional children.</p>\n *\n * <p>To modify a perspective projection of the stage or root object: use the\n * <code>transform.matrix</code> property of the root display object to gain\n * access to the PerspectiveProjection object. Or, apply different perspective\n * projection properties to a display object by setting the perspective\n * projection properties of the display object's parent. The child display\n * object inherits the new properties. Specifically, create a\n * PerspectiveProjection object and set its properties, then assign the\n * PerspectiveProjection object to the <code>perspectiveProjection</code>\n * property of the parent display object's <code>transform</code> property.\n * The specified projection transformation then applies to all the display\n * object's three-dimensional children.</p>\n *\n * <p>Since both PerspectiveProjection and Matrix3D objects perform\n * perspective transformations, do not assign both to a display object at the\n * same time. Use the PerspectiveProjection object for focal length and\n * projection center changes. For more control over the perspective\n * transformation, create a perspective projection Matrix3D object.</p>\n */\nclass PerspectiveProjection\n{\n\tprivate _matrix3D:Matrix3D;\n\n\t/**\n\t * Specifies an angle, as a degree between 0 and 180, for the field of\n\t * view in three dimensions. This value determines how strong the\n\t * perspective transformation and distortion apply to a\n\t * three-dimensional display object with a non-zero z-coordinate.\n\t *\n\t * <p>A degree close to 0 means that the screen's two-dimensional x-\n\t * and y-coordinates are roughly the same as the three-dimensional x-,\n\t * y-, and z-coordinates with little or no distortion. In other words,\n\t * for a small angle, a display object moving down the z axis appears\n\t * to stay near the same size and moves little.</p>\n\t *\n\t * <p>A value close to 180 degrees results in a fisheye projection effect:\n\t * positions with a z value smaller than 0 are magnified, while\n\t * positions with a z value larger than 0 are minimized. With a large\n\t * angle, a display object moving down the z axis appears to change\n\t * size quickly and moves a great distance. If the field of view is\n\t * set to 0 or 180, nothing is seen on the screen.</p>\n\t */\n\tpublic fieldOfView:number;\n\n\t/**\n\t * The distance between the eye or the viewpoint's origin (0,0,0) and\n\t * the display object located in the z axis. During the perspective\n\t * transformation, the <code>focalLength</code> is calculated\n\t * dynamically using the angle of the field of view and the stage's\n\t * aspect ratio (stage width divided by stage height).\n\t *\n\t * @see away.geom.PerspectiveProjection#fieldOfView\n\t */\n\tpublic focalLength:number;\n\n\t/**\n\t * A two-dimensional point representing the center of the projection,\n\t * the vanishing point for the display object.\n\t *\n\t * <p>The <code>projectionCenter</code> property is an offset to the\n\t * default registration point that is the upper left of the stage,\n\t * point (0,0). The default projection transformation center is in the\n\t * middle of the stage, which means the three-dimensional display\n\t * objects disappear toward the center of the stage as they move\n\t * backwards in the z axis.</p>\n\t */\n\tpublic projectionCenter:Point;\n\n\t/**\n\t * Creates an instance of a PerspectiveProjection object.\n\t */\n\tconstructor()\n\t{\n\n\t}\n\t/**\n\t * Returns the underlying Matrix3D object of the display object.\n\t *\n\t * <p>A display object, like the root object, can have a\n\t * PerspectiveProjection object without needing a Matrix3D property\n\t * defined for its transformations. In fact, use either a\n\t * PerspectiveProjection or a Matrix3D object to specify the\n\t * perspective transformation. If when using the PerspectiveProjection\n\t * object, a Matrix3D object was needed, the <code>toMatrix3D()</code>\n\t * method can retrieve the underlying Matrix3D object of the display\n\t * object. For example, the <code>toMatrix3D()</code> method can be\n\t * used with the <code>Utils3D.projectVectors()</code> method.</p>\n\t *\n\t * @see away.geom.Matrix3D\n\t */\n\tpublic toMatrix3D():Matrix3D\n\t{\n\t\treturn this._matrix3D;\n\t}\n}\n\nexport = PerspectiveProjection;","import PlaneClassification\t= require(\"awayjs-core/lib/geom/PlaneClassification\");\nimport Vector3D\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nclass Plane3D\n{\n\t/**\n\t * The A coefficient of this plane. (Also the x dimension of the plane normal)\n\t */\n\tpublic a:number;\n\n\t/**\n\t * The B coefficient of this plane. (Also the y dimension of the plane normal)\n\t */\n\tpublic b:number;\n\n\t/**\n\t * The C coefficient of this plane. (Also the z dimension of the plane normal)\n\t */\n\tpublic c:number;\n\n\t/**\n\t * The D coefficient of this plane. (Also the inverse dot product between normal and point)\n\t */\n\tpublic d:number;\n\n\tpublic _iAlignment:number;\n\n\t// indicates the alignment of the plane\n\tpublic static ALIGN_ANY:number = 0;\n\tpublic static ALIGN_XY_AXIS:number = 1;\n\tpublic static ALIGN_YZ_AXIS:number = 2;\n\tpublic static ALIGN_XZ_AXIS:number = 3;\n\n\t/**\n\t * Create a Plane3D with ABCD coefficients\n\t */\n\tconstructor(a:number = 0, b:number = 0, c:number = 0, d:number = 0)\n\t{\n\t\tthis.a = a;\n\t\tthis.b = b;\n\t\tthis.c = c;\n\t\tthis.d = d;\n\n\t\tif (a == 0 && b == 0) {\n\n\t\t\tthis._iAlignment = Plane3D.ALIGN_XY_AXIS;\n\n\t\t} else if (b == 0 && c == 0) {\n\n\t\t\tthis._iAlignment = Plane3D.ALIGN_YZ_AXIS;\n\n\t\t} else if (a == 0 && c == 0) {\n\n\t\t\tthis._iAlignment = Plane3D.ALIGN_XZ_AXIS;\n\n\t\t} else {\n\n\t\t\tthis._iAlignment = Plane3D.ALIGN_ANY;\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Fills this Plane3D with the coefficients from 3 points in 3d space.\n\t * @param p0 Vector3D\n\t * @param p1 Vector3D\n\t * @param p2 Vector3D\n\t */\n\tpublic fromPoints(p0:Vector3D, p1:Vector3D, p2:Vector3D)\n\t{\n\t\tvar d1x:number = p1.x - p0.x;\n\t\tvar d1y:number = p1.y - p0.y;\n\t\tvar d1z:number = p1.z - p0.z;\n\n\t\tvar d2x:number = p2.x - p0.x;\n\t\tvar d2y:number = p2.y - p0.y;\n\t\tvar d2z:number = p2.z - p0.z;\n\n\t\tthis.a = d1y*d2z - d1z*d2y;\n\t\tthis.b = d1z*d2x - d1x*d2z;\n\t\tthis.c = d1x*d2y - d1y*d2x;\n\t\tthis.d = this.a*p0.x + this.b*p0.y + this.c*p0.z;\n\n\t\t// not using epsilon, since a plane is infinite and a small incorrection can grow very large\n\t\tif (this.a == 0 && this.b == 0) {\n\n\t\t\tthis._iAlignment = Plane3D.ALIGN_XY_AXIS;\n\n\t\t} else if (this.b == 0 && this.c == 0) {\n\n\t\t\tthis._iAlignment = Plane3D.ALIGN_YZ_AXIS;\n\n\t\t} else if (this.a == 0 && this.c == 0) {\n\n\t\t\tthis._iAlignment = Plane3D.ALIGN_XZ_AXIS;\n\n\t\t} else {\n\n\t\t\tthis._iAlignment = Plane3D.ALIGN_ANY;\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Fills this Plane3D with the coefficients from the plane's normal and a point in 3d space.\n\t * @param normal Vector3D\n\t * @param point  Vector3D\n\t */\n\tpublic fromNormalAndPoint(normal:Vector3D, point:Vector3D)\n\t{\n\t\tthis.a = normal.x;\n\t\tthis.b = normal.y;\n\t\tthis.c = normal.z;\n\t\tthis.d = this.a*point.x + this.b*point.y + this.c*point.z;\n\t\tif (this.a == 0 && this.b == 0) {\n\n\t\t\tthis._iAlignment = Plane3D.ALIGN_XY_AXIS;\n\n\t\t} else if (this.b == 0 && this.c == 0) {\n\n\t\t\tthis._iAlignment = Plane3D.ALIGN_YZ_AXIS;\n\n\t\t} else if (this.a == 0 && this.c == 0) {\n\n\t\t\tthis._iAlignment = Plane3D.ALIGN_XZ_AXIS;\n\n\t\t} else {\n\n\t\t\tthis._iAlignment = Plane3D.ALIGN_ANY;\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Normalize this Plane3D\n\t * @return Plane3D This Plane3D.\n\t */\n\tpublic normalize():Plane3D\n\t{\n\t\tvar len:number = 1/Math.sqrt(this.a*this.a + this.b*this.b + this.c*this.c);\n\t\tthis.a *= len;\n\t\tthis.b *= len;\n\t\tthis.c *= len;\n\t\tthis.d *= len;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Returns the signed distance between this Plane3D and the point p.\n\t * @param p Vector3D\n\t * @returns Number\n\t */\n\tpublic distance(p:Vector3D):number\n\t{\n\n\t\tif (this._iAlignment == Plane3D.ALIGN_YZ_AXIS) {\n\n\t\t\treturn this.a*p.x - this.d;\n\n\t\t} else if (this._iAlignment == Plane3D.ALIGN_XZ_AXIS) {\n\t\t\treturn this.b*p.y - this.d;\n\t\t}\n\n\t\telse if (this._iAlignment == Plane3D.ALIGN_XY_AXIS) {\n\n\t\t\treturn this.c*p.z - this.d;\n\n\t\t} else {\n\n\t\t\treturn this.a*p.x + this.b*p.y + this.c*p.z - this.d;\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Classify a point against this Plane3D. (in front, back or intersecting)\n\t * @param p Vector3D\n\t * @return int Plane3.FRONT or Plane3D.BACK or Plane3D.INTERSECT\n\t */\n\tpublic classifyPoint(p:Vector3D, epsilon:number = 0.01):number\n\t{\n\t\t// check NaN\n\t\tif (this.d != this.d)\n\t\t\treturn PlaneClassification.FRONT;\n\n\t\tvar len:number;\n\t\tif (this._iAlignment == Plane3D.ALIGN_YZ_AXIS)\n\t\t\tlen = this.a*p.x - this.d; else if (this._iAlignment == Plane3D.ALIGN_XZ_AXIS)\n\t\t\tlen = this.b*p.y - this.d; else if (this._iAlignment == Plane3D.ALIGN_XY_AXIS)\n\t\t\tlen = this.c*p.z - this.d; else\n\t\t\tlen = this.a*p.x + this.b*p.y + this.c*p.z - this.d;\n\n\t\tif (len < -epsilon)\n\t\t\treturn PlaneClassification.BACK; else if (len > epsilon)\n\t\t\treturn PlaneClassification.FRONT; else\n\t\t\treturn PlaneClassification.INTERSECT;\n\t}\n\n\tpublic toString():string\n\t{\n\t\treturn \"Plane3D [a:\" + this.a + \", b:\" + this.b + \", c:\" + this.c + \", d:\" + this.d + \"]\";\n\t}\n}\n\nexport = Plane3D;","class PlaneClassification\n{\n\t// \"back\" is synonymous with \"in\", but used for planes (back of plane is \"inside\" a solid volume walled by a plane)\n\tpublic static BACK:number = 0;\n\tpublic static FRONT:number = 1;\n\n\tpublic static IN:number = 0;\n\tpublic static OUT:number = 1;\n\tpublic static INTERSECT:number = 2;\n\n}\n\nexport = PlaneClassification;","/**\n * The Point object represents a location in a two-dimensional coordinate\n * system, where <i>x</i> represents the horizontal axis and <i>y</i>\n * represents the vertical axis.\n *\n * <p>The following code creates a point at(0,0):</p>\n *\n * <p>Methods and properties of the following classes use Point objects:</p>\n *\n * <ul>\n *   <li>BitmapData</li>\n *   <li>DisplayObject</li>\n *   <li>DisplayObjectContainer</li>\n *   <li>DisplacementMapFilter</li>\n *   <li>NativeWindow</li>\n *   <li>Matrix</li>\n *   <li>Rectangle</li>\n * </ul>\n *\n * <p>You can use the <code>new Point()</code> constructor to create a Point\n * object.</p>\n */\nclass Point\n{\n\t/**\n\t * The horizontal coordinate of the point. The default value is 0.\n\t */\n\tpublic x:number;\n\n\t/**\n\t * The vertical coordinate of the point. The default value is 0.\n\t */\n\tpublic y:number;\n\n\t/**\n\t * The length of the line segment from(0,0) to this point.\n\t */\n\tpublic get length():number\n\t{\n\t\treturn Math.sqrt(this.x*this.x + this.y*this.y);\n\t}\n\n\t/**\n\t * Creates a new point. If you pass no parameters to this method, a point is\n\t * created at(0,0).\n\t *\n\t * @param x The horizontal coordinate.\n\t * @param y The vertical coordinate.\n\t */\n\tconstructor(x:number = 0, y:number = 0)\n\t{\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t}\n\n\t/**\n\t * Adds the coordinates of another point to the coordinates of this point to\n\t * create a new point.\n\t *\n\t * @param v The point to be added.\n\t * @return The new point.\n\t */\n\tpublic add(v:Point):Point\n\t{\n\t\treturn new Point(this.x + v.x, this.y + v.y);\n\t}\n\n\t/**\n\t * Creates a copy of this Point object.\n\t *\n\t * @return The new Point object.\n\t */\n\tpublic clone():Point\n\t{\n\t\treturn new Point(this.x, this.y);\n\t}\n\n\tpublic copyFrom(sourcePoint:Point)\n\t{\n\n\t}\n\n\t/**\n\t * Determines whether two points are equal. Two points are equal if they have\n\t * the same <i>x</i> and <i>y</i> values.\n\t *\n\t * @param toCompare The point to be compared.\n\t * @return A value of <code>true</code> if the object is equal to this Point\n\t *         object; <code>false</code> if it is not equal.\n\t */\n\tpublic equals(toCompare:Point):boolean\n\t{\n\t\treturn (this.x == toCompare.x && this.y == toCompare.y);\n\t}\n\n\t/**\n\t * Scales the line segment between(0,0) and the current point to a set\n\t * length.\n\t *\n\t * @param thickness The scaling value. For example, if the current point is\n\t *                 (0,5), and you normalize it to 1, the point returned is\n\t *                  at(0,1).\n\t */\n\tpublic normalize(thickness:number = 1)\n\t{\n\t\tif (this.length != 0) {\n\t\t\tvar invLength = thickness/this.length;\n\t\t\tthis.x *= invLength;\n\t\t\tthis.y *= invLength;\n\t\t\treturn;\n\t\t}\n\t\tthrow \"Cannot divide by zero length.\";\n\t}\n\n\t/**\n\t * Offsets the Point object by the specified amount. The value of\n\t * <code>dx</code> is added to the original value of <i>x</i> to create the\n\t * new <i>x</i> value. The value of <code>dy</code> is added to the original\n\t * value of <i>y</i> to create the new <i>y</i> value.\n\t *\n\t * @param dx The amount by which to offset the horizontal coordinate,\n\t *           <i>x</i>.\n\t * @param dy The amount by which to offset the vertical coordinate, <i>y</i>.\n\t */\n\tpublic offset(dx:number, dy:number)\n\t{\n\t\tthis.x += dx;\n\t\tthis.y += dy;\n\t}\n\n\tpublic setTo(xa:number, ya:number)\n\t{\n\n\t}\n\n\t/**\n\t * Subtracts the coordinates of another point from the coordinates of this\n\t * point to create a new point.\n\t *\n\t * @param v The point to be subtracted.\n\t * @return The new point.\n\t */\n\tpublic subtract(v:Point):Point\n\t{\n\t\treturn new Point(this.x - v.x, this.y - v.y);\n\t}\n\n\t/**\n\t * Returns a string that contains the values of the <i>x</i> and <i>y</i>\n\t * coordinates. The string has the form <code>\"(x=<i>x</i>,\n\t * y=<i>y</i>)\"</code>, so calling the <code>toString()</code> method for a\n\t * point at 23,17 would return <code>\"(x=23, y=17)\"</code>.\n\t *\n\t * @return The string representation of the coordinates.\n\t */\n\tpublic toString():string\n\t{\n\t\treturn \"[Point] (x=\" + this.x + \", y=\" + this.y + \")\";\n\t}\n\n\t/**\n\t * Returns the distance between <code>pt1</code> and <code>pt2</code>.\n\t *\n\t * @param pt1 The first point.\n\t * @param pt2 The second point.\n\t * @return The distance between the first and second points.\n\t */\n\tpublic static distance(pt1:Point, pt2:Point):number\n\t{\n\t\tvar dx:number = pt2.x - pt1.x;\n\t\tvar dy:number = pt2.y - pt1.y;\n\n\t\treturn Math.sqrt(dx*dx + dy*dy);\n\t}\n\n\t/**\n\t * Determines a point between two specified points. The parameter\n\t * <code>f</code> determines where the new interpolated point is located\n\t * relative to the two end points specified by parameters <code>pt1</code>\n\t * and <code>pt2</code>. The closer the value of the parameter <code>f</code>\n\t * is to <code>1.0</code>, the closer the interpolated point is to the first\n\t * point(parameter <code>pt1</code>). The closer the value of the parameter\n\t * <code>f</code> is to 0, the closer the interpolated point is to the second\n\t * point(parameter <code>pt2</code>).\n\t *\n\t * @param pt1 The first point.\n\t * @param pt2 The second point.\n\t * @param f   The level of interpolation between the two points. Indicates\n\t *            where the new point will be, along the line between\n\t *            <code>pt1</code> and <code>pt2</code>. If <code>f</code>=1,\n\t *            <code>pt1</code> is returned; if <code>f</code>=0,\n\t *            <code>pt2</code> is returned.\n\t * @return The new, interpolated point.\n\t */\n\tpublic static interpolate(pt1:Point, pt2:Point, f:number):Point\n\t{\n\t\treturn new Point(pt2.x + (pt1.x - pt2.x)*f, pt2.y + (pt1.y - pt2.y)*f);\n\t}\n\n\t/**\n\t * Converts a pair of polar coordinates to a Cartesian point coordinate.\n\t *\n\t * @param len   The length coordinate of the polar pair.\n\t * @param angle The angle, in radians, of the polar pair.\n\t * @return The Cartesian point.\n\t */\n\tpublic static polar(len:number, angle:number):Point\n\t{\n\t\treturn new Point(len*Math.cos(angle), len*Math.sin(angle));\n\t}\n}\n\nexport = Point;\n","class PoissonLookup\n{\n\tpublic static _distributions:Array<Array<number>>;\n\n\tpublic static initDistributions():void\n\t{\n\t\t// precalculated for best control\n\t\tthis._distributions = new Array<Array<number>>();\n\t\tthis._distributions[0] = new Array<number>(0.3082841, 0.4320919);\n\t\tthis._distributions[1] = new Array<number>(0.3082841, 0.4320919, -0.2274942, -0.6640266);\n\t\tthis._distributions[2] = new Array<number>(0.8742689, 0.0009265686, -0.6864116, -0.5536607, -0.2325206, 0.7678371);\n\t\tthis._distributions[3] = new Array<number>(0.3913446, -0.7084417, -0.7511101, -0.5935929, -0.2323436, 0.5320091, 0.8435315, 0.5035911);\n\t\tthis._distributions[4] = new Array<number>(0.2122471, -0.5771395, -0.8543506, -0.1763534, 0.5189021, 0.8323698, -0.3616908, 0.5865368, 0.9523004, -0.04948437);\n\t\tthis._distributions[5] = new Array<number>(0.5791035, 0.3496495, 0.2959551, -0.6006749, -0.2419119, -0.06879545, -0.7403072, 0.6110353, -0.04555973, 0.8059174, -0.5275017, -0.737129);\n\t\tthis._distributions[6] = new Array<number>(0.06941478, 0.8519508, -0.7441907, 0.2426432, 0.6439992, -0.2405252, -0.1007523, -0.2327587, -0.6427067, -0.7248485, 0.8050759, 0.5492936, 0.3573822, -0.8824506);\n\t\tthis._distributions[7] = new Array<number>(0.8509863, 0.4452587, -0.09507271, 0.2073005, 0.1706571, -0.6434793, 0.8029777, -0.2718274, -0.4401725, 0.8196304, 0.2715359, 0.8598521, -0.8121575, -0.006447683, -0.6486837, -0.7237598);\n\t\tthis._distributions[8] = new Array<number>(0.6951686, -0.2680728, -0.04933243, 0.3710589, 0.6592212, 0.3661054, -0.01579228, -0.6909603, -0.3275101, -0.1756866, 0.3811549, 0.9218544, -0.216032, 0.9755028, -0.7065172, 0.3355389, -0.6579109, -0.6798355);\n\t\tthis._distributions[9] = new Array<number>(0.6181276, -0.09790418, -0.2537868, -0.5570995, -0.1964931, 0.3459414, 0.3474613, -0.8885581, 0.5135743, 0.5753114, -0.9549091, 0.1480672, -0.8711916, -0.4293123, -0.6928071, 0.6190156, -0.13369, 0.8892705, 0.0548224, -0.1246777);\n\t\tthis._distributions[10] = new Array<number>(0.4853027, -0.5080479, -0.1331675, -0.506597, 0.139575, 0.01316885, 0.803486, -0.07568797, 0.5240274, 0.4883182, -0.4334005, 0.1207938, -0.7794577, -0.3985141, 0.1576432, -0.9861221, -0.3712867, 0.6959021, 0.1517378, 0.9847429, -0.9762396, 0.1661073);\n\t\tthis._distributions[11] = new Array<number>(-0.2790166, -0.01252619, 0.3389016, 0.3921154, 0.2408341, -0.313211, -0.8151779, -0.3898362, -0.6347761, 0.3486495, 0.09471484, -0.7722448, -0.1385674, 0.6364574, 0.2456331, 0.9295807, -0.3864306, -0.8247881, 0.6111673, -0.7164014, 0.8287669, 0.05466961, 0.837706, 0.5415626);\n\t\tthis._distributions[12] = new Array<number>(0.056417, 0.3185693, -0.8245888, 0.1882799, 0.8575996, 0.1136829, 0.1070375, 0.875332, 0.4076743, -0.06000621, -0.4311306, 0.7239349, 0.2677574, -0.538472, -0.08486642, -0.2083647, -0.888989, -0.3906443, -0.4768958, -0.6664082, 0.09334993, -0.9861541, 0.808736, -0.455949, 0.5889823, 0.7660807);\n\t\tthis._distributions[13] = new Array<number>(-0.2681346, -0.3955857, -0.1315102, -0.8852947, -0.5143692, 0.09551838, 0.4344836, -0.546945, -0.8620899, -0.3813288, 0.1650431, 0.02034803, -0.1543657, 0.3842218, -0.828457, 0.5376903, -0.6145, -0.7818927, -0.2639062, 0.8784655, 0.1912684, 0.9720125, 0.3135219, 0.5224229, 0.7850655, 0.4592297, 0.7465045, -0.1368916);\n\t\tthis._distributions[14] = new Array<number>(0.4241029, 0.695281, 0.150511, -0.02304107, -0.2482675, 0.9120338, 0.8057325, 0.2622084, -0.2445909, 0.2765962, 0.8588713, -0.1772072, 0.3117845, -0.4385471, -0.3923851, -0.3298936, -0.1751254, -0.7405846, 0.6926506, -0.684163, -0.9304563, -0.3254691, -0.8533293, 0.1523024, 0.2510415, -0.917345, -0.6239773, -0.7105472, -0.6104624, 0.6041355);\n\t\tthis._distributions[15] = new Array<number>(0.5844554, 0.06651045, 0.1343258, 0.6756578, 0.3799674, -0.6301104, 0.5590436, 0.7940555, 0.09574714, 0.02262517, 0.8697868, 0.393301, 0.003945862, -0.421735, 0.9043913, -0.2432393, -0.4844007, 0.7190998, -0.3201078, 0.2972371, -0.3852352, -0.6341155, -0.5413069, -0.09223081, -0.8468984, -0.5126905, 0.004156174, -0.8633173, -0.9681889, -0.03305046, -0.846509, 0.4414353);\n\t\tthis._distributions[16] = new Array<number>(0.4506488, 0.657668, 0.4621297, 0.07441051, -0.2782125, 0.6201044, 0.9750003, 0.09110117, 0.1019436, 0.2986514, 0.03457398, 0.9631706, 0.542098, -0.5505635, 0.8675668, 0.4938077, -0.5414361, 0.2655292, -0.7941836, 0.6003053, -0.09847672, -0.1001604, -0.9316511, -0.08572888, 0.07286467, -0.611899, -0.5232627, -0.4082253, -0.5481608, -0.827938, -0.1551939, -0.9621193, 0.9220031, -0.3315949);\n\t\tthis._distributions[17] = new Array<number>(0.197908, -0.4697656, -0.4474689, -0.3428435, 0.8529873, -0.2228634, 0.6022478, -0.5469642, 0.2545276, -0.931133, -0.1507547, -0.7855865, -0.07606658, 0.1011628, 0.3046715, 0.2785755, 0.4698432, -0.1064076, 0.6831254, 0.4152522, 0.1374381, 0.8363233, -0.2166121, 0.6682042, 0.5511393, 0.7996449, -0.4278994, 0.28836, -0.8875198, 0.2181732, -0.8772842, -0.2818254, -0.7000262, 0.5762185, -0.6062385, -0.7439126);\n\t\tthis._distributions[18] = new Array<number>(0.6645703, -0.05678739, 0.5720971, 0.4533803, -0.07660709, 0.08802763, 0.5163431, -0.4426552, 0.1163455, -0.3404382, -0.4004807, -0.5046007, 0.2932099, -0.8201418, -0.5322125, 0.03834766, -0.1490209, -0.8817304, -0.8000439, -0.3509448, 0.5260983, 0.8421043, 0.1197811, 0.6963812, 0.9498612, 0.3122156, -0.9285746, 0.02120355, -0.6670724, 0.7217396, 0.9155889, -0.3510147, -0.271941, 0.4727852, 0.318879, 0.1634057, -0.2686755, 0.9253026);\n\t\tthis._distributions[19] = new Array<number>(0.5064292, 0.422527, 0.8935515, -0.06610427, 0.1199719, 0.175568, 0.403388, -0.2003276, 0.1657927, 0.8154403, 0.9301245, 0.2929218, -0.1644068, 0.6201534, 0.7113559, -0.6589743, -0.3364046, -0.1799502, 0.02109996, -0.392765, -0.382213, 0.3219992, -0.9201946, 0.1207967, -0.726185, 0.4291916, -0.7443482, -0.2480059, -0.5147594, 0.7418784, 0.1935272, -0.7406143, -0.3643523, -0.5559214, -0.7147766, -0.6326278, -0.2524151, -0.9096627, 0.5161405, 0.7908453);\n\t\tthis._distributions[20] = new Array<number>(0.7921003, -0.3032096, 0.5992879, -0.009052323, 0.2538549, -0.1872749, 0.7053444, 0.3677175, 0.5417761, -0.8170255, 0.9749611, 0.1210478, 0.1969143, -0.6117041, -0.1824499, -0.4634196, -0.1181338, -0.8668742, -0.3050112, -0.1352596, -0.4409327, -0.7082354, -0.03225285, 0.1171548, 0.3113096, 0.3250439, -0.8166144, -0.463995, -0.01014475, 0.4715334, -0.6868284, 0.05091889, -0.4011163, 0.2717285, -0.06756835, 0.8307694, -0.7938535, 0.4352129, -0.4663842, 0.7165329, 0.559729, 0.8093995);\n\t\tthis._distributions[21] = new Array<number>(0.07832243, 0.426151, -0.3856795, 0.5799953, 0.01970797, 0.06706189, 0.4822682, 0.3014512, -0.1532982, 0.87485, -0.4959527, 0.07888043, 0.260601, -0.2304784, 0.4996209, 0.7167382, 0.585986, -0.04265174, -0.7679967, 0.5509416, -0.9041753, 0.1802134, -0.8407655, -0.4442826, -0.2058258, -0.2636995, -0.4984115, -0.5928579, 0.2926032, -0.7886473, -0.06933882, -0.621177, 0.578115, -0.4813387, 0.8981777, -0.3291056, 0.1942733, 0.9255584, 0.8084362, 0.5066984, 0.9920095, 0.03103104, -0.2403206, -0.9389018);\n\t\tthis._distributions[22] = new Array<number>(-0.5691095, 0.1014316, -0.7788262, 0.384012, -0.8253665, -0.1645582, -0.1830993, 0.002997211, -0.2555013, -0.4177977, -0.6640869, -0.4794711, -0.2351242, 0.5850121, 0.02436554, 0.2825883, 0.006061143, -0.8200245, 0.1618791, -0.3063331, -0.3765897, -0.7249815, 0.6092919, -0.6769328, -0.5956934, 0.6957655, 0.5383642, 0.4522677, -0.1489165, 0.9125596, 0.4167473, 0.1335986, 0.1898309, 0.5874342, 0.2288171, 0.9624356, 0.7540846, -0.07672304, 0.8986252, 0.2788797, 0.3555991, -0.9262139, 0.8454325, -0.4027667, 0.4945236, -0.2935512);\n\t\tthis._distributions[23] = new Array<number>(-0.4481403, -0.3758374, -0.8877251, 0.08739938, 0.05015831, -0.1339983, -0.4070427, -0.8534173, 0.1019274, -0.5503222, -0.445998, 0.1997541, -0.8686263, -0.2788867, -0.7695944, -0.6033704, -0.05515742, -0.885711, -0.7714347, 0.5790485, 0.3466263, -0.8799297, 0.4487582, -0.5321087, -0.2461368, 0.6053771, -0.05568117, 0.2457351, -0.4668669, 0.8523816, 0.8103387, -0.4255538, 0.4054182, -0.175663, -0.2802011, -0.08920153, 0.2665959, 0.382935, 0.555679, 0.1621837, 0.105246, 0.8420411, 0.6921161, 0.6902903, 0.880946, 0.2483067, 0.9699264, -0.1021767);\n\t\tthis._distributions[24] = new Array<number>(-0.1703323, -0.3119385, 0.2916039, -0.2988263, -0.008472982, -0.9277695, -0.7730271, -0.3277904, 0.3440474, -0.6815342, -0.2910278, 0.03461745, -0.6764899, -0.657078, -0.3505501, -0.7311988, -0.03478927, 0.3258755, -0.6048835, 0.159423, 0.2035525, 0.02212214, 0.5116573, 0.2226856, 0.6664805, -0.2500189, 0.7147882, -0.6609634, 0.03030632, -0.5763278, -0.2516585, 0.6116219, -0.9434413, -0.0116792, 0.9061816, 0.2491155, 0.182867, 0.6076167, 0.286593, 0.9485695, -0.5992439, 0.6970096, -0.2082874, 0.9416641, 0.9880044, -0.1541709, -0.9122881, 0.331555, 0.7324886, 0.6725098);\n\t\tthis._distributions[25] = new Array<number>(0.3869598, -0.04974834, 0.7168844, -0.0693711, -0.07166742, 0.1725325, 0.4599592, 0.3232779, 0.5872094, -0.4198674, 0.2442266, -0.625667, 0.1254557, 0.4500048, -0.2290154, -0.1803567, 0.890583, 0.3373493, 0.1256081, 0.7853789, -0.2676466, 0.5305805, -0.7063224, 0.252168, -0.3989835, 0.1189921, 0.09617215, -0.2451447, 0.6302541, 0.6085876, 0.9380925, -0.3234899, 0.5086241, -0.8573482, 0.03576187, -0.9876697, -0.0876712, -0.6365195, -0.5276513, 0.823456, -0.6935764, -0.2240411, -0.5212318, -0.5383121, -0.2116208, 0.9639363, -0.9840096, 0.02743555, -0.3991577, -0.8994547, -0.7830126, 0.614068);\n\t\tthis._distributions[26] = new Array<number>(-0.8366601, 0.4464895, -0.5917366, -0.02073906, -0.9845258, 0.1635625, -0.3097973, 0.4379579, -0.5478154, 0.7173221, -0.1685888, 0.9261969, 0.01503595, 0.6046097, 0.4452421, 0.5449086, 0.0315687, 0.1944619, 0.3753404, 0.8688548, 0.4143643, 0.1396648, 0.8711032, 0.4304703, 0.7328773, 0.1461501, 0.6374492, -0.3521495, 0.145613, -0.1341466, 0.9040975, -0.135123, -0.7839059, -0.5450199, -0.516019, -0.3320859, -0.206158, -0.4431106, -0.9703014, -0.2368356, -0.2473119, -0.0864351, 0.2130725, -0.4604077, -0.003726701, -0.7122303, -0.4072131, -0.6833169, 0.1632999, -0.9776646, 0.4686888, -0.680495, -0.2293511, -0.9509777);\n\t\tthis._distributions[27] = new Array<number>(0.107311, -0.1311369, -0.4194764, -0.3148777, 0.6171439, -0.2745973, 0.2796618, 0.1937153, -0.09106886, 0.4180236, 0.6044006, 0.05577846, 0.02927299, -0.6738263, -0.2580845, 0.1179939, -0.09023564, -0.3830024, 0.3570953, -0.5000587, 0.81591, -0.5518309, 0.9300217, -0.1257987, 0.4904627, -0.8381903, -0.3163182, -0.8632009, 0.1137595, -0.9875998, 0.8390043, 0.3538185, 0.2149114, 0.4993694, 0.5191584, 0.3833552, 0.5002763, 0.7061465, -0.2567276, 0.9068756, -0.5197366, 0.3467845, 0.03668867, 0.9734009, -0.5347553, 0.66747, -0.9028882, 0.1023768, -0.8967977, 0.412834, -0.5821944, 0.0426479, -0.8032165, -0.2397038, -0.5597343, -0.6358021);\n\t\tthis._distributions[28] = new Array<number>(-0.6562496, -0.1781036, -0.9301494, 0.1185208, -0.3861143, -0.4153562, -0.1560799, -0.1099607, -0.5587025, 0.395218, -0.5322112, -0.699701, -0.5008639, 0.08726846, -0.970524, -0.1963461, -0.813577, -0.5185111, -0.1644458, 0.298, -0.3216791, 0.639982, 0.3315373, 0.3339162, 0.2383235, -0.00105722, 0.1137828, 0.5450742, -0.01899921, 0.8798413, 0.2849685, 0.8255596, 0.6974412, 0.2123175, 0.7588523, 0.5470437, 0.5102502, -0.1687844, 0.5853448, 0.8033476, 0.2590716, -0.5262504, 0.5607718, -0.6342825, 0.8666443, -0.1491841, 0.8341052, -0.4935003, -0.1568441, -0.6634066, 0.2512113, -0.8769391, -0.2559827, -0.9572457, -0.01928852, -0.3966542, -0.750667, 0.6409678);\n\t\tthis._distributions[29] = new Array<number>(0.3454786, -0.04837726, 0.2649553, 0.2406852, 0.5599093, -0.3839145, -0.1111814, -0.05502108, 0.7586042, -0.05818377, 0.2519488, -0.4665135, -0.1264972, 0.2602723, -0.08766216, -0.3671907, 0.6428129, 0.3999204, -0.6105871, -0.1246869, -0.4589451, -0.7646643, -0.03021116, -0.7899352, -0.6036922, -0.4293956, -0.2481938, 0.6534185, 0.102798, 0.6784465, -0.6392644, 0.4821358, -0.6789002, 0.1779133, -0.9140783, -0.1989647, -0.9262617, 0.3381507, 0.4794891, -0.8093274, 0.3959447, 0.668478, 0.9602883, 0.2272305, -0.123672, 0.9210883, 0.2375148, 0.9523395, -0.52898, 0.7973378, -0.382433, 0.1228794, 0.695015, 0.6948439, 0.7530277, -0.6458191, 0.8777987, -0.3272956, 0.2318525, -0.962768);\n\t\tthis._distributions[30] = new Array<number>(0.4518921, -0.1146195, 0.4720805, -0.4238748, 0.3655423, 0.1806341, 0.1589939, -0.23568, 0.7673324, -0.5149941, 0.01163658, 0.09045836, 0.7010971, 0.1245747, 0.7518286, -0.1855433, 0.4960719, 0.4601022, 0.2566979, -0.6308268, -0.0654714, -0.5126389, -0.1823319, -0.1343282, -0.1464312, 0.4883236, -0.3858738, 0.203523, 0.1484799, 0.4432284, -0.477109, -0.116241, 0.2719092, 0.7208626, 0.9104174, 0.3578536, -0.5956199, 0.7662588, -0.6996251, 0.3678654, -0.2514512, 0.9251933, 0.1275825, -0.9478135, -0.204608, -0.8611552, 0.4264838, -0.877443, 0.9854161, 0.05521112, 0.5912951, 0.7997434, 0.1140349, 0.982093, -0.9324368, -0.2094094, -0.42436, -0.6441524, -0.6722705, -0.3554261, -0.7844236, 0.08587621);\n\t\tthis._distributions[31] = new Array<number>(-0.4206714, -0.5613642, -0.8733016, -0.3373051, -0.1046226, -0.2902999, -0.1318562, -0.8434365, 0.1145093, -0.5962623, -0.4965627, -0.1873259, -0.5011808, -0.8546229, -0.7165636, -0.5743566, 0.1090901, 0.2017643, 0.3404809, -0.220455, -0.1989015, 0.2372122, -0.4538706, 0.0979171, 0.4514146, -0.572846, 0.2314168, -0.8514503, -0.4247236, 0.5650803, -0.943347, 0.04514639, -0.1309718, 0.5221877, -0.7004157, 0.4561877, 0.6306441, 0.04448673, 0.4301621, 0.5766876, 0.1078042, 0.7245752, 0.3875354, 0.2794483, 0.702876, -0.2924213, 0.7360667, -0.6210318, 0.7486517, 0.6531103, 0.4898235, 0.8591025, 0.6549174, 0.3854057, -0.2596106, 0.7916998, 0.9251194, -0.05296265, -0.5620695, 0.820877, -0.01228026, 0.9937211, 0.9612103, 0.2628758);\n\t}\n\n\tpublic static getDistribution(n:number /*int*/):Array<number>\n\t{\n\t\tif (!this._distributions)\n\t\t\tthis.initDistributions();\n\n\t\tif (n < 2 || n > 32)\n\t\t\treturn null;\n\n\t\treturn this._distributions[n - 1];\n\t}\n}\n\nexport = PoissonLookup;","import Matrix3DUtils\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\nimport Orientation3D\t\t= require(\"awayjs-core/lib/geom/Orientation3D\");\nimport Matrix3D\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Vector3D\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\n/**\n * A Quaternion object which can be used to represent rotations.\n */\nclass Quaternion\n{\n\t/**\n\t * The x value of the quaternion.\n\t */\n\tpublic x:number = 0;\n\n\t/**\n\t * The y value of the quaternion.\n\t */\n\tpublic y:number = 0;\n\n\t/**\n\t * The z value of the quaternion.\n\t */\n\tpublic z:number = 0;\n\n\t/**\n\t * The w value of the quaternion.\n\t */\n\tpublic w:number = 1;\n\n\t/**\n\t * Creates a new Quaternion object.\n\t * @param x The x value of the quaternion.\n\t * @param y The y value of the quaternion.\n\t * @param z The z value of the quaternion.\n\t * @param w The w value of the quaternion.\n\t */\n\tconstructor(x:number = 0, y:number = 0, z:number = 0, w:number = 1)\n\t{\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t\tthis.w = w;\n\t}\n\n\t/**\n\t * Returns the magnitude of the quaternion object.\n\t */\n\tpublic get magnitude():number\n\t{\n\t\treturn Math.sqrt(this.w*this.w + this.x*this.x + this.y*this.y + this.z*this.z);\n\t}\n\n\t/**\n\t * Fills the quaternion object with the result from a multiplication of two quaternion objects.\n\t *\n\t * @param    qa    The first quaternion in the multiplication.\n\t * @param    qb    The second quaternion in the multiplication.\n\t */\n\tpublic multiply(qa:Quaternion, qb:Quaternion)\n\t{\n\t\tvar w1:number = qa.w, x1:number = qa.x, y1:number = qa.y, z1:number = qa.z;\n\t\tvar w2:number = qb.w, x2:number = qb.x, y2:number = qb.y, z2:number = qb.z;\n\n\t\tthis.w = w1*w2 - x1*x2 - y1*y2 - z1*z2;\n\t\tthis.x = w1*x2 + x1*w2 + y1*z2 - z1*y2;\n\t\tthis.y = w1*y2 - x1*z2 + y1*w2 + z1*x2;\n\t\tthis.z = w1*z2 + x1*y2 - y1*x2 + z1*w2;\n\t}\n\n\tpublic multiplyVector(vector:Vector3D, target:Quaternion = null):Quaternion\n\t{\n\t\t//target ||= new Quaternion();\n\t\tif (target === null) {\n\t\t\ttarget = new Quaternion();\n\n\t\t}\n\n\n\t\tvar x2:number = vector.x;\n\t\tvar y2:number = vector.y;\n\t\tvar z2:number = vector.z;\n\n\t\ttarget.w = -this.x*x2 - this.y*y2 - this.z*z2;\n\t\ttarget.x = this.w*x2 + this.y*z2 - this.z*y2;\n\t\ttarget.y = this.w*y2 - this.x*z2 + this.z*x2;\n\t\ttarget.z = this.w*z2 + this.x*y2 - this.y*x2;\n\n\t\treturn target;\n\t}\n\n\t/**\n\t * Fills the quaternion object with values representing the given rotation around a vector.\n\t *\n\t * @param    axis    The axis around which to rotate\n\t * @param    angle    The angle in radians of the rotation.\n\t */\n\tpublic fromAxisAngle(axis:Vector3D, angle:number)\n\t{\n\t\tvar sin_a:number = Math.sin(angle/2);\n\t\tvar cos_a:number = Math.cos(angle/2);\n\n\t\tthis.x = axis.x*sin_a;\n\t\tthis.y = axis.y*sin_a;\n\t\tthis.z = axis.z*sin_a;\n\t\tthis.w = cos_a;\n\n\t\tthis.normalize();\n\t}\n\n\t/**\n\t * Spherically interpolates between two quaternions, providing an interpolation between rotations with constant angle change rate.\n\t * @param qa The first quaternion to interpolate.\n\t * @param qb The second quaternion to interpolate.\n\t * @param t The interpolation weight, a value between 0 and 1.\n\t */\n\tpublic slerp(qa:Quaternion, qb:Quaternion, t:number)\n\t{\n\t\tvar w1:number = qa.w, x1:number = qa.x, y1:number = qa.y, z1:number = qa.z;\n\t\tvar w2:number = qb.w, x2:number = qb.x, y2:number = qb.y, z2:number = qb.z;\n\t\tvar dot:number = w1*w2 + x1*x2 + y1*y2 + z1*z2;\n\n\t\t// shortest direction\n\t\tif (dot < 0) {\n\t\t\tdot = -dot;\n\t\t\tw2 = -w2;\n\t\t\tx2 = -x2;\n\t\t\ty2 = -y2;\n\t\t\tz2 = -z2;\n\t\t}\n\n\t\tif (dot < 0.95) {\n\t\t\t// interpolate angle linearly\n\t\t\tvar angle:number = Math.acos(dot);\n\t\t\tvar s:number = 1/Math.sin(angle);\n\t\t\tvar s1:number = Math.sin(angle*(1 - t))*s;\n\t\t\tvar s2:number = Math.sin(angle*t)*s;\n\t\t\tthis.w = w1*s1 + w2*s2;\n\t\t\tthis.x = x1*s1 + x2*s2;\n\t\t\tthis.y = y1*s1 + y2*s2;\n\t\t\tthis.z = z1*s1 + z2*s2;\n\t\t} else {\n\t\t\t// nearly identical angle, interpolate linearly\n\t\t\tthis.w = w1 + t*(w2 - w1);\n\t\t\tthis.x = x1 + t*(x2 - x1);\n\t\t\tthis.y = y1 + t*(y2 - y1);\n\t\t\tthis.z = z1 + t*(z2 - z1);\n\t\t\tvar len:number = 1.0/Math.sqrt(this.w*this.w + this.x*this.x + this.y*this.y + this.z*this.z);\n\t\t\tthis.w *= len;\n\t\t\tthis.x *= len;\n\t\t\tthis.y *= len;\n\t\t\tthis.z *= len;\n\t\t}\n\t}\n\n\t/**\n\t * Linearly interpolates between two quaternions.\n\t * @param qa The first quaternion to interpolate.\n\t * @param qb The second quaternion to interpolate.\n\t * @param t The interpolation weight, a value between 0 and 1.\n\t */\n\tpublic lerp(qa:Quaternion, qb:Quaternion, t:number)\n\t{\n\t\tvar w1:number = qa.w, x1:number = qa.x, y1:number = qa.y, z1:number = qa.z;\n\t\tvar w2:number = qb.w, x2:number = qb.x, y2:number = qb.y, z2:number = qb.z;\n\t\tvar len:number;\n\n\t\t// shortest direction\n\t\tif (w1*w2 + x1*x2 + y1*y2 + z1*z2 < 0) {\n\t\t\tw2 = -w2;\n\t\t\tx2 = -x2;\n\t\t\ty2 = -y2;\n\t\t\tz2 = -z2;\n\t\t}\n\n\t\tthis.w = w1 + t*(w2 - w1);\n\t\tthis.x = x1 + t*(x2 - x1);\n\t\tthis.y = y1 + t*(y2 - y1);\n\t\tthis.z = z1 + t*(z2 - z1);\n\n\t\tlen = 1.0/Math.sqrt(this.w*this.w + this.x*this.x + this.y*this.y + this.z*this.z);\n\t\tthis.w *= len;\n\t\tthis.x *= len;\n\t\tthis.y *= len;\n\t\tthis.z *= len;\n\t}\n\n\t/**\n\t * Fills the quaternion object with values representing the given euler rotation.\n\t *\n\t * @param    ax        The angle in radians of the rotation around the ax axis.\n\t * @param    ay        The angle in radians of the rotation around the ay axis.\n\t * @param    az        The angle in radians of the rotation around the az axis.\n\t */\n\tpublic fromEulerAngles(ax:number, ay:number, az:number)\n\t{\n\t\tvar halfX:number = ax*.5, halfY:number = ay*.5, halfZ:number = az*.5;\n\t\tvar cosX:number = Math.cos(halfX), sinX:number = Math.sin(halfX);\n\t\tvar cosY:number = Math.cos(halfY), sinY:number = Math.sin(halfY);\n\t\tvar cosZ:number = Math.cos(halfZ), sinZ:number = Math.sin(halfZ);\n\n\t\tthis.w = cosX*cosY*cosZ + sinX*sinY*sinZ;\n\t\tthis.x = sinX*cosY*cosZ - cosX*sinY*sinZ;\n\t\tthis.y = cosX*sinY*cosZ + sinX*cosY*sinZ;\n\t\tthis.z = cosX*cosY*sinZ - sinX*sinY*cosZ;\n\t}\n\n\t/**\n\t * Fills a target Vector3D object with the Euler angles that form the rotation represented by this quaternion.\n\t * @param target An optional Vector3D object to contain the Euler angles. If not provided, a new object is created.\n\t * @return The Vector3D containing the Euler angles.\n\t */\n\tpublic toEulerAngles(target:Vector3D = null):Vector3D\n\t{\n\n\t\t//target ||= new Vector3D();\n\t\tif (target === null) {\n\n\t\t\ttarget = new Vector3D();\n\n\t\t}\n\n\t\ttarget.x = Math.atan2(2*(this.w*this.x + this.y*this.z), 1 - 2*(this.x*this.x + this.y*this.y));\n\t\ttarget.y = Math.asin(2*(this.w*this.y - this.z*this.x));\n\t\ttarget.z = Math.atan2(2*(this.w*this.z + this.x*this.y), 1 - 2*(this.y*this.y + this.z*this.z));\n\n\t\treturn target;\n\t}\n\n\t/**\n\t * Normalises the quaternion object.\n\t */\n\tpublic normalize(val:number = 1)\n\t{\n\t\tvar mag:number = val/Math.sqrt(this.x*this.x + this.y*this.y + this.z*this.z + this.w*this.w);\n\n\t\tthis.x *= mag;\n\t\tthis.y *= mag;\n\t\tthis.z *= mag;\n\t\tthis.w *= mag;\n\t}\n\n\t/**\n\t * Used to trace the values of a quaternion.\n\t *\n\t * @return A string representation of the quaternion object.\n\t */\n\tpublic toString():string\n\t{\n\t\treturn \"{x:\" + this.x + \" y:\" + this.y + \" z:\" + this.z + \" w:\" + this.w + \"}\";\n\t}\n\n\t/**\n\t * Converts the quaternion to a Matrix3D object representing an equivalent rotation.\n\t * @param target An optional Matrix3D container to store the transformation in. If not provided, a new object is created.\n\t * @return A Matrix3D object representing an equivalent rotation.\n\t */\n\tpublic toMatrix3D(target:Matrix3D = null):Matrix3D\n\t{\n\t\tvar rawData:number[] = Matrix3DUtils.RAW_DATA_CONTAINER;\n\t\tvar xy2:number = 2.0*this.x*this.y, xz2:number = 2.0*this.x*this.z, xw2:number = 2.0*this.x*this.w;\n\t\tvar yz2:number = 2.0*this.y*this.z, yw2:number = 2.0*this.y*this.w, zw2:number = 2.0*this.z*this.w;\n\t\tvar xx:number = this.x*this.x, yy:number = this.y*this.y, zz:number = this.z*this.z, ww:number = this.w*this.w;\n\n\t\trawData[0] = xx - yy - zz + ww;\n\t\trawData[4] = xy2 - zw2;\n\t\trawData[8] = xz2 + yw2;\n\t\trawData[12] = 0;\n\t\trawData[1] = xy2 + zw2;\n\t\trawData[5] = -xx + yy - zz + ww;\n\t\trawData[9] = yz2 - xw2;\n\t\trawData[13] = 0;\n\t\trawData[2] = xz2 - yw2;\n\t\trawData[6] = yz2 + xw2;\n\t\trawData[10] = -xx - yy + zz + ww;\n\t\trawData[14] = 0;\n\t\trawData[3] = 0.0;\n\t\trawData[7] = 0.0;\n\t\trawData[11] = 0;\n\t\trawData[15] = 1;\n\n\t\tif (!target)\n\t\t\treturn new Matrix3D(rawData);\n\n\t\ttarget.copyRawDataFrom(rawData);\n\n\t\treturn target;\n\t}\n\n\t/**\n\t * Extracts a quaternion rotation matrix out of a given Matrix3D object.\n\t * @param matrix The Matrix3D out of which the rotation will be extracted.\n\t */\n\tpublic fromMatrix(matrix:Matrix3D)\n\t{\n\t\tvar v:Vector3D = matrix.decompose(Orientation3D.QUATERNION)[1];\n\t\tthis.x = v.x;\n\t\tthis.y = v.y;\n\t\tthis.z = v.z;\n\t\tthis.w = v.w;\n\t}\n\n\t/**\n\t * Converts the quaternion to a Vector.&lt;Number&gt; matrix representation of a rotation equivalent to this quaternion.\n\t * @param target The Vector.&lt;Number&gt; to contain the raw matrix data.\n\t * @param exclude4thRow If true, the last row will be omitted, and a 4x3 matrix will be generated instead of a 4x4.\n\t */\n\tpublic toRawData(target:number[], exclude4thRow:boolean = false)\n\t{\n\t\tvar xy2:number = 2.0*this.x*this.y, xz2:number = 2.0*this.x*this.z, xw2:number = 2.0*this.x*this.w;\n\t\tvar yz2:number = 2.0*this.y*this.z, yw2:number = 2.0*this.y*this.w, zw2:number = 2.0*this.z*this.w;\n\t\tvar xx:number = this.x*this.x, yy:number = this.y*this.y, zz:number = this.z*this.z, ww:number = this.w*this.w;\n\n\t\ttarget[0] = xx - yy - zz + ww;\n\t\ttarget[1] = xy2 - zw2;\n\t\ttarget[2] = xz2 + yw2;\n\t\ttarget[4] = xy2 + zw2;\n\t\ttarget[5] = -xx + yy - zz + ww;\n\t\ttarget[6] = yz2 - xw2;\n\t\ttarget[8] = xz2 - yw2;\n\t\ttarget[9] = yz2 + xw2;\n\t\ttarget[10] = -xx - yy + zz + ww;\n\t\ttarget[3] = target[7] = target[11] = 0;\n\n\t\tif (!exclude4thRow) {\n\t\t\ttarget[12] = target[13] = target[14] = 0;\n\t\t\ttarget[15] = 1;\n\t\t}\n\t}\n\n\t/**\n\t * Clones the quaternion.\n\t * @return An exact duplicate of the current Quaternion.\n\t */\n\tpublic clone():Quaternion\n\t{\n\t\treturn new Quaternion(this.x, this.y, this.z, this.w);\n\t}\n\n\t/**\n\t * Rotates a point.\n\t * @param vector The Vector3D object to be rotated.\n\t * @param target An optional Vector3D object that will contain the rotated coordinates. If not provided, a new object will be created.\n\t * @return A Vector3D object containing the rotated point.\n\t */\n\tpublic rotatePoint(vector:Vector3D, target:Vector3D = null):Vector3D\n\t{\n\t\tvar x1:number, y1:number, z1:number, w1:number;\n\t\tvar x2:number = vector.x, y2:number = vector.y, z2:number = vector.z;\n\n\t\t//target ||= new Vector3D();\n\t\tif (target === null) {\n\n\t\t\ttarget = new Vector3D();\n\n\t\t}\n\n\t\t// p*q'\n\t\tw1 = -this.x*x2 - this.y*y2 - this.z*z2;\n\t\tx1 = this.w*x2 + this.y*z2 - this.z*y2;\n\t\ty1 = this.w*y2 - this.x*z2 + this.z*x2;\n\t\tz1 = this.w*z2 + this.x*y2 - this.y*x2;\n\n\t\ttarget.x = -w1*this.x + x1*this.w - y1*this.z + z1*this.y;\n\t\ttarget.y = -w1*this.y + x1*this.z + y1*this.w - z1*this.x;\n\t\ttarget.z = -w1*this.z - x1*this.y + y1*this.x + z1*this.w;\n\n\t\treturn target;\n\t}\n\n\t/**\n\t * Copies the data from a quaternion into this instance.\n\t * @param q The quaternion to copy from.\n\t */\n\tpublic copyFrom(q:Quaternion)\n\t{\n\t\tthis.x = q.x;\n\t\tthis.y = q.y;\n\t\tthis.z = q.z;\n\t\tthis.w = q.w;\n\t}\n}\n\nexport = Quaternion;","import Point\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\n\n/**\n * A Rectangle object is an area defined by its position, as indicated by its\n * top-left corner point(<i>x</i>, <i>y</i>) and by its width and its height.\n *\n *\n * <p>The <code>x</code>, <code>y</code>, <code>width</code>, and\n * <code>height</code> properties of the Rectangle class are independent of\n * each other; changing the value of one property has no effect on the others.\n * However, the <code>right</code> and <code>bottom</code> properties are\n * integrally related to those four properties. For example, if you change the\n * value of the <code>right</code> property, the value of the\n * <code>width</code> property changes; if you change the <code>bottom</code>\n * property, the value of the <code>height</code> property changes. </p>\n *\n * <p>The following methods and properties use Rectangle objects:</p>\n *\n * <ul>\n *   <li>The <code>applyFilter()</code>, <code>colorTransform()</code>,\n * <code>copyChannel()</code>, <code>copyPixels()</code>, <code>draw()</code>,\n * <code>fillRect()</code>, <code>generateFilterRect()</code>,\n * <code>getColorBoundsRect()</code>, <code>getPixels()</code>,\n * <code>merge()</code>, <code>paletteMap()</code>,\n * <code>pixelDisolve()</code>, <code>setPixels()</code>, and\n * <code>threshold()</code> methods, and the <code>rect</code> property of the\n * BitmapData class</li>\n *   <li>The <code>getBounds()</code> and <code>getRect()</code> methods, and\n * the <code>scrollRect</code> and <code>scale9Grid</code> properties of the\n * DisplayObject class</li>\n *   <li>The <code>getCharBoundaries()</code> method of the TextField\n * class</li>\n *   <li>The <code>pixelBounds</code> property of the Transform class</li>\n *   <li>The <code>bounds</code> parameter for the <code>startDrag()</code>\n * method of the Sprite class</li>\n *   <li>The <code>printArea</code> parameter of the <code>addPage()</code>\n * method of the PrintJob class</li>\n * </ul>\n *\n * <p>You can use the <code>new Rectangle()</code> constructor to create a\n * Rectangle object.</p>\n *\n * <p><b>Note:</b> The Rectangle class does not define a rectangular Shape\n * display object. To draw a rectangular Shape object onscreen, use the\n * <code>drawRect()</code> method of the Graphics class.</p>\n */\nclass Rectangle\n{\n\tprivate _size:Point;\n\tprivate _bottomRight:Point;\n\tprivate _topLeft:Point;\n\n\t/**\n\t * The height of the rectangle, in pixels. Changing the <code>height</code>\n\t * value of a Rectangle object has no effect on the <code>x</code>,\n\t * <code>y</code>, and <code>width</code> properties.\n\t */\n\tpublic height:number;\n\n\t/**\n\t * The width of the rectangle, in pixels. Changing the <code>width</code>\n\t * value of a Rectangle object has no effect on the <code>x</code>,\n\t * <code>y</code>, and <code>height</code> properties.\n\t */\n\tpublic width:number;\n\n\t/**\n\t * The <i>x</i> coordinate of the top-left corner of the rectangle. Changing\n\t * the value of the <code>x</code> property of a Rectangle object has no\n\t * effect on the <code>y</code>, <code>width</code>, and <code>height</code>\n\t * properties.\n\t *\n\t * <p>The value of the <code>x</code> property is equal to the value of the\n\t * <code>left</code> property.</p>\n\t */\n\tpublic x:number;\n\n\t/**\n\t * The <i>y</i> coordinate of the top-left corner of the rectangle. Changing\n\t * the value of the <code>y</code> property of a Rectangle object has no\n\t * effect on the <code>x</code>, <code>width</code>, and <code>height</code>\n\t * properties.\n\t *\n\t * <p>The value of the <code>y</code> property is equal to the value of the\n\t * <code>top</code> property.</p>\n\t */\n\tpublic y:number;\n\n\t/**\n\t * The sum of the <code>y</code> and <code>height</code> properties.\n\t */\n\tpublic get bottom():number\n\t{\n\t\treturn this.y + this.height;\n\t}\n\n\t/**\n\t * The location of the Rectangle object's bottom-right corner, determined by\n\t * the values of the <code>right</code> and <code>bottom</code> properties.\n\t */\n\tpublic get bottomRight():Point\n\t{\n\t\tif (this._bottomRight == null)\n\t\t\tthis._bottomRight = new Point();\n\n\t\tthis._bottomRight.x = this.x + this.width;\n\t\tthis._bottomRight.y = this.y + this.height;\n\n\t\treturn this._bottomRight;\n\t}\n\n\t/**\n\t * The <i>x</i> coordinate of the top-left corner of the rectangle. Changing\n\t * the <code>left</code> property of a Rectangle object has no effect on the\n\t * <code>y</code> and <code>height</code> properties. However it does affect\n\t * the <code>width</code> property, whereas changing the <code>x</code> value\n\t * does <i>not</i> affect the <code>width</code> property.\n\t *\n\t * <p>The value of the <code>left</code> property is equal to the value of\n\t * the <code>x</code> property.</p>\n\t */\n\tpublic get left():number\n\t{\n\t\treturn this.x;\n\t}\n\n\t/**\n\t * The sum of the <code>x</code> and <code>width</code> properties.\n\t */\n\tpublic get right():number\n\t{\n\t\treturn this.x + this.width;\n\t}\n\n\t/**\n\t * The size of the Rectangle object, expressed as a Point object with the\n\t * values of the <code>width</code> and <code>height</code> properties.\n\t */\n\tpublic get size():Point\n\t{\n\t\tif (this._size == null)\n\t\t\tthis._size = new Point();\n\n\t\tthis._size.x = this.width;\n\t\tthis._size.y = this.height;\n\n\t\treturn this._size;\n\t}\n\n\t/**\n\t * The <i>y</i> coordinate of the top-left corner of the rectangle. Changing\n\t * the <code>top</code> property of a Rectangle object has no effect on the\n\t * <code>x</code> and <code>width</code> properties. However it does affect\n\t * the <code>height</code> property, whereas changing the <code>y</code>\n\t * value does <i>not</i> affect the <code>height</code> property.\n\t *\n\t * <p>The value of the <code>top</code> property is equal to the value of the\n\t * <code>y</code> property.</p>\n\t */\n\tpublic get top():number\n\t{\n\t\treturn this.y;\n\t}\n\n\t/**\n\t * The location of the Rectangle object's top-left corner, determined by the\n\t * <i>x</i> and <i>y</i> coordinates of the point.\n\t */\n\tpublic get topLeft():Point\n\t{\n\t\tif (this._topLeft == null)\n\t\t\tthis._topLeft = new Point();\n\n\t\tthis._topLeft.x = this.x;\n\t\tthis._topLeft.y = this.y;\n\n\t\treturn this._topLeft;\n\t}\n\n\t/**\n\t * Creates a new Rectangle object with the top-left corner specified by the\n\t * <code>x</code> and <code>y</code> parameters and with the specified\n\t * <code>width</code> and <code>height</code> parameters. If you call this\n\t * public without parameters, a rectangle with <code>x</code>,\n\t * <code>y</code>, <code>width</code>, and <code>height</code> properties set\n\t * to 0 is created.\n\t *\n\t * @param x      The <i>x</i> coordinate of the top-left corner of the\n\t *               rectangle.\n\t * @param y      The <i>y</i> coordinate of the top-left corner of the\n\t *               rectangle.\n\t * @param width  The width of the rectangle, in pixels.\n\t * @param height The height of the rectangle, in pixels.\n\t */\n\tconstructor(x:number = 0, y:number = 0, width:number = 0, height:number = 0)\n\t{\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t}\n\n\t/**\n\t * Returns a new Rectangle object with the same values for the\n\t * <code>x</code>, <code>y</code>, <code>width</code>, and\n\t * <code>height</code> properties as the original Rectangle object.\n\t *\n\t * @return A new Rectangle object with the same values for the\n\t *         <code>x</code>, <code>y</code>, <code>width</code>, and\n\t *         <code>height</code> properties as the original Rectangle object.\n\t */\n\tpublic clone():Rectangle\n\t{\n\t\treturn new Rectangle(this.x, this.y, this.width, this.height);\n\t}\n\n\t/**\n\t * Determines whether the specified point is contained within the rectangular\n\t * region defined by this Rectangle object.\n\t *\n\t * @param x The <i>x</i> coordinate(horizontal position) of the point.\n\t * @param y The <i>y</i> coordinate(vertical position) of the point.\n\t * @return A value of <code>true</code> if the Rectangle object contains the\n\t *         specified point; otherwise <code>false</code>.\n\t */\n\tpublic contains(x:number, y:number):boolean\n\t{\n\t\treturn (this.x <= x && this.x + this.width >= x && this.y <= y && this.y + this.height >= y);\n\t}\n\n\t/**\n\t * Determines whether the specified point is contained within the rectangular\n\t * region defined by this Rectangle object. This method is similar to the\n\t * <code>Rectangle.contains()</code> method, except that it takes a Point\n\t * object as a parameter.\n\t *\n\t * @param point The point, as represented by its <i>x</i> and <i>y</i>\n\t *              coordinates.\n\t * @return A value of <code>true</code> if the Rectangle object contains the\n\t *         specified point; otherwise <code>false</code>.\n\t */\n\tpublic containsPoint(point:Point):boolean\n\t{\n\t\treturn (this.x <= point.x && this.x + this.width >= point.x && this.y <= point.y && this.y + this.height >= point.y);\n\t}\n\n\t/**\n\t * Determines whether the Rectangle object specified by the <code>rect</code>\n\t * parameter is contained within this Rectangle object. A Rectangle object is\n\t * said to contain another if the second Rectangle object falls entirely\n\t * within the boundaries of the first.\n\t *\n\t * @param rect The Rectangle object being checked.\n\t * @return A value of <code>true</code> if the Rectangle object that you\n\t *         specify is contained by this Rectangle object; otherwise\n\t *         <code>false</code>.\n\t */\n\tpublic containsRect(rect:Rectangle):boolean\n\t{\n\t\treturn (this.x <= rect.x && this.x + this.width >= rect.x + rect.width && this.y <= rect.y && this.y + this.height >= rect.y + rect.height)\n\t}\n\n\t/**\n\t * Copies all of rectangle data from the source Rectangle object into the\n\t * calling Rectangle object.\n\t *\n\t * @param sourceRect The Rectangle object from which to copy the data.\n\t */\n\tpublic copyFrom(sourceRect:Rectangle)\n\t{\n\n\t}\n\n\t/**\n\t * Determines whether the object specified in the <code>toCompare</code>\n\t * parameter is equal to this Rectangle object. This method compares the\n\t * <code>x</code>, <code>y</code>, <code>width</code>, and\n\t * <code>height</code> properties of an object against the same properties of\n\t * this Rectangle object.\n\t *\n\t * @param toCompare The rectangle to compare to this Rectangle object.\n\t * @return A value of <code>true</code> if the object has exactly the same\n\t *         values for the <code>x</code>, <code>y</code>, <code>width</code>,\n\t *         and <code>height</code> properties as this Rectangle object;\n\t *         otherwise <code>false</code>.\n\t */\n\tpublic equals(toCompare:Rectangle):boolean\n\t{\n\t\treturn (this.x == toCompare.x && this.y == toCompare.y && this.width == toCompare.width && this.height == toCompare.height)\n\t}\n\n\t/**\n\t * Increases the size of the Rectangle object by the specified amounts, in\n\t * pixels. The center point of the Rectangle object stays the same, and its\n\t * size increases to the left and right by the <code>dx</code> value, and to\n\t * the top and the bottom by the <code>dy</code> value.\n\t *\n\t * @param dx The value to be added to the left and the right of the Rectangle\n\t *           object. The following equation is used to calculate the new\n\t *           width and position of the rectangle:\n\t * @param dy The value to be added to the top and the bottom of the\n\t *           Rectangle. The following equation is used to calculate the new\n\t *           height and position of the rectangle:\n\t */\n\tpublic inflate(dx:number, dy:number)\n\t{\n\t\tthis.x -= dx/2;\n\t\tthis.y -= dy/2;\n\t\tthis.width += dx/2;\n\t\tthis.height += dy/2;\n\t}\n\n\t/**\n\t * Increases the size of the Rectangle object. This method is similar to the\n\t * <code>Rectangle.inflate()</code> method except it takes a Point object as\n\t * a parameter.\n\t *\n\t * <p>The following two code examples give the same result:</p>\n\t *\n\t * @param point The <code>x</code> property of this Point object is used to\n\t *              increase the horizontal dimension of the Rectangle object.\n\t *              The <code>y</code> property is used to increase the vertical\n\t *              dimension of the Rectangle object.\n\t */\n\tpublic inflatePoint(point:Point)\n\t{\n\t\tthis.x -= point.x/2;\n\t\tthis.y -= point.y/2;\n\t\tthis.width += point.x/2;\n\t\tthis.height += point.y/2;\n\t}\n\n\t/**\n\t * If the Rectangle object specified in the <code>toIntersect</code>\n\t * parameter intersects with this Rectangle object, returns the area of\n\t * intersection as a Rectangle object. If the rectangles do not intersect,\n\t * this method returns an empty Rectangle object with its properties set to\n\t * 0.\n\t *\n\t * @param toIntersect The Rectangle object to compare against to see if it\n\t *                    intersects with this Rectangle object.\n\t * @return A Rectangle object that equals the area of intersection. If the\n\t *         rectangles do not intersect, this method returns an empty\n\t *         Rectangle object; that is, a rectangle with its <code>x</code>,\n\t *         <code>y</code>, <code>width</code>, and <code>height</code>\n\t *         properties set to 0.\n\t */\n\tpublic intersection(toIntersect:Rectangle):Rectangle\n\t{\n\t\tif (this.intersects(toIntersect)) {\n\t\t\tvar i:Rectangle = new Rectangle();\n\n\t\t\tif (this.x > toIntersect.x) {\n\t\t\t\ti.x = this.x;\n\t\t\t\ti.width = toIntersect.x - this.x + toIntersect.width;\n\n\t\t\t\tif (i.width > this.width)\n\t\t\t\t\ti.width = this.width;\n\t\t\t} else {\n\t\t\t\ti.x = toIntersect.x;\n\t\t\t\ti.width = this.x - toIntersect.x + this.width;\n\n\t\t\t\tif (i.width > toIntersect.width)\n\t\t\t\t\ti.width = toIntersect.width;\n\t\t\t}\n\n\t\t\tif (this.y > toIntersect.y) {\n\t\t\t\ti.y = this.y;\n\t\t\t\ti.height = toIntersect.y - this.y + toIntersect.height;\n\n\t\t\t\tif (i.height > this.height)\n\t\t\t\t\ti.height = this.height;\n\t\t\t} else {\n\t\t\t\ti.y = toIntersect.y;\n\t\t\t\ti.height = this.y - toIntersect.y + this.height;\n\n\t\t\t\tif (i.height > toIntersect.height)\n\t\t\t\t\ti.height = toIntersect.height;\n\t\t\t}\n\n\t\t\treturn i;\n\t\t}\n\n\t\treturn new Rectangle();\n\t}\n\n\t/**\n\t * Determines whether the object specified in the <code>toIntersect</code>\n\t * parameter intersects with this Rectangle object. This method checks the\n\t * <code>x</code>, <code>y</code>, <code>width</code>, and\n\t * <code>height</code> properties of the specified Rectangle object to see if\n\t * it intersects with this Rectangle object.\n\t *\n\t * @param toIntersect The Rectangle object to compare against this Rectangle\n\t *                    object.\n\t * @return A value of <code>true</code> if the specified object intersects\n\t *         with this Rectangle object; otherwise <code>false</code>.\n\t */\n\tpublic intersects(toIntersect:Rectangle):boolean\n\t{\n\t\treturn (this.x + this.width > toIntersect.x && this.x < toIntersect.x + toIntersect.width && this.y + this.height > toIntersect.y && this.y < toIntersect.y + toIntersect.height);\n\t}\n\n\t/**\n\t * Determines whether or not this Rectangle object is empty.\n\t *\n\t * @return A value of <code>true</code> if the Rectangle object's width or\n\t *         height is less than or equal to 0; otherwise <code>false</code>.\n\t */\n\tpublic isEmpty():boolean\n\t{\n\t\treturn (this.x == 0 && this.y == 0 && this.width == 0 && this.height == 0);\n\t}\n\n\t/**\n\t * Adjusts the location of the Rectangle object, as determined by its\n\t * top-left corner, by the specified amounts.\n\t *\n\t * @param dx Moves the <i>x</i> value of the Rectangle object by this amount.\n\t * @param dy Moves the <i>y</i> value of the Rectangle object by this amount.\n\t */\n\tpublic offset(dx:number, dy:number)\n\t{\n\t\tthis.x += dx;\n\t\tthis.y += dy;\n\t}\n\n\t/**\n\t * Adjusts the location of the Rectangle object using a Point object as a\n\t * parameter. This method is similar to the <code>Rectangle.offset()</code>\n\t * method, except that it takes a Point object as a parameter.\n\t *\n\t * @param point A Point object to use to offset this Rectangle object.\n\t */\n\tpublic offsetPoint(point:Point)\n\t{\n\t\tthis.x += point.x;\n\t\tthis.y += point.y;\n\t}\n\n\t/**\n\t * Sets all of the Rectangle object's properties to 0. A Rectangle object is\n\t * empty if its width or height is less than or equal to 0.\n\t *\n\t * <p> This method sets the values of the <code>x</code>, <code>y</code>,\n\t * <code>width</code>, and <code>height</code> properties to 0.</p>\n\t *\n\t */\n\tpublic setEmpty()\n\t{\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t}\n\n\t/**\n\t * Sets the members of Rectangle to the specified values\n\t *\n\t * @param xa      The <i>x</i> coordinate of the top-left corner of the\n\t *                rectangle.\n\t * @param ya      The <i>y</i> coordinate of the top-left corner of the\n\t *                rectangle.\n\t * @param widtha  The width of the rectangle, in pixels.\n\t * @param heighta The height of the rectangle, in pixels.\n\t */\n\tpublic setTo(xa:number, ya:number, widtha:number, heighta:number)\n\t{\n\t\tthis.x = xa;\n\t\tthis.y = ya;\n\t\tthis.width = widtha;\n\t\tthis.height = heighta;\n\t}\n\n\t/**\n\t * Builds and returns a string that lists the horizontal and vertical\n\t * positions and the width and height of the Rectangle object.\n\t *\n\t * @return A string listing the value of each of the following properties of\n\t *         the Rectangle object: <code>x</code>, <code>y</code>,\n\t *         <code>width</code>, and <code>height</code>.\n\t */\n\tpublic toString():string\n\t{\n\t\treturn \"[Rectangle] (x=\" + this.x + \", y=\" + this.y + \", width=\" + this.width + \", height=\" + this.height + \")\";\n\t}\n\n\t/**\n\t * Adds two rectangles together to create a new Rectangle object, by filling\n\t * in the horizontal and vertical space between the two rectangles.\n\t *\n\t * <p><b>Note:</b> The <code>union()</code> method ignores rectangles with\n\t * <code>0</code> as the height or width value, such as: <code>var\n\t * rect2:Rectangle = new Rectangle(300,300,50,0);</code></p>\n\t *\n\t * @param toUnion A Rectangle object to add to this Rectangle object.\n\t * @return A new Rectangle object that is the union of the two rectangles.\n\t */\n\tpublic union(toUnion:Rectangle):Rectangle\n\t{\n\t\tvar u:Rectangle = new Rectangle();\n\n\t\tif (this.x < toUnion.x) {\n\t\t\tu.x = this.x;\n\t\t\tu.width = toUnion.x - this.x + toUnion.width;\n\n\t\t\tif (u.width < this.width)\n\t\t\t\tu.width = this.width;\n\t\t} else {\n\t\t\tu.x = toUnion.x;\n\t\t\tu.width = this.x - toUnion.x + this.width;\n\n\t\t\tif (u.width < toUnion.width)\n\t\t\t\tu.width = toUnion.width;\n\t\t}\n\n\t\tif (this.y < toUnion.y) {\n\t\t\tu.y = this.y;\n\t\t\tu.height = toUnion.y - this.y + toUnion.height;\n\n\t\t\tif (u.height < this.height)\n\t\t\t\tu.height = this.height;\n\t\t} else {\n\t\t\tu.y = toUnion.y;\n\t\t\tu.height = this.y - toUnion.y + this.height;\n\n\t\t\tif (u.height < toUnion.height)\n\t\t\t\tu.height = toUnion.height;\n\t\t}\n\n\t\treturn u;\n\t}\n}\n\nexport = Rectangle;","import PlaneClassification\t= require(\"awayjs-core/lib/geom/PlaneClassification\");\nimport Vector3D\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nclass Sphere\n{\n\t/**\n\t *\n\t */\n\tpublic x:number;\n\n\t/**\n\t *\n\t */\n\tpublic y:number;\n\n\t/**\n\t *\n\t */\n\tpublic z:number;\n\n\t/**\n\t *\n\t */\n\tpublic radius:number;\n\n\t/**\n\t * Create a Sphere with ABCD coefficients\n\t */\n\tconstructor(x:number = 0, y:number = 0, z:number = 0, radius:number = 0)\n\t{\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t\tthis.radius = radius;\n\n\t}\n\n\tpublic rayIntersection(position:Vector3D, direction:Vector3D, targetNormal:Vector3D):number\n\t{\n\t\tif (this.containsPoint(position))\n\t\t\treturn 0;\n\n\t\tvar px:number = position.x - this.x, py:number = position.y - this.y, pz:number = position.z - this.z;\n\t\tvar vx:number = direction.x, vy:number = direction.y, vz:number = direction.z;\n\t\tvar rayEntryDistance:number;\n\n\t\tvar a:number = vx*vx + vy*vy + vz*vz;\n\t\tvar b:number = 2*( px*vx + py*vy + pz*vz );\n\t\tvar c:number = px*px + py*py + pz*pz - this.radius*this.radius;\n\t\tvar det:number = b*b - 4*a*c;\n\n\t\tif (det >= 0) { // ray goes through sphere\n\t\t\tvar sqrtDet:number = Math.sqrt(det);\n\t\t\trayEntryDistance = ( -b - sqrtDet )/( 2*a );\n\t\t\tif (rayEntryDistance >= 0) {\n\t\t\t\ttargetNormal.x = px + rayEntryDistance*vx;\n\t\t\t\ttargetNormal.y = py + rayEntryDistance*vy;\n\t\t\t\ttargetNormal.z = pz + rayEntryDistance*vz;\n\t\t\t\ttargetNormal.normalize();\n\n\t\t\t\treturn rayEntryDistance;\n\t\t\t}\n\t\t}\n\n\t\t// ray misses sphere\n\t\treturn -1;\n\t}\n\n\tpublic containsPoint(position:Vector3D):boolean\n\t{\n\t\tvar px:number = position.x - this.x;\n\t\tvar py:number = position.y - this.y;\n\t\tvar pz:number = position.z - this.z;\n\t\tvar distance:number = Math.sqrt(px*px + py*py + pz*pz);\n\t\treturn distance <= this.radius;\n\t}\n\n\tpublic toString():string\n\t{\n\t\treturn \"Sphere [x:\" + this.x + \", y:\" + this.y + \", z:\" + this.z + \", radius:\" + this.radius + \"]\";\n\t}\n}\n\nexport = Sphere;","import Matrix\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\n\nclass UVTransform\n{\n\tprivate _uvMatrix:Matrix = new Matrix();\n\tprivate _uvMatrixDirty:boolean;\n\n\tprivate _rotation:number = 0;\n\tprivate _scaleU:number = 1;\n\tprivate _scaleV:number = 1;\n\tprivate _offsetU:number = 0;\n\tprivate _offsetV:number = 0;\n\n\t/**\n\t *\n\t */\n\tpublic get offsetU():number\n\t{\n\t\treturn this._offsetU;\n\t}\n\n\tpublic set offsetU(value:number)\n\t{\n\t\tif (value == this._offsetU)\n\t\t\treturn;\n\n\t\tthis._offsetU = value;\n\t\tthis._uvMatrixDirty = true;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get offsetV():number\n\t{\n\t\treturn this._offsetV;\n\t}\n\n\tpublic set offsetV(value:number)\n\t{\n\t\tif (value == this._offsetV)\n\t\t\treturn;\n\n\t\tthis._offsetV = value;\n\t\tthis._uvMatrixDirty = true;\n\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get rotation():number\n\t{\n\t\treturn this._rotation;\n\t}\n\n\tpublic set rotation(value:number)\n\t{\n\t\tif (value == this._rotation)\n\t\t\treturn;\n\n\t\tthis._rotation = value;\n\n\t\tthis._uvMatrixDirty = true;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get scaleU():number\n\t{\n\t\treturn this._scaleU;\n\t}\n\n\tpublic set scaleU(value:number)\n\t{\n\t\tif (value == this._scaleU)\n\t\t\treturn;\n\n\t\tthis._scaleU = value;\n\n\t\tthis._uvMatrixDirty = true;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get scaleV():number\n\t{\n\t\treturn this._scaleV;\n\t}\n\n\tpublic set scaleV(value:number)\n\t{\n\t\tif (value == this._scaleV)\n\t\t\treturn;\n\n\t\tthis._scaleV = value;\n\n\t\tthis._uvMatrixDirty = true;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get matrix():Matrix\n\t{\n\t\tif (this._uvMatrixDirty)\n\t\t\tthis.updateUVMatrix();\n\n\t\treturn this._uvMatrix;\n\t}\n\n\tconstructor()\n\t{\n\t}\n\n\n\t/**\n\t * @private\n\t */\n\tprivate updateUVMatrix()\n\t{\n\t\tthis._uvMatrix.identity();\n\n\t\tif (this._rotation != 0)\n\t\t\tthis._uvMatrix.rotate(this._rotation);\n\n\t\tif (this._scaleU != 1 || this._scaleV != 1)\n\t\t\tthis._uvMatrix.scale(this._scaleU, this._scaleV);\n\n\t\tthis._uvMatrix.translate(this._offsetU, this._offsetV);\n\n\t\tthis._uvMatrixDirty = false;\n\t}\n}\n\nexport = UVTransform;","/**\n * The Vector3D class represents a point or a location in the three-dimensional\n * space using the Cartesian coordinates x, y, and z. As in a two-dimensional\n * space, the x property represents the horizontal axis and the y property\n * represents the vertical axis. In three-dimensional space, the z property\n * represents depth. The value of the x property increases as the object moves\n * to the right. The value of the y property increases as the object moves\n * down. The z property increases as the object moves farther from the point\n * of view. Using perspective projection and scaling, the object is seen to be\n * bigger when near and smaller when farther away from the screen. As in a\n * right-handed three-dimensional coordinate system, the positive z-axis points\n * away from the viewer and the value of the z property increases as the object\n * moves away from the viewer's eye. The origin point (0,0,0) of the global\n * space is the upper-left corner of the stage.\n *\n * <p>The Vector3D class can also represent a direction, an arrow pointing from\n * the origin of the coordinates, such as (0,0,0), to an endpoint; or a\n * floating-point component of an RGB (Red, Green, Blue) color model.</p>\n *\n * <p>Quaternion notation introduces a fourth element, the w property, which\n * provides additional orientation information. For example, the w property can\n * define an angle of rotation of a Vector3D object. The combination of the\n * angle of rotation and the coordinates x, y, and z can determine the display\n * object's orientation. Here is a representation of Vector3D elements in\n * matrix notation:</p>\n */\nclass Vector3D\n{\n\t/**\n\t * The x axis defined as a Vector3D object with coordinates (1,0,0).\n\t */\n\tpublic static X_AXIS:Vector3D = new Vector3D(1, 0, 0);\n\n\t/**\n\t * The y axis defined as a Vector3D object with coordinates (0,1,0).\n\t */\n\tpublic static Y_AXIS:Vector3D = new Vector3D(0, 1, 0);\n\n\t/**\n\t * The z axis defined as a Vector3D object with coordinates (0,0,1).\n\t */\n\tpublic static Z_AXIS:Vector3D = new Vector3D(0, 0, 1);\n\n\t/**\n\t * The first element of a Vector3D object, such as the x coordinate of\n\t * a point in the three-dimensional space. The default value is 0.\n\t */\n\tpublic x:number;\n\n\t/*\n\t *The second element of a Vector3D object, such as the y coordinate of\n\t * a point in the three-dimensional space. The default value is 0.\n\t */\n\tpublic y:number;\n\n\t/**\n\t * The third element of a Vector3D object, such as the y coordinate of\n\t * a point in the three-dimensional space. The default value is 0.\n\t */\n\tpublic z:number;\n\n\t/**\n\t * TThe fourth element of a Vector3D object (in addition to the x, y,\n\t * and z properties) can hold data such as the angle of rotation. The\n\t * default value is 0.\n\t *\n\t * <p>Quaternion notation employs an angle as the fourth element in\n\t * its calculation of three-dimensional rotation. The w property can\n\t * be used to define the angle of rotation about the Vector3D object.\n\t * The combination of the rotation angle and the coordinates (x,y,z)\n\t * determines the display object's orientation.</p>\n\t *\n\t * <p>In addition, the w property can be used as a perspective warp\n\t * factor for a projected three-dimensional position or as a projection\n\t * transform value in representing a three-dimensional coordinate\n\t * projected into the two-dimensional space. For example, you can\n\t * create a projection matrix using the <code>Matrix3D.rawData</code>\n\t * property, that, when applied to a Vector3D object, produces a\n\t * transform value in the Vector3D object's fourth element (the w\n\t * property). Dividing the Vector3D object's other elements by the\n\t * transform value then produces a projected Vector3D object. You can\n\t * use the <code>Vector3D.project()</code> method to divide the first\n\t * three elements of a Vector3D object by its fourth element.</p>\n\t */\n\tpublic w:number;\n\n\t/**\n\t * The length, magnitude, of the current Vector3D object from the\n\t * origin (0,0,0) to the object's x, y, and z coordinates. The w\n\t * property is ignored. A unit vector has a length or magnitude of\n\t * one.\n\t */\n\tpublic get length():number\n\t{\n\t\treturn Math.sqrt(this.lengthSquared);\n\t}\n\n\t/**\n\t * The square of the length of the current Vector3D object, calculated\n\t * using the x, y, and z properties. The w property is ignored. Use the\n\t * <code>lengthSquared()</code> method whenever possible instead of the\n\t * slower <code>Math.sqrt()</code> method call of the\n\t * <code>Vector3D.length()</code> method.\n\t */\n\tpublic get lengthSquared():number\n\t{\n\t\treturn this.x*this.x + this.y*this.y + this.z*this.z;\n\t}\n\n\t/**\n\t * Creates an instance of a Vector3D object. If you do not specify a\n\t * parameter for the constructor, a Vector3D object is created with\n\t * the elements (0,0,0,0).\n\t *\n\t * @param x The first element, such as the x coordinate.\n\t * @param y The second element, such as the y coordinate.\n\t * @param z The third element, such as the z coordinate.\n\t * @param w An optional element for additional data such as the angle\n\t *          of rotation.\n\t */\n\tconstructor(x:number = 0, y:number = 0, z:number = 0, w:number = 0)\n\t{\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t\tthis.w = w;\n\t}\n\n\t/**\n\t * Adds the value of the x, y, and z elements of the current Vector3D\n\t * object to the values of the x, y, and z elements of another Vector3D\n\t * object. The <code>add()</code> method does not change the current\n\t * Vector3D object. Instead, it returns a new Vector3D object with\n\t * the new values.\n\t *\n\t * <p>The result of adding two vectors together is a resultant vector.\n\t * One way to visualize the result is by drawing a vector from the\n\t * origin or tail of the first vector to the end or head of the second\n\t * vector. The resultant vector is the distance between the origin\n\t * point of the first vector and the end point of the second vector.\n\t * </p>\n\t */\n\tpublic add(a:Vector3D):Vector3D\n\t{\n\t\treturn new Vector3D(this.x + a.x, this.y + a.y, this.z + a.z, this.w + a.w)\n\t}\n\n\t/**\n\t * Returns the angle in radians between two vectors. The returned angle\n\t * is the smallest radian the first Vector3D object rotates until it\n\t * aligns with the second Vector3D object.\n\t *\n\t * <p>The <code>angleBetween()</code> method is a static method. You\n\t * can use it directly as a method of the Vector3D class.</p>\n\t *\n\t * <p>To convert a degree to a radian, you can use the following\n\t * formula:</p>\n\t *\n\t * <p><code>radian = Math.PI/180 * degree</code></p>\n\t *\n\t * @param a The first Vector3D object.\n\t * @param b The second Vector3D object.\n\t * @returns The angle between two Vector3D objects.\n\t */\n\tpublic static angleBetween(a:Vector3D, b:Vector3D):number\n\t{\n\t\treturn Math.acos(a.dotProduct(b)/(a.length*b.length));\n\t}\n\n\t/**\n\t * Returns a new Vector3D object that is an exact copy of the current\n\t * Vector3D object.\n\t *\n\t * @returns A new Vector3D object that is a copy of the current\n\t * Vector3D object.\n\t */\n\tpublic clone():Vector3D\n\t{\n\t\treturn new Vector3D(this.x, this.y, this.z, this.w);\n\t}\n\n\t/**\n\t * Copies all of vector data from the source Vector3D object into the\n\t * calling Vector3D object.\n\t *\n\t * @param src The Vector3D object from which to copy the data.\n\t */\n\tpublic copyFrom(src:Vector3D):void\n\t{\n\t\tthis.x = src.x;\n\t\tthis.y = src.y;\n\t\tthis.z = src.z;\n\t\tthis.w = src.w;\n\t}\n\n\t/**\n\t * Returns a new Vector3D object that is perpendicular (at a right\n\t * angle) to the current Vector3D and another Vector3D object. If the\n\t * returned Vector3D object's coordinates are (0,0,0), then the two\n\t * Vector3D objects are parallel to each other.\n\t *\n\t * <p>You can use the normalized cross product of two vertices of a\n\t * polygon surface with the normalized vector of the camera or eye\n\t * viewpoint to get a dot product. The value of the dot product can\n\t * identify whether a surface of a three-dimensional object is hidden\n\t * from the viewpoint.</p>\n\t *\n\t * @param a A second Vector3D object.\n\t * @returns A new Vector3D object that is perpendicular to the current\n\t *          Vector3D object and the Vector3D object specified as the\n\t *          parameter.\n\t */\n\tpublic crossProduct(a:Vector3D):Vector3D\n\t{\n\t\treturn new Vector3D(this.y*a.z - this.z*a.y, this.z*a.x - this.x*a.z, this.x*a.y - this.y*a.x, 1);\n\t}\n\n\t/**\n\t * Decrements the value of the x, y, and z elements of the current\n\t * Vector3D object by the values of the x, y, and z elements of\n\t * specified Vector3D object. Unlike the\n\t * <code>Vector3D.subtract()</code> method, the\n\t * <code>decrementBy()</code> method changes the current Vector3D\n\t * object and does not return a new Vector3D object.\n\t *\n\t * @param a The Vector3D object containing the values to subtract from\n\t *          the current Vector3D object.\n\t */\n\tpublic decrementBy(a:Vector3D)\n\t{\n\t\tthis.x -= a.x;\n\t\tthis.y -= a.y;\n\t\tthis.z -= a.z;\n\t}\n\n\t/**\n\t * Returns the distance between two Vector3D objects. The\n\t * <code>distance()</code> method is a static method. You can use it\n\t * directly as a method of the Vector3D class to get the Euclidean\n\t * distance between two three-dimensional points.\n\t *\n\t * @param pt1 A Vector3D object as the first three-dimensional point.\n\t * @param pt2 A Vector3D object as the second three-dimensional point.\n\t * @returns The distance between two Vector3D objects.\n\t */\n\tstatic distance(pt1:Vector3D, pt2:Vector3D):number\n\t{\n\t\tvar x:number = (pt1.x - pt2.x);\n\t\tvar y:number = (pt1.y - pt2.y);\n\t\tvar z:number = (pt1.z - pt2.z);\n\t\treturn Math.sqrt(x*x + y*y + z*z);\n\t}\n\n\t/**\n\t * If the current Vector3D object and the one specified as the\n\t * parameter are unit vertices, this method returns the cosine of the\n\t * angle between the two vertices. Unit vertices are vertices that\n\t * point to the same direction but their length is one. They remove the\n\t * length of the vector as a factor in the result. You can use the\n\t * <code>normalize()</code> method to convert a vector to a unit\n\t * vector.\n\t *\n\t * <p>The <code>dotProduct()</code> method finds the angle between two\n\t * vertices. It is also used in backface culling or lighting\n\t * calculations. Backface culling is a procedure for determining which\n\t * surfaces are hidden from the viewpoint. You can use the normalized\n\t * vertices from the camera, or eye, viewpoint and the cross product of\n\t * the vertices of a polygon surface to get the dot product. If the dot\n\t * product is less than zero, then the surface is facing the camera or\n\t * the viewer. If the two unit vertices are perpendicular to each\n\t * other, they are orthogonal and the dot product is zero. If the two\n\t * vertices are parallel to each other, the dot product is one.</p>\n\t *\n\t * @param a The second Vector3D object.\n\t * @returns A scalar which is the dot product of the current Vector3D\n\t *          object and the specified Vector3D object.\n\t *\n\t * @see away.geom.Vector3D#crossProduct()\n\t * @see away.geom.Vector3D#normalize()\n\t */\n\tpublic dotProduct(a:Vector3D):number\n\t{\n\t\treturn this.x*a.x + this.y*a.y + this.z*a.z;\n\t}\n\n\t/**\n\t * Determines whether two Vector3D objects are equal by comparing the\n\t * x, y, and z elements of the current Vector3D object with a\n\t * specified Vector3D object. If the values of these elements are the\n\t * same, the two Vector3D objects are equal. If the second optional\n\t * parameter is set to true, all four elements of the Vector3D objects,\n\t * including the w property, are compared.\n\t */\n\n\t/**\n\t *\n\t * @param toCompare The Vector3D object to be compared with the current\n\t *                  Vector3D object.\n\t * @param allFour   An optional parameter that specifies whether the w\n\t *                  property of the Vector3D objects is used in the\n\t *                  comparison.\n\t * @returns A value of true if the specified Vector3D object is equal\n\t *          to the current Vector3D object; false if it is not equal.\n\t */\n\tpublic equals(toCompare:Vector3D, allFour:boolean = false):boolean\n\t{\n\t\treturn (this.x == toCompare.x && this.y == toCompare.y && this.z == toCompare.z && (!allFour || this.w == toCompare.w ));\n\t}\n\n\t/**\n\t * Increments the value of the x, y, and z elements of the current\n\t * Vector3D object by the values of the x, y, and z elements of a\n\t * specified Vector3D object. Unlike the <code>Vector3D.add()</code>\n\t * method, the <code>incrementBy()</code> method changes the current\n\t * Vector3D object and does not return a new Vector3D object.\n\t *\n\t * @param a The Vector3D object to be added to the current Vector3D\n\t *          object.\n\t */\n\tpublic incrementBy(a:Vector3D)\n\t{\n\t\tthis.x += a.x;\n\t\tthis.y += a.y;\n\t\tthis.z += a.z;\n\t}\n\n\t/**\n\t * Compares the elements of the current Vector3D object with the\n\t * elements of a specified Vector3D object to determine whether they\n\t * are nearly equal. The two Vector3D objects are nearly equal if the\n\t * value of all the elements of the two vertices are equal, or the\n\t * result of the comparison is within the tolerance range. The\n\t * difference between two elements must be less than the number\n\t * specified as the tolerance parameter. If the third optional\n\t * parameter is set to <code>true</code>, all four elements of the\n\t * Vector3D objects, including the <code>w</code> property, are\n\t * compared. Otherwise, only the x, y, and z elements are included in\n\t * the comparison.\n\t */\n\n\t/**\n\t *\n\t * @param toCompare The Vector3D object to be compared with the current\n\t *                  Vector3D object.\n\t * @param tolerance A number determining the tolerance factor. If the\n\t *                  difference between the values of the Vector3D\n\t *                  element specified in the toCompare parameter and\n\t *                  the current Vector3D element is less than the\n\t *                  tolerance number, the two values are considered\n\t *                  nearly equal.\n\t * @param allFour   An optional parameter that specifies whether the w\n\t *                  property of the Vector3D objects is used in the\n\t *                  comparison.\n\t * @returns A value of true if the specified Vector3D object is nearly\n\t *          equal to the current Vector3D object; false if it is not\n\t *          equal.\n\t *\n\t * @see away.geom.Vector3D#equals()\n\t */\n\tpublic nearEquals(toCompare:Vector3D, tolerance:number, allFour:boolean = true):boolean\n\t{\n\t\treturn ((Math.abs(this.x - toCompare.x) < tolerance) && (Math.abs(this.y - toCompare.y) < tolerance) && (Math.abs(this.z - toCompare.z) < tolerance) && (!allFour || Math.abs(this.w - toCompare.w) < tolerance));\n\t}\n\n\t/**\n\t * Sets the current Vector3D object to its inverse. The inverse object\n\t * is also considered the opposite of the original object. The value of\n\t * the x, y, and z properties of the current Vector3D object is changed\n\t * to -x, -y, and -z.\n\t */\n\tpublic negate():void\n\t{\n\t\tthis.x = -this.x;\n\t\tthis.y = -this.y;\n\t\tthis.z = -this.z;\n\t}\n\n\t/**\n\t * Converts a Vector3D object to a unit vector by dividing the first\n\t * three elements (x, y, z) by the length of the vector. Unit vertices\n\t * are vertices that have a direction but their length is one. They\n\t * simplify vector calculations by removing length as a factor.\n\t */\n\t/**\n\t * Scales the line segment between(0,0) and the current point to a set\n\t * length.\n\t *\n\t * @param thickness The scaling value. For example, if the current\n\t *                  Vector3D object is (0,3,4), and you normalize it to\n\t *                  1, the point returned is at(0,0.6,0.8).\n\t */\n\tpublic normalize(thickness:number = 1)\n\t{\n\t\tif (this.length != 0) {\n\t\t\tvar invLength = thickness/this.length;\n\t\t\tthis.x *= invLength;\n\t\t\tthis.y *= invLength;\n\t\t\tthis.z *= invLength;\n\t\t\treturn;\n\t\t}\n\t}\n\n\t/**\n\t * Divides the value of the <code>x</code>, <code>y</code>, and\n\t * <code>z</code> properties of the current Vector3D object by the\n\t * value of its <code>w</code> property.\n\t *\n\t * <p>If the current Vector3D object is the result of multiplying a\n\t * Vector3D object by a projection Matrix3D object, the w property can\n\t * hold the transform value. The <code>project()</code> method then can\n\t * complete the projection by dividing the elements by the\n\t * <code>w</code> property. Use the <code>Matrix3D.rawData</code>\n\t * property to create a projection Matrix3D object.</p>\n\t */\n\tpublic project():void\n\t{\n\t\tthis.x /= this.w;\n\t\tthis.y /= this.w;\n\t\tthis.z /= this.w;\n\t}\n\n\t/**\n\t * Scales the current Vector3D object by a scalar, a magnitude. The\n\t * Vector3D object's x, y, and z elements are multiplied by the scalar\n\t * number specified in the parameter. For example, if the vector is\n\t * scaled by ten, the result is a vector that is ten times longer. The\n\t * scalar can also change the direction of the vector. Multiplying the\n\t * vector by a negative number reverses its direction.\n\t *\n\t * @param s A multiplier (scalar) used to scale a Vector3D object.\n\n\t */\n\tpublic scaleBy(s:number):void\n\t{\n\t\tthis.x *= s;\n\t\tthis.y *= s;\n\t\tthis.z *= s;\n\t}\n\n\t/**\n\t * Sets the members of Vector3D to the specified values\n\t *\n\t * @param xa The first element, such as the x coordinate.\n\t * @param ya The second element, such as the y coordinate.\n\t * @param za The third element, such as the z coordinate.\n\t */\n\tpublic setTo(xa:number, ya:number, za:number):void\n\t{\n\t\tthis.x = xa;\n\t\tthis.y = ya;\n\t\tthis.z = za;\n\t}\n\n\t/**\n\t * Subtracts the value of the x, y, and z elements of the current\n\t * Vector3D object from the values of the x, y, and z elements of\n\t * another Vector3D object. The <code>subtract()</code> method does not\n\t * change the current Vector3D object. Instead, this method returns a\n\t * new Vector3D object with the new values.\n\t *\n\t * @param a The Vector3D object to be subtracted from the current\n\t *          Vector3D object.\n\t * @returns A new Vector3D object that is the difference between the\n\t *          current Vector3D and the specified Vector3D object.\n\t *\n\t * @see away.geom.Vector3D#decrementBy()\n\t */\n\tpublic subtract(a:Vector3D):Vector3D\n\t{\n\t\treturn new Vector3D(this.x - a.x, this.y - a.y, this.z - a.z);\n\t}\n\n\t/**\n\t * Returns a string representation of the current Vector3D object. The\n\t * string contains the values of the x, y, and z properties.\n\t */\n\tpublic toString():string\n\t{\n\t\treturn \"[Vector3D] (x:\" + this.x + \" ,y:\" + this.y + \", z\" + this.z + \", w:\" + this.w + \")\";\n\t}\n}\n\nexport = Vector3D;","import URLRequest\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\nimport AssetLibrary\t\t\t\t= require(\"awayjs-core/lib/library/AssetLibrary\");\nimport AssetLibraryIterator\t\t= require(\"awayjs-core/lib/library/AssetLibraryIterator\");\nimport AssetLoader\t\t\t\t= require(\"awayjs-core/lib/library/AssetLoader\");\nimport AssetLoaderToken\t\t\t= require(\"awayjs-core/lib/library/AssetLoaderToken\");\nimport AssetLoaderContext\t\t= require(\"awayjs-core/lib/library/AssetLoaderContext\");\nimport ConflictPrecedence\t\t= require(\"awayjs-core/lib/library/ConflictPrecedence\");\nimport ConflictStrategy\t\t\t= require(\"awayjs-core/lib/library/ConflictStrategy\");\nimport ConflictStrategyBase\t\t= require(\"awayjs-core/lib/library/ConflictStrategyBase\");\nimport NamedAssetBase\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport Error\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\nimport AssetEvent\t\t\t\t= require(\"awayjs-core/lib/events/AssetEvent\");\nimport IOErrorEvent\t\t\t\t= require(\"awayjs-core/lib/events/IOErrorEvent\");\nimport LoaderEvent\t\t\t\t= require(\"awayjs-core/lib/events/LoaderEvent\");\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\nimport ParserEvent\t\t\t\t= require(\"awayjs-core/lib/events/ParserEvent\");\nimport ParserBase\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\n\n/**\n * AssetLibraryBundle enforces a multiton pattern and is not intended to be instanced directly.\n * Its purpose is to create a container for 3D data management, both before and after parsing.\n * If you are interested in creating multiple library bundles, please use the <code>getInstance()</code> method.\n */\nclass AssetLibraryBundle extends EventDispatcher\n{\n\tpublic static _iInstances:Object = new Object();\n\n\tprivate _loadingSessions:Array<AssetLoader>;\n\tprivate _strategy:ConflictStrategyBase;\n\tprivate _strategyPreference:string;\n\tprivate _assets:Array<IAsset>;\n\tprivate _assetDictionary:Object;\n\tprivate _assetDictDirty:boolean;\n\tprivate _loadingSessionsGarbage:Array<AssetLoader> = new Array<AssetLoader>();\n\tprivate _gcTimeoutIID:number;\n\n\tprivate _onAssetRenameDelegate:(event:AssetEvent) => void;\n\tprivate _onAssetConflictResolvedDelegate:(event:AssetEvent) => void;\n\tprivate _onResourceCompleteDelegate:(event:LoaderEvent) => void;\n\tprivate _onTextureSizeErrorDelegate:(event:AssetEvent) => void;\n\tprivate _onAssetCompleteDelegate:(event:AssetEvent) => void;\n\tprivate _onLoadErrorDelegate:(event:IOErrorEvent) => boolean;\n\tprivate _onParseErrorDelegate:(event:ParserEvent) => boolean;\n\n\t/**\n\t * Creates a new <code>AssetLibraryBundle</code> object.\n\t *\n\t * @param me A multiton enforcer for the AssetLibraryBundle ensuring it cannnot be instanced.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._assets = new Array<IAsset>();//new Vector.<IAsset>;\n\t\tthis._assetDictionary = new Object();\n\t\tthis._loadingSessions = new Array<AssetLoader>();\n\n\t\tthis.conflictStrategy = ConflictStrategy.IGNORE.create();\n\t\tthis.conflictPrecedence = ConflictPrecedence.FAVOR_NEW;\n\n\t\tthis._onAssetRenameDelegate = (event:AssetEvent) => this.onAssetRename(event);\n\t\tthis._onAssetConflictResolvedDelegate = (event:AssetEvent) => this.onAssetConflictResolved(event);\n\t\tthis._onResourceCompleteDelegate = (event:LoaderEvent) => this.onResourceComplete(event);\n\t\tthis._onTextureSizeErrorDelegate = (event:AssetEvent) => this.onTextureSizeError(event);\n\t\tthis._onAssetCompleteDelegate = (event:AssetEvent) => this.onAssetComplete(event);\n\t\tthis._onLoadErrorDelegate = (event:IOErrorEvent) => this.onLoadError(event);\n\t\tthis._onParseErrorDelegate = (event:ParserEvent) => this.onParseError(event);\n\t}\n\n\t/**\n\t * Returns an AssetLibraryBundle instance. If no key is given, returns the default bundle instance (which is\n\t * similar to using the AssetLibraryBundle as a singleton.) To keep several separated library bundles,\n\t * pass a string key to this method to define which bundle should be returned. This is\n\t * referred to as using the AssetLibrary as a multiton.\n\t *\n\t * @param key Defines which multiton instance should be returned.\n\t * @return An instance of the asset library\n\t */\n\tpublic static getInstance(key:string = 'default'):AssetLibraryBundle\n\t{\n\t\tif (!key)\n\t\t\tkey = 'default';\n\n\t\tif (!AssetLibraryBundle._iInstances.hasOwnProperty(key))\n\t\t\tAssetLibraryBundle._iInstances[key] = new AssetLibraryBundle();\n\n\t\treturn AssetLibraryBundle._iInstances[key];\n\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic enableParser(parserClass:Object)\n\t{\n\t\tAssetLoader.enableParser(parserClass);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic enableParsers(parserClasses:Object[])\n\t{\n\t\tAssetLoader.enableParsers(parserClasses);\n\t}\n\n\t/**\n\t * Defines which strategy should be used for resolving naming conflicts, when two library\n\t * assets are given the same name. By default, <code>ConflictStrategy.APPEND_NUM_SUFFIX</code>\n\t * is used which means that a numeric suffix is appended to one of the assets. The\n\t * <code>conflictPrecedence</code> property defines which of the two conflicting assets will\n\t * be renamed.\n\t *\n\t * @see naming.ConflictStrategy\n\t * @see AssetLibrary.conflictPrecedence\n\t */\n\tpublic get conflictStrategy():ConflictStrategyBase\n\t{\n\t\treturn this._strategy;\n\t}\n\n\tpublic set conflictStrategy(val:ConflictStrategyBase)\n\t{\n\n\t\tif (!val)\n\t\t\tthrow new Error('namingStrategy must not be null. To ignore naming, use AssetLibrary.IGNORE');\n\n\t\tthis._strategy = val.create();\n\n\t}\n\n\t/**\n\t * Defines which asset should have precedence when resolving a naming conflict between\n\t * two assets of which one has just been renamed by the user or by a parser. By default\n\t * <code>ConflictPrecedence.FAVOR_NEW</code> is used, meaning that the newly renamed\n\t * asset will keep it's new name while the older asset gets renamed to not conflict.\n\t *\n\t * This property is ignored for conflict strategies that do not actually rename an\n\t * asset automatically, such as ConflictStrategy.IGNORE and ConflictStrategy.THROW_ERROR.\n\t *\n\t * @see away.library.ConflictPrecedence\n\t * @see away.library.ConflictStrategy\n\t */\n\tpublic get conflictPrecedence():string\n\t{\n\t\treturn this._strategyPreference;\n\t}\n\n\tpublic set conflictPrecedence(val:string)\n\t{\n\t\tthis._strategyPreference = val;\n\t}\n\n\t/**\n\t * Create an AssetLibraryIterator instance that can be used to iterate over the assets\n\t * in this asset library instance. The iterator can filter assets on asset type and/or\n\t * namespace. A \"null\" filter value means no filter of that type is used.\n\t *\n\t * @param assetTypeFilter Asset type to filter on (from the AssetType enum class.) Use\n\t * null to not filter on asset type.\n\t * @param namespaceFilter Namespace to filter on. Use null to not filter on namespace.\n\t * @param filterFunc Callback function to use when deciding whether an asset should be\n\t * included in the iteration or not. This needs to be a function that takes a single\n\t * parameter of type IAsset and returns a boolean where true means it should be included.\n\t *\n\t * @see away.library.AssetType\n\t */\n\tpublic createIterator(assetTypeFilter:string = null, namespaceFilter:string = null, filterFunc = null):AssetLibraryIterator\n\t{\n\t\treturn new AssetLibraryIterator(this._assets, assetTypeFilter, namespaceFilter, filterFunc);\n\t}\n\n\t/**\n\t * Loads a file and (optionally) all of its dependencies.\n\t *\n\t * @param req The URLRequest object containing the URL of the file to be loaded.\n\t * @param context An optional context object providing additional parameters for loading\n\t * @param ns An optional namespace string under which the file is to be loaded, allowing the differentiation of two resources with identical assets\n\t * @param parser An optional parser object for translating the loaded data into a usable resource. If not provided, AssetLoader will attempt to auto-detect the file type.\n\t * @return A handle to the retrieved resource.\n\t */\n\tpublic load(req:URLRequest, context:AssetLoaderContext = null, ns:string = null, parser:ParserBase = null):AssetLoaderToken\n\t{\n\t\tvar loader:AssetLoader = new AssetLoader();\n\n\t\tif (!this._loadingSessions)\n\t\t\tthis._loadingSessions = new Array<AssetLoader>();\n\n\t\tthis._loadingSessions.push(loader);\n\n\t\tloader.addEventListener(LoaderEvent.RESOURCE_COMPLETE, this._onResourceCompleteDelegate);\n\t\tloader.addEventListener(AssetEvent.TEXTURE_SIZE_ERROR, this._onTextureSizeErrorDelegate);\n\t\tloader.addEventListener(AssetEvent.ASSET_COMPLETE, this._onAssetCompleteDelegate);\n\n\t\t// Error are handled separately (see documentation for addErrorHandler)\n\t\tloader._iAddErrorHandler(this._onLoadErrorDelegate);\n\t\tloader._iAddParseErrorHandler(this._onParseErrorDelegate);\n\n\t\treturn loader.load(req, context, ns, parser);\n\t}\n\n\t/**\n\t * Loads a resource from existing data in memory.\n\t *\n\t * @param data The data object containing all resource information.\n\t * @param context An optional context object providing additional parameters for loading\n\t * @param ns An optional namespace string under which the file is to be loaded, allowing the differentiation of two resources with identical assets\n\t * @param parser An optional parser object for translating the loaded data into a usable resource. If not provided, AssetLoader will attempt to auto-detect the file type.\n\t * @return A handle to the retrieved resource.\n\t */\n\tpublic loadData(data:any, context:AssetLoaderContext = null, ns:string = null, parser:ParserBase = null):AssetLoaderToken\n\t{\n\t\tvar loader:AssetLoader = new AssetLoader();\n\n\t\tif (!this._loadingSessions)\n\t\t\tthis._loadingSessions = new Array<AssetLoader>();\n\n\t\tthis._loadingSessions.push(loader);\n\n\t\tloader.addEventListener(LoaderEvent.RESOURCE_COMPLETE, this._onResourceCompleteDelegate);\n\t\tloader.addEventListener(AssetEvent.TEXTURE_SIZE_ERROR, this._onTextureSizeErrorDelegate);\n\t\tloader.addEventListener(AssetEvent.ASSET_COMPLETE, this._onAssetCompleteDelegate);\n\n\t\t// Error are handled separately (see documentation for addErrorHandler)\n\t\tloader._iAddErrorHandler(this._onLoadErrorDelegate);\n\t\tloader._iAddParseErrorHandler(this._onParseErrorDelegate);\n\n\t\treturn loader.loadData(data, '', context, ns, parser);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic getAsset(name:string, ns:string = null):IAsset\n\t{\n\t\t//var asset : IAsset;\n\n\t\tif (this._assetDictDirty)\n\t\t\tthis.rehashAssetDict();\n\n\t\tif (ns == null)\n\t\t\tns = NamedAssetBase.DEFAULT_NAMESPACE;\n\n\t\tif (!this._assetDictionary.hasOwnProperty(ns))\n\t\t\treturn null;\n\n\t\treturn this._assetDictionary[ns][name];\n\n\t}\n\n\t/**\n\t * Adds an asset to the asset library, first making sure that it's name is unique\n\t * using the method defined by the <code>conflictStrategy</code> and\n\t * <code>conflictPrecedence</code> properties.\n\t */\n\tpublic addAsset(asset:IAsset)\n\t{\n\t\tvar ns:string;\n\t\tvar old:IAsset;\n\n\t\t// Bail if asset has already been added.\n\t\tif (this._assets.indexOf(asset) >= 0)\n\t\t\treturn;\n\n\t\told = this.getAsset(asset.name, asset.assetNamespace);\n\t\tns = asset.assetNamespace || NamedAssetBase.DEFAULT_NAMESPACE;\n\n\t\tif (old != null)\n\t\t\tthis._strategy.resolveConflict(asset, old, this._assetDictionary[ns], this._strategyPreference);\n\n\t\t//create unique-id (for now this is used in AwayBuilder only\n\t\t//asset.id = IDUtil.createUID();\n\n\t\t// Add it\n\t\tthis._assets.push(asset);\n\n\t\tif (!this._assetDictionary.hasOwnProperty(ns))\n\t\t\tthis._assetDictionary[ns] = new Object();\n\n\t\tthis._assetDictionary[ns][asset.name] = asset;\n\n\t\tasset.addEventListener(AssetEvent.ASSET_RENAME, this._onAssetRenameDelegate);\n\t\tasset.addEventListener(AssetEvent.ASSET_CONFLICT_RESOLVED, this._onAssetConflictResolvedDelegate);\n\t}\n\n\t/**\n\t * Removes an asset from the library, and optionally disposes that asset by calling\n\t * it's disposeAsset() method (which for most assets is implemented as a default\n\t * version of that type's dispose() method.\n\t *\n\t * @param asset The asset which should be removed from this library.\n\t * @param dispose Defines whether the assets should also be disposed.\n\t */\n\tpublic removeAsset(asset:IAsset, dispose:boolean = true)\n\t{\n\t\tvar idx:number;\n\n\t\tthis.removeAssetFromDict(asset);\n\n\t\tasset.removeEventListener(AssetEvent.ASSET_RENAME, this._onAssetRenameDelegate);\n\t\tasset.removeEventListener(AssetEvent.ASSET_CONFLICT_RESOLVED, this._onAssetConflictResolvedDelegate);\n\n\t\tidx = this._assets.indexOf(asset);\n\n\t\tif (idx >= 0)\n\t\t\tthis._assets.splice(idx, 1);\n\n\t\tif (dispose)\n\t\t\tasset.dispose();\n\t}\n\n\t/**\n\t * Removes an asset which is specified using name and namespace.\n\t *\n\t * @param name The name of the asset to be removed.\n\t * @param ns The namespace to which the desired asset belongs.\n\t * @param dispose Defines whether the assets should also be disposed.\n\t *\n\t * @see away.library.AssetLibrary.removeAsset()\n\t */\n\tpublic removeAssetByName(name:string, ns:string = null, dispose:boolean = true):IAsset\n\t{\n\n\t\tvar asset:IAsset = this.getAsset(name, ns);\n\n\t\tif (asset)\n\t\t\tthis.removeAsset(asset, dispose);\n\n\t\treturn asset;\n\t}\n\n\t/**\n\t * Removes all assets from the asset library, optionally disposing them as they\n\t * are removed.\n\t *\n\t * @param dispose Defines whether the assets should also be disposed.\n\t */\n\tpublic removeAllAssets(dispose:boolean = true)\n\t{\n\t\tif (dispose) {\n\t\t\tvar asset:IAsset;\n\n\t\t\tfor (var c:number = 0; c < this._assets.length; c++) {\n\t\t\t\tasset = this._assets[ c ];\n\t\t\t\tasset.dispose();\n\t\t\t}\n\t\t\t/*\n\t\t\t for each (asset in _assets)\n\t\t\t asset.dispose();\n\t\t\t */\n\t\t}\n\n\t\tthis._assets.length = 0;\n\t\tthis.rehashAssetDict();\n\t}\n\n\t/**\n\t * Removes all assets belonging to a particular namespace (null for default)\n\t * from the asset library, and optionall disposes them by calling their\n\t * disposeAsset() method.\n\t *\n\t * @param ns The namespace from which all assets should be removed.\n\t * @param dispose Defines whether the assets should also be disposed.\n\t *\n\t * @see away.library.AssetLibrary.removeAsset()\n\t */\n\tpublic removeNamespaceAssets(ns:string = null, dispose:boolean = true)\n\t{\n\t\tvar idx:number = 0;\n\t\tvar asset:IAsset;\n\t\tvar old_assets:IAsset[];\n\n\t\t// Empty the assets vector after having stored a copy of it.\n\t\t// The copy will be filled with all assets which weren't removed.\n\t\told_assets = this._assets.concat();\n\t\tthis._assets.length = 0;\n\n\t\tif (ns == null)\n\t\t\tns = NamedAssetBase.DEFAULT_NAMESPACE;\n\n\t\tfor (var d:number = 0; d < old_assets.length; d++) {\n\t\t\tasset = old_assets[d];\n\n\t\t\t// Remove from dict if in the supplied namespace. If not,\n\t\t\t// transfer over to the new vector.\n\t\t\tif (asset.assetNamespace == ns) {\n\t\t\t\tif (dispose)\n\t\t\t\t\tasset.dispose();\n\n\t\t\t\t// Remove asset from dictionary, but don't try to auto-remove\n\t\t\t\t// the namespace, which will trigger an unnecessarily expensive\n\t\t\t\t// test that is not needed since we know that the namespace\n\t\t\t\t// will be empty when loop finishes.\n\t\t\t\tthis.removeAssetFromDict(asset, false);\n\t\t\t} else {\n\t\t\t\tthis._assets[idx++] = asset;\n\t\t\t}\n\t\t}\n\n\t\t/*\n\t\t for each (asset in old_assets) {\n\t\t // Remove from dict if in the supplied namespace. If not,\n\t\t // transfer over to the new vector.\n\t\t if (asset.assetNamespace == ns) {\n\t\t if (dispose)\n\t\t asset.dispose();\n\n\t\t // Remove asset from dictionary, but don't try to auto-remove\n\t\t // the namespace, which will trigger an unnecessarily expensive\n\t\t // test that is not needed since we know that the namespace\n\t\t // will be empty when loop finishes.\n\t\t removeAssetFromDict(asset, false);\n\t\t } else\n\t\t _assets[idx++] = asset;\n\n\t\t }\n\t\t */\n\n\t\t// Remove empty namespace\n\t\tif (this._assetDictionary.hasOwnProperty(ns))\n\t\t\tdelete this._assetDictionary[ns];\n\t}\n\n\tprivate removeAssetFromDict(asset:IAsset, autoRemoveEmptyNamespace:boolean = true)\n\t{\n\t\tif (this._assetDictDirty)\n\t\t\tthis.rehashAssetDict();\n\n\t\tif (this._assetDictionary.hasOwnProperty(asset.assetNamespace)) {\n\t\t\tif (this._assetDictionary[asset.assetNamespace].hasOwnProperty(asset.name))\n\t\t\t\tdelete this._assetDictionary[asset.assetNamespace][asset.name];\n\n\t\t\tif (autoRemoveEmptyNamespace) {\n\n\t\t\t\tvar key:string;\n\t\t\t\tvar empty:boolean = true;\n\n\t\t\t\tfor (key in this._assetDictionary[asset.assetNamespace]) {\n\t\t\t\t\tempty = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (empty)\n\t\t\t\t\tdelete this._assetDictionary[asset.assetNamespace];\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic stopAllLoadingSessions()\n\t{\n\t\tvar i:number;\n\n\t\tif (!this._loadingSessions)\n\t\t\tthis._loadingSessions = new Array<AssetLoader>();\n\n\t\tvar length:number = this._loadingSessions.length;\n\n\t\tfor (i = 0; i < length; i++)\n\t\t\tthis.killLoadingSession(this._loadingSessions[i]);\n\n\t\tthis._loadingSessions = null;\n\t}\n\n\tprivate rehashAssetDict()\n\t{\n\t\tvar asset:IAsset;\n\n\t\tthis._assetDictionary = {};\n\n\t\tvar l:number = this._assets.length;\n\n\t\tfor (var c:number = 0; c < l; c++) {\n\t\t\tasset = this._assets[c];\n\n\t\t\tif (!this._assetDictionary.hasOwnProperty(asset.assetNamespace))\n\t\t\t\tthis._assetDictionary[asset.assetNamespace] = {};\n\n\t\t\tthis._assetDictionary[asset.assetNamespace][asset.name] = asset;\n\n\t\t}\n\n\t\tthis._assetDictDirty = false;\n\n\t}\n\n\t/**\n\t * Called when a an error occurs during loading.\n\t */\n\tprivate onLoadError(event:IOErrorEvent):boolean\n\t{\n\t\tif (this.hasEventListener(IOErrorEvent.IO_ERROR)) {\n\t\t\tthis.dispatchEvent(event);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Called when a an error occurs during parsing.\n\t */\n\tprivate onParseError(event:ParserEvent):boolean\n\t{\n\t\tif (this.hasEventListener(ParserEvent.PARSE_ERROR)) {\n\t\t\tthis.dispatchEvent(event);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tprivate onAssetComplete(event:AssetEvent)\n\t{\n\t\t// Only add asset to library the first time.\n\t\tif (event.type == AssetEvent.ASSET_COMPLETE)\n\t\t\tthis.addAsset(event.asset);\n\n\t\tthis.dispatchEvent(event);\n\n\t}\n\n\tprivate onTextureSizeError(event:AssetEvent)\n\t{\n\t\tthis.dispatchEvent(event);\n\t}\n\n\t/**\n\t * Called when the resource and all of its dependencies was retrieved.\n\t */\n\tprivate onResourceComplete(event:LoaderEvent)\n\t{\n\t\tvar loader:AssetLoader = <AssetLoader> event.target;\n\n\t\tthis.dispatchEvent(event);\n\n\t\tvar index:number = this._loadingSessions.indexOf(loader);\n\t\tthis._loadingSessions.splice(index, 1);\n\n\t\t// Add loader to a garbage array - for a collection sweep and kill\n\t\tthis._loadingSessionsGarbage.push(loader);\n\t\tthis._gcTimeoutIID = setTimeout(() => {this.loadingSessionGC()}, 100);\n\t}\n\n\tprivate loadingSessionGC():void\n\t{\n\t\tvar loader:AssetLoader;\n\n\t\twhile (this._loadingSessionsGarbage.length > 0) {\n\t\t\tloader = this._loadingSessionsGarbage.pop();\n\t\t\tthis.killLoadingSession(loader);\n\t\t}\n\n\t\tclearTimeout(this._gcTimeoutIID);\n\t\tthis._gcTimeoutIID = null;\n\n\t}\n\n\tprivate killLoadingSession(loader:AssetLoader)\n\t{\n\t\tloader.removeEventListener(LoaderEvent.RESOURCE_COMPLETE, this._onResourceCompleteDelegate);\n\t\tloader.removeEventListener(AssetEvent.TEXTURE_SIZE_ERROR, this._onTextureSizeErrorDelegate);\n\t\tloader.removeEventListener(AssetEvent.ASSET_COMPLETE, this._onAssetCompleteDelegate);\n\t\tloader.stop();\n\t}\n\n\t/**\n\t * Called when unespected error occurs\n\t */\n\t/*\n\t private onResourceError() : void\n\t {\n\t var msg:string = \"Unexpected parser error\";\n\t if(hasEventListener(LoaderEvent.DEPENDENCY_ERROR)){\n\t var re:LoaderEvent = new LoaderEvent(LoaderEvent.DEPENDENCY_ERROR, \"\");\n\t dispatchEvent(re);\n\t } else{\n\t throw new Error(msg);\n\t }\n\t }\n\t */\n\n\tprivate onAssetRename(event:AssetEvent)\n\t{\n\t\tvar asset:IAsset = <IAsset > event.target;// TODO: was ev.currentTarget - watch this var\n\t\tvar old:IAsset = this.getAsset(asset.assetNamespace, asset.name);\n\n\t\tif (old != null) {\n\t\t\tthis._strategy.resolveConflict(asset, old, this._assetDictionary[asset.assetNamespace], this._strategyPreference);\n\t\t} else {\n\t\t\tvar dict:Object = this._assetDictionary[event.asset.assetNamespace];\n\n\t\t\tif (dict == null)\n\t\t\t\treturn;\n\n\t\t\tdict[event.assetPrevName] = null;\n\t\t\tdict[event.asset.name] = event.asset;\n\t\t}\n\t}\n\n\tprivate onAssetConflictResolved(event:AssetEvent)\n\t{\n\t\tthis.dispatchEvent(event.clone());\n\t}\n}\n\nexport = AssetLibraryBundle;","import IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\n\nclass AssetLibraryIterator\n{\n\n\tprivate  _assets:Array<IAsset>;\n\tprivate _filtered:Array<IAsset>;\n\n\tprivate _idx:number;\n\n\tconstructor(assets:Array<IAsset>, assetTypeFilter:string, namespaceFilter:string, filterFunc)\n\t{\n\t\tthis._assets = assets;\n\t\tthis.filter(assetTypeFilter, namespaceFilter, filterFunc);\n\t}\n\n\tpublic get currentAsset():IAsset\n\t{\n\t\t// Return current, or null if no current\n\t\treturn ( this._idx < this._filtered.length )? this._filtered[ this._idx ] : null;\n\t}\n\n\tpublic get numAssets():number\n\t{\n\t\treturn this._filtered.length;\n\t}\n\n\tpublic next():IAsset\n\t{\n\t\tvar next:IAsset = null;\n\n\t\tif (this._idx < this._filtered.length)\n\t\t\tnext = this._filtered[this._idx];\n\n\t\tthis._idx++;\n\n\t\treturn next;\n\t}\n\n\tpublic reset()\n\t{\n\t\tthis._idx = 0;\n\t}\n\n\tpublic setIndex(index:number)\n\t{\n\t\tthis._idx = index;\n\t}\n\n\tprivate filter(assetTypeFilter:string, namespaceFilter:string, filterFunc)\n\t{\n\t\tif (assetTypeFilter || namespaceFilter) {\n\n\t\t\tvar idx:number;\n\t\t\tvar asset:IAsset;\n\n\n\t\t\tidx = 0;\n\t\t\tthis._filtered = new Array<IAsset>();//new Vector.<IAsset>;\n\n\t\t\tvar l:number = this._assets.length;\n\n\t\t\tfor (var c:number = 0; c < l; c++) {\n\n\t\t\t\tasset = <IAsset> this._assets[c];\n\n\t\t\t\t// Skip this assets if filtering on type and this is wrong type\n\t\t\t\tif (assetTypeFilter && asset.assetType != assetTypeFilter)\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// Skip this asset if filtering on namespace and this is wrong namespace\n\t\t\t\tif (namespaceFilter && asset.assetNamespace != namespaceFilter)\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// Skip this asset if a filter func has been provided and it returns false\n\t\t\t\tif (filterFunc != null && !filterFunc(asset))\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis._filtered[idx++] = asset;\n\n\t\t\t}\n\n\t\t\t/*\n\t\t\t for each (asset in _assets) {\n\t\t\t // Skip this assets if filtering on type and this is wrong type\n\t\t\t if (assetTypeFilter && asset.assetType != assetTypeFilter)\n\t\t\t continue;\n\n\t\t\t // Skip this asset if filtering on namespace and this is wrong namespace\n\t\t\t if (namespaceFilter && asset.assetNamespace != namespaceFilter)\n\t\t\t continue;\n\n\t\t\t // Skip this asset if a filter func has been provided and it returns false\n\t\t\t if (filterFunc != null && !filterFunc(asset))\n\t\t\t continue;\n\n\t\t\t _filtered[idx++] = asset;\n\t\t\t }\n\t\t\t */\n\n\t\t} else {\n\t\t\tthis._filtered = this._assets;\n\t\t}\n\t}\n}\n\nexport = AssetLibraryIterator;","import URLRequest\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\nimport AssetLibraryBundle\t\t= require(\"awayjs-core/lib/library/AssetLibraryBundle\");\nimport AssetLibraryIterator\t\t= require(\"awayjs-core/lib/library/AssetLibraryIterator\");\nimport AssetLoader\t\t\t\t= require(\"awayjs-core/lib/library/AssetLoader\");\nimport AssetLoaderContext\t\t= require(\"awayjs-core/lib/library/AssetLoaderContext\");\nimport AssetLoaderToken\t\t\t= require(\"awayjs-core/lib/library/AssetLoaderToken\");\nimport ConflictStrategyBase\t\t= require(\"awayjs-core/lib/library/ConflictStrategyBase\");\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport ParserBase\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\n\n/**\n * AssetLibrary enforces a singleton pattern and is not intended to be instanced.\n * It's purpose is to allow access to the default library bundle through a set of static shortcut methods.\n * If you are interested in creating multiple library bundles, please use the <code>getBundle()</code> method.\n */\nclass AssetLibrary\n{\n\t/**\n\t * Creates a new <code>AssetLibrary</code> object.\n\t *\n\t */\n\tconstructor()\n\t{\n\t}\n\n\t//*/\n\t/**\n\t * Returns an AssetLibrary bundle instance. If no key is given, returns the default bundle (which is\n\t * similar to using the AssetLibraryBundle as a singleton). To keep several separated library bundles,\n\t * pass a string key to this method to define which bundle should be returned. This is\n\t * referred to as using the AssetLibraryBundle as a multiton.\n\t *\n\t * @param key Defines which multiton instance should be returned.\n\t * @return An instance of the asset library\n\t */\n\tpublic static getBundle(key:string = 'default'):AssetLibraryBundle\n\t{\n\t\treturn AssetLibraryBundle.getInstance(key);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic static enableParser(parserClass)\n\t{\n\t\tAssetLoader.enableParser(parserClass);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic static enableParsers(parserClasses:Array<Object>)\n\t{\n\t\tAssetLoader.enableParsers(parserClasses);\n\t}\n\n\t/**\n\t * Short-hand for conflictStrategy property on default asset library bundle.\n\t *\n\t * @see AssetLibraryBundle.conflictStrategy\n\t */\n\tpublic static get conflictStrategy():ConflictStrategyBase\n\t{\n\t\treturn AssetLibrary.getBundle().conflictStrategy;\n\t}\n\n\tpublic static set conflictStrategy(val:ConflictStrategyBase)\n\t{\n\t\tAssetLibrary.getBundle().conflictStrategy = val;\n\t}\n\n\t/**\n\t * Short-hand for conflictPrecedence property on default asset library bundle.\n\t *\n\t * @see AssetLibraryBundle.conflictPrecedence\n\t */\n\tpublic static get conflictPrecedence():string\n\t{\n\t\treturn AssetLibrary.getBundle().conflictPrecedence;\n\t}\n\n\tpublic static set conflictPrecedence(val:string)\n\t{\n\t\tAssetLibrary.getBundle().conflictPrecedence = val;\n\t}\n\n\t/**\n\t * Short-hand for createIterator() method on default asset library bundle.\n\t *\n\t * @see AssetLibraryBundle.createIterator()\n\t */\n\tpublic static createIterator(assetTypeFilter:string = null, namespaceFilter:string = null, filterFunc = null):AssetLibraryIterator\n\t{\n\t\treturn AssetLibrary.getBundle().createIterator(assetTypeFilter, namespaceFilter, filterFunc);\n\t}\n\n\t/**\n\t * Short-hand for load() method on default asset library bundle.\n\t *\n\t * @see AssetLibraryBundle.load()\n\t */\n\tpublic static load(req:URLRequest, context:AssetLoaderContext = null, ns:string = null, parser:ParserBase = null):AssetLoaderToken\n\t{\n\t\treturn AssetLibrary.getBundle().load(req, context, ns, parser);\n\t}\n\n\t/**\n\t * Short-hand for loadData() method on default asset library bundle.\n\t *\n\t * @see AssetLibraryBundle.loadData()\n\t */\n\tpublic static loadData(data:any, context:AssetLoaderContext = null, ns:string = null, parser:ParserBase = null):AssetLoaderToken\n\t{\n\t\treturn AssetLibrary.getBundle().loadData(data, context, ns, parser);\n\t}\n\n\tpublic static stopLoad()\n\t{\n\t\tAssetLibrary.getBundle().stopAllLoadingSessions();\n\t}\n\n\t/**\n\t * Short-hand for getAsset() method on default asset library bundle.\n\t *\n\t * @see AssetLibraryBundle.getAsset()\n\t */\n\tpublic static getAsset(name:string, ns:string = null):IAsset\n\t{\n\t\treturn AssetLibrary.getBundle().getAsset(name, ns);\n\t}\n\n\t/**\n\t * Short-hand for addEventListener() method on default asset library bundle.\n\t */\n\tpublic static addEventListener(type:string, listener:Function)\n\t{\n\t\tAssetLibrary.getBundle().addEventListener(type, listener);\n\t}\n\n\t/**\n\t * Short-hand for removeEventListener() method on default asset library bundle.\n\t */\n\tpublic static removeEventListener(type:string, listener:Function)\n\t{\n\t\tAssetLibrary.getBundle().removeEventListener(type, listener);\n\t}\n\n\t/**\n\t * Short-hand for hasEventListener() method on default asset library bundle.\n\n\t public static hasEventListener(type:string):boolean\n\t {\n\t\treturn AssetLibrary.getBundle().hasEventListener(type);\n\t}\n\n\t public static willTrigger(type:string):boolean\n\t {\n\t\treturn getBundle().willTrigger(type);\n\t}\n\t */\n\n\t/**\n\t * Short-hand for addAsset() method on default asset library bundle.\n\t *\n\t * @see AssetLibraryBundle.addAsset()\n\t */\n\tpublic static addAsset(asset:IAsset)\n\t{\n\t\tAssetLibrary.getBundle().addAsset(asset);\n\t}\n\n\t/**\n\t * Short-hand for removeAsset() method on default asset library bundle.\n\t *\n\t * @param asset The asset which should be removed from the library.\n\t * @param dispose Defines whether the assets should also be disposed.\n\t *\n\t * @see AssetLibraryBundle.removeAsset()\n\t */\n\tpublic static removeAsset(asset:IAsset, dispose:boolean = true)\n\t{\n\t\tAssetLibrary.getBundle().removeAsset(asset, dispose);\n\t}\n\n\t/**\n\t * Short-hand for removeAssetByName() method on default asset library bundle.\n\t *\n\t * @param name The name of the asset to be removed.\n\t * @param ns The namespace to which the desired asset belongs.\n\t * @param dispose Defines whether the assets should also be disposed.\n\t *\n\t * @see AssetLibraryBundle.removeAssetByName()\n\t */\n\tpublic static removeAssetByName(name:string, ns:string = null, dispose:boolean = true):IAsset\n\t{\n\t\treturn AssetLibrary.getBundle().removeAssetByName(name, ns, dispose);\n\t}\n\n\t/**\n\t * Short-hand for removeAllAssets() method on default asset library bundle.\n\t *\n\t * @param dispose Defines whether the assets should also be disposed.\n\t *\n\t * @see AssetLibraryBundle.removeAllAssets()\n\t */\n\tpublic static removeAllAssets(dispose:boolean = true)\n\t{\n\t\tAssetLibrary.getBundle().removeAllAssets(dispose);\n\t}\n\n\t/**\n\t * Short-hand for removeNamespaceAssets() method on default asset library bundle.\n\t *\n\t * @see AssetLibraryBundle.removeNamespaceAssets()\n\t */\n\tpublic static removeNamespaceAssets(ns:string = null, dispose:boolean = true)\n\t{\n\t\tAssetLibrary.getBundle().removeNamespaceAssets(ns, dispose);\n\t}\n}\n\nexport = AssetLibrary;","class AssetLoaderContext\n{\n\tpublic static UNDEFINED:number = 0;\n\tpublic static SINGLEPASS_MATERIALS:number = 1;\n\tpublic static MULTIPASS_MATERIALS:number = 2;\n\n\tprivate _includeDependencies:boolean;\n\tprivate _dependencyBaseUrl:string;\n\tprivate _embeddedDataByUrl:Object;\n\tprivate _remappedUrls:Object;\n\tprivate _materialMode:number;\n\n\tprivate _overrideAbsPath:boolean;\n\tprivate _overrideFullUrls:boolean;\n\n\t/**\n\t * AssetLoaderContext provides configuration for the AssetLoader load() and parse() operations.\n\t * Use it to configure how (and if) dependencies are loaded, or to map dependency URLs to\n\t * embedded data.\n\t *\n\t * @see away.loading.AssetLoader\n\t */\n\tconstructor(includeDependencies:boolean = true, dependencyBaseUrl:string = null)\n\t{\n\t\tthis._includeDependencies = includeDependencies;\n\t\tthis._dependencyBaseUrl = dependencyBaseUrl || '';\n\t\tthis._embeddedDataByUrl = {};\n\t\tthis._remappedUrls = {};\n\t\tthis._materialMode = AssetLoaderContext.UNDEFINED;\n\t}\n\n\t/**\n\t * Defines whether dependencies (all files except the one at the URL given to the load() or\n\t * parseData() operations) should be automatically loaded. Defaults to true.\n\t */\n\tpublic get includeDependencies():boolean\n\t{\n\t\treturn this._includeDependencies;\n\t}\n\n\tpublic set includeDependencies(val:boolean)\n\t{\n\t\tthis._includeDependencies = val;\n\t}\n\n\t/**\n\t * MaterialMode defines, if the Parser should create SinglePass or MultiPass Materials\n\t * Options:\n\t * 0 (Default / undefined) - All Parsers will create SinglePassMaterials, but the AWD2.1parser will create Materials as they are defined in the file\n\t * 1 (Force SinglePass) - All Parsers create SinglePassMaterials\n\t * 2 (Force MultiPass) - All Parsers will create MultiPassMaterials\n\t *\n\t */\n\tpublic get materialMode():number\n\t{\n\t\treturn this._materialMode;\n\t}\n\n\tpublic set materialMode(materialMode:number)\n\t{\n\t\tthis._materialMode = materialMode;\n\t}\n\n\t/**\n\t * A base URL that will be prepended to all relative dependency URLs found in a loaded resource.\n\t * Absolute paths will not be affected by the value of this property.\n\t */\n\tpublic get dependencyBaseUrl():string\n\t{\n\t\treturn this._dependencyBaseUrl;\n\t}\n\n\tpublic set dependencyBaseUrl(val:string)\n\t{\n\t\tthis._dependencyBaseUrl = val;\n\t}\n\n\t/**\n\t * Defines whether absolute paths (defined as paths that begin with a \"/\") should be overridden\n\t * with the dependencyBaseUrl defined in this context. If this is true, and the base path is\n\t * \"base\", /path/to/asset.jpg will be resolved as base/path/to/asset.jpg.\n\t */\n\tpublic get overrideAbsolutePaths():boolean\n\t{\n\t\treturn this._overrideAbsPath;\n\t}\n\n\tpublic set overrideAbsolutePaths(val:boolean)\n\t{\n\t\tthis._overrideAbsPath = val;\n\t}\n\n\t/**\n\t * Defines whether \"full\" URLs (defined as a URL that includes a scheme, e.g. http://) should be\n\t * overridden with the dependencyBaseUrl defined in this context. If this is true, and the base\n\t * path is \"base\", http://example.com/path/to/asset.jpg will be resolved as base/path/to/asset.jpg.\n\t */\n\tpublic get overrideFullURLs():boolean\n\t{\n\t\treturn this._overrideFullUrls;\n\t}\n\n\tpublic set overrideFullURLs(val:boolean)\n\t{\n\t\tthis._overrideFullUrls = val;\n\t}\n\n\t/**\n\t * Map a URL to another URL, so that files that are referred to by the original URL will instead\n\t * be loaded from the new URL. Use this when your file structure does not match the one that is\n\t * expected by the loaded file.\n\t *\n\t * @param originalUrl The original URL which is referenced in the loaded resource.\n\t * @param newUrl The URL from which away.should load the resource instead.\n\t *\n\t * @see mapUrlToData()\n\t */\n\tpublic mapUrl(originalUrl:string, newUrl:string)\n\t{\n\t\tthis._remappedUrls[originalUrl] = newUrl;\n\t}\n\n\t/**\n\t * Map a URL to embedded data, so that instead of trying to load a dependency from the URL at\n\t * which it's referenced, the dependency data will be retrieved straight from the memory instead.\n\t *\n\t * @param originalUrl The original URL which is referenced in the loaded resource.\n\t * @param data The embedded data. Can be ByteArray or a class which can be used to create a bytearray.\n\t */\n\tpublic mapUrlToData(originalUrl:string, data:any)\n\t{\n\t\tthis._embeddedDataByUrl[originalUrl] = data;\n\t}\n\n\t/**\n\t * @private\n\t * Defines whether embedded data has been mapped to a particular URL.\n\t */\n\tpublic _iHasDataForUrl(url:string):boolean\n\t{\n\t\treturn this._embeddedDataByUrl.hasOwnProperty(url);\n\t}\n\n\t/**\n\t * @private\n\t * Returns embedded data for a particular URL.\n\t */\n\tpublic _iGetDataForUrl(url:string):any\n\t{\n\t\treturn this._embeddedDataByUrl[url];\n\t}\n\n\t/**\n\t * @private\n\t * Defines whether a replacement URL has been mapped to a particular URL.\n\t */\n\tpublic _iHasMappingForUrl(url:string):boolean\n\t{\n\t\treturn this._remappedUrls.hasOwnProperty(url);\n\t}\n\n\t/**\n\t * @private\n\t * Returns new (replacement) URL for a particular original URL.\n\t */\n\tpublic _iGetRemappedUrl(originalUrl:string):string\n\t{\n\t\treturn this._remappedUrls[originalUrl];\n\t}\n}\n\nexport = AssetLoaderContext;","import AssetLoader\t\t\t\t= require(\"awayjs-core/lib/library/AssetLoader\");\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\n\n/**\n * Dispatched when any asset finishes parsing. Also see specific events for each\n * individual asset type (meshes, materials et c.)\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"assetComplete\", type=\"away3d.events.AssetEvent\")]\n\n\n/**\n * Dispatched when a full resource (including dependencies) finishes loading.\n *\n * @eventType away.events.LoaderEvent\n */\n//[Event(name=\"resourceComplete\", type=\"away3d.events.LoaderEvent\")]\n\n\n/**\n * Dispatched when a single dependency (which may be the main file of a resource)\n * finishes loading.\n *\n * @eventType away.events.LoaderEvent\n */\n//[Event(name=\"dependencyComplete\", type=\"away3d.events.LoaderEvent\")]\n\n\n/**\n * Dispatched when an error occurs during loading. I\n *\n * @eventType away.events.LoaderEvent\n */\n//[Event(name=\"loadError\", type=\"away3d.events.LoaderEvent\")]\n\n\n/**\n * Dispatched when an error occurs during parsing.\n *\n * @eventType away.events.ParserEvent\n */\n//[Event(name=\"parseError\", type=\"away3d.events.ParserEvent\")]\n\n\n/**\n * Dispatched when a skybox asset has been costructed from a ressource.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"skyboxComplete\", type=\"away3d.events.AssetEvent\")]\n\n/**\n * Dispatched when a camera3d asset has been costructed from a ressource.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"cameraComplete\", type=\"away3d.events.AssetEvent\")]\n\n/**\n * Dispatched when a mesh asset has been costructed from a ressource.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"meshComplete\", type=\"away3d.events.AssetEvent\")]\n\n/**\n * Dispatched when a geometry asset has been constructed from a resource.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"geometryComplete\", type=\"away3d.events.AssetEvent\")]\n\n/**\n * Dispatched when a skeleton asset has been constructed from a resource.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"skeletonComplete\", type=\"away3d.events.AssetEvent\")]\n\n/**\n * Dispatched when a skeleton pose asset has been constructed from a resource.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"skeletonPoseComplete\", type=\"away3d.events.AssetEvent\")]\n\n/**\n * Dispatched when a container asset has been constructed from a resource.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"containerComplete\", type=\"away3d.events.AssetEvent\")]\n\n/**\n * Dispatched when a texture asset has been constructed from a resource.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"textureComplete\", type=\"away3d.events.AssetEvent\")]\n\n/**\n * Dispatched when a texture projector asset has been constructed from a resource.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"textureProjectorComplete\", type=\"away3d.events.AssetEvent\")]\n\n\n/**\n * Dispatched when a material asset has been constructed from a resource.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"materialComplete\", type=\"away3d.events.AssetEvent\")]\n\n\n/**\n * Dispatched when a animator asset has been constructed from a resource.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"animatorComplete\", type=\"away3d.events.AssetEvent\")]\n\n\n/**\n * Dispatched when an animation set has been constructed from a group of animation state resources.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"animationSetComplete\", type=\"away3d.events.AssetEvent\")]\n\n\n/**\n * Dispatched when an animation state has been constructed from a group of animation node resources.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"animationStateComplete\", type=\"away3d.events.AssetEvent\")]\n\n\n/**\n * Dispatched when an animation node has been constructed from a resource.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"animationNodeComplete\", type=\"away3d.events.AssetEvent\")]\n\n\n/**\n * Dispatched when an animation state transition has been constructed from a group of animation node resources.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"stateTransitionComplete\", type=\"away3d.events.AssetEvent\")]\n\n\n/**\n * Dispatched when an light asset has been constructed from a resources.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"lightComplete\", type=\"away3d.events.AssetEvent\")]\n\n\n/**\n * Dispatched when an light picker asset has been constructed from a resources.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"lightPickerComplete\", type=\"away3d.events.AssetEvent\")]\n\n\n/**\n * Dispatched when an effect method asset has been constructed from a resources.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"effectMethodComplete\", type=\"away3d.events.AssetEvent\")]\n\n\n/**\n * Dispatched when an shadow map method asset has been constructed from a resources.\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"shadowMapMethodComplete\", type=\"away3d.events.AssetEvent\")]\n\n/**\n * Instances of this class are returned as tokens by loading operations\n * to provide an object on which events can be listened for in cases where\n * the actual asset loader is not directly available (e.g. when using the\n * AssetLibrary to perform the load.)\n *\n * By listening for events on this class instead of directly on the\n * AssetLibrary, one can distinguish different loads from each other.\n *\n * The token will dispatch all events that the original AssetLoader dispatches,\n * while not providing an interface to obstruct the load and is as such a\n * safer return value for loader wrappers than the loader itself.\n */\nclass AssetLoaderToken extends EventDispatcher\n{\n\tpublic _iLoader:AssetLoader;\n\n\tconstructor(loader:AssetLoader)\n\t{\n\t\tsuper();\n\n\t\tthis._iLoader = loader;\n\t}\n\n\tpublic addEventListener(type:string, listener:Function)\n\t{\n\t\tthis._iLoader.addEventListener(type, listener);\n\t}\n\n\n\tpublic removeEventListener(type:string, listener:Function)\n\t{\n\t\tthis._iLoader.removeEventListener(type, listener);\n\t}\n\n\tpublic hasEventListener(type:string, listener:Function = null):boolean\n\t{\n\t\treturn this._iLoader.hasEventListener(type, listener);\n\t}\n\n\t/*\n\t public willTrigger(type:string):boolean\n\t {\n\t return this._iLoader.willTrigger(type);\n\t }\n\t */\n}\n\nexport = AssetLoaderToken;","import AssetLoaderContext\t\t= require(\"awayjs-core/lib/library/AssetLoaderContext\");\nimport AssetLoaderToken\t\t\t= require(\"awayjs-core/lib/library/AssetLoaderToken\");\nimport URLLoader\t\t\t\t= require(\"awayjs-core/lib/net/URLLoader\");\nimport URLLoaderDataFormat\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\nimport URLRequest\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\nimport Error\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\nimport AssetEvent\t\t\t\t= require(\"awayjs-core/lib/events/AssetEvent\");\nimport Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\nimport IOErrorEvent\t\t\t\t= require(\"awayjs-core/lib/events/IOErrorEvent\");\nimport LoaderEvent\t\t\t\t= require(\"awayjs-core/lib/events/LoaderEvent\");\nimport ParserEvent\t\t\t\t= require(\"awayjs-core/lib/events/ParserEvent\");\nimport CubeTextureParser\t\t= require(\"awayjs-core/lib/parsers/CubeTextureParser\");\nimport ParserBase\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\nimport ResourceDependency\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\nimport Texture2DParser\t\t\t= require(\"awayjs-core/lib/parsers/Texture2DParser\");\n\n/**\n * Dispatched when any asset finishes parsing. Also see specific events for each\n * individual asset type (meshes, materials et c.)\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"assetComplete\", type=\"away3d.events.AssetEvent\")]\n\n\n/**\n * Dispatched when a full resource (including dependencies) finishes loading.\n *\n * @eventType away.events.LoaderEvent\n */\n//[Event(name=\"resourceComplete\", type=\"away3d.events.LoaderEvent\")]\n\n\n/**\n * Dispatched when a single dependency (which may be the main file of a resource)\n * finishes loading.\n *\n * @eventType away.events.LoaderEvent\n */\n//[Event(name=\"dependencyComplete\", type=\"away3d.events.LoaderEvent\")]\n\n\n/**\n * Dispatched when an error occurs during loading. I\n *\n * @eventType away.events.LoaderEvent\n */\n//[Event(name=\"loadError\", type=\"away3d.events.LoaderEvent\")]\n\n\n/**\n * Dispatched when an error occurs during parsing.\n *\n * @eventType away.events.ParserEvent\n */\n//[Event(name=\"parseError\", type=\"away3d.events.ParserEvent\")]\n\n/**\n * Dispatched when an image asset dimensions are not a power of 2\n *\n * @eventType away.events.AssetEvent\n */\n//[Event(name=\"textureSizeError\", type=\"away3d.events.AssetEvent\")]\n\n/**\n * AssetLoader can load any file format that away.supports (or for which a third-party parser\n * has been plugged in) and it's dependencies. Events are dispatched when assets are encountered\n * and for when the resource (or it's dependencies) have been loaded.\n *\n * The AssetLoader will not make assets available in any other way than through the dispatched\n * events. To store assets and make them available at any point from any module in an application,\n * use the AssetLibrary to load and manage assets.\n *\n * @see away.library.AssetLibrary\n */\nclass AssetLoader extends EventDispatcher\n{\n\tprivate _context:AssetLoaderContext;\n\tprivate _token:AssetLoaderToken;\n\tprivate _uri:string;\n\tprivate _materialMode:number;\n\n\tprivate _errorHandlers:Array<Function>;\n\tprivate _parseErrorHandlers:Array<Function>;\n\n\tprivate _stack:Array<ResourceDependency>;\n\tprivate _baseDependency:ResourceDependency;\n\tprivate _currentDependency:ResourceDependency;\n\tprivate _namespace:string;\n\n\tprivate _onReadyForDependenciesDelegate:(event:ParserEvent) => void;\n\tprivate _onParseCompleteDelegate:(event:ParserEvent) => void;\n\tprivate _onParseErrorDelegate:(event:ParserEvent) => void;\n\tprivate _onLoadCompleteDelegate:(event:Event) => void;\n\tprivate _onLoadErrorDelegate:(event:IOErrorEvent) => void;\n\tprivate _onTextureSizeErrorDelegate:(event:AssetEvent) => void;\n\tprivate _onAssetCompleteDelegate:(event:AssetEvent) => void;\n\n\t// Image parser only parser that is added by default, to save file size.\n\tprivate static _parsers:Array<any> = new Array<any>(Texture2DParser, CubeTextureParser);\n\n\t/**\n\t * Enables a specific parser.\n\t * When no specific parser is set for a loading/parsing opperation,\n\t * loader3d can autoselect the correct parser to use.\n\t * A parser must have been enabled, to be considered when autoselecting the parser.\n\t *\n\t * @param parser The parser class to enable.\n\t *\n\t * @see away.parsers.Parsers\n\t */\n\tpublic static enableParser(parser)\n\t{\n\t\tif (AssetLoader._parsers.indexOf(parser) < 0)\n\t\t\tAssetLoader._parsers.push(parser);\n\t}\n\n\t/**\n\t * Enables a list of parsers.\n\t * When no specific parser is set for a loading/parsing opperation,\n\t * AssetLoader can autoselect the correct parser to use.\n\t * A parser must have been enabled, to be considered when autoselecting the parser.\n\t *\n\t * @param parsers A Vector of parser classes to enable.\n\t * @see away.parsers.Parsers\n\t */\n\tpublic static enableParsers(parsers:Array<Object>)\n\t{\n\t\tfor (var c:number = 0; c < parsers.length; c++)\n\t\t\tAssetLoader.enableParser(parsers[ c ]);\n\t}\n\n\t/**\n\t * Returns the base dependency of the loader\n\t */\n\tpublic get baseDependency():ResourceDependency\n\t{\n\t\treturn this._baseDependency;\n\t}\n\n\t/**\n\t * Create a new ResourceLoadSession object.\n\t */\n\tconstructor(materialMode:number = 0)\n\t{\n\t\tsuper();\n\n\t\tthis._materialMode = materialMode;\n\n\t\tthis._stack = new Array<ResourceDependency>();\n\t\tthis._errorHandlers = new Array<Function>();\n\t\tthis._parseErrorHandlers = new Array<Function>();\n\n\t\tthis._onReadyForDependenciesDelegate = (event:ParserEvent) => this.onReadyForDependencies(event);\n\t\tthis._onParseCompleteDelegate = (event:ParserEvent) => this.onParseComplete(event);\n\t\tthis._onParseErrorDelegate = (event:ParserEvent) => this.onParseError(event);\n\t\tthis._onLoadCompleteDelegate = (event:Event) => this.onLoadComplete(event);\n\t\tthis._onLoadErrorDelegate = (event:IOErrorEvent) => this.onLoadError(event);\n\t\tthis._onTextureSizeErrorDelegate = (event:AssetEvent) => this.onTextureSizeError(event);\n\t\tthis._onAssetCompleteDelegate = (event:AssetEvent) => this.onAssetComplete(event);\n\t}\n\n\t/**\n\t * Loads a file and (optionally) all of its dependencies.\n\t *\n\t * @param req The URLRequest object containing the URL of the file to be loaded.\n\t * @param context An optional context object providing additional parameters for loading\n\t * @param ns An optional namespace string under which the file is to be loaded, allowing the differentiation of two resources with identical assets\n\t * @param parser An optional parser object for translating the loaded data into a usable resource. If not provided, AssetLoader will attempt to auto-detect the file type.\n\t */\n\tpublic load(req:URLRequest, context:AssetLoaderContext = null, ns:string = null, parser:ParserBase = null):AssetLoaderToken\n\t{\n\t\tif (!this._token) {\n\t\t\tthis._token = new AssetLoaderToken(this);\n\n\t\t\tthis._uri = req.url = req.url.replace(/\\\\/g, \"/\");\n\t\t\tthis._context = context;\n\t\t\tthis._namespace = ns;\n\n\t\t\tthis._baseDependency = new ResourceDependency('', req, null, parser, null);\n\t\t\tthis.retrieveDependency(this._baseDependency);\n\n\t\t\treturn this._token;\n\t\t}\n\n\t\t// TODO: Throw error (already loading)\n\t\treturn null;\n\t}\n\n\t/**\n\t * Loads a resource from already loaded data.\n\t *\n\t * @param data The data object containing all resource information.\n\t * @param context An optional context object providing additional parameters for loading\n\t * @param ns An optional namespace string under which the file is to be loaded, allowing the differentiation of two resources with identical assets\n\t * @param parser An optional parser object for translating the loaded data into a usable resource. If not provided, AssetLoader will attempt to auto-detect the file type.\n\t */\n\tpublic loadData(data:any, id:string, context:AssetLoaderContext = null, ns:string = null, parser:ParserBase = null):AssetLoaderToken\n\t{\n\t\tif (!this._token) {\n\t\t\tthis._token = new AssetLoaderToken(this);\n\n\t\t\tthis._uri = id;\n\t\t\tthis._context = context;\n\t\t\tthis._namespace = ns;\n\n\t\t\tthis._baseDependency = new ResourceDependency(id, null, data, parser, null);\n\t\t\tthis.retrieveDependency(this._baseDependency);\n\n\t\t\treturn this._token;\n\t\t}\n\n\t\t// TODO: Throw error (already loading)\n\t\treturn null;\n\t}\n\n\t/**\n\t * Recursively retrieves the next to-be-loaded and parsed dependency on the stack, or pops the list off the\n\t * stack when complete and continues on the top set.\n\t * @param parser The parser that will translate the data into a usable resource.\n\t */\n\tprivate retrieveNext(parser:ParserBase = null)\n\t{\n\t\tif (this._currentDependency.dependencies.length) {\n\n\t\t\tvar next:ResourceDependency = this._currentDependency.dependencies.pop();\n\n\t\t\tthis._stack.push(this._currentDependency);\n\t\t\tthis.retrieveDependency(next);\n\n\t\t} else if (this._currentDependency.parser && this._currentDependency.parser.parsingPaused) {\n\n\t\t\tthis._currentDependency.parser._iResumeParsingAfterDependencies();\n\t\t\tthis._stack.pop();\n\n\t\t} else if (this._stack.length) {\n\n\t\t\tvar prev:ResourceDependency = this._currentDependency;\n\n\t\t\tthis._currentDependency = this._stack.pop();\n\n\t\t\tif (prev._iSuccess)\n\t\t\t\tprev.resolve();\n\n\t\t\tthis.retrieveNext(parser);\n\n\t\t} else {\n\t\t\tthis.dispatchEvent(new LoaderEvent(LoaderEvent.RESOURCE_COMPLETE, this._uri, this._baseDependency.parser.content, this._baseDependency.assets));\n\t\t}\n\t}\n\n\t/**\n\t * Retrieves a single dependency.\n\t * @param parser The parser that will translate the data into a usable resource.\n\t */\n\tprivate retrieveDependency(dependency:ResourceDependency)\n\t{\n\t\tvar data:any;\n\n\t\tif (this._context && this._context.materialMode != 0)\n\t\t\tthis._materialMode = this._context.materialMode;\n\n\t\tthis._currentDependency = dependency;\n\n\t\tdependency._iLoader = new URLLoader();\n\n\t\tthis.addEventListeners(dependency._iLoader);\n\n\t\t// Get already loaded (or mapped) data if available\n\t\tdata = dependency.data;\n\n\t\tif (this._context && dependency.request && this._context._iHasDataForUrl(dependency.request.url))\n\t\t\tdata = this._context._iGetDataForUrl(dependency.request.url);\n\n\t\tif (data) {\n\t\t\tif (data.constructor === Function)\n\t\t\t\tdata = new data();\n\n\t\t\tdependency._iSetData(data);\n\n\t\t\tif (dependency.retrieveAsRawData) {\n\t\t\t\t// No need to parse. The parent parser is expecting this\n\t\t\t\t// to be raw data so it can be passed directly.\n\t\t\t\tdependency.resolve();\n\n\t\t\t\t// Move on to next dependency\n\t\t\t\tthis.retrieveNext();\n\n\t\t\t} else {\n\t\t\t\tthis.parseDependency(dependency);\n\t\t\t}\n\n\t\t} else {\n\t\t\t// Resolve URL and start loading\n\t\t\tdependency.request.url = this.resolveDependencyUrl(dependency);\n\n\t\t\tif (dependency.retrieveAsRawData) {\n\t\t\t\t// Always use binary for raw data loading\n\t\t\t\tdependency._iLoader.dataFormat = URLLoaderDataFormat.BINARY;\n\t\t\t} else {\n\n\t\t\t\tif (!dependency.parser)\n\t\t\t\t\tdependency._iSetParser(this.getParserFromSuffix(dependency.request.url));\n\n\t\t\t\tif (dependency.parser) {\n\t\t\t\t\tdependency._iLoader.dataFormat = dependency.parser.dataFormat;\n\t\t\t\t} else {\n\t\t\t\t\t// Always use BINARY for unknown file formats. The thorough\n\t\t\t\t\t// file type check will determine format after load, and if\n\t\t\t\t\t// binary, a text load will have broken the file data.\n\t\t\t\t\tdependency._iLoader.dataFormat = URLLoaderDataFormat.BINARY;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdependency._iLoader.load(dependency.request);\n\t\t}\n\t}\n\n\tprivate joinUrl(base:string, end:string):string\n\t{\n\t\tif (end.charAt(0) == '/')\n\t\t\tend = end.substr(1);\n\n\t\tif (base.length == 0)\n\t\t\treturn end;\n\n\t\tif (base.charAt(base.length - 1) == '/')\n\t\t\tbase = base.substr(0, base.length - 1);\n\n\t\treturn base.concat('/', end);\n\n\t}\n\n\tprivate resolveDependencyUrl(dependency:ResourceDependency):string\n\t{\n\t\tvar scheme_re:RegExp;\n\t\tvar base:string;\n\t\tvar url:string = dependency.request.url;\n\n\t\t// Has the user re-mapped this URL?\n\t\tif (this._context && this._context._iHasMappingForUrl(url))\n\t\t\treturn this._context._iGetRemappedUrl(url);\n\n\t\t// This is the \"base\" dependency, i.e. the actual requested asset.\n\t\t// We will not try to resolve this since the user can probably be\n\t\t// thrusted to know this URL better than our automatic resolver. :)\n\t\tif (url == this._uri)\n\t\t\treturn url;\n\n\n\t\t// Absolute URL? Check if starts with slash or a URL\n\t\t// scheme definition (e.g. ftp://, http://, file://)\n\t\tscheme_re = new RegExp('/^[a-zA-Z]{3,4}:\\/\\//');\n\n\t\tif (url.charAt(0) == '/') {\n\t\t\tif (this._context && this._context.overrideAbsolutePaths)\n\t\t\t\treturn this.joinUrl(this._context.dependencyBaseUrl, url); else\n\t\t\t\treturn url;\n\t\t} else if (scheme_re.test(url)) {\n\t\t\t// If overriding full URLs, get rid of scheme (e.g. \"http://\")\n\t\t\t// and replace with the dependencyBaseUrl defined by user.\n\t\t\tif (this._context && this._context.overrideFullURLs) {\n\n\t\t\t\tvar noscheme_url : string  = url.replace( scheme_re , '' );//url['replace'](scheme_re);\n\t\t\t\treturn this.joinUrl(this._context.dependencyBaseUrl, <string> noscheme_url);\n\t\t\t}\n\t\t}\n\n\t\t// Since not absolute, just get rid of base file name to find it's\n\t\t// folder and then concatenate dynamic URL\n\t\tif (this._context && this._context.dependencyBaseUrl) {\n\t\t\tbase = this._context.dependencyBaseUrl;\n\t\t\treturn this.joinUrl(base, url);\n\t\t} else {\n\t\t\tbase = this._uri.substring(0, this._uri.lastIndexOf('/') + 1);\n\t\t\treturn this.joinUrl(base, url);\n\t\t}\n\t}\n\n\tprivate retrieveParserDependencies()\n\t{\n\t\tif (!this._currentDependency)\n\t\t\treturn;\n\n\t\tvar parserDependancies = this._currentDependency.parser.dependencies\n\t\tvar i:number, len:number = parserDependancies.length;\n\n\t\tfor (i = 0; i < len; i++)\n\t\t\tthis._currentDependency.dependencies[i] = parserDependancies[i];\n\n\n\t\t// Since more dependencies might be added eventually, empty this\n\t\t// list so that the same dependency isn't retrieved more than once.\n\t\tparserDependancies.length = 0;\n\n\t\tthis._stack.push(this._currentDependency);\n\n\t\tthis.retrieveNext();\n\t}\n\n\tprivate resolveParserDependencies()\n\t{\n\t\tthis._currentDependency._iSuccess = true;\n\n\t\t// Retrieve any last dependencies remaining on this parser, or\n\t\t// if none exists, just move on.\n\t\tif (this._currentDependency.parser && this._currentDependency.parser.dependencies.length && (!this._context || this._context.includeDependencies))//context may be null\n\t\t\tthis.retrieveParserDependencies();\n\t\telse\n\t\t\tthis.retrieveNext();\n\t}\n\n\t/**\n\t * Called when a single dependency loading failed, and pushes further dependencies onto the stack.\n\t * @param event\n\t */\n\tprivate onLoadError(event:IOErrorEvent)\n\t{\n\t\tvar handled:boolean;\n\t\tvar isDependency:boolean = (this._currentDependency != this._baseDependency);\n\t\tvar loader:URLLoader = <URLLoader> event.target;//TODO: keep on eye on this one\n\n\t\tthis.removeEventListeners(loader);\n\n\t\tif (this.hasEventListener(IOErrorEvent.IO_ERROR )) {\n\t\t\tthis.dispatchEvent(event);\n\t\t\thandled = true;\n\t\t} else {\n\t\t\t// TODO: Consider not doing this even when AssetLoader does have it's own LOAD_ERROR listener\n\t\t\tvar i:number, len:number = this._errorHandlers.length;\n\t\t\tfor (i = 0; i < len; i++)\n\t\t\t\tif (!handled)\n\t\t\t\t\thandled = <boolean> this._errorHandlers[i](event);\n\t\t}\n\n\t\tif (handled) {\n\n\t\t\t//if (isDependency && ! event.isDefaultPrevented()) {\n\t\t\tif (isDependency) { // TODO: JS / AS3 Change - we don't have isDefaultPrevented - so will this work\n\n\t\t\t\tthis._currentDependency.resolveFailure();\n\t\t\t\tthis.retrieveNext();\n\n\t\t\t} else {\n\t\t\t\t// Either this was the base file (last left in the stack) or\n\t\t\t\t// default behavior was prevented by the handlers, and hence\n\t\t\t\t// there is nothing more to do than clean up and bail.\n\t\t\t\tthis.dispose();\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else {\n\n\t\t\t// Error event was not handled by listeners directly on AssetLoader or\n\t\t\t// on any of the subscribed loaders (in the list of error handlers.)\n\t\t\tthrow new Error();\n\t\t}\n\t}\n\n\t/**\n\t * Called when a dependency parsing failed, and dispatches a <code>ParserEvent.PARSE_ERROR</code>\n\t * @param event\n\t */\n\tprivate onParseError(event:ParserEvent)\n\t{\n\t\tvar handled:boolean;\n\n\t\tvar isDependency:boolean = (this._currentDependency != this._baseDependency);\n\n\t\tvar loader:URLLoader = <URLLoader>event.target;\n\n\t\tthis.removeEventListeners(loader);\n\n\t\tif (this.hasEventListener(ParserEvent.PARSE_ERROR)) {\n\t\t\tthis.dispatchEvent(event);\n\t\t\thandled = true;\n\t\t} else {\n\t\t\t// TODO: Consider not doing this even when AssetLoader does\n\t\t\t// have it's own LOAD_ERROR listener\n\t\t\tvar i:number, len:number = this._parseErrorHandlers.length;\n\n\t\t\tfor (i = 0; i < len; i++)\n\t\t\t\tif (!handled)\n\t\t\t\t\thandled = <boolean> this._parseErrorHandlers[i](event);\n\t\t}\n\n\t\tif (handled) {\n\t\t\tthis.dispose();\n\t\t\treturn;\n\t\t} else {\n\t\t\t// Error event was not handled by listeners directly on AssetLoader or\n\t\t\t// on any of the subscribed loaders (in the list of error handlers.)\n\t\t\tthrow new Error(event.message);\n\t\t}\n\t}\n\n\tprivate onAssetComplete(event:AssetEvent)\n\t{\n\t\t// Add loaded asset to list of assets retrieved as part\n\t\t// of the current dependency. This list will be inspected\n\t\t// by the parent parser when dependency is resolved\n\t\tif (this._currentDependency)\n\t\t\tthis._currentDependency.assets.push(event.asset);\n\n\t\tevent.asset.resetAssetPath(event.asset.name, this._namespace);\n\n\t\tif (!this._currentDependency.suppresAssetEvents)\n\t\t\tthis.dispatchEvent(event);\n\t}\n\n\tprivate onReadyForDependencies(event:ParserEvent)\n\t{\n\t\tvar parser:ParserBase = <ParserBase> event.target;\n\n\t\tif (this._context && !this._context.includeDependencies)\n\t\t\tparser._iResumeParsingAfterDependencies();\n\t\telse\n\t\t\tthis.retrieveParserDependencies();\n\t}\n\n\t/**\n\t * Called when a single dependency was parsed, and pushes further dependencies onto the stack.\n\t * @param event\n\t */\n\tprivate onLoadComplete(event:Event)\n\t{\n\t\tvar loader:URLLoader = <URLLoader> event.target;\n\n\t\tthis.removeEventListeners(loader);\n\n\t\t// Resolve this dependency\n\t\tthis._currentDependency._iSetData(loader.data);\n\n\t\tif (this._currentDependency.retrieveAsRawData) {\n\t\t\t// No need to parse this data, which should be returned as is\n\t\t\tthis.resolveParserDependencies();\n\t\t} else {\n\t\t\tthis.parseDependency(this._currentDependency);\n\t\t}\n\t}\n\n\t/**\n\t * Called when parsing is complete.\n\t */\n\tprivate onParseComplete(event:ParserEvent):void\n\t{\n\t\tvar parser:ParserBase = <ParserBase> event.target;\n\n\t\tthis.resolveParserDependencies();//resolve in front of removing listeners to allow any remaining asset events to propagate\n\n\t\tparser.removeEventListener(ParserEvent.READY_FOR_DEPENDENCIES, this._onReadyForDependenciesDelegate);\n\t\tparser.removeEventListener(ParserEvent.PARSE_COMPLETE, this._onParseCompleteDelegate);\n\t\tparser.removeEventListener(ParserEvent.PARSE_ERROR, this._onParseErrorDelegate);\n\t\tparser.removeEventListener(AssetEvent.TEXTURE_SIZE_ERROR, this._onTextureSizeErrorDelegate);\n\t\tparser.removeEventListener(AssetEvent.ASSET_COMPLETE, this._onAssetCompleteDelegate);\n\t}\n\n\t/**\n\t * Called when an image is too large or it's dimensions are not a power of 2\n\t * @param event\n\t */\n\tprivate onTextureSizeError(event:AssetEvent)\n\t{\n\t\tevent.asset.name = this._currentDependency.resolveName(event.asset);\n\n\t\tthis.dispatchEvent(event);\n\t}\n\n\tprivate addEventListeners(loader:URLLoader)\n\t{\n\t\tloader.addEventListener(Event.COMPLETE, this._onLoadCompleteDelegate);\n\t\tloader.addEventListener(IOErrorEvent.IO_ERROR, this._onLoadErrorDelegate);\n\t}\n\n\tprivate removeEventListeners(loader:URLLoader)\n\t{\n\t\tloader.removeEventListener(Event.COMPLETE, this._onLoadCompleteDelegate);\n\t\tloader.removeEventListener(IOErrorEvent.IO_ERROR, this._onLoadErrorDelegate);\n\t}\n\n\tpublic stop()\n\t{\n\t\tthis.dispose();\n\t}\n\n\tprivate dispose()\n\t{\n\t\tthis._errorHandlers = null;\n\t\tthis._parseErrorHandlers = null;\n\t\tthis._context = null;\n\t\tthis._token = null;\n\t\tthis._stack = null;\n\n\t\tif (this._currentDependency && this._currentDependency._iLoader)\n\t\t\tthis.removeEventListeners(this._currentDependency._iLoader);\n\n\t\tthis._currentDependency = null;\n\n\t}\n\n\t/**\n\t * @private\n\t * This method is used by other loader classes (e.g. Loader3D and AssetLibraryBundle) to\n\t * add error event listeners to the AssetLoader instance. This system is used instead of\n\t * the regular EventDispatcher system so that the AssetLibrary error handler can be sure\n\t * that if hasEventListener() returns true, it's client code that's listening for the\n\t * event. Secondly, functions added as error handler through this custom method are\n\t * expected to return a boolean value indicating whether the event was handled (i.e.\n\t * whether they in turn had any client code listening for the event.) If no handlers\n\t * return true, the AssetLoader knows that the event wasn't handled and will throw an RTE.\n\t */\n\n\tpublic _iAddParseErrorHandler(handler)\n\t{\n\t\tif (this._parseErrorHandlers.indexOf(handler) < 0)\n\t\t\tthis._parseErrorHandlers.push(handler);\n\t}\n\n\tpublic _iAddErrorHandler(handler)\n\t{\n\t\tif (this._errorHandlers.indexOf(handler) < 0)\n\t\t\tthis._errorHandlers.push(handler);\n\t}\n\n\n\t/**\n\t * Guesses the parser to be used based on the file contents.\n\t * @param data The data to be parsed.\n\t * @param uri The url or id of the object to be parsed.\n\t * @return An instance of the guessed parser.\n\t */\n\tprivate getParserFromData(data:any):ParserBase\n\t{\n\t\tvar len:number = AssetLoader._parsers.length;\n\n\t\t// go in reverse order to allow application override of default parser added in away.proper\n\t\tfor (var i:number = len - 1; i >= 0; i--)\n\t\t\tif (AssetLoader._parsers[i].supportsData(data))\n\t\t\t\treturn new AssetLoader._parsers[i]();\n\n\t\treturn null;\n\t}\n\n\n\t/**\n\t * Initiates parsing of the loaded dependency.\n\t *\n\t * @param The dependency to be parsed.\n\t */\n\tprivate parseDependency(dependency:ResourceDependency):void\n\t{\n\t\tvar parser:ParserBase = dependency.parser;\n\n\t\t// If no parser has been defined, try to find one by letting\n\t\t// all plugged in parsers inspect the actual data.\n\t\tif (!parser)\n\t\t\tdependency._iSetParser(parser = this.getParserFromData(dependency.data));\n\n\t\tif (parser) {\n\t\t\tparser.addEventListener(ParserEvent.READY_FOR_DEPENDENCIES, this._onReadyForDependenciesDelegate);\n\t\t\tparser.addEventListener(ParserEvent.PARSE_COMPLETE, this._onParseCompleteDelegate);\n\t\t\tparser.addEventListener(ParserEvent.PARSE_ERROR, this._onParseErrorDelegate);\n\t\t\tparser.addEventListener(AssetEvent.TEXTURE_SIZE_ERROR, this._onTextureSizeErrorDelegate);\n\t\t\tparser.addEventListener(AssetEvent.ASSET_COMPLETE, this._onAssetCompleteDelegate);\n\n\t\t\tif (dependency.request && dependency.request.url)\n\t\t\t\tparser._iFileName = dependency.request.url;\n\n\t\t\tparser.materialMode = this._materialMode;\n\n\t\t\tparser.parseAsync(dependency.data);\n\n\t\t} else {\n\t\t\tvar message:string = \"No parser defined. To enable all parsers for auto-detection, use Parsers.enableAllBundled()\"\n\t\t\tif(this.hasEventListener(ParserEvent.PARSE_ERROR))\n\t\t\t\tthis.dispatchEvent(new ParserEvent(ParserEvent.PARSE_ERROR, message));\n\t\t\telse\n\t\t\t\tthrow new Error(message);\n\t\t}\n\t}\n\n\t/**\n\t * Guesses the parser to be used based on the file extension.\n\t * @return An instance of the guessed parser.\n\t */\n\tprivate getParserFromSuffix(url:string):ParserBase\n\t{\n\t\t// Get rid of query string if any and extract extension\n\t\tvar base:string = (url.indexOf('?') > 0)? url.split('?')[0] : url;\n\t\tvar fileExtension:string = base.substr(base.lastIndexOf('.') + 1).toLowerCase();\n\n\t\tvar len:number = AssetLoader._parsers.length;\n\n\t\t// go in reverse order to allow application override of default parser added in away.proper\n\t\tfor (var i:number = len - 1; i >= 0; i--) {\n\t\t\tvar parserClass:any = AssetLoader._parsers[i];\n\t\t\tif (parserClass.supportsType(fileExtension))\n\t\t\t\treturn new parserClass();\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\nexport = AssetLoader;","class AssetType\n{\n\tpublic static ANIMATION_NODE:string = 'animationNode';\n\tpublic static ANIMATION_SET:string = 'animationSet';\n\tpublic static ANIMATION_STATE:string = 'animationState';\n\tpublic static ANIMATOR:string = 'animator';\n\tpublic static BILLBOARD:string = 'billboard';\n\tpublic static CAMERA:string = 'camera';\n\tpublic static CONTAINER:string = 'container';\n\tpublic static EFFECTS_METHOD:string = 'effectsMethod';\n\tpublic static GEOMETRY:string = 'geometry';\n\tpublic static LINE_SEGMENT:string = 'lineSegment';\n\tpublic static LIGHT:string = 'light';\n\tpublic static LIGHT_PICKER:string = 'lightPicker';\n\tpublic static MATERIAL:string = 'material';\n\tpublic static MESH:string = 'mesh';\n\tpublic static TRIANGLE_SUB_MESH:string = 'triangleSubMesh';\n\tpublic static LINE_SUB_MESH:string = 'lineSubMesh';\n\tpublic static PRIMITIVE_PREFAB:string = 'primitivePrefab';\n\tpublic static SHADOW_MAP_METHOD:string = 'shadowMapMethod';\n\tpublic static SKELETON:string = 'skeleton';\n\tpublic static SKELETON_POSE:string = 'skeletonPose';\n\tpublic static SKYBOX:string = 'skybox';\n\tpublic static STATE_TRANSITION:string = 'stateTransition';\n\tpublic static TEXTURE:string = 'texture';\n\tpublic static TEXTURE_PROJECTOR:string = 'textureProjector';\n\tpublic static TIMELINE:string = 'timeline';\n}\n\nexport = AssetType;","/**\n * Enumaration class for precedence when resolving naming conflicts in the library.\n *\n * @see away.library.AssetLibrary.conflictPrecedence\n * @see away.library.AssetLibrary.conflictStrategy\n * @see away.library.naming.ConflictStrategy\n */\nclass ConflictPrecedence\n{\n\t/**\n\t * Signals that in a conflict, the previous owner of the conflicting name\n\t * should be favored (and keep it's name) and that the newly renamed asset\n\t * is reverted to a non-conflicting name.\n\t */\n\tpublic static FAVOR_OLD:string = 'favorOld';\n\n\t/**\n\t * Signales that in a conflict, the newly renamed asset is favored (and keeps\n\t * it's newly defined name) and that the previous owner of that name gets\n\t * renamed to a non-conflicting name.\n\t */\n\tpublic static FAVOR_NEW:string = 'favorNew';\n}\n\nexport = ConflictPrecedence;","import ConflictPrecedence\t\t= require(\"awayjs-core/lib/library/ConflictPrecedence\");\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\nimport AssetEvent\t\t\t\t= require(\"awayjs-core/lib/events/AssetEvent\");\n\n/**\n * Abstract base class for naming conflict resolution classes. Extend this to create a\n * strategy class which the asset library can use to resolve asset naming conflicts, or\n * use one of the bundled concrete strategy classes:\n *\n * <ul>\n *   <li>IgnoreConflictStrategy (ConflictStrategy.IGNORE)</li>\n *   <li>ErrorConflictStrategy (ConflictStrategy.THROW_ERROR)</li>\n *   <li>NumSuffixConflictStrategy (ConflictStrategy.APPEND_NUM_SUFFIX)</li>\n * </ul>\n *\n * @see away.library.AssetLibrary.conflictStrategy\n * @see away.library.ConflictStrategy\n * @see away.library.IgnoreConflictStrategy\n * @see away.library.ErrorConflictStrategy\n * @see away.library.NumSuffixConflictStrategy\n */\nclass ConflictStrategyBase\n{\n\n\tconstructor()\n\t{\n\t}\n\n\t/**\n\t * Resolve a naming conflict between two assets. Must be implemented by concrete strategy\n\t * classes.\n\t */\n\tpublic resolveConflict(changedAsset:IAsset, oldAsset:IAsset, assetsDictionary:Object, precedence:string)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * Create instance of this conflict strategy. Used internally by the AssetLibrary to\n\t * make sure the same strategy instance is not used in all AssetLibrary instances, which\n\t * would break any state caching that happens inside the strategy class.\n\t */\n\tpublic create():ConflictStrategyBase\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * Provided as a convenience method for all conflict strategy classes, as a way to finalize\n\t * the conflict resolution by applying the new names and dispatching the correct events.\n\t */\n\tpublic _pUpdateNames(ns:string, nonConflictingName:string, oldAsset:IAsset, newAsset:IAsset, assetsDictionary:Object, precedence:string)\n\t{\n\t\tvar loser_prev_name:string;\n\t\tvar winner:IAsset;\n\t\tvar loser:IAsset;\n\n\t\twinner = (precedence === ConflictPrecedence.FAVOR_NEW)? newAsset : oldAsset;\n\t\tloser = (precedence === ConflictPrecedence.FAVOR_NEW)? oldAsset : newAsset;\n\n\t\tloser_prev_name = loser.name;\n\n\t\tassetsDictionary[winner.name] = winner;\n\t\tassetsDictionary[nonConflictingName] = loser;\n\t\tloser.resetAssetPath(nonConflictingName, ns, false);\n\n\t\tloser.dispatchEvent(new AssetEvent(AssetEvent.ASSET_CONFLICT_RESOLVED, loser, loser_prev_name));\n\t}\n}\n\nexport = ConflictStrategyBase;","import ConflictStrategyBase\t\t\t= require(\"awayjs-core/lib/library/ConflictStrategyBase\");\nimport ErrorConflictStrategy\t\t= require(\"awayjs-core/lib/library/ErrorConflictStrategy\");\nimport IgnoreConflictStrategy\t\t= require(\"awayjs-core/lib/library/IgnoreConflictStrategy\");\nimport NumSuffixConflictStrategy\t= require(\"awayjs-core/lib/library/NumSuffixConflictStrategy\");\n\n/**\n * Enumeration class for bundled conflict strategies. Set one of these values (or an\n * instance of a self-defined sub-class of ConflictStrategyBase) to the conflictStrategy\n * property on an AssetLibrary to define how that library resolves naming conflicts.\n *\n * The value of the <code>AssetLibrary.conflictPrecedence</code> property defines which\n * of the conflicting assets will get to keep it's name, and which is renamed (if any.)\n *\n * @see away.library.AssetLibrary.conflictStrategy\n * @see away.library.naming.ConflictStrategyBase\n */\nclass ConflictStrategy\n{\n\t/**\n\t * Specifies that in case of a naming conflict, one of the assets will be renamed and\n\t * a numeric suffix appended to the base name.\n\t */\n\tpublic static APPEND_NUM_SUFFIX:ConflictStrategyBase = new NumSuffixConflictStrategy();\n\n\t/**\n\t * Specifies that naming conflicts should be ignored. This is not recommended in most\n\t * cases, unless it can be 100% guaranteed that the application does not cause naming\n\t * conflicts in the library (i.e. when an app-level system is in place to prevent this.)\n\t */\n\tpublic static IGNORE:ConflictStrategyBase = new IgnoreConflictStrategy();\n\n\t/**\n\t * Specifies that an error should be thrown if a naming conflict is discovered. Use this\n\t * to be 100% sure that naming conflicts never occur unnoticed, and when it's undesirable\n\t * to have the library automatically rename assets to avoid such conflicts.\n\t */\n\tpublic static THROW_ERROR:ConflictStrategyBase = new ErrorConflictStrategy();\n\n\tconstructor(include?:ConflictStrategyBase)\n\t{\n\t\t//TODO: find out why typescript d.ts files do not include this class\n\t}\n}\n\nexport = ConflictStrategy;","import ConflictStrategyBase\t\t= require(\"awayjs-core/lib/library/ConflictStrategyBase\");\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport Error\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\n\nclass ErrorConflictStrategy extends ConflictStrategyBase\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\tpublic resolveConflict(changedAsset:IAsset, oldAsset:IAsset, assetsDictionary:Object, precedence:string)\n\t{\n\t\tthrow new Error('Asset name collision while AssetLibrary.namingStrategy set to AssetLibrary.THROW_ERROR. Asset path: ' + changedAsset.assetFullPath);\n\t}\n\n\tpublic create():ConflictStrategyBase\n\t{\n\t\treturn new ErrorConflictStrategy();\n\t}\n}\n\nexport = ErrorConflictStrategy;","class IDUtil\n{\n\t/**\n\t *  @private\n\t *  Char codes for 0123456789ABCDEF\n\t */\n\tprivate static ALPHA_CHAR_CODES = [48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 65, 66, 67, 68, 69, 70];\n\n\t/**\n\t *  Generates a UID (unique identifier) based on ActionScript's\n\t *  pseudo-random number generator and the current time.\n\t *\n\t *  <p>The UID has the form\n\t *  <code>\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"</code>\n\t *  where X is a hexadecimal digit (0-9, A-F).</p>\n\t *\n\t *  <p>This UID will not be truly globally unique; but it is the best\n\t *  we can do without player support for UID generation.</p>\n\t *\n\t *  @return The newly-generated UID.\n\t *\n\t *  @langversion 3.0\n\t *  @playerversion Flash 9\n\t *  @playerversion AIR 1.1\n\t *  @productversion Flex 3\n\t */\n\tpublic static createUID():string\n\t{\n\t\tvar uid = new Array(36);\n\t\tvar index:number = 0;\n\n\t\tvar i:number;\n\t\tvar j:number;\n\n\t\tfor (i = 0; i < 8; i++)\n\t\t\tuid[index++] = IDUtil.ALPHA_CHAR_CODES[Math.floor(Math.random()*16)];\n\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\tuid[index++] = 45; // charCode for \"-\"\n\n\t\t\tfor (j = 0; j < 4; j++)\n\t\t\t\tuid[index++] = IDUtil.ALPHA_CHAR_CODES[Math.floor(Math.random()*16)];\n\t\t}\n\n\t\tuid[index++] = 45; // charCode for \"-\"\n\n\t\tvar time:number = new Date().getTime();\n\t\t// Note: time is the number of milliseconds since 1970,\n\t\t// which is currently more than one trillion.\n\t\t// We use the low 8 hex digits of this number in the UID.\n\t\t// Just in case the system clock has been reset to\n\t\t// Jan 1-4, 1970 (in which case this number could have only\n\t\t// 1-7 hex digits), we pad on the left with 7 zeros\n\t\t// before taking the low digits.\n\t\tvar timeString:string = (\"0000000\" + time.toString(16).toUpperCase()).substr(-8);\n\n\t\tfor (i = 0; i < 8; i++)\n\t\t\tuid[index++] = timeString.charCodeAt(i);\n\n\t\tfor (i = 0; i < 4; i++)\n\t\t\tuid[index++] = IDUtil.ALPHA_CHAR_CODES[Math.floor(Math.random()*16)];\n\n\t\treturn String.fromCharCode.apply(null, uid);\n\t}\n\n\t/**\n\t * Returns the decimal representation of a hex digit.\n\t * @private\n\n\t private static getDigit(hex:string):number\n\t {\n\t\tswitch (hex) {\n\t\t\tcase \"A\":\n\t\t\tcase \"a\":\n\t\t\t\treturn 10;\n\t\t\tcase \"B\":\n\t\t\tcase \"b\":\n\t\t\t\treturn 11;\n\t\t\tcase \"C\":\n\t\t\tcase \"c\":\n\t\t\t\treturn 12;\n\t\t\tcase \"D\":\n\t\t\tcase \"d\":\n\t\t\t\treturn 13;\n\t\t\tcase \"E\":\n\t\t\tcase \"e\":\n\t\t\t\treturn 14;\n\t\t\tcase \"F\":\n\t\t\tcase \"f\":\n\t\t\t\treturn 15;\n\t\t\tdefault:\n\t\t\t\treturn new uint(hex);\n\t\t}\n\t}\n\t */\n\n}\n\nexport = IDUtil;","import ConflictStrategyBase\t\t= require(\"awayjs-core/lib/library/ConflictStrategyBase\");\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\n\nclass IgnoreConflictStrategy extends ConflictStrategyBase\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\tpublic resolveConflict(changedAsset:IAsset, oldAsset:IAsset, assetsDictionary:Object, precedence:string)\n\t{\n\t\t// Do nothing, ignore the fact that there is a conflict.\n\t\treturn;\n\t}\n\n\tpublic create():ConflictStrategyBase\n\t{\n\t\treturn new IgnoreConflictStrategy();\n\t}\n}\n\nexport = IgnoreConflictStrategy;","import IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\nimport AssetEvent\t\t\t\t= require(\"awayjs-core/lib/events/AssetEvent\");\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\n\nclass NamedAssetBase extends EventDispatcher\n{\n\tpublic static ID_COUNT:number = 0;\n\n\tprivate _originalName:string;\n\tprivate _namespace:string;\n\tprivate _name:string;\n\tprivate _id:number;\n\tprivate _full_path:Array<string>;\n\n\tpublic static DEFAULT_NAMESPACE:string = 'default';\n\n\tconstructor(name:string = null)\n\t{\n\t\tsuper();\n\n\t\tthis._id = NamedAssetBase.ID_COUNT++;\n\n\t\tif (name == null)\n\t\t\tname = 'null';\n\n\t\tthis._name = name;\n\t\tthis._originalName = name;\n\n\t\tthis.updateFullPath();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get assetType():string\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * The original name used for this asset in the resource (e.g. file) in which\n\t * it was found. This may not be the same as <code>name</code>, which may\n\t * have changed due to of a name conflict.\n\t */\n\tpublic get originalName():string\n\t{\n\t\treturn this._originalName;\n\t}\n\n\t/**\n\t * A unique id for the asset, used to identify assets in an associative array\n\t */\n\tpublic get id():number\n\t{\n\t\treturn this._id;\n\t}\n\n\tpublic get name():string\n\t{\n\t\treturn this._name;\n\t}\n\n\tpublic set name(val:string)\n\t{\n\t\tvar prev:string;\n\n\t\tprev = this._name;\n\t\tthis._name = val;\n\n\t\tif (this._name == null)\n\t\t\tthis._name = 'null';\n\n\t\tthis.updateFullPath();\n\n\t\t//if (hasEventListener(AssetEvent.ASSET_RENAME))\n\t\tthis.dispatchEvent(new AssetEvent(AssetEvent.ASSET_RENAME, <IAsset> this, prev));\n\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic get assetNamespace():string\n\t{\n\t\treturn this._namespace;\n\t}\n\n\tpublic get assetFullPath():Array<string>\n\t{\n\t\treturn this._full_path;\n\t}\n\n\tpublic assetPathEquals(name:string, ns:string):boolean\n\t{\n\t\treturn (this._name == name && (!ns || this._namespace == ns));\n\t}\n\n\tpublic resetAssetPath(name:string, ns:string = null, overrideOriginal:boolean = true):void\n\t{\n\n\t\tthis._name = name? name : 'null';\n\t\tthis._namespace = ns? ns : NamedAssetBase.DEFAULT_NAMESPACE;\n\n\t\tif (overrideOriginal)\n\t\t\tthis._originalName = this._name;\n\n\t\tthis.updateFullPath();\n\t}\n\n\tprivate updateFullPath():void\n\t{\n\t\tthis._full_path = [ this._namespace, this._name ];\n\t}\n}\n\nexport = NamedAssetBase;","import ConflictStrategyBase\t\t= require(\"awayjs-core/lib/library/ConflictStrategyBase\");\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\n\nclass NumSuffixConflictStrategy extends ConflictStrategyBase\n{\n\tprivate _separator:string;\n\tprivate _next_suffix:Object;\n\n\tconstructor(separator:string = '.')\n\t{\n\t\tsuper();\n\n\t\tthis._separator = separator;\n\t\tthis._next_suffix = {};\n\t}\n\n\tpublic resolveConflict(changedAsset:IAsset, oldAsset:IAsset, assetsDictionary:Object, precedence:string)\n\t{\n\t\tvar orig:string;\n\t\tvar new_name:string;\n\t\tvar base:string;\n\t\tvar suffix:number;\n\n\t\torig = changedAsset.name;\n\n\t\tif (orig.indexOf(this._separator) >= 0) {\n\t\t\t// Name has an ocurrence of the separator, so get base name and suffix,\n\t\t\t// unless suffix is non-numerical, in which case revert to zero and\n\t\t\t// use entire name as base\n\t\t\tbase = orig.substring(0, orig.lastIndexOf(this._separator));\n\t\t\tsuffix = parseInt(orig.substring(base.length - 1));\n\n\t\t\tif (isNaN(suffix)) {\n\t\t\t\tbase = orig;\n\t\t\t\tsuffix = 0;\n\t\t\t}\n\n\t\t} else {\n\t\t\tbase = orig;\n\t\t\tsuffix = 0;\n\t\t}\n\n\t\tif (suffix == 0 && this._next_suffix.hasOwnProperty(base)) {\n\n\t\t\tsuffix = this._next_suffix[base];\n\n\t\t}\n\n\t\t// Find the first suffixed name that does\n\t\t// not collide with other names.\n\t\tdo {\n\n\t\t\tsuffix++;\n\n\t\t\tnew_name = base.concat(this._separator, suffix.toString());\n\n\t\t} while (assetsDictionary.hasOwnProperty(new_name));\n\n\t\tthis._next_suffix[ base ] = suffix;\n\t\tthis._pUpdateNames(oldAsset.assetNamespace, new_name, oldAsset, changedAsset, assetsDictionary, precedence);\n\n\t}\n\n\tpublic create():ConflictStrategyBase\n\t{\n\t\treturn new NumSuffixConflictStrategy(this._separator);\n\t}\n}\n\nexport = NumSuffixConflictStrategy;","class CrossDomainPolicy\n{\n\tpublic static ANONYMOUS:string = 'anonymous';\n\n\tpublic static USE_CREDENTIALS:string = 'use-credentials';\n}\n\nexport = CrossDomainPolicy;\n","class URLLoaderDataFormat\n{\n\t/**\n\t * TEXT\n\t * @type {string}\n\t */\n\tpublic static TEXT:string = \"text\";\n\n\t/**\n\t * Variables / Value Pairs\n\t * @type {string}\n\t */\n\tpublic static VARIABLES:string = \"variables\";\n\n\t/**\n\t *\n\t * @type {string}\n\t */\n\tpublic static BLOB:string = \"blob\";\n\n\t/**\n\t *\n\t * @type {string}\n\t */\n\tpublic static ARRAY_BUFFER:string = \"arraybuffer\";\n\n\t/**\n\t *\n\t * @type {string}\n\t */\n\tpublic static BINARY:string = \"binary\";\n}\n\nexport = URLLoaderDataFormat;","import URLLoaderDataFormat\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\nimport URLRequest\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\nimport URLRequestMethod\t\t\t\t= require(\"awayjs-core/lib/net/URLRequestMethod\");\nimport URLVariables\t\t\t\t\t= require(\"awayjs-core/lib/net/URLVariables\");\nimport AwayEvent\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\nimport HTTPStatusEvent\t\t\t\t= require(\"awayjs-core/lib/events/HTTPStatusEvent\");\nimport IOErrorEvent\t\t\t\t\t= require(\"awayjs-core/lib/events/IOErrorEvent\");\nimport AwayProgressEvent\t\t\t= require(\"awayjs-core/lib/events/ProgressEvent\");\n\n/**\n * The URLLoader is used to load a single file, as part of a resource.\n *\n * While URLLoader can be used directly, e.g. to create a third-party asset\n * management system, it's recommended to use any of the classes Loader3D, AssetLoader\n * and AssetLibrary instead in most cases.\n *\n * @see AssetLoader\n * @see away.library.AssetLibrary\n */\nclass URLLoader extends EventDispatcher\n{\n\tprivate _XHR:XMLHttpRequest;\n\tprivate _bytesLoaded:number = 0;\n\tprivate _bytesTotal:number = 0;\n\tprivate _dataFormat:string = URLLoaderDataFormat.TEXT;\n\tprivate _loadError:boolean = false;\n\n\tprivate _request:URLRequest;\n\tprivate _data:any;\n\n\tprivate _loadStartEvent:AwayEvent;\n\tprivate _loadErrorEvent:IOErrorEvent;\n\tprivate _loadCompleteEvent:AwayEvent;\n\tprivate _progressEvent:AwayProgressEvent;\n\n\t/**\n\t * Creates a new URLLoader object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get url():string\n\t{\n\n\t\treturn this._request? this._request.url : '';\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get data():any\n\t{\n\t\treturn this._data;\n\t}\n\n\n\t/**\n\t *\n\t * URLLoaderDataFormat.BINARY\n\t * URLLoaderDataFormat.TEXT\n\t * URLLoaderDataFormat.VARIABLES\n\t *\n\t * @param format\n\t */\n\tpublic set dataFormat(format:string)\n\t{\n\t\tthis._dataFormat = format;\n\t}\n\n\tpublic get dataFormat():string\n\t{\n\t\treturn this._dataFormat;\n\t}\n\n\t/**\n\t *\n\t * @returns {number}\n\t */\n\tpublic get bytesLoaded():number\n\t{\n\t\treturn this._bytesLoaded;\n\t}\n\n\t/**\n\t *\n\t * @returns {number}\n\t */\n\tpublic get bytesTotal():number\n\t{\n\t\treturn this._bytesTotal;\n\t}\n\n\t/**\n\t * Load a resource from a file.\n\t *\n\t * @param request The URLRequest object containing the URL of the object to be loaded.\n\t */\n\tpublic load(request:URLRequest):void\n\t{\n\t\tthis._request = request;\n\n\t\tthis.initXHR();\n\n\t\tif (request.method === URLRequestMethod.POST)\n\t\t\tthis.postRequest(request);\n\t\telse\n\t\t\tthis.getRequest(request);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic close():void\n\t{\n\t\tthis._XHR.abort();\n\t\tthis.disposeXHR();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic dispose():void\n\t{\n\t\tif (this._XHR)\n\t\t\tthis._XHR.abort();\n\n\t\tthis.disposeXHR();\n\n\t\tthis._data = null;\n\t\tthis._dataFormat = null;\n\t\tthis._bytesLoaded = null;\n\t\tthis._bytesTotal = null;\n\t}\n\n\t/**\n\t *\n\t * @param xhr\n\t * @param responseType\n\t */\n\tprivate setResponseType(xhr:XMLHttpRequest, responseType:string):void\n\t{\n\t\tswitch (responseType) {\n\t\t\tcase URLLoaderDataFormat.ARRAY_BUFFER:\n\t\t\tcase URLLoaderDataFormat.BLOB:\n\t\t\tcase URLLoaderDataFormat.TEXT:\n\t\t\t\txhr.responseType = responseType;\n\t\t\t\tbreak;\n\n\t\t\tcase URLLoaderDataFormat.VARIABLES:\n\t\t\t\txhr.responseType = URLLoaderDataFormat.TEXT;\n\t\t\t\tbreak;\n\n\t\t\tcase URLLoaderDataFormat.BINARY:\n\t\t\t\txhr.responseType = '';\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @param request {URLRequest}\n\t */\n\tprivate getRequest(request:URLRequest):void\n\t{\n\t\ttry {\n\t\t\tthis._XHR.open(request.method, request.url, request.async);\n\t\t\tthis.setResponseType(this._XHR, this._dataFormat);\n\t\t\tthis._XHR.send(); // No data to send\n\t\t} catch (e /* <XMLHttpRequestException> */) {\n\t\t\tthis.handleXmlHttpRequestException(e);\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @param request {URLRequest}\n\t */\n\tprivate postRequest(request:URLRequest):void\n\t{\n\t\tthis._loadError = false;\n\n\t\tthis._XHR.open(request.method, request.url, request.async);\n\n\t\tif (request.data != null) {\n\t\t\tif (request.data instanceof URLVariables) {\n\t\t\t\tvar urlVars:URLVariables = <URLVariables> request.data;\n\n\t\t\t\ttry {\n\t\t\t\t\tthis._XHR.responseType = 'text';\n\t\t\t\t\tthis._XHR.send(urlVars.formData);\n\t\t\t\t} catch (e /* <XMLHttpRequestException> */) {\n\t\t\t\t\tthis.handleXmlHttpRequestException(e);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.setResponseType(this._XHR, this._dataFormat);\n\n\t\t\t\tif (request.data)\n\t\t\t\t\tthis._XHR.send(request.data); // TODO: Test\n\t\t\t\telse\n\t\t\t\t\tthis._XHR.send(); // no data to send\n\t\t\t}\n\t\t} else {\n\t\t\tthis._XHR.send(); // No data to send\n\t\t}\n\n\t}\n\n\t/**\n\t *\n\t * @param error {XMLHttpRequestException}\n\t */\n\tprivate handleXmlHttpRequestException(error:any /* <XMLHttpRequestException> */):void\n\t{\n\t\tswitch (error.code) {\n\n\t\t/******************************************************************************************************************************************************************************************************\n\t\t *\n\t\t *  XMLHttpRequestException { message: \"NETWORK_ERR: XMLHttpRequest Exception 101\", name: \"NETWORK_ERR\", code: 101, stack: \"Error: A network error occurred in synchronous req\",NETWORK_ERR: 101 }\n\t\t *  code: 101 , message: \"NETWORK_ERR: XMLHttpRequest Exception 101\" ,  name: \"NETWORK_ERR\"\n\t\t *\n\t\t ******************************************************************************************************************************************************************************************************/\n\n\t\t\tcase 101:\n\t\t\t\t// Note: onLoadError event throws IO_ERROR event - this case is already Covered\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t *\n\t */\n\tprivate initXHR()\n\t{\n\t\tif (!this._XHR) {\n\t\t\tthis._XHR = new XMLHttpRequest();\n\n\t\t\tthis._XHR.onloadstart = (event:ProgressEvent) => this.onLoadStart(event);                 // loadstart\t        - When the request starts.\n\t\t\tthis._XHR.onprogress = (event:ProgressEvent) => this.onProgress(event);\t                // progress\t            - While loading and sending data.\n\t\t\tthis._XHR.onabort = (event:UIEvent) => this.onAbort(event);\t                        // abort\t            - When the request has been aborted, either by invoking the abort() method or navigating away from the page.\n\t\t\tthis._XHR.onerror = (event:ErrorEvent) => this.onLoadError(event);                     // error\t            - When the request has failed.\n\t\t\tthis._XHR.onload = (event:Event) => this.onLoadComplete(event);                   // load\t                - When the request has successfully completed.\n\t\t\tthis._XHR.ontimeout = (event:Event) => this.onTimeOut(event);                     // timeout\t            - When the author specified timeout has passed before the request could complete.\n\t\t\tthis._XHR.onloadend = (event:ProgressEvent) => this.onLoadEnd(event);                     // loadend\t            - When the request has completed, regardless of whether or not it was successful.\n\t\t\tthis._XHR.onreadystatechange = (event:Event) => this.onReadyStateChange(event);   // onreadystatechange   - When XHR state changes\n\t\t}\n\t}\n\n\t/**\n\t *\n\t */\n\tprivate disposeXHR()\n\t{\n\t\tif (this._XHR !== null) {\n\t\t\tthis._XHR.onloadstart = null;\n\t\t\tthis._XHR.onprogress = null;\n\t\t\tthis._XHR.onabort = null;\n\t\t\tthis._XHR.onerror = null;\n\t\t\tthis._XHR.onload = null;\n\t\t\tthis._XHR.ontimeout = null;\n\t\t\tthis._XHR.onloadend = null;\n\t\t\tthis._XHR = null;\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @param source\n\t */\n\tpublic decodeURLVariables(source:string):Object\n\t{\n\t\tvar result:Object = new Object();\n\n\t\tsource = source.split(\"+\").join(\" \");\n\n\t\tvar tokens, re = /[?&]?([^=]+)=([^&]*)/g;\n\n\t\twhile (tokens = re.exec(source))\n\t\t\tresult[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);\n\n\t\treturn result;\n\t}\n\n\t// XMLHttpRequest - Event Handlers\n\n\t/**\n\t * When XHR state changes\n\t * @param event\n\t */\n\tprivate onReadyStateChange(event:Event)\n\t{\n\t\tif (this._XHR.readyState == 4) {\n\t\t\tif (this._XHR.status == 404) {\n\t\t\t\tthis._loadError = true;\n\n\t\t\t\tif (!this._loadErrorEvent)\n\t\t\t\t\tthis._loadErrorEvent = new IOErrorEvent(IOErrorEvent.IO_ERROR);\n\n\t\t\t\tthis.dispatchEvent(this._loadErrorEvent);\n\t\t\t}\n\n\t\t\tthis.dispatchEvent(new HTTPStatusEvent(HTTPStatusEvent.HTTP_STATUS, this._XHR.status));\n\t\t}\n\t}\n\n\t/**\n\t * When the request has completed, regardless of whether or not it was successful.\n\t * @param event\n\t */\n\tprivate onLoadEnd(event:ProgressEvent)\n\t{\n\t\tif (this._loadError === true)\n\t\t\treturn;\n\t}\n\n\t/**\n\t * When the author specified timeout has passed before the request could complete.\n\t * @param event\n\t */\n\tprivate onTimeOut(event:Event)\n\t{\n\t\t//TODO: Timeout not currently implemented ( also not part of AS3 API )\n\t}\n\n\t/**\n\t * When the request has been aborted, either by invoking the abort() method or navigating away from the page.\n\t * @param event\n\t */\n\tprivate onAbort(event:UIEvent)\n\t{\n\t\t// TODO: investigate whether this needs to be an IOError\n\t}\n\n\t/**\n\t * While loading and sending data.\n\t * @param event\n\t */\n\tprivate onProgress(event:ProgressEvent)\n\t{\n\t\tif (!this._progressEvent)\n\t\t\tthis._progressEvent = new AwayProgressEvent(AwayProgressEvent.PROGRESS);\n\n\t\tthis._progressEvent.bytesTotal = event.total;\n\t\tthis._progressEvent.bytesLoaded = event.loaded;\n\n\t\tthis.dispatchEvent(this._progressEvent);\n\t}\n\n\t/**\n\t * When the request starts.\n\t * @param event\n\t */\n\tprivate onLoadStart(event:ProgressEvent)\n\t{\n\t\tif (!this._loadStartEvent)\n\t\t\tthis._loadStartEvent = new AwayEvent(AwayEvent.OPEN);\n\n\t\tthis.dispatchEvent(this._loadStartEvent);\n\t}\n\n\t/**\n\t * When the request has successfully completed.\n\t * @param event\n\t */\n\tprivate onLoadComplete(event:Event)\n\t{\n\t\tif (this._loadError === true)\n\t\t\treturn;\n\n\t\tswitch (this._dataFormat) {\n\t\t\tcase URLLoaderDataFormat.TEXT:\n\t\t\t\tthis._data = this._XHR.responseText;\n\t\t\t\tbreak;\n\n\t\t\tcase URLLoaderDataFormat.VARIABLES:\n\t\t\t\tthis._data = this.decodeURLVariables(this._XHR.responseText);\n\t\t\t\tbreak;\n\n\t\t\tcase URLLoaderDataFormat.BLOB:\n\t\t\tcase URLLoaderDataFormat.ARRAY_BUFFER:\n\t\t\tcase URLLoaderDataFormat.BINARY:\n\t\t\t\tthis._data = this._XHR.response;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthis._data = this._XHR.responseText;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (!this._loadCompleteEvent)\n\t\t\tthis._loadCompleteEvent = new AwayEvent(AwayEvent.COMPLETE);\n\n\t\tthis.dispatchEvent(this._loadCompleteEvent);\n\t}\n\n\t/**\n\t * When the request has failed. ( due to network issues ).\n\t * @param event\n\t */\n\tprivate onLoadError(event:Event)\n\t{\n\t\tthis._loadError = true;\n\n\t\tif (!this._loadErrorEvent)\n\t\t\tthis._loadErrorEvent = new IOErrorEvent(IOErrorEvent.IO_ERROR);\n\n\t\tthis.dispatchEvent(this._loadErrorEvent);\n\t}\n}\n\nexport = URLLoader;","class URLRequestMethod\n{\n\t/**\n\t *\n\t * @type {string}\n\t */\n\tpublic static POST:string = 'POST';\n\t/**\n\t *\n\t * @type {string}\n\t */\n\tpublic static GET:string = 'GET';\n}\n\nexport = URLRequestMethod;","import URLRequestMethod\t\t\t\t= require(\"awayjs-core/lib/net/URLRequestMethod\");\n\nclass URLRequest\n{\n\t/*\n\t * The MIME content type of the content in the the data property.\n\t * @type {string}\n\t */\n\t//public contentType      : string = 'application/x-www-form-urlencoded'; //Note: Not used for now.\n\n\t/**\n\t * Object containing data to be transmited with URL Request ( URL Variables / binary / string )\n\t *\n\t */\n\tpublic data:any;\n\n\t/**\n\t *\n\t * away.net.URLRequestMethod.GET\n\t * away.net.URLRequestMethod.POST\n\t *\n\t * @type {string}\n\t */\n\tpublic method:string = URLRequestMethod.GET;\n\n\t/**\n\t * Use asynchronous XMLHttpRequest\n\t * @type {boolean}\n\t */\n\tpublic async:boolean = true;\n\n\t/**\n\t *\n\t */\n\tprivate _url:string;\n\n\t/**\n\n\t * @param url\n\t */\n\tconstructor(url:string = null)\n\t{\n\t\tthis._url = url;\n\t}\n\n\t/**\n\t *\n\t * @returns {string}\n\t */\n\tpublic get url():string\n\t{\n\t\treturn this._url;\n\t}\n\n\t/**\n\t *\n\t * @param value\n\t */\n\tpublic set url(value:string)\n\t{\n\t\tthis._url = value;\n\t}\n\n\t/**\n\t * dispose\n\t */\n\tpublic dispose():void\n\t{\n\t\tthis.data = null;\n\t\tthis._url = null;\n\t}\n}\n\nexport = URLRequest;","class URLVariables\n{\n\tprivate _variables:Object = new Object();\n\n\t/**\n\t *\n\t * @param source\n\t */\n\tconstructor(source:string = null)\n\t{\n\t\tif (source !== null)\n\t\t\tthis.decode(source);\n\t}\n\n\t/**\n\t *\n\t * @param source\n\t */\n\tpublic decode(source:string):void\n\t{\n\t\tsource = source.split(\"+\").join(\" \");\n\n\t\tvar tokens, re = /[?&]?([^=]+)=([^&]*)/g;\n\n\t\twhile (tokens = re.exec(source))\n\t\t\tthis._variables[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);\n\t}\n\n\t/**\n\t *\n\t * @returns {string}\n\t */\n\tpublic toString():string\n\t{\n\t\treturn '';\n\t}\n\n\t/**\n\t *\n\t * @returns {Object}\n\t */\n\tpublic get variables():Object\n\t{\n\t\treturn this._variables;\n\t}\n\n\t/**\n\t *\n\t * @returns {Object}\n\t */\n\tpublic get formData():FormData\n\t{\n\t\tvar fd:FormData = new FormData();\n\n\t\tfor (var s in this._variables)\n\t\t\tfd.append(s, this._variables[s]);\n\n\t\treturn fd;\n\t}\n\n\t/**\n\t *\n\t * @returns {Object}\n\t */\n\tpublic set variables(obj:Object)\n\t{\n\t\tthis._variables = obj;\n\t}\n}\n\nexport = URLVariables;","import IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport URLLoaderDataFormat\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\nimport URLRequest\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\nimport ParserBase\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\nimport ResourceDependency\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\nimport ImageCubeTexture\t\t\t= require(\"awayjs-core/lib/textures/ImageCubeTexture\");\nimport ImageTexture\t\t\t\t= require(\"awayjs-core/lib/textures/ImageTexture\");\n\n/**\n * CubeTextureParser provides a \"parser\" for natively supported image types (jpg, png). While it simply loads bytes into\n * a loader object, it wraps it in a BitmapDataResource so resource management can happen consistently without\n * exception cases.\n */\nclass CubeTextureParser extends ParserBase\n{\n\tprivate static posX:string = 'posX';\n\tprivate static negX:string = 'negX';\n\tprivate static posY:string = 'posY';\n\tprivate static negY:string = 'negY';\n\tprivate static posZ:string = 'posZ';\n\tprivate static negZ:string = 'negZ';\n\n\tprivate _imgDependencyDictionary:Object;\n\n\t/**\n\t * Creates a new CubeTextureParser object.\n\t * @param uri The url or id of the data or file to be parsed.\n\t * @param extra The holder for extra contextual data that the parser might need.\n\t */\n\tconstructor()\n\t{\n\t\tsuper(URLLoaderDataFormat.TEXT);\n\t}\n\n\t/**\n\t * Indicates whether or not a given file extension is supported by the parser.\n\t * @param extension The file extension of a potential file to be parsed.\n\t * @return Whether or not the given file type is supported.\n\t */\n\n\tpublic static supportsType(extension:string):boolean\n\t{\n\t\textension = extension.toLowerCase();\n\t\treturn extension == \"cube\";\n\t}\n\n\t/**\n\t * Tests whether a data block can be parsed by the parser.\n\t * @param data The data block to potentially be parsed.\n\t * @return Whether or not the given data is supported.\n\t */\n\tpublic static supportsData(data:any):boolean\n\t{\n\t\ttry {\n\t\t\tvar obj = JSON.parse(data);\n\n\t\t\tif (obj) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t} catch (e) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency)\n\t{\n\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency)\n\t{\n\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pProceedParsing():boolean\n\t{\n\t\tif (this._imgDependencyDictionary != null) { //all images loaded\n\t\t\tvar asset:ImageCubeTexture = new ImageCubeTexture(\n\n\t\t\t\tthis._getHTMLImageElement(CubeTextureParser.posX), this._getHTMLImageElement(CubeTextureParser.negX), this._getHTMLImageElement(CubeTextureParser.posY), this._getHTMLImageElement(CubeTextureParser.negY), this._getHTMLImageElement(CubeTextureParser.posZ), this._getHTMLImageElement(CubeTextureParser.negZ));\n\n\t\t\t//clear dictionary\n\t\t\tthis._imgDependencyDictionary = null;\n\n\t\t\tasset.name = this._iFileName;\n\n\t\t\tthis._pFinalizeAsset(<IAsset> asset, this._iFileName);\n\n\t\t\treturn ParserBase.PARSING_DONE;\n\t\t}\n\n\t\ttry {\n\t\t\tvar json:any = JSON.parse(this.data);\n\t\t\tvar data:Array<Object> = <Array<Object>> json.data;\n\t\t\tvar rec:any;\n\n\t\t\tif (data.length != 6)\n\t\t\t\tthis._pDieWithError('CubeTextureParser: Error - cube texture should have exactly 6 images');\n\n\t\t\tif (json) {\n\t\t\t\tthis._imgDependencyDictionary = new Object();\n\n\t\t\t\tfor (var c:number = 0; c < data.length; c++) {\n\t\t\t\t\trec = data[c];\n\t\t\t\t\tthis._imgDependencyDictionary[rec.id] = this._pAddDependency(rec.id, new URLRequest(rec.image.toString()));\n\t\t\t\t}\n\n\t\t\t\tif (!this._validateCubeData()) {\n\n\t\t\t\t\tthis._pDieWithError(\"CubeTextureParser: JSON data error - cubes require id of:   \\n\" + CubeTextureParser.posX + ', ' + CubeTextureParser.negX + ',  \\n' + CubeTextureParser.posY + ', ' + CubeTextureParser.negY + ',  \\n' + CubeTextureParser.posZ + ', ' + CubeTextureParser.negZ);\n\n\t\t\t\t\treturn ParserBase.PARSING_DONE;\n\n\t\t\t\t}\n\n\t\t\t\tthis._pPauseAndRetrieveDependencies();\n\n\t\t\t\treturn ParserBase.MORE_TO_PARSE;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tthis._pDieWithError('CubeTexturePaser Error parsing JSON');\n\t\t}\n\n\t\treturn ParserBase.PARSING_DONE;\n\n\t}\n\n\tprivate _validateCubeData():boolean\n\t{\n\t\treturn  ( this._imgDependencyDictionary[ CubeTextureParser.posX ] != null && this._imgDependencyDictionary[ CubeTextureParser.negX ] != null && this._imgDependencyDictionary[ CubeTextureParser.posY ] != null && this._imgDependencyDictionary[ CubeTextureParser.negY ] != null && this._imgDependencyDictionary[ CubeTextureParser.posZ ] != null && this._imgDependencyDictionary[ CubeTextureParser.negZ ] != null );\n\t}\n\n\tprivate _getHTMLImageElement(name:string):HTMLImageElement\n\t{\n\t\tvar dependency:ResourceDependency = <ResourceDependency> this._imgDependencyDictionary[ name ];\n\n\t\tif (dependency) {\n\t\t\treturn <HTMLImageElement> (<ImageTexture> dependency.assets[0]).htmlImageElement;\n\t\t}\n\n\t\treturn null;\n\t}\n\n}\n\nexport = CubeTextureParser;","import BitmapData\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport URLRequest\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\nimport AssetEvent\t\t\t\t= require(\"awayjs-core/lib/events/AssetEvent\");\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\nimport ParserEvent\t\t\t\t= require(\"awayjs-core/lib/events/ParserEvent\");\nimport TimerEvent\t\t\t\t= require(\"awayjs-core/lib/events/TimerEvent\");\nimport ParserUtils\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\nimport ResourceDependency\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\nimport TextureUtils\t\t\t\t= require(\"awayjs-core/lib/utils/TextureUtils\");\nimport Timer\t\t\t\t\t= require(\"awayjs-core/lib/utils/Timer\");\nimport getTimer\t\t\t\t\t= require(\"awayjs-core/lib/utils/getTimer\");\n\n/**\n * <code>ParserBase</code> provides an abstract base class for objects that convert blocks of data to data structures\n * supported by away.\n *\n * If used by <code>AssetLoader</code> to automatically determine the parser type, two public static methods should\n * be implemented, with the following signatures:\n *\n * <code>public static supportsType(extension : string) : boolean</code>\n * Indicates whether or not a given file extension is supported by the parser.\n *\n * <code>public static supportsData(data : *) : boolean</code>\n * Tests whether a data block can be parsed by the parser.\n *\n * Furthermore, for any concrete subtype, the method <code>initHandle</code> should be overridden to immediately\n * create the object that will contain the parsed data. This allows <code>ResourceManager</code> to return an object\n * handle regardless of whether the object was loaded or not.\n *\n * @see AssetLoader\n */\nclass ParserBase extends EventDispatcher\n{\n\tpublic _iFileName:string;\n\tprivate _dataFormat:string;\n\tprivate _data:any;\n\tprivate _frameLimit:number;\n\tprivate _lastFrameTime:number;\n\tprivate _pOnIntervalDelegate:(event:TimerEvent) => void;\n\tpublic _pContent:IAsset;\n\n\t//----------------------------------------------------------------------------------------------------------------------------------------------------------------\n\t// TODO: add error checking for the following ( could cause a problem if this function is not implemented )\n\t//----------------------------------------------------------------------------------------------------------------------------------------------------------------\n\t// Needs to be implemented in all Parsers (\n\t//<code>public static supportsType(extension : string) : boolean</code>\n\t//* Indicates whether or not a given file extension is supported by the parser.\n\t//----------------------------------------------------------------------------------------------------------------------------------------------------------------\n\n\tpublic static supportsType(extension:string):boolean\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/* TODO: Implement ParserUtils;\n\t public _pGetTextData():string\n\t {\n\t return ParserUtils.toString(_data);\n\t }\n\n\t public _pGetByteData():ByteArray\n\t {\n\t return ParserUtils.toByteArray(_data);\n\t }\n\t */\n\tprivate _dependencies:Array<ResourceDependency>;\n\tprivate _parsingPaused:boolean;\n\tprivate _parsingComplete:boolean;\n\tprivate _parsingFailure:boolean;\n\tprivate _timer:Timer;\n\tprivate _materialMode:number;\n\n\t/**\n\t * Returned by <code>proceedParsing</code> to indicate no more parsing is needed.\n\t */\n\tpublic static PARSING_DONE:boolean = true;\n\t/* Protected */\n\n\t/**\n\t * Returned by <code>proceedParsing</code> to indicate more parsing is needed, allowing asynchronous parsing.\n\t */\n\tpublic static MORE_TO_PARSE:boolean = false;\n\t/* Protected */\n\n\n\tpublic get content():IAsset\n\t{\n\t\treturn this._pContent;\n\t}\n\n\t/**\n\t * Creates a new ParserBase object\n\t * @param format The data format of the file data to be parsed. Can be either <code>ParserDataFormat.BINARY</code> or <code>ParserDataFormat.PLAIN_TEXT</code>, and should be provided by the concrete subtype.\n\t *\n\t * @see away.loading.parsers.ParserDataFormat\n\t */\n\tconstructor(format:string)\n\t{\n\t\tsuper();\n\n\t\tthis._materialMode = 0;\n\t\tthis._dataFormat = format;\n\t\tthis._dependencies = new Array<ResourceDependency>();\n\n\t\tthis._pOnIntervalDelegate = (event:TimerEvent) => this._pOnInterval(event);\n\t}\n\n\t/**\n\t * Validates a bitmapData loaded before assigning to a default BitmapMaterial\n\t */\n\n\tpublic isBitmapDataValid(bitmapData:BitmapData):boolean\n\t{\n\t\tvar isValid:boolean = TextureUtils.isBitmapDataValid(bitmapData);\n\n\t\tif (!isValid) {\n\n\t\t\tconsole.log(\">> Bitmap loaded is not having power of 2 dimensions or is higher than 2048\");\n\t\t}\n\n\t\treturn isValid;\n\t}\n\n\tpublic set parsingFailure(b:boolean)\n\t{\n\t\tthis._parsingFailure = b;\n\t}\n\n\tpublic get parsingFailure():boolean\n\t{\n\t\treturn this._parsingFailure;\n\t}\n\n\tpublic get parsingPaused():boolean\n\t{\n\t\treturn this._parsingPaused;\n\t}\n\n\tpublic get parsingComplete():boolean\n\t{\n\t\treturn this._parsingComplete;\n\t}\n\n\tpublic set materialMode(newMaterialMode:number)\n\t{\n\t\tthis._materialMode = newMaterialMode;\n\t}\n\n\tpublic get materialMode():number\n\t{\n\t\treturn this._materialMode;\n\t}\n\n\tpublic get data():any\n\t{\n\t\treturn this._data;\n\t}\n\n\t/**\n\t * The data format of the file data to be parsed. Options are <code>URLLoaderDataFormat.BINARY</code>, <code>URLLoaderDataFormat.ARRAY_BUFFER</code>, <code>URLLoaderDataFormat.BLOB</code>, <code>URLLoaderDataFormat.VARIABLES</code> or <code>URLLoaderDataFormat.TEXT</code>.\n\t */\n\tpublic get dataFormat():string\n\t{\n\t\treturn this._dataFormat;\n\t}\n\n\t/**\n\t * Parse data (possibly containing bytearry, plain text or BitmapAsset) asynchronously, meaning that\n\t * the parser will periodically stop parsing so that the AVM may proceed to the\n\t * next frame.\n\t *\n\t * @param data The untyped data object in which the loaded data resides.\n\t * @param frameLimit number of milliseconds of parsing allowed per frame. The\n\t * actual time spent on a frame can exceed this number since time-checks can\n\t * only be performed between logical sections of the parsing procedure.\n\t */\n\tpublic parseAsync(data:any, frameLimit:number = 30)\n\t{\n\t\tthis._data = data;\n\t\tthis._pStartParsing(frameLimit);\n\t}\n\n\t/**\n\t * A list of dependencies that need to be loaded and resolved for the object being parsed.\n\t */\n\tpublic get dependencies():Array<ResourceDependency>\n\t{\n\t\treturn this._dependencies;\n\t}\n\n\t/**\n\t * Resolve a dependency when it's loaded. For example, a dependency containing an ImageResource would be assigned\n\t * to a Mesh instance as a BitmapMaterial, a scene graph object would be added to its intended parent. The\n\t * dependency should be a member of the dependencies property.\n\t *\n\t * @param resourceDependency The dependency to be resolved.\n\t */\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * Resolve a dependency loading failure. Used by parser to eventually provide a default map\n\t *\n\t * @param resourceDependency The dependency to be resolved.\n\t */\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * Resolve a dependency name\n\t *\n\t * @param resourceDependency The dependency to be resolved.\n\t */\n\tpublic _iResolveDependencyName(resourceDependency:ResourceDependency, asset:IAsset):string\n\t{\n\t\treturn asset.name;\n\t}\n\n\tpublic _iResumeParsingAfterDependencies()\n\t{\n\t\tthis._parsingPaused = false;\n\n\t\tif (this._timer)\n\t\t\tthis._timer.start();\n\t}\n\n\tpublic _pFinalizeAsset(asset:IAsset, name:string = null)\n\t{\n\t\tvar type_event:string;\n\t\tvar type_name:string;\n\n\t\tif (name != null)\n\t\t\tasset.name = name;\n\n\t\t// If the asset has no name, give it\n\t\t// a per-type default name.\n\t\tif (!asset.name)\n\t\t\tasset.name = asset.assetType;\n\n\t\tthis.dispatchEvent(new AssetEvent(AssetEvent.ASSET_COMPLETE, asset));\n\t}\n\n\t/**\n\t * Parse the next block of data.\n\t * @return Whether or not more data needs to be parsed. Can be <code>ParserBase.ParserBase.PARSING_DONE</code> or\n\t * <code>ParserBase.ParserBase.MORE_TO_PARSE</code>.\n\t */\n\tpublic _pProceedParsing():boolean\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic _pDieWithError(message:string = 'Unknown parsing error')\n\t{\n\t\tif (this._timer) {\n\t\t\tthis._timer.removeEventListener(TimerEvent.TIMER, this._pOnIntervalDelegate);\n\t\t\tthis._timer.stop();\n\t\t\tthis._timer = null;\n\t\t}\n\n\t\tthis.dispatchEvent(new ParserEvent(ParserEvent.PARSE_ERROR, message));\n\t}\n\n\tpublic _pAddDependency(id:string, req:URLRequest, retrieveAsRawData:boolean = false, data:any = null, suppressErrorEvents:boolean = false):ResourceDependency\n\t{\n\t\tvar dependency:ResourceDependency = new ResourceDependency(id, req, data, null, this, retrieveAsRawData, suppressErrorEvents);\n\t\tthis._dependencies.push(dependency);\n\n\t\treturn dependency;\n\t}\n\n\tpublic _pPauseAndRetrieveDependencies()\n\t{\n\t\tif (this._timer)\n\t\t\tthis._timer.stop();\n\n\t\tthis._parsingPaused = true;\n\t\tthis.dispatchEvent(new ParserEvent(ParserEvent.READY_FOR_DEPENDENCIES));\n\t}\n\n\t/**\n\t * Tests whether or not there is still time left for parsing within the maximum allowed time frame per session.\n\t * @return True if there is still time left, false if the maximum allotted time was exceeded and parsing should be interrupted.\n\t */\n\tpublic _pHasTime():boolean\n\t{\n\t\treturn ((getTimer() - this._lastFrameTime) < this._frameLimit);\n\t}\n\n\t/**\n\t * Called when the parsing pause interval has passed and parsing can proceed.\n\t */\n\tpublic _pOnInterval(event:TimerEvent = null)\n\t{\n\t\tthis._lastFrameTime = getTimer();\n\n\t\tif (this._pProceedParsing() && !this._parsingFailure)\n\t\t\tthis._pFinishParsing();\n\t}\n\n\t/**\n\t * Initializes the parsing of data.\n\t * @param frameLimit The maximum duration of a parsing session.\n\t */\n\tpublic _pStartParsing(frameLimit:number)\n\t{\n\t\tthis._frameLimit = frameLimit;\n\t\tthis._timer = new Timer(this._frameLimit, 0);\n\t\tthis._timer.addEventListener(TimerEvent.TIMER, this._pOnIntervalDelegate);\n\t\tthis._timer.start();\n\t}\n\n\t/**\n\t * Finish parsing the data.\n\t */\n\tpublic _pFinishParsing()\n\t{\n\t\tif (this._timer) {\n\t\t\tthis._timer.removeEventListener(TimerEvent.TIMER, this._pOnIntervalDelegate);\n\t\t\tthis._timer.stop();\n\t\t}\n\n\t\tthis._timer = null;\n\t\tthis._parsingComplete = true;\n\n\t\tthis.dispatchEvent(new ParserEvent(ParserEvent.PARSE_COMPLETE));\n\t}\n\n\t/**\n\t *\n\t * @returns {string}\n\t * @private\n\t */\n\tpublic _pGetTextData():string\n\t{\n\t\treturn ParserUtils.toString(this._data);\n\t}\n\n\t/**\n\t *\n\t * @returns {string}\n\t * @private\n\t */\n\tpublic _pGetByteData():ByteArray\n\t{\n\t\treturn ParserUtils.toByteArray(this._data);\n\t}\n}\n\nexport = ParserBase;","/**\n * An enumeration providing values to describe the data format of parsed data.\n */\nclass ParserDataFormat\n{\n\t/**\n\t * Describes the format of a binary file.\n\t */\n\tpublic static BINARY:string = \"binary\";\n\n\t/**\n\t * Describes the format of a plain text file.\n\t */\n\tpublic static PLAIN_TEXT:string = \"plainText\";\n\n\t/**\n\t * Describes the format of an image file\n\t */\n\tpublic static IMAGE:string = \"image\";\n\n}\n\nexport = ParserDataFormat;","import ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nclass ParserUtils\n{\n\n\t/**\n\t * Converts an ArrayBuffer to a base64 string\n\t *\n\t * @param image data as a ByteArray\n\t *\n\t * @return HTMLImageElement\n\t *\n\t */\n\tpublic static arrayBufferToImage(data:ArrayBuffer):HTMLImageElement\n\t{\n\t\tvar byteStr:string = '';\n\t\tvar bytes:Uint8Array = new Uint8Array(data);\n\t\tvar len:number = bytes.byteLength;\n\n\t\tfor (var i = 0; i < len; i++)\n\t\t\tbyteStr += String.fromCharCode(bytes[ i ])\n\n\t\tvar base64Image:string = window.btoa(byteStr);\n\t\tvar str:string = 'data:image/png;base64,' + base64Image;\n\t\tvar img:HTMLImageElement = <HTMLImageElement> new Image();\n\t\timg.src = str;\n\n\t\treturn img;\n\t}\n\n\t/**\n\t * Converts an ByteArray to an Image - returns an HTMLImageElement\n\t *\n\t * @param image data as a ByteArray\n\t *\n\t * @return HTMLImageElement\n\t *\n\t */\n\tpublic static byteArrayToImage(data:ByteArray):HTMLImageElement\n\t{\n\t\tvar byteStr:string = '';\n\t\tvar bytes:Uint8Array = new Uint8Array(data.arraybytes);\n\t\tvar len:number = bytes.byteLength;\n\n\t\tfor (var i = 0; i < len; i++)\n\t\t\tbyteStr += String.fromCharCode(bytes[ i ])\n\n\t\tvar base64Image:string = window.btoa(byteStr);\n\t\tvar str:string = 'data:image/png;base64,' + base64Image;\n\t\tvar img:HTMLImageElement = <HTMLImageElement> new Image();\n\t\timg.src = str;\n\n\t\treturn img;\n\t}\n\n\t/**\n\t * Converts an Blob to an Image - returns an HTMLImageElement\n\t *\n\t * @param image data as a Blob\n\t *\n\t * @return HTMLImageElement\n\t *\n\t */\n\tpublic static blobToImage(data:Blob):HTMLImageElement\n\t{\n\t\tvar URLObj:URL = window['URL'] || window['webkitURL'];\n\t\tvar src = URLObj.createObjectURL(data);\n\t\tvar img:HTMLImageElement = <HTMLImageElement> new Image();\n\t\timg.src = src;\n\n\t\treturn img;\n\t}\n\n\t/**\n\t * Returns a object as ByteArray, if possible.\n\t *\n\t * @param data The object to return as ByteArray\n\t *\n\t * @return The ByteArray or null\n\t *\n\t */\n\tpublic static toByteArray(data:any):ByteArray\n\t{\n\t\tvar b:ByteArray = new ByteArray();\n\t\tb.setArrayBuffer(data);\n\t\treturn b;\n\t}\n\n\t/**\n\t * Returns a object as String, if possible.\n\t *\n\t * @param data The object to return as String\n\t * @param length The length of the returned String\n\t *\n\t * @return The String or null\n\t *\n\t */\n\tpublic static toString(data:any, length:number = 0):string\n\t{\n\n\t\tif (typeof data === 'string') {\n\t\t\tvar s:string = <string> data;\n\n\t\t\tif (s['substr'] != null)\n\t\t\t\treturn s.substr(0, s.length);\n\t\t}\n\n\t\tif (data instanceof ByteArray) {\n\t\t\tvar ba:ByteArray = <ByteArray> data;\n\t\t\tba.position = 0;\n\t\t\treturn ba.readUTFBytes(Math.min(ba.getBytesAvailable(), length));\n\t\t}\n\n\t\treturn null;\n\n\t\t/*\n\t\t var ba:ByteArray;\n\n\t\t length ||= uint.MAX_VALUE;\n\n\t\t if (data is String)\n\t\t return String(data).substr(0, length);\n\n\t\t ba = toByteArray(data);\n\t\t if (ba) {\n\t\t ba.position = 0;\n\t\t return ba.readUTFBytes(Math.min(ba.bytesAvailable, length));\n\t\t }\n\n\t\t return null;\n\n\t\t */\n\n\t}\n}\n\nexport = ParserUtils;","import IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport URLLoader\t\t\t\t= require(\"awayjs-core/lib/net/URLLoader\");\nimport URLRequest\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\nimport ParserBase\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\n\n/**\n * ResourceDependency represents the data required to load, parse and resolve additional files (\"dependencies\")\n * required by a parser, used by ResourceLoadSession.\n *\n */\nclass ResourceDependency\n{\n\tprivate _id:string;\n\tprivate _request:URLRequest;\n\tprivate _assets:Array<IAsset>;\n\tprivate _parser:ParserBase;\n\tprivate _parentParser:ParserBase;\n\tprivate _data:any;\n\tprivate _retrieveAsRawData:boolean;\n\tprivate _suppressAssetEvents:boolean;\n\tprivate _dependencies:Array<ResourceDependency>;\n\n\tpublic _iLoader:URLLoader;\n\tpublic _iSuccess:boolean;\n\n\n\tconstructor(id:string, request:URLRequest, data:any, parser:ParserBase, parentParser:ParserBase, retrieveAsRawData:boolean = false, suppressAssetEvents:boolean = false)\n\t{\n\t\tthis._id = id;\n\t\tthis._request = request;\n\t\tthis._data = data;\n\t\tthis._parser = parser;\n\t\tthis._parentParser = parentParser;\n\t\tthis._retrieveAsRawData = retrieveAsRawData;\n\t\tthis._suppressAssetEvents = suppressAssetEvents;\n\n\t\tthis._assets = new Array<IAsset>();\n\t\tthis._dependencies = new Array<ResourceDependency>();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get id():string\n\t{\n\t\treturn this._id;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get request():URLRequest\n\t{\n\t\treturn this._request;\n\t}\n\n\t/**\n\t * The data containing the dependency to be parsed, if the resource was already loaded.\n\t */\n\tpublic get data():any\n\t{\n\t\treturn this._data;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get parser():ParserBase\n\t{\n\t\treturn this._parser;\n\t}\n\n\t/**\n\t * The parser which is dependent on this ResourceDependency object.\n\t */\n\tpublic get parentParser():ParserBase\n\t{\n\t\treturn this._parentParser;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get retrieveAsRawData():boolean\n\t{\n\t\treturn this._retrieveAsRawData;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get suppresAssetEvents():boolean\n\t{\n\t\treturn this._suppressAssetEvents;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get assets():Array<IAsset>\n\t{\n\t\treturn this._assets;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get dependencies():Array<ResourceDependency>\n\t{\n\t\treturn this._dependencies;\n\t}\n\n\t/**\n\t * @private\n\t * Method to set data after having already created the dependency object, e.g. after load.\n\t */\n\tpublic _iSetData(data:any):void\n\t{\n\t\tthis._data = data;\n\t}\n\n\t/**\n\t * @private\n\t *\n\t */\n\tpublic _iSetParser(parser:ParserBase):void\n\t{\n\t\tthis._parser = parser;\n\t}\n\n\t/**\n\t * Resolve the dependency when it's loaded with the parent parser. For example, a dependency containing an\n\t * ImageResource would be assigned to a Mesh instance as a BitmapMaterial, a scene graph object would be added\n\t * to its intended parent. The dependency should be a member of the dependencies property.\n\t */\n\tpublic resolve():void\n\t{\n\t\tif (this._parentParser)\n\t\t\tthis._parentParser._iResolveDependency(this);\n\t}\n\n\t/**\n\t * Resolve a dependency failure. For example, map loading failure from a 3d file\n\t */\n\tpublic resolveFailure():void\n\t{\n\t\tif (this._parentParser)\n\t\t\tthis._parentParser._iResolveDependencyFailure(this);\n\t}\n\n\t/**\n\t * Resolve the dependencies name\n\t */\n\tpublic resolveName(asset:IAsset):string\n\t{\n\t\tif (this._parentParser)\n\t\t\treturn this._parentParser._iResolveDependencyName(this, asset);\n\n\t\treturn asset.name;\n\t}\n}\n\nexport = ResourceDependency;","import IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport URLLoaderDataFormat\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\nimport ParserBase\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\nimport ParserUtils\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\nimport TextureUtils\t\t\t\t= require(\"awayjs-core/lib/utils/TextureUtils\");\nimport ImageTexture\t\t\t\t= require(\"awayjs-core/lib/textures/ImageTexture\");\nimport Texture2DBase\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\n/**\n * Texture2DParser provides a \"parser\" for natively supported image types (jpg, png). While it simply loads bytes into\n * a loader object, it wraps it in a BitmapDataResource so resource management can happen consistently without\n * exception cases.\n */\nclass Texture2DParser extends ParserBase\n{\n\tprivate _startedParsing:boolean;\n\tprivate _doneParsing:boolean;\n\tprivate _loadingImage:boolean;\n\tprivate _htmlImageElement:HTMLImageElement;\n\n\t/**\n\t * Creates a new Texture2DParser object.\n\t * @param uri The url or id of the data or file to be parsed.\n\t * @param extra The holder for extra contextual data that the parser might need.\n\t */\n\tconstructor()\n\t{\n\t\tsuper(URLLoaderDataFormat.BLOB);\n\t}\n\n\t/**\n\t * Indicates whether or not a given file extension is supported by the parser.\n\t * @param extension The file extension of a potential file to be parsed.\n\t * @return Whether or not the given file type is supported.\n\t */\n\tpublic static supportsType(extension:string):boolean\n\t{\n\n\t\textension = extension.toLowerCase();\n\t\treturn extension == \"jpg\" || extension == \"jpeg\" || extension == \"png\" || extension == \"gif\";//|| extension == \"bmp\";//|| extension == \"atf\";\n\n\t}\n\n\t/**\n\t * Tests whether a data block can be parsed by the parser.\n\t * @param data The data block to potentially be parsed.\n\t * @return Whether or not the given data is supported.\n\t */\n\tpublic static supportsData(data:any):boolean\n\t{\n\n\t\tif (data  instanceof HTMLImageElement)\n\t\t\treturn true;\n\n\t\tif (!(data instanceof ByteArray))\n\t\t\treturn false;\n\n\t\tvar ba:ByteArray = <ByteArray> data;\n\t\tba.position = 0;\n\n\t\tif (ba.readUnsignedShort() == 0xffd8)\n\t\t\treturn true; // JPEG, maybe check for \"JFIF\" as well?\n\n\t\tba.position = 0;\n\t\tif (ba.readShort() == 0x424D)\n\t\t\treturn true; // BMP\n\n\t\tba.position = 1;\n\t\tif (ba.readUTFBytes(3) == 'PNG')\n\t\t\treturn true;\n\n\t\tba.position = 0;\n\t\tif (ba.readUTFBytes(3) == 'GIF' && ba.readShort() == 0x3839 && ba.readByte() == 0x61)\n\t\t\treturn true;\n\n\t\tba.position = 0;\n\t\tif (ba.readUTFBytes(3) == 'ATF')\n\t\t\treturn true;\n\n\t\treturn false;\n\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pProceedParsing():boolean\n\t{\n\n\t\tvar asset:Texture2DBase;\n\t\tvar sizeError:boolean = false;\n\n\t\tif (this._loadingImage) {\n\t\t\treturn ParserBase.MORE_TO_PARSE;\n\t\t} else if (this._htmlImageElement) {\n\t\t\tif (TextureUtils.isHTMLImageElementValid(this._htmlImageElement)) {\n\t\t\t\tasset = new ImageTexture(this._htmlImageElement);\n\t\t\t\tthis._pFinalizeAsset(<IAsset> asset, this._iFileName);\n\t\t\t}\n\t\t} else if (this.data instanceof HTMLImageElement) {// Parse HTMLImageElement\n\n\t\t\tif (TextureUtils.isHTMLImageElementValid(<HTMLImageElement> this.data)) {\n\t\t\t\tasset = new ImageTexture(<HTMLImageElement> this.data);\n\t\t\t\tthis._pFinalizeAsset(<IAsset> asset, this._iFileName);\n\t\t\t} else {\n\t\t\t\tsizeError = true;\n\t\t\t}\n\n\t\t} else if (this.data instanceof ByteArray) { // Parse a ByteArray\n\n\t\t\tvar ba:ByteArray = this.data;\n\t\t\tba.position = 0;\n\t\t\tvar htmlImageElement:HTMLImageElement = ParserUtils.byteArrayToImage(this.data);\n\n\t\t\tif (TextureUtils.isHTMLImageElementValid(htmlImageElement)) {\n\t\t\t\tasset = new ImageTexture(htmlImageElement);\n\t\t\t\tthis._pFinalizeAsset(<IAsset> asset, this._iFileName);\n\t\t\t} else {\n\t\t\t\tsizeError = true;\n\t\t\t}\n\n\t\t} else if (this.data instanceof ArrayBuffer) {// Parse an ArrayBuffer\n\n\t\t\tthis._htmlImageElement = ParserUtils.arrayBufferToImage(this.data);\n\n\t\t\tasset = new ImageTexture(this._htmlImageElement);\n\t\t\tthis._pFinalizeAsset(<IAsset> asset, this._iFileName);\n\n\t\t} else if (this.data instanceof Blob) { // Parse a Blob\n\n\t\t\tthis._htmlImageElement = ParserUtils.blobToImage(this.data);\n\n\t\t\tthis._htmlImageElement.onload = (event) => this.onLoadComplete(event);\n\t\t\tthis._loadingImage = true;\n\n\t\t\treturn ParserBase.MORE_TO_PARSE;\n\t\t}\n\n\t\tif (sizeError == true) // Generate new Checkerboard texture material\n\t\t{\n//\t\t\t\tasset = new BitmapTexture(DefaultMaterialManager.createCheckeredBitmapData(), false);\n//\t\t\t\tthis._pFinalizeAsset(<IAsset> asset, this._iFileName);\n//\t\t\t\tthis.dispatchEvent(new away.events.AssetEvent(away.events.AssetEvent.TEXTURE_SIZE_ERROR, <IAsset> asset));\n\t\t}\n\n\t\tthis._pContent = asset;\n\n\t\treturn ParserBase.PARSING_DONE;\n\n\t}\n\n\tpublic onLoadComplete(event)\n\t{\n\t\tthis._loadingImage = false;\n\t}\n}\n\nexport = Texture2DParser;","/**\n * Provides constant values for camera lens projection options use the the <code>coordinateSystem</code> property\n *\n * @see away.projections.PerspectiveLens#coordinateSystem\n */\nclass CoordinateSystem\n{\n\t/**\n\t * Default option, projects to a left-handed coordinate system\n\t */\n\tpublic static LEFT_HANDED:string = \"leftHanded\";\n\n\t/**\n\t * Projects to a right-handed coordinate system\n\t */\n\tpublic static RIGHT_HANDED:string = \"rightHanded\";\n}\n\nexport = CoordinateSystem;","import PerspectiveProjection\t= require(\"awayjs-core/lib/projections/PerspectiveProjection\");\nimport ProjectionBase\t\t\t= require(\"awayjs-core/lib/projections/ProjectionBase\");\n\nclass FreeMatrixProjection extends ProjectionBase\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._pMatrix.copyFrom(new PerspectiveProjection().matrix);\n\t}\n\n\t//@override\n\tpublic set near(value:number)\n\t{\n\t\tthis._pNear = value;\n\t}\n\n\t//@override\n\tpublic set far(value:number)\n\t{\n\t\tthis._pFar = value;\n\t}\n\n\t//@override\n\tpublic set iAspectRatio(value:number)\n\t{\n\t\tthis._pAspectRatio = value;\n\t}\n\n\t//@override\n\tpublic clone():ProjectionBase\n\t{\n\t\tvar clone:FreeMatrixProjection = new FreeMatrixProjection();\n\t\tclone._pMatrix.copyFrom(this._pMatrix);\n\t\tclone._pNear = this._pNear;\n\t\tclone._pFar = this._pFar;\n\t\tclone._pAspectRatio = this._pAspectRatio;\n\t\tclone.pInvalidateMatrix();\n\t\treturn clone;\n\t}\n\n\t//@override\n\tpublic pUpdateMatrix()\n\t{\n\t\tthis._pMatrixInvalid = false;\n\t}\n}\n\nexport = FreeMatrixProjection;","import Matrix3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Plane3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Plane3D\");\nimport Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport ProjectionEvent\t\t\t= require(\"awayjs-core/lib/events/ProjectionEvent\");\nimport IProjection\t\t\t\t= require(\"awayjs-core/lib/projections/IProjection\");\nimport ProjectionBase\t\t\t= require(\"awayjs-core/lib/projections/ProjectionBase\");\n\nclass ObliqueNearPlaneProjection extends ProjectionBase\n{\n\n\tprivate _baseProjection:IProjection;\n\tprivate _plane:Plane3D;\n\tprivate _onProjectionMatrixChangedDelegate:(event:ProjectionEvent) => void;\n\n\tconstructor(baseProjection:IProjection, plane:Plane3D)\n\t{\n\t\tsuper();\n\t\tthis.baseProjection = baseProjection;\n\t\tthis.plane = plane;\n\n\t\tthis._onProjectionMatrixChangedDelegate = (event:ProjectionEvent) => this.onProjectionMatrixChanged(event);\n\t}\n\n\t//@override\n\tpublic get frustumCorners():number[]\n\t{\n\t\treturn this._baseProjection.frustumCorners;\n\t}\n\n\t//@override\n\tpublic get near():number\n\t{\n\t\treturn this._baseProjection.near;\n\t}\n\n\t//@override\n\tpublic set near(value:number)\n\t{\n\t\tthis._baseProjection.near = value;\n\t}\n\n\t//@override\n\tpublic get far():number\n\t{\n\t\treturn this._baseProjection.far;\n\t}\n\n\t//@override\n\tpublic set far(value:number)\n\t{\n\t\tthis._baseProjection.far = value;\n\t}\n\n\t//@override\n\tpublic get iAspectRatio():number\n\t{\n\t\treturn this._baseProjection._iAspectRatio;\n\t}\n\n\t//@override\n\tpublic set iAspectRatio(value:number)\n\t{\n\t\tthis._baseProjection._iAspectRatio = value;\n\t}\n\n\tpublic get plane():Plane3D\n\t{\n\t\treturn this._plane;\n\t}\n\n\tpublic set plane(value:Plane3D)\n\t{\n\t\tthis._plane = value;\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\tpublic set baseProjection(value:IProjection)\n\t{\n\t\tif (this._baseProjection) {\n\t\t\tthis._baseProjection.removeEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);\n\t\t}\n\t\tthis._baseProjection = value;\n\n\t\tif (this._baseProjection) {\n\t\t\tthis._baseProjection.addEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);\n\t\t}\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\tprivate onProjectionMatrixChanged(event:ProjectionEvent)\n\t{\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\t//@override\n\tpublic pUpdateMatrix()\n\t{\n\t\tthis._pMatrix.copyFrom(this._baseProjection.matrix);\n\n\t\tvar cx:number = this._plane.a;\n\t\tvar cy:number = this._plane.b;\n\t\tvar cz:number = this._plane.c;\n\t\tvar cw:number = -this._plane.d + .05;\n\t\tvar signX:number = cx >= 0? 1 : -1;\n\t\tvar signY:number = cy >= 0? 1 : -1;\n\t\tvar p:Vector3D = new Vector3D(signX, signY, 1, 1);\n\t\tvar inverse:Matrix3D = this._pMatrix.clone();\n\t\tinverse.invert();\n\t\tvar q:Vector3D = inverse.transformVector(p);\n\t\tthis._pMatrix.copyRowTo(3, p);\n\t\tvar a:number = (q.x*p.x + q.y*p.y + q.z*p.z + q.w*p.w)/(cx*q.x + cy*q.y + cz*q.z + cw*q.w);\n\t\tthis._pMatrix.copyRowFrom(2, new Vector3D(cx*a, cy*a, cz*a, cw*a));\n\t}\n}\n\nexport = ObliqueNearPlaneProjection;","import Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport ProjectionBase\t\t\t= require(\"awayjs-core/lib/projections/ProjectionBase\");\n\nclass OrthographicOffCenterProjection extends ProjectionBase\n{\n\n\tprivate _minX:number;\n\tprivate _maxX:number;\n\tprivate _minY:number;\n\tprivate _maxY:number;\n\n\tconstructor(minX:number, maxX:number, minY:number, maxY:number)\n\t{\n\t\tsuper();\n\t\tthis._minX = minX;\n\t\tthis._maxX = maxX;\n\t\tthis._minY = minY;\n\t\tthis._maxY = maxY;\n\t}\n\n\tpublic get minX():number\n\t{\n\t\treturn this._minX;\n\t}\n\n\tpublic set minX(value:number)\n\t{\n\t\tthis._minX = value;\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\tpublic get maxX():number\n\t{\n\t\treturn this._maxX;\n\t}\n\n\tpublic set maxX(value:number)\n\t{\n\t\tthis._maxX = value;\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\tpublic get minY():number\n\t{\n\t\treturn this._minY;\n\t}\n\n\tpublic set minY(value:number)\n\t{\n\t\tthis._minY = value;\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\tpublic get maxY():number\n\t{\n\t\treturn this._maxY;\n\t}\n\n\tpublic set maxY(value:number)\n\t{\n\t\tthis._maxY = value;\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\t//@override\n\tpublic unproject(nX:number, nY:number, sZ:number):Vector3D\n\t{\n\t\tvar v:Vector3D = new Vector3D(nX, -nY, sZ, 1.0);\n\t\tv = this.unprojectionMatrix.transformVector(v);\n\t\t//z is unaffected by transform\n\t\tv.z = sZ;\n\n\t\treturn v;\n\t}\n\n\t//@override\n\tpublic clone():ProjectionBase\n\t{\n\t\tvar clone:OrthographicOffCenterProjection = new OrthographicOffCenterProjection(this._minX, this._maxX, this._minY, this._maxY);\n\t\tclone._pNear = this._pNear;\n\t\tclone._pFar = this._pFar;\n\t\tclone._pAspectRatio = this._pAspectRatio;\n\t\treturn clone;\n\t}\n\n\t//@override\n\tpublic pUpdateMatrix()\n\t{\n\t\tvar raw:number[] = [];\n\t\tvar w:number = 1/(this._maxX - this._minX);\n\t\tvar h:number = 1/(this._maxY - this._minY);\n\t\tvar d:number = 1/(this._pFar - this._pNear);\n\n\t\traw[0] = 2*w;\n\t\traw[5] = 2*h;\n\t\traw[10] = d;\n\t\traw[12] = -(this._maxX + this._minX)*w;\n\t\traw[13] = -(this._maxY + this._minY)*h;\n\t\traw[14] = -this._pNear*d;\n\t\traw[15] = 1;\n\t\traw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[8] = raw[9] = raw[11] = 0;\n\t\tthis._pMatrix.copyRawDataFrom(raw);\n\n\t\tthis._pFrustumCorners[0] = this._pFrustumCorners[9] = this._pFrustumCorners[12] = this._pFrustumCorners[21] = this._minX;\n\t\tthis._pFrustumCorners[3] = this._pFrustumCorners[6] = this._pFrustumCorners[15] = this._pFrustumCorners[18] = this._maxX;\n\t\tthis._pFrustumCorners[1] = this._pFrustumCorners[4] = this._pFrustumCorners[13] = this._pFrustumCorners[16] = this._minY;\n\t\tthis._pFrustumCorners[7] = this._pFrustumCorners[10] = this._pFrustumCorners[19] = this._pFrustumCorners[22] = this._maxY;\n\t\tthis._pFrustumCorners[2] = this._pFrustumCorners[5] = this._pFrustumCorners[8] = this._pFrustumCorners[11] = this._pNear;\n\t\tthis._pFrustumCorners[14] = this._pFrustumCorners[17] = this._pFrustumCorners[20] = this._pFrustumCorners[23] = this._pFar;\n\n\t\tthis._pMatrixInvalid = false;\n\t}\n}\n\nexport = OrthographicOffCenterProjection;","import Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport ProjectionBase\t\t\t= require(\"awayjs-core/lib/projections/ProjectionBase\");\n\nclass OrthographicProjection extends ProjectionBase\n{\n\n\tprivate _projectionHeight:number;\n\tprivate _xMax:number;\n\tprivate _yMax:number;\n\n\tconstructor(projectionHeight:number = 500)\n\t{\n\t\tsuper();\n\t\tthis._projectionHeight = projectionHeight;\n\t}\n\n\tpublic get projectionHeight():number\n\t{\n\t\treturn this._projectionHeight;\n\t}\n\n\tpublic set projectionHeight(value:number)\n\t{\n\t\tif (value == this._projectionHeight) {\n\t\t\treturn;\n\t\t}\n\t\tthis._projectionHeight = value;\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\t//@override\n\tpublic unproject(nX:number, nY:number, sZ:number):Vector3D\n\t{\n\t\tvar v:Vector3D = new Vector3D(nX + this.matrix.rawData[12], -nY + this.matrix.rawData[13], sZ, 1.0);\n\t\tv = this.unprojectionMatrix.transformVector(v);\n\n\t\t//z is unaffected by transform\n\t\tv.z = sZ;\n\n\t\treturn v;\n\t}\n\n\t//@override\n\tpublic clone():ProjectionBase\n\t{\n\t\tvar clone:OrthographicProjection = new OrthographicProjection();\n\t\tclone._pNear = this._pNear;\n\t\tclone._pFar = this._pFar;\n\t\tclone._pAspectRatio = this._pAspectRatio;\n\t\tclone.projectionHeight = this._projectionHeight;\n\t\treturn clone;\n\t}\n\n\t//@override\n\tpublic pUpdateMatrix()\n\t{\n\t\tvar raw:number[] = [];\n\t\tthis._yMax = this._projectionHeight*.5;\n\t\tthis._xMax = this._yMax*this._pAspectRatio;\n\n\t\tvar left:number;\n\t\tvar right:number;\n\t\tvar top:number;\n\t\tvar bottom:number;\n\n\t\tif (this._pScissorRect.x == 0 && this._pScissorRect.y == 0 && this._pScissorRect.width == this._pViewPort.width && this._pScissorRect.height == this._pViewPort.height) {\n\t\t\t// assume symmetric frustum\n\n\t\t\tleft = -this._xMax;\n\t\t\tright = this._xMax;\n\t\t\ttop = -this._yMax;\n\t\t\tbottom = this._yMax;\n\n\t\t\traw[0] = 2/(this._projectionHeight*this._pAspectRatio);\n\t\t\traw[5] = 2/this._projectionHeight;\n\t\t\traw[10] = 1/(this._pFar - this._pNear);\n\t\t\traw[14] = this._pNear/(this._pNear - this._pFar);\n\t\t\traw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[8] = raw[9] = raw[11] = raw[12] = raw[13] = 0;\n\t\t\traw[15] = 1;\n\n\t\t} else {\n\n\t\t\tvar xWidth:number = this._xMax*(this._pViewPort.width/this._pScissorRect.width);\n\t\t\tvar yHgt:number = this._yMax*(this._pViewPort.height/this._pScissorRect.height);\n\t\t\tvar center:number = this._xMax*(this._pScissorRect.x*2 - this._pViewPort.width)/this._pScissorRect.width + this._xMax;\n\t\t\tvar middle:number = -this._yMax*(this._pScissorRect.y*2 - this._pViewPort.height)/this._pScissorRect.height - this._yMax;\n\n\t\t\tleft = center - xWidth;\n\t\t\tright = center + xWidth;\n\t\t\ttop = middle - yHgt;\n\t\t\tbottom = middle + yHgt;\n\n\t\t\traw[0] = 2*1/(right - left);\n\t\t\traw[5] = -2*1/(top - bottom);\n\t\t\traw[10] = 1/(this._pFar - this._pNear);\n\n\t\t\traw[12] = (right + left)/(right - left);\n\t\t\traw[13] = (bottom + top)/(bottom - top);\n\t\t\traw[14] = this._pNear/(this.near - this.far);\n\n\t\t\traw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[8] = raw[9] = raw[11] = 0;\n\t\t\traw[15] = 1;\n\t\t}\n\n\t\tthis._pFrustumCorners[0] = this._pFrustumCorners[9] = this._pFrustumCorners[12] = this._pFrustumCorners[21] = left;\n\t\tthis._pFrustumCorners[3] = this._pFrustumCorners[6] = this._pFrustumCorners[15] = this._pFrustumCorners[18] = right;\n\t\tthis._pFrustumCorners[1] = this._pFrustumCorners[4] = this._pFrustumCorners[13] = this._pFrustumCorners[16] = top;\n\t\tthis._pFrustumCorners[7] = this._pFrustumCorners[10] = this._pFrustumCorners[19] = this._pFrustumCorners[22] = bottom;\n\t\tthis._pFrustumCorners[2] = this._pFrustumCorners[5] = this._pFrustumCorners[8] = this._pFrustumCorners[11] = this._pNear;\n\t\tthis._pFrustumCorners[14] = this._pFrustumCorners[17] = this._pFrustumCorners[20] = this._pFrustumCorners[23] = this._pFar;\n\n\t\tthis._pMatrix.copyRawDataFrom(raw);\n\n\t\tthis._pMatrixInvalid = false;\n\t}\n}\n\nexport= OrthographicProjection;","import Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport CoordinateSystem\t\t\t= require(\"awayjs-core/lib/projections/CoordinateSystem\");\nimport ProjectionBase\t\t\t= require(\"awayjs-core/lib/projections/ProjectionBase\");\n\nclass PerspectiveProjection extends ProjectionBase\n{\n\tprivate _fieldOfView:number = 60;\n\tprivate _focalLength:number = 1000;\n\tprivate _hFieldOfView:number = 60;\n\tprivate _hFocalLength:number = 1000;\n\tprivate _preserveAspectRatio:boolean = true;\n\tprivate _preserveFocalLength:boolean = false;\n\n\tconstructor(fieldOfView:number = 60, coordinateSystem:string = \"leftHanded\")\n\t{\n\t\tsuper(coordinateSystem);\n\t\tthis.fieldOfView = fieldOfView;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get preserveAspectRatio():boolean\n\t{\n\t\treturn this._preserveAspectRatio;\n\t}\n\n\tpublic set preserveAspectRatio(value:boolean)\n\t{\n\t\tif (this._preserveAspectRatio == value)\n\t\t\treturn;\n\n\t\tthis._preserveAspectRatio = value;\n\n\t\tif (this._preserveAspectRatio)\n\t\t\tthis.pInvalidateMatrix();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get preserveFocalLength():boolean\n\t{\n\t\treturn this._preserveFocalLength;\n\t}\n\n\tpublic set preserveFocalLength(value:boolean)\n\t{\n\t\tif (this._preserveFocalLength == value)\n\t\t\treturn;\n\n\t\tthis._preserveFocalLength = value;\n\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get fieldOfView():number\n\t{\n\t\treturn this._fieldOfView;\n\t}\n\n\tpublic set fieldOfView(value:number)\n\t{\n\t\tif (this._fieldOfView == value)\n\t\t\treturn;\n\n\t\tthis._fieldOfView = value;\n\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get focalLength():number\n\t{\n\t\treturn this._focalLength;\n\t}\n\n\tpublic set focalLength(value:number)\n\t{\n\t\tif (this._focalLength == value)\n\t\t\treturn;\n\n\t\tthis._focalLength = value;\n\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get hFieldOfView():number\n\t{\n\t\treturn this._hFieldOfView;\n\t}\n\n\tpublic set hFieldOfView(value:number)\n\t{\n\t\tif (this._hFieldOfView == value)\n\t\t\treturn;\n\n\t\tthis._hFieldOfView = value;\n\n\t\tthis._hFocalLength = 1/Math.tan(this._hFieldOfView*Math.PI/360);\n\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get hFocalLength():number\n\t{\n\t\treturn this._hFocalLength;\n\t}\n\n\tpublic set hFocalLength(value:number)\n\t{\n\t\tif (this._hFocalLength == value)\n\t\t\treturn;\n\n\t\tthis._hFocalLength = value;\n\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\n\t//@override\n\tpublic unproject(nX:number, nY:number, sZ:number):Vector3D\n\t{\n\t\tvar v:Vector3D = new Vector3D(nX, -nY, sZ, 1.0);\n\n\t\tv.x *= sZ;\n\t\tv.y *= sZ;\n\n\t\tv = this.unprojectionMatrix.transformVector(v);\n\n\t\t//z is unaffected by transform\n\t\tv.z = sZ;\n\n\t\treturn v;\n\t}\n\n\t//@override\n\tpublic clone():ProjectionBase\n\t{\n\t\tvar clone:PerspectiveProjection = new PerspectiveProjection(this._fieldOfView);\n\t\tclone._pNear = this._pNear;\n\t\tclone._pFar = this._pFar;\n\t\tclone._pAspectRatio = this._pAspectRatio;\n\t\tclone._pCoordinateSystem = this._pCoordinateSystem;\n\t\treturn clone;\n\t}\n\n\t//@override\n\tpublic pUpdateMatrix()\n\t{\n\t\tvar raw:number[] = [];\n\n\t\tif (this._preserveFocalLength) {\n\t\t\tif (this._preserveAspectRatio)\n\t\t\t\tthis._hFocalLength = this._focalLength;\n\n\t\t\tthis._fieldOfView = Math.atan(0.5*this._pScissorRect.height/this._focalLength)*360/Math.PI;\n\t\t\tthis._hFieldOfView = Math.atan(0.5*this._pScissorRect.width/this._hFocalLength)*360/Math.PI;\n\t\t} else {\n\t\t\tthis._focalLength = 0.5*this._pScissorRect.height/Math.tan(this._fieldOfView*Math.PI/360);\n\n\t\t\tif (this._preserveAspectRatio)\n\t\t\t\tthis._hFocalLength = this._focalLength;\n\t\t\telse\n\t\t\t\tthis._hFocalLength = 0.5*this._pScissorRect.width/Math.tan(this._hFieldOfView*Math.PI/360);\n\t\t}\n\n\t\tvar tanMinX = -this._pOriginX/this._hFocalLength;\n\t\tvar tanMaxX = (1 - this._pOriginX)/this._hFocalLength;\n\t\tvar tanMinY = -this._pOriginY/this._focalLength;\n\t\tvar tanMaxY = (1 - this._pOriginY)/this._focalLength;\n\n\t\tvar left:number;\n\t\tvar right:number;\n\t\tvar top:number;\n\t\tvar bottom:number;\n\n\t\t// assume scissored frustum\n\t\tvar center:number = -((tanMinX - tanMaxX)*this._pScissorRect.x + tanMinX*this._pScissorRect.width);\n\t\tvar middle:number = ((tanMinY - tanMaxY)*this._pScissorRect.y + tanMinY*this._pScissorRect.height);\n\n\t\tleft = center - (tanMaxX - tanMinX)*this._pViewPort.width;\n\t\tright = center;\n\t\ttop = middle;\n\t\tbottom = middle + (tanMaxY - tanMinY)*this._pViewPort.height;\n\n\t\traw[0] = 2/(right - left);\n\t\traw[5] = 2/(bottom - top);\n\t\traw[8] = (right + left)/(right - left);\n\t\traw[9] = (bottom + top)/(bottom - top);\n\t\traw[10] = (this._pFar + this._pNear)/(this._pFar - this._pNear);\n\t\traw[11] = 1;\n\t\traw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[12] = raw[13] = raw[15] = 0;\n\t\traw[14] = -2*this._pFar*this._pNear/(this._pFar - this._pNear);\n\n\t\tif (this._pCoordinateSystem == CoordinateSystem.RIGHT_HANDED)\n\t\t\traw[5] = -raw[5];\n\n\t\tthis._pMatrix.copyRawDataFrom(raw);\n\n\t\tthis._pFrustumCorners[0] = this._pFrustumCorners[9] = this._pNear*left;\n\t\tthis._pFrustumCorners[3] = this._pFrustumCorners[6] = this._pNear*right;\n\t\tthis._pFrustumCorners[1] = this._pFrustumCorners[4] = this._pNear*top;\n\t\tthis._pFrustumCorners[7] = this._pFrustumCorners[10] = this._pNear*bottom;\n\n\t\tthis._pFrustumCorners[12] = this._pFrustumCorners[21] = this._pFar*left;\n\t\tthis._pFrustumCorners[15] = this._pFrustumCorners[18] = this._pFar*right;\n\t\tthis._pFrustumCorners[13] = this._pFrustumCorners[16] = this._pFar*top;\n\t\tthis._pFrustumCorners[19] = this._pFrustumCorners[22] = this._pFar*bottom;\n\n\t\tthis._pFrustumCorners[2] = this._pFrustumCorners[5] = this._pFrustumCorners[8] = this._pFrustumCorners[11] = this._pNear;\n\t\tthis._pFrustumCorners[14] = this._pFrustumCorners[17] = this._pFrustumCorners[20] = this._pFrustumCorners[23] = this._pFar;\n\n\t\tthis._pMatrixInvalid = false;\n\n\n\t}\n}\n\nexport = PerspectiveProjection;","import Matrix3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Rectangle\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\nimport ProjectionEvent\t\t\t= require(\"awayjs-core/lib/events/ProjectionEvent\");\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\nimport IProjection\t\t\t\t= require(\"awayjs-core/lib/projections/IProjection\");\n\nclass ProjectionBase extends EventDispatcher implements IProjection\n{\n\tpublic _pMatrix:Matrix3D = new Matrix3D();\n\tpublic _pScissorRect:Rectangle = new Rectangle();\n\tpublic _pViewPort:Rectangle = new Rectangle();\n\tpublic _pNear:number = 20;\n\tpublic _pFar:number = 3000;\n\tpublic _pAspectRatio:number = 1;\n\n\tpublic _pMatrixInvalid:boolean = true;\n\tpublic _pFrustumCorners:number[] = [];\n\tpublic _pCoordinateSystem:string;\n\tpublic _pOriginX:number = 0.5;\n\tpublic _pOriginY:number = 0.5;\n\n\tprivate _unprojection:Matrix3D;\n\tprivate _unprojectionInvalid:boolean = true;\n\n\tconstructor(coordinateSystem:string = \"leftHanded\")\n\t{\n\t\tsuper();\n\n\t\tthis.coordinateSystem = coordinateSystem;\n\t}\n\n\t/**\n\t * The handedness of the coordinate system projection. The default is LEFT_HANDED.\n\t */\n\tpublic get coordinateSystem():string\n\t{\n\t\treturn this._pCoordinateSystem;\n\t}\n\n\tpublic set coordinateSystem(value:string)\n\t{\n\t\tif (this._pCoordinateSystem == value)\n\t\t\treturn;\n\n\t\tthis._pCoordinateSystem = value;\n\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\tpublic get frustumCorners():number[]\n\t{\n\t\treturn this._pFrustumCorners;\n\t}\n\n\tpublic set frustumCorners(frustumCorners:number[])\n\t{\n\t\tthis._pFrustumCorners = frustumCorners;\n\t}\n\n\tpublic get matrix():Matrix3D\n\t{\n\t\tif (this._pMatrixInvalid) {\n\t\t\tthis.pUpdateMatrix();\n\t\t\tthis._pMatrixInvalid = false;\n\t\t}\n\t\treturn this._pMatrix;\n\t}\n\n\tpublic set matrix(value:Matrix3D)\n\t{\n\t\tthis._pMatrix = value;\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\tpublic get near():number\n\t{\n\t\treturn this._pNear;\n\t}\n\n\tpublic set near(value:number)\n\t{\n\t\tif (value == this._pNear) {\n\t\t\treturn;\n\t\t}\n\t\tthis._pNear = value;\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\tpublic get originX():number\n\t{\n\t\treturn this._pOriginX;\n\t}\n\n\tpublic set originX(value:number)\n\t{\n\t\tif (this._pOriginX == value)\n\t\t\treturn;\n\n\t\tthis._pOriginX = value;\n\t}\n\n\tpublic get originY():number\n\t{\n\t\treturn this._pOriginY;\n\t}\n\n\tpublic set originY(value:number)\n\t{\n\t\tif (this._pOriginY == value)\n\t\t\treturn;\n\n\t\tthis._pOriginY = value;\n\t}\n\n\tpublic get far():number\n\t{\n\t\treturn this._pFar;\n\t}\n\n\tpublic set far(value:number)\n\t{\n\t\tif (value == this._pFar) {\n\t\t\treturn;\n\t\t}\n\t\tthis._pFar = value;\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\tpublic project(point3d:Vector3D):Vector3D\n\t{\n\t\tvar v:Vector3D = this.matrix.transformVector(point3d);\n\t\tv.x = v.x/v.w;\n\t\tv.y = -v.y/v.w;\n\n\t\t//z is unaffected by transform\n\t\tv.z = point3d.z;\n\n\t\treturn v;\n\t}\n\n\tpublic get unprojectionMatrix():Matrix3D\n\t{\n\t\tif (this._unprojectionInvalid) {\n\t\t\tif (!this._unprojection)\n\t\t\t\tthis._unprojection = new Matrix3D();\n\n\t\t\tthis._unprojection.copyFrom(this.matrix);\n\t\t\tthis._unprojection.invert();\n\t\t\tthis._unprojectionInvalid = false;\n\t\t}\n\t\treturn this._unprojection;\n\t}\n\n\tpublic unproject(nX:number, nY:number, sZ:number):Vector3D\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic clone():ProjectionBase\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic get _iAspectRatio():number\n\t{\n\t\treturn this._pAspectRatio;\n\t}\n\n\tpublic set _iAspectRatio(value:number)\n\t{\n\t\tif (this._pAspectRatio == value)\n\t\t\treturn;\n\n\t\tthis._pAspectRatio = value;\n\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\tpublic pInvalidateMatrix()\n\t{\n\t\tthis._pMatrixInvalid = true;\n\t\tthis._unprojectionInvalid = true;\n\t\tthis.dispatchEvent(new ProjectionEvent(ProjectionEvent.MATRIX_CHANGED, this));\n\t}\n\n\tpublic pUpdateMatrix()\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic _iUpdateScissorRect(x:number, y:number, width:number, height:number)\n\t{\n\t\tthis._pScissorRect.x = x;\n\t\tthis._pScissorRect.y = y;\n\t\tthis._pScissorRect.width = width;\n\t\tthis._pScissorRect.height = height;\n\t\tthis.pInvalidateMatrix();\n\t}\n\n\tpublic _iUpdateViewport(x:number, y:number, width:number, height:number)\n\t{\n\t\tthis._pViewPort.x = x;\n\t\tthis._pViewPort.y = y;\n\t\tthis._pViewPort.width = width;\n\t\tthis._pViewPort.height = height;\n\t\tthis.pInvalidateMatrix();\n\t}\n}\n\nexport = ProjectionBase;","import BitmapData\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport Error\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\nimport CubeTextureBase\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\nimport TextureUtils\t\t\t\t= require(\"awayjs-core/lib/utils/TextureUtils\");\n\n\nclass BitmapCubeTexture extends CubeTextureBase\n{\n\tprivate _bitmapDatas:Array<BitmapData> = new Array<BitmapData>(6);\n\n\t/**\n\t * The texture on the cube's right face.\n\t */\n\tpublic get positiveX():BitmapData\n\t{\n\t\treturn this._bitmapDatas[0];\n\t}\n\n\tpublic set positiveX(value:BitmapData)\n\t{\n\t\tthis._testSize(value);\n\t\tthis.invalidateContent();\n\t\tthis._pSetSize(value.width);\n\t\tthis._bitmapDatas[0] = value;\n\t}\n\n\t/**\n\t * The texture on the cube's left face.\n\t */\n\tpublic get negativeX():BitmapData\n\t{\n\t\treturn this._bitmapDatas[1];\n\t}\n\n\tpublic set negativeX(value:BitmapData)\n\t{\n\t\tthis._testSize(value);\n\t\tthis.invalidateContent();\n\t\tthis._pSetSize(value.width);\n\t\tthis._bitmapDatas[1] = value;\n\t}\n\n\t/**\n\t * The texture on the cube's top face.\n\t */\n\tpublic get positiveY():BitmapData\n\t{\n\t\treturn this._bitmapDatas[2];\n\t}\n\n\tpublic set positiveY(value:BitmapData)\n\t{\n\t\tthis._testSize(value);\n\t\tthis.invalidateContent();\n\t\tthis._pSetSize(value.width);\n\t\tthis._bitmapDatas[2] = value;\n\t}\n\n\t/**\n\t * The texture on the cube's bottom face.\n\t */\n\tpublic get negativeY():BitmapData\n\t{\n\t\treturn this._bitmapDatas[3];\n\t}\n\n\tpublic set negativeY(value:BitmapData)\n\t{\n\t\tthis._testSize(value);\n\t\tthis.invalidateContent();\n\t\tthis._pSetSize(value.width);\n\t\tthis._bitmapDatas[3] = value;\n\t}\n\n\t/**\n\t * The texture on the cube's far face.\n\t */\n\tpublic get positiveZ():BitmapData\n\t{\n\t\treturn this._bitmapDatas[4];\n\t}\n\n\tpublic set positiveZ(value:BitmapData)\n\t{\n\t\tthis._testSize(value);\n\t\tthis.invalidateContent();\n\t\tthis._pSetSize(value.width);\n\t\tthis._bitmapDatas[4] = value;\n\t}\n\n\t/**\n\t * The texture on the cube's near face.\n\t */\n\tpublic get negativeZ():BitmapData\n\t{\n\t\treturn this._bitmapDatas[5];\n\t}\n\n\tpublic set negativeZ(value:BitmapData)\n\t{\n\t\tthis._testSize(value);\n\t\tthis.invalidateContent();\n\t\tthis._pSetSize(value.width);\n\t\tthis._bitmapDatas[5] = value;\n\t}\n\n\tconstructor(posX:BitmapData, negX:BitmapData, posY:BitmapData, negY:BitmapData, posZ:BitmapData, negZ:BitmapData)\n\t{\n\t\tsuper();\n\n\t\tthis._testSize(this._bitmapDatas[0] = posX);\n\t\tthis._testSize(this._bitmapDatas[1] = negX);\n\t\tthis._testSize(this._bitmapDatas[2] = posY);\n\t\tthis._testSize(this._bitmapDatas[3] = negY);\n\t\tthis._testSize(this._bitmapDatas[4] = posZ);\n\t\tthis._testSize(this._bitmapDatas[5] = negZ);\n\n\t\tthis.invalidateContent();\n\n\t\tthis._pSetSize(posX.width);\n\t}\n\n\t/**\n\t *\n\t * @param value\n\t * @private\n\t */\n\tprivate _testSize(value:BitmapData)\n\t{\n\t\tif (value.width != value.height)\n\t\t\tthrow new Error(\"BitmapData should have equal width and height!\");\n\t\tif (!TextureUtils.isBitmapDataValid(value))\n\t\t\tthrow new Error(\"Invalid bitmapData: Width and height must be power of 2 and cannot exceed 2048\");\n\t}\n\n\tpublic dispose()\n\t{\n\t\tsuper.dispose();\n\n\t\tvar len:number = this._bitmapDatas.length\n\t\tfor (var i:number = 0; i < len; i++) {\n\t\t\tthis._bitmapDatas[i].dispose();\n\t\t\tthis._bitmapDatas[i] = null;\n\t\t}\n\n\t\tthis._bitmapDatas = null;\n\t}\n\n\tpublic _iGetTextureData(side:number):BitmapData\n\t{\n\t\treturn this._bitmapDatas[side];\n\t}\n}\n\nexport = BitmapCubeTexture;","import BitmapData\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport Error\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\nimport Texture2DBase\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\nimport TextureUtils\t\t\t\t= require(\"awayjs-core/lib/utils/TextureUtils\");\n\n\nclass BitmapTexture extends Texture2DBase\n{\n\tpublic _bitmapData:BitmapData;\n\n\t/**\n\t *\n\t * @returns {BitmapData}\n\t */\n\tpublic get bitmapData():BitmapData\n\t{\n\t\treturn this._bitmapData;\n\t}\n\n\tpublic set bitmapData(value:BitmapData)\n\t{\n\t\tif (this._bitmapData == value)\n\t\t\treturn;\n\n\t\tif (!TextureUtils.isBitmapDataValid(value))\n\t\t\tthrow new Error(\"Invalid bitmapData: Width and height must be power of 2 and cannot exceed 2048\");\n\n\t\tthis._bitmapData = value;\n\n\t\tthis.invalidateContent();\n\n\t\tthis._pSetSize(value.width, value.height);\n\t}\n\n\tconstructor(bitmapData:BitmapData)\n\t{\n\t\tsuper();\n\n\t\tthis.bitmapData = bitmapData;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tsuper.dispose();\n\n\t\tthis._bitmapData.dispose();\n\t\tthis._bitmapData = null;\n\t}\n\n\tpublic _iGetTextureData():BitmapData\n\t{\n\t\treturn this._bitmapData;\n\t}\n}\n\nexport = BitmapTexture;","import BitmapData\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\nimport MipmapGenerator\t\t\t= require(\"awayjs-core/lib/textures/MipmapGenerator\");\nimport TextureProxyBase\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nclass CubeTextureBase extends TextureProxyBase\n{\n\tpublic _mipmapDataArray:Array<Array<BitmapData>> = new Array<Array<BitmapData>>(6);\n\tpublic _mipmapDataDirtyArray:Array<boolean> = new Array<boolean>(6);\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t *\n\t * @param width\n\t * @param height\n\t * @private\n\t */\n\tpublic _pSetSize(size:number)\n\t{\n\t\tif (this._pSize != size)\n\t\t\tthis.invalidateSize();\n\n\t\tfor (var i:number = 0; i < 6; i++)\n\t\t\tthis._mipmapDataDirtyArray[i] = true;\n\n\t\tthis._pSize = size;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\tsuper.dispose();\n\n\t\tfor (var i:number = 0; i < 6; i++) {\n\t\t\tvar mipmapData:Array<BitmapData> = this._mipmapDataArray[i];\n\t\t\tvar len:number = mipmapData.length;\n\t\t\tfor (var j:number = 0; j < len; j++)\n\t\t\t\tMipmapGenerator.freeMipMapHolder(mipmapData[j]);\n\t\t}\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic invalidateContent():void\n\t{\n\t\tsuper.invalidateContent();\n\n\t\tfor (var i:number = 0; i < 6; i++)\n\t\t\tthis._mipmapDataDirtyArray[i] = true;\n\t}\n\n\tpublic _iGetMipmapData(side:number):Array<BitmapData>\n\t{\n\t\tif (this._mipmapDataDirtyArray[side]) {\n\t\t\tthis._mipmapDataDirtyArray[side] = false;\n\n\t\t\tvar mipmapData:Array<BitmapData> = this._mipmapDataArray[side] || (this._mipmapDataArray[side] = new Array<BitmapData>());\n\t\t\tMipmapGenerator.generateMipMaps(this._iGetTextureData(side), mipmapData, true);\n\t\t}\n\n\t\treturn this._mipmapDataArray[side];\n\t}\n\n\tpublic _iGetTextureData(side:number):any\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n}\n\nexport = CubeTextureBase;","import Error\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\nimport CubeTextureBase\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\nimport TextureUtils\t\t\t\t= require(\"awayjs-core/lib/utils/TextureUtils\");\n\nclass ImageCubeTexture extends CubeTextureBase\n{\n\tprivate _htmlImageElements:Array<HTMLImageElement> = new Array<HTMLImageElement>(6);\n\n\t/**\n\t * The texture on the cube's right face.\n\t */\n\tpublic get positiveX():HTMLImageElement\n\t{\n\t\treturn this._htmlImageElements[0];\n\t}\n\n\tpublic set positiveX(value:HTMLImageElement)\n\t{\n\t\tthis._testSize(value);\n\t\tthis.invalidateContent();\n\t\tthis._pSetSize(value.width);\n\t\tthis._htmlImageElements[0] = value;\n\t}\n\n\t/**\n\t * The texture on the cube's left face.\n\t */\n\tpublic get negativeX():HTMLImageElement\n\t{\n\t\treturn this._htmlImageElements[1];\n\t}\n\n\tpublic set negativeX(value:HTMLImageElement)\n\t{\n\t\tthis._testSize(value);\n\t\tthis.invalidateContent();\n\t\tthis._pSetSize(value.width);\n\t\tthis._htmlImageElements[1] = value;\n\t}\n\n\t/**\n\t * The texture on the cube's top face.\n\t */\n\tpublic get positiveY():HTMLImageElement\n\t{\n\t\treturn this._htmlImageElements[2];\n\t}\n\n\tpublic set positiveY(value:HTMLImageElement)\n\t{\n\t\tthis._testSize(value);\n\t\tthis.invalidateContent();\n\t\tthis._pSetSize(value.width);\n\t\tthis._htmlImageElements[2] = value;\n\t}\n\n\t/**\n\t * The texture on the cube's bottom face.\n\t */\n\tpublic get negativeY():HTMLImageElement\n\t{\n\t\treturn this._htmlImageElements[3];\n\t}\n\n\tpublic set negativeY(value:HTMLImageElement)\n\t{\n\t\tthis._testSize(value);\n\t\tthis.invalidateContent();\n\t\tthis._pSetSize(value.width);\n\t\tthis._htmlImageElements[3] = value;\n\t}\n\n\t/**\n\t * The texture on the cube's far face.\n\t */\n\tpublic get positiveZ():HTMLImageElement\n\t{\n\t\treturn this._htmlImageElements[4];\n\t}\n\n\tpublic set positiveZ(value:HTMLImageElement)\n\t{\n\t\tthis._testSize(value);\n\t\tthis.invalidateContent();\n\t\tthis._pSetSize(value.width);\n\t\tthis._htmlImageElements[4] = value;\n\t}\n\n\t/**\n\t * The texture on the cube's near face.\n\t */\n\tpublic get negativeZ():HTMLImageElement\n\t{\n\t\treturn this._htmlImageElements[5];\n\t}\n\n\tpublic set negativeZ(value:HTMLImageElement)\n\t{\n\t\tthis._testSize(value);\n\t\tthis.invalidateContent();\n\t\tthis._pSetSize(value.width);\n\t\tthis._htmlImageElements[5] = value;\n\t}\n\n\tconstructor(posX:HTMLImageElement, negX:HTMLImageElement, posY:HTMLImageElement, negY:HTMLImageElement, posZ:HTMLImageElement, negZ:HTMLImageElement)\n\t{\n\t\tsuper();\n\n\t\tthis._testSize(this._htmlImageElements[0] = posX);\n\t\tthis._testSize(this._htmlImageElements[1] = negX);\n\t\tthis._testSize(this._htmlImageElements[2] = posY);\n\t\tthis._testSize(this._htmlImageElements[3] = negY);\n\t\tthis._testSize(this._htmlImageElements[4] = posZ);\n\t\tthis._testSize(this._htmlImageElements[5] = negZ);\n\n\t\tthis.invalidateContent();\n\n\t\tthis._pSetSize(posX.width);\n\t}\n\n\tprivate _testSize(value:HTMLImageElement)\n\t{\n\t\tif (value.width != value.height)\n\t\t\tthrow new Error(\"BitmapData should have equal width and height!\");\n\t\tif (!TextureUtils.isHTMLImageElementValid(value))\n\t\t\tthrow new Error(\"Invalid bitmapData: Width and height must be power of 2 and cannot exceed 2048\");\n\t}\n\n\tpublic _iGetTextureData(side:number):HTMLImageElement\n\t{\n\t\treturn this._htmlImageElements[side];\n\t}\n}\n\nexport = ImageCubeTexture;","import Error\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\nimport Texture2DBase\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\nimport TextureUtils\t\t\t\t= require(\"awayjs-core/lib/utils/TextureUtils\");\n\n\nclass ImageTexture extends Texture2DBase\n{\n\tprivate _htmlImageElement:HTMLImageElement;\n\n\t/**\n\t *\n\t * @param htmlImageElement\n\t * @param generateMipmaps\n\t */\n\tconstructor(htmlImageElement:HTMLImageElement)\n\t{\n\t\tsuper();\n\n\t\tthis.htmlImageElement = htmlImageElement;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get htmlImageElement():HTMLImageElement\n\t{\n\t\treturn this._htmlImageElement;\n\t}\n\n\tpublic set htmlImageElement(value:HTMLImageElement)\n\t{\n\t\tif (this._htmlImageElement == value)\n\t\t\treturn;\n\n\t\tif (!TextureUtils.isHTMLImageElementValid(value))\n\t\t\tthrow new Error(\"Invalid bitmapData: Width and height must be power of 2 and cannot exceed 2048\");\n\n\t\tthis._htmlImageElement = value;\n\n\t\tthis.invalidateContent();\n\t\tthis._pSetSize(value.width, value.height);\n\t}\n\n\tpublic _iGetTextureData():HTMLImageElement\n\t{\n\t\treturn this._htmlImageElement;\n\t}\n}\n\nexport = ImageTexture;","import BitmapData\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport Matrix\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\nimport Rectangle\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\n\n/**\n * MipmapGenerator is a helper class that uploads BitmapData to a Texture including mipmap levels.\n */\nclass MipmapGenerator\n{\n\tprivate static _mipMaps = [];\n\tprivate static _mipMapUses = [];\n\n\tprivate static _matrix:Matrix = new Matrix();\n\tprivate static _rect:Rectangle = new Rectangle();\n\tprivate static _source:BitmapData;\n\n\t/**\n\t * Uploads a BitmapData with mip maps to a target Texture object.\n\t * @param source The source to upload.\n\t * @param target The target Texture to upload to.\n\t * @param mipmap An optional mip map holder to avoids creating new instances for fe animated materials.\n\t * @param alpha Indicate whether or not the uploaded bitmapData is transparent.\n\t */\n\tpublic static generateMipMaps(source:HTMLImageElement, output?:Array<BitmapData>, alpha?:boolean);\n\tpublic static generateMipMaps(source:BitmapData, output?:Array<BitmapData>, alpha?:boolean);\n\tpublic static generateMipMaps(source:any, output?:Array<BitmapData>, alpha:boolean = false)\n\t{\n\t\tvar w:number = source.width;\n\t\tvar h:number = source.height;\n\t\tvar i:number = 0;\n\n\t\tvar mipmap:BitmapData;\n\n\t\tMipmapGenerator._rect.width = w;\n\t\tMipmapGenerator._rect.height = h;\n\n\t\t//use (OR) to create non-square texture mipmaps\n\t\twhile (w >= 1 || h >= 1) {\n\n\t\t\tmipmap = output[i] = MipmapGenerator._getMipmapHolder(output[i], MipmapGenerator._rect.width, MipmapGenerator._rect.height);\n\n\t\t\tif (alpha)\n\t\t\t\tmipmap.fillRect(MipmapGenerator._rect, 0);\n\n\t\t\tMipmapGenerator._matrix.a = MipmapGenerator._rect.width/source.width;\n\t\t\tMipmapGenerator._matrix.d = MipmapGenerator._rect.height/source.height;\n\n\t\t\tmipmap.draw(source, MipmapGenerator._matrix); //TODO: smoothing?\n\n\t\t\tw >>= 1;\n\t\t\th >>= 1;\n\n\t\t\tMipmapGenerator._rect.width = w > 1? w : 1;\n\t\t\tMipmapGenerator._rect.height = h > 1? h : 1;\n\n\t\t\ti++;\n\t\t}\n\t}\n\n\tprivate static _getMipmapHolder(mipMapHolder:BitmapData, newW:number, newH:number):BitmapData\n\t{\n\t\tif (mipMapHolder) {\n\t\t\tif (mipMapHolder.width == newW && mipMapHolder.height == newH)\n\t\t\t\treturn mipMapHolder;\n\n\t\t\tMipmapGenerator.freeMipMapHolder(mipMapHolder);\n\t\t}\n\n\t\tif (!MipmapGenerator._mipMaps[newW]) {\n\t\t\tMipmapGenerator._mipMaps[newW] = [];\n\t\t\tMipmapGenerator._mipMapUses[newW] = [];\n\t\t}\n\n\t\tif (!MipmapGenerator._mipMaps[newW][newH]) {\n\t\t\tmipMapHolder = MipmapGenerator._mipMaps[newW][newH] = new BitmapData(newW, newH, true);\n\t\t\tMipmapGenerator._mipMapUses[newW][newH] = 1;\n\t\t} else {\n\t\t\tMipmapGenerator._mipMapUses[newW][newH] = MipmapGenerator._mipMapUses[newW][newH] + 1;\n\t\t\tmipMapHolder = MipmapGenerator._mipMaps[newW][newH];\n\t\t}\n\n\t\treturn mipMapHolder;\n\t}\n\n\tpublic static freeMipMapHolder(mipMapHolder:BitmapData)\n\t{\n\t\tvar holderWidth:number = mipMapHolder.width;\n\t\tvar holderHeight:number = mipMapHolder.height;\n\n\t\tif (--MipmapGenerator._mipMapUses[holderWidth][holderHeight] == 0) {\n\t\t\tMipmapGenerator._mipMaps[holderWidth][holderHeight].dispose();\n\t\t\tMipmapGenerator._mipMaps[holderWidth][holderHeight] = null;\n\t\t}\n\t}\n}\n\nexport = MipmapGenerator;","import Error\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\nimport Texture2DBase\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\nimport TextureUtils\t\t\t\t= require(\"awayjs-core/lib/utils/TextureUtils\");\n\n\nclass RenderTexture extends Texture2DBase\n{\n\t/**\n\t *\n\t * @returns {number}\n\t */\n\tpublic get width():number\n\t{\n\t\treturn this._pWidth;\n\t}\n\n\tpublic set width(value:number)\n\t{\n\t\tif (value == this._pWidth)\n\t\t\treturn;\n\n\t\tif (!TextureUtils.isDimensionValid(value))\n\t\t\tthrow new Error(\"Invalid size: Width and height must be power of 2 and cannot exceed 2048\");\n\n\t\tthis.invalidateContent();\n\n\t\tthis._pSetSize(value, this._pHeight);\n\t}\n\n\t/**\n\t *\n\t * @returns {number}\n\t */\n\tpublic get height():number\n\t{\n\t\treturn this._pHeight;\n\t}\n\n\tpublic set height(value:number)\n\t{\n\t\tif (value == this._pHeight)\n\t\t\treturn;\n\n\t\tif (!TextureUtils.isDimensionValid(value))\n\t\t\tthrow new Error(\"Invalid size: Width and height must be power of 2 and cannot exceed 2048\");\n\n\t\tthis.invalidateContent();\n\t\tthis._pSetSize(this._pWidth, value);\n\t}\n\n\tconstructor(width:number, height:number)\n\t{\n\t\tsuper();\n\n\t\tthis._pSetSize(width, height);\n\t}\n}\n\nexport = RenderTexture;","import BitmapData\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport BitmapDataChannel\t\t= require(\"awayjs-core/lib/base/BitmapDataChannel\");\nimport Point\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\nimport Rectangle\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport BitmapTexture\t\t\t= require(\"awayjs-core/lib/textures/BitmapTexture\");\n\n/**\n * A convenience texture that encodes a specular map in the red channel, and the gloss map in the green channel, as expected by BasicSpecularMapMethod\n */\nclass SpecularBitmapTexture extends BitmapTexture\n{\n\tprivate _specularMap:BitmapData;\n\tprivate _glossMap:BitmapData;\n\t\n\tconstructor(specularMap:BitmapData = null, glossMap:BitmapData = null)\n\t{\n\t\tvar bmd:BitmapData = specularMap? specularMap : glossMap;\n\n\t\tbmd = bmd? new BitmapData(bmd.width, bmd.height, false, 0xffffff) : new BitmapData(1, 1, false, 0xffffff);\n\t\t\n\t\tsuper(bmd);\n\t\t\n\t\tthis.specularMap = specularMap;\n\t\tthis.glossMap = glossMap;\n\t}\n\t\n\tpublic get specularMap():BitmapData\n\t{\n\t\treturn this._specularMap;\n\t}\n\t\n\tpublic set specularMap(value:BitmapData)\n\t{\n\t\tthis._specularMap = value;\n\n\t\tthis.invalidateContent();\n\t\t\n\t\tthis._testSize();\n\t}\n\t\n\tpublic get glossMap():BitmapData\n\t{\n\t\treturn this._glossMap;\n\t}\n\t\n\tpublic set glossMap(value:BitmapData)\n\t{\n\t\tthis._glossMap = value;\n\t\tthis.invalidateContent();\n\t\t\n\t\tthis._testSize();\n\t}\n\t\n\tprivate _testSize()\n\t{\n\t\tvar w:Number, h:Number;\n\t\t\n\t\tif (this._specularMap) {\n\t\t\tw = this._specularMap.width;\n\t\t\th = this._specularMap.height;\n\t\t} else if (this._glossMap) {\n\t\t\tw = this._glossMap.width;\n\t\t\th = this._glossMap.height;\n\t\t} else {\n\t\t\tw = 1;\n\t\t\th = 1;\n\t\t}\n\t\t\n\t\tif (w != this._bitmapData.width && h != this._bitmapData.height) {\n\t\t\tvar oldBitmap:BitmapData = this._bitmapData;\n\t\t\tthis.bitmapData = new BitmapData(this._specularMap.width, this._specularMap.height, false, 0xffffff);\n\t\t\toldBitmap.dispose();\n\t\t}\n\t}\n\n\tpublic _iGetTextureData():BitmapData\n\t{\n\t\tvar rect:Rectangle = this._specularMap.rect;\n\t\tvar origin:Point = new Point();\n\n\t\tthis._bitmapData.fillRect(rect, 0xffffff);\n\n\t\tif (this._glossMap)\n\t\t\tthis._bitmapData.copyChannel(this._glossMap, rect, origin, BitmapDataChannel.GREEN, BitmapDataChannel.GREEN);\n\n\t\tif (this._specularMap)\n\t\t\tthis._bitmapData.copyChannel(this._specularMap, rect, origin, BitmapDataChannel.RED, BitmapDataChannel.RED);\n\n\t\treturn this._bitmapData;\n\t}\n}\n\nexport = SpecularBitmapTexture;","import BitmapData\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\nimport MipmapGenerator\t\t\t= require(\"awayjs-core/lib/textures/MipmapGenerator\");\nimport TextureProxyBase\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nclass Texture2DBase extends TextureProxyBase\n{\n\tprivate _mipmapData:Array<BitmapData>;\n\tprivate _mipmapDataDirty:boolean;\n\tpublic _pWidth:number;\n\tpublic _pHeight:number;\n\t\n\t/**\n\t *\n\t * @returns {number}\n\t */\n\tpublic get width():number\n\t{\n\t\treturn this._pWidth;\n\t}\n\n\t/**\n\t *\n\t * @returns {number}\n\t */\n\tpublic get height():number\n\t{\n\t\treturn this._pHeight;\n\t}\n\n\tpublic get size():number\n\t{\n\t\treturn this._pWidth;\n\t}\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\tsuper.dispose();\n\n\t\tif (this._mipmapData) {\n\t\t\tvar len:number = this._mipmapData.length;\n\t\t\tfor (var i:number = 0; i < len; i++)\n\t\t\t\tMipmapGenerator.freeMipMapHolder(this._mipmapData[i]);\n\t\t}\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic invalidateContent():void\n\t{\n\t\tsuper.invalidateContent();\n\n\t\tthis._mipmapDataDirty = true;\n\t}\n\n\t/**\n\t *\n\t * @param width\n\t * @param height\n\t * @private\n\t */\n\tpublic _pSetSize(width:number, height:number)\n\t{\n\t\tif (this._pWidth != width || this._pHeight != height)\n\t\t\tthis.invalidateSize();\n\n\t\tthis._mipmapDataDirty = true;\n\n\t\tthis._pWidth = width;\n\t\tthis._pHeight = height;\n\t}\n\n\tpublic _iGetMipmapData():Array<BitmapData>\n\t{\n\t\tif (this._mipmapDataDirty) {\n\t\t\tthis._mipmapDataDirty = false;\n\n\t\t\tif (!this._mipmapData)\n\t\t\t\tthis._mipmapData = new Array<BitmapData>();\n\n\t\t\tMipmapGenerator.generateMipMaps(this._iGetTextureData(), this._mipmapData, true);\n\t\t}\n\n\t\treturn this._mipmapData;\n\t}\n\n\tpublic _iGetTextureData():any\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n}\n\nexport = Texture2DBase;","import AssetType\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport NamedAssetBase\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\nimport ITextureData\t\t\t\t= require(\"awayjs-core/lib/pool/ITextureData\");\n\n/**\n *\n */\nclass TextureProxyBase extends NamedAssetBase implements IAsset\n{\n\tpublic _pSize:number;\n\tpublic _pFormat:string = \"bgra\"\n\tprivate _textureData:Array<ITextureData> = new Array<ITextureData>();\n\t\n\t/**\n\t *\n\t */\n\tconstructor(generateMipmaps:boolean = false)\n\t{\n\t\tsuper();\n\t}\n\n\tpublic get size():number\n\t{\n\t\treturn this._pSize;\n\t}\n\n\t/**\n\t *\n\t * @returns {string}\n\t */\n\tpublic get format():string\n\t{\n\t\treturn this._pFormat;\n\t}\n\n\t/**\n\t *\n\t * @returns {string}\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.TEXTURE;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic invalidateContent():void\n\t{\n\t\tvar len:number = this._textureData.length\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._textureData[i].invalidate();\n\t}\n\n\t/**\n\t *\n\t * @private\n\t */\n\tpublic invalidateSize():void\n\t{\n\t\twhile (this._textureData.length)\n\t\t\tthis._textureData[0].dispose();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\twhile (this._textureData.length)\n\t\t\tthis._textureData[0].dispose();\n\t}\n\n\n\tpublic _iAddTextureData(textureData:ITextureData):ITextureData\n\t{\n\t\tthis._textureData.push(textureData);\n\n\t\treturn textureData;\n\t}\n\n\tpublic _iRemoveTextureData(textureData:ITextureData):ITextureData\n\t{\n\t\tthis._textureData.splice(this._textureData.indexOf(textureData), 1);\n\n\t\treturn textureData;\n\t}\n}\n\nexport = TextureProxyBase;","class Keyboard\n{\n\t/**\n\t * Constant associated with the key code value for the A key (65).\n\t */\n\tpublic static A:number /*uint*/ = 65;\n\n\t/**\n\t * Constant associated with the key code value for the Alternate (Option) key  (18).\n\t */\n\tpublic static ALTERNATE:number /*uint*/ = 18;\n\n\t/**\n\t * Select the audio mode\n\t */\n\tpublic static AUDIO:number /*uint*/ = 0x01000017;\n\n\t/**\n\t * Constant associated with the key code value for the B key (66).\n\t */\n\tpublic static B:number /*uint*/ = 66;\n\n\t/**\n\t * Return to previous page in application\n\t */\n\tpublic static BACK:number /*uint*/ = 0x01000016;\n\n\t/**\n\t * Constant associated with the key code value for the ` key (192).\n\t */\n\tpublic static BACKQUOTE:number /*uint*/ = 192;\n\n\t/**\n\t * Constant associated with the key code value for the \\ key (220).\n\t */\n\tpublic static BACKSLASH:number /*uint*/ = 220;\n\n\t/**\n\t * Constant associated with the key code value for the Backspace key (8).\n\t */\n\tpublic static BACKSPACE:number /*uint*/ = 8;\n\n\t/**\n\t * Blue function key button\n\t */\n\tpublic static BLUE:number /*uint*/ = 0x01000003;\n\n\t/**\n\t * Constant associated with the key code value for the C key (67).\n\t */\n\tpublic static C:number /*uint*/ = 67;\n\n\t/**\n\t * Constant associated with the key code value for the Caps Lock key (20).\n\t */\n\tpublic static CAPS_LOCK:number /*uint*/ = 20;\n\n\t/**\n\t * Channel down\n\t */\n\tpublic static CHANNEL_DOWN:number /*uint*/ = 0x01000005;\n\n\t/**\n\t * Channel up\n\t */\n\tpublic static CHANNEL_UP:number /*uint*/ = 0x01000005;\n\n\t/**\n\t * Constant associated with the key code value for the , key (188).\n\t */\n\tpublic static COMMA:number /*uint*/ = 188;\n\n\t/**\n\t * Constant associated with the Mac command key (15). This constant is\n\t * currently only used for setting menu key equivalents.\n\t */\n\tpublic static COMMAND:number /*uint*/ = 15;\n\n\t/**\n\t * Constant associated with the key code value for the Control key (17).\n\t */\n\tpublic static CONTROL:number /*uint*/ = 17;\n\n\t/**\n\t * An array containing all the defined key name constants.\n\t */\n\tpublic static CharCodeStrings:Array<any>;\n\n\t/**\n\t * Constant associated with the key code value for the D key (68).\n\t */\n\tpublic static D:number /*uint*/ = 68;\n\n\t/**\n\t * Constant associated with the key code value for the Delete key (46).\n\t */\n\tpublic static DELETE:number /*uint*/ = 46;\n\n\t/**\n\t * Constant associated with the key code value for the Down Arrow key (40).\n\t */\n\tpublic static DOWN:number /*uint*/ = 40;\n\n\t/**\n\t * Engage DVR application mode\n\t */\n\tpublic static DVR:number /*uint*/ = 0x01000019;\n\n\t/**\n\t * Constant associated with the key code value for the E key (69).\n\t */\n\tpublic static E:number /*uint*/ = 69;\n\n\t/**\n\t * Constant associated with the key code value for the End key (35).\n\t */\n\tpublic static END:number /*uint*/ = 35;\n\n\t/**\n\t * Constant associated with the key code value for the Enter key (13).\n\t */\n\tpublic static ENTER:number /*uint*/ = 13;\n\n\t/**\n\t * Constant associated with the key code value for the = key (187).\n\t */\n\tpublic static EQUAL:number /*uint*/ = 187;\n\n\t/**\n\t * Constant associated with the key code value for the Escape key (27).\n\t */\n\tpublic static ESCAPE:number /*uint*/ = 27;\n\n\t/**\n\t * Exits current application mode\n\t */\n\tpublic static EXIT:number /*uint*/ = 0x01000015;\n\n\t/**\n\t * Constant associated with the key code value for the F key (70).\n\t */\n\tpublic static F:number /*uint*/ = 70;\n\n\t/**\n\t * Constant associated with the key code value for the F1 key (112).\n\t */\n\tpublic static F1:number /*uint*/ = 112;\n\n\t/**\n\t * Constant associated with the key code value for the F10 key (121).\n\t */\n\tpublic static F10:number /*uint*/ = 121;\n\n\t/**\n\t * Constant associated with the key code value for the F11 key (122).\n\t */\n\tpublic static F11:number /*uint*/ = 122;\n\n\t/**\n\t * Constant associated with the key code value for the F12 key (123).\n\t */\n\tpublic static F12:number /*uint*/ = 123;\n\n\t/**\n\t * Constant associated with the key code value for the F13 key (124).\n\t */\n\tpublic static F13:number /*uint*/ = 124;\n\n\t/**\n\t * Constant associated with the key code value for the F14 key (125).\n\t */\n\tpublic static F14:number /*uint*/ = 125;\n\n\t/**\n\t * Constant associated with the key code value for the F15 key (126).\n\t */\n\tpublic static F15:number /*uint*/ = 126;\n\n\t/**\n\t * Constant associated with the key code value for the F2 key (113).\n\t */\n\tpublic static F2:number /*uint*/ = 113;\n\n\t/**\n\t * Constant associated with the key code value for the F3 key (114).\n\t */\n\tpublic static F3:number /*uint*/ = 114;\n\n\t/**\n\t * Constant associated with the key code value for the F4 key (115).\n\t */\n\tpublic static F4:number /*uint*/ = 115;\n\n\t/**\n\t * Constant associated with the key code value for the F5 key (116).\n\t */\n\tpublic static F5:number /*uint*/ = 116;\n\n\t/**\n\t * Constant associated with the key code value for the F6 key (117).\n\t */\n\tpublic static F6:number /*uint*/ = 117;\n\n\t/**\n\t * Constant associated with the key code value for the F7 key (118).\n\t */\n\tpublic static F7:number /*uint*/ = 118;\n\n\t/**\n\t * Constant associated with the key code value for the F8 key (119).\n\t */\n\tpublic static F8:number /*uint*/ = 119;\n\n\t/**\n\t * Constant associated with the key code value for the F9 key (120).\n\t */\n\tpublic static F9:number /*uint*/ = 120;\n\n\t/**\n\t * Engage fast-forward transport mode\n\t */\n\tpublic static FAST_FORWARD:number /*uint*/ = 0x0100000A;\n\n\t/**\n\t * Constant associated with the key code value for the G key (71).\n\t */\n\tpublic static G:number /*uint*/ = 71;\n\n\t/**\n\t * Green function key button\n\t */\n\tpublic static GREEN:number /*uint*/ = 0x01000001;\n\n\t/**\n\t * Engage program guide\n\t */\n\tpublic static GUIDE:number /*uint*/ = 0x01000014;\n\n\t/**\n\t * Constant associated with the key code value for the H key (72).\n\t */\n\tpublic static H:number /*uint*/ = 72;\n\n\t/**\n\t * Engage help application or context-sensitive help\n\t */\n\tpublic static HELP:number /*uint*/ = 0x0100001D;\n\n\t/**\n\t * Constant associated with the key code value for the Home key (36).\n\t */\n\tpublic static HOME:number /*uint*/ = 36;\n\n\t/**\n\t * Constant associated with the key code value for the I key (73).\n\t */\n\tpublic static I:number /*uint*/ = 73;\n\n\t/**\n\t * Info button\n\t */\n\tpublic static INFO:number /*uint*/ = 0x01000013;\n\n\t/**\n\t * Cycle input\n\t */\n\tpublic static INPUT:number /*uint*/ = 0x0100001B;\n\n\t/**\n\t * Constant associated with the key code value for the Insert key (45).\n\t */\n\tpublic static INSERT:number /*uint*/ = 45;\n\n\t/**\n\t * Constant associated with the key code value for the J key (74).\n\t */\n\tpublic static J:number /*uint*/ = 74;\n\n\t/**\n\t * Constant associated with the key code value for the K key (75).\n\t */\n\tpublic static K:number /*uint*/ = 75;\n\n\t/**\n\t * The Begin key\n\t */\n\tpublic static KEYNAME_BEGIN:string = \"Begin\";\n\n\t/**\n\t * The Break key\n\t */\n\tpublic static KEYNAME_BREAK:string = \"Break\";\n\n\t/**\n\t * The Clear Display key\n\t */\n\tpublic static KEYNAME_CLEARDISPLAY:string = \"ClrDsp\";\n\n\t/**\n\t * The Clear Line key\n\t */\n\tpublic static KEYNAME_CLEARLINE:string = \"ClrLn\";\n\n\t/**\n\t * The Delete key\n\t */\n\tpublic static KEYNAME_DELETE:string = \"Delete\";\n\n\t/**\n\t * The Delete Character key\n\t */\n\tpublic static KEYNAME_DELETECHAR:string = \"DelChr\";\n\n\t/**\n\t * The Delete Line key\n\t */\n\tpublic static KEYNAME_DELETELINE:string = \"DelLn\";\n\n\t/**\n\t * The down arrow\n\t */\n\tpublic static KEYNAME_DOWNARROW:string = \"Down\";\n\n\t/**\n\t * The End key\n\t */\n\tpublic static KEYNAME_END:string = \"End\";\n\n\t/**\n\t * The Execute key\n\t */\n\tpublic static KEYNAME_EXECUTE:string = \"Exec\";\n\n\t/**\n\t * The F1 key\n\t */\n\tpublic static KEYNAME_F1:string = \"F1\";\n\n\t/**\n\t * The F10 key\n\t */\n\tpublic static KEYNAME_F10:string = \"F10\";\n\n\t/**\n\t * The F11 key\n\t */\n\tpublic static KEYNAME_F11:string = \"F11\";\n\n\t/**\n\t * The F12 key\n\t */\n\tpublic static KEYNAME_F12:string = \"F12\";\n\n\t/**\n\t * The F13 key\n\t */\n\tpublic static KEYNAME_F13:string = \"F13\";\n\n\t/**\n\t * The F14 key\n\t */\n\tpublic static KEYNAME_F14:string = \"F14\";\n\n\t/**\n\t * The F15 key\n\t */\n\tpublic static KEYNAME_F15:string = \"F15\";\n\n\t/**\n\t * The F16 key\n\t */\n\tpublic static KEYNAME_F16:string = \"F16\";\n\n\t/**\n\t * The F17 key\n\t */\n\tpublic static KEYNAME_F17:string = \"F17\";\n\n\t/**\n\t * The F18 key\n\t */\n\tpublic static KEYNAME_F18:string = \"F18\";\n\n\t/**\n\t * The F19 key\n\t */\n\tpublic static KEYNAME_F19:string = \"F19\";\n\n\t/**\n\t * The F2 key\n\t */\n\tpublic static KEYNAME_F2:string = \"F2\";\n\n\t/**\n\t * The F20 key\n\t */\n\tpublic static KEYNAME_F20:string = \"F20\";\n\n\t/**\n\t * The F21 key\n\t */\n\tpublic static KEYNAME_F21:string = \"F21\";\n\n\t/**\n\t * The F22 key\n\t */\n\tpublic static KEYNAME_F22:string = \"F22\";\n\n\t/**\n\t * The F23 key\n\t */\n\tpublic static KEYNAME_F23:string = \"F23\";\n\n\t/**\n\t * The F24 key\n\t */\n\tpublic static KEYNAME_F24:string = \"F24\";\n\n\t/**\n\t * The F25 key\n\t */\n\tpublic static KEYNAME_F25:string = \"F25\";\n\n\t/**\n\t * The F26 key\n\t */\n\tpublic static KEYNAME_F26:string = \"F26\";\n\n\t/**\n\t * The F27 key\n\t */\n\tpublic static KEYNAME_F27:string = \"F27\";\n\n\t/**\n\t * The F28 key\n\t */\n\tpublic static KEYNAME_F28:string = \"F28\";\n\n\t/**\n\t * The F29 key\n\t */\n\tpublic static KEYNAME_F29:string = \"F29\";\n\n\t/**\n\t * The F3 key\n\t */\n\tpublic static KEYNAME_F3:string = \"F3\";\n\n\t/**\n\t * The F30 key\n\t */\n\tpublic static KEYNAME_F30:string = \"F30\";\n\n\t/**\n\t * The F31 key\n\t */\n\tpublic static KEYNAME_F31:string = \"F31\";\n\n\t/**\n\t * The F32 key\n\t */\n\tpublic static KEYNAME_F32:string = \"F32\";\n\n\t/**\n\t * The F33 key\n\t */\n\tpublic static KEYNAME_F33:string = \"F33\";\n\n\t/**\n\t * The F34 key\n\t */\n\tpublic static KEYNAME_F34:string = \"F34\";\n\n\t/**\n\t * The F35 key\n\t */\n\tpublic static KEYNAME_F35:string = \"F35\";\n\n\t/**\n\t * The F4 key\n\t */\n\tpublic static KEYNAME_F4:string = \"F4\";\n\n\t/**\n\t * The F5 key\n\t */\n\tpublic static KEYNAME_F5:string = \"F5\";\n\n\t/**\n\t * The F6 key\n\t */\n\tpublic static KEYNAME_F6:string = \"F6\";\n\n\t/**\n\t * The F7 key\n\t */\n\tpublic static KEYNAME_F7:string = \"F7\";\n\n\t/**\n\t * The F8 key\n\t */\n\tpublic static KEYNAME_F8:string = \"F8\";\n\n\t/**\n\t * The F9 key\n\t */\n\tpublic static KEYNAME_F9:string = \"F9\";\n\n\t/**\n\t * The Find key\n\t */\n\tpublic static KEYNAME_FIND:string = \"Find\";\n\n\t/**\n\t * The Help key\n\t */\n\tpublic static KEYNAME_HELP:string = \"Help\";\n\n\t/**\n\t * The Home key\n\t */\n\tpublic static KEYNAME_HOME:string = \"Home\";\n\n\t/**\n\t * The Insert key\n\t */\n\tpublic static KEYNAME_INSERT:string = \"Insert\";\n\n\t/**\n\t * The Insert Character key\n\t */\n\tpublic static KEYNAME_INSERTCHAR:string = \"InsChr\";\n\n\t/**\n\t * The Insert Line key\n\t */\n\tpublic static KEYNAME_INSERTLINE:string = \"LnsLn\";\n\n\t/**\n\t * The left arrow\n\t */\n\tpublic static KEYNAME_LEFTARROW:string = \"Left\";\n\n\t/**\n\t * The Menu key\n\t */\n\tpublic static KEYNAME_MENU:string = \"Menu\";\n\n\t/**\n\t * The Mode Switch key\n\t */\n\tpublic static KEYNAME_MODESWITCH:string = \"ModeSw\";\n\n\t/**\n\t * The Next key\n\t */\n\tpublic static KEYNAME_NEXT:string = \"Next\";\n\n\t/**\n\t * The Page Down key\n\t */\n\tpublic static KEYNAME_PAGEDOWN:string = \"PgDn\";\n\n\t/**\n\t * The Page Up key\n\t */\n\tpublic static KEYNAME_PAGEUP:string = \"PgUp\";\n\n\t/**\n\t * The Pause key\n\t */\n\tpublic static KEYNAME_PAUSE:string = \"Pause\";\n\n\t/**\n\t * The Previous key\n\t */\n\tpublic static KEYNAME_PREV:string = \"Prev\";\n\n\t/**\n\t * The PRINT key\n\t */\n\tpublic static KEYNAME_PRINT:string = \"Print\";\n\n\t/**\n\t * The PRINT Screen\n\t */\n\tpublic static KEYNAME_PRINTSCREEN:string = \"PrntScrn\";\n\n\t/**\n\t * The Redo key\n\t */\n\tpublic static KEYNAME_REDO:string = \"Redo\";\n\n\t/**\n\t * The Reset key\n\t */\n\tpublic static KEYNAME_RESET:string = \"Reset\";\n\n\t/**\n\t * The right arrow\n\t */\n\tpublic static KEYNAME_RIGHTARROW:string = \"Right\";\n\n\t/**\n\t * The Scroll Lock key\n\t */\n\tpublic static KEYNAME_SCROLLLOCK:string = \"ScrlLck\";\n\n\t/**\n\t * The Select key\n\t */\n\tpublic static KEYNAME_SELECT:string = \"Select\";\n\n\t/**\n\t * The Stop key\n\t */\n\tpublic static KEYNAME_STOP:string = \"Stop\";\n\n\t/**\n\t * The System Request key\n\t */\n\tpublic static KEYNAME_SYSREQ:string = \"SysReq\";\n\n\t/**\n\t * The System key\n\t */\n\tpublic static KEYNAME_SYSTEM:string = \"Sys\";\n\n\t/**\n\t * The Undo key\n\t */\n\tpublic static KEYNAME_UNDO:string = \"Undo\";\n\n\t/**\n\t * The up arrow\n\t */\n\tpublic static KEYNAME_UPARROW:string = \"Up\";\n\n\t/**\n\t * The User key\n\t */\n\tpublic static KEYNAME_USER:string = \"User\";\n\n\t/**\n\t * Constant associated with the key code value for the L key (76).\n\t */\n\tpublic static L:number /*uint*/ = 76;\n\n\t/**\n\t * Watch last channel or show watched\n\t */\n\tpublic static LAST:number /*uint*/ = 0x01000011;\n\n\t/**\n\t * Constant associated with the key code value for the Left Arrow key (37).\n\t */\n\tpublic static LEFT:number /*uint*/ = 37;\n\n\t/**\n\t * Constant associated with the key code value for the [ key (219).\n\t */\n\tpublic static LEFTBRACKET:number /*uint*/ = 219;\n\n\t/**\n\t * Return to live [position in broadcast]\n\t */\n\tpublic static LIVE:number /*uint*/ = 0x01000010;\n\n\t/**\n\t * Constant associated with the key code value for the M key (77).\n\t */\n\tpublic static M:number /*uint*/ = 77;\n\n\t/**\n\t * Engage \"Master Shell\" e.g. TiVo or other vendor button\n\t */\n\tpublic static MASTER_SHELL:number /*uint*/ = 0x0100001E;\n\n\t/**\n\t * Engage menu\n\t */\n\tpublic static MENU:number /*uint*/ = 0x01000012;\n\n\t/**\n\t * Constant associated with the key code value for the - key (189).\n\t */\n\tpublic static MINUS:number /*uint*/ = 189;\n\n\t/**\n\t * Constant associated with the key code value for the N key (78).\n\t */\n\tpublic static N:number /*uint*/ = 78;\n\n\t/**\n\t * Skip to next track or chapter\n\t */\n\tpublic static NEXT:number /*uint*/ = 0x0100000E;\n\n\t/**\n\t * Constant associated with the key code value for the 0 key (48).\n\t */\n\tpublic static NUMBER_0:number /*uint*/ = 48;\n\n\t/**\n\t * Constant associated with the key code value for the 1 key (49).\n\t */\n\tpublic static NUMBER_1:number /*uint*/ = 49;\n\n\t/**\n\t * Constant associated with the key code value for the 2 key (50).\n\t */\n\tpublic static NUMBER_2:number /*uint*/ = 50;\n\n\t/**\n\t * Constant associated with the key code value for the 3 key (51).\n\t */\n\tpublic static NUMBER_3:number /*uint*/ = 51;\n\n\t/**\n\t * Constant associated with the key code value for the 4 key (52).\n\t */\n\tpublic static NUMBER_4:number /*uint*/ = 52;\n\n\t/**\n\t * Constant associated with the key code value for the 5 key (53).\n\t */\n\tpublic static NUMBER_5:number /*uint*/ = 53;\n\n\t/**\n\t * Constant associated with the key code value for the 6 key (54).\n\t */\n\tpublic static NUMBER_6:number /*uint*/ = 54;\n\n\t/**\n\t * Constant associated with the key code value for the 7 key (55).\n\t */\n\tpublic static NUMBER_7:number /*uint*/ = 55;\n\n\t/**\n\t * Constant associated with the key code value for the 8 key (56).\n\t */\n\tpublic static NUMBER_8:number /*uint*/ = 56;\n\n\t/**\n\t * Constant associated with the key code value for the 9 key (57).\n\t */\n\tpublic static NUMBER_9:number /*uint*/ = 57;\n\n\t/**\n\t * Constant associated with the pseudo-key code for the the number pad (21). Use to set numpad modifier on key equivalents\n\t */\n\tpublic static NUMPAD:number /*uint*/ = 21;\n\n\t/**\n\t * Constant associated with the key code value for the number 0 key on the number pad (96).\n\t */\n\tpublic static NUMPAD_0:number /*uint*/ = 96;\n\n\t/**\n\t * Constant associated with the key code value for the number 1 key on the number pad (97).\n\t */\n\tpublic static NUMPAD_1:number /*uint*/ = 97;\n\n\t/**\n\t * Constant associated with the key code value for the number 2 key on the number pad (98).\n\t */\n\tpublic static NUMPAD_2:number /*uint*/ = 98;\n\n\t/**\n\t * Constant associated with the key code value for the number 3 key on the number pad (99).\n\t */\n\tpublic static NUMPAD_3:number /*uint*/ = 99;\n\n\t/**\n\t * Constant associated with the key code value for the number 4 key on the number pad (100).\n\t */\n\tpublic static NUMPAD_4:number /*uint*/ = 100;\n\n\t/**\n\t * Constant associated with the key code value for the number 5 key on the number pad (101).\n\t */\n\tpublic static NUMPAD_5:number /*uint*/ = 101;\n\n\t/**\n\t * Constant associated with the key code value for the number 6 key on the number pad (102).\n\t */\n\tpublic static NUMPAD_6:number /*uint*/ = 102;\n\n\t/**\n\t * Constant associated with the key code value for the number 7 key on the number pad (103).\n\t */\n\tpublic static NUMPAD_7:number /*uint*/ = 103;\n\n\t/**\n\t * Constant associated with the key code value for the number 8 key on the number pad (104).\n\t */\n\tpublic static NUMPAD_8:number /*uint*/ = 104;\n\n\t/**\n\t * Constant associated with the key code value for the number 9 key on the number pad (105).\n\t */\n\tpublic static NUMPAD_9:number /*uint*/ = 105;\n\n\t/**\n\t * Constant associated with the key code value for the addition key on the number pad (107).\n\t */\n\tpublic static NUMPAD_ADD:number /*uint*/ = 107;\n\n\t/**\n\t * Constant associated with the key code value for the decimal key on the number pad (110).\n\t */\n\tpublic static NUMPAD_DECIMAL:number /*uint*/ = 110;\n\n\t/**\n\t * Constant associated with the key code value for the division key on the number pad (111).\n\t */\n\tpublic static NUMPAD_DIVIDE:number /*uint*/ = 111;\n\n\t/**\n\t * Constant associated with the key code value for the Enter key on the number pad (108).\n\t */\n\tpublic static NUMPAD_ENTER:number /*uint*/ = 108;\n\n\t/**\n\t * Constant associated with the key code value for the multiplication key on the number pad (106).\n\t */\n\tpublic static NUMPAD_MULTIPLY:number /*uint*/ = 106;\n\n\t/**\n\t * Constant associated with the key code value for the subtraction key on the number pad (109).\n\t */\n\tpublic static NUMPAD_SUBTRACT:number /*uint*/ = 109;\n\n\t/**\n\t * Constant associated with the key code value for the O key (79).\n\t */\n\tpublic static O:number /*uint*/ = 79;\n\n\t/**\n\t * Constant associated with the key code value for the P key (80).\n\t */\n\tpublic static P:number /*uint*/ = 80;\n\n\t/**\n\t * Constant associated with the key code value for the Page Down key (34).\n\t */\n\tpublic static PAGE_DOWN:number /*uint*/ = 34;\n\n\t/**\n\t * Constant associated with the key code value for the Page Up key (33).\n\t */\n\tpublic static PAGE_UP:number /*uint*/ = 33;\n\n\t/**\n\t * Engage pause transport mode\n\t */\n\tpublic static PAUSE:number /*uint*/ = 0x01000008;\n\n\t/**\n\t * Constant associated with the key code value for the . key (190).\n\t */\n\tpublic static PERIOD:number /*uint*/ = 190;\n\n\t/**\n\t * Engage play transport mode\n\t */\n\tpublic static PLAY:number /*uint*/ = 0x01000007;\n\n\t/**\n\t * Skip to previous track or chapter\n\t */\n\tpublic static PREVIOUS:number /*uint*/ = 0x0100000F;\n\n\t/**\n\t * Constant associated with the key code value for the Q key (81).\n\t */\n\tpublic static Q:number /*uint*/ = 81;\n\n\t/**\n\t * Constant associated with the key code value for the ' key (222).\n\t */\n\tpublic static QUOTE:number /*uint*/ = 222;\n\n\t/**\n\t * Constant associated with the key code value for the R key (82).\n\t */\n\tpublic static R:number /*uint*/ = 82;\n\n\t/**\n\t * Record item or engage record transport mode\n\t */\n\tpublic static RECORD:number /*uint*/ = 0x01000006;\n\n\t/**\n\t * Red function key button\n\t */\n\tpublic static RED:number /*uint*/ = 0x01000000;\n\n\t/**\n\t * Engage rewind transport mode\n\t */\n\tpublic static REWIND:number /*uint*/ = 0x0100000B;\n\n\t/**\n\t * Constant associated with the key code value for the Right Arrow key (39).\n\t */\n\tpublic static RIGHT:number /*uint*/ = 39;\n\n\t/**\n\t * Constant associated with the key code value for the ] key (221).\n\t */\n\tpublic static RIGHTBRACKET:number /*uint*/ = 221;\n\n\t/**\n\t * Constant associated with the key code value for the S key (83).\n\t */\n\tpublic static S:number /*uint*/ = 83;\n\n\t/**\n\t * Search button\n\t */\n\tpublic static SEARCH:number /*uint*/ = 0x0100001F;\n\n\t/**\n\t * Constant associated with the key code value for the ; key (186).\n\t */\n\tpublic static SEMICOLON:number /*uint*/ = 186;\n\n\t/**\n\t * Engage setup application or menu\n\t */\n\tpublic static SETUP:number /*uint*/ = 0x0100001C;\n\n\t/**\n\t * Constant associated with the key code value for the Shift key (16).\n\t */\n\tpublic static SHIFT:number /*uint*/ = 16;\n\n\t/**\n\t * Quick skip backward (usually 7-10 seconds)\n\t */\n\tpublic static SKIP_BACKWARD:number /*uint*/ = 0x0100000D;\n\n\t/**\n\t * Quick skip ahead (usually 30 seconds)\n\t */\n\tpublic static SKIP_FORWARD:number /*uint*/ = 0x0100000C;\n\n\t/**\n\t * Constant associated with the key code value for the / key (191).\n\t */\n\tpublic static SLASH:number /*uint*/ = 191;\n\n\t/**\n\t * Constant associated with the key code value for the Spacebar (32).\n\t */\n\tpublic static SPACE:number /*uint*/ = 32;\n\n\t/**\n\t * Engage stop transport mode\n\t */\n\tpublic static STOP:number /*uint*/ = 0x01000009;\n\n\t/**\n\t * Toggle subtitles\n\t */\n\tpublic static SUBTITLE:number /*uint*/ = 0x01000018;\n\n\t/**\n\t * Constant associated with the key code value for the T key (84).\n\t */\n\tpublic static T:number /*uint*/ = 84;\n\n\t/**\n\t * Constant associated with the key code value for the Tab key (9).\n\t */\n\tpublic static TAB:number /*uint*/ = 9;\n\n\t/**\n\t * Constant associated with the key code value for the U key (85).\n\t */\n\tpublic static U:number /*uint*/ = 85;\n\n\t/**\n\t * Constant associated with the key code value for the Up Arrow key (38).\n\t */\n\tpublic static UP:number /*uint*/ = 38;\n\n\t/**\n\t * Constant associated with the key code value for the V key (86).\n\t */\n\tpublic static V:number /*uint*/ = 86;\n\n\t/**\n\t * Engage video-on-demand\n\t */\n\tpublic static VOD:number /*uint*/ = 0x0100001A;\n\n\t/**\n\t * Constant associated with the key code value for the W key (87).\n\t */\n\tpublic static W:number /*uint*/ = 87;\n\n\t/**\n\t * Constant associated with the key code value for the X key (88).\n\t */\n\tpublic static X:number /*uint*/ = 88;\n\n\t/**\n\t * Constant associated with the key code value for the Y key (89).\n\t */\n\tpublic static Y:number /*uint*/ = 89;\n\n\t/**\n\t * Yellow function key button\n\t */\n\tpublic static YELLOW:number /*uint*/ = 0x01000002;\n\n\t/**\n\t * Constant associated with the key code value for the Z key (90).\n\t */\n\tpublic static Z:number /*uint*/ = 90;\n\n}\n\nexport = Keyboard;","import AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nclass ByteArrayBase\n{\n\tpublic position:number = 0;\n\tpublic length:number = 0;\n\tpublic _mode:string = \"\";\n\n\tpublic static Base64Key = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n\n\tconstructor()\n\t{\n\t}\n\n\tpublic writeByte(b:number)\n\t{\n\t\tthrow \"Virtual method\";\n\t}\n\n\tpublic readByte():number\n\t{\n\t\tthrow \"Virtual method\";\n\t}\n\n\tpublic writeUnsignedByte(b:number)\n\t{\n\t\tthrow \"Virtual method\";\n\t}\n\n\tpublic readUnsignedByte():number\n\t{\n\t\tthrow \"Virtual method\";\n\t}\n\n\tpublic writeUnsignedShort(b:number)\n\t{\n\t\tthrow \"Virtual method\";\n\t}\n\n\tpublic readUnsignedShort():number\n\t{\n\t\tthrow \"Virtual method\";\n\t}\n\n\tpublic writeUnsignedInt(b:number)\n\t{\n\t\tthrow \"Virtual method\";\n\t}\n\n\tpublic readUnsignedInt():number\n\t{\n\t\tthrow \"Virtual method\";\n\t}\n\n\tpublic writeFloat(b:number)\n\t{\n\t\tthrow \"Virtual method\";\n\t}\n\n\tpublic toFloatBits(x:number)\n\t{\n\t\tthrow \"Virtual method\";\n\t}\n\n\tpublic readFloat(b:number)\n\t{\n\t\tthrow \"Virtual method\";\n\t}\n\n\tpublic fromFloatBits(x:number)\n\t{\n\t\tthrow \"Virtual method\";\n\t}\n\n\tpublic getBytesAvailable():number\n\t{\n\t\tthrow new AbstractMethodError('ByteArrayBase, getBytesAvailable() not implemented ');\n\t}\n\n\tpublic toString():string\n\t{\n\t\treturn \"[ByteArray] ( \" + this._mode + \" ) position=\" + this.position + \" length=\" + this.length;\n\t}\n\n\tpublic compareEqual(other, count)\n\t{\n\t\tif (count == undefined || count > this.length - this.position)\n\t\t\tcount = this.length - this.position;\n\t\tif (count > other.length - other.position)\n\t\t\tcount = other.length - other.position;\n\t\tvar co0 = count;\n\t\tvar r = true;\n\t\twhile (r && count >= 4) {\n\t\t\tcount -= 4;\n\t\t\tif (this.readUnsignedInt() != other.readUnsignedInt()) r = false;\n\t\t}\n\t\twhile (r && count >= 1) {\n\t\t\tcount--;\n\t\t\tif (this.readUnsignedByte() != other.readUnsignedByte()) r = false;\n\t\t}\n\t\tvar c0;\n\t\tthis.position -= (c0 - count);\n\t\tother.position -= (c0 - count);\n\t\treturn r;\n\t}\n\n\tpublic writeBase64String(s:string)\n\t{\n\t\tfor (var i:number = 0; i < s.length; i++) {\n\t\t\tvar v = s.charAt(i);\n\t\t}\n\t}\n\n\tpublic dumpToConsole()\n\t{\n\t\tvar oldpos = this.position;\n\t\tthis.position = 0;\n\t\tvar nstep:number = 8;\n\n\t\tfunction asHexString(x, digits)\n\t\t{\n\t\t\tvar lut:Array<string> = [ \"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"a\", \"b\", \"c\", \"d\", \"e\", \"f\" ];\n\t\t\tvar sh:string = \"\";\n\t\t\tfor (var d:number = 0; d < digits; d++) {\n\t\t\t\tsh = lut[(x >> (d << 2)) & 0xf] + sh;\n\t\t\t}\n\t\t\treturn sh;\n\t\t}\n\n\t\tfor (var i = 0; i < this.length; i += nstep) {\n\t\t\tvar s:string = asHexString(i, 4) + \":\";\n\t\t\tfor (var j:number = 0; j < nstep && i + j < this.length; j++) {\n\t\t\t\ts += \" \" + asHexString(this.readUnsignedByte(), 2);\n\t\t\t}\n\t\t\tconsole.log(s);\n\t\t}\n\t\tthis.position = oldpos;\n\t}\n\n\tpublic readBase64String(count:number)\n\t{\n\t\tif (count == undefined || count > this.length - this.position)\n\t\t\tcount = this.length - this.position;\n\t\tif (!(count > 0)) return \"\";\n\n\t\treturn ByteArrayBase.internalGetBase64String(count, this.readUnsignedByte, this);\n\t}\n\n\tpublic static internalGetBase64String(count, getUnsignedByteFunc, self)\n\t{ // return base64 string of the next count bytes\n\t\tvar r = \"\";\n\t\tvar b0, b1, b2, enc1, enc2, enc3, enc4;\n\t\tvar base64Key = ByteArrayBase.Base64Key;\n\t\twhile (count >= 3) {\n\t\t\tb0 = getUnsignedByteFunc.apply(self);\n\t\t\tb1 = getUnsignedByteFunc.apply(self);\n\t\t\tb2 = getUnsignedByteFunc.apply(self);\n\t\t\tenc1 = b0 >> 2;\n\t\t\tenc2 = ((b0 & 3) << 4) | (b1 >> 4);\n\t\t\tenc3 = ((b1 & 15) << 2) | (b2 >> 6);\n\t\t\tenc4 = b2 & 63;\n\t\t\tr += base64Key.charAt(enc1) + base64Key.charAt(enc2) + base64Key.charAt(enc3) + base64Key.charAt(enc4);\n\t\t\tcount -= 3;\n\t\t}\n\t\t// pad\n\t\tif (count == 2) {\n\t\t\tb0 = getUnsignedByteFunc.apply(self);\n\t\t\tb1 = getUnsignedByteFunc.apply(self);\n\t\t\tenc1 = b0 >> 2;\n\t\t\tenc2 = ((b0 & 3) << 4) | (b1 >> 4);\n\t\t\tenc3 = ((b1 & 15) << 2);\n\t\t\tr += base64Key.charAt(enc1) + base64Key.charAt(enc2) + base64Key.charAt(enc3) + \"=\";\n\t\t} else if (count == 1) {\n\t\t\tb0 = getUnsignedByteFunc.apply(self);\n\t\t\tenc1 = b0 >> 2;\n\t\t\tenc2 = ((b0 & 3) << 4);\n\t\t\tr += base64Key.charAt(enc1) + base64Key.charAt(enc2) + \"==\";\n\t\t}\n\t\treturn r;\n\t}\n}\n\nexport = ByteArrayBase;","import ByteArrayBase\t\t\t= require(\"awayjs-core/lib/utils/ByteArrayBase\");\n\nclass ByteArrayBuffer extends ByteArrayBase\n{\n\n\t/*\n\t public maxlength:number = 0;\n\t public arraybytes; //ArrayBuffer\n\t public unalignedarraybytestemp; //ArrayBuffer\n\t */\n\n\tpublic _bytes:number[];\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._bytes = [];\n\t\tthis._mode = \"Array\";\n\t}\n\n\tpublic writeByte(b:number)\n\t{\n\t\tvar bi:number = ~~b;\n\t\tthis._bytes[ this.position++ ] = bi;\n\t\tif (this.position > this.length) {\n\t\t\tthis.length = this.position;\n\t\t}\n\t}\n\n\tpublic readByte():number\n\t{\n\t\tif (this.position >= this.length) {\n\t\t\tthrow \"ByteArray out of bounds read. Position=\" + this.position + \", Length=\" + this.length;\n\t\t}\n\t\treturn this._bytes[ this.position++ ];\n\t}\n\n\tpublic writeUnsignedByte(b:number)\n\t{\n\t\tvar bi:number = ~~b;\n\t\tthis._bytes[this.position++] = bi & 0xff;\n\t\tif (this.position > this.length) {\n\t\t\tthis.length = this.position;\n\t\t}\n\t}\n\n\tpublic readUnsignedByte():number\n\t{\n\t\tif (this.position >= this.length) {\n\t\t\tthrow \"ByteArray out of bounds read. Position=\" + this.position + \", Length=\" + this.length;\n\t\t}\n\t\treturn this._bytes[ this.position++ ];\n\t}\n\n\tpublic writeUnsignedShort(b:number)\n\t{\n\t\tvar bi:number = ~~b;\n\t\tthis._bytes[ this.position++ ] = bi & 0xff;\n\t\tthis._bytes[ this.position++ ] = (bi >> 8) & 0xff;\n\t\tif (this.position > this.length) {\n\t\t\tthis.length = this.position;\n\t\t}\n\t}\n\n\tpublic readUnsignedShort():number\n\t{\n\t\tif (this.position + 2 > this.length) {\n\t\t\tthrow \"ByteArray out of bounds read. Position=\" + this.position + \", Length=\" + this.length;\n\t\t}\n\t\tvar r:number = this._bytes[ this.position ] | ( this._bytes[ this.position + 1 ] << 8 );\n\t\tthis.position += 2;\n\t\treturn r;\n\t}\n\n\tpublic writeUnsignedInt(b:number)\n\t{\n\t\tvar bi:number = ~~b;\n\t\tthis._bytes[ this.position++ ] = bi & 0xff;\n\t\tthis._bytes[ this.position++ ] = (bi >>> 8) & 0xff;\n\t\tthis._bytes[ this.position++ ] = (bi >>> 16) & 0xff;\n\t\tthis._bytes[ this.position++ ] = (bi >>> 24) & 0xff;\n\t\tif (this.position > this.length) {\n\t\t\tthis.length = this.position;\n\t\t}\n\t}\n\n\tpublic readUnsignedInt():number\n\t{\n\t\tif (this.position + 4 > this.length) {\n\t\t\tthrow \"ByteArray out of bounds read. Position=\" + this.position + \", Length=\" + this.length;\n\t\t}\n\t\tvar r:number = this._bytes[ this.position ] | ( this._bytes[this.position + 1] << 8 ) | ( this._bytes[this.position + 2] << 16 ) | ( this._bytes[this.position + 3] << 24 );\n\t\tthis.position += 4;\n\t\treturn r >>> 0;\n\t}\n\n\tpublic writeFloat(b:number)\n\t{\n\t\t// this is crazy slow and silly, but as a fallback...\n\n\t\tthis.writeUnsignedInt(this.toFloatBits(Number(b)));\n\t}\n\n\tpublic toFloatBits(x:number)\n\t{\n\t\t// don't handle inf/nan yet\n\t\t// special case zero\n\t\tif (x == 0) {\n\t\t\treturn 0;\n\t\t}\n\t\t// remove the sign, after this we only deal with positive numbers\n\t\tvar sign:number = 0;\n\t\tif (x < 0) {\n\t\t\tx = -x;\n\t\t\tsign = 1;\n\t\t} else {\n\t\t\tsign = 0;\n\t\t}\n\t\t// a float value is now defined as: x = (1+(mantissa*2^-23))*(2^(exponent-127))\n\t\tvar exponent:number = Math.log(x)/Math.log(2);  // rough exponent\n\t\texponent = Math.floor(exponent);\n\t\tx = x*Math.pow(2, 23 - exponent);             // normalize to 24 bits\n\t\tvar mantissa = Math.floor(x) - 0x800000;\n\t\texponent = exponent + 127;\n\t\treturn( ( sign << 31 ) >>> 0) | ( exponent << 23 ) | mantissa;\n\t}\n\n\tpublic readFloat(b:number)\n\t{\n\t\treturn this.fromFloatBits(this.readUnsignedInt());\n\t}\n\n\tpublic fromFloatBits(x:number)\n\t{\n\t\tif (x == 0) {\n\t\t\treturn 0;\n\t\t}\n\t\tvar exponent:number = ( x >>> 23 ) & 0xff;\n\t\tvar mantissa:number = ( x & 0x7fffff ) | 0x800000;\n\t\tvar y = Math.pow(2, ( exponent - 127 ) - 23)*mantissa;\n\t\tif (x >>> 31 != 0) {\n\t\t\ty = -y;\n\t\t}\n\t\treturn y;\n\t}\n\n\t/*\n\t public ensureWriteableSpace( n:number )\n\t {\n\t this.ensureSpace( n + this.position );\n\t }\n\n\t private ensureSpace( n:number )\n\t {\n\t if ( n > this.maxlength ) {\n\t var newmaxlength:number = (n+255)&(~255);\n\t var newarraybuffer = new ArrayBuffer(newmaxlength);\n\t var view = new Uint8Array(this.arraybytes, 0, this.length);\n\t var newview = new Uint8Array(newarraybuffer, 0, this.length);\n\t newview.set(view);      // memcpy\n\t this.arraybytes = newarraybuffer;\n\t this.maxlength = newmaxlength;\n\t }\n\t }\n\t */\n}\n\nexport = ByteArrayBuffer;","import ByteArrayBase\t\t\t= require(\"awayjs-core/lib/utils/ByteArrayBase\");\n\nclass ByteArray extends ByteArrayBase\n{\n\tpublic maxlength:number = 0;\n\tpublic arraybytes; //ArrayBuffer\n\tpublic unalignedarraybytestemp; //ArrayBuffer\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis._mode = \"Typed array\";\n\t\tthis.maxlength = 4;\n\t\tthis.arraybytes = new ArrayBuffer(this.maxlength);\n\t\tthis.unalignedarraybytestemp = new ArrayBuffer(16);\n\t}\n\n\tpublic ensureWriteableSpace(n:number)\n\t{\n\t\tthis.ensureSpace(n + this.position);\n\t}\n\n\tpublic setArrayBuffer(aBuffer:ArrayBuffer):void\n\t{\n\n\t\tthis.ensureSpace(aBuffer.byteLength);\n\n\t\tthis.length = aBuffer.byteLength;\n\n\t\tvar inInt8AView:Int8Array = new Int8Array(aBuffer);\n\t\tvar localInt8View:Int8Array = new Int8Array(this.arraybytes, 0, this.length);\n\n\t\tlocalInt8View.set(inInt8AView);\n\n\t\tthis.position = 0;\n\n\t}\n\n\tpublic getBytesAvailable():number\n\t{\n\t\treturn ( this.length ) - ( this.position );\n\t}\n\n\tpublic ensureSpace(n:number)\n\t{\n\t\tif (n > this.maxlength) {\n\t\t\tvar newmaxlength:number = (n + 255) & (~255);\n\t\t\tvar newarraybuffer = new ArrayBuffer(newmaxlength);\n\t\t\tvar view = new Uint8Array(this.arraybytes, 0, this.length);\n\t\t\tvar newview = new Uint8Array(newarraybuffer, 0, this.length);\n\t\t\tnewview.set(view);      // memcpy\n\t\t\tthis.arraybytes = newarraybuffer;\n\t\t\tthis.maxlength = newmaxlength;\n\t\t}\n\t}\n\n\tpublic writeByte(b:number)\n\t{\n\t\tthis.ensureWriteableSpace(1);\n\t\tvar view = new Int8Array(this.arraybytes);\n\t\tview[ this.position++ ] = (~~b); // ~~ is cast to int in js...\n\t\tif (this.position > this.length) {\n\t\t\tthis.length = this.position;\n\t\t}\n\t}\n\n\tpublic readByte()\n\t{\n\t\tif (this.position >= this.length) {\n\t\t\tthrow \"ByteArray out of bounds read. Positon=\" + this.position + \", Length=\" + this.length;\n\t\t}\n\t\tvar view = new Int8Array(this.arraybytes);\n\n\t\treturn view[ this.position++ ];\n\t}\n\n\tpublic readBytes(bytes:ByteArray, offset:number = 0, length:number = 0)\n\t{\n\n\t\tif (length == null) {\n\t\t\tlength = bytes.length;\n\t\t}\n\n\t\tbytes.ensureWriteableSpace(offset + length);\n\n\t\tvar byteView:Int8Array = new Int8Array(bytes.arraybytes);\n\t\tvar localByteView:Int8Array = new Int8Array(this.arraybytes);\n\n\t\tbyteView.set(localByteView.subarray(this.position, this.position + length), offset);\n\n\t\tthis.position += length;\n\n\t\tif (length + offset > bytes.length) {\n\t\t\tbytes.length += ( length + offset ) - bytes.length;\n\t\t}\n\n\t}\n\n\tpublic writeUnsignedByte(b:number)\n\t{\n\t\tthis.ensureWriteableSpace(1);\n\t\tvar view = new Uint8Array(this.arraybytes);\n\t\tview[this.position++] = (~~b) & 0xff; // ~~ is cast to int in js...\n\t\tif (this.position > this.length) {\n\t\t\tthis.length = this.position;\n\t\t}\n\t}\n\n\tpublic readUnsignedByte()\n\t{\n\t\tif (this.position >= this.length) {\n\t\t\tthrow \"ByteArray out of bounds read. Positon=\" + this.position + \", Length=\" + this.length;\n\t\t}\n\t\tvar view = new Uint8Array(this.arraybytes);\n\t\treturn view[this.position++];\n\t}\n\n\tpublic writeUnsignedShort(b:number)\n\t{\n\t\tthis.ensureWriteableSpace(2);\n\t\tif (( this.position & 1 ) == 0) {\n\t\t\tvar view = new Uint16Array(this.arraybytes);\n\t\t\tview[ this.position >> 1 ] = (~~b) & 0xffff; // ~~ is cast to int in js...\n\t\t} else {\n\t\t\tvar view = new Uint16Array(this.unalignedarraybytestemp, 0, 1);\n\t\t\tview[0] = (~~b) & 0xffff;\n\t\t\tvar view2 = new Uint8Array(this.arraybytes, this.position, 2);\n\t\t\tvar view3 = new Uint8Array(this.unalignedarraybytestemp, 0, 2);\n\t\t\tview2.set(view3);\n\t\t}\n\t\tthis.position += 2;\n\t\tif (this.position > this.length) {\n\t\t\tthis.length = this.position;\n\t\t}\n\t}\n\n\tpublic readUTFBytes(len:number):string\n\t{\n\n\t\tvar value:string = \"\";\n\t\tvar max:number = this.position + len;\n\t\tvar data:DataView = new DataView(this.arraybytes);\n\n\t\t// utf8-encode\n\t\twhile (this.position < max) {\n\n\t\t\tvar c:number = data.getUint8(this.position++);\n\n\t\t\tif (c < 0x80) {\n\n\t\t\t\tif (c == 0) break;\n\t\t\t\tvalue += String.fromCharCode(c);\n\n\t\t\t} else if (c < 0xE0) {\n\n\t\t\t\tvalue += String.fromCharCode(((c & 0x3F) << 6) | (data.getUint8(this.position++) & 0x7F));\n\n\t\t\t} else if (c < 0xF0) {\n\n\t\t\t\tvar c2 = data.getUint8(this.position++);\n\t\t\t\tvalue += String.fromCharCode(((c & 0x1F) << 12) | ((c2 & 0x7F) << 6) | (data.getUint8(this.position++) & 0x7F));\n\n\t\t\t} else {\n\n\t\t\t\tvar c2 = data.getUint8(this.position++);\n\t\t\t\tvar c3 = data.getUint8(this.position++);\n\n\t\t\t\tvalue += String.fromCharCode(((c & 0x0F) << 18) | ((c2 & 0x7F) << 12) | ((c3 << 6) & 0x7F) | (data.getUint8(this.position++) & 0x7F));\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn value;\n\n\t}\n\n\tpublic readInt():number\n\t{\n\n\t\tvar data:DataView = new DataView(this.arraybytes);\n\t\tvar int:number = data.getInt32(this.position, true);\n\n\t\tthis.position += 4;\n\n\t\treturn int;\n\n\t}\n\n\tpublic readShort():number\n\t{\n\n\t\tvar data:DataView = new DataView(this.arraybytes);\n\t\tvar short:number = data.getInt16(this.position, true);\n\n\t\tthis.position += 2;\n\t\treturn short;\n\n\t}\n\n\tpublic readDouble():number\n\t{\n\t\tvar data:DataView = new DataView(this.arraybytes);\n\t\tvar double:number = data.getFloat64(this.position, true);\n\n\t\tthis.position += 8;\n\t\treturn double;\n\n\t}\n\n\tpublic readUnsignedShort()\n\t{\n\t\tif (this.position > this.length + 2) {\n\t\t\tthrow \"ByteArray out of bounds read. Position=\" + this.position + \", Length=\" + this.length;\n\t\t}\n\t\tif (( this.position & 1 ) == 0) {\n\t\t\tvar view = new Uint16Array(this.arraybytes);\n\t\t\tvar pa:number = this.position >> 1;\n\t\t\tthis.position += 2;\n\t\t\treturn view[ pa ];\n\t\t} else {\n\t\t\tvar view = new Uint16Array(this.unalignedarraybytestemp, 0, 1);\n\t\t\tvar view2 = new Uint8Array(this.arraybytes, this.position, 2);\n\t\t\tvar view3 = new Uint8Array(this.unalignedarraybytestemp, 0, 2);\n\t\t\tview3.set(view2);\n\t\t\tthis.position += 2;\n\t\t\treturn view[0];\n\t\t}\n\t}\n\n\tpublic writeUnsignedInt(b:number)\n\t{\n\t\tthis.ensureWriteableSpace(4);\n\t\tif (( this.position & 3 ) == 0) {\n\t\t\tvar view = new Uint32Array(this.arraybytes);\n\t\t\tview[ this.position >> 2 ] = (~~b) & 0xffffffff; // ~~ is cast to int in js...\n\t\t} else {\n\t\t\tvar view = new Uint32Array(this.unalignedarraybytestemp, 0, 1);\n\t\t\tview[0] = (~~b) & 0xffffffff;\n\t\t\tvar view2 = new Uint8Array(this.arraybytes, this.position, 4);\n\t\t\tvar view3 = new Uint8Array(this.unalignedarraybytestemp, 0, 4);\n\t\t\tview2.set(view3);\n\t\t}\n\t\tthis.position += 4;\n\t\tif (this.position > this.length) {\n\t\t\tthis.length = this.position;\n\t\t}\n\t}\n\n\tpublic readUnsignedInt()\n\t{\n\n\t\tif (this.position > this.length + 4) {\n\t\t\tthrow \"ByteArray out of bounds read. Position=\" + this.position + \", Length=\" + this.length;\n\t\t}\n\t\tif (( this.position & 3 ) == 0) {\n\t\t\tvar view = new Uint32Array(this.arraybytes);\n\t\t\tvar pa:number = this.position >> 2;\n\t\t\tthis.position += 4;\n\t\t\treturn view[ pa ];\n\t\t} else {\n\t\t\tvar view = new Uint32Array(this.unalignedarraybytestemp, 0, 1);\n\t\t\tvar view2 = new Uint8Array(this.arraybytes, this.position, 4);\n\t\t\tvar view3 = new Uint8Array(this.unalignedarraybytestemp, 0, 4);\n\t\t\tview3.set(view2);\n\t\t\tthis.position += 4;\n\t\t\treturn view[0];\n\t\t}\n\t}\n\n\tpublic writeFloat(b:number)\n\t{\n\t\tthis.ensureWriteableSpace(4);\n\t\tif (( this.position & 3 ) == 0) {\n\t\t\tvar view = new Float32Array(this.arraybytes);\n\t\t\tview[ this.position >> 2 ] = b;\n\t\t} else {\n\t\t\tvar view = new Float32Array(this.unalignedarraybytestemp, 0, 1);\n\t\t\tview[0] = b;\n\t\t\tvar view2 = new Uint8Array(this.arraybytes, this.position, 4);\n\t\t\tvar view3 = new Uint8Array(this.unalignedarraybytestemp, 0, 4);\n\t\t\tview2.set(view3);\n\t\t}\n\t\tthis.position += 4;\n\t\tif (this.position > this.length) {\n\t\t\tthis.length = this.position;\n\t\t}\n\t}\n\n\tpublic readFloat()\n\t{\n\t\tif (this.position > this.length + 4) {\n\t\t\tthrow \"ByteArray out of bounds read. Positon=\" + this.position + \", Length=\" + this.length;\n\t\t}\n\t\tif ((this.position & 3) == 0) {\n\t\t\tvar view = new Float32Array(this.arraybytes);\n\t\t\tvar pa = this.position >> 2;\n\t\t\tthis.position += 4;\n\t\t\treturn view[pa];\n\t\t} else {\n\t\t\tvar view = new Float32Array(this.unalignedarraybytestemp, 0, 1);\n\t\t\tvar view2 = new Uint8Array(this.arraybytes, this.position, 4);\n\t\t\tvar view3 = new Uint8Array(this.unalignedarraybytestemp, 0, 4);\n\t\t\tview3.set(view2);\n\t\t\tthis.position += 4;\n\t\t\treturn view[ 0 ];\n\t\t}\n\t}\n}\n\nexport = ByteArray;","class CSS\n{\n\tpublic static setElementSize(element:HTMLElement, width:number, height:number)\n\t{\n\t\telement.style.width = width + \"px\";\n\t\telement.style.height = height + \"px\";\n\t\telement[\"width\"] = width;\n\t\telement[\"height\"] = height;\n\t}\n\n\tpublic static setElementWidth(element:HTMLElement, width:number)\n\t{\n\t\telement.style.width = width + \"px\";\n\t\telement[\"width\"] = width;\n\t}\n\n\tpublic static setElementHeight(element:HTMLElement, height:number)\n\t{\n\t\telement.style.height = height + \"px\";\n\t\telement[\"height\"] = height;\n\t}\n\n\tpublic static setElementX(element:HTMLElement, x:number)\n\t{\n\t\telement.style.position = 'absolute';\n\t\telement.style.left = x + \"px\";\n\t}\n\n\tpublic static setElementY(element:HTMLElement, y:number)\n\t{\n\t\telement.style.position = 'absolute';\n\t\telement.style.top = y + \"px\";\n\t}\n\n\tpublic static getElementVisibility(element:HTMLElement):boolean\n\t{\n\t\treturn element.style.visibility == 'visible';\n\t}\n\n\tpublic static setElementVisibility(element:HTMLElement, visible:boolean)\n\t{\n\t\tif (visible) {\n\t\t\telement.style.visibility = 'visible';\n\t\t} else {\n\t\t\telement.style.visibility = 'hidden';\n\t\t}\n\t}\n\n\tpublic static setElementAlpha(element:HTMLElement, alpha:number)\n\t{\n\t\tif (element instanceof HTMLCanvasElement) {\n\t\t\tvar context = (<HTMLCanvasElement> element).getContext(\"2d\");\n\t\t\tcontext.globalAlpha = alpha;\n\t\t}\n\t}\n\n\tpublic static setElementPosition(element:HTMLElement, x:number, y:number, absolute:boolean = false)\n\t{\n\t\tif (absolute) {\n\t\t\telement.style.position = \"absolute\";\n\t\t} else {\n\t\t\telement.style.position = \"relative\";\n\t\t}\n\n\t\telement.style.left = x + \"px\";\n\t\telement.style.top = y + \"px\";\n\t}\n}\n\nexport = CSS;","/**\n *\n */\nclass ColorUtils\n{\n\tpublic static float32ColorToARGB(float32Color:number):number[]\n\t{\n\t\tvar a:number = ( float32Color & 0xff000000 ) >>> 24\n\t\tvar r:number = ( float32Color & 0xff0000 ) >>> 16;\n\t\tvar g:number = ( float32Color & 0xff00 ) >>> 8;\n\t\tvar b:number = float32Color & 0xff;\n\t\tvar result:number[] = [ a, r , g , b ];\n\n\t\treturn result;\n\t}\n\n\tprivate static componentToHex(c:number):string\n\t{\n\t\tvar hex = c.toString(16);\n\t\treturn hex.length == 1? \"0\" + hex : hex;\n\t}\n\n\tpublic static RGBToHexString(argb:number[]):string\n\t{\n\t\treturn \"#\" + ColorUtils.componentToHex(argb[1]) + ColorUtils.componentToHex(argb[2]) + ColorUtils.componentToHex(argb[3]);\n\t}\n\n\tpublic static ARGBToHexString(argb:number[]):string\n\t{\n\t\treturn \"#\" + ColorUtils.componentToHex(argb[0]) + ColorUtils.componentToHex(argb[1]) + ColorUtils.componentToHex(argb[2]) + ColorUtils.componentToHex(argb[3]);\n\t}\n}\n\nexport = ColorUtils;","import PartialImplementationError\t= require(\"awayjs-core/lib/errors/PartialImplementationError\");\n\n/**\n *\n */\nclass Debug\n{\n\tpublic static THROW_ERRORS:boolean = true;\n\tpublic static ENABLE_LOG:boolean = true;\n\tpublic static LOG_PI_ERRORS:boolean = true;\n\n\tprivate static keyword:string = null;\n\n\tpublic static breakpoint():void\n\t{\n\t\tDebug['break']();\n\t}\n\n\tpublic static throwPIROnKeyWordOnly(str:string, enable:boolean = true)\n\t{\n\t\tif (!enable)\n\t\t\tDebug.keyword = null;\n\t\telse\n\t\t\tDebug.keyword = str;\n\t}\n\n\tpublic static throwPIR(clss:string, fnc:string, msg:string)\n\t{\n\t\tDebug.logPIR('PartialImplementationError ' + clss, fnc, msg);\n\n\t\tif (Debug.THROW_ERRORS) {\n\t\t\tif (Debug.keyword) {\n\t\t\t\tvar e:string = clss + fnc + msg;\n\n\t\t\t\tif (e.indexOf(Debug.keyword) == -1)\n\t\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthrow new PartialImplementationError(clss + '.' + fnc + ': ' + msg);\n\t\t}\n\t}\n\n\tprivate static logPIR(clss:string, fnc:string, msg:string = '')\n\t{\n\t\tif (Debug.LOG_PI_ERRORS)\n\t\t\tconsole.log(clss + '.' + fnc + ': ' + msg);\n\t}\n\n\tpublic static log(...args:any[])\n\t{\n\t\tif (Debug.ENABLE_LOG)\n\t\t\tconsole.log(args);\n\t}\n}\n\nexport = Debug;","import getTimer\t\t\t\t\t= require(\"awayjs-core/lib/utils/getTimer\");\n\nclass RequestAnimationFrame\n{\n\tprivate _callback:Function;\n\tprivate _callbackContext:Object;\n\tprivate _active:boolean = false;\n\tprivate _rafUpdateFunction:any;\n\tprivate _prevTime:number;\n\tprivate _dt:number;\n\tprivate _currentTime:number;\n\tprivate _argsArray:Array<any> = new Array();\n\tprivate _getTimer:Function;\n\n\tconstructor(callback:Function, callbackContext:Object)\n\t{\n\t\tthis._getTimer = getTimer;\n\n\t\tthis.setCallback(callback, callbackContext);\n\n\t\tthis._rafUpdateFunction = () => {\n\t\t\tif (this._active)\n\t\t\t\tthis._tick();\n\t\t}\n\n\t\tthis._argsArray.push(this._dt);\n\t}\n\n\t// Public\n\n\t/**\n\t *\n\t * @param callback\n\t * @param callbackContext\n\t */\n\tpublic setCallback(callback:Function, callbackContext:Object)\n\t{\n\t\tthis._callback = callback;\n\t\tthis._callbackContext = callbackContext;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic start()\n\t{\n\t\tthis._prevTime = this._getTimer();\n\t\tthis._active = true;\n\n\t\tif (window.requestAnimationFrame) {\n\t\t\twindow.requestAnimationFrame(this._rafUpdateFunction);\n\t\t} else {\n\t\t\tif (window['mozRequestAnimationFrame'])\n\t\t\t\twindow.requestAnimationFrame = window['mozRequestAnimationFrame'];\n\t\t\telse if (window['webkitRequestAnimationFrame'])\n\t\t\t\twindow.requestAnimationFrame = window['webkitRequestAnimationFrame'];\n\t\t\telse if (window['oRequestAnimationFrame'])\n\t\t\t\twindow.requestAnimationFrame = window['oRequestAnimationFrame'];\n\t\t}\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic stop()\n\t{\n\t\tthis._active = false;\n\t}\n\n\t// Get / Set\n\n\t/**\n\t *\n\t * @returns {boolean}\n\t */\n\tpublic get active():boolean\n\t{\n\t\treturn this._active;\n\t}\n\n\t// Private\n\n\t/**\n\t *\n\t * @private\n\t */\n\tprivate _tick():void\n\t{\n\t\tthis._currentTime = this._getTimer();\n\t\tthis._dt = this._currentTime - this._prevTime;\n\t\tthis._argsArray[0] = this._dt;\n\t\tthis._callback.apply(this._callbackContext, this._argsArray);\n\n\t\twindow.requestAnimationFrame(this._rafUpdateFunction);\n\n\t\tthis._prevTime = this._currentTime;\n\t}\n\n\n}\n\nexport = RequestAnimationFrame;","import BitmapData\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\n\nclass TextureUtils\n{\n\tprivate static MAX_SIZE:number = 2048;\n\n\tpublic static isBitmapDataValid(bitmapData:BitmapData):boolean\n\t{\n\t\tif (bitmapData == null) {\n\n\t\t\treturn true;\n\n\t\t}\n\n\t\treturn TextureUtils.isDimensionValid(bitmapData.width) && TextureUtils.isDimensionValid(bitmapData.height);\n\n\t}\n\n\tpublic static isHTMLImageElementValid(image:HTMLImageElement):boolean\n\t{\n\t\tif (image == null)\n\t\t\treturn true;\n\n\t\treturn TextureUtils.isDimensionValid(image.width) && TextureUtils.isDimensionValid(image.height);\n\n\t}\n\n\tpublic static isDimensionValid(d:number):boolean\n\t{\n\n\t\treturn d >= 1 && d <= TextureUtils.MAX_SIZE && TextureUtils.isPowerOfTwo(d);\n\n\t}\n\n\tpublic static isPowerOfTwo(value:number):boolean\n\t{\n\n\t\treturn value? ( ( value & -value ) == value ) : false;\n\n\t}\n\n\tpublic static getBestPowerOf2(value:number):number\n\t{\n\t\tvar p:number = 1;\n\n\t\twhile (p < value)\n\t\t\tp <<= 1;\n\n\t\tif (p > TextureUtils.MAX_SIZE)\n\t\t\tp = TextureUtils.MAX_SIZE;\n\n\t\treturn p;\n\t}\n}\n\nexport = TextureUtils","import Error\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\nimport TimerEvent\t\t\t\t= require(\"awayjs-core/lib/events/TimerEvent\");\n\nclass Timer extends EventDispatcher\n{\n\n\tprivate _delay:number;\n\tprivate _repeatCount:number = 0;\n\tprivate _currentCount:number = 0;\n\tprivate _iid:number;\n\tprivate _running:boolean = false;\n\n\tconstructor(delay:number, repeatCount:number = 0)\n\t{\n\n\t\tsuper();\n\n\n\t\tthis._delay = delay;\n\t\tthis._repeatCount = repeatCount;\n\n\t\tif (isNaN(delay) || delay < 0) {\n\t\t\tthrow new Error(\"Delay is negative or not a number\");\n\t\t}\n\n\t}\n\n\tpublic get currentCount():number\n\t{\n\n\t\treturn this._currentCount;\n\n\t}\n\n\tpublic get delay():number\n\t{\n\n\t\treturn this._delay;\n\n\t}\n\n\tpublic set delay(value:number)\n\t{\n\n\t\tthis._delay = value;\n\n\t\tif (this._running) {\n\t\t\tthis.stop();\n\t\t\tthis.start();\n\t\t}\n\n\t}\n\n\tpublic get repeatCount():number\n\t{\n\n\t\treturn this._repeatCount;\n\t}\n\n\tpublic set repeatCount(value:number)\n\t{\n\n\t\tthis._repeatCount = value;\n\t}\n\n\tpublic reset():void\n\t{\n\n\t\tif (this._running) {\n\t\t\tthis.stop();\n\t\t}\n\n\t\tthis._currentCount = 0;\n\n\t}\n\n\tpublic get running():boolean\n\t{\n\n\t\treturn this._running;\n\n\t}\n\n\tpublic start():void\n\t{\n\n\t\tthis._running = true;\n\t\tclearInterval(this._iid);\n\t\tthis._iid = setInterval(() => this.tick(), this._delay);\n\n\t}\n\n\tpublic stop():void\n\t{\n\n\t\tthis._running = false;\n\t\tclearInterval(this._iid);\n\n\t}\n\n\tprivate tick():void\n\t{\n\n\t\tthis._currentCount++;\n\n\t\tif (( this._repeatCount > 0 ) && this._currentCount >= this._repeatCount) {\n\n\t\t\tthis.stop();\n\t\t\tthis.dispatchEvent(new TimerEvent(TimerEvent.TIMER));\n\t\t\tthis.dispatchEvent(new TimerEvent(TimerEvent.TIMER_COMPLETE));\n\n\t\t} else {\n\n\t\t\tthis.dispatchEvent(new TimerEvent(TimerEvent.TIMER));\n\n\t\t}\n\n\t}\n}\n\nexport = Timer;","/**\n *\n *\n * @returns {number}\n */\nfunction getTimer():number\n{\n\t// number milliseconds of 1970/01/01\n\t// this different to AS3 implementation which gets the number of milliseconds\n\t// since instance of Flash player was initialised\n\treturn Date.now();\n}\n\nexport = getTimer;","import AssetType\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport NamedAssetBase\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\n\n/**\n * Provides an abstract base class for nodes in an animation blend tree.\n */\nclass AnimationNodeBase extends NamedAssetBase implements IAsset\n{\n\tpublic _pStateClass:any;\n\n\tpublic get stateClass():any\n\t{\n\t\treturn this._pStateClass;\n\t}\n\n\t/**\n\t * Creates a new <code>AnimationNodeBase</code> object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.ANIMATION_NODE;\n\t}\n}\n\nexport = AnimationNodeBase;","/**\n *\n */\nclass AlignmentMode\n{\n\t/**\n\t *\n\t */\n\tpublic static REGISTRATION_POINT:string = \"registrationPoint\";\n\n\t/**\n\t *\n\t */\n\tpublic static PIVOT_POINT:string = \"pivot\";\n}\n\nexport = AlignmentMode;","/**\n * The CapsStyle class is an enumeration of constant values that specify the\n * caps style to use in drawing lines. The constants are provided for use as\n * values in the <code>caps</code> parameter of the\n * <code>flash.display.Graphics.lineStyle()</code> method. You can specify the\n * following three types of caps:\n */\nclass CapsStyle\n{\n\t/**\n\t * Used to specify round caps in the <code>caps</code> parameter of the\n\t * <code>flash.display.Graphics.lineStyle()</code> method.\n\t */\n\tpublic static ROUND:string = \"round\";\n\n\t/**\n\t * Used to specify no caps in the <code>caps</code> parameter of the\n\t * <code>flash.display.Graphics.lineStyle()</code> method.\n\t */\n\tpublic static NONE:string = \"none\";\n\n\t/**\n\t * Used to specify square caps in the <code>caps</code> parameter of the\n\t * <code>flash.display.Graphics.lineStyle()</code> method.\n\t */\n\tpublic static SQUARE:string = \"square\";\n}\n\nexport = CapsStyle;","import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\nimport Box\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Box\");\nimport Sphere\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Sphere\");\nimport MathConsts\t\t\t\t\t= require(\"awayjs-core/lib/geom/MathConsts\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\nimport Point\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport NamedAssetBase\t\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nimport DisplayObjectContainer\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\nimport Scene\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/Scene\");\nimport ControllerBase\t\t\t\t= require(\"awayjs-display/lib/controllers/ControllerBase\");\nimport AlignmentMode\t\t\t\t= require(\"awayjs-display/lib/base/AlignmentMode\");\nimport LoaderInfo\t\t\t\t\t= require(\"awayjs-display/lib/base/LoaderInfo\");\nimport OrientationMode\t\t\t\t= require(\"awayjs-display/lib/base/OrientationMode\");\nimport IBitmapDrawable\t\t\t\t= require(\"awayjs-display/lib/base/IBitmapDrawable\");\nimport Transform\t\t\t\t\t= require(\"awayjs-display/lib/base/Transform\");\nimport EntityNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/EntityNode\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport IPickingCollider\t\t\t\t= require(\"awayjs-display/lib/pick/IPickingCollider\");\nimport PickingCollisionVO\t\t\t= require(\"awayjs-display/lib/pick/PickingCollisionVO\");\nimport IRenderable\t\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderable\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport DisplayObjectEvent\t\t\t= require(\"awayjs-display/lib/events/DisplayObjectEvent\");\nimport SceneEvent\t\t\t\t\t= require(\"awayjs-display/lib/events/SceneEvent\");\nimport PrefabBase\t\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrefabBase\");\n\n/**\n * The DisplayObject class is the base class for all objects that can be\n * placed on the display list. The display list manages all objects displayed\n * in flash. Use the DisplayObjectContainer class to arrange the\n * display objects in the display list. DisplayObjectContainer objects can\n * have child display objects, while other display objects, such as Shape and\n * TextField objects, are \"leaf\" nodes that have only parents and siblings, no\n * children.\n *\n * <p>The DisplayObject class supports basic functionality like the <i>x</i>\n * and <i>y</i> position of an object, as well as more advanced properties of\n * the object such as its transformation matrix. </p>\n *\n * <p>DisplayObject is an abstract base class; therefore, you cannot call\n * DisplayObject directly. Invoking <code>new DisplayObject()</code> throws an\n * <code>ArgumentError</code> exception. </p>\n *\n * <p>All display objects inherit from the DisplayObject class.</p>\n *\n * <p>The DisplayObject class itself does not include any APIs for rendering\n * content onscreen. For that reason, if you want create a custom subclass of\n * the DisplayObject class, you will want to extend one of its subclasses that\n * do have APIs for rendering content onscreen, such as the Shape, Sprite,\n * Bitmap, SimpleButton, TextField, or MovieClip class.</p>\n *\n * <p>The DisplayObject class contains several broadcast events. Normally, the\n * target of any particular event is a specific DisplayObject instance. For\n * example, the target of an <code>added</code> event is the specific\n * DisplayObject instance that was added to the display list. Having a single\n * target restricts the placement of event listeners to that target and in\n * some cases the target's ancestors on the display list. With broadcast\n * events, however, the target is not a specific DisplayObject instance, but\n * rather all DisplayObject instances, including those that are not on the\n * display list. This means that you can add a listener to any DisplayObject\n * instance to listen for broadcast events. In addition to the broadcast\n * events listed in the DisplayObject class's Events table, the DisplayObject\n * class also inherits two broadcast events from the EventDispatcher class:\n * <code>activate</code> and <code>deactivate</code>.</p>\n *\n * <p>Some properties previously used in the ActionScript 1.0 and 2.0\n * MovieClip, TextField, and Button classes(such as <code>_alpha</code>,\n * <code>_height</code>, <code>_name</code>, <code>_width</code>,\n * <code>_x</code>, <code>_y</code>, and others) have equivalents in the\n * ActionScript 3.0 DisplayObject class that are renamed so that they no\n * longer begin with the underscore(_) character.</p>\n *\n * <p>For more information, see the \"Display Programming\" chapter of the\n * <i>ActionScript 3.0 Developer's Guide</i>.</p>\n * \n * @event added            Dispatched when a display object is added to the\n *                         display list. The following methods trigger this\n *                         event:\n *                         <code>DisplayObjectContainer.addChild()</code>,\n *                         <code>DisplayObjectContainer.addChildAt()</code>.\n * @event addedToScene     Dispatched when a display object is added to the on\n *                         scene display list, either directly or through the\n *                         addition of a sub tree in which the display object\n *                         is contained. The following methods trigger this\n *                         event:\n *                         <code>DisplayObjectContainer.addChild()</code>,\n *                         <code>DisplayObjectContainer.addChildAt()</code>.\n * @event enterFrame       [broadcast event] Dispatched when the playhead is\n *                         entering a new frame. If the playhead is not\n *                         moving, or if there is only one frame, this event\n *                         is dispatched continuously in conjunction with the\n *                         frame rate. This event is a broadcast event, which\n *                         means that it is dispatched by all display objects\n *                         with a listener registered for this event.\n * @event exitFrame        [broadcast event] Dispatched when the playhead is\n *                         exiting the current frame. All frame scripts have\n *                         been run. If the playhead is not moving, or if\n *                         there is only one frame, this event is dispatched\n *                         continuously in conjunction with the frame rate.\n *                         This event is a broadcast event, which means that\n *                         it is dispatched by all display objects with a\n *                         listener registered for this event.\n * @event frameConstructed [broadcast event] Dispatched after the constructors\n *                         of frame display objects have run but before frame\n *                         scripts have run. If the playhead is not moving, or\n *                         if there is only one frame, this event is\n *                         dispatched continuously in conjunction with the\n *                         frame rate. This event is a broadcast event, which\n *                         means that it is dispatched by all display objects\n *                         with a listener registered for this event.\n * @event removed          Dispatched when a display object is about to be\n *                         removed from the display list. Two methods of the\n *                         DisplayObjectContainer class generate this event:\n *                         <code>removeChild()</code> and\n *                         <code>removeChildAt()</code>.\n *\n *                         <p>The following methods of a\n *                         DisplayObjectContainer object also generate this\n *                         event if an object must be removed to make room for\n *                         the new object: <code>addChild()</code>,\n *                         <code>addChildAt()</code>, and\n *                         <code>setChildIndex()</code>. </p>\n * @event removedFromScene Dispatched when a display object is about to be\n *                         removed from the display list, either directly or\n *                         through the removal of a sub tree in which the\n *                         display object is contained. Two methods of the\n *                         DisplayObjectContainer class generate this event:\n *                         <code>removeChild()</code> and\n *                         <code>removeChildAt()</code>.\n *\n *                         <p>The following methods of a\n *                         DisplayObjectContainer object also generate this\n *                         event if an object must be removed to make room for\n *                         the new object: <code>addChild()</code>,\n *                         <code>addChildAt()</code>, and\n *                         <code>setChildIndex()</code>. </p>\n * @event render           [broadcast event] Dispatched when the display list\n *                         is about to be updated and rendered. This event\n *                         provides the last opportunity for objects listening\n *                         for this event to make changes before the display\n *                         list is rendered. You must call the\n *                         <code>invalidate()</code> method of the Scene\n *                         object each time you want a <code>render</code>\n *                         event to be dispatched. <code>Render</code> events\n *                         are dispatched to an object only if there is mutual\n *                         trust between it and the object that called\n *                         <code>Scene.invalidate()</code>. This event is a\n *                         broadcast event, which means that it is dispatched\n *                         by all display objects with a listener registered\n *                         for this event.\n *\n *                         <p><b>Note: </b>This event is not dispatched if the\n *                         display is not rendering. This is the case when the\n *                         content is either minimized or obscured. </p>\n */\nclass DisplayObject extends NamedAssetBase implements IBitmapDrawable\n{\n\tprivate _loaderInfo:LoaderInfo;\n\tprivate _mouseX:number;\n\tprivate _mouseY:number;\n\tprivate _root:DisplayObjectContainer;\n\tprivate _bounds:Rectangle;\n\tpublic _pBoxBounds:Box;\n\tprivate _boxBoundsInvalid:boolean = true;\n\tpublic _pSphereBounds:Sphere;\n\tprivate _sphereBoundsInvalid:boolean = true;\n\tprivate _debugVisible:boolean;\n\n\tpublic _pScene:Scene;\n\tpublic _pParent:DisplayObjectContainer;\n\tpublic _pSceneTransform:Matrix3D = new Matrix3D();\n\tpublic _pSceneTransformDirty:boolean = true;\n\tpublic _pIsEntity:boolean;\n\n\tprivate _explicitPartition:Partition;\n\tpublic _pImplicitPartition:Partition;\n\n\tprivate _sceneTransformChanged:DisplayObjectEvent;\n\tprivate _scenechanged:DisplayObjectEvent;\n\tprivate _transform:Transform;\n\tprivate _matrix3D:Matrix3D = new Matrix3D();\n\tprivate _matrix3DDirty:boolean = true;\n\n\tprivate _inverseSceneTransform:Matrix3D = new Matrix3D();\n\tprivate _inverseSceneTransformDirty:boolean = true;\n\tprivate _scenePosition:Vector3D = new Vector3D();\n\tprivate _scenePositionDirty:boolean = true;\n\tprivate _explicitVisibility:boolean = true;\n\tpublic _pImplicitVisibility:boolean = true;\n\tprivate _explicitMouseEnabled:boolean = true;\n\tpublic _pImplicitMouseEnabled:boolean = true;\n\tprivate _listenToSceneTransformChanged:boolean;\n\tprivate _listenToSceneChanged:boolean;\n\n\tprivate _positionDirty:boolean = true;\n\tprivate _rotationDirty:boolean = true;\n\tprivate _scaleDirty:boolean = true;\n\n\tprivate _positionChanged:DisplayObjectEvent;\n\tprivate _rotationChanged:DisplayObjectEvent;\n\tprivate _scaleChanged:DisplayObjectEvent;\n\n\tprivate _rotationX:number = 0;\n\tprivate _rotationY:number = 0;\n\tprivate _rotationZ:number = 0;\n\tprivate _eulers:Vector3D = new Vector3D();\n\tprivate _flipY:Matrix3D = new Matrix3D();\n\n\tprivate _listenToPositionChanged:boolean;\n\tprivate _listenToRotationChanged:boolean;\n\tprivate _listenToScaleChanged:boolean;\n\tprivate _zOffset:number = 0;\n\n\tpublic _pScaleX:number = 1;\n\tpublic _pScaleY:number = 1;\n\tpublic _pScaleZ:number = 1;\n\tprivate _x:number = 0;\n\tprivate _y:number = 0;\n\tprivate _z:number = 0;\n\tprivate _pivot:Vector3D = new Vector3D();\n\tprivate _orientationMatrix:Matrix3D = new Matrix3D();\n\tprivate _pivotZero:boolean = true;\n\tprivate _pivotDirty:boolean = true;\n\tprivate _pos:Vector3D = new Vector3D();\n\tprivate _rot:Vector3D = new Vector3D();\n\tprivate _sca:Vector3D = new Vector3D();\n\tprivate _transformComponents:Array<Vector3D>;\n\n\tpublic _pIgnoreTransform:boolean = false;\n\n\tprivate _shaderPickingDetails:boolean;\n\n\tpublic _pPickingCollisionVO:PickingCollisionVO;\n\n\tpublic _boundsType:string;\n\n\tpublic _pPickingCollider:IPickingCollider;\n\n\tpublic _pRenderables:Array<IRenderable> = new Array<IRenderable>();\n\tprivate _entityNodes:Array<EntityNode> = new Array<EntityNode>();\n\n\tpublic _iSourcePrefab:PrefabBase;\n\n\t/**\n\t *\n\t */\n\tpublic alignmentMode:string = AlignmentMode.REGISTRATION_POINT;\n\n\t/**\n\t * Indicates the alpha transparency value of the object specified. Valid\n\t * values are 0(fully transparent) to 1(fully opaque). The default value is\n\t * 1. Display objects with <code>alpha</code> set to 0 <i>are</i> active,\n\t * even though they are invisible.\n\t */\n\tpublic alpha:number;\n\n\t/**\n\t * A value from the BlendMode class that specifies which blend mode to use. A\n\t * bitmap can be drawn internally in two ways. If you have a blend mode\n\t * enabled or an external clipping mask, the bitmap is drawn by adding a\n\t * bitmap-filled square shape to the vector render. If you attempt to set\n\t * this property to an invalid value, Flash runtimes set the value to\n\t * <code>BlendMode.NORMAL</code>.\n\t *\n\t * <p>The <code>blendMode</code> property affects each pixel of the display\n\t * object. Each pixel is composed of three constituent colors(red, green,\n\t * and blue), and each constituent color has a value between 0x00 and 0xFF.\n\t * Flash Player or Adobe AIR compares each constituent color of one pixel in\n\t * the movie clip with the corresponding color of the pixel in the\n\t * background. For example, if <code>blendMode</code> is set to\n\t * <code>BlendMode.LIGHTEN</code>, Flash Player or Adobe AIR compares the red\n\t * value of the display object with the red value of the background, and uses\n\t * the lighter of the two as the value for the red component of the displayed\n\t * color.</p>\n\t *\n\t * <p>The following table describes the <code>blendMode</code> settings. The\n\t * BlendMode class defines string values you can use. The illustrations in\n\t * the table show <code>blendMode</code> values applied to a circular display\n\t * object(2) superimposed on another display object(1).</p>\n\t */\n\tpublic blendMode:BlendMode;\n\n\t/**\n\t *\n\t */\n\tpublic get boundsType():string\n\t{\n\t\treturn this._boundsType;\n\t}\n\n\tpublic set boundsType(value:string)\n\t{\n\t\tif (this._boundsType == value)\n\t\t\treturn;\n\n\t\tthis._boundsType = value;\n\n\t\tthis._pInvalidateBounds();\n\n\t\tvar len:number = this._entityNodes.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._entityNodes[i].updateBounds();\n\t}\n\n\t/**\n\t * If set to <code>true</code>, NME will use the software renderer to cache\n\t * an internal bitmap representation of the display object. For native targets,\n\t * this is often much slower than the default hardware renderer. When you\n\t * are using the Flash target, this caching may increase performance for display\n\t * objects that contain complex vector content.\n\t *\n\t * <p>All vector data for a display object that has a cached bitmap is drawn\n\t * to the bitmap instead of the main display. If\n\t * <code>cacheAsBitmapMatrix</code> is null or unsupported, the bitmap is\n\t * then copied to the main display as unstretched, unrotated pixels snapped\n\t * to the nearest pixel boundaries. Pixels are mapped 1 to 1 with the parent\n\t * object. If the bounds of the bitmap change, the bitmap is recreated\n\t * instead of being stretched.</p>\n\t *\n\t * <p>If <code>cacheAsBitmapMatrix</code> is non-null and supported, the\n\t * object is drawn to the off-screen bitmap using that matrix and the\n\t * stretched and/or rotated results of that rendering are used to draw the\n\t * object to the main display.</p>\n\t *\n\t * <p>No internal bitmap is created unless the <code>cacheAsBitmap</code>\n\t * property is set to <code>true</code>.</p>\n\t *\n\t * <p>After you set the <code>cacheAsBitmap</code> property to\n\t * <code>true</code>, the rendering does not change, however the display\n\t * object performs pixel snapping automatically. The animation speed can be\n\t * significantly faster depending on the complexity of the vector content.\n\t * </p>\n\t *\n\t * <p>The <code>cacheAsBitmap</code> property is automatically set to\n\t * <code>true</code> whenever you apply a filter to a display object(when\n\t * its <code>filter</code> array is not empty), and if a display object has a\n\t * filter applied to it, <code>cacheAsBitmap</code> is reported as\n\t * <code>true</code> for that display object, even if you set the property to\n\t * <code>false</code>. If you clear all filters for a display object, the\n\t * <code>cacheAsBitmap</code> setting changes to what it was last set to.</p>\n\t *\n\t * <p>A display object does not use a bitmap even if the\n\t * <code>cacheAsBitmap</code> property is set to <code>true</code> and\n\t * instead renders from vector data in the following cases:</p>\n\t *\n\t * <ul>\n\t *   <li>The bitmap is too large. In AIR 1.5 and Flash Player 10, the maximum\n\t * size for a bitmap image is 8,191 pixels in width or height, and the total\n\t * number of pixels cannot exceed 16,777,215 pixels.(So, if a bitmap image\n\t * is 8,191 pixels wide, it can only be 2,048 pixels high.) In Flash Player 9\n\t * and earlier, the limitation is is 2880 pixels in height and 2,880 pixels\n\t * in width.</li>\n\t *   <li>The bitmap fails to allocate(out of memory error). </li>\n\t * </ul>\n\t *\n\t * <p>The <code>cacheAsBitmap</code> property is best used with movie clips\n\t * that have mostly static content and that do not scale and rotate\n\t * frequently. With such movie clips, <code>cacheAsBitmap</code> can lead to\n\t * performance increases when the movie clip is translated(when its <i>x</i>\n\t * and <i>y</i> position is changed).</p>\n\t */\n\tpublic cacheAsBitmap:boolean;\n\n\t/**\n\t *\n\t */\n\tpublic castsShadows:boolean = true;\n\n\t/**\n\t * Indicates the depth of the display object, in pixels. The depth is\n\t * calculated based on the bounds of the content of the display object. When\n\t * you set the <code>depth</code> property, the <code>scaleZ</code> property\n\t * is adjusted accordingly, as shown in the following code:\n\t *\n\t * <p>Except for TextField and Video objects, a display object with no\n\t * content (such as an empty sprite) has a depth of 0, even if you try to\n\t * set <code>depth</code> to a different value.</p>\n\t */\n\tpublic get depth():number\n\t{\n\t\tif (this._boxBoundsInvalid)\n\t\t\tthis._pUpdateBoxBounds();\n\n\t\treturn this._pBoxBounds.depth*this._pScaleZ;\n\t}\n\n\tpublic set depth(val:number)\n\t{\n\t\tvar scaleZ:number = val/this.getBox().depth;\n\n\t\tif (this._pScaleZ == scaleZ)\n\t\t\treturn;\n\n\t\tthis._pScaleZ = scaleZ;\n\n\t\tthis.invalidateScale();\n\t}\n\n\t/**\n\t * Defines the rotation of the 3d object as a <code>Vector3D</code> object containing euler angles for rotation around x, y and z axis.\n\t */\n\tpublic get eulers():Vector3D\n\t{\n\t\tthis._eulers.x = this._rotationX*MathConsts.RADIANS_TO_DEGREES;\n\t\tthis._eulers.y = this._rotationY*MathConsts.RADIANS_TO_DEGREES;\n\t\tthis._eulers.z = this._rotationZ*MathConsts.RADIANS_TO_DEGREES;\n\n\t\treturn this._eulers;\n\t}\n\n\tpublic set eulers(value:Vector3D)\n\t{\n\t\tthis._rotationX = value.x*MathConsts.DEGREES_TO_RADIANS;\n\t\tthis._rotationY = value.y*MathConsts.DEGREES_TO_RADIANS;\n\t\tthis._rotationZ = value.z*MathConsts.DEGREES_TO_RADIANS;\n\n\t\tthis.invalidateRotation();\n\t}\n\n\t/**\n\t * An object that can contain any extra data.\n\t */\n\tpublic extra:Object;\n\n\t/**\n\t * An indexed array that contains each filter object currently associated\n\t * with the display object. The flash.filters package contains several\n\t * classes that define specific filters you can use.\n\t *\n\t * <p>Filters can be applied in Flash Professional at design time, or at run\n\t * time by using ActionScript code. To apply a filter by using ActionScript,\n\t * you must make a temporary copy of the entire <code>filters</code> array,\n\t * modify the temporary array, then assign the value of the temporary array\n\t * back to the <code>filters</code> array. You cannot directly add a new\n\t * filter object to the <code>filters</code> array.</p>\n\t *\n\t * <p>To add a filter by using ActionScript, perform the following steps\n\t * (assume that the target display object is named\n\t * <code>myDisplayObject</code>):</p>\n\t *\n\t * <ol>\n\t *   <li>Create a new filter object by using the constructor method of your\n\t * chosen filter class.</li>\n\t *   <li>Assign the value of the <code>myDisplayObject.filters</code> array\n\t * to a temporary array, such as one named <code>myFilters</code>.</li>\n\t *   <li>Add the new filter object to the <code>myFilters</code> temporary\n\t * array.</li>\n\t *   <li>Assign the value of the temporary array to the\n\t * <code>myDisplayObject.filters</code> array.</li>\n\t * </ol>\n\t *\n\t * <p>If the <code>filters</code> array is undefined, you do not need to use\n\t * a temporary array. Instead, you can directly assign an array literal that\n\t * contains one or more filter objects that you create. The first example in\n\t * the Examples section adds a drop shadow filter by using code that handles\n\t * both defined and undefined <code>filters</code> arrays.</p>\n\t *\n\t * <p>To modify an existing filter object, you must use the technique of\n\t * modifying a copy of the <code>filters</code> array:</p>\n\t *\n\t * <ol>\n\t *   <li>Assign the value of the <code>filters</code> array to a temporary\n\t * array, such as one named <code>myFilters</code>.</li>\n\t *   <li>Modify the property by using the temporary array,\n\t * <code>myFilters</code>. For example, to set the quality property of the\n\t * first filter in the array, you could use the following code:\n\t * <code>myFilters[0].quality = 1;</code></li>\n\t *   <li>Assign the value of the temporary array to the <code>filters</code>\n\t * array.</li>\n\t * </ol>\n\t *\n\t * <p>At load time, if a display object has an associated filter, it is\n\t * marked to cache itself as a transparent bitmap. From this point forward,\n\t * as long as the display object has a valid filter list, the player caches\n\t * the display object as a bitmap. This source bitmap is used as a source\n\t * image for the filter effects. Each display object usually has two bitmaps:\n\t * one with the original unfiltered source display object and another for the\n\t * final image after filtering. The final image is used when rendering. As\n\t * long as the display object does not change, the final image does not need\n\t * updating.</p>\n\t *\n\t * <p>The flash.filters package includes classes for filters. For example, to\n\t * create a DropShadow filter, you would write:</p>\n\t *\n\t * @throws ArgumentError When <code>filters</code> includes a ShaderFilter\n\t *                       and the shader output type is not compatible with\n\t *                       this operation(the shader must specify a\n\t *                       <code>pixel4</code> output).\n\t * @throws ArgumentError When <code>filters</code> includes a ShaderFilter\n\t *                       and the shader doesn't specify any image input or\n\t *                       the first input is not an <code>image4</code> input.\n\t * @throws ArgumentError When <code>filters</code> includes a ShaderFilter\n\t *                       and the shader specifies an image input that isn't\n\t *                       provided.\n\t * @throws ArgumentError When <code>filters</code> includes a ShaderFilter, a\n\t *                       ByteArray or Vector.<Number> instance as a shader\n\t *                       input, and the <code>width</code> and\n\t *                       <code>height</code> properties aren't specified for\n\t *                       the ShaderInput object, or the specified values\n\t *                       don't match the amount of data in the input data.\n\t *                       See the <code>ShaderInput.input</code> property for\n\t *                       more information.\n\t */\n//\t\tpublic filters:Array<Dynamic>;\n\n\t/**\n\t * Indicates the height of the display object, in pixels. The height is\n\t * calculated based on the bounds of the content of the display object. When\n\t * you set the <code>height</code> property, the <code>scaleY</code> property\n\t * is adjusted accordingly, as shown in the following code:\n\t *\n\t * <p>Except for TextField and Video objects, a display object with no\n\t * content (such as an empty sprite) has a height of 0, even if you try to\n\t * set <code>height</code> to a different value.</p>\n\t */\n\tpublic get height():number\n\t{\n\t\tif (this._boxBoundsInvalid)\n\t\t\tthis._pUpdateBoxBounds();\n\n\t\treturn this._pBoxBounds.height*this._pScaleY;\n\t}\n\n\tpublic set height(val:number)\n\t{\n\t\tvar scaleY:number = val/this.getBox().height;\n\n\t\tif (this._pScaleY == scaleY)\n\t\t\treturn;\n\n\t\tthis._pScaleY = scaleY;\n\n\t\tthis.invalidateScale();\n\t}\n\n\t/**\n\t * Indicates the instance container index of the DisplayObject. The object can be\n\t * identified in the child list of its parent display object container by\n\t * calling the <code>getChildByIndex()</code> method of the display object\n\t * container.\n\t *\n\t * <p>If the DisplayObject has no parent container, index defaults to 0.</p>\n\t */\n\tpublic get index():number\n\t{\n\t\tif (this._pParent)\n\t\t\treturn this._pParent.getChildIndex(this);\n\n\t\treturn 0;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get inverseSceneTransform():Matrix3D\n\t{\n\t\tif (this._inverseSceneTransformDirty) {\n\t\t\tthis._inverseSceneTransform.copyFrom(this.sceneTransform);\n\t\t\tthis._inverseSceneTransform.invert();\n\t\t\tthis._inverseSceneTransformDirty = false;\n\t\t}\n\t\treturn this._inverseSceneTransform;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get ignoreTransform():boolean\n\t{\n\t\treturn this._pIgnoreTransform;\n\t}\n\n\tpublic set ignoreTransform(value:boolean)\n\t{\n\t\tif (this._pIgnoreTransform == value)\n\t\t\treturn;\n\n\t\tthis._pIgnoreTransform = value;\n\n\t\tif (value) {\n\t\t\tthis._pSceneTransform.identity();\n\t\t\tthis._scenePosition.setTo(0, 0, 0);\n\t\t}\n\n\t\tthis.pInvalidateSceneTransform();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get isEntity()\n\t{\n\t\treturn this._pIsEntity;\n\t}\n\n\t/**\n\t * Returns a LoaderInfo object containing information about loading the file\n\t * to which this display object belongs. The <code>loaderInfo</code> property\n\t * is defined only for the root display object of a SWF file or for a loaded\n\t * Bitmap(not for a Bitmap that is drawn with ActionScript). To find the\n\t * <code>loaderInfo</code> object associated with the SWF file that contains\n\t * a display object named <code>myDisplayObject</code>, use\n\t * <code>myDisplayObject.root.loaderInfo</code>.\n\t *\n\t * <p>A large SWF file can monitor its download by calling\n\t * <code>this.root.loaderInfo.addEventListener(Event.COMPLETE,\n\t * func)</code>.</p>\n\t */\n\tpublic get loaderInfo():LoaderInfo\n\t{\n\t\treturn this._loaderInfo;\n\t}\n\n\t/**\n\t * The calling display object is masked by the specified <code>mask</code>\n\t * object. To ensure that masking works when the Stage is scaled, the\n\t * <code>mask</code> display object must be in an active part of the display\n\t * list. The <code>mask</code> object itself is not drawn. Set\n\t * <code>mask</code> to <code>null</code> to remove the mask.\n\t *\n\t * <p>To be able to scale a mask object, it must be on the display list. To\n\t * be able to drag a mask Sprite object(by calling its\n\t * <code>startDrag()</code> method), it must be on the display list. To call\n\t * the <code>startDrag()</code> method for a mask sprite based on a\n\t * <code>mouseDown</code> event being dispatched by the sprite, set the\n\t * sprite's <code>buttonMode</code> property to <code>true</code>.</p>\n\t *\n\t * <p>When display objects are cached by setting the\n\t * <code>cacheAsBitmap</code> property to <code>true</code> an the\n\t * <code>cacheAsBitmapMatrix</code> property to a Matrix object, both the\n\t * mask and the display object being masked must be part of the same cached\n\t * bitmap. Thus, if the display object is cached, then the mask must be a\n\t * child of the display object. If an ancestor of the display object on the\n\t * display list is cached, then the mask must be a child of that ancestor or\n\t * one of its descendents. If more than one ancestor of the masked object is\n\t * cached, then the mask must be a descendent of the cached container closest\n\t * to the masked object in the display list.</p>\n\t *\n\t * <p><b>Note:</b> A single <code>mask</code> object cannot be used to mask\n\t * more than one calling display object. When the <code>mask</code> is\n\t * assigned to a second display object, it is removed as the mask of the\n\t * first object, and that object's <code>mask</code> property becomes\n\t * <code>null</code>.</p>\n\t */\n\tpublic mask:DisplayObject;\n\n\t/**\n\t * Specifies whether this object receives mouse, or other user input,\n\t * messages. The default value is <code>true</code>, which means that by\n\t * default any InteractiveObject instance that is on the display list\n\t * receives mouse events or other user input events. If\n\t * <code>mouseEnabled</code> is set to <code>false</code>, the instance does\n\t * not receive any mouse events(or other user input events like keyboard\n\t * events). Any children of this instance on the display list are not\n\t * affected. To change the <code>mouseEnabled</code> behavior for all\n\t * children of an object on the display list, use\n\t * <code>flash.display.DisplayObjectContainer.mouseChildren</code>.\n\t *\n\t * <p> No event is dispatched by setting this property. You must use the\n\t * <code>addEventListener()</code> method to create interactive\n\t * functionality.</p>\n\t */\n\tpublic get mouseEnabled():boolean\n\t{\n\t\treturn this._explicitMouseEnabled;\n\t}\n\n\tpublic set mouseEnabled(value:boolean)\n\t{\n\t\tif (this._explicitMouseEnabled == value)\n\t\t\treturn;\n\n\t\tthis._explicitMouseEnabled = value;\n\n\t\tthis._pUpdateImplicitMouseEnabled(this._pParent? this._pParent.mouseChildren : true);\n\t}\n\n\n\t/**\n\t * Indicates the x coordinate of the mouse or user input device position, in\n\t * pixels.\n\t *\n\t * <p><b>Note</b>: For a DisplayObject that has been rotated, the returned x\n\t * coordinate will reflect the non-rotated object.</p>\n\t */\n\tpublic get mouseX():number\n\t{\n\t\treturn this._mouseX;\n\t}\n\n\t/**\n\t * Indicates the y coordinate of the mouse or user input device position, in\n\t * pixels.\n\t *\n\t * <p><b>Note</b>: For a DisplayObject that has been rotated, the returned y\n\t * coordinate will reflect the non-rotated object.</p>\n\t */\n\tpublic get mouseY():number\n\t{\n\t\treturn this._mouseY;\n\t}\n\n\t/**\n\t * Indicates the instance name of the DisplayObject. The object can be\n\t * identified in the child list of its parent display object container by\n\t * calling the <code>getChildByName()</code> method of the display object\n\t * container.\n\t *\n\t * @throws IllegalOperationError If you are attempting to set this property\n\t *                               on an object that was placed on the timeline\n\t *                               in the Flash authoring tool.\n\t */\n\tpublic name:string;\n\n\t/**\n\t *\n\t */\n\tpublic orientationMode:string = OrientationMode.DEFAULT;\n\n\t/**\n\t * Indicates the DisplayObjectContainer object that contains this display\n\t * object. Use the <code>parent</code> property to specify a relative path to\n\t * display objects that are above the current display object in the display\n\t * list hierarchy.\n\t *\n\t * <p>You can use <code>parent</code> to move up multiple levels in the\n\t * display list as in the following:</p>\n\t *\n\t * @throws SecurityError The parent display object belongs to a security\n\t *                       sandbox to which you do not have access. You can\n\t *                       avoid this situation by having the parent movie call\n\t *                       the <code>Security.allowDomain()</code> method.\n\t */\n\tpublic get parent():DisplayObjectContainer\n\t{\n\t\treturn this._pParent;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get partition():Partition\n\t{\n\t\treturn this._explicitPartition;\n\t}\n\n\tpublic set partition(value:Partition)\n\t{\n\t\tif (this._explicitPartition == value)\n\t\t\treturn;\n\n\t\tthis._explicitPartition = value;\n\n\t\tthis._pUpdateImplicitPartition(this._pParent? this._pParent._iAssignedPartition : null, this._pScene);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get pickingCollider():IPickingCollider\n\t{\n\t\treturn this._pPickingCollider;\n\t}\n\n\tpublic set pickingCollider(value:IPickingCollider)\n\t{\n\t\tthis._pPickingCollider = value;\n\t}\n\n\t/**\n\t * Defines the local point around which the object rotates.\n\t */\n\tpublic get pivot():Vector3D\n\t{\n\t\treturn this._pivot;\n\t}\n\n\n\tpublic set pivot(pivot:Vector3D)\n\t{\n\t\tthis._pivot = pivot.clone();\n\n\t\tthis.invalidatePivot();\n\t}\n\n\t/**\n\t * For a display object in a loaded SWF file, the <code>root</code> property\n\t * is the top-most display object in the portion of the display list's tree\n\t * structure represented by that SWF file. For a Bitmap object representing a\n\t * loaded image file, the <code>root</code> property is the Bitmap object\n\t * itself. For the instance of the main class of the first SWF file loaded,\n\t * the <code>root</code> property is the display object itself. The\n\t * <code>root</code> property of the Scene object is the Scene object itself.\n\t * The <code>root</code> property is set to <code>null</code> for any display\n\t * object that has not been added to the display list, unless it has been\n\t * added to a display object container that is off the display list but that\n\t * is a child of the top-most display object in a loaded SWF file.\n\t *\n\t * <p>For example, if you create a new Sprite object by calling the\n\t * <code>Sprite()</code> constructor method, its <code>root</code> property\n\t * is <code>null</code> until you add it to the display list(or to a display\n\t * object container that is off the display list but that is a child of the\n\t * top-most display object in a SWF file).</p>\n\t *\n\t * <p>For a loaded SWF file, even though the Loader object used to load the\n\t * file may not be on the display list, the top-most display object in the\n\t * SWF file has its <code>root</code> property set to itself. The Loader\n\t * object does not have its <code>root</code> property set until it is added\n\t * as a child of a display object for which the <code>root</code> property is\n\t * set.</p>\n\t */\n\tpublic get root():DisplayObjectContainer\n\t{\n\t\treturn this._root;\n\t}\n\n\t/**\n\t * Indicates the rotation of the DisplayObject instance, in degrees, from its\n\t * original orientation. Values from 0 to 180 represent clockwise rotation;\n\t * values from 0 to -180 represent counterclockwise rotation. Values outside\n\t * this range are added to or subtracted from 360 to obtain a value within\n\t * the range. For example, the statement <code>my_video.rotation = 450</code>\n\t * is the same as <code> my_video.rotation = 90</code>.\n\t */\n\tpublic rotation:number; //TODO\n\n\t/**\n\t * Indicates the x-axis rotation of the DisplayObject instance, in degrees,\n\t * from its original orientation relative to the 3D parent container. Values\n\t * from 0 to 180 represent clockwise rotation; values from 0 to -180\n\t * represent counterclockwise rotation. Values outside this range are added\n\t * to or subtracted from 360 to obtain a value within the range.\n\t */\n\tpublic get rotationX():number\n\t{\n\t\treturn this._rotationX*MathConsts.RADIANS_TO_DEGREES;\n\t}\n\n\tpublic set rotationX(val:number)\n\t{\n\t\tif (this.rotationX == val)\n\t\t\treturn;\n\n\t\tthis._rotationX = val*MathConsts.DEGREES_TO_RADIANS;\n\n\t\tthis.invalidateRotation();\n\t}\n\n\t/**\n\t * Indicates the y-axis rotation of the DisplayObject instance, in degrees,\n\t * from its original orientation relative to the 3D parent container. Values\n\t * from 0 to 180 represent clockwise rotation; values from 0 to -180\n\t * represent counterclockwise rotation. Values outside this range are added\n\t * to or subtracted from 360 to obtain a value within the range.\n\t */\n\tpublic get rotationY():number\n\t{\n\t\treturn this._rotationY*MathConsts.RADIANS_TO_DEGREES;\n\t}\n\n\tpublic set rotationY(val:number)\n\t{\n\t\tif (this.rotationY == val)\n\t\t\treturn;\n\n\t\tthis._rotationY = val*MathConsts.DEGREES_TO_RADIANS;\n\n\t\tthis.invalidateRotation();\n\t}\n\n\t/**\n\t * Indicates the z-axis rotation of the DisplayObject instance, in degrees,\n\t * from its original orientation relative to the 3D parent container. Values\n\t * from 0 to 180 represent clockwise rotation; values from 0 to -180\n\t * represent counterclockwise rotation. Values outside this range are added\n\t * to or subtracted from 360 to obtain a value within the range.\n\t */\n\tpublic get rotationZ():number\n\t{\n\t\treturn this._rotationZ*MathConsts.RADIANS_TO_DEGREES;\n\t}\n\n\tpublic set rotationZ(val:number)\n\t{\n\t\tif (this.rotationZ == val)\n\t\t\treturn;\n\n\t\tthis._rotationZ = val*MathConsts.DEGREES_TO_RADIANS;\n\n\t\tthis.invalidateRotation();\n\t}\n\n\t/**\n\t * The current scaling grid that is in effect. If set to <code>null</code>,\n\t * the entire display object is scaled normally when any scale transformation\n\t * is applied.\n\t *\n\t * <p>When you define the <code>scale9Grid</code> property, the display\n\t * object is divided into a grid with nine regions based on the\n\t * <code>scale9Grid</code> rectangle, which defines the center region of the\n\t * grid. The eight other regions of the grid are the following areas: </p>\n\t *\n\t * <ul>\n\t *   <li>The upper-left corner outside of the rectangle</li>\n\t *   <li>The area above the rectangle </li>\n\t *   <li>The upper-right corner outside of the rectangle</li>\n\t *   <li>The area to the left of the rectangle</li>\n\t *   <li>The area to the right of the rectangle</li>\n\t *   <li>The lower-left corner outside of the rectangle</li>\n\t *   <li>The area below the rectangle</li>\n\t *   <li>The lower-right corner outside of the rectangle</li>\n\t * </ul>\n\t *\n\t * <p>You can think of the eight regions outside of the center(defined by\n\t * the rectangle) as being like a picture frame that has special rules\n\t * applied to it when scaled.</p>\n\t *\n\t * <p>When the <code>scale9Grid</code> property is set and a display object\n\t * is scaled, all text and gradients are scaled normally; however, for other\n\t * types of objects the following rules apply:</p>\n\t *\n\t * <ul>\n\t *   <li>Content in the center region is scaled normally. </li>\n\t *   <li>Content in the corners is not scaled. </li>\n\t *   <li>Content in the top and bottom regions is scaled horizontally only.\n\t * Content in the left and right regions is scaled vertically only.</li>\n\t *   <li>All fills(including bitmaps, video, and gradients) are stretched to\n\t * fit their shapes.</li>\n\t * </ul>\n\t *\n\t * <p>If a display object is rotated, all subsequent scaling is normal(and\n\t * the <code>scale9Grid</code> property is ignored).</p>\n\t *\n\t * <p>For example, consider the following display object and a rectangle that\n\t * is applied as the display object's <code>scale9Grid</code>:</p>\n\t *\n\t * <p>A common use for setting <code>scale9Grid</code> is to set up a display\n\t * object to be used as a component, in which edge regions retain the same\n\t * width when the component is scaled.</p>\n\t *\n\t * @throws ArgumentError If you pass an invalid argument to the method.\n\t */\n\tpublic scale9Grid:Rectangle;\n\n\t/**\n\t * Indicates the horizontal scale(percentage) of the object as applied from\n\t * the registration point. The default registration point is(0,0). 1.0\n\t * equals 100% scale.\n\t *\n\t * <p>Scaling the local coordinate system changes the <code>x</code> and\n\t * <code>y</code> property values, which are defined in whole pixels. </p>\n\t */\n\tpublic get scaleX():number\n\t{\n\t\treturn this._pScaleX;\n\t}\n\n\tpublic set scaleX(val:number)\n\t{\n\t\tif (this._pScaleX == val)\n\t\t\treturn;\n\n\t\tthis._pScaleX = val;\n\n\t\tthis.invalidateScale();\n\t}\n\n\t/**\n\t * Indicates the vertical scale(percentage) of an object as applied from the\n\t * registration point of the object. The default registration point is(0,0).\n\t * 1.0 is 100% scale.\n\t *\n\t * <p>Scaling the local coordinate system changes the <code>x</code> and\n\t * <code>y</code> property values, which are defined in whole pixels. </p>\n\t */\n\tpublic get scaleY():number\n\t{\n\t\treturn this._pScaleY;\n\t}\n\n\tpublic set scaleY(val:number)\n\t{\n\t\tif (this._pScaleY == val)\n\t\t\treturn;\n\n\t\tthis._pScaleY = val;\n\n\t\tthis.invalidateScale();\n\t}\n\n\t/**\n\t * Indicates the depth scale(percentage) of an object as applied from the\n\t * registration point of the object. The default registration point is(0,0).\n\t * 1.0 is 100% scale.\n\t *\n\t * <p>Scaling the local coordinate system changes the <code>x</code>,\n\t * <code>y</code> and <code>z</code> property values, which are defined in\n\t * whole pixels. </p>\n\t */\n\tpublic get scaleZ():number\n\t{\n\t\treturn this._pScaleZ;\n\t}\n\n\tpublic set scaleZ(val:number)\n\t{\n\t\tif (this._pScaleZ == val)\n\t\t\treturn;\n\n\t\tthis._pScaleZ = val;\n\n\t\tthis.invalidateScale();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get scene():Scene\n\t{\n\t\treturn this._pScene;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get scenePosition():Vector3D\n\t{\n\t\tif (this._scenePositionDirty) {\n\t\t\tif (!this._pivotZero && this.alignmentMode == AlignmentMode.PIVOT_POINT) {\n\t\t\t\tvar pivotScale:Vector3D = new Vector3D(this._pivot.x/this._pScaleX, this._pivot.y/this._pScaleY, this._pivot.z/this._pScaleZ)\n\t\t\t\t\tthis._scenePosition = this.sceneTransform.transformVector(pivotScale);\n\t\t\t\t//this._scenePosition.decrementBy(new Vector3D(this._pivot.x*this._pScaleX, this._pivot.y*this._pScaleY, this._pivot.z*this._pScaleZ));\n\t\t\t} else {\n\t\t\t\tthis.sceneTransform.copyColumnTo(3, this._scenePosition);\n\t\t\t}\n\n\t\t\tthis._scenePositionDirty = false;\n\t\t}\n\t\treturn this._scenePosition;\n\t}\n\n\tpublic get sceneTransform():Matrix3D\n\t{\n\t\tif (this._pSceneTransformDirty)\n\t\t\tthis.pUpdateSceneTransform();\n\n\t\treturn this._pSceneTransform;\n\t}\n\n\t/**\n\t * The scroll rectangle bounds of the display object. The display object is\n\t * cropped to the size defined by the rectangle, and it scrolls within the\n\t * rectangle when you change the <code>x</code> and <code>y</code> properties\n\t * of the <code>scrollRect</code> object.\n\t *\n\t * <p>The properties of the <code>scrollRect</code> Rectangle object use the\n\t * display object's coordinate space and are scaled just like the overall\n\t * display object. The corner bounds of the cropped window on the scrolling\n\t * display object are the origin of the display object(0,0) and the point\n\t * defined by the width and height of the rectangle. They are not centered\n\t * around the origin, but use the origin to define the upper-left corner of\n\t * the area. A scrolled display object always scrolls in whole pixel\n\t * increments. </p>\n\t *\n\t * <p>You can scroll an object left and right by setting the <code>x</code>\n\t * property of the <code>scrollRect</code> Rectangle object. You can scroll\n\t * an object up and down by setting the <code>y</code> property of the\n\t * <code>scrollRect</code> Rectangle object. If the display object is rotated\n\t * 90 and you scroll it left and right, the display object actually scrolls\n\t * up and down.</p>\n\t */\n\tpublic scrollRect:Rectangle;\n\n\t/**\n\t *\n\t */\n\tpublic get shaderPickingDetails():boolean\n\t{\n\t\treturn this._shaderPickingDetails;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get debugVisible():boolean\n\t{\n\t\treturn this._debugVisible;\n\t}\n\n\tpublic set debugVisible(value:boolean)\n\t{\n\t\tif (value == this._debugVisible)\n\t\t\treturn;\n\n\t\tthis._debugVisible = value;\n\n\t\tvar len:number = this._entityNodes.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._entityNodes[i].debugVisible = this._debugVisible;\n\t}\n\n\t/**\n\t * An object with properties pertaining to a display object's matrix, color\n\t * transform, and pixel bounds. The specific properties  -  matrix,\n\t * colorTransform, and three read-only properties\n\t * (<code>concatenatedMatrix</code>, <code>concatenatedColorTransform</code>,\n\t * and <code>pixelBounds</code>)  -  are described in the entry for the\n\t * Transform class.\n\t *\n\t * <p>Each of the transform object's properties is itself an object. This\n\t * concept is important because the only way to set new values for the matrix\n\t * or colorTransform objects is to create a new object and copy that object\n\t * into the transform.matrix or transform.colorTransform property.</p>\n\t *\n\t * <p>For example, to increase the <code>tx</code> value of a display\n\t * object's matrix, you must make a copy of the entire matrix object, then\n\t * copy the new object into the matrix property of the transform object:</p>\n\t * <pre xml:space=\"preserve\"><code> public myMatrix:Matrix =\n\t * myDisplayObject.transform.matrix; myMatrix.tx += 10;\n\t * myDisplayObject.transform.matrix = myMatrix; </code></pre>\n\t *\n\t * <p>You cannot directly set the <code>tx</code> property. The following\n\t * code has no effect on <code>myDisplayObject</code>: </p>\n\t * <pre xml:space=\"preserve\"><code> myDisplayObject.transform.matrix.tx +=\n\t * 10; </code></pre>\n\t *\n\t * <p>You can also copy an entire transform object and assign it to another\n\t * display object's transform property. For example, the following code\n\t * copies the entire transform object from <code>myOldDisplayObj</code> to\n\t * <code>myNewDisplayObj</code>:</p>\n\t * <code>myNewDisplayObj.transform = myOldDisplayObj.transform;</code>\n\t *\n\t * <p>The resulting display object, <code>myNewDisplayObj</code>, now has the\n\t * same values for its matrix, color transform, and pixel bounds as the old\n\t * display object, <code>myOldDisplayObj</code>.</p>\n\t *\n\t * <p>Note that AIR for TV devices use hardware acceleration, if it is\n\t * available, for color transforms.</p>\n\t */\n\tpublic get transform():Transform\n\t{\n\t\treturn this._transform;\n\t}\n\n\t/**\n\t * Whether or not the display object is visible. Display objects that are not\n\t * visible are disabled. For example, if <code>visible=false</code> for an\n\t * InteractiveObject instance, it cannot be clicked.\n\t */\n\tpublic get visible():boolean\n\t{\n\t\treturn this._explicitVisibility;\n\t}\n\n\tpublic set visible(value:boolean)\n\t{\n\t\tif (this._explicitVisibility == value)\n\t\t\treturn;\n\n\t\tthis._explicitVisibility = value;\n\n\t\tthis._pUpdateImplicitVisibility(this._pParent? this._pParent._iIsVisible() : true);\n\t}\n\n\t/**\n\t * Indicates the width of the display object, in pixels. The width is\n\t * calculated based on the bounds of the content of the display object. When\n\t * you set the <code>width</code> property, the <code>scaleX</code> property\n\t * is adjusted accordingly, as shown in the following code:\n\t *\n\t * <p>Except for TextField and Video objects, a display object with no\n\t * content(such as an empty sprite) has a width of 0, even if you try to set\n\t * <code>width</code> to a different value.</p>\n\t */\n\tpublic get width():number\n\t{\n\t\tif (this._boxBoundsInvalid)\n\t\t\tthis._pUpdateBoxBounds();\n\n\t\treturn this._pBoxBounds.width*this._pScaleX;\n\t}\n\n\tpublic set width(val:number)\n\t{\n\t\tvar scaleX:number = val/this.getBox().width;\n\n\t\tif (this._pScaleX == scaleX)\n\t\t\treturn;\n\n\t\tthis._pScaleX = scaleX;\n\n\t\tthis.invalidateScale();\n\t}\n\n\t/**\n\t * Indicates the <i>x</i> coordinate of the DisplayObject instance relative\n\t * to the local coordinates of the parent DisplayObjectContainer. If the\n\t * object is inside a DisplayObjectContainer that has transformations, it is\n\t * in the local coordinate system of the enclosing DisplayObjectContainer.\n\t * Thus, for a DisplayObjectContainer rotated 90 counterclockwise, the\n\t * DisplayObjectContainer's children inherit a coordinate system that is\n\t * rotated 90 counterclockwise. The object's coordinates refer to the\n\t * registration point position.\n\t */\n\tpublic get x():number\n\t{\n\t\treturn this._x;\n\t}\n\n\tpublic set x(val:number)\n\t{\n\t\tif (this._x == val)\n\t\t\treturn;\n\n\t\tthis._x = val;\n\n\t\tthis.invalidatePosition();\n\t}\n\n\t/**\n\t * Indicates the <i>y</i> coordinate of the DisplayObject instance relative\n\t * to the local coordinates of the parent DisplayObjectContainer. If the\n\t * object is inside a DisplayObjectContainer that has transformations, it is\n\t * in the local coordinate system of the enclosing DisplayObjectContainer.\n\t * Thus, for a DisplayObjectContainer rotated 90 counterclockwise, the\n\t * DisplayObjectContainer's children inherit a coordinate system that is\n\t * rotated 90 counterclockwise. The object's coordinates refer to the\n\t * registration point position.\n\t */\n\tpublic get y():number\n\t{\n\t\treturn this._y;\n\t}\n\n\tpublic set y(val:number)\n\t{\n\t\tif (this._y == val)\n\t\t\treturn;\n\n\t\tthis._y = val;\n\n\t\tthis.invalidatePosition();\n\t}\n\n\t/**\n\t * Indicates the z coordinate position along the z-axis of the DisplayObject\n\t * instance relative to the 3D parent container. The z property is used for\n\t * 3D coordinates, not screen or pixel coordinates.\n\t *\n\t * <p>When you set a <code>z</code> property for a display object to\n\t * something other than the default value of <code>0</code>, a corresponding\n\t * Matrix3D object is automatically created. for adjusting a display object's\n\t * position and orientation in three dimensions. When working with the\n\t * z-axis, the existing behavior of x and y properties changes from screen or\n\t * pixel coordinates to positions relative to the 3D parent container.</p>\n\t *\n\t * <p>For example, a child of the <code>_root</code> at position x = 100, y =\n\t * 100, z = 200 is not drawn at pixel location(100,100). The child is drawn\n\t * wherever the 3D projection calculation puts it. The calculation is:</p>\n\t *\n\t * <p><code>(x~~cameraFocalLength/cameraRelativeZPosition,\n\t * y~~cameraFocalLength/cameraRelativeZPosition)</code></p>\n\t */\n\tpublic get z():number\n\t{\n\t\treturn this._z;\n\t}\n\n\tpublic set z(val:number)\n\t{\n\t\tif (this._z == val)\n\t\t\treturn;\n\n\t\tthis._z = val;\n\n\t\tthis.invalidatePosition();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get zOffset():number\n\t{\n\t\treturn this._zOffset;\n\t}\n\n\tpublic set zOffset(value:number)\n\t{\n\t\tthis._zOffset = value;\n\t}\n\n\t/**\n\t * Creates a new <code>DisplayObject</code> instance.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\t// Cached vector of transformation components used when\n\t\t// recomposing the transform matrix in updateTransform()\n\n\t\tthis._transformComponents = new Array<Vector3D>(3);\n\n\t\tthis._transformComponents[0] = this._pos;\n\t\tthis._transformComponents[1] = this._rot;\n\t\tthis._transformComponents[2] = this._sca;\n\n\t\t//creation of associated transform object\n\t\tthis._transform = new Transform(this);\n\n\t\tthis._matrix3D.identity();\n\n\t\tthis._flipY.appendScale(1, -1, 1);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic addEventListener(type:string, listener:Function)\n\t{\n\t\tsuper.addEventListener(type, listener);\n\n\t\tswitch (type) {\n\t\t\tcase DisplayObjectEvent.POSITION_CHANGED:\n\t\t\t\tthis._listenToPositionChanged = true;\n\t\t\t\tbreak;\n\t\t\tcase DisplayObjectEvent.ROTATION_CHANGED:\n\t\t\t\tthis._listenToRotationChanged = true;\n\t\t\t\tbreak;\n\t\t\tcase DisplayObjectEvent.SCALE_CHANGED:\n\t\t\t\tthis._listenToScaleChanged = true;\n\t\t\t\tbreak;\n\t\t\tcase DisplayObjectEvent.SCENE_CHANGED:\n\t\t\t\tthis._listenToSceneChanged = true;\n\t\t\t\tbreak;\n\t\t\tcase DisplayObjectEvent.SCENETRANSFORM_CHANGED:\n\t\t\t\tthis._listenToSceneTransformChanged = true;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic clone():DisplayObject\n\t{\n\t\tvar clone:DisplayObject = new DisplayObject();\n\t\tclone.pivot = this.pivot;\n\t\tclone._iMatrix3D = this._iMatrix3D;\n\t\tclone.name = name;\n\n\t\t// todo: implement for all subtypes\n\t\treturn clone;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic dispose()\n\t{\n\t\tif (this.parent)\n\t\t\tthis.parent.removeChild(this);\n\n\t\twhile (this._pRenderables.length)\n\t\t\tthis._pRenderables[0].dispose();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic disposeAsset()\n\t{\n\t\tthis.dispose();\n\t}\n\n\t/**\n\t * Returns a rectangle that defines the area of the display object relative\n\t * to the coordinate system of the <code>targetCoordinateSpace</code> object.\n\t * Consider the following code, which shows how the rectangle returned can\n\t * vary depending on the <code>targetCoordinateSpace</code> parameter that\n\t * you pass to the method:\n\t *\n\t * <p><b>Note:</b> Use the <code>localToGlobal()</code> and\n\t * <code>globalToLocal()</code> methods to convert the display object's local\n\t * coordinates to display coordinates, or display coordinates to local\n\t * coordinates, respectively.</p>\n\t *\n\t * <p>The <code>getBounds()</code> method is similar to the\n\t * <code>getRect()</code> method; however, the Rectangle returned by the\n\t * <code>getBounds()</code> method includes any strokes on shapes, whereas\n\t * the Rectangle returned by the <code>getRect()</code> method does not. For\n\t * an example, see the description of the <code>getRect()</code> method.</p>\n\t *\n\t * @param targetCoordinateSpace The display object that defines the\n\t *                              coordinate system to use.\n\t * @return The rectangle that defines the area of the display object relative\n\t *         to the <code>targetCoordinateSpace</code> object's coordinate\n\t *         system.\n\t */\n\tpublic getBounds(targetCoordinateSpace:DisplayObject):Rectangle\n\t{\n\t\treturn this._bounds; //TODO\n\t}\n\n\t/**\n\t * Returns a rectangle that defines the boundary of the display object, based\n\t * on the coordinate system defined by the <code>targetCoordinateSpace</code>\n\t * parameter, excluding any strokes on shapes. The values that the\n\t * <code>getRect()</code> method returns are the same or smaller than those\n\t * returned by the <code>getBounds()</code> method.\n\t *\n\t * <p><b>Note:</b> Use <code>localToGlobal()</code> and\n\t * <code>globalToLocal()</code> methods to convert the display object's local\n\t * coordinates to Scene coordinates, or Scene coordinates to local\n\t * coordinates, respectively.</p>\n\t *\n\t * @param targetCoordinateSpace The display object that defines the\n\t *                              coordinate system to use.\n\t * @return The rectangle that defines the area of the display object relative\n\t *         to the <code>targetCoordinateSpace</code> object's coordinate\n\t *         system.\n\t */\n\tpublic getRect(targetCoordinateSpace:DisplayObject = null):Rectangle\n\t{\n\t\treturn this._bounds; //TODO\n\t}\n\n\tpublic getBox(targetCoordinateSpace:DisplayObject = null):Box\n\t{\n\t\tif (this._iSourcePrefab)\n\t\t\tthis._iSourcePrefab._iValidate();\n\n\t\t//TODO targetCoordinateSpace\n\t\tif (this._boxBoundsInvalid)\n\t\t\tthis._pUpdateBoxBounds();\n\n\t\treturn this._pBoxBounds;\n\t}\n\n\tpublic getSphere(targetCoordinateSpace:DisplayObject = null):Sphere\n\t{\n\t\tif (this._iSourcePrefab)\n\t\t\tthis._iSourcePrefab._iValidate();\n\n\t\tif (this._sphereBoundsInvalid)\n\t\t\tthis._pUpdateSphereBounds();\n\n\t\treturn this._pSphereBounds;\n\t}\n\n\t/**\n\t * Converts the <code>point</code> object from the Scene(global) coordinates\n\t * to the display object's(local) coordinates.\n\t *\n\t * <p>To use this method, first create an instance of the Point class. The\n\t * <i>x</i> and <i>y</i> values that you assign represent global coordinates\n\t * because they relate to the origin(0,0) of the main display area. Then\n\t * pass the Point instance as the parameter to the\n\t * <code>globalToLocal()</code> method. The method returns a new Point object\n\t * with <i>x</i> and <i>y</i> values that relate to the origin of the display\n\t * object instead of the origin of the Scene.</p>\n\t *\n\t * @param point An object created with the Point class. The Point object\n\t *              specifies the <i>x</i> and <i>y</i> coordinates as\n\t *              properties.\n\t * @return A Point object with coordinates relative to the display object.\n\t */\n\tpublic globalToLocal(point:Point):Point\n\t{\n\t\treturn point; //TODO\n\t}\n\n\t/**\n\t * Converts a two-dimensional point from the Scene(global) coordinates to a\n\t * three-dimensional display object's(local) coordinates.\n\t *\n\t * <p>To use this method, first create an instance of the Vector3D class. The x,\n\t * y and z values that you assign to the Vector3D object represent global\n\t * coordinates because they are relative to the origin(0,0,0) of the scene. Then\n\t * pass the Vector3D object to the <code>globalToLocal3D()</code> method as the\n\t * <code>position</code> parameter.\n\t * The method returns three-dimensional coordinates as a Vector3D object\n\t * containing <code>x</code>, <code>y</code>, and <code>z</code> values that\n\t * are relative to the origin of the three-dimensional display object.</p>\n\t *\n\t * @param point A Vector3D object representing global x, y and z coordinates in\n\t *              the scene.\n\t * @return A Vector3D object with coordinates relative to the three-dimensional\n\t *         display object.\n\t */\n\tpublic globalToLocal3D(position:Vector3D):Vector3D\n\t{\n\t\treturn this.inverseSceneTransform.transformVector(position);\n\t}\n\n\t/**\n\t * Evaluates the bounding box of the display object to see if it overlaps or\n\t * intersects with the bounding box of the <code>obj</code> display object.\n\t *\n\t * @param obj The display object to test against.\n\t * @return <code>true</code> if the bounding boxes of the display objects\n\t *         intersect; <code>false</code> if not.\n\t */\n\tpublic hitTestObject(obj:DisplayObject):boolean\n\t{\n\t\treturn false; //TODO\n\t}\n\n\t/**\n\t * Evaluates the display object to see if it overlaps or intersects with the\n\t * point specified by the <code>x</code> and <code>y</code> parameters. The\n\t * <code>x</code> and <code>y</code> parameters specify a point in the\n\t * coordinate space of the Scene, not the display object container that\n\t * contains the display object(unless that display object container is the\n\t * Scene).\n\t *\n\t * @param x         The <i>x</i> coordinate to test against this object.\n\t * @param y         The <i>y</i> coordinate to test against this object.\n\t * @param shapeFlag Whether to check against the actual pixels of the object\n\t *                 (<code>true</code>) or the bounding box\n\t *                 (<code>false</code>).\n\t * @return <code>true</code> if the display object overlaps or intersects\n\t *         with the specified point; <code>false</code> otherwise.\n\t */\n\tpublic hitTestPoint(x:number, y:number, shapeFlag:boolean = false):boolean\n\t{\n\t\treturn false; //TODO\n\t}\n\n\t/**\n\t * Rotates the 3d object around to face a point defined relative to the local coordinates of the parent <code>ObjectContainer3D</code>.\n\t *\n\t * @param    target        The vector defining the point to be looked at\n\t * @param    upAxis        An optional vector used to define the desired up orientation of the 3d object after rotation has occurred\n\t */\n\tpublic lookAt(target:Vector3D, upAxis:Vector3D = null)\n\t{\n\n\t\tvar yAxis:Vector3D;\n\t\tvar zAxis:Vector3D;\n\t\tvar xAxis:Vector3D;\n\t\tvar raw:Array<number>;\n\n\t\tif (upAxis == null)\n\t\t\tupAxis = Vector3D.Y_AXIS;\n\t\telse\n\t\t\tupAxis.normalize();\n\n\t\tzAxis = target.subtract(this._iMatrix3D.position);\n\t\tzAxis.normalize();\n\n\t\txAxis = upAxis.crossProduct(zAxis);\n\t\txAxis.normalize();\n\n\t\tif (xAxis.length < 0.05) {\n\t\t\txAxis.x = upAxis.y;\n\t\t\txAxis.y = upAxis.x;\n\t\t\txAxis.z = 0;\n\t\t\txAxis.normalize();\n\t\t}\n\n\t\tyAxis = zAxis.crossProduct(xAxis);\n\n\t\traw = Matrix3DUtils.RAW_DATA_CONTAINER;\n\n\t\traw[0] = xAxis.x;\n\t\traw[1] = xAxis.y;\n\t\traw[2] = xAxis.z;\n\t\traw[3] = 0;\n\n\t\traw[4] = yAxis.x;\n\t\traw[5] = yAxis.y;\n\t\traw[6] = yAxis.z;\n\t\traw[7] = 0;\n\n\t\traw[8] = zAxis.x;\n\t\traw[9] = zAxis.y;\n\t\traw[10] = zAxis.z;\n\t\traw[11] = 0;\n\n\t\tvar m:Matrix3D = new Matrix3D();\n\t\tm.copyRawDataFrom(raw);\n\n\t\tvar vec:Vector3D = m.decompose()[1];\n\n\t\tthis._rotationX = vec.x;\n\t\tthis._rotationY = vec.y;\n\t\tthis._rotationZ = vec.z;\n\n\t\tthis.invalidateRotation();\n\t}\n\n\t/**\n\t * Converts the <code>point</code> object from the display object's(local)\n\t * coordinates to the Scene(global) coordinates.\n\t *\n\t * <p>This method allows you to convert any given <i>x</i> and <i>y</i>\n\t * coordinates from values that are relative to the origin(0,0) of a\n\t * specific display object(local coordinates) to values that are relative to\n\t * the origin of the Scene(global coordinates).</p>\n\t *\n\t * <p>To use this method, first create an instance of the Point class. The\n\t * <i>x</i> and <i>y</i> values that you assign represent local coordinates\n\t * because they relate to the origin of the display object.</p>\n\t *\n\t * <p>You then pass the Point instance that you created as the parameter to\n\t * the <code>localToGlobal()</code> method. The method returns a new Point\n\t * object with <i>x</i> and <i>y</i> values that relate to the origin of the\n\t * Scene instead of the origin of the display object.</p>\n\t *\n\t * @param point The name or identifier of a point created with the Point\n\t *              class, specifying the <i>x</i> and <i>y</i> coordinates as\n\t *              properties.\n\t * @return A Point object with coordinates relative to the Scene.\n\t */\n\tpublic localToGlobal(point:Point):Point\n\t{\n\t\treturn new Point(); //TODO\n\t}\n\n\t/**\n\t * Converts a three-dimensional point of the three-dimensional display\n\t * object's(local) coordinates to a three-dimensional point in the Scene\n\t * (global) coordinates.\n\t *\n\t * <p>This method allows you to convert any given <i>x</i>, <i>y</i> and\n\t * <i>z</i> coordinates from values that are relative to the origin(0,0,0) of\n\t * a specific display object(local coordinates) to values that are relative to\n\t * the origin of the Scene(global coordinates).</p>\n\t *\n\t * <p>To use this method, first create an instance of the Point class. The\n\t * <i>x</i> and <i>y</i> values that you assign represent local coordinates\n\t * because they relate to the origin of the display object.</p>\n\t *\n\t * <p>You then pass the Vector3D instance that you created as the parameter to\n\t * the <code>localToGlobal3D()</code> method. The method returns a new\n\t * Vector3D object with <i>x</i>, <i>y</i> and <i>z</i> values that relate to\n\t * the origin of the Scene instead of the origin of the display object.</p>\n\t *\n\t * @param position A Vector3D object containing either a three-dimensional\n\t *                position or the coordinates of the three-dimensional\n\t *                display object.\n\t * @return A Vector3D object representing a three-dimensional position in\n\t *         the Scene.\n\t */\n\tpublic localToGlobal3D(position:Vector3D):Vector3D\n\t{\n\t\treturn this.sceneTransform.transformVector(position);\n\t}\n\n\t/**\n\t * Moves the 3d object directly to a point in space\n\t *\n\t * @param    dx        The amount of movement along the local x axis.\n\t * @param    dy        The amount of movement along the local y axis.\n\t * @param    dz        The amount of movement along the local z axis.\n\t */\n\n\tpublic moveTo(dx:number, dy:number, dz:number)\n\t{\n\t\tif (this._x == dx && this._y == dy && this._z == dz)\n\t\t\treturn;\n\n\t\tthis._x = dx;\n\t\tthis._y = dy;\n\t\tthis._z = dz;\n\n\t\tthis.invalidatePosition();\n\t}\n\n\t/**\n\t * Moves the local point around which the object rotates.\n\t *\n\t * @param    dx        The amount of movement along the local x axis.\n\t * @param    dy        The amount of movement along the local y axis.\n\t * @param    dz        The amount of movement along the local z axis.\n\t */\n\tpublic movePivot(dx:number, dy:number, dz:number)\n\t{\n\t\tif (this._pivot == null)\n\t\t\tthis._pivot = new Vector3D();\n\n\t\tthis._pivot.x += dx;\n\t\tthis._pivot.y += dy;\n\t\tthis._pivot.z += dz;\n\n\t\tthis.invalidatePivot();\n\t}\n\n\t/**\n\t * Rotates the 3d object around it's local x-axis\n\t *\n\t * @param    angle        The amount of rotation in degrees\n\t */\n\tpublic pitch(angle:number)\n\t{\n\t\tthis.rotate(Vector3D.X_AXIS, angle);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic getRenderSceneTransform(camera:Camera):Matrix3D\n\t{\n\t\tif (this.orientationMode == OrientationMode.CAMERA_PLANE) {\n\t\t\tvar comps:Array<Vector3D> = camera.sceneTransform.decompose();\n\t\t\tvar scale:Vector3D = comps[2];\n\t\t\tcomps[0] = this.scenePosition;\n\t\t\tscale.x = this._pScaleX;\n\t\t\tscale.y = this._pScaleY;\n\t\t\tscale.z = this._pScaleZ;\n\t\t\tthis._orientationMatrix.recompose(comps);\n\n\t\t\t//add in case of pivot\n\t\t\tif (!this._pivotZero && this.alignmentMode == AlignmentMode.PIVOT_POINT)\n\t\t\t\tthis._orientationMatrix.prependTranslation(-this._pivot.x/this._pScaleX, -this._pivot.y/this._pScaleY, -this._pivot.z/this._pScaleZ);\n\n\t\t\treturn this._orientationMatrix;\n\t\t}\n\n\t\treturn this.sceneTransform;\n\t}\n\n\t/**\n\t * Rotates the 3d object around it's local z-axis\n\t *\n\t * @param    angle        The amount of rotation in degrees\n\t */\n\tpublic roll(angle:number)\n\t{\n\t\tthis.rotate(Vector3D.Z_AXIS, angle);\n\t}\n\n\t/**\n\t * Rotates the 3d object around an axis by a defined angle\n\t *\n\t * @param    axis        The vector defining the axis of rotation\n\t * @param    angle        The amount of rotation in degrees\n\t */\n\tpublic rotate(axis:Vector3D, angle:number)\n\t{\n\t\tvar m:Matrix3D = new Matrix3D();\n\t\tm.prependRotation(angle, axis);\n\n\t\tvar vec:Vector3D = m.decompose()[1];\n\n\t\tthis._rotationX += vec.x;\n\t\tthis._rotationY += vec.y;\n\t\tthis._rotationZ += vec.z;\n\n\t\tthis.invalidateRotation();\n\t}\n\n\t/**\n\t * Rotates the 3d object directly to a euler angle\n\t *\n\t * @param    ax        The angle in degrees of the rotation around the x axis.\n\t * @param    ay        The angle in degrees of the rotation around the y axis.\n\t * @param    az        The angle in degrees of the rotation around the z axis.\n\t */\n\tpublic rotateTo(ax:number, ay:number, az:number)\n\t{\n\t\tthis._rotationX = ax*MathConsts.DEGREES_TO_RADIANS;\n\t\tthis._rotationY = ay*MathConsts.DEGREES_TO_RADIANS;\n\t\tthis._rotationZ = az*MathConsts.DEGREES_TO_RADIANS;\n\n\t\tthis.invalidateRotation();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic removeEventListener(type:string, listener:Function)\n\t{\n\t\tsuper.removeEventListener(type, listener);\n\n\t\tif (this.hasEventListener(type, listener))\n\t\t\treturn;\n\n\t\tswitch (type) {\n\t\t\tcase DisplayObjectEvent.POSITION_CHANGED:\n\t\t\t\tthis._listenToPositionChanged = false;\n\t\t\t\tbreak;\n\n\t\t\tcase DisplayObjectEvent.ROTATION_CHANGED:\n\t\t\t\tthis._listenToRotationChanged = false;\n\t\t\t\tbreak;\n\n\t\t\tcase DisplayObjectEvent.SCALE_CHANGED:\n\t\t\t\tthis._listenToScaleChanged = false;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Moves the 3d object along a vector by a defined length\n\t *\n\t * @param    axis        The vector defining the axis of movement\n\t * @param    distance    The length of the movement\n\t */\n\tpublic translate(axis:Vector3D, distance:number)\n\t{\n\t\tvar x:number = axis.x, y:number = axis.y, z:number = axis.z;\n\t\tvar len:number = distance/Math.sqrt(x*x + y*y + z*z);\n\n\t\tthis._x += x*len;\n\t\tthis._y += y*len;\n\t\tthis._z += z*len;\n\n\t\tthis.invalidatePosition();\n\t}\n\n\t/**\n\t * Moves the 3d object along a vector by a defined length\n\t *\n\t * @param    axis        The vector defining the axis of movement\n\t * @param    distance    The length of the movement\n\t */\n\tpublic translateLocal(axis:Vector3D, distance:number)\n\t{\n\t\tvar x:number = axis.x, y:number = axis.y, z:number = axis.z;\n\t\tvar len:number = distance/Math.sqrt(x*x + y*y + z*z);\n\n\t\tthis._iMatrix3D.prependTranslation(x*len, y*len, z*len);\n\n\t\tthis._matrix3D.copyColumnTo(3, this._pos);\n\n\t\tthis._x = this._pos.x;\n\t\tthis._y = this._pos.y;\n\t\tthis._z = this._pos.z;\n\n\t\tthis.invalidatePosition();\n\t}\n\n\t/**\n\t * Rotates the 3d object around it's local y-axis\n\t *\n\t * @param    angle        The amount of rotation in degrees\n\t */\n\tpublic yaw(angle:number)\n\t{\n\t\tthis.rotate(Vector3D.Y_AXIS, angle);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iController:ControllerBase;\n\n\t/**\n\t * @internal\n\t */\n\tpublic get _iAssignedPartition():Partition\n\t{\n\t\treturn this._pImplicitPartition;\n\t}\n\n\t/**\n\t * The transformation of the 3d object, relative to the local coordinates of the parent <code>ObjectContainer3D</code>.\n\t *\n\t * @internal\n\t */\n\tpublic get _iMatrix3D():Matrix3D\n\t{\n\t\tif (this._matrix3DDirty)\n\t\t\tthis._pUpdateMatrix3D();\n\n\t\treturn this._matrix3D;\n\t}\n\n\tpublic set _iMatrix3D(val:Matrix3D)\n\t{\n\n\t\t// TODO: From AS3 - Do we still need this in JS ?\n\t\t//ridiculous matrix error\n\t\t/*\n\t\tif (!val.rawData[0]) {\n\n\t\t\tvar raw:number[] = Matrix3DUtils.RAW_DATA_CONTAINER;\n\t\t\tval.copyRawDataTo(raw);\n\t\t\traw[0] = this._smallestNumber;\n\t\t\tval.copyRawDataFrom(raw);\n\t\t}\n\t\t//*/\n\t\tvar elements:Array<Vector3D> = val.decompose();\n\t\tvar vec:Vector3D;\n\n\t\tvec = elements[0];\n\n\t\tif (this._x != vec.x || this._y != vec.y || this._z != vec.z) {\n\t\t\tthis._x = vec.x;\n\t\t\tthis._y = vec.y;\n\t\t\tthis._z = vec.z;\n\n\t\t\tthis.invalidatePosition();\n\t\t}\n\n\t\tvec = elements[1];\n\n\t\tif (this._rotationX != vec.x || this._rotationY != vec.y || this._rotationZ != vec.z) {\n\t\t\tthis._rotationX = vec.x;\n\t\t\tthis._rotationY = vec.y;\n\t\t\tthis._rotationZ = vec.z;\n\n\t\t\tthis.invalidateRotation();\n\t\t}\n\n\t\tvec = elements[2];\n\n\t\tif (this._pScaleX != vec.x || this._pScaleY != vec.y || this._pScaleZ != vec.z) {\n\t\t\tthis._pScaleX = vec.x;\n\t\t\tthis._pScaleY = vec.y;\n\t\t\tthis._pScaleZ = vec.z;\n\n\t\t\tthis.invalidateScale();\n\t\t}\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic get _iPickingCollisionVO():PickingCollisionVO\n\t{\n\t\tif (!this._pPickingCollisionVO)\n\t\t\tthis._pPickingCollisionVO = new PickingCollisionVO(this);\n\n\t\treturn this._pPickingCollisionVO;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic iSetParent(value:DisplayObjectContainer)\n\t{\n\t\tthis._pParent = value;\n\n\t\tif (value) {\n\t\t\tthis._pUpdateImplicitMouseEnabled(value.mouseChildren);\n\t\t\tthis._pUpdateImplicitVisibility(value._iIsVisible());\n\t\t\tthis._pUpdateImplicitPartition(value._iAssignedPartition, value._pScene);\n\t\t} else {\n\t\t\tthis._pUpdateImplicitMouseEnabled(true);\n\t\t\tthis._pUpdateImplicitVisibility(true);\n\t\t\tthis._pUpdateImplicitPartition(null, null);\n\t\t}\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tpublic pInvalidateSceneTransform()\n\t{\n\t\tthis._pSceneTransformDirty = !this._pIgnoreTransform;\n\t\tthis._inverseSceneTransformDirty = !this._pIgnoreTransform;\n\t\tthis._scenePositionDirty = !this._pIgnoreTransform;\n\n\t\tif (this.isEntity)\n\t\t\tthis.invalidatePartition();\n\n\t\tif (this._listenToSceneTransformChanged)\n\t\t\tthis.notifySceneTransformChange();\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tpublic _pUpdateImplicitMouseEnabled(value:boolean)\n\t{\n\t\tthis._pImplicitMouseEnabled = this._explicitMouseEnabled && value;\n\n\t\t// If there is a parent and this child does not have a picking collider, use its parent's picking collider.\n\t\tif (this._pImplicitMouseEnabled && this._pParent && !this._pPickingCollider)\n\t\t\tthis._pPickingCollider =  this._pParent._pPickingCollider;\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tpublic _pUpdateImplicitPartition(partition:Partition, scene:Scene)\n\t{\n\t\tvar sceneChanged:boolean = this._pScene != scene;\n\n\t\tif (sceneChanged && this._pScene)\n\t\t\tthis._pScene.dispatchEvent(new SceneEvent(SceneEvent.REMOVED_FROM_SCENE, this));\n\n\t\tif (this._pScene && this._pImplicitPartition) {\n\t\t\t//unregister partition from current scene\n\t\t\tthis._pScene._iUnregisterPartition(this._pImplicitPartition);\n\n\t\t\t//unregister entity from current partition\n\t\t\tif (this._pIsEntity)\n\t\t\t\tthis._pUnregisterEntity(this._pImplicitPartition);\n\t\t}\n\n\t\t// assign parent implicit partition if no explicit one is given\n\t\tthis._pImplicitPartition = this._explicitPartition || partition;\n\n\t\t//assign scene\n\t\tif (sceneChanged)\n\t\t\tthis._pScene = scene;\n\n\t\tif (this._pScene && this._pImplicitPartition) {\n\t\t\t//register partition with scene\n\t\t\tthis._pScene._iRegisterPartition(this._pImplicitPartition);\n\n\t\t\t//register entity with new partition\n\t\t\tif (this._pIsEntity)\n\t\t\t\tthis._pRegisterEntity(this._pImplicitPartition);\n\t\t}\n\n\t\tif (sceneChanged && this._pScene)\n\t\t\tthis._pScene.dispatchEvent(new SceneEvent(SceneEvent.ADDED_TO_SCENE, this));\n\n\t\tif (sceneChanged) {\n\t\t\tif (!this._pSceneTransformDirty && !this._pIgnoreTransform)\n\t\t\t\tthis.pInvalidateSceneTransform();\n\n\t\t\tif (this._listenToSceneChanged)\n\t\t\t\tthis.notifySceneChange();\n\t\t}\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tpublic _pUpdateImplicitVisibility(value:boolean)\n\t{\n\t\tthis._pImplicitVisibility = this._explicitVisibility && value;\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tpublic _pUpdateMatrix3D()\n\t{\n\n\t\tthis._pos.x = this._x;\n\t\tthis._pos.y = this._y;\n\t\tthis._pos.z = this._z;\n\n\t\tthis._rot.x = this._rotationX;\n\t\tthis._rot.y = this._rotationY;\n\t\tthis._rot.z = this._rotationZ;\n\n\t\tthis._sca.x = this._pScaleX;\n\t\tthis._sca.y = this._pScaleY;\n\t\tthis._sca.z = this._pScaleZ;\n\n\t\tthis._matrix3D.recompose(this._transformComponents);\n\n\t\tif (!this._pivotZero) {\n\t\t\tthis._matrix3D.prependTranslation(-this._pivot.x/this._pScaleX, -this._pivot.y/this._pScaleY, -this._pivot.z/this._pScaleZ);\n\t\t\tif (this.alignmentMode != AlignmentMode.PIVOT_POINT)\n\t\t\t\tthis._matrix3D.appendTranslation(this._pivot.x, this._pivot.y, this._pivot.z);\n\t\t}\n\n\t\tthis._matrix3DDirty = false;\n\t\tthis._positionDirty = false;\n\t\tthis._rotationDirty = false;\n\t\tthis._scaleDirty = false;\n\t\tthis._pivotDirty = false;\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tpublic pUpdateSceneTransform()\n\t{\n\t\tif (this._pParent && !this._pParent._iIsRoot) {\n\t\t\tthis._pSceneTransform.copyFrom(this._pParent.sceneTransform);\n\t\t\tthis._pSceneTransform.prepend(this._iMatrix3D);\n\t\t} else {\n\t\t\tthis._pSceneTransform.copyFrom(this._iMatrix3D);\n\t\t}\n\n\t\tthis._pSceneTransformDirty = false;\n\t}\n\n\tpublic _iAddRenderable(renderable:IRenderable):IRenderable\n\t{\n\t\tthis._pRenderables.push(renderable);\n\n\t\treturn renderable;\n\t}\n\n\n\tpublic _iRemoveRenderable(renderable:IRenderable):IRenderable\n\t{\n\t\tvar index:number = this._pRenderables.indexOf(renderable);\n\n\t\tthis._pRenderables.splice(index, 1);\n\n\t\treturn renderable;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param shortestCollisionDistance\n\t * @param findClosest\n\t * @returns {boolean}\n\t *\n\t * @internal\n\t */\n\tpublic _iTestCollision(shortestCollisionDistance:number, findClosest:boolean):boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic _iInternalUpdate()\n\t{\n\t\tif (this._iController)\n\t\t\tthis._iController.update();\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iIsVisible():boolean\n\t{\n\t\treturn this._pImplicitVisibility;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iIsMouseEnabled():boolean\n\t{\n\t\treturn this._pImplicitMouseEnabled;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iSetScene(value:Scene)\n\t{\n\t\tif (this._pScene == value)\n\t\t\treturn;\n\n\t\tthis._pUpdateImplicitPartition(this._pParent? this._pParent._iAssignedPartition : null, value);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate notifyPositionChanged()\n\t{\n\t\tif (!this._positionChanged)\n\t\t\tthis._positionChanged = new DisplayObjectEvent(DisplayObjectEvent.POSITION_CHANGED, this);\n\n\t\tthis.dispatchEvent(this._positionChanged);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate notifyRotationChanged()\n\t{\n\t\tif (!this._rotationChanged)\n\t\t\tthis._rotationChanged = new DisplayObjectEvent(DisplayObjectEvent.ROTATION_CHANGED, this);\n\n\t\tthis.dispatchEvent(this._rotationChanged);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate notifyScaleChanged()\n\t{\n\t\tif (!this._scaleChanged)\n\t\t\tthis._scaleChanged = new DisplayObjectEvent(DisplayObjectEvent.SCALE_CHANGED, this);\n\n\t\tthis.dispatchEvent(this._scaleChanged);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate notifySceneChange()\n\t{\n\t\tif (!this._scenechanged)\n\t\t\tthis._scenechanged = new DisplayObjectEvent(DisplayObjectEvent.SCENE_CHANGED, this);\n\n\t\tthis.dispatchEvent(this._scenechanged);\n}\n\n\t/**\n\t * @private\n\t */\n\tprivate notifySceneTransformChange()\n\t{\n\t\tif (!this._sceneTransformChanged)\n\t\t\tthis._sceneTransformChanged = new DisplayObjectEvent(DisplayObjectEvent.SCENETRANSFORM_CHANGED, this);\n\n\t\tthis.dispatchEvent(this._sceneTransformChanged);\n\t}\n\n\t/**\n\t * Invalidates the 3D transformation matrix, causing it to be updated upon the next request\n\t *\n\t * @private\n\t */\n\tprivate invalidateMatrix3D():void\n\t{\n\t\tif (this._matrix3DDirty)\n\t\t\treturn;\n\n\t\tthis._matrix3DDirty = true;\n\n\t\tif (!this._pSceneTransformDirty && !this._pIgnoreTransform)\n\t\t\tthis.pInvalidateSceneTransform();\n\t}\n\n\t/**\n\t * @private\n\t */\n\tpublic invalidatePartition()\n\t{\n\t\tvar len:number = this._entityNodes.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._entityNodes[i].invalidatePartition();\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate invalidatePivot()\n\t{\n\t\tthis._pivotZero = (this._pivot.x == 0) && (this._pivot.y == 0) && (this._pivot.z == 0);\n\n\t\tif (this._pivotDirty)\n\t\t\treturn;\n\n\t\tthis._pivotDirty = true;\n\n\t\tthis.invalidateMatrix3D();\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate invalidatePosition()\n\t{\n\t\tif (this._positionDirty)\n\t\t\treturn;\n\n\t\tthis._positionDirty = true;\n\n\t\tthis.invalidateMatrix3D();\n\n\t\tif (this._listenToPositionChanged)\n\t\t\tthis.notifyPositionChanged();\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate invalidateRotation()\n\t{\n\t\tif (this._rotationDirty)\n\t\t\treturn;\n\n\t\tthis._rotationDirty = true;\n\n\t\tthis.invalidateMatrix3D();\n\n\t\tif (this._listenToRotationChanged)\n\t\t\tthis.notifyRotationChanged();\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate invalidateScale()\n\t{\n\t\tif (this._scaleDirty)\n\t\t\treturn;\n\n\t\tthis._scaleDirty = true;\n\n\t\tthis.invalidateMatrix3D();\n\n\t\tif (this._listenToScaleChanged)\n\t\t\tthis.notifyScaleChanged();\n\t}\n\n\n\tpublic _iAddEntityNode(entityNode:EntityNode):EntityNode\n\t{\n\t\tthis._entityNodes.push(entityNode);\n\n\t\treturn entityNode;\n\t}\n\n\n\tpublic _iRemoveEntityNode(entityNode:EntityNode):EntityNode\n\t{\n\t\tvar index:number = this._entityNodes.indexOf(entityNode);\n\n\t\tthis._entityNodes.splice(index, 1);\n\n\t\treturn entityNode;\n\t}\n\n\tpublic _pRegisterEntity(partition:Partition)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic _pUnregisterEntity(partition:Partition)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic _pInvalidateBounds()\n\t{\n\t\tthis._boxBoundsInvalid = true;\n\t\tthis._sphereBoundsInvalid = true;\n\n\t\tif (this.isEntity)\n\t\t\tthis.invalidatePartition();\n\t}\n\t\n\tpublic _pUpdateBoxBounds()\n\t{\n\t\tthis._boxBoundsInvalid = false;\n\t\t\n\t\tif (this._pBoxBounds == null)\n\t\t\tthis._pBoxBounds = new Box();\n\t}\n\n\tpublic _pUpdateSphereBounds()\n\t{\n\t\tthis._sphereBoundsInvalid = false;\n\n\t\tif (this._pSphereBounds == null)\n\t\t\tthis._pSphereBounds = new Sphere();\n\t}\n}\n\nexport = DisplayObject;","import Matrix3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport AssetType\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport NamedAssetBase\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\n\nimport SubGeometryBase\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport GeometryEvent\t\t\t= require(\"awayjs-display/lib/events/GeometryEvent\");\n\n/**\n *\n * Geometry is a collection of SubGeometries, each of which contain the actual geometrical data such as vertices,\n * normals, uvs, etc. It also contains a reference to an animation class, which defines how the geometry moves.\n * A Geometry object is assigned to a Mesh, a scene graph occurence of the geometry, which in turn assigns\n * the SubGeometries to its respective TriangleSubMesh objects.\n *\n *\n *\n * @see away.core.base.SubGeometry\n * @see away.entities.Mesh\n *\n * @class Geometry\n */\nclass Geometry extends NamedAssetBase implements IAsset\n{\n\tprivate _subGeometries:Array<SubGeometryBase>;\n\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.GEOMETRY;\n\t}\n\n\t/**\n\t * A collection of TriangleSubGeometry objects, each of which contain geometrical data such as vertices, normals, etc.\n\t */\n\tpublic get subGeometries():Array<SubGeometryBase>\n\t{\n\t\treturn this._subGeometries;\n\t}\n\n\tpublic getSubGeometries():Array<SubGeometryBase>\n\t{\n\t\treturn this._subGeometries;\n\t}\n\n\t/**\n\t * Creates a new Geometry object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._subGeometries = new Array<SubGeometryBase>();\n\t}\n\n\tpublic applyTransformation(transform:Matrix3D)\n\t{\n\t\tvar len:number = this._subGeometries.length;\n\t\tfor (var i:number = 0; i < len; ++i)\n\t\t\tthis._subGeometries[i].applyTransformation(transform);\n\t}\n\n\t/**\n\t * Adds a new TriangleSubGeometry object to the list.\n\t * @param subGeometry The TriangleSubGeometry object to be added.\n\t */\n\tpublic addSubGeometry(subGeometry:SubGeometryBase)\n\t{\n\t\tthis._subGeometries.push(subGeometry);\n\n\t\tsubGeometry.parentGeometry = this;\n\n\t\tif (this.hasEventListener(GeometryEvent.SUB_GEOMETRY_ADDED))\n\t\t\tthis.dispatchEvent(new GeometryEvent(GeometryEvent.SUB_GEOMETRY_ADDED, subGeometry));\n\n\t\tthis.iInvalidateBounds(subGeometry);\n\t}\n\n\t/**\n\t * Removes a new TriangleSubGeometry object from the list.\n\t * @param subGeometry The TriangleSubGeometry object to be removed.\n\t */\n\tpublic removeSubGeometry(subGeometry:SubGeometryBase)\n\t{\n\t\tthis._subGeometries.splice(this._subGeometries.indexOf(subGeometry), 1);\n\n\t\tsubGeometry.parentGeometry = null;\n\n\t\tif (this.hasEventListener(GeometryEvent.SUB_GEOMETRY_REMOVED))\n\t\t\tthis.dispatchEvent(new GeometryEvent(GeometryEvent.SUB_GEOMETRY_REMOVED, subGeometry));\n\n\t\tthis.iInvalidateBounds(subGeometry);\n\t}\n\n\t/**\n\t * Clones the geometry.\n\t * @return An exact duplicate of the current Geometry object.\n\t */\n\tpublic clone():Geometry\n\t{\n\t\tvar clone:Geometry = new Geometry();\n\t\tvar len:number = this._subGeometries.length;\n\n\t\tfor (var i:number = 0; i < len; ++i)\n\t\t\tclone.addSubGeometry(this._subGeometries[i].clone());\n\n\t\treturn clone;\n\t}\n\n\t/**\n\t * Scales the geometry.\n\t * @param scale The amount by which to scale.\n\t */\n\tpublic scale(scale:number)\n\t{\n\t\tvar numSubGeoms:number = this._subGeometries.length;\n\t\tfor (var i:number = 0; i < numSubGeoms; ++i)\n\t\t\tthis._subGeometries[i].scale(scale);\n\t}\n\n\t/**\n\t * Clears all resources used by the Geometry object, including SubGeometries.\n\t */\n\tpublic dispose()\n\t{\n\t\tvar numSubGeoms:number = this._subGeometries.length;\n\n\t\tfor (var i:number = 0; i < numSubGeoms; ++i) {\n\t\t\tvar subGeom:SubGeometryBase = this._subGeometries[0];\n\t\t\tthis.removeSubGeometry(subGeom);\n\t\t\tsubGeom.dispose();\n\t\t}\n\t}\n\n\t/**\n\t * Scales the uv coordinates (tiling)\n\t * @param scaleU The amount by which to scale on the u axis. Default is 1;\n\t * @param scaleV The amount by which to scale on the v axis. Default is 1;\n\t */\n\tpublic scaleUV(scaleU:number = 1, scaleV:number = 1)\n\t{\n\t\tvar numSubGeoms:number = this._subGeometries.length;\n\n\t\tfor (var i:number = 0; i < numSubGeoms; ++i)\n\t\t\tthis._subGeometries[i].scaleUV(scaleU, scaleV);\n\t}\n\n\tpublic iInvalidateBounds(subGeom:SubGeometryBase)\n\t{\n\t\tif (this.hasEventListener(GeometryEvent.BOUNDS_INVALID))\n\t\t\tthis.dispatchEvent(new GeometryEvent(GeometryEvent.BOUNDS_INVALID, subGeom));\n\t}\n}\n\nexport = Geometry;","/**\n * The GradientType class provides values for the <code>type</code> parameter\n * in the <code>beginGradientFill()</code> and\n * <code>lineGradientStyle()</code> methods of the flash.display.Graphics\n * class.\n */\nclass GradientType\n{\n\t/**\n\t * Value used to specify a linear gradient fill.\n\t */\n\tpublic static LINEAR:string = \"linear\";\n\n\t/**\n\t * Value used to specify a radial gradient fill.\n\t */\n\tpublic static RADIAL:string = \"radial\";\n}\n\nexport = GradientType;","/**\n * The GraphicsPathWinding class provides values for the\n * <code>flash.display.GraphicsPath.winding</code> property and the\n * <code>flash.display.Graphics.drawPath()</code> method to determine the\n * direction to draw a path. A clockwise path is positively wound, and a\n * counter-clockwise path is negatively wound:\n *\n * <p> When paths intersect or overlap, the winding direction determines the\n * rules for filling the areas created by the intersection or overlap:</p>\n */\nclass GraphicsPathWinding\n{\n\tpublic static EVEN_ODD:string = \"evenOdd\";\n\tpublic static NON_ZERO:string = \"nonZero\";\n}\n\nexport = GraphicsPathWinding;","import BitmapData\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport Matrix\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\n\nimport CapsStyle\t\t\t\t= require(\"awayjs-display/lib/base/CapsStyle\");\nimport GradientType\t\t\t\t= require(\"awayjs-display/lib/base/GradientType\");\nimport GraphicsPathWinding\t\t= require(\"awayjs-display/lib/base/GraphicsPathWinding\");\nimport IGraphicsData\t\t\t= require(\"awayjs-display/lib/base/IGraphicsData\");\nimport InterpolationMethod\t\t= require(\"awayjs-display/lib/base/InterpolationMethod\");\nimport JointStyle\t\t\t\t= require(\"awayjs-display/lib/base/JointStyle\");\nimport LineScaleMode\t\t\t= require(\"awayjs-display/lib/base/LineScaleMode\");\nimport TriangleCulling\t\t\t= require(\"awayjs-display/lib/base/TriangleCulling\");\nimport SpreadMethod\t\t\t\t= require(\"awayjs-display/lib/base/SpreadMethod\");\n\n/**\n * The Graphics class contains a set of methods that you can use to create a\n * vector shape. Display objects that support drawing include Sprite and Shape\n * objects. Each of these classes includes a <code>graphics</code> property\n * that is a Graphics object. The following are among those helper functions\n * provided for ease of use: <code>drawRect()</code>,\n * <code>drawRoundRect()</code>, <code>drawCircle()</code>, and\n * <code>drawEllipse()</code>.\n *\n * <p>You cannot create a Graphics object directly from ActionScript code. If\n * you call <code>new Graphics()</code>, an exception is thrown.</p>\n *\n * <p>The Graphics class is final; it cannot be subclassed.</p>\n */\nclass Graphics\n{\n\t/**\n\t * Fills a drawing area with a bitmap image. The bitmap can be repeated or\n\t * tiled to fill the area. The fill remains in effect until you call the\n\t * <code>beginFill()</code>, <code>beginBitmapFill()</code>,\n\t * <code>beginGradientFill()</code>, or <code>beginShaderFill()</code>\n\t * method. Calling the <code>clear()</code> method clears the fill.\n\t *\n\t * <p>The application renders the fill whenever three or more points are\n\t * drawn, or when the <code>endFill()</code> method is called. </p>\n\t *\n\t * @param bitmap A transparent or opaque bitmap image that contains the bits\n\t *               to be displayed.\n\t * @param matrix A matrix object(of the flash.geom.Matrix class), which you\n\t *               can use to define transformations on the bitmap. For\n\t *               example, you can use the following matrix to rotate a bitmap\n\t *               by 45 degrees(pi/4 radians):\n\t * @param repeat If <code>true</code>, the bitmap image repeats in a tiled\n\t *               pattern. If <code>false</code>, the bitmap image does not\n\t *               repeat, and the edges of the bitmap are used for any fill\n\t *               area that extends beyond the bitmap.\n\t *\n\t *               <p>For example, consider the following bitmap(a 20 x\n\t *               20-pixel checkerboard pattern):</p>\n\t *\n\t *               <p>When <code>repeat</code> is set to <code>true</code>(as\n\t *               in the following example), the bitmap fill repeats the\n\t *               bitmap:</p>\n\t *\n\t *               <p>When <code>repeat</code> is set to <code>false</code>,\n\t *               the bitmap fill uses the edge pixels for the fill area\n\t *               outside the bitmap:</p>\n\t * @param smooth If <code>false</code>, upscaled bitmap images are rendered\n\t *               by using a nearest-neighbor algorithm and look pixelated. If\n\t *               <code>true</code>, upscaled bitmap images are rendered by\n\t *               using a bilinear algorithm. Rendering by using the nearest\n\t *               neighbor algorithm is faster.\n\t */\n\tpublic beginBitmapFill(bitmap:BitmapData, matrix:Matrix = null, repeat:boolean = true, smooth:boolean = false)\n\t{\n\n\t}\n\n\t/**\n\t * Specifies a simple one-color fill that subsequent calls to other Graphics\n\t * methods(such as <code>lineTo()</code> or <code>drawCircle()</code>) use\n\t * when drawing. The fill remains in effect until you call the\n\t * <code>beginFill()</code>, <code>beginBitmapFill()</code>,\n\t * <code>beginGradientFill()</code>, or <code>beginShaderFill()</code>\n\t * method. Calling the <code>clear()</code> method clears the fill.\n\t *\n\t * <p>The application renders the fill whenever three or more points are\n\t * drawn, or when the <code>endFill()</code> method is called.</p>\n\t *\n\t * @param color The color of the fill(0xRRGGBB).\n\t * @param alpha The alpha value of the fill(0.0 to 1.0).\n\t */\n\tpublic beginFill(color:number /*int*/, alpha:number = 1)\n\t{\n\n\t}\n\n\t/**\n\t * Specifies a gradient fill used by subsequent calls to other Graphics\n\t * methods(such as <code>lineTo()</code> or <code>drawCircle()</code>) for\n\t * the object. The fill remains in effect until you call the\n\t * <code>beginFill()</code>, <code>beginBitmapFill()</code>,\n\t * <code>beginGradientFill()</code>, or <code>beginShaderFill()</code>\n\t * method. Calling the <code>clear()</code> method clears the fill.\n\t *\n\t * <p>The application renders the fill whenever three or more points are\n\t * drawn, or when the <code>endFill()</code> method is called. </p>\n\t *\n\t * @param type                A value from the GradientType class that\n\t *                            specifies which gradient type to use:\n\t *                            <code>GradientType.LINEAR</code> or\n\t *                            <code>GradientType.RADIAL</code>.\n\t * @param colors              An array of RGB hexadecimal color values used\n\t *                            in the gradient; for example, red is 0xFF0000,\n\t *                            blue is 0x0000FF, and so on. You can specify\n\t *                            up to 15 colors. For each color, specify a\n\t *                            corresponding value in the alphas and ratios\n\t *                            parameters.\n\t * @param alphas              An array of alpha values for the corresponding\n\t *                            colors in the colors array; valid values are 0\n\t *                            to 1. If the value is less than 0, the default\n\t *                            is 0. If the value is greater than 1, the\n\t *                            default is 1.\n\t * @param ratios              An array of color distribution ratios; valid\n\t *                            values are 0-255. This value defines the\n\t *                            percentage of the width where the color is\n\t *                            sampled at 100%. The value 0 represents the\n\t *                            left position in the gradient box, and 255\n\t *                            represents the right position in the gradient\n\t *                            box.\n\t * @param matrix              A transformation matrix as defined by the\n\t *                            flash.geom.Matrix class. The flash.geom.Matrix\n\t *                            class includes a\n\t *                            <code>createGradientBox()</code> method, which\n\t *                            lets you conveniently set up the matrix for use\n\t *                            with the <code>beginGradientFill()</code>\n\t *                            method.\n\t * @param spreadMethod        A value from the SpreadMethod class that\n\t *                            specifies which spread method to use, either:\n\t *                            <code>SpreadMethod.PAD</code>,\n\t *                            <code>SpreadMethod.REFLECT</code>, or\n\t *                            <code>SpreadMethod.REPEAT</code>.\n\t *\n\t *                            <p>For example, consider a simple linear\n\t *                            gradient between two colors:</p>\n\t *\n\t *                            <p>This example uses\n\t *                            <code>SpreadMethod.PAD</code> for the spread\n\t *                            method, and the gradient fill looks like the\n\t *                            following:</p>\n\t *\n\t *                            <p>If you use <code>SpreadMethod.REFLECT</code>\n\t *                            for the spread method, the gradient fill looks\n\t *                            like the following:</p>\n\t *\n\t *                            <p>If you use <code>SpreadMethod.REPEAT</code>\n\t *                            for the spread method, the gradient fill looks\n\t *                            like the following:</p>\n\t * @param interpolationMethod A value from the InterpolationMethod class that\n\t *                            specifies which value to use:\n\t *                            <code>InterpolationMethod.LINEAR_RGB</code> or\n\t *                            <code>InterpolationMethod.RGB</code>\n\t *\n\t *                            <p>For example, consider a simple linear\n\t *                            gradient between two colors(with the\n\t *                            <code>spreadMethod</code> parameter set to\n\t *                            <code>SpreadMethod.REFLECT</code>). The\n\t *                            different interpolation methods affect the\n\t *                            appearance as follows: </p>\n\t * @param focalPointRatio     A number that controls the location of the\n\t *                            focal point of the gradient. 0 means that the\n\t *                            focal point is in the center. 1 means that the\n\t *                            focal point is at one border of the gradient\n\t *                            circle. -1 means that the focal point is at the\n\t *                            other border of the gradient circle. A value\n\t *                            less than -1 or greater than 1 is rounded to -1\n\t *                            or 1. For example, the following example shows\n\t *                            a <code>focalPointRatio</code> set to 0.75:\n\t * @throws ArgumentError If the <code>type</code> parameter is not valid.\n\t */\n\tpublic beginGradientFill(type:GradientType, colors:Array<number /*int*/>, alphas:Array<number>, ratios:Array<number /*int*/>, matrix:Matrix = null, spreadMethod:string = \"pad\", interpolationMethod:string = \"rgb\", focalPointRatio:number = 0)\n\t{\n\n\t}\n\n\t/**\n\t * Specifies a shader fill used by subsequent calls to other Graphics methods\n\t * (such as <code>lineTo()</code> or <code>drawCircle()</code>) for the\n\t * object. The fill remains in effect until you call the\n\t * <code>beginFill()</code>, <code>beginBitmapFill()</code>,\n\t * <code>beginGradientFill()</code>, or <code>beginShaderFill()</code>\n\t * method. Calling the <code>clear()</code> method clears the fill.\n\t *\n\t * <p>The application renders the fill whenever three or more points are\n\t * drawn, or when the <code>endFill()</code> method is called.</p>\n\t *\n\t * <p>Shader fills are not supported under GPU rendering; filled areas will\n\t * be colored cyan.</p>\n\t *\n\t * @param shader The shader to use for the fill. This Shader instance is not\n\t *               required to specify an image input. However, if an image\n\t *               input is specified in the shader, the input must be provided\n\t *               manually. To specify the input, set the <code>input</code>\n\t *               property of the corresponding ShaderInput property of the\n\t *               <code>Shader.data</code> property.\n\t *\n\t *               <p>When you pass a Shader instance as an argument the shader\n\t *               is copied internally. The drawing fill operation uses that\n\t *               internal copy, not a reference to the original shader. Any\n\t *               changes made to the shader, such as changing a parameter\n\t *               value, input, or bytecode, are not applied to the copied\n\t *               shader that's used for the fill.</p>\n\t * @param matrix A matrix object(of the flash.geom.Matrix class), which you\n\t *               can use to define transformations on the shader. For\n\t *               example, you can use the following matrix to rotate a shader\n\t *               by 45 degrees(pi/4 radians):\n\t *\n\t *               <p>The coordinates received in the shader are based on the\n\t *               matrix that is specified for the <code>matrix</code>\n\t *               parameter. For a default(<code>null</code>) matrix, the\n\t *               coordinates in the shader are local pixel coordinates which\n\t *               can be used to sample an input.</p>\n\t * @throws ArgumentError When the shader output type is not compatible with\n\t *                       this operation(the shader must specify a\n\t *                       <code>pixel3</code> or <code>pixel4</code> output).\n\t * @throws ArgumentError When the shader specifies an image input that isn't\n\t *                       provided.\n\t * @throws ArgumentError When a ByteArray or Vector.<Number> instance is used\n\t *                       as an input and the <code>width</code> and\n\t *                       <code>height</code> properties aren't specified for\n\t *                       the ShaderInput, or the specified values don't match\n\t *                       the amount of data in the input object. See the\n\t *                       <code>ShaderInput.input</code> property for more\n\t *                       information.\n\t */\n//\t\tpublic beginShaderFill(shader:Shader, matrix:Matrix = null)\n//\t\t{\n//\n//\t\t}\n\n\t/**\n\t * Clears the graphics that were drawn to this Graphics object, and resets\n\t * fill and line style settings.\n\t *\n\t */\n\tpublic clear()\n\t{\n\n\t}\n\n\t/**\n\t * Copies all of drawing commands from the source Graphics object into the\n\t * calling Graphics object.\n\t *\n\t * @param sourceGraphics The Graphics object from which to copy the drawing\n\t *                       commands.\n\t */\n\tpublic copyFrom(sourceGraphics:Graphics)\n\t{\n\n\t}\n\n\t/**\n\t * Draws a cubic Bezier curve from the current drawing position to the\n\t * specified anchor point. Cubic Bezier curves consist of two anchor points\n\t * and two control points. The curve interpolates the two anchor points and\n\t * curves toward the two control points.\n\t *\n\t * The four points you use to draw a cubic Bezier curve with the\n\t * <code>cubicCurveTo()</code> method are as follows:\n\t *\n\t * <ul>\n\t *   <li>The current drawing position is the first anchor point. </li>\n\t *   <li>The anchorX and anchorY parameters specify the second anchor point.\n\t *   </li>\n\t *   <li>The <code>controlX1</code> and <code>controlY1</code> parameters\n\t *   specify the first control point.</li>\n\t *   <li>The <code>controlX2</code> and <code>controlY2</code> parameters\n\t *   specify the second control point.</li>\n\t * </ul>\n\t *\n\t * If you call the <code>cubicCurveTo()</code> method before calling the\n\t * <code>moveTo()</code> method, your curve starts at position (0, 0).\n\t *\n\t * If the <code>cubicCurveTo()</code> method succeeds, the Flash runtime sets\n\t * the current drawing position to (<code>anchorX</code>,\n\t * <code>anchorY</code>). If the <code>cubicCurveTo()</code> method fails,\n\t * the current drawing position remains unchanged.\n\t *\n\t * If your movie clip contains content created with the Flash drawing tools,\n\t * the results of calls to the <code>cubicCurveTo()</code> method are drawn\n\t * underneath that content.\n\t *\n\t * @param controlX1 Specifies the horizontal position of the first control\n\t *                  point relative to the registration point of the parent\n\t *                  display object.\n\t * @param controlY1 Specifies the vertical position of the first control\n\t *                  point relative to the registration point of the parent\n\t *                  display object.\n\t * @param controlX2 Specifies the horizontal position of the second control\n\t *                  point relative to the registration point of the parent\n\t *                  display object.\n\t * @param controlY2 Specifies the vertical position of the second control\n\t *                  point relative to the registration point of the parent\n\t *                  display object.\n\t * @param anchorX   Specifies the horizontal position of the anchor point\n\t *                  relative to the registration point of the parent display\n\t *                  object.\n\t * @param anchorY   Specifies the vertical position of the anchor point\n\t *                  relative to the registration point of the parent display\n\t *                  object.\n\t */\n\tpublic cubicCurveTo(controlX1:number, controlY1:number, controlX2:number, controlY2:number, anchorX:number, anchorY:number)\n\t{\n\n\t}\n\n\t/**\n\t * Draws a curve using the current line style from the current drawing\n\t * position to(anchorX, anchorY) and using the control point that\n\t * (<code>controlX</code>, <code>controlY</code>) specifies. The current\n\t * drawing position is then set to(<code>anchorX</code>,\n\t * <code>anchorY</code>). If the movie clip in which you are drawing contains\n\t * content created with the Flash drawing tools, calls to the\n\t * <code>curveTo()</code> method are drawn underneath this content. If you\n\t * call the <code>curveTo()</code> method before any calls to the\n\t * <code>moveTo()</code> method, the default of the current drawing position\n\t * is(0, 0). If any of the parameters are missing, this method fails and the\n\t * current drawing position is not changed.\n\t *\n\t * <p>The curve drawn is a quadratic Bezier curve. Quadratic Bezier curves\n\t * consist of two anchor points and one control point. The curve interpolates\n\t * the two anchor points and curves toward the control point. </p>\n\t *\n\t * @param controlX A number that specifies the horizontal position of the\n\t *                 control point relative to the registration point of the\n\t *                 parent display object.\n\t * @param controlY A number that specifies the vertical position of the\n\t *                 control point relative to the registration point of the\n\t *                 parent display object.\n\t * @param anchorX  A number that specifies the horizontal position of the\n\t *                 next anchor point relative to the registration point of\n\t *                 the parent display object.\n\t * @param anchorY  A number that specifies the vertical position of the next\n\t *                 anchor point relative to the registration point of the\n\t *                 parent display object.\n\t */\n\tpublic curveTo(controlX:number, controlY:number, anchorX:number, anchorY:number)\n\t{\n\n\t}\n\n\t/**\n\t * Draws a circle. Set the line style, fill, or both before you call the\n\t * <code>drawCircle()</code> method, by calling the <code>linestyle()</code>,\n\t * <code>lineGradientStyle()</code>, <code>beginFill()</code>,\n\t * <code>beginGradientFill()</code>, or <code>beginBitmapFill()</code>\n\t * method.\n\t *\n\t * @param x      The <i>x</i> location of the center of the circle relative\n\t *               to the registration point of the parent display object(in\n\t *               pixels).\n\t * @param y      The <i>y</i> location of the center of the circle relative\n\t *               to the registration point of the parent display object(in\n\t *               pixels).\n\t * @param radius The radius of the circle(in pixels).\n\t */\n\tpublic drawCircle(x:number, y:number, radius:number)\n\t{\n\n\t}\n\n\t/**\n\t * Draws an ellipse. Set the line style, fill, or both before you call the\n\t * <code>drawEllipse()</code> method, by calling the\n\t * <code>linestyle()</code>, <code>lineGradientStyle()</code>,\n\t * <code>beginFill()</code>, <code>beginGradientFill()</code>, or\n\t * <code>beginBitmapFill()</code> method.\n\t *\n\t * @param x      The <i>x</i> location of the top-left of the bounding-box of\n\t *               the ellipse relative to the registration point of the parent\n\t *               display object(in pixels).\n\t * @param y      The <i>y</i> location of the top left of the bounding-box of\n\t *               the ellipse relative to the registration point of the parent\n\t *               display object(in pixels).\n\t * @param width  The width of the ellipse(in pixels).\n\t * @param height The height of the ellipse(in pixels).\n\t */\n\tpublic drawEllipse(x:number, y:number, width:number, height:number)\n\t{\n\n\t}\n\n\t/**\n\t * Submits a series of IGraphicsData instances for drawing. This method\n\t * accepts a Vector containing objects including paths, fills, and strokes\n\t * that implement the IGraphicsData interface. A Vector of IGraphicsData\n\t * instances can refer to a part of a shape, or a complex fully defined set\n\t * of data for rendering a complete shape.\n\t *\n\t * <p> Graphics paths can contain other graphics paths. If the\n\t * <code>graphicsData</code> Vector includes a path, that path and all its\n\t * sub-paths are rendered during this operation. </p>\n\t *\n\t */\n\tpublic drawGraphicsData(graphicsData:Array<IGraphicsData>)\n\t{\n\n\t}\n\n\t/**\n\t * Submits a series of commands for drawing. The <code>drawPath()</code>\n\t * method uses vector arrays to consolidate individual <code>moveTo()</code>,\n\t * <code>lineTo()</code>, and <code>curveTo()</code> drawing commands into a\n\t * single call. The <code>drawPath()</code> method parameters combine drawing\n\t * commands with x- and y-coordinate value pairs and a drawing direction. The\n\t * drawing commands are values from the GraphicsPathCommand class. The x- and\n\t * y-coordinate value pairs are Numbers in an array where each pair defines a\n\t * coordinate location. The drawing direction is a value from the\n\t * GraphicsPathWinding class.\n\t *\n\t * <p> Generally, drawings render faster with <code>drawPath()</code> than\n\t * with a series of individual <code>lineTo()</code> and\n\t * <code>curveTo()</code> methods. </p>\n\t *\n\t * <p> The <code>drawPath()</code> method uses a uses a floating computation\n\t * so rotation and scaling of shapes is more accurate and gives better\n\t * results. However, curves submitted using the <code>drawPath()</code>\n\t * method can have small sub-pixel alignment errors when used in conjunction\n\t * with the <code>lineTo()</code> and <code>curveTo()</code> methods. </p>\n\t *\n\t * <p> The <code>drawPath()</code> method also uses slightly different rules\n\t * for filling and drawing lines. They are: </p>\n\t *\n\t * <ul>\n\t *   <li>When a fill is applied to rendering a path:\n\t * <ul>\n\t *   <li>A sub-path of less than 3 points is not rendered.(But note that the\n\t * stroke rendering will still occur, consistent with the rules for strokes\n\t * below.)</li>\n\t *   <li>A sub-path that isn't closed(the end point is not equal to the\n\t * begin point) is implicitly closed.</li>\n\t * </ul>\n\t * </li>\n\t *   <li>When a stroke is applied to rendering a path:\n\t * <ul>\n\t *   <li>The sub-paths can be composed of any number of points.</li>\n\t *   <li>The sub-path is never implicitly closed.</li>\n\t * </ul>\n\t * </li>\n\t * </ul>\n\t *\n\t * @param winding Specifies the winding rule using a value defined in the\n\t *                GraphicsPathWinding class.\n\t */\n\tpublic drawPath(commands:Array<number /*int*/>, data:Array<number>, winding:GraphicsPathWinding)\n\t{\n\n\t}\n\n\t/**\n\t * Draws a rectangle. Set the line style, fill, or both before you call the\n\t * <code>drawRect()</code> method, by calling the <code>linestyle()</code>,\n\t * <code>lineGradientStyle()</code>, <code>beginFill()</code>,\n\t * <code>beginGradientFill()</code>, or <code>beginBitmapFill()</code>\n\t * method.\n\t *\n\t * @param x      A number indicating the horizontal position relative to the\n\t *               registration point of the parent display object(in pixels).\n\t * @param y      A number indicating the vertical position relative to the\n\t *               registration point of the parent display object(in pixels).\n\t * @param width  The width of the rectangle(in pixels).\n\t * @param height The height of the rectangle(in pixels).\n\t * @throws ArgumentError If the <code>width</code> or <code>height</code>\n\t *                       parameters are not a number\n\t *                      (<code>Number.NaN</code>).\n\t */\n\tpublic drawRect(x:number, y:number, width:number, height:number)\n\t{\n\n\t}\n\n\t/**\n\t * Draws a rounded rectangle. Set the line style, fill, or both before you\n\t * call the <code>drawRoundRect()</code> method, by calling the\n\t * <code>linestyle()</code>, <code>lineGradientStyle()</code>,\n\t * <code>beginFill()</code>, <code>beginGradientFill()</code>, or\n\t * <code>beginBitmapFill()</code> method.\n\t *\n\t * @param x             A number indicating the horizontal position relative\n\t *                      to the registration point of the parent display\n\t *                      object(in pixels).\n\t * @param y             A number indicating the vertical position relative to\n\t *                      the registration point of the parent display object\n\t *                     (in pixels).\n\t * @param width         The width of the round rectangle(in pixels).\n\t * @param height        The height of the round rectangle(in pixels).\n\t * @param ellipseWidth  The width of the ellipse used to draw the rounded\n\t *                      corners(in pixels).\n\t * @param ellipseHeight The height of the ellipse used to draw the rounded\n\t *                      corners(in pixels). Optional; if no value is\n\t *                      specified, the default value matches that provided\n\t *                      for the <code>ellipseWidth</code> parameter.\n\t * @throws ArgumentError If the <code>width</code>, <code>height</code>,\n\t *                       <code>ellipseWidth</code> or\n\t *                       <code>ellipseHeight</code> parameters are not a\n\t *                       number(<code>Number.NaN</code>).\n\t */\n\tpublic drawRoundRect(x:number, y:number, width:number, height:number, ellipseWidth:number, ellipseHeight:number = NaN)\n\t{\n\n\t}\n\n\t//public drawRoundRectComplex(x:Float, y:Float, width:Float, height:Float, topLeftRadius:Float, topRightRadius:Float, bottomLeftRadius:Float, bottomRightRadius:Float):Void;\n\n\t/**\n\t * Renders a set of triangles, typically to distort bitmaps and give them a\n\t * three-dimensional appearance. The <code>drawTriangles()</code> method maps\n\t * either the current fill, or a bitmap fill, to the triangle faces using a\n\t * set of(u,v) coordinates.\n\t *\n\t * <p> Any type of fill can be used, but if the fill has a transform matrix\n\t * that transform matrix is ignored. </p>\n\t *\n\t * <p> A <code>uvtData</code> parameter improves texture mapping when a\n\t * bitmap fill is used. </p>\n\t *\n\t * @param culling Specifies whether to render triangles that face in a\n\t *                specified direction. This parameter prevents the rendering\n\t *                of triangles that cannot be seen in the current view. This\n\t *                parameter can be set to any value defined by the\n\t *                TriangleCulling class.\n\t */\n\tpublic drawTriangles(vertices:Array<number>, indices:Array<number /*int*/> = null, uvtData:Array<number> = null, culling:TriangleCulling = null)\n\t{\n\n\t}\n\n\t/**\n\t * Applies a fill to the lines and curves that were added since the last call\n\t * to the <code>beginFill()</code>, <code>beginGradientFill()</code>, or\n\t * <code>beginBitmapFill()</code> method. Flash uses the fill that was\n\t * specified in the previous call to the <code>beginFill()</code>,\n\t * <code>beginGradientFill()</code>, or <code>beginBitmapFill()</code>\n\t * method. If the current drawing position does not equal the previous\n\t * position specified in a <code>moveTo()</code> method and a fill is\n\t * defined, the path is closed with a line and then filled.\n\t *\n\t */\n\tpublic endFill()\n\t{\n\n\t}\n\n\t/**\n\t * Specifies a bitmap to use for the line stroke when drawing lines.\n\t *\n\t * <p>The bitmap line style is used for subsequent calls to Graphics methods\n\t * such as the <code>lineTo()</code> method or the <code>drawCircle()</code>\n\t * method. The line style remains in effect until you call the\n\t * <code>lineStyle()</code> or <code>lineGradientStyle()</code> methods, or\n\t * the <code>lineBitmapStyle()</code> method again with different parameters.\n\t * </p>\n\t *\n\t * <p>You can call the <code>lineBitmapStyle()</code> method in the middle of\n\t * drawing a path to specify different styles for different line segments\n\t * within a path. </p>\n\t *\n\t * <p>Call the <code>lineStyle()</code> method before you call the\n\t * <code>lineBitmapStyle()</code> method to enable a stroke, or else the\n\t * value of the line style is <code>undefined</code>.</p>\n\t *\n\t * <p>Calls to the <code>clear()</code> method set the line style back to\n\t * <code>undefined</code>. </p>\n\t *\n\t * @param bitmap The bitmap to use for the line stroke.\n\t * @param matrix An optional transformation matrix as defined by the\n\t *               flash.geom.Matrix class. The matrix can be used to scale or\n\t *               otherwise manipulate the bitmap before applying it to the\n\t *               line style.\n\t * @param repeat Whether to repeat the bitmap in a tiled fashion.\n\t * @param smooth Whether smoothing should be applied to the bitmap.\n\t */\n\tpublic lineBitmapStyle(bitmap:BitmapData, matrix:Matrix = null, repeat:boolean = true, smooth:boolean = false)\n\t{\n\n\t}\n\n\t/**\n\t * Specifies a gradient to use for the stroke when drawing lines.\n\t *\n\t * <p>The gradient line style is used for subsequent calls to Graphics\n\t * methods such as the <code>lineTo()</code> methods or the\n\t * <code>drawCircle()</code> method. The line style remains in effect until\n\t * you call the <code>lineStyle()</code> or <code>lineBitmapStyle()</code>\n\t * methods, or the <code>lineGradientStyle()</code> method again with\n\t * different parameters. </p>\n\t *\n\t * <p>You can call the <code>lineGradientStyle()</code> method in the middle\n\t * of drawing a path to specify different styles for different line segments\n\t * within a path. </p>\n\t *\n\t * <p>Call the <code>lineStyle()</code> method before you call the\n\t * <code>lineGradientStyle()</code> method to enable a stroke, or else the\n\t * value of the line style is <code>undefined</code>.</p>\n\t *\n\t * <p>Calls to the <code>clear()</code> method set the line style back to\n\t * <code>undefined</code>. </p>\n\t *\n\t * @param type                A value from the GradientType class that\n\t *                            specifies which gradient type to use, either\n\t *                            GradientType.LINEAR or GradientType.RADIAL.\n\t * @param colors              An array of RGB hexadecimal color values used\n\t *                            in the gradient; for example, red is 0xFF0000,\n\t *                            blue is 0x0000FF, and so on. You can specify\n\t *                            up to 15 colors. For each color, specify a\n\t *                            corresponding value in the alphas and ratios\n\t *                            parameters.\n\t * @param alphas              An array of alpha values for the corresponding\n\t *                            colors in the colors array; valid values are 0\n\t *                            to 1. If the value is less than 0, the default\n\t *                            is 0. If the value is greater than 1, the\n\t *                            default is 1.\n\t * @param ratios              An array of color distribution ratios; valid\n\t *                            values are 0-255. This value defines the\n\t *                            percentage of the width where the color is\n\t *                            sampled at 100%. The value 0 represents the\n\t *                            left position in the gradient box, and 255\n\t *                            represents the right position in the gradient\n\t *                            box.\n\t * @param matrix              A transformation matrix as defined by the\n\t *                            flash.geom.Matrix class. The flash.geom.Matrix\n\t *                            class includes a\n\t *                            <code>createGradientBox()</code> method, which\n\t *                            lets you conveniently set up the matrix for use\n\t *                            with the <code>lineGradientStyle()</code>\n\t *                            method.\n\t * @param spreadMethod        A value from the SpreadMethod class that\n\t *                            specifies which spread method to use:\n\t * @param interpolationMethod A value from the InterpolationMethod class that\n\t *                            specifies which value to use. For example,\n\t *                            consider a simple linear gradient between two\n\t *                            colors(with the <code>spreadMethod</code>\n\t *                            parameter set to\n\t *                            <code>SpreadMethod.REFLECT</code>). The\n\t *                            different interpolation methods affect the\n\t *                            appearance as follows:\n\t * @param focalPointRatio     A number that controls the location of the\n\t *                            focal point of the gradient. The value 0 means\n\t *                            the focal point is in the center. The value 1\n\t *                            means the focal point is at one border of the\n\t *                            gradient circle. The value -1 means that the\n\t *                            focal point is at the other border of the\n\t *                            gradient circle. Values less than -1 or greater\n\t *                            than 1 are rounded to -1 or 1. The following\n\t *                            image shows a gradient with a\n\t *                            <code>focalPointRatio</code> of -0.75:\n\t */\n\tpublic lineGradientStyle(type:GradientType, colors:Array<number /*int*/>, alphas:Array<number>, ratios:Array<number>, matrix:Matrix = null, spreadMethod:SpreadMethod = null, interpolationMethod:InterpolationMethod = null, focalPointRatio:number = 0)\n\t{\n\n\t}\n\n\t/**\n\t * Specifies a shader to use for the line stroke when drawing lines.\n\t *\n\t * <p>The shader line style is used for subsequent calls to Graphics methods\n\t * such as the <code>lineTo()</code> method or the <code>drawCircle()</code>\n\t * method. The line style remains in effect until you call the\n\t * <code>lineStyle()</code> or <code>lineGradientStyle()</code> methods, or\n\t * the <code>lineBitmapStyle()</code> method again with different parameters.\n\t * </p>\n\t *\n\t * <p>You can call the <code>lineShaderStyle()</code> method in the middle of\n\t * drawing a path to specify different styles for different line segments\n\t * within a path. </p>\n\t *\n\t * <p>Call the <code>lineStyle()</code> method before you call the\n\t * <code>lineShaderStyle()</code> method to enable a stroke, or else the\n\t * value of the line style is <code>undefined</code>.</p>\n\t *\n\t * <p>Calls to the <code>clear()</code> method set the line style back to\n\t * <code>undefined</code>. </p>\n\t *\n\t * @param shader The shader to use for the line stroke.\n\t * @param matrix An optional transformation matrix as defined by the\n\t *               flash.geom.Matrix class. The matrix can be used to scale or\n\t *               otherwise manipulate the bitmap before applying it to the\n\t *               line style.\n\t */\n//\t\tpublic lineShaderStyle(shader:Shader, matrix:Matrix = null)\n//\t\t{\n//\n//\t\t}\n\n\t/**\n\t * Specifies a line style used for subsequent calls to Graphics methods such\n\t * as the <code>lineTo()</code> method or the <code>drawCircle()</code>\n\t * method. The line style remains in effect until you call the\n\t * <code>lineGradientStyle()</code> method, the\n\t * <code>lineBitmapStyle()</code> method, or the <code>lineStyle()</code>\n\t * method with different parameters.\n\t *\n\t * <p>You can call the <code>lineStyle()</code> method in the middle of\n\t * drawing a path to specify different styles for different line segments\n\t * within the path.</p>\n\t *\n\t * <p><b>Note: </b>Calls to the <code>clear()</code> method set the line\n\t * style back to <code>undefined</code>.</p>\n\t *\n\t * <p><b>Note: </b>Flash Lite 4 supports only the first three parameters\n\t * (<code>thickness</code>, <code>color</code>, and <code>alpha</code>).</p>\n\t *\n\t * @param thickness    An integer that indicates the thickness of the line in\n\t *                     points; valid values are 0-255. If a number is not\n\t *                     specified, or if the parameter is undefined, a line is\n\t *                     not drawn. If a value of less than 0 is passed, the\n\t *                     default is 0. The value 0 indicates hairline\n\t *                     thickness; the maximum thickness is 255. If a value\n\t *                     greater than 255 is passed, the default is 255.\n\t * @param color        A hexadecimal color value of the line; for example,\n\t *                     red is 0xFF0000, blue is 0x0000FF, and so on. If a\n\t *                     value is not indicated, the default is 0x000000\n\t *                    (black). Optional.\n\t * @param alpha        A number that indicates the alpha value of the color\n\t *                     of the line; valid values are 0 to 1. If a value is\n\t *                     not indicated, the default is 1(solid). If the value\n\t *                     is less than 0, the default is 0. If the value is\n\t *                     greater than 1, the default is 1.\n\t * @param pixelHinting(Not supported in Flash Lite 4) A Boolean value that\n\t *                     specifies whether to hint strokes to full pixels. This\n\t *                     affects both the position of anchors of a curve and\n\t *                     the line stroke size itself. With\n\t *                     <code>pixelHinting</code> set to <code>true</code>,\n\t *                     line widths are adjusted to full pixel widths. With\n\t *                     <code>pixelHinting</code> set to <code>false</code>,\n\t *                     disjoints can appear for curves and straight lines.\n\t *                     For example, the following illustrations show how\n\t *                     Flash Player or Adobe AIR renders two rounded\n\t *                     rectangles that are identical, except that the\n\t *                     <code>pixelHinting</code> parameter used in the\n\t *                     <code>lineStyle()</code> method is set differently\n\t *                    (the images are scaled by 200%, to emphasize the\n\t *                     difference):\n\t *\n\t *                     <p>If a value is not supplied, the line does not use\n\t *                     pixel hinting.</p>\n\t * @param scaleMode   (Not supported in Flash Lite 4) A value from the\n\t *                     LineScaleMode class that specifies which scale mode to\n\t *                     use:\n\t *                     <ul>\n\t *                       <li> <code>LineScaleMode.NORMAL</code> - Always\n\t *                     scale the line thickness when the object is scaled\n\t *                    (the default). </li>\n\t *                       <li> <code>LineScaleMode.NONE</code> - Never scale\n\t *                     the line thickness. </li>\n\t *                       <li> <code>LineScaleMode.VERTICAL</code> - Do not\n\t *                     scale the line thickness if the object is scaled\n\t *                     vertically <i>only</i>. For example, consider the\n\t *                     following circles, drawn with a one-pixel line, and\n\t *                     each with the <code>scaleMode</code> parameter set to\n\t *                     <code>LineScaleMode.VERTICAL</code>. The circle on the\n\t *                     left is scaled vertically only, and the circle on the\n\t *                     right is scaled both vertically and horizontally:\n\t *                     </li>\n\t *                       <li> <code>LineScaleMode.HORIZONTAL</code> - Do not\n\t *                     scale the line thickness if the object is scaled\n\t *                     horizontally <i>only</i>. For example, consider the\n\t *                     following circles, drawn with a one-pixel line, and\n\t *                     each with the <code>scaleMode</code> parameter set to\n\t *                     <code>LineScaleMode.HORIZONTAL</code>. The circle on\n\t *                     the left is scaled horizontally only, and the circle\n\t *                     on the right is scaled both vertically and\n\t *                     horizontally:   </li>\n\t *                     </ul>\n\t * @param caps        (Not supported in Flash Lite 4) A value from the\n\t *                     CapsStyle class that specifies the type of caps at the\n\t *                     end of lines. Valid values are:\n\t *                     <code>CapsStyle.NONE</code>,\n\t *                     <code>CapsStyle.ROUND</code>, and\n\t *                     <code>CapsStyle.SQUARE</code>. If a value is not\n\t *                     indicated, Flash uses round caps.\n\t *\n\t *                     <p>For example, the following illustrations show the\n\t *                     different <code>capsStyle</code> settings. For each\n\t *                     setting, the illustration shows a blue line with a\n\t *                     thickness of 30(for which the <code>capsStyle</code>\n\t *                     applies), and a superimposed black line with a\n\t *                     thickness of 1(for which no <code>capsStyle</code>\n\t *                     applies): </p>\n\t * @param joints      (Not supported in Flash Lite 4) A value from the\n\t *                     JointStyle class that specifies the type of joint\n\t *                     appearance used at angles. Valid values are:\n\t *                     <code>JointStyle.BEVEL</code>,\n\t *                     <code>JointStyle.MITER</code>, and\n\t *                     <code>JointStyle.ROUND</code>. If a value is not\n\t *                     indicated, Flash uses round joints.\n\t *\n\t *                     <p>For example, the following illustrations show the\n\t *                     different <code>joints</code> settings. For each\n\t *                     setting, the illustration shows an angled blue line\n\t *                     with a thickness of 30(for which the\n\t *                     <code>jointStyle</code> applies), and a superimposed\n\t *                     angled black line with a thickness of 1(for which no\n\t *                     <code>jointStyle</code> applies): </p>\n\t *\n\t *                     <p><b>Note:</b> For <code>joints</code> set to\n\t *                     <code>JointStyle.MITER</code>, you can use the\n\t *                     <code>miterLimit</code> parameter to limit the length\n\t *                     of the miter.</p>\n\t * @param miterLimit  (Not supported in Flash Lite 4) A number that\n\t *                     indicates the limit at which a miter is cut off. Valid\n\t *                     values range from 1 to 255(and values outside that\n\t *                     range are rounded to 1 or 255). This value is only\n\t *                     used if the <code>jointStyle</code> is set to\n\t *                     <code>\"miter\"</code>. The <code>miterLimit</code>\n\t *                     value represents the length that a miter can extend\n\t *                     beyond the point at which the lines meet to form a\n\t *                     joint. The value expresses a factor of the line\n\t *                     <code>thickness</code>. For example, with a\n\t *                     <code>miterLimit</code> factor of 2.5 and a\n\t *                     <code>thickness</code> of 10 pixels, the miter is cut\n\t *                     off at 25 pixels.\n\t *\n\t *                     <p>For example, consider the following angled lines,\n\t *                     each drawn with a <code>thickness</code> of 20, but\n\t *                     with <code>miterLimit</code> set to 1, 2, and 4.\n\t *                     Superimposed are black reference lines showing the\n\t *                     meeting points of the joints:</p>\n\t *\n\t *                     <p>Notice that a given <code>miterLimit</code> value\n\t *                     has a specific maximum angle for which the miter is\n\t *                     cut off. The following table lists some examples:</p>\n\t */\n\tpublic lineStyle(thickness:number = 0, color:number /*int*/ = 0, alpha:number = 1, pixelHinting:boolean = false, scaleMode:LineScaleMode = null, caps:CapsStyle = null, joints:JointStyle = null, miterLimit:number = 3)\n\t{\n\n\t}\n\n\t/**\n\t * Draws a line using the current line style from the current drawing\n\t * position to(<code>x</code>, <code>y</code>); the current drawing position\n\t * is then set to(<code>x</code>, <code>y</code>). If the display object in\n\t * which you are drawing contains content that was created with the Flash\n\t * drawing tools, calls to the <code>lineTo()</code> method are drawn\n\t * underneath the content. If you call <code>lineTo()</code> before any calls\n\t * to the <code>moveTo()</code> method, the default position for the current\n\t * drawing is(<i>0, 0</i>). If any of the parameters are missing, this\n\t * method fails and the current drawing position is not changed.\n\t *\n\t * @param x A number that indicates the horizontal position relative to the\n\t *          registration point of the parent display object(in pixels).\n\t * @param y A number that indicates the vertical position relative to the\n\t *          registration point of the parent display object(in pixels).\n\t */\n\tpublic lineTo(x:number, y:number)\n\t{\n\n\t}\n\n\t/**\n\t * Moves the current drawing position to(<code>x</code>, <code>y</code>). If\n\t * any of the parameters are missing, this method fails and the current\n\t * drawing position is not changed.\n\t *\n\t * @param x A number that indicates the horizontal position relative to the\n\t *          registration point of the parent display object(in pixels).\n\t * @param y A number that indicates the vertical position relative to the\n\t *          registration point of the parent display object(in pixels).\n\t */\n\tpublic moveTo(x:number, y:number)\n\t{\n\n\t}\n}\n\nexport = Graphics;","/**\n * The InterpolationMethod class provides values for the\n * <code>interpolationMethod</code> parameter in the\n * <code>Graphics.beginGradientFill()</code> and\n * <code>Graphics.lineGradientStyle()</code> methods. This parameter\n * determines the RGB space to use when rendering the gradient.\n */\nclass InterpolationMethod\n{\n\n\t/**\n\t * Specifies that the RGB interpolation method should be used. This means\n\t * that the gradient is rendered with exponential sRGB(standard RGB) space.\n\t * The sRGB space is a W3C-endorsed standard that defines a non-linear\n\t * conversion between red, green, and blue component values and the actual\n\t * intensity of the visible component color.\n\t *\n\t * <p>For example, consider a simple linear gradient between two colors(with\n\t * the <code>spreadMethod</code> parameter set to\n\t * <code>SpreadMethod.REFLECT</code>). The different interpolation methods\n\t * affect the appearance as follows: </p>\n\t */\n\tpublic static LINEAR_RGB:string = \"linearRGB\";\n\n\t/**\n\t * Specifies that the RGB interpolation method should be used. This means\n\t * that the gradient is rendered with exponential sRGB(standard RGB) space.\n\t * The sRGB space is a W3C-endorsed standard that defines a non-linear\n\t * conversion between red, green, and blue component values and the actual\n\t * intensity of the visible component color.\n\t *\n\t * <p>For example, consider a simple linear gradient between two colors(with\n\t * the <code>spreadMethod</code> parameter set to\n\t * <code>SpreadMethod.REFLECT</code>). The different interpolation methods\n\t * affect the appearance as follows: </p>\n\t */\n\tpublic static RGB:string = \"rgb\";\n}\n\nexport = InterpolationMethod;","/**\n * The JointStyle class is an enumeration of constant values that specify the\n * joint style to use in drawing lines. These constants are provided for use\n * as values in the <code>joints</code> parameter of the\n * <code>flash.display.Graphics.lineStyle()</code> method. The method supports\n * three types of joints: miter, round, and bevel, as the following example\n * shows:\n */\nclass JointStyle\n{\n\t/**\n\t * Specifies beveled joints in the <code>joints</code> parameter of the\n\t * <code>flash.display.Graphics.lineStyle()</code> method.\n\t */\n\tpublic static BEVEL:string = \"bevel\";\n\n\t/**\n\t * Specifies mitered joints in the <code>joints</code> parameter of the\n\t * <code>flash.display.Graphics.lineStyle()</code> method.\n\t */\n\tpublic static MITER:string = \"miter\";\n\n\t/**\n\t * Specifies round joints in the <code>joints</code> parameter of the\n\t * <code>flash.display.Graphics.lineStyle()</code> method.\n\t */\n\tpublic static ROUND:string = \"round\";\n}\n\nexport = JointStyle;","import AssetType\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport Matrix3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nimport DisplayObjectContainer\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\nimport Camera\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport IEntity\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport LightEvent\t\t\t\t= require(\"awayjs-display/lib/events/LightEvent\");\nimport ShadowMapperBase\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/ShadowMapperBase\");\n\nclass LightBase extends DisplayObjectContainer\n{\n\tprivate _color:number = 0xffffff;\n\tprivate _colorR:number = 1;\n\tprivate _colorG:number = 1;\n\tprivate _colorB:number = 1;\n\n\tprivate _ambientColor:number = 0xffffff;\n\tprivate _ambient:number = 0;\n\tpublic _iAmbientR:number = 0;\n\tpublic _iAmbientG:number = 0;\n\tpublic _iAmbientB:number = 0;\n\n\tprivate _specular:number = 1;\n\tpublic _iSpecularR:number = 1;\n\tpublic _iSpecularG:number = 1;\n\tpublic _iSpecularB:number = 1;\n\n\tprivate _diffuse:number = 1;\n\tpublic _iDiffuseR:number = 1;\n\tpublic _iDiffuseG:number = 1;\n\tpublic _iDiffuseB:number = 1;\n\n\tprivate _castsShadows:boolean = false;\n\n\tprivate _shadowMapper:ShadowMapperBase;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\tpublic get castsShadows():boolean\n\t{\n\t\treturn this._castsShadows;\n\t}\n\n\tpublic set castsShadows(value:boolean)\n\t{\n\t\tif (this._castsShadows == value)\n\t\t\treturn;\n\n\t\tthis._castsShadows = value;\n\n\t\tif (value) {\n\t\t\tif (this._shadowMapper == null)\n\t\t\t\tthis._shadowMapper = this.pCreateShadowMapper();\n\n\t\t\tthis._shadowMapper.light = this;\n\t\t} else {\n\t\t\tthis._shadowMapper.dispose();\n\t\t\tthis._shadowMapper = null;\n\t\t}\n\t\t//*/\n\t\tthis.dispatchEvent(new LightEvent(LightEvent.CASTS_SHADOW_CHANGE));\n\t}\n\n\tpublic pCreateShadowMapper():ShadowMapperBase\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic get specular():number\n\t{\n\t\treturn this._specular;\n\t}\n\n\tpublic set specular(value:number)\n\t{\n\t\tif (value < 0)\n\t\t\tvalue = 0;\n\n\t\tthis._specular = value;\n\t\tthis.updateSpecular();\n\t}\n\n\tpublic get diffuse():number\n\t{\n\t\treturn this._diffuse;\n\t}\n\n\tpublic set diffuse(value:number)\n\t{\n\t\tif (value < 0)\n\t\t\tvalue = 0;\n\n\t\tthis._diffuse = value;\n\t\tthis.updateDiffuse();\n\t}\n\n\tpublic get color():number\n\t{\n\t\treturn this._color;\n\t}\n\n\tpublic set color(value:number)\n\t{\n\t\tthis._color = value;\n\t\tthis._colorR = ((this._color >> 16) & 0xff)/0xff;\n\t\tthis._colorG = ((this._color >> 8) & 0xff)/0xff;\n\t\tthis._colorB = (this._color & 0xff)/0xff;\n\n\t\tthis.updateDiffuse();\n\t\tthis.updateSpecular();\n\t}\n\n\tpublic get ambient():number\n\t{\n\t\treturn this._ambient;\n\t}\n\n\tpublic set ambient(value:number)\n\t{\n\t\tif (value < 0)\n\t\t\tvalue = 0;\n\t\telse if (value > 1)\n\t\t\tvalue = 1;\n\n\t\tthis._ambient = value;\n\t\tthis.updateAmbient();\n\t}\n\n\tpublic get ambientColor():number\n\t{\n\t\treturn this._ambientColor;\n\t}\n\n\tpublic set ambientColor(value:number)\n\t{\n\t\tthis._ambientColor = value;\n\t\tthis.updateAmbient();\n\t}\n\n\tprivate updateAmbient()\n\t{\n\t\tthis._iAmbientR = ((this._ambientColor >> 16) & 0xff)/0xff*this._ambient;\n\t\tthis._iAmbientG = ((this._ambientColor >> 8) & 0xff)/0xff*this._ambient;\n\t\tthis._iAmbientB = (this._ambientColor & 0xff)/0xff*this._ambient;\n\t}\n\n\tpublic iGetObjectProjectionMatrix(entity:IEntity, camera:Camera, target:Matrix3D = null):Matrix3D\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t//@override\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.LIGHT;\n\t}\n\n\tprivate updateSpecular()\n\t{\n\t\tthis._iSpecularR = this._colorR*this._specular;\n\t\tthis._iSpecularG = this._colorG*this._specular;\n\t\tthis._iSpecularB = this._colorB*this._specular;\n\t}\n\n\tprivate updateDiffuse()\n\t{\n\t\tthis._iDiffuseR = this._colorR*this._diffuse;\n\t\tthis._iDiffuseG = this._colorG*this._diffuse;\n\t\tthis._iDiffuseB = this._colorB*this._diffuse;\n\t}\n\n\tpublic get shadowMapper():ShadowMapperBase\n\t{\n\t\treturn this._shadowMapper;\n\t}\n\n\tpublic set shadowMapper(value:ShadowMapperBase)\n\t{\n\t\tthis._shadowMapper = value;\n\t\tthis._shadowMapper.light = this;\n\t}\n}\n\nexport = LightBase;","/**\n * The LineScaleMode class provides values for the <code>scaleMode</code>\n * parameter in the <code>Graphics.lineStyle()</code> method.\n */\nclass LineScaleMode\n{\n\t/**\n\t * With this setting used as the <code>scaleMode</code> parameter of the\n\t * <code>lineStyle()</code> method, the thickness of the line scales\n\t * <i>only</i> vertically. For example, consider the following circles, drawn\n\t * with a one-pixel line, and each with the <code>scaleMode</code> parameter\n\t * set to <code>LineScaleMode.VERTICAL</code>. The circle on the left is\n\t * scaled only vertically, and the circle on the right is scaled both\n\t * vertically and horizontally.\n\t */\n\tpublic static HORIZONTAL:string = \"horizontal\";\n\n\t/**\n\t * With this setting used as the <code>scaleMode</code> parameter of the\n\t * <code>lineStyle()</code> method, the thickness of the line never scales.\n\t */\n\tpublic static NONE:string = \"none\";\n\n\t/**\n\t * With this setting used as the <code>scaleMode</code> parameter of the\n\t * <code>lineStyle()</code> method, the thickness of the line always scales\n\t * when the object is scaled(the default).\n\t */\n\tpublic static NORMAL:string = \"normal\";\n\n\t/**\n\t * With this setting used as the <code>scaleMode</code> parameter of the\n\t * <code>lineStyle()</code> method, the thickness of the line scales\n\t * <i>only</i> horizontally. For example, consider the following circles,\n\t * drawn with a one-pixel line, and each with the <code>scaleMode</code>\n\t * parameter set to <code>LineScaleMode.HORIZONTAL</code>. The circle on the\n\t * left is scaled only horizontally, and the circle on the right is scaled\n\t * both vertically and horizontally.\n\t */\n\tpublic static VERTICAL:string = \"vertical\";\n}\n\nexport = LineScaleMode;","import DisplayObjectContainer\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\nimport Geometry\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\nimport LineSubMesh\t\t\t\t= require(\"awayjs-display/lib/base/LineSubMesh\");\nimport SubGeometryBase\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport TriangleSubGeometry\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport SubGeometryEvent\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\n\n/**\n * @class LineSubGeometry\n */\nclass LineSubGeometry extends SubGeometryBase\n{\n\tpublic static VERTEX_DATA:string = \"vertices\";\n\tpublic static START_POSITION_DATA:string = \"startPositions\";\n\tpublic static END_POSITION_DATA:string = \"endPositions\";\n\tpublic static THICKNESS_DATA:string = \"thickness\";\n\tpublic static COLOR_DATA:string = \"colors\";\n\n\t//TODO - move these to StageGL\n\tpublic static POSITION_FORMAT:string = \"float3\";\n\tpublic static COLOR_FORMAT:string = \"float4\";\n\tpublic static THICKNESS_FORMAT:string = \"float1\";\n\n\tprivate _positionsDirty:boolean = true;\n\tprivate _boundingPositionDirty = true;\n\tprivate _thicknessDirty:boolean = true;\n\tprivate _colorsDirty:boolean = true;\n\n\tprivate _startPositions:Array<number>;\n\tprivate _endPositions:Array<number>;\n\tprivate _boundingPositions:Array<number>\n\tprivate _thickness:Array<number>;\n\tprivate _startColors:Array<number>;\n\tprivate _endColors:Array<number>;\n\n\tprivate _numSegments:number;\n\n\tprivate _positionsUpdated:SubGeometryEvent;\n\tprivate _thicknessUpdated:SubGeometryEvent;\n\tprivate _colorUpdated:SubGeometryEvent;\n\n\tpublic _pUpdateStrideOffset()\n\t{\n\t\tthis._pOffset[LineSubGeometry.VERTEX_DATA] = 0;\n\n\t\tvar stride:number = 0;\n\t\tthis._pOffset[LineSubGeometry.START_POSITION_DATA] = stride;\n\t\tstride += 3;\n\n\t\tthis._pOffset[LineSubGeometry.END_POSITION_DATA] = stride;\n\t\tstride += 3;\n\n\t\tthis._pOffset[LineSubGeometry.THICKNESS_DATA] = stride;\n\t\tstride += 1;\n\n\t\tthis._pOffset[LineSubGeometry.COLOR_DATA] = stride;\n\t\tstride += 4;\n\n\t\tthis._pStride[LineSubGeometry.VERTEX_DATA] = stride;\n\t\tthis._pStride[LineSubGeometry.START_POSITION_DATA] = stride;\n\t\tthis._pStride[LineSubGeometry.END_POSITION_DATA] = stride;\n\t\tthis._pStride[LineSubGeometry.THICKNESS_DATA] = stride;\n\t\tthis._pStride[LineSubGeometry.COLOR_DATA] = stride;\n\n\t\tvar len:number = this._pNumVertices*stride;\n\n\t\tif (this._pVertices == null)\n\t\t\tthis._pVertices = new Array<number>(len);\n\t\telse if (this._pVertices.length != len)\n\t\t\tthis._pVertices.length = len;\n\n\t\tthis._pStrideOffsetDirty = false;\n\t}\n\n\t/**\n\t * \n\t */\n\tpublic get vertices():Array<number>\n\t{\n\t\tif (this._positionsDirty)\n\t\t\tthis.updatePositions(this._startPositions, this._endPositions);\n\n\t\tif (this._thicknessDirty)\n\t\t\tthis.updateThickness(this._thickness);\n\n\t\tif (this._colorsDirty)\n\t\t\tthis.updateColors(this._startColors, this._endColors);\n\n\t\treturn this._pVertices;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get startPositions():Array<number>\n\t{\n\t\tif (this._positionsDirty)\n\t\t\tthis.updatePositions(this._startPositions, this._endPositions);\n\n\t\treturn this._startPositions;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get endPositions():Array<number>\n\t{\n\t\tif (this._positionsDirty)\n\t\t\tthis.updatePositions(this._startPositions, this._endPositions);\n\n\t\treturn this._endPositions;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get thickness():Array<number>\n\t{\n\t\tif (this._thicknessDirty)\n\t\t\tthis.updateThickness(this._thickness);\n\n\t\treturn this._thickness;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get startColors():Array<number>\n\t{\n\t\tif (this._colorsDirty)\n\t\t\tthis.updateColors(this._startColors, this._endColors);\n\n\t\treturn this._startColors;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get endColors():Array<number>\n\t{\n\t\tif (this._colorsDirty)\n\t\t\tthis.updateColors(this._startColors, this._endColors);\n\n\t\treturn this._endColors;\n\t}\n\n\t/**\n\t * The total amount of segments in the TriangleSubGeometry.\n\t */\n\tpublic get numSegments():number\n\t{\n\t\treturn this._numSegments;\n\t}\n\n\t/**\n\t *\n\t */\n\tconstructor()\n\t{\n\t\tsuper(true);\n\n\t\tthis._pSubMeshClass = LineSubMesh;\n\t}\n\n\tpublic getBoundingPositions():Array<number>\n\t{\n\t\tif (this._boundingPositionDirty)\n\t\t\tthis._boundingPositions = this.startPositions.concat(this.endPositions);\n\n\t\treturn this._boundingPositions;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic updatePositions(startValues:Array<number>, endValues:Array<number>)\n\t{\n\t\tvar i:number;\n\t\tvar j:number;\n\t\tvar values:Array<number>\n\t\tvar index:number;\n\t\tvar stride:number;\n\t\tvar positions:Array<number>;\n\t\tvar indices:Array<number>;\n\n\t\tthis._startPositions = startValues;\n\n\t\tif (this._startPositions == null)\n\t\t\tthis._startPositions = new Array<number>();\n\n\t\tthis._endPositions = endValues;\n\n\t\tif (this._endPositions == null)\n\t\t\tthis._endPositions = new Array<number>();\n\n\t\tthis._boundingPositionDirty = true;\n\n\t\tthis._numSegments = this._startPositions.length/3;\n\n\t\tthis._pNumVertices = this._numSegments*4;\n\n\t\tvar lenV:number = this._pNumVertices*this.getStride(LineSubGeometry.VERTEX_DATA);\n\n\t\tif (this._pVertices == null)\n\t\t\tthis._pVertices = new Array<number>(lenV);\n\t\telse if (this._pVertices.length != lenV)\n\t\t\tthis._pVertices.length = lenV;\n\n\t\ti = 0;\n\t\tj = 0;\n\t\tindex = this.getOffset(LineSubGeometry.START_POSITION_DATA);\n\t\tstride = this.getStride(LineSubGeometry.START_POSITION_DATA);\n\t\tpositions = this._pVertices;\n\t\tindices = new Array();\n\n\t\twhile (i < startValues.length) {\n\t\t\tvalues = (index/stride & 1)? endValues : startValues;\n\t\t\tpositions[index] = values[i];\n\t\t\tpositions[index + 1] = values[i + 1];\n\t\t\tpositions[index + 2] = values[i + 2];\n\n\t\t\tvalues = (index/stride & 1)? startValues : endValues;\n\t\t\tpositions[index + 3] = values[i];\n\t\t\tpositions[index + 4] = values[i + 1];\n\t\t\tpositions[index + 5] = values[i + 2];\n\n\t\t\tif (++j == 4) {\n\t\t\t\tvar o:number = index/stride - 3;\n\t\t\t\tindices.push(o, o + 1, o + 2, o + 3, o + 2, o + 1);\n\t\t\t\tj = 0;\n\t\t\t\ti += 3;\n\t\t\t}\n\n\t\t\tindex += stride;\n\t\t}\n\n\t\tthis.updateIndices(indices);\n\n\t\tthis.pInvalidateBounds();\n\n\t\tthis.notifyPositionsUpdate();\n\n\t\tthis._positionsDirty = false;\n\t}\n\n\t/**\n\t * Updates the thickness.\n\t */\n\tpublic updateThickness(values:Array<number>)\n\t{\n\t\tvar i:number;\n\t\tvar j:number;\n\t\tvar index:number;\n\t\tvar offset:number;\n\t\tvar stride:number;\n\t\tvar thickness:Array<number>;\n\n\t\tthis._thickness = values;\n\n\t\tif (values != null) {\n\t\t\ti = 0;\n\t\t\tj = 0;\n\t\t\toffset = this.getOffset(LineSubGeometry.THICKNESS_DATA);\n\t\t\tstride = this.getStride(LineSubGeometry.THICKNESS_DATA);\n\t\t\tthickness = this._pVertices;\n\n\t\t\tindex = offset\n\t\t\twhile (i < values.length) {\n\t\t\t\tthickness[index] = (Math.floor(0.5*(index - offset)/stride + 0.5) & 1)? -values[i] : values[i];\n\n\t\t\t\tif (++j == 4) {\n\t\t\t\t\tj = 0;\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t\tindex += stride;\n\t\t\t}\n\t\t}\n\n\t\tthis.notifyThicknessUpdate();\n\n\t\tthis._thicknessDirty = false;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic updateColors(startValues:Array<number>, endValues:Array<number>)\n\t{\n\t\tvar i:number;\n\t\tvar j:number;\n\t\tvar values:Array<number>\n\t\tvar index:number;\n\t\tvar offset:number;\n\t\tvar stride:number;\n\t\tvar colors:Array<number>;\n\n\t\tthis._startColors = startValues;\n\n\t\tthis._endColors = endValues;\n\n\t\t//default to white\n\t\tif (this._startColors == null) {\n\t\t\tthis._startColors = new Array(this._numSegments*4);\n\n\t\t\ti = 0;\n\t\t\twhile (i < this._startColors.length)\n\t\t\t\tthis._startColors[i++] = 1;\n\t\t}\n\n\t\tif (this._endColors == null) {\n\t\t\tthis._endColors = new Array(this._numSegments*4);\n\n\t\t\ti = 0;\n\t\t\twhile (i < this._endColors.length)\n\t\t\t\tthis._endColors[i++] = 1;\n\t\t}\n\n\t\ti = 0;\n\t\tj = 0;\n\t\toffset = this.getOffset(LineSubGeometry.COLOR_DATA);\n\t\tstride = this.getStride(LineSubGeometry.COLOR_DATA);\n\t\tcolors = this._pVertices;\n\n\t\tindex = offset;\n\n\t\twhile (i < this._startColors.length) {\n\t\t\tvalues = ((index - offset)/stride & 1)? this._endColors : this._startColors;\n\t\t\tcolors[index] = values[i];\n\t\t\tcolors[index + 1] = values[i + 1];\n\t\t\tcolors[index + 2] = values[i + 2];\n\t\t\tcolors[index + 3] = values[i + 3];\n\n\t\t\tif (++j == 4) {\n\t\t\t\tj = 0;\n\t\t\t\ti += 4;\n\t\t\t}\n\n\t\t\tindex += stride;\n\t\t}\n\n\t\tthis.notifyColorsUpdate();\n\n\t\tthis._colorsDirty = false;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic dispose()\n\t{\n\t\tsuper.dispose();\n\n\t\tthis._startPositions = null;\n\t\tthis._endPositions = null;\n\t\tthis._thickness = null;\n\t\tthis._startColors = null;\n\t\tthis._endColors = null;\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tpublic pInvalidateBounds()\n\t{\n\t\tif (this.parentGeometry)\n\t\t\tthis.parentGeometry.iInvalidateBounds(this);\n\t}\n\n\t/**\n\t * The Geometry object that 'owns' this TriangleSubGeometry object.\n\t *\n\t * @private\n\t */\n\tpublic parentGeometry:Geometry;\n\n\t/**\n\t * Clones the current object\n\t * @return An exact duplicate of the current object.\n\t */\n\tpublic clone():LineSubGeometry\n\t{\n\t\tvar clone:LineSubGeometry = new LineSubGeometry();\n\t\tclone.updateIndices(this._pIndices.concat());\n\t\tclone.updatePositions(this._startPositions.concat(), this._endPositions.concat());\n\t\tclone.updateThickness(this._thickness.concat());\n\t\tclone.updatePositions(this._startPositions.concat(), this._endPositions.concat());\n\n\t\treturn clone;\n\t}\n\n\tpublic _pNotifyVerticesUpdate()\n\t{\n\t\tthis._pStrideOffsetDirty = true;\n\n\t\tthis.notifyPositionsUpdate();\n\t\tthis.notifyThicknessUpdate();\n\t\tthis.notifyColorsUpdate();\n\t}\n\n\tprivate notifyPositionsUpdate()\n\t{\n\t\tif (this._positionsDirty)\n\t\t\treturn;\n\n\t\tthis._positionsDirty = true;\n\n\t\tif (!this._positionsUpdated)\n\t\t\tthis._positionsUpdated = new SubGeometryEvent(SubGeometryEvent.VERTICES_UPDATED, TriangleSubGeometry.POSITION_DATA);\n\n\t\tthis.dispatchEvent(this._positionsUpdated);\n\t}\n\n\tprivate notifyThicknessUpdate()\n\t{\n\t\tif (this._thicknessDirty)\n\t\t\treturn;\n\n\t\tthis._thicknessDirty = true;\n\n\t\tif (!this._thicknessUpdated)\n\t\t\tthis._thicknessUpdated = new SubGeometryEvent(SubGeometryEvent.VERTICES_UPDATED, LineSubGeometry.THICKNESS_DATA);\n\n\t\tthis.dispatchEvent(this._thicknessUpdated);\n\t}\n\n\tprivate notifyColorsUpdate()\n\t{\n\t\tif (this._colorsDirty)\n\t\t\treturn;\n\n\t\tthis._colorsDirty = true;\n\n\t\tif (!this._colorUpdated)\n\t\t\tthis._colorUpdated = new SubGeometryEvent(SubGeometryEvent.VERTICES_UPDATED, LineSubGeometry.COLOR_DATA);\n\n\t\tthis.dispatchEvent(this._colorUpdated);\n\t}\n}\n\nexport = LineSubGeometry;","import AssetType\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\n\nimport ISubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/ISubMesh\");\nimport LineSubGeometry\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\nimport SubMeshBase\t\t\t\t= require(\"awayjs-display/lib/base/SubMeshBase\");\nimport IRendererPool\t\t\t= require(\"awayjs-display/lib/pool/IRendererPool\");\nimport Mesh\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\nimport MaterialBase\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\n\n/**\n * LineSubMesh wraps a LineSubGeometry as a scene graph instantiation. A LineSubMesh is owned by a Mesh object.\n *\n *\n * @see away.base.LineSubGeometry\n * @see away.entities.Mesh\n *\n * @class away.base.LineSubMesh\n */\nclass LineSubMesh extends SubMeshBase implements ISubMesh\n{\n\tprivate _subGeometry:LineSubGeometry;\n\n\t/**\n\t *\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.LINE_SUB_MESH;\n\t}\n\n\t/**\n\t * The LineSubGeometry object which provides the geometry data for this LineSubMesh.\n\t */\n\tpublic get subGeometry():LineSubGeometry\n\t{\n\t\treturn this._subGeometry;\n\t}\n\n\t/**\n\t * Creates a new LineSubMesh object\n\t * @param subGeometry The LineSubGeometry object which provides the geometry data for this LineSubMesh.\n\t * @param parentMesh The Mesh object to which this LineSubMesh belongs.\n\t * @param material An optional material used to render this LineSubMesh.\n\t */\n\tconstructor(subGeometry:LineSubGeometry, parentMesh:Mesh, material:MaterialBase = null)\n\t{\n\t\tsuper();\n\n\t\tthis._pParentMesh = parentMesh;\n\t\tthis._subGeometry = subGeometry;\n\t\tthis.material = material;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic dispose()\n\t{\n\t\tthis.material = null;\n\n\t\tsuper.dispose();\n\t}\n\n\tpublic _iCollectRenderable(rendererPool:IRendererPool)\n\t{\n\t\trendererPool.applyLineSubMesh(this);\n\t}\n}\n\nexport = LineSubMesh;","import EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport Loader\t\t\t\t\t= require(\"awayjs-display/lib/containers/Loader\");\nimport DisplayObject\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\n\n/**\n * The LoaderInfo class provides information about a loaded SWF file or a\n * loaded image file(JPEG, GIF, or PNG). LoaderInfo objects are available for\n * any display object. The information provided includes load progress, the\n * URLs of the loader and loaded content, the number of bytes total for the\n * media, and the nominal height and width of the media.\n *\n * <p>You can access LoaderInfo objects in two ways: </p>\n *\n * <ul>\n *   <li>The <code>contentLoaderInfo</code> property of a flash.display.Loader\n * object -  The <code>contentLoaderInfo</code> property is always available\n * for any Loader object. For a Loader object that has not called the\n * <code>load()</code> or <code>loadBytes()</code> method, or that has not\n * sufficiently loaded, attempting to access many of the properties of the\n * <code>contentLoaderInfo</code> property throws an error.</li>\n *   <li>The <code>loaderInfo</code> property of a display object. </li>\n * </ul>\n *\n * <p>The <code>contentLoaderInfo</code> property of a Loader object provides\n * information about the content that the Loader object is loading, whereas\n * the <code>loaderInfo</code> property of a DisplayObject provides\n * information about the root SWF file for that display object. </p>\n *\n * <p>When you use a Loader object to load a display object(such as a SWF\n * file or a bitmap), the <code>loaderInfo</code> property of the display\n * object is the same as the <code>contentLoaderInfo</code> property of the\n * Loader object(<code>DisplayObject.loaderInfo =\n * Loader.contentLoaderInfo</code>). Because the instance of the main class of\n * the SWF file has no Loader object, the <code>loaderInfo</code> property is\n * the only way to access the LoaderInfo for the instance of the main class of\n * the SWF file.</p>\n *\n * <p>The following diagram shows the different uses of the LoaderInfo\n * object - for the instance of the main class of the SWF file, for the\n * <code>contentLoaderInfo</code> property of a Loader object, and for the\n * <code>loaderInfo</code> property of a loaded object:</p>\n *\n * <p>When a loading operation is not complete, some properties of the\n * <code>contentLoaderInfo</code> property of a Loader object are not\n * available. You can obtain some properties, such as\n * <code>bytesLoaded</code>, <code>bytesTotal</code>, <code>url</code>,\n * <code>loaderURL</code>, and <code>applicationDomain</code>. When the\n * <code>loaderInfo</code> object dispatches the <code>init</code> event, you\n * can access all properties of the <code>loaderInfo</code> object and the\n * loaded image or SWF file.</p>\n *\n * <p><b>Note:</b> All properties of LoaderInfo objects are read-only.</p>\n *\n * <p>The <code>EventDispatcher.dispatchEvent()</code> method is not\n * applicable to LoaderInfo objects. If you call <code>dispatchEvent()</code>\n * on a LoaderInfo object, an IllegalOperationError exception is thrown.</p>\n * \n * @event complete   Dispatched when data has loaded successfully. In other\n *                   words, it is dispatched when all the content has been\n *                   downloaded and the loading has finished. The\n *                   <code>complete</code> event is always dispatched after\n *                   the <code>init</code> event. The <code>init</code> event\n *                   is dispatched when the object is ready to access, though\n *                   the content may still be downloading.\n * @event httpStatus Dispatched when a network request is made over HTTP and\n *                   an HTTP status code can be detected.\n * @event init       Dispatched when the properties and methods of a loaded\n *                   SWF file are accessible and ready for use. The content,\n *                   however, can still be downloading. A LoaderInfo object\n *                   dispatches the <code>init</code> event when the following\n *                   conditions exist:\n *                   <ul>\n *                     <li>All properties and methods associated with the\n *                   loaded object and those associated with the LoaderInfo\n *                   object are accessible.</li>\n *                     <li>The constructors for all child objects have\n *                   completed.</li>\n *                     <li>All ActionScript code in the first frame of the\n *                   loaded SWF's main timeline has been executed.</li>\n *                   </ul>\n *\n *                   <p>For example, an <code>Event.INIT</code> is dispatched\n *                   when the first frame of a movie or animation is loaded.\n *                   The movie is then accessible and can be added to the\n *                   display list. The complete movie, however, can take\n *                   longer to download. The <code>Event.COMPLETE</code> is\n *                   only dispatched once the full movie is loaded.</p>\n *\n *                   <p>The <code>init</code> event always precedes the\n *                   <code>complete</code> event.</p>\n * @event ioError    Dispatched when an input or output error occurs that\n *                   causes a load operation to fail.\n * @event open       Dispatched when a load operation starts.\n * @event progress   Dispatched when data is received as the download\n *                   operation progresses.\n * @event unload     Dispatched by a LoaderInfo object whenever a loaded\n *                   object is removed by using the <code>unload()</code>\n *                   method of the Loader object, or when a second load is\n *                   performed by the same Loader object and the original\n *                   content is removed prior to the load beginning.\n */\nclass LoaderInfo extends EventDispatcher\n{\n\tprivate _bytes:ByteArray;\n\tprivate _bytesLoaded:number;\n\tprivate _bytesTotal:number;\n\tprivate _content:DisplayObject;\n\tprivate _contentType:string;\n\tprivate _loader:Loader;\n\tprivate _url:string;\n\t/**\n\t * The bytes associated with a LoaderInfo object.\n\t * \n\t * @throws SecurityError If the object accessing this API is prevented from\n\t *                       accessing the loaded object due to security\n\t *                       restrictions. This situation can occur, for\n\t *                       instance, when a Loader object attempts to access\n\t *                       the <code>contentLoaderInfo.content</code> property\n\t *                       and it is not granted security permission to access\n\t *                       the loaded content.\n\t *\n\t *                       <p>For more information related to security, see the\n\t *                       Flash Player Developer Center Topic: <a\n\t *                       href=\"http://www.adobe.com/go/devnet_security_en\"\n\t *                       scope=\"external\">Security</a>.</p>\n\t */\n\tpublic get bytes():ByteArray\n\t{\n\t\treturn this._bytes;\n\t}\n\n\t/**\n\t * The number of bytes that are loaded for the media. When this number equals\n\t * the value of <code>bytesTotal</code>, all of the bytes are loaded.\n\t */\n\tpublic get bytesLoaded():number /*int*/\n\t{\n\t\treturn this._bytesLoaded;\n\t}\n\n\t/**\n\t * The number of compressed bytes in the entire media file.\n\t *\n\t * <p>Before the first <code>progress</code> event is dispatched by this\n\t * LoaderInfo object's corresponding Loader object, <code>bytesTotal</code>\n\t * is 0. After the first <code>progress</code> event from the Loader object,\n\t * <code>bytesTotal</code> reflects the actual number of bytes to be\n\t * downloaded.</p>\n\t */\n\tpublic get bytesTotal():number /*int*/\n\t{\n\t\treturn this._bytesTotal;\n\t}\n\n\t/**\n\t * The loaded object associated with this LoaderInfo object.\n\t * \n\t * @throws SecurityError If the object accessing this API is prevented from\n\t *                       accessing the loaded object due to security\n\t *                       restrictions. This situation can occur, for\n\t *                       instance, when a Loader object attempts to access\n\t *                       the <code>contentLoaderInfo.content</code> property\n\t *                       and it is not granted security permission to access\n\t *                       the loaded content.\n\t *\n\t *                       <p>For more information related to security, see the\n\t *                       Flash Player Developer Center Topic: <a\n\t *                       href=\"http://www.adobe.com/go/devnet_security_en\"\n\t *                       scope=\"external\">Security</a>.</p>\n\t */\n\tpublic get content():DisplayObject\n\t{\n\t\treturn this._content;\n\t}\n\n\t/**\n\t * The MIME type of the loaded file. The value is <code>null</code> if not\n\t * enough of the file has loaded in order to determine the type. The\n\t * following list gives the possible values:\n\t * <ul>\n\t *   <li><code>\"application/x-shockwave-flash\"</code></li>\n\t *   <li><code>\"image/jpeg\"</code></li>\n\t *   <li><code>\"image/gif\"</code></li>\n\t *   <li><code>\"image/png\"</code></li>\n\t * </ul>\n\t */\n\tpublic get contentType():string\n\t{\n\t\treturn this._contentType;\n\t}\n\n\t/**\n\t * The Loader object associated with this LoaderInfo object. If this\n\t * LoaderInfo object is the <code>loaderInfo</code> property of the instance\n\t * of the main class of the SWF file, no Loader object is associated.\n\t * \n\t * @throws SecurityError If the object accessing this API is prevented from\n\t *                       accessing the Loader object because of security\n\t *                       restrictions. This can occur, for instance, when a\n\t *                       loaded SWF file attempts to access its\n\t *                       <code>loaderInfo.loader</code> property and it is\n\t *                       not granted security permission to access the\n\t *                       loading SWF file.\n\t *\n\t *                       <p>For more information related to security, see the\n\t *                       Flash Player Developer Center Topic: <a\n\t *                       href=\"http://www.adobe.com/go/devnet_security_en\"\n\t *                       scope=\"external\">Security</a>.</p>\n\t */\n\tpublic get loader():Loader\n\t{\n\t\treturn this._loader;\n\t}\n\n\t/**\n\t * The URL of the media being loaded.\n\t *\n\t * <p>Before the first <code>progress</code> event is dispatched by this\n\t * LoaderInfo object's corresponding Loader object, the value of the\n\t * <code>url</code> property might reflect only the initial URL specified in\n\t * the call to the <code>load()</code> method of the Loader object. After the\n\t * first <code>progress</code> event, the <code>url</code> property reflects\n\t * the media's final URL, after any redirects and relative URLs are\n\t * resolved.</p>\n\t *\n\t * <p>In some cases, the value of the <code>url</code> property is truncated;\n\t * see the <code>isURLInaccessible</code> property for details.</p>\n\t */\n\tpublic get url():string\n\t{\n\t\treturn this._url;\n\t}\n}\n\nexport = LoaderInfo;","class OrientationMode\n{\n\t/**\n\t *\n\t */\n\tpublic static DEFAULT:string = \"default\";\n\n\t/**\n\t *\n\t */\n\tpublic static CAMERA_PLANE:string = \"cameraPlane\";\n\n\t/**\n\t *\n\t */\n\tpublic static CAMERA_POSITION:string = \"cameraPosition\";\n}\n\nexport = OrientationMode;","/**\n * The PixelSnapping class is an enumeration of constant values for setting\n * the pixel snapping options by using the <code>pixelSnapping</code> property\n * of a Bitmap object.\n */\nclass PixelSnapping\n{\n\t/**\n\t * A constant value used in the <code>pixelSnapping</code> property of a\n\t * Bitmap object to specify that the bitmap image is always snapped to the\n\t * nearest pixel, independent of any transformation.\n\t */\n\tpublic static ALWAYS:string = \"always\";\n\n\t/**\n\t * A constant value used in the <code>pixelSnapping</code> property of a\n\t * Bitmap object to specify that the bitmap image is snapped to the nearest\n\t * pixel if it is drawn with no rotation or skew and it is drawn at a scale\n\t * factor of 99.9% to 100.1%. If these conditions are satisfied, the image is\n\t * drawn at 100% scale, snapped to the nearest pixel. Internally, this\n\t * setting allows the image to be drawn as fast as possible by using the\n\t * vector renderer.\n\t */\n\tpublic static AUTO:string = \"auto\";\n\n\t/**\n\t * A constant value used in the <code>pixelSnapping</code> property of a\n\t * Bitmap object to specify that no pixel snapping occurs.\n\t */\n\tpublic static NEVER:string = \"never\";\n}\n\nexport = PixelSnapping;","/**\n * The SpreadMethod class provides values for the <code>spreadMethod</code>\n * parameter in the <code>beginGradientFill()</code> and\n * <code>lineGradientStyle()</code> methods of the Graphics class.\n *\n * <p>The following example shows the same gradient fill using various spread\n * methods:</p>\n */\nclass SpreadMethod\n{\n\t/**\n\t * Specifies that the gradient use the <i>pad</i> spread method.\n\t */\n\tpublic static PAD:string = \"pad\";\n\n\t/**\n\t * Specifies that the gradient use the <i>reflect</i> spread method.\n\t */\n\tpublic static REFLECT:string = \"reflect\";\n\n\t/**\n\t * Specifies that the gradient use the <i>repeat</i> spread method.\n\t */\n\tpublic static REPEAT:string = \"repeat\";\n}\n\nexport = SpreadMethod;","import NamedAssetBase\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\nimport Matrix3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Rectangle\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nimport Geometry\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\nimport ISubMeshClass\t\t\t= require(\"awayjs-display/lib/base/ISubMeshClass\");\nimport SubGeometryEvent\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\n\n/**\n * @class away.base.TriangleSubGeometry\n */\nclass SubGeometryBase extends NamedAssetBase\n{\n\tpublic static VERTEX_DATA:string = \"vertices\";\n\n\tpublic _pStrideOffsetDirty:boolean = true;\n\n\tpublic _pIndices:Array<number> /*uint*/;\n\tpublic _pVertices:Array<number>;\n\n\tprivate _numIndices:number;\n\tprivate _numTriangles:number;\n\tpublic _pNumVertices:number;\n\n\tpublic _pConcatenateArrays:boolean = true;\n\n\tprivate _indicesUpdated:SubGeometryEvent;\n\n\tpublic _pStride:Object = new Object();\n\tpublic _pOffset:Object = new Object();\n\n\tpublic _pUpdateStrideOffset()\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic _pSubMeshClass:ISubMeshClass;\n\n\tpublic get subMeshClass():ISubMeshClass\n\t{\n\t\treturn this._pSubMeshClass;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get concatenateArrays():boolean\n\t{\n\t\treturn this._pConcatenateArrays;\n\t}\n\n\tpublic set concatenateArrays(value:boolean)\n\t{\n\t\tif (this._pConcatenateArrays == value)\n\t\t\treturn;\n\n\t\tthis._pConcatenateArrays = value;\n\n\t\tthis._pStrideOffsetDirty = true;\n\n\t\tif (value)\n\t\t\tthis._pNotifyVerticesUpdate();\n\t}\n\n\t/**\n\t * The raw index data that define the faces.\n\t */\n\tpublic get indices():Array<number>\n\t{\n\t\treturn this._pIndices;\n\t}\n\n\t/**\n\t * \n\t */\n\tpublic get vertices():Array<number>\n\t{\n\t\tthis.updateVertices();\n\n\t\treturn this._pVertices;\n\t}\n\n\t/**\n\t * The total amount of triangles in the TriangleSubGeometry.\n\t */\n\tpublic get numTriangles():number\n\t{\n\t\treturn this._numTriangles;\n\t}\n\n\tpublic get numVertices():number\n\t{\n\t\treturn this._pNumVertices;\n\t}\n\n\t/**\n\t *\n\t */\n\tconstructor(concatenatedArrays:boolean)\n\t{\n\t\tsuper();\n\n\t\tthis._pConcatenateArrays = concatenatedArrays;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic getStride(dataType:string)\n\t{\n\t\tif (this._pStrideOffsetDirty)\n\t\t\tthis._pUpdateStrideOffset();\n\n\t\treturn this._pStride[dataType];\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic getOffset(dataType:string)\n\t{\n\t\tif (this._pStrideOffsetDirty)\n\t\t\tthis._pUpdateStrideOffset();\n\n\t\treturn this._pOffset[dataType];\n\t}\n\n\tpublic updateVertices()\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._pIndices = null;\n\t\tthis._pVertices = null;\n\t}\n\n\t/**\n\t * Updates the face indices of the TriangleSubGeometry.\n\t *\n\t * @param indices The face indices to upload.\n\t */\n\tpublic updateIndices(indices:Array<number>)\n\t{\n\t\tthis._pIndices = indices;\n\t\tthis._numIndices = indices.length;\n\n\t\tthis._numTriangles = this._numIndices/3;\n\n\t\tthis.notifyIndicesUpdate();\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tpublic pInvalidateBounds()\n\t{\n\t\tif (this.parentGeometry)\n\t\t\tthis.parentGeometry.iInvalidateBounds(this);\n\t}\n\n\t/**\n\t * The Geometry object that 'owns' this TriangleSubGeometry object.\n\t *\n\t * @private\n\t */\n\tpublic parentGeometry:Geometry;\n\n\t/**\n\t * Clones the current object\n\t * @return An exact duplicate of the current object.\n\t */\n\tpublic clone():SubGeometryBase\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic applyTransformation(transform:Matrix3D)\n\t{\n\n\t}\n\n\t/**\n\t * Scales the geometry.\n\t * @param scale The amount by which to scale.\n\t */\n\tpublic scale(scale:number)\n\t{\n\n\t}\n\n\tpublic scaleUV(scaleU:number = 1, scaleV:number = 1)\n\t{\n\n\t}\n\n\tpublic getBoundingPositions():Array<number>\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tprivate notifyIndicesUpdate()\n\t{\n\t\tif (!this._indicesUpdated)\n\t\t\tthis._indicesUpdated = new SubGeometryEvent(SubGeometryEvent.INDICES_UPDATED);\n\n\t\tthis.dispatchEvent(this._indicesUpdated);\n\t}\n\n\tpublic _pNotifyVerticesUpdate()\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n}\n\nexport = SubGeometryBase;","import AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport UVTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/UVTransform\");\nimport NamedAssetBase\t\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\n\nimport IAnimator\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimator\");\nimport IRenderable\t\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderable\");\nimport IRendererPool\t\t\t\t= require(\"awayjs-display/lib/pool/IRendererPool\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport Mesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\n\n/**\n * SubMeshBase wraps a TriangleSubGeometry as a scene graph instantiation. A SubMeshBase is owned by a Mesh object.\n *\n *\n * @see away.base.TriangleSubGeometry\n * @see away.entities.Mesh\n *\n * @class away.base.SubMeshBase\n */\nclass SubMeshBase extends NamedAssetBase\n{\n\tpublic _pParentMesh:Mesh;\n\tpublic _uvTransform:UVTransform;\n\n\tpublic _iIndex:number = 0;\n\n\tpublic _material:MaterialBase;\n\tprivate _renderables:Array<IRenderable> = new Array<IRenderable>();\n\n\t//TODO test shader picking\n//\t\tpublic get shaderPickingDetails():boolean\n//\t\t{\n//\n//\t\t\treturn this.sourceEntity.shaderPickingDetails;\n//\t\t}\n\n\t/**\n\t * The animator object that provides the state for the TriangleSubMesh's animation.\n\t */\n\tpublic get animator():IAnimator\n\t{\n\t\treturn this._pParentMesh.animator;\n\t}\n\n\t/**\n\t * The material used to render the current TriangleSubMesh. If set to null, its parent Mesh's material will be used instead.\n\t */\n\tpublic get material():MaterialBase\n\t{\n\t\treturn this._material || this._pParentMesh.material;\n\t}\n\n\tpublic set material(value:MaterialBase)\n\t{\n\t\tif (this.material)\n\t\t\tthis.material.iRemoveOwner(this);\n\n\t\tthis._material = value;\n\n\t\tif (this.material)\n\t\t\tthis.material.iAddOwner(this);\n\t}\n\n\t/**\n\t * The scene transform object that transforms from model to world space.\n\t */\n\tpublic get sceneTransform():Matrix3D\n\t{\n\t\treturn this._pParentMesh.sceneTransform;\n\t}\n\n\t/**\n\t * The entity that that initially provided the IRenderable to the render pipeline (ie: the owning Mesh object).\n\t */\n\tpublic get parentMesh():Mesh\n\t{\n\t\treturn this._pParentMesh;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get uvTransform():UVTransform\n\t{\n\t\treturn this._uvTransform || this._pParentMesh.uvTransform;\n\t}\n\n\tpublic set uvTransform(value:UVTransform)\n\t{\n\t\tthis._uvTransform = value;\n\t}\n\n\t/**\n\t * Creates a new SubMeshBase object\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic dispose()\n\t{\n\t\tthis.material = null;\n\n\t\tvar len:number = this._renderables.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._renderables[i].dispose();\n\n\t\tthis._renderables = new Array<IRenderable>();\n\t}\n\n\t/**\n\t *\n\t * @param camera\n\t * @returns {away.geom.Matrix3D}\n\t */\n\tpublic getRenderSceneTransform(camera:Camera):Matrix3D\n\t{\n\t\treturn this._pParentMesh.getRenderSceneTransform(camera);\n\t}\n\n\tpublic _iAddRenderable(renderable:IRenderable):IRenderable\n\t{\n\t\tthis._renderables.push(renderable);\n\n\t\treturn renderable;\n\t}\n\n\n\tpublic _iRemoveRenderable(renderable:IRenderable):IRenderable\n\t{\n\t\tvar index:number = this._renderables.indexOf(renderable);\n\n\t\tthis._renderables.splice(index, 1);\n\n\t\treturn renderable;\n\t}\n\n\tpublic _iInvalidateRenderableGeometry()\n\t{\n\t\tvar len:number = this._renderables.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._renderables[i].invalidateGeometry();\n\t}\n\n\tpublic _iCollectRenderable(rendererPool:IRendererPool)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic _iGetExplicitMaterial():MaterialBase\n\t{\n\t\treturn this._material;\n\t}\n}\n\nexport = SubMeshBase;","import ColorTransform\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\nimport Matrix\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\nimport Matrix3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\nimport Rectangle\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport PerspectiveProjection\t= require(\"awayjs-core/lib/projections/PerspectiveProjection\");\n\nimport DisplayObject\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\n\n/**\n * The Transform class provides access to color adjustment properties and two-\n * or three-dimensional transformation objects that can be applied to a\n * display object. During the transformation, the color or the orientation and\n * position of a display object is adjusted(offset) from the current values\n * or coordinates to new values or coordinates. The Transform class also\n * collects data about color and two-dimensional matrix transformations that\n * are applied to a display object and all of its parent objects. You can\n * access these combined transformations through the\n * <code>concatenatedColorTransform</code> and <code>concatenatedMatrix</code>\n * properties.\n *\n * <p>To apply color transformations: create a ColorTransform object, set the\n * color adjustments using the object's methods and properties, and then\n * assign the <code>colorTransformation</code> property of the\n * <code>transform</code> property of the display object to the new\n * ColorTransformation object.</p>\n *\n * <p>To apply two-dimensional transformations: create a Matrix object, set\n * the matrix's two-dimensional transformation, and then assign the\n * <code>transform.matrix</code> property of the display object to the new\n * Matrix object.</p>\n *\n * <p>To apply three-dimensional transformations: start with a\n * three-dimensional display object. A three-dimensional display object has a\n * <code>z</code> property value other than zero. You do not need to create\n * the Matrix3D object. For all three-dimensional objects, a Matrix3D object\n * is created automatically when you assign a <code>z</code> value to a\n * display object. You can access the display object's Matrix3D object through\n * the display object's <code>transform</code> property. Using the methods of\n * the Matrix3D class, you can add to or modify the existing transformation\n * settings. Also, you can create a custom Matrix3D object, set the custom\n * Matrix3D object's transformation elements, and then assign the new Matrix3D\n * object to the display object using the <code>transform.matrix</code>\n * property.</p>\n *\n * <p>To modify a perspective projection of the stage or root object: use the\n * <code>transform.matrix</code> property of the root display object to gain\n * access to the PerspectiveProjection object. Or, apply different perspective\n * projection properties to a display object by setting the perspective\n * projection properties of the display object's parent. The child display\n * object inherits the new properties. Specifically, create a\n * PerspectiveProjection object and set its properties, then assign the\n * PerspectiveProjection object to the <code>perspectiveProjection</code>\n * property of the parent display object's <code>transform</code> property.\n * The specified projection transformation then applies to all the display\n * object's three-dimensional children.</p>\n *\n * <p>Since both PerspectiveProjection and Matrix3D objects perform\n * perspective transformations, do not assign both to a display object at the\n * same time. Use the PerspectiveProjection object for focal length and\n * projection center changes. For more control over the perspective\n * transformation, create a perspective projection Matrix3D object.</p>\n */\nclass Transform\n{\n\tprivate _displayObject:DisplayObject;\n\tprivate _concatenatedColorTransform:ColorTransform;\n\tprivate _concatenatedMatrix:Matrix;\n\tprivate _pixelBounds:Rectangle;\n\tpublic _position:Vector3D = new Vector3D();\n\n\t/**\n\t *\n\t */\n\tpublic get backVector():Vector3D\n\t{\n\t\tvar director:Vector3D = Matrix3DUtils.getForward(this._displayObject._iMatrix3D);\n\t\tdirector.negate();\n\n\t\treturn director;\n\t}\n\n\t/**\n\t * A ColorTransform object containing values that universally adjust the\n\t * colors in the display object.\n\t * \n\t * @throws TypeError The colorTransform is null when being set\n\t */\n\tpublic colorTransform:ColorTransform;\n\n\t/**\n\t * A ColorTransform object representing the combined color transformations\n\t * applied to the display object and all of its parent objects, back to the\n\t * root level. If different color transformations have been applied at\n\t * different levels, all of those transformations are concatenated into one\n\t * ColorTransform object for this property.\n\t */\n\tpublic get concatenatedColorTransform():ColorTransform\n\t{\n\t\treturn this._concatenatedColorTransform; //TODO\n\t}\n\n\t/**\n\t * A Matrix object representing the combined transformation matrixes of the\n\t * display object and all of its parent objects, back to the root level. If\n\t * different transformation matrixes have been applied at different levels,\n\t * all of those matrixes are concatenated into one matrix for this property.\n\t * Also, for resizeable SWF content running in the browser, this property\n\t * factors in the difference between stage coordinates and window coordinates\n\t * due to window resizing. Thus, the property converts local coordinates to\n\t * window coordinates, which may not be the same coordinate space as that of\n\t * the Stage.\n\t */\n\tpublic get concatenatedMatrix():Matrix\n\t{\n\t\treturn this._concatenatedMatrix; //TODO\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get downVector():Vector3D\n\t{\n\t\tvar director:Vector3D = Matrix3DUtils.getUp(this._displayObject._iMatrix3D);\n\t\tdirector.negate();\n\n\t\treturn director;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get forwardVector():Vector3D\n\t{\n\t\treturn Matrix3DUtils.getForward(this._displayObject._iMatrix3D);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get leftVector():Vector3D\n\t{\n\t\tvar director:Vector3D = Matrix3DUtils.getRight(this._displayObject._iMatrix3D);\n\t\tdirector.negate();\n\n\t\treturn director;\n\t}\n\n\t/**\n\t * A Matrix object containing values that alter the scaling, rotation, and\n\t * translation of the display object.\n\t *\n\t * <p>If the <code>matrix</code> property is set to a value(not\n\t * <code>null</code>), the <code>matrix3D</code> property is\n\t * <code>null</code>. And if the <code>matrix3D</code> property is set to a\n\t * value(not <code>null</code>), the <code>matrix</code> property is\n\t * <code>null</code>.</p>\n\t * \n\t * @throws TypeError The matrix is null when being set\n\t */\n\tpublic matrix:Matrix;\n\n\t/**\n\t * Provides access to the Matrix3D object of a three-dimensional display\n\t * object. The Matrix3D object represents a transformation matrix that\n\t * determines the display object's position and orientation. A Matrix3D\n\t * object can also perform perspective projection.\n\t *\n\t * <p>If the <code>matrix</code> property is set to a value(not\n\t * <code>null</code>), the <code>matrix3D</code> property is\n\t * <code>null</code>. And if the <code>matrix3D</code> property is set to a\n\t * value(not <code>null</code>), the <code>matrix</code> property is\n\t * <code>null</code>.</p>\n\t */\n\tpublic get matrix3D():Matrix3D\n\t{\n\t\treturn this._displayObject._iMatrix3D;\n\t}\n\n\tpublic set matrix3D(val:Matrix3D)\n\t{\n\t\tthis._displayObject._iMatrix3D = val;\n\t}\n\n\t/**\n\t * Provides access to the PerspectiveProjection object of a three-dimensional\n\t * display object. The PerspectiveProjection object can be used to modify the\n\t * perspective transformation of the stage or to assign a perspective\n\t * transformation to all the three-dimensional children of a display object.\n\t *\n\t * <p>Based on the field of view and aspect ratio(dimensions) of the stage,\n\t * a default PerspectiveProjection object is assigned to the root object.</p>\n\t */\n\tpublic perspectiveProjection:PerspectiveProjection;\n\n\t/**\n\t * A Rectangle object that defines the bounding rectangle of the display\n\t * object on the stage.\n\t */\n\tpublic get pixelBounds():Rectangle\n\t{\n\t\treturn this._pixelBounds;\n\t}\n\n\t/**\n\t * Defines the position of the 3d object, relative to the local coordinates of the parent <code>ObjectContainer3D</code>.\n\t */\n\tpublic get position():Vector3D\n\t{\n\t\treturn this._displayObject._iMatrix3D.position\n\t}\n\n\tpublic set position(value:Vector3D)\n\t{\n\t\tthis._displayObject.x = value.x;\n\t\tthis._displayObject.y = value.y;\n\t\tthis._displayObject.z = value.z;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get rightVector():Vector3D\n\t{\n\t\treturn Matrix3DUtils.getRight(this._displayObject._iMatrix3D);\n\t}\n\n\t/**\n\t * Defines the rotation of the 3d object, relative to the local coordinates of the parent <code>ObjectContainer3D</code>.\n\t */\n\tpublic get rotation():Vector3D\n\t{\n\t\treturn new Vector3D(this._displayObject.rotationX, this._displayObject.rotationY, this._displayObject.rotationZ);\n\t}\n\n\tpublic set rotation(value:Vector3D)\n\t{\n\t\tthis._displayObject.rotationX = value.x;\n\t\tthis._displayObject.rotationY = value.y;\n\t\tthis._displayObject.rotationZ = value.z;\n\t}\n\n\t/**\n\t * Defines the scale of the 3d object, relative to the local coordinates of the parent <code>ObjectContainer3D</code>.\n\t */\n\tpublic get scale():Vector3D\n\t{\n\t\treturn new Vector3D(this._displayObject.scaleX, this._displayObject.scaleY, this._displayObject.scaleZ);\n\t}\n\n\tpublic set scale(value:Vector3D)\n\t{\n\t\tthis._displayObject.scaleX = value.x;\n\t\tthis._displayObject.scaleY = value.y;\n\t\tthis._displayObject.scaleZ = value.z;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get upVector():Vector3D\n\t{\n\t\treturn Matrix3DUtils.getUp(this._displayObject._iMatrix3D);\n\t}\n\n\tconstructor(displayObject:DisplayObject)\n\t{\n\t\tthis._displayObject = displayObject;\n\t}\n\n\t/**\n\t * Returns a Matrix3D object, which can transform the space of a specified\n\t * display object in relation to the current display object's space. You can\n\t * use the <code>getRelativeMatrix3D()</code> method to move one\n\t * three-dimensional display object relative to another three-dimensional\n\t * display object.\n\t * \n\t * @param relativeTo The display object relative to which the transformation\n\t *                   occurs. To get a Matrix3D object relative to the stage,\n\t *                   set the parameter to the <code>root</code> or\n\t *                   <code>stage</code> object. To get the world-relative\n\t *                   matrix of the display object, set the parameter to a\n\t *                   display object that has a perspective transformation\n\t *                   applied to it.\n\t * @return A Matrix3D object that can be used to transform the space from the\n\t *         <code>relativeTo</code> display object to the current display\n\t *         object space.\n\t */\n\tpublic getRelativeMatrix3D(relativeTo:DisplayObject):Matrix3D\n\t{\n\t\treturn new Matrix3D(); //TODO\n\t}\n\n\n\t/**\n\t * Moves the 3d object forwards along it's local z axis\n\t *\n\t * @param    distance    The length of the movement\n\t */\n\tpublic moveForward(distance:number)\n\t{\n\t\tthis._displayObject.translateLocal(Vector3D.Z_AXIS, distance);\n\t}\n\n\t/**\n\t * Moves the 3d object backwards along it's local z axis\n\t *\n\t * @param    distance    The length of the movement\n\t */\n\tpublic moveBackward(distance:number)\n\t{\n\t\tthis._displayObject.translateLocal(Vector3D.Z_AXIS, -distance);\n\t}\n\n\t/**\n\t * Moves the 3d object backwards along it's local x axis\n\t *\n\t * @param    distance    The length of the movement\n\t */\n\n\tpublic moveLeft(distance:number)\n\t{\n\t\tthis._displayObject.translateLocal(Vector3D.X_AXIS, -distance);\n\t}\n\n\t/**\n\t * Moves the 3d object forwards along it's local x axis\n\t *\n\t * @param    distance    The length of the movement\n\t */\n\tpublic moveRight(distance:number)\n\t{\n\t\tthis._displayObject.translateLocal(Vector3D.X_AXIS, distance);\n\t}\n\n\t/**\n\t * Moves the 3d object forwards along it's local y axis\n\t *\n\t * @param    distance    The length of the movement\n\t */\n\tpublic moveUp(distance:number)\n\t{\n\t\tthis._displayObject.translateLocal(Vector3D.Y_AXIS, distance);\n\t}\n\n\t/**\n\t * Moves the 3d object backwards along it's local y axis\n\t *\n\t * @param    distance    The length of the movement\n\t */\n\tpublic moveDown(distance:number)\n\t{\n\t\tthis._displayObject.translateLocal(Vector3D.Y_AXIS, -distance);\n\t}\n}\n\nexport = Transform;\n","/**\n * Defines codes for culling algorithms that determine which triangles not to\n * render when drawing triangle paths.\n *\n * <p> The terms <code>POSITIVE</code> and <code>NEGATIVE</code> refer to the\n * sign of a triangle's normal along the z-axis. The normal is a 3D vector\n * that is perpendicular to the surface of the triangle. </p>\n *\n * <p> A triangle whose vertices 0, 1, and 2 are arranged in a clockwise order\n * has a positive normal value. That is, its normal points in a positive\n * z-axis direction, away from the current view point. When the\n * <code>TriangleCulling.POSITIVE</code> algorithm is used, triangles with\n * positive normals are not rendered. Another term for this is backface\n * culling. </p>\n *\n * <p> A triangle whose vertices are arranged in a counter-clockwise order has\n * a negative normal value. That is, its normal points in a negative z-axis\n * direction, toward the current view point. When the\n * <code>TriangleCulling.NEGATIVE</code> algorithm is used, triangles with\n * negative normals will not be rendered. </p>\n */\nclass TriangleCulling\n{\n\t/**\n\t * Specifies culling of all triangles facing toward the current view point.\n\t */\n\tpublic static NEGATIVE:string = \"negative\";\n\n\t/**\n\t * Specifies no culling. All triangles in the path are rendered.\n\t */\n\tpublic static NONE:string = \"none\";\n\n\t/**\n\t * Specifies culling of all triangles facing away from the current view\n\t * point. This is also known as backface culling.\n\t */\n\tpublic static POSITIVE:string = \"positive\";\n}\n\nexport = TriangleCulling;","import Matrix3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport SubGeometryBase\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport TriangleSubMesh\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\nimport SubGeometryEvent\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\n\n/**\n * @class away.base.TriangleSubGeometry\n */\nclass TriangleSubGeometry extends SubGeometryBase\n{\n\tpublic static POSITION_DATA:string = \"positions\";\n\tpublic static NORMAL_DATA:string = \"vertexNormals\";\n\tpublic static TANGENT_DATA:string = \"vertexTangents\";\n\tpublic static UV_DATA:string = \"uvs\";\n\tpublic static SECONDARY_UV_DATA:string = \"secondaryUVs\";\n\tpublic static JOINT_INDEX_DATA:string = \"jointIndices\";\n\tpublic static JOINT_WEIGHT_DATA:string = \"jointWeights\";\n\n\t//TODO - move these to StageGL\n\tpublic static POSITION_FORMAT:string = \"float3\";\n\tpublic static NORMAL_FORMAT:string = \"float3\";\n\tpublic static TANGENT_FORMAT:string = \"float3\";\n\tpublic static UV_FORMAT:string = \"float2\";\n\tpublic static SECONDARY_UV_FORMAT:string = \"float2\";\n\n\tprivate _positionsDirty:boolean = true;\n\tprivate _faceNormalsDirty:boolean = true;\n\tprivate _faceTangentsDirty:boolean = true;\n\tprivate _vertexNormalsDirty:boolean = true;\n\tprivate _vertexTangentsDirty:boolean = true;\n\tprivate _uvsDirty:boolean = true;\n\tprivate _secondaryUVsDirty:boolean = true;\n\tprivate _jointIndicesDirty:boolean = true;\n\tprivate _jointWeightsDirty:boolean = true;\n\n\tprivate _positions:Array<number>;\n\tprivate _vertexNormals:Array<number>;\n\tprivate _vertexTangents:Array<number>;\n\tprivate _uvs:Array<number>;\n\tprivate _secondaryUVs:Array<number>;\n\tprivate _jointIndices:Array<number>;\n\tprivate _jointWeights:Array<number>;\n\n\tprivate _useCondensedIndices:boolean;\n\tprivate _condensedJointIndices:Array<number>;\n\tprivate _condensedIndexLookUp:Array<number>;\n\tprivate _numCondensedJoints:number;\n\n\tprivate _jointsPerVertex:number;\n\n\tprivate _concatenateArrays:boolean = true;\n\tprivate _autoDeriveNormals:boolean = true;\n\tprivate _autoDeriveTangents:boolean = true;\n\tprivate _autoDeriveUVs:boolean = false;\n\tprivate _useFaceWeights:boolean = false;\n\n\tprivate _faceNormals:Array<number>;\n\tprivate _faceTangents:Array<number>;\n\tprivate _faceWeights:Array<number>;\n\n\tprivate _scaleU:number = 1;\n\tprivate _scaleV:number = 1;\n\n\tprivate _positionsUpdated:SubGeometryEvent;\n\tprivate _normalsUpdated:SubGeometryEvent;\n\tprivate _tangentsUpdated:SubGeometryEvent;\n\tprivate _uvsUpdated:SubGeometryEvent;\n\tprivate _secondaryUVsUpdated:SubGeometryEvent;\n\tprivate _jointIndicesUpdated:SubGeometryEvent;\n\tprivate _jointWeightsUpdated:SubGeometryEvent;\n\n\t/**\n\t *\n\t */\n\tpublic get scaleU():number\n\t{\n\t\treturn this._scaleU;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get scaleV():number\n\t{\n\t\treturn this._scaleV;\n\t}\n\n\t/**\n\t * Offers the option of enabling GPU accelerated animation on skeletons larger than 32 joints\n\t * by condensing the number of joint index values required per mesh. Only applicable to\n\t * skeleton animations that utilise more than one mesh object. Defaults to false.\n\t */\n\tpublic get useCondensedIndices():boolean\n\t{\n\t\treturn this._useCondensedIndices;\n\t}\n\n\tpublic set useCondensedIndices(value:boolean)\n\t{\n\t\tif (this._useCondensedIndices == value)\n\t\t\treturn;\n\n\t\tthis._useCondensedIndices = value;\n\n\t\tthis.notifyJointIndicesUpdate();\n\t}\n\n\tpublic _pUpdateStrideOffset()\n\t{\n\t\tif (this._concatenateArrays) {\n\t\t\tthis._pOffset[TriangleSubGeometry.VERTEX_DATA] = 0;\n\n\t\t\t//always have positions\n\t\t\tthis._pOffset[TriangleSubGeometry.POSITION_DATA] = 0;\n\t\t\tvar stride:number = 3;\n\n\t\t\tif (this._vertexNormals != null) {\n\t\t\t\tthis._pOffset[TriangleSubGeometry.NORMAL_DATA] = stride;\n\t\t\t\tstride += 3;\n\t\t\t}\n\n\t\t\tif (this._vertexTangents != null) {\n\t\t\t\tthis._pOffset[TriangleSubGeometry.TANGENT_DATA] = stride;\n\t\t\t\tstride += 3;\n\t\t\t}\n\n\t\t\tif (this._uvs != null) {\n\t\t\t\tthis._pOffset[TriangleSubGeometry.UV_DATA] = stride;\n\t\t\t\tstride += 2;\n\t\t\t}\n\n\t\t\tif (this._secondaryUVs != null) {\n\t\t\t\tthis._pOffset[TriangleSubGeometry.SECONDARY_UV_DATA] = stride;\n\t\t\t\tstride += 2;\n\t\t\t}\n\n\t\t\tif (this._jointIndices != null) {\n\t\t\t\tthis._pOffset[TriangleSubGeometry.JOINT_INDEX_DATA] = stride;\n\t\t\t\tstride += this._jointsPerVertex;\n\t\t\t}\n\n\t\t\tif (this._jointWeights != null) {\n\t\t\t\tthis._pOffset[TriangleSubGeometry.JOINT_WEIGHT_DATA] = stride;\n\t\t\t\tstride += this._jointsPerVertex;\n\t\t\t}\n\n\t\t\tthis._pStride[TriangleSubGeometry.VERTEX_DATA] = stride;\n\t\t\tthis._pStride[TriangleSubGeometry.POSITION_DATA] = stride;\n\t\t\tthis._pStride[TriangleSubGeometry.NORMAL_DATA] = stride;\n\t\t\tthis._pStride[TriangleSubGeometry.TANGENT_DATA] = stride;\n\t\t\tthis._pStride[TriangleSubGeometry.UV_DATA] = stride;\n\t\t\tthis._pStride[TriangleSubGeometry.SECONDARY_UV_DATA] = stride;\n\t\t\tthis._pStride[TriangleSubGeometry.JOINT_INDEX_DATA] = stride;\n\t\t\tthis._pStride[TriangleSubGeometry.JOINT_WEIGHT_DATA] = stride;\n\n\t\t\tvar len:number = this._pNumVertices*stride;\n\n\t\t\tif (this._pVertices == null)\n\t\t\t\tthis._pVertices = new Array<number>(len);\n\t\t\telse if (this._pVertices.length != len)\n\t\t\t\tthis._pVertices.length = len;\n\n\t\t} else {\n\t\t\tthis._pOffset[TriangleSubGeometry.POSITION_DATA] = 0;\n\t\t\tthis._pOffset[TriangleSubGeometry.NORMAL_DATA] = 0;\n\t\t\tthis._pOffset[TriangleSubGeometry.TANGENT_DATA] = 0;\n\t\t\tthis._pOffset[TriangleSubGeometry.UV_DATA] = 0;\n\t\t\tthis._pOffset[TriangleSubGeometry.SECONDARY_UV_DATA] = 0;\n\t\t\tthis._pOffset[TriangleSubGeometry.JOINT_INDEX_DATA] = 0;\n\t\t\tthis._pOffset[TriangleSubGeometry.JOINT_WEIGHT_DATA] = 0;\n\n\t\t\tthis._pStride[TriangleSubGeometry.POSITION_DATA] = 3;\n\t\t\tthis._pStride[TriangleSubGeometry.NORMAL_DATA] = 3;\n\t\t\tthis._pStride[TriangleSubGeometry.TANGENT_DATA] = 3;\n\t\t\tthis._pStride[TriangleSubGeometry.UV_DATA] = 2;\n\t\t\tthis._pStride[TriangleSubGeometry.SECONDARY_UV_DATA] = 2;\n\t\t\tthis._pStride[TriangleSubGeometry.JOINT_INDEX_DATA] = this._jointsPerVertex;\n\t\t\tthis._pStride[TriangleSubGeometry.JOINT_WEIGHT_DATA] = this._jointsPerVertex;\n\t\t}\n\n\t\tthis._pStrideOffsetDirty = false;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get jointsPerVertex():number\n\t{\n\t\treturn this._jointsPerVertex;\n\t}\n\n\tpublic set jointsPerVertex(value:number)\n\t{\n\t\tif (this._jointsPerVertex == value)\n\t\t\treturn;\n\n\t\tthis._jointsPerVertex = value;\n\n\t\tthis._pStrideOffsetDirty = true;\n\n\t\tif (this._pConcatenateArrays)\n\t\t\tthis._pNotifyVerticesUpdate();\n\t}\n\n\t/**\n\t * Defines whether a UV buffer should be automatically generated to contain dummy UV coordinates.\n\t * Set to true if a geometry lacks UV data but uses a material that requires it, or leave as false\n\t * in cases where UV data is explicitly defined or the material does not require UV data.\n\t */\n\tpublic get autoDeriveUVs():boolean\n\t{\n\t\treturn this._autoDeriveUVs;\n\t}\n\n\tpublic set autoDeriveUVs(value:boolean)\n\t{\n\t\tif (this._autoDeriveUVs == value)\n\t\t\treturn;\n\n\t\tthis._autoDeriveUVs = value;\n\n\t\tif (value)\n\t\t\tthis.notifyUVsUpdate();\n\t}\n\n\t/**\n\t * True if the vertex normals should be derived from the geometry, false if the vertex normals are set\n\t * explicitly.\n\t */\n\tpublic get autoDeriveNormals():boolean\n\t{\n\t\treturn this._autoDeriveNormals;\n\t}\n\n\tpublic set autoDeriveNormals(value:boolean)\n\t{\n\t\tif (this._autoDeriveNormals == value)\n\t\t\treturn;\n\n\t\tthis._autoDeriveNormals = value;\n\n\t\tif (value)\n\t\t\tthis.notifyNormalsUpdate();\n\t}\n\n\t/**\n\t * True if the vertex tangents should be derived from the geometry, false if the vertex normals are set\n\t * explicitly.\n\t */\n\tpublic get autoDeriveTangents():boolean\n\t{\n\t\treturn this._autoDeriveTangents;\n\t}\n\n\tpublic set autoDeriveTangents(value:boolean)\n\t{\n\t\tif (this._autoDeriveTangents == value)\n\t\t\treturn;\n\n\t\tthis._autoDeriveTangents = value;\n\n\t\tif (value)\n\t\t\tthis.notifyTangentsUpdate();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get vertices():Array<number>\n\t{\n\t\tif (this._positionsDirty)\n\t\t\tthis.updatePositions(this._positions);\n\n\t\tif (this._vertexNormalsDirty)\n\t\t\tthis.updateVertexNormals(this._vertexNormals);\n\n\t\tif (this._vertexTangentsDirty)\n\t\t\tthis.updateVertexTangents(this._vertexTangents);\n\n\t\tif (this._uvsDirty)\n\t\t\tthis.updateUVs(this._uvs);\n\n\t\tif (this._secondaryUVsDirty)\n\t\t\tthis.updateSecondaryUVs(this._secondaryUVs);\n\n\t\tif (this._jointIndicesDirty)\n\t\t\tthis.updateJointIndices(this._jointIndices);\n\n\t\tif (this._jointWeightsDirty)\n\t\t\tthis.updateJointWeights(this._jointWeights);\n\n\t\treturn this._pVertices;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get positions():Array<number>\n\t{\n\t\tif (this._positionsDirty)\n\t\t\tthis.updatePositions(this._positions);\n\n\t\treturn this._positions;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get vertexNormals():Array<number>\n\t{\n\t\tif (this._vertexNormalsDirty)\n\t\t\tthis.updateVertexNormals(this._vertexNormals);\n\n\t\treturn this._vertexNormals;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get vertexTangents():Array<number>\n\t{\n\t\tif (this._vertexTangentsDirty)\n\t\t\tthis.updateVertexTangents(this._vertexTangents);\n\n\t\treturn this._vertexTangents;\n\t}\n\n\t/**\n\t * The raw data of the face normals, in the same order as the faces are listed in the index list.\n\t */\n\tpublic get faceNormals():Array<number>\n\t{\n\t\tif (this._faceNormalsDirty)\n\t\t\tthis.updateFaceNormals();\n\n\t\treturn this._faceNormals;\n\t}\n\n\t/**\n\t * The raw data of the face tangets, in the same order as the faces are listed in the index list.\n\t */\n\tpublic get faceTangents():Array<number>\n\t{\n\t\tif (this._faceTangentsDirty)\n\t\t\tthis.updateFaceTangents();\n\n\t\treturn this._faceTangents;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get uvs():Array<number>\n\t{\n\t\tif (this._uvsDirty)\n\t\t\tthis.updateUVs(this._uvs);\n\n\t\treturn this._uvs;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get secondaryUVs():Array<number>\n\t{\n\t\tif (this._secondaryUVsDirty)\n\t\t\tthis.updateSecondaryUVs(this._secondaryUVs);\n\n\t\treturn this._secondaryUVs;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get jointIndices():Array<number>\n\t{\n\t\tif (this._jointIndicesDirty)\n\t\t\tthis.updateJointIndices(this._jointIndices);\n\n\t\tif (this._useCondensedIndices)\n\t\t\treturn this._condensedJointIndices;\n\n\t\treturn this._jointIndices;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get jointWeights():Array<number>\n\t{\n\t\tif (this._jointWeightsDirty)\n\t\t\tthis.updateJointWeights(this._jointWeights);\n\n\t\treturn this._jointWeights;\n\t}\n\n\t/**\n\t * Indicates whether or not to take the size of faces into account when auto-deriving vertex normals and tangents.\n\t */\n\tpublic get useFaceWeights():boolean\n\t{\n\t\treturn this._useFaceWeights;\n\t}\n\n\tpublic set useFaceWeights(value:boolean)\n\t{\n\t\tif (this._useFaceWeights == value)\n\t\t\treturn;\n\n\t\tthis._useFaceWeights = value;\n\n\t\tif (this._autoDeriveNormals)\n\t\t\tthis.notifyNormalsUpdate();\n\n\t\tif (this._autoDeriveTangents)\n\t\t\tthis.notifyTangentsUpdate();\n\n\t\tthis._faceNormalsDirty = true;\n\t}\n\n\tpublic get numCondensedJoints():number\n\t{\n\t\tif (this._jointIndicesDirty)\n\t\t\tthis.updateJointIndices(this._jointIndices);\n\n\t\treturn this._numCondensedJoints;\n\t}\n\n\tpublic get condensedIndexLookUp():Array<number>\n\t{\n\t\tif (this._jointIndicesDirty)\n\t\t\tthis.updateJointIndices(this._jointIndices);\n\n\t\treturn this._condensedIndexLookUp;\n\t}\n\n\t/**\n\t *\n\t */\n\tconstructor(concatenatedArrays:boolean)\n\t{\n\t\tsuper(concatenatedArrays);\n\n\t\tthis._pSubMeshClass = TriangleSubMesh;\n\t}\n\n\tpublic getBoundingPositions():Array<number>\n\t{\n\t\tif (this._positionsDirty)\n\t\t\tthis.updatePositions(this._positions);\n\n\t\treturn this._positions;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic updatePositions(values:Array<number>)\n\t{\n\t\tvar i:number;\n\t\tvar index:number;\n\t\tvar stride:number;\n\t\tvar positions:Array<number>;\n\n\t\tthis._positions = values;\n\n\t\tif (this._positions == null)\n\t\t\tthis._positions = new Array<number>();\n\n\t\tthis._pNumVertices = this._positions.length/3;\n\n\t\tif (this._concatenateArrays) {\n\t\t\tvar len:number = this._pNumVertices*this.getStride(TriangleSubGeometry.VERTEX_DATA);\n\n\t\t\tif (this._pVertices == null)\n\t\t\t\tthis._pVertices = new Array<number>(len);\n\t\t\telse if (this._pVertices.length != len)\n\t\t\t\tthis._pVertices.length = len;\n\n\t\t\ti = 0;\n\t\t\tindex = this.getOffset(TriangleSubGeometry.POSITION_DATA);\n\t\t\tstride = this.getStride(TriangleSubGeometry.POSITION_DATA);\n\t\t\tpositions = this._pVertices;\n\n\t\t\twhile (i < values.length) {\n\t\t\t\tpositions[index] = values[i++];\n\t\t\t\tpositions[index + 1] = values[i++];\n\t\t\t\tpositions[index + 2] = values[i++];\n\t\t\t\tindex += stride;\n\t\t\t}\n\t\t}\n\n\t\tif (this._autoDeriveNormals)\n\t\t\tthis.notifyNormalsUpdate();\n\n\t\tif (this._autoDeriveTangents)\n\t\t\tthis.notifyTangentsUpdate();\n\n\t\tif (this._autoDeriveUVs)\n\t\t\tthis.notifyUVsUpdate()\n\n\t\tthis.pInvalidateBounds();\n\n\t\tthis.notifyPositionsUpdate();\n\n\t\tthis._positionsDirty = false;\n\t}\n\n\t/**\n\t * Updates the vertex normals based on the geometry.\n\t */\n\tpublic updateVertexNormals(values:Array<number>)\n\t{\n\t\tvar i:number;\n\t\tvar index:number;\n\t\tvar offset:number;\n\t\tvar stride:number;\n\t\tvar normals:Array<number>;\n\n\t\tif (!this._autoDeriveNormals) {\n\t\t\tif ((this._vertexNormals == null || values == null) && (this._vertexNormals != null || values != null)) {\n\t\t\t\tif (this._concatenateArrays)\n\t\t\t\t\tthis._pNotifyVerticesUpdate();\n\t\t\t\telse\n\t\t\t\t\tthis._pStrideOffsetDirty = true;\n\t\t\t}\n\n\t\t\tthis._vertexNormals = values;\n\n\t\t\tif (values != null && this._concatenateArrays) {\n\t\t\t\ti = 0;\n\t\t\t\tindex = this.getOffset(TriangleSubGeometry.NORMAL_DATA);\n\t\t\t\tstride = this.getStride(TriangleSubGeometry.NORMAL_DATA);\n\t\t\t\tnormals = this._pVertices;\n\n\t\t\t\twhile (i < values.length) {\n\t\t\t\t\tnormals[index] = values[i++];\n\t\t\t\t\tnormals[index + 1] = values[i++];\n\t\t\t\t\tnormals[index + 2] = values[i++];\n\t\t\t\t\tindex += stride;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (this._vertexNormals == null) {\n\t\t\t\tthis._vertexNormals = new Array<number>(this._positions.length);\n\n\t\t\t\tif (this._concatenateArrays)\n\t\t\t\t\tthis._pNotifyVerticesUpdate();\n\t\t\t\telse\n\t\t\t\t\tthis._pStrideOffsetDirty = true;\n\t\t\t}\n\n\t\t\tif (this._faceNormalsDirty)\n\t\t\t\tthis.updateFaceNormals();\n\n\t\t\toffset = this.getOffset(TriangleSubGeometry.NORMAL_DATA);\n\t\t\tstride = this.getStride(TriangleSubGeometry.NORMAL_DATA);\n\n\t\t\t//autoderived normals\n\t\t\tnormals = this._concatenateArrays? this._pVertices : this._vertexNormals;\n\n\t\t\tvar f1:number = 0;\n\t\t\tvar f2:number = 1;\n\t\t\tvar f3:number = 2;\n\n\t\t\tindex = offset;\n\n\t\t\t//clear normal values\n\t\t\tvar lenV:number = normals.length;\n\t\t\twhile (index < lenV) {\n\t\t\t\tnormals[index] = 0;\n\t\t\t\tnormals[index + 1] = 0;\n\t\t\t\tnormals[index + 2] = 0;\n\t\t\t\tindex += stride;\n\t\t\t}\n\n\t\t\tvar k:number = 0;\n\t\t\tvar lenI:number = this._pIndices.length;\n\t\t\tvar weight:number;\n\n\t\t\ti = 0;\n\n\t\t\t//collect face normals\n\t\t\twhile (i < lenI) {\n\t\t\t\tweight = this._useFaceWeights? this._faceWeights[k++] : 1;\n\t\t\t\tindex = offset + this._pIndices[i++]*stride;\n\t\t\t\tnormals[index] += this._faceNormals[f1]*weight;\n\t\t\t\tnormals[index + 1] += this._faceNormals[f2]*weight;\n\t\t\t\tnormals[index + 2] += this._faceNormals[f3]*weight;\n\t\t\t\tindex = offset + this._pIndices[i++]*stride;\n\t\t\t\tnormals[index] += this._faceNormals[f1]*weight;\n\t\t\t\tnormals[index + 1] += this._faceNormals[f2]*weight;\n\t\t\t\tnormals[index + 2] += this._faceNormals[f3]*weight;\n\t\t\t\tindex = offset + this._pIndices[i++]*stride;\n\t\t\t\tnormals[index] += this._faceNormals[f1]*weight;\n\t\t\t\tnormals[index + 1] += this._faceNormals[f2]*weight;\n\t\t\t\tnormals[index + 2] += this._faceNormals[f3]*weight;\n\t\t\t\tf1 += 3;\n\t\t\t\tf2 += 3;\n\t\t\t\tf3 += 3;\n\t\t\t}\n\n\t\t\ti = 0;\n\t\t\tindex = offset;\n\n\t\t\t//average normals collections\n\t\t\twhile (index < lenV) {\n\t\t\t\tvar vx:number = normals[index];\n\t\t\t\tvar vy:number = normals[index + 1];\n\t\t\t\tvar vz:number = normals[index + 2];\n\t\t\t\tvar d:number = 1.0/Math.sqrt(vx*vx + vy*vy + vz*vz);\n\n\t\t\t\tif (this._concatenateArrays) {\n\t\t\t\t\tthis._vertexNormals[i++] = normals[index] = vx*d;\n\t\t\t\t\tthis._vertexNormals[i++] = normals[index + 1] = vy*d;\n\t\t\t\t\tthis._vertexNormals[i++] = normals[index + 2] = vz*d;\n\t\t\t\t} else {\n\t\t\t\t\tnormals[index] = vx*d;\n\t\t\t\t\tnormals[index + 1] = vy*d;\n\t\t\t\t\tnormals[index + 2] = vz*d;\n\t\t\t\t}\n\n\t\t\t\tindex += stride;\n\t\t\t}\n\t\t}\n\n\t\tthis.notifyNormalsUpdate();\n\n\t\tthis._vertexNormalsDirty = false;\n\t}\n\n\t/**\n\t * Updates the vertex tangents based on the geometry.\n\t */\n\tpublic updateVertexTangents(values:Array<number>)\n\t{\n\t\tvar i:number;\n\t\tvar index:number;\n\t\tvar offset:number;\n\t\tvar stride:number;\n\t\tvar tangents:Array<number>;\n\n\t\tif (!this._autoDeriveTangents) {\n\t\t\tif ((this._vertexTangents == null || values == null) && (this._vertexTangents != null || values != null)) {\n\t\t\t\tif (this._concatenateArrays)\n\t\t\t\t\tthis._pNotifyVerticesUpdate();\n\t\t\t\telse\n\t\t\t\t\tthis._pStrideOffsetDirty = true;\n\t\t\t}\n\n\n\t\t\tthis._vertexTangents = values;\n\n\t\t\tif (values != null && this._concatenateArrays) {\n\t\t\t\ti = 0;\n\t\t\t\tindex = this.getOffset(TriangleSubGeometry.TANGENT_DATA);\n\t\t\t\tstride = this.getStride(TriangleSubGeometry.TANGENT_DATA);\n\t\t\t\ttangents = this._pVertices;\n\n\t\t\t\twhile (i < values.length) {\n\t\t\t\t\ttangents[index] = values[i++];\n\t\t\t\t\ttangents[index + 1] = values[i++];\n\t\t\t\t\ttangents[index + 2] = values[i++];\n\t\t\t\t\tindex += stride;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (this._vertexTangents == null) {\n\t\t\t\tthis._vertexTangents = new Array<number>(this._positions.length);\n\n\t\t\t\tif (this._concatenateArrays)\n\t\t\t\t\tthis._pNotifyVerticesUpdate();\n\t\t\t\telse\n\t\t\t\t\tthis._pStrideOffsetDirty = true;\n\t\t\t}\n\n\t\t\tif (this._faceTangentsDirty)\n\t\t\t\tthis.updateFaceTangents();\n\n\t\t\toffset = this.getOffset(TriangleSubGeometry.TANGENT_DATA);\n\t\t\tstride = this.getStride(TriangleSubGeometry.TANGENT_DATA);\n\n\t\t\t//autoderived tangents\n\t\t\ttangents = this._concatenateArrays? this._pVertices : this._vertexTangents;\n\n\t\t\tindex = offset;\n\n\t\t\t//clear tangent values\n\t\t\tvar lenV:number = tangents.length;\n\t\t\twhile (index < lenV) {\n\t\t\t\ttangents[index] = 0;\n\t\t\t\ttangents[index + 1] = 0;\n\t\t\t\ttangents[index + 2] = 0;\n\n\t\t\t\tindex += stride;\n\t\t\t}\n\n\t\t\tvar k:number = 0;\n\t\t\tvar weight:number;\n\t\t\tvar f1:number = 0;\n\t\t\tvar f2:number = 1;\n\t\t\tvar f3:number = 2;\n\n\t\t\ti = 0;\n\n\t\t\t//collect face tangents\n\t\t\tvar lenI:number = this._pIndices.length;\n\t\t\twhile (i < lenI) {\n\t\t\t\tweight = this._useFaceWeights? this._faceWeights[k++] : 1;\n\t\t\t\tindex = offset + this._pIndices[i++]*stride;\n\t\t\t\ttangents[index++] += this._faceTangents[f1]*weight;\n\t\t\t\ttangents[index++] += this._faceTangents[f2]*weight;\n\t\t\t\ttangents[index] += this._faceTangents[f3]*weight;\n\t\t\t\tindex = offset + this._pIndices[i++]*stride;\n\t\t\t\ttangents[index++] += this._faceTangents[f1]*weight;\n\t\t\t\ttangents[index++] += this._faceTangents[f2]*weight;\n\t\t\t\ttangents[index] += this._faceTangents[f3]*weight;\n\t\t\t\tindex = offset + this._pIndices[i++]*stride;\n\t\t\t\ttangents[index++] += this._faceTangents[f1]*weight;\n\t\t\t\ttangents[index++] += this._faceTangents[f2]*weight;\n\t\t\t\ttangents[index] += this._faceTangents[f3]*weight;\n\t\t\t\tf1 += 3;\n\t\t\t\tf2 += 3;\n\t\t\t\tf3 += 3;\n\t\t\t}\n\n\t\t\ti = 0;\n\t\t\tindex = offset;\n\n\t\t\t//average tangents collections\n\t\t\twhile (index < lenV) {\n\t\t\t\tvar vx:number = tangents[index];\n\t\t\t\tvar vy:number = tangents[index + 1];\n\t\t\t\tvar vz:number = tangents[index + 2];\n\t\t\t\tvar d:number = 1.0/Math.sqrt(vx*vx + vy*vy + vz*vz);\n\n\t\t\t\tif (this._concatenateArrays) {\n\t\t\t\t\tthis._vertexTangents[i++] = tangents[index] = vx*d;\n\t\t\t\t\tthis._vertexTangents[i++] = tangents[index + 1] = vy*d;\n\t\t\t\t\tthis._vertexTangents[i++] = tangents[index + 2] = vz*d;\n\t\t\t\t} else {\n\t\t\t\t\ttangents[index] = vx*d;\n\t\t\t\t\ttangents[index + 1] = vy*d;\n\t\t\t\t\ttangents[index + 2] = vz*d;\n\t\t\t\t}\n\n\t\t\t\tindex += stride;\n\t\t\t}\n\t\t}\n\n\t\tthis.notifyTangentsUpdate();\n\n\t\tthis._vertexTangentsDirty = false;\n\t}\n\n\t/**\n\t * Updates the uvs based on the geometry.\n\t */\n\tpublic updateUVs(values:Array<number>)\n\t{\n\t\tvar i:number;\n\t\tvar index:number;\n\t\tvar offset:number;\n\t\tvar stride:number;\n\t\tvar uvs:Array<number>;\n\n\t\tif (!this._autoDeriveUVs) {\n\t\t\tif ((this._uvs == null || values == null) && (this._uvs != null || values != null)) {\n\t\t\t\tif (this._concatenateArrays)\n\t\t\t\t\tthis._pNotifyVerticesUpdate();\n\t\t\t\telse\n\t\t\t\t\tthis._pStrideOffsetDirty = true;\n\t\t\t}\n\n\t\t\tthis._uvs = values;\n\n\t\t\tif (values != null && this._concatenateArrays) {\n\t\t\t\ti = 0;\n\t\t\t\tindex = this.getOffset(TriangleSubGeometry.UV_DATA);\n\t\t\t\tstride = this.getStride(TriangleSubGeometry.UV_DATA);\n\t\t\t\tuvs = this._pVertices;\n\n\t\t\t\twhile (i < values.length) {\n\t\t\t\t\tuvs[index] = values[i++];\n\t\t\t\t\tuvs[index + 1] = values[i++];\n\t\t\t\t\tindex += stride;\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (this._uvs == null) {\n\t\t\t\tthis._uvs = new Array<number>(this._positions.length*2/3);\n\n\t\t\t\tif (this._concatenateArrays)\n\t\t\t\t\tthis._pNotifyVerticesUpdate();\n\t\t\t\telse\n\t\t\t\t\tthis._pStrideOffsetDirty = true;\n\t\t\t}\n\n\t\t\toffset = this.getOffset(TriangleSubGeometry.UV_DATA);\n\t\t\tstride = this.getStride(TriangleSubGeometry.UV_DATA);\n\n\t\t\t//autoderived uvs\n\t\t\tuvs = this._concatenateArrays? this._pVertices : this._uvs;\n\n\t\t\ti = 0;\n\t\t\tindex = offset;\n\t\t\tvar uvIdx:number = 0;\n\n\t\t\t//clear uv values\n\t\t\tvar lenV:number = uvs.length;\n\t\t\twhile (index < lenV) {\n\t\t\t\tif (this._concatenateArrays) {\n\t\t\t\t\tthis._uvs[i++] = uvs[index] = uvIdx*.5;\n\t\t\t\t\tthis._uvs[i++] = uvs[index + 1] = 1.0 - (uvIdx & 1);\n\t\t\t\t} else {\n\t\t\t\t\tuvs[index] = uvIdx*.5;\n\t\t\t\t\tuvs[index + 1] = 1.0 - (uvIdx & 1);\n\t\t\t\t}\n\n\t\t\t\tif (++uvIdx == 3)\n\t\t\t\t\tuvIdx = 0;\n\n\t\t\t\tindex += stride;\n\t\t\t}\n\t\t}\n\n\t\tif (this._autoDeriveTangents)\n\t\t\tthis.notifyTangentsUpdate();\n\n\t\tthis.notifyUVsUpdate();\n\n\t\tthis._uvsDirty = false;\n\t}\n\n\t/**\n\t * Updates the secondary uvs based on the geometry.\n\t */\n\tpublic updateSecondaryUVs(values:Array<number>)\n\t{\n\t\tvar i:number;\n\t\tvar index:number;\n\t\tvar offset:number;\n\t\tvar stride:number;\n\t\tvar uvs:Array<number>;\n\n\t\tif (this._concatenateArrays && (this._secondaryUVs == null || values == null) && (this._secondaryUVs != null || values != null))\n\t\t\tthis._pNotifyVerticesUpdate();\n\n\t\tthis._secondaryUVs = values;\n\n\t\tif (values != null && this._concatenateArrays) {\n\t\t\toffset = this.getOffset(TriangleSubGeometry.SECONDARY_UV_DATA);\n\t\t\tstride = this.getStride(TriangleSubGeometry.SECONDARY_UV_DATA);\n\n\t\t\ti = 0;\n\t\t\tindex = offset;\n\t\t\tuvs = this._pVertices;\n\n\t\t\twhile (i < values.length) {\n\t\t\t\tuvs[index] = values[i++];\n\t\t\t\tuvs[index + 1] = values[i++];\n\t\t\t\tindex += stride;\n\t\t\t}\n\t\t}\n\n\t\tthis.notifySecondaryUVsUpdate();\n\n\t\tthis._secondaryUVsDirty = false;\n\t}\n\n\t/**\n\t * Updates the joint indices\n\t */\n\tpublic updateJointIndices(values:Array<number>)\n\t{\n\t\tvar i:number;\n\t\tvar j:number;\n\t\tvar index:number;\n\t\tvar offset:number;\n\t\tvar stride:number;\n\t\tvar jointIndices:Array<number>;\n\n\t\tif (this._concatenateArrays && (this._jointIndices == null || values == null) && (this._jointIndices != null || values != null))\n\t\t\tthis._pNotifyVerticesUpdate();\n\n\t\tthis._jointIndices = values;\n\n\t\tif (values != null) {\n\t\t\toffset = this.getOffset(TriangleSubGeometry.JOINT_INDEX_DATA);\n\t\t\tstride = this.getStride(TriangleSubGeometry.JOINT_INDEX_DATA);\n\t\t\tif (this._useCondensedIndices) {\n\t\t\t\ti = 0;\n\t\t\t\tj = 0;\n\t\t\t\tindex = offset;\n\t\t\t\tjointIndices = this._concatenateArrays? this._pVertices : this._condensedJointIndices;\n\t\t\t\tvar oldIndex:number;\n\t\t\t\tvar newIndex:number = 0;\n\t\t\t\tvar dic:Object = new Object();\n\n\t\t\t\tif (!this._concatenateArrays)\n\t\t\t\t\tthis._condensedJointIndices = new Array<number>(values.length);\n\n\t\t\t\tthis._condensedIndexLookUp = new Array<number>();\n\n\t\t\t\twhile (i < values.length) {\n\t\t\t\t\tfor (j = 0; j < this._jointsPerVertex; j++) {\n\t\t\t\t\t\toldIndex = values[i++];\n\n\t\t\t\t\t\t// if we encounter a new index, assign it a new condensed index\n\t\t\t\t\t\tif (dic[oldIndex] == undefined) {\n\t\t\t\t\t\t\tdic[oldIndex] = newIndex*3; //3 required for the three vectors that store the matrix\n\t\t\t\t\t\t\tthis._condensedIndexLookUp[newIndex++] = oldIndex;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tjointIndices[index + j] = dic[oldIndex];\n\t\t\t\t\t}\n\t\t\t\t\tindex += stride;\n\t\t\t\t}\n\t\t\t\tthis._numCondensedJoints = newIndex;\n\t\t\t} else if (this._concatenateArrays) {\n\n\t\t\t\ti = 0;\n\t\t\t\tindex = offset;\n\t\t\t\tjointIndices = this._pVertices;\n\n\t\t\t\twhile (i < values.length) {\n\t\t\t\t\tj = 0;\n\t\t\t\t\twhile (j < this._jointsPerVertex)\n\t\t\t\t\t\tjointIndices[index + j++] = values[i++];\n\t\t\t\t\tindex += stride;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.notifyJointIndicesUpdate();\n\n\t\tthis._jointIndicesDirty = false;\n\t}\n\n\t/**\n\t * Updates the joint weights.\n\t */\n\tpublic updateJointWeights(values:Array<number>)\n\t{\n\t\tvar i:number;\n\t\tvar j:number;\n\t\tvar index:number;\n\t\tvar offset:number;\n\t\tvar stride:number;\n\t\tvar jointWeights:Array<number>;\n\n\t\tif (this._concatenateArrays && (this._jointWeights == null || values == null) && (this._jointWeights != null || values != null))\n\t\t\tthis._pNotifyVerticesUpdate();\n\n\t\tthis._jointWeights = values;\n\n\t\tif (values != null && this._concatenateArrays) {\n\t\t\toffset = this.getOffset(TriangleSubGeometry.JOINT_WEIGHT_DATA);\n\t\t\tstride = this.getStride(TriangleSubGeometry.JOINT_WEIGHT_DATA);\n\n\t\t\ti = 0;\n\t\t\tindex = offset;\n\t\t\tjointWeights = this._pVertices;\n\n\t\t\twhile (i < values.length) {\n\t\t\t\tj = 0;\n\t\t\t\twhile (j < this._jointsPerVertex)\n\t\t\t\t\tjointWeights[index + j++] = values[i++];\n\t\t\t\tindex += stride;\n\t\t\t}\n\t\t}\n\n\t\tthis.notifyJointWeightsUpdate();\n\n\t\tthis._jointWeightsDirty = false;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic dispose()\n\t{\n\t\tsuper.dispose();\n\n\t\tthis._positions = null;\n\t\tthis._vertexNormals = null;\n\t\tthis._vertexTangents = null;\n\t\tthis._uvs = null;\n\t\tthis._secondaryUVs = null;\n\t\tthis._jointIndices = null;\n\t\tthis._jointWeights = null;\n\n\t\tthis._faceNormals = null;\n\t\tthis._faceWeights = null;\n\t\tthis._faceTangents = null;\n\t}\n\n\t/**\n\t * Updates the face indices of the TriangleSubGeometry.\n\t *\n\t * @param indices The face indices to upload.\n\t */\n\tpublic updateIndices(indices:Array<number>)\n\t{\n\t\tsuper.updateIndices(indices);\n\n\t\tthis._faceNormalsDirty = true;\n\n\t\tif (this._autoDeriveNormals)\n\t\t\tthis._vertexNormalsDirty = true;\n\n\t\tif (this._autoDeriveTangents)\n\t\t\tthis._vertexTangentsDirty = true;\n\n\t\tif (this._autoDeriveUVs)\n\t\t\tthis._uvsDirty = true;\n\t}\n\n\t/**\n\t * Clones the current object\n\t * @return An exact duplicate of the current object.\n\t */\n\tpublic clone():TriangleSubGeometry\n\t{\n\t\tvar clone:TriangleSubGeometry = new TriangleSubGeometry(this._concatenateArrays);\n\t\tclone.updateIndices(this._pIndices.concat());\n\t\tclone.updatePositions(this._positions.concat());\n\n\t\tif (this._vertexNormals && !this._autoDeriveNormals)\n\t\t\tclone.updateVertexNormals(this._vertexNormals.concat());\n\t\telse\n\t\t\tclone.updateVertexNormals(null);\n\n\t\tif (this._uvs && !this._autoDeriveUVs)\n\t\t\tclone.updateUVs(this._uvs.concat());\n\t\telse\n\t\t\tclone.updateUVs(null);\n\n\t\tif (this._vertexTangents && !this._autoDeriveTangents)\n\t\t\tclone.updateVertexTangents(this._vertexTangents.concat());\n\t\telse\n\t\t\tclone.updateVertexTangents(null);\n\n\t\tif (this._secondaryUVs)\n\t\t\tclone.updateSecondaryUVs(this._secondaryUVs.concat());\n\n\t\tif (this._jointIndices) {\n\t\t\tclone.jointsPerVertex = this._jointsPerVertex;\n\t\t\tclone.updateJointIndices(this._jointIndices.concat());\n\t\t}\n\n\t\tif (this._jointWeights)\n\t\t\tclone.updateJointWeights(this._jointWeights.concat());\n\n\t\treturn clone;\n\t}\n\n\tpublic scaleUV(scaleU:number = 1, scaleV:number = 1)\n\t{\n\t\tvar index:number;\n\t\tvar offset:number;\n\t\tvar stride:number;\n\t\tvar uvs:Array<number>;\n\n\t\tuvs = this._uvs;\n\n\t\tvar ratioU:number = scaleU/this._scaleU;\n\t\tvar ratioV:number = scaleV/this._scaleV;\n\n\t\tthis._scaleU = scaleU;\n\t\tthis._scaleV = scaleV;\n\n\t\tvar len:number = uvs.length;\n\n\t\toffset = 0;\n\t\tstride = 2;\n\n\t\tindex = offset;\n\n\t\twhile (index < len) {\n\t\t\tuvs[index] *= ratioU;\n\t\t\tuvs[index + 1] *= ratioV;\n\t\t\tindex += stride;\n\t\t}\n\n\t\tthis.notifyUVsUpdate();\n\t}\n\n\t/**\n\t * Scales the geometry.\n\t * @param scale The amount by which to scale.\n\t */\n\tpublic scale(scale:number)\n\t{\n\t\tvar i:number;\n\t\tvar index:number;\n\t\tvar offset:number;\n\t\tvar stride:number;\n\t\tvar positions:Array<number>;\n\n\t\tpositions = this._positions;\n\n\t\tvar len:number = positions.length;\n\n\t\toffset = 0;\n\t\tstride = 3;\n\n\t\ti = 0;\n\t\tindex = offset;\n\t\twhile (i < len) {\n\t\t\tpositions[index] *= scale;\n\t\t\tpositions[index + 1] *= scale;\n\t\t\tpositions[index + 2] *= scale;\n\n\t\t\ti += 3;\n\t\t\tindex += stride;\n\t\t}\n\n\t\tthis.notifyPositionsUpdate();\n\t}\n\n\tpublic applyTransformation(transform:Matrix3D)\n\t{\n\t\tvar positions:Array<number>;\n\t\tvar normals:Array<number>;\n\t\tvar tangents:Array<number>;\n\n\t\tif (this._concatenateArrays) {\n\t\t\tpositions = this._pVertices;\n\t\t\tnormals = this._pVertices;\n\t\t\ttangents = this._pVertices;\n\t\t} else {\n\t\t\tpositions = this._positions;\n\t\t\tnormals = this._vertexNormals;\n\t\t\ttangents = this._vertexTangents;\n\t\t}\n\n\t\tvar len:number = this._positions.length/3;\n\t\tvar i:number;\n\t\tvar i1:number;\n\t\tvar i2:number;\n\t\tvar vector:Vector3D = new Vector3D();\n\n\t\tvar bakeNormals:boolean = this._vertexNormals != null;\n\t\tvar bakeTangents:boolean = this._vertexTangents != null;\n\t\tvar invTranspose:Matrix3D;\n\n\t\tif (bakeNormals || bakeTangents) {\n\t\t\tinvTranspose = transform.clone();\n\t\t\tinvTranspose.invert();\n\t\t\tinvTranspose.transpose();\n\t\t}\n\n\t\tvar vi0:number = this.getOffset(TriangleSubGeometry.POSITION_DATA);\n\t\tvar ni0:number = this.getOffset(TriangleSubGeometry.NORMAL_DATA);\n\t\tvar ti0:number = this.getOffset(TriangleSubGeometry.TANGENT_DATA);\n\n\t\tvar vStride:number = this.getStride(TriangleSubGeometry.POSITION_DATA);\n\t\tvar nStride:number = this.getStride(TriangleSubGeometry.NORMAL_DATA);\n\t\tvar tStride:number = this.getStride(TriangleSubGeometry.TANGENT_DATA);\n\n\t\tfor (i = 0; i < len; ++i) {\n\t\t\ti1 = vi0 + 1;\n\t\t\ti2 = vi0 + 2;\n\n\t\t\t// bake position\n\t\t\tvector.x = positions[vi0];\n\t\t\tvector.y = positions[i1];\n\t\t\tvector.z = positions[i2];\n\t\t\tvector = transform.transformVector(vector);\n\t\t\tpositions[vi0] = vector.x;\n\t\t\tpositions[i1] = vector.y;\n\t\t\tpositions[i2] = vector.z;\n\t\t\tvi0 += vStride;\n\n\t\t\t// bake normal\n\t\t\tif (bakeNormals) {\n\t\t\t\ti1 = ni0 + 1;\n\t\t\t\ti2 = ni0 + 2;\n\t\t\t\tvector.x = normals[ni0];\n\t\t\t\tvector.y = normals[i1];\n\t\t\t\tvector.z = normals[i2];\n\t\t\t\tvector = invTranspose.deltaTransformVector(vector);\n\t\t\t\tvector.normalize();\n\t\t\t\tnormals[ni0] = vector.x;\n\t\t\t\tnormals[i1] = vector.y;\n\t\t\t\tnormals[i2] = vector.z;\n\t\t\t\tni0 += nStride;\n\t\t\t}\n\n\t\t\t// bake tangent\n\t\t\tif (bakeTangents) {\n\t\t\t\ti1 = ti0 + 1;\n\t\t\t\ti2 = ti0 + 2;\n\t\t\t\tvector.x = tangents[ti0];\n\t\t\t\tvector.y = tangents[i1];\n\t\t\t\tvector.z = tangents[i2];\n\t\t\t\tvector = invTranspose.deltaTransformVector(vector);\n\t\t\t\tvector.normalize();\n\t\t\t\ttangents[ti0] = vector.x;\n\t\t\t\ttangents[i1] = vector.y;\n\t\t\t\ttangents[i2] = vector.z;\n\t\t\t\tti0 += tStride;\n\t\t\t}\n\t\t}\n\n\t\tthis.notifyPositionsUpdate();\n\t\tthis.notifyNormalsUpdate();\n\t\tthis.notifyTangentsUpdate();\n\t}\n\n\t/**\n\t * Updates the tangents for each face.\n\t */\n\tprivate updateFaceTangents()\n\t{\n\t\tvar i:number = 0;\n\t\tvar index1:number;\n\t\tvar index2:number;\n\t\tvar index3:number;\n\t\tvar vi:number;\n\t\tvar v0:number;\n\t\tvar dv1:number;\n\t\tvar dv2:number;\n\t\tvar denom:number;\n\t\tvar x0:number, y0:number, z0:number;\n\t\tvar dx1:number, dy1:number, dz1:number;\n\t\tvar dx2:number, dy2:number, dz2:number;\n\t\tvar cx:number, cy:number, cz:number;\n\n\t\tvar positions:Array<number> = this._positions\n\t\tvar uvs:Array<number> = this._uvs;\n\n\t\tvar len:number = this._pIndices.length;\n\n\t\tif (this._faceTangents == null)\n\t\t\tthis._faceTangents = new Array<number>(len);\n\n\t\twhile (i < len) {\n\t\t\tindex1 = this._pIndices[i];\n\t\t\tindex2 = this._pIndices[i + 1];\n\t\t\tindex3 = this._pIndices[i + 2];\n\n\t\t\tv0 = uvs[index1*2 + 1];\n\t\t\tdv1 = uvs[index2*2 + 1] - v0;\n\t\t\tdv2 = uvs[index3*2 + 1] - v0;\n\n\t\t\tvi = index1*3;\n\t\t\tx0 = positions[vi];\n\t\t\ty0 = positions[vi + 1];\n\t\t\tz0 = positions[vi + 2];\n\t\t\tvi = index2*3;\n\t\t\tdx1 = positions[vi] - x0;\n\t\t\tdy1 = positions[vi + 1] - y0;\n\t\t\tdz1 = positions[vi + 2] - z0;\n\t\t\tvi = index3*3;\n\t\t\tdx2 = positions[vi] - x0;\n\t\t\tdy2 = positions[vi + 1] - y0;\n\t\t\tdz2 = positions[vi + 2] - z0;\n\n\t\t\tcx = dv2*dx1 - dv1*dx2;\n\t\t\tcy = dv2*dy1 - dv1*dy2;\n\t\t\tcz = dv2*dz1 - dv1*dz2;\n\t\t\tdenom = 1/Math.sqrt(cx*cx + cy*cy + cz*cz);\n\n\t\t\tthis._faceTangents[i++] = denom*cx;\n\t\t\tthis._faceTangents[i++] = denom*cy;\n\t\t\tthis._faceTangents[i++] = denom*cz;\n\t\t}\n\n\t\tthis._faceTangentsDirty = false;\n\t}\n\n\t/**\n\t * Updates the normals for each face.\n\t */\n\tprivate updateFaceNormals()\n\t{\n\t\tvar i:number = 0;\n\t\tvar j:number = 0;\n\t\tvar k:number = 0;\n\t\tvar index:number;\n\t\tvar offset:number;\n\t\tvar stride:number;\n\n\t\tvar x1:number, x2:number, x3:number;\n\t\tvar y1:number, y2:number, y3:number;\n\t\tvar z1:number, z2:number, z3:number;\n\t\tvar dx1:number, dy1:number, dz1:number;\n\t\tvar dx2:number, dy2:number, dz2:number;\n\t\tvar cx:number, cy:number, cz:number;\n\t\tvar d:number;\n\n\t\tvar positions:Array<number> = this._positions;\n\n\t\tvar len:number = this._pIndices.length;\n\n\t\tif (this._faceNormals == null)\n\t\t\tthis._faceNormals = new Array<number>(len);\n\n\t\tif (this._useFaceWeights && this._faceWeights == null)\n\t\t\tthis._faceWeights = new Array<number>(len/3);\n\n\t\twhile (i < len) {\n\t\t\tindex = this._pIndices[i++]*3;\n\t\t\tx1 = positions[index];\n\t\t\ty1 = positions[index + 1];\n\t\t\tz1 = positions[index + 2];\n\t\t\tindex = this._pIndices[i++]*3;\n\t\t\tx2 = positions[index];\n\t\t\ty2 = positions[index + 1];\n\t\t\tz2 = positions[index + 2];\n\t\t\tindex = this._pIndices[i++]*3;\n\t\t\tx3 = positions[index];\n\t\t\ty3 = positions[index + 1];\n\t\t\tz3 = positions[index + 2];\n\t\t\tdx1 = x3 - x1;\n\t\t\tdy1 = y3 - y1;\n\t\t\tdz1 = z3 - z1;\n\t\t\tdx2 = x2 - x1;\n\t\t\tdy2 = y2 - y1;\n\t\t\tdz2 = z2 - z1;\n\t\t\tcx = dz1*dy2 - dy1*dz2;\n\t\t\tcy = dx1*dz2 - dz1*dx2;\n\t\t\tcz = dy1*dx2 - dx1*dy2;\n\t\t\td = Math.sqrt(cx*cx + cy*cy + cz*cz);\n\t\t\t// length of cross product = 2*triangle area\n\n\t\t\tif (this._useFaceWeights) {\n\t\t\t\tvar w:number = d*10000;\n\n\t\t\t\tif (w < 1)\n\t\t\t\t\tw = 1;\n\n\t\t\t\tthis._faceWeights[k++] = w;\n\t\t\t}\n\n\t\t\td = 1/d;\n\n\t\t\tthis._faceNormals[j++] = cx*d;\n\t\t\tthis._faceNormals[j++] = cy*d;\n\t\t\tthis._faceNormals[j++] = cz*d;\n\t\t}\n\n\t\tthis._faceNormalsDirty = false;\n\t}\n\n\tpublic _pNotifyVerticesUpdate()\n\t{\n\t\tthis._pStrideOffsetDirty = true;\n\n\t\tthis.notifyPositionsUpdate();\n\t\tthis.notifyNormalsUpdate();\n\t\tthis.notifyTangentsUpdate();\n\t\tthis.notifyUVsUpdate();\n\t\tthis.notifySecondaryUVsUpdate();\n\t\tthis.notifyJointIndicesUpdate();\n\t\tthis.notifyJointWeightsUpdate();\n\t}\n\n\tprivate notifyPositionsUpdate()\n\t{\n\t\tif (this._positionsDirty)\n\t\t\treturn;\n\n\t\tthis._positionsDirty = true;\n\n\t\tif (!this._positionsUpdated)\n\t\t\tthis._positionsUpdated = new SubGeometryEvent(SubGeometryEvent.VERTICES_UPDATED, TriangleSubGeometry.POSITION_DATA);\n\n\t\tthis.dispatchEvent(this._positionsUpdated);\n\t}\n\n\tprivate notifyNormalsUpdate()\n\t{\n\t\tif (this._vertexNormalsDirty)\n\t\t\treturn;\n\n\t\tthis._vertexNormalsDirty = true;\n\n\t\tif (!this._normalsUpdated)\n\t\t\tthis._normalsUpdated = new SubGeometryEvent(SubGeometryEvent.VERTICES_UPDATED, TriangleSubGeometry.NORMAL_DATA);\n\n\t\tthis.dispatchEvent(this._normalsUpdated);\n\t}\n\n\tprivate notifyTangentsUpdate()\n\t{\n\t\tif (this._vertexTangentsDirty)\n\t\t\treturn;\n\n\t\tthis._vertexTangentsDirty = true;\n\n\t\tif (!this._tangentsUpdated)\n\t\t\tthis._tangentsUpdated = new SubGeometryEvent(SubGeometryEvent.VERTICES_UPDATED, TriangleSubGeometry.TANGENT_DATA);\n\n\t\tthis.dispatchEvent(this._tangentsUpdated);\n\t}\n\n\tprivate notifyUVsUpdate()\n\t{\n\t\tif (this._uvsDirty)\n\t\t\treturn;\n\n\t\tthis._uvsDirty = true;\n\n\t\tif (!this._uvsUpdated)\n\t\t\tthis._uvsUpdated = new SubGeometryEvent(SubGeometryEvent.VERTICES_UPDATED, TriangleSubGeometry.UV_DATA);\n\n\t\tthis.dispatchEvent(this._uvsUpdated);\n\t}\n\n\tprivate notifySecondaryUVsUpdate()\n\t{\n\t\tif (this._secondaryUVsDirty)\n\t\t\treturn;\n\n\t\tthis._secondaryUVsDirty = true;\n\n\t\tif (!this._secondaryUVsUpdated)\n\t\t\tthis._secondaryUVsUpdated = new SubGeometryEvent(SubGeometryEvent.VERTICES_UPDATED, TriangleSubGeometry.SECONDARY_UV_DATA);\n\n\t\tthis.dispatchEvent(this._secondaryUVsUpdated);\n\t}\n\n\tprivate notifyJointIndicesUpdate()\n\t{\n\t\tif (this._jointIndicesDirty)\n\t\t\treturn;\n\n\t\tthis._jointIndicesDirty = true;\n\n\t\tif (!this._jointIndicesUpdated)\n\t\t\tthis._jointIndicesUpdated = new SubGeometryEvent(SubGeometryEvent.VERTICES_UPDATED, TriangleSubGeometry.JOINT_INDEX_DATA);\n\n\t\tthis.dispatchEvent(this._jointIndicesUpdated);\n\t}\n\n\tprivate notifyJointWeightsUpdate()\n\t{\n\t\tif (this._jointWeightsDirty)\n\t\t\treturn;\n\n\t\tthis._jointWeightsDirty = true;\n\n\t\tif (!this._jointWeightsUpdated)\n\t\t\tthis._jointWeightsUpdated = new SubGeometryEvent(SubGeometryEvent.VERTICES_UPDATED, TriangleSubGeometry.JOINT_WEIGHT_DATA);\n\n\t\tthis.dispatchEvent(this._jointWeightsUpdated);\n\t}\n}\n\nexport = TriangleSubGeometry;","import AssetType\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport ISubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/ISubMesh\");\nimport SubMeshBase\t\t\t\t= require(\"awayjs-display/lib/base/SubMeshBase\");\nimport TriangleSubGeometry\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\n\nimport IRendererPool\t\t\t= require(\"awayjs-display/lib/pool/IRendererPool\");\nimport Mesh\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\nimport MaterialBase\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\n\n/**\n * TriangleSubMesh wraps a TriangleSubGeometry as a scene graph instantiation. A TriangleSubMesh is owned by a Mesh object.\n *\n *\n * @see away.base.TriangleSubGeometry\n * @see away.entities.Mesh\n *\n * @class away.base.TriangleSubMesh\n */\nclass TriangleSubMesh extends SubMeshBase implements ISubMesh\n{\n\tprivate _subGeometry:TriangleSubGeometry;\n\n\t/**\n\t *\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.TRIANGLE_SUB_MESH;\n\t}\n\n\t/**\n\t * The TriangleSubGeometry object which provides the geometry data for this TriangleSubMesh.\n\t */\n\tpublic get subGeometry():TriangleSubGeometry\n\t{\n\t\treturn this._subGeometry;\n\t}\n\n\t/**\n\t * Creates a new TriangleSubMesh object\n\t * @param subGeometry The TriangleSubGeometry object which provides the geometry data for this TriangleSubMesh.\n\t * @param parentMesh The Mesh object to which this TriangleSubMesh belongs.\n\t * @param material An optional material used to render this TriangleSubMesh.\n\t */\n\tconstructor(subGeometry:TriangleSubGeometry, parentMesh:Mesh, material:MaterialBase = null)\n\t{\n\t\tsuper();\n\n\t\tthis._pParentMesh = parentMesh;\n\t\tthis._subGeometry = subGeometry;\n\t\tthis.material = material;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic dispose()\n\t{\n\t\tsuper.dispose();\n\t}\n\n\tpublic _iCollectRenderable(rendererPool:IRendererPool)\n\t{\n\t\trendererPool.applyTriangleSubMesh(this);\n\t}\n}\n\nexport = TriangleSubMesh;","import Box\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Box\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\nimport PlaneClassification\t\t\t= require(\"awayjs-core/lib/geom/PlaneClassification\");\nimport Plane3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Plane3D\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport BoundingVolumeBase\t\t\t= require(\"awayjs-display/lib/bounds/BoundingVolumeBase\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport Mesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\nimport PrimitiveCubePrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCubePrefab\");\n\n\n/**\n * AxisAlignedBoundingBox represents a bounding box volume that has its planes aligned to the local coordinate axes of the bounded object.\n * This is useful for most meshes.\n */\nclass AxisAlignedBoundingBox extends BoundingVolumeBase\n{\n\tprivate _box:Box;\n\tprivate _x:number = 0;\n\tprivate _y:number = 0;\n\tprivate _z:number = 0;\n\tprivate _width:number = 0;\n\tprivate _height:number = 0;\n\tprivate _depth:number = 0;\n\tprivate _centerX:number = 0;\n\tprivate _centerY:number = 0;\n\tprivate _centerZ:number = 0;\n\tprivate _halfExtentsX:number = 0;\n\tprivate _halfExtentsY:number = 0;\n\tprivate _halfExtentsZ:number = 0;\n\tprivate _prefab:PrimitiveCubePrefab;\n\n\t/**\n\t * Creates a new <code>AxisAlignedBoundingBox</code> object.\n\t */\n\tconstructor(entity:IEntity)\n\t{\n\t\tsuper(entity);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic nullify()\n\t{\n\t\tthis._x = this._y = this._z = 0;\n\t\tthis._width = this._height = this._depth = 0;\n\t\tthis._centerX = this._centerY = this._centerZ = 0;\n\t\tthis._halfExtentsX = this._halfExtentsY = this._halfExtentsZ = 0;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic isInFrustum(planes:Array<Plane3D>, numPlanes:number):boolean\n\t{\n\t\tif(this._pInvalidated)\n\t\t\tthis._pUpdate();\n\n\t\tfor (var i:number = 0; i < numPlanes; ++i) {\n\n\t\t\tvar plane:Plane3D = planes[i];\n\t\t\tvar a:number = plane.a;\n\t\t\tvar b:number = plane.b;\n\t\t\tvar c:number = plane.c;\n\t\t\tvar flippedExtentX:number = a < 0? -this._halfExtentsX : this._halfExtentsX;\n\t\t\tvar flippedExtentY:number = b < 0? -this._halfExtentsY : this._halfExtentsY;\n\t\t\tvar flippedExtentZ:number = c < 0? -this._halfExtentsZ : this._halfExtentsZ;\n\t\t\tvar projDist:number = a*(this._centerX + flippedExtentX) + b*(this._centerY + flippedExtentY) + c*(this._centerZ + flippedExtentZ) - plane.d;\n\n\t\t\tif (projDist < 0)\n\t\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tpublic rayIntersection(position:Vector3D, direction:Vector3D, targetNormal:Vector3D):number\n\t{\n\t\tif(this._pInvalidated)\n\t\t\tthis._pUpdate();\n\n\t\treturn this._box.rayIntersection(position, direction, targetNormal);\n\t}\n\n\n\n\tpublic classifyToPlane(plane:Plane3D):number\n\t{\n\t\tvar a:number = plane.a;\n\t\tvar b:number = plane.b;\n\t\tvar c:number = plane.c;\n\t\tvar centerDistance:number = a*this._centerX + b*this._centerY + c*this._centerZ - plane.d;\n\n\t\tif (a < 0)\n\t\t\ta = -a;\n\n\t\tif (b < 0)\n\t\t\tb = -b;\n\n\t\tif (c < 0)\n\t\t\tc = -c;\n\n\t\tvar boundOffset:number = a*this._halfExtentsX + b*this._halfExtentsY + c*this._halfExtentsZ;\n\n\t\treturn centerDistance > boundOffset? PlaneClassification.FRONT : centerDistance < -boundOffset? PlaneClassification.BACK : PlaneClassification.INTERSECT;\n\t}\n\n\tpublic _pUpdate()\n\t{\n\t\tsuper._pUpdate();\n\n\t\tthis._box = this._pEntity.getBox();\n\t\tvar matrix:Matrix3D = this._pEntity.sceneTransform;\n\t\tvar hx:number = this._box.width/2;\n\t\tvar hy:number = this._box.height/2;\n\t\tvar hz:number = this._box.depth/2;\n\t\tvar cx:number = this._box.x + hx;\n\t\tvar cy:number = this._box.y + hy;\n\t\tvar cz:number = this._box.z + hz;\n\t\tvar raw:number[] = Matrix3DUtils.RAW_DATA_CONTAINER;\n\n\t\tmatrix.copyRawDataTo(raw);\n\n\t\tvar m11:number = raw[0], m12:number = raw[4], m13:number = raw[8], m14:number = raw[12];\n\t\tvar m21:number = raw[1], m22:number = raw[5], m23:number = raw[9], m24:number = raw[13];\n\t\tvar m31:number = raw[2], m32:number = raw[6], m33:number = raw[10], m34:number = raw[14];\n\n\t\tthis._centerX = cx*m11 + cy*m12 + cz*m13 + m14;\n\t\tthis._centerY = cx*m21 + cy*m22 + cz*m23 + m24;\n\t\tthis._centerZ = cx*m31 + cy*m32 + cz*m33 + m34;\n\n\t\tthis._halfExtentsX = Math.abs(hx*m11 + hy*m12 + hz*m13);\n\t\tthis._halfExtentsY = Math.abs(hx*m21 + hy*m22 + hz*m23);\n\t\tthis._halfExtentsZ = Math.abs(hx*m31 + hy*m32 + hz*m33);\n\n\t\tif (this._prefab) {\n\t\t\tthis._prefab.width = this._box.width;\n\t\t\tthis._prefab.height = this._box.height;\n\t\t\tthis._prefab.depth = this._box.depth;\n\t\t\tthis._pBoundsPrimitive.transform.matrix3D = matrix;\n\t\t}\n\n\t\tthis._width = this._halfExtentsX*2;\n\t\tthis._height = this._halfExtentsY*2;\n\t\tthis._depth = this._halfExtentsZ*2;\n\n\t\tthis._x = this._centerX - this._halfExtentsX;\n\t\tthis._y = this._centerY - this._halfExtentsY;\n\t\tthis._z = this._centerZ - this._halfExtentsZ;\n\t}\n\n\tpublic _pCreateBoundsPrimitive():Mesh\n\t{\n\t\tthis._prefab = new PrimitiveCubePrefab();\n\t\tthis._prefab.geometryType = \"lineSubGeometry\";\n\n\t\treturn <Mesh> this._prefab.getNewObject();\n\t}\n}\n\nexport = AxisAlignedBoundingBox;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\nimport PlaneClassification\t\t\t= require(\"awayjs-core/lib/geom/PlaneClassification\");\nimport Plane3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Plane3D\");\nimport Sphere\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Sphere\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport BoundingVolumeBase\t\t\t= require(\"awayjs-display/lib/bounds/BoundingVolumeBase\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport Mesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\nimport PrimitiveSpherePrefab\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveSpherePrefab\");\n\nclass BoundingSphere extends BoundingVolumeBase\n{\n\tprivate _sphere:Sphere;\n\tprivate _radius:number = 0;\n\tprivate _centerX:number = 0;\n\tprivate _centerY:number = 0;\n\tprivate _centerZ:number = 0;\n\tprivate _prefab:PrimitiveSpherePrefab;\n\n\tconstructor(entity:IEntity)\n\t{\n\t\tsuper(entity);\n\t}\n\n\tpublic nullify()\n\t{\n\t\tthis._centerX = this._centerY = this._centerZ = 0;\n\t\tthis._radius = 0;\n\t}\n\n\tpublic isInFrustum(planes:Array<Plane3D>, numPlanes:number):boolean\n\t{\n\t\tif(this._pInvalidated)\n\t\t\tthis._pUpdate();\n\n\t\tfor (var i:number = 0; i < numPlanes; ++i) {\n\t\t\tvar plane:Plane3D = planes[i];\n\t\t\tvar flippedExtentX:number = plane.a < 0? -this._radius : this._radius;\n\t\t\tvar flippedExtentY:number = plane.b < 0? -this._radius : this._radius;\n\t\t\tvar flippedExtentZ:number = plane.c < 0? -this._radius : this._radius;\n\t\t\tvar projDist:number = plane.a*( this._centerX + flippedExtentX ) + plane.b*( this._centerY + flippedExtentY) + plane.c*( this._centerZ + flippedExtentZ ) - plane.d;\n\t\t\tif (projDist < 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic rayIntersection(position:Vector3D, direction:Vector3D, targetNormal:Vector3D):number\n\t{\n\t\tif(this._pInvalidated)\n\t\t\tthis._pUpdate();\n\n\t\treturn this._sphere.rayIntersection(position, direction, targetNormal);\n\t}\n\n\t//@override\n\tpublic classifyToPlane(plane:Plane3D):number\n\t{\n\t\tvar a:number = plane.a;\n\t\tvar b:number = plane.b;\n\t\tvar c:number = plane.c;\n\t\tvar dd:number = a*this._centerX + b*this._centerY + c*this._centerZ - plane.d;\n\n\t\tif (a < 0)\n\t\t\ta = -a;\n\n\t\tif (b < 0)\n\t\t\tb = -b;\n\n\t\tif (c < 0)\n\t\t\tc = -c;\n\n\t\tvar rr:Number = (a + b + c)*this._radius;\n\n\t\treturn dd > rr? PlaneClassification.FRONT : dd < -rr? PlaneClassification.BACK : PlaneClassification.INTERSECT;\n\t}\n\n\tpublic _pUpdate()\n\t{\n\t\tsuper._pUpdate();\n\n\t\tthis._sphere = this._pEntity.getSphere();\n\t\tvar matrix:Matrix3D = this._pEntity.sceneTransform;\n\n\t\tvar cx:number = this._sphere.x;\n\t\tvar cy:number = this._sphere.y;\n\t\tvar cz:number = this._sphere.z;\n\t\tvar r:number = this._sphere.radius;\n\n\t\tvar raw:Array<number> = new Array<number>(16);\n\t\tmatrix.copyRawDataTo(raw);\n\n\t\tvar m11:number = raw[0], m12:number = raw[4], m13:number = raw[8], m14:number = raw[12];\n\t\tvar m21:number = raw[1], m22:number = raw[5], m23:number = raw[9], m24:number = raw[13];\n\t\tvar m31:number = raw[2], m32:number = raw[6], m33:number = raw[10], m34:number = raw[14];\n\n\t\tthis._centerX = cx*m11 + cy*m12 + cz*m13 + m14;\n\t\tthis._centerY = cx*m21 + cy*m22 + cz*m23 + m24;\n\t\tthis._centerZ = cx*m31 + cy*m32 + cz*m33 + m34;\n\n\t\tvar rx:number = m11 + m12 + m13;\n\t\tvar ry:number = m21 + m22 + m23;\n\t\tvar rz:number = m31 + m32 + m33;\n\t\tthis._radius = r*Math.sqrt((rx*rx + ry*ry + rz*rz)/3);\n\n\t\tif (this._prefab) {\n\t\t\tthis._prefab.radius = r;\n\t\t\tthis._pBoundsPrimitive.x = cx;\n\t\t\tthis._pBoundsPrimitive.y = cy;\n\t\t\tthis._pBoundsPrimitive.z = cz;\n\t\t\tthis._pBoundsPrimitive.transform.matrix3D = matrix;\n\t\t}\n\t}\n\n\tpublic _pCreateBoundsPrimitive():Mesh\n\t{\n\t\tthis._prefab = new PrimitiveSpherePrefab();\n\t\tthis._prefab.geometryType = \"lineSubGeometry\";\n\n\t\treturn <Mesh> this._prefab.getNewObject();\n\t}\n}\n\nexport = BoundingSphere;","import Box\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Box\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Plane3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Plane3D\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport Mesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\n\nclass BoundingVolumeBase\n{\n\tpublic _pEntity:IEntity;\n\tpublic _pBoundsPrimitive:Mesh;\n\tpublic _pInvalidated:boolean = true;\n\n\tconstructor(entity)\n\t{\n\t\tthis._pEntity = entity;\n\t}\n\n\tpublic get boundsPrimitive():IEntity\n\t{\n\t\tif (this._pBoundsPrimitive == null) {\n\t\t\tthis._pBoundsPrimitive = this._pCreateBoundsPrimitive();\n\n\t\t\tthis._pUpdate();\n\t\t}\n\n\t\treturn this._pBoundsPrimitive;\n\t}\n\n\tpublic nullify()\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic isInFrustum(planes:Array<Plane3D>, numPlanes:number):boolean\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic clone():BoundingVolumeBase\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic rayIntersection(position:Vector3D, direction:Vector3D, targetNormal:Vector3D):number\n\t{\n\t\treturn -1;\n\t}\n\n\tpublic classifyToPlane(plane:Plane3D):number\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic _pUpdate()\n\t{\n\t\tthis._pInvalidated = false;\n\t}\n\n\tpublic invalidate()\n\t{\n\t\tthis._pInvalidated = true;\n\t}\n\n\tpublic _pCreateBoundsPrimitive():Mesh\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n}\n\nexport = BoundingVolumeBase;","/**\n *\n */\nclass BoundsType\n{\n\t/**\n\t *\n\t */\n\tpublic static SPHERE:string = \"sphere\";\n\n\t/**\n\t *\n\t */\n\tpublic static AXIS_ALIGNED_BOX:string = \"axisAlignedBox\";\n\n\t/**\n\t *\n\t */\n\tpublic static NULL:string = \"null\";\n}\n\nexport = BoundsType;","import PlaneClassification\t\t\t= require(\"awayjs-core/lib/geom/PlaneClassification\");\nimport Plane3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Plane3D\");\n\nimport BoundingVolumeBase\t\t\t= require(\"awayjs-display/lib/bounds/BoundingVolumeBase\");\n\n\nclass NullBounds extends BoundingVolumeBase\n{\n\tprivate _alwaysIn:boolean;\n\n\tconstructor(alwaysIn:boolean = true)\n\t{\n\t\tsuper(null);\n\n\t\tthis._alwaysIn = alwaysIn;\n\t}\n\n\t//@override\n\tpublic clone():BoundingVolumeBase\n\t{\n\t\treturn new NullBounds(this._alwaysIn);\n\t}\n\n\t//@override\n\tpublic isInFrustum(planes:Array<Plane3D>, numPlanes:number):boolean\n\t{\n\t\treturn this._alwaysIn;\n\t}\n\n\tpublic classifyToPlane(plane:Plane3D):number\n\t{\n\t\treturn PlaneClassification.INTERSECT;\n\t}\n}\n\nexport = NullBounds;","import Point\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\nimport AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport IAsset\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport ArgumentError\t\t\t\t= require(\"awayjs-core/lib/errors/ArgumentError\");\nimport Error\t\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\nimport RangeError\t\t\t\t\t= require(\"awayjs-core/lib/errors/RangeError\");\n\nimport DisplayObject\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport Scene\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/Scene\");\n\n/**\n * The DisplayObjectContainer class is the base class for all objects that can\n * serve as display object containers on the display list. The display list\n * manages all objects displayed in the Flash runtimes. Use the\n * DisplayObjectContainer class to arrange the display objects in the display\n * list. Each DisplayObjectContainer object has its own child list for\n * organizing the z-order of the objects. The z-order is the front-to-back\n * order that determines which object is drawn in front, which is behind, and\n * so on.\n *\n * <p>DisplayObject is an abstract base class; therefore, you cannot call\n * DisplayObject directly. Invoking <code>new DisplayObject()</code> throws an\n * <code>ArgumentError</code> exception.</p>\n * The DisplayObjectContainer class is an abstract base class for all objects\n * that can contain child objects. It cannot be instantiated directly; calling\n * the <code>new DisplayObjectContainer()</code> constructor throws an\n * <code>ArgumentError</code> exception.\n *\n * <p>For more information, see the \"Display Programming\" chapter of the\n * <i>ActionScript 3.0 Developer's Guide</i>.</p>\n */\nclass DisplayObjectContainer extends DisplayObject implements IAsset\n{\n\tprivate _mouseChildren:boolean = true;\n\tprivate _children:Array<DisplayObject> = new Array<DisplayObject>();\n\tpublic _iIsRoot:boolean;\n\n\t/**\n\t *\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.CONTAINER;\n\t}\n\n\t/**\n\t * Determines whether or not the children of the object are mouse, or user\n\t * input device, enabled. If an object is enabled, a user can interact with\n\t * it by using a mouse or user input device. The default is\n\t * <code>true</code>.\n\t *\n\t * <p>This property is useful when you create a button with an instance of\n\t * the Sprite class(instead of using the SimpleButton class). When you use a\n\t * Sprite instance to create a button, you can choose to decorate the button\n\t * by using the <code>addChild()</code> method to add additional Sprite\n\t * instances. This process can cause unexpected behavior with mouse events\n\t * because the Sprite instances you add as children can become the target\n\t * object of a mouse event when you expect the parent instance to be the\n\t * target object. To ensure that the parent instance serves as the target\n\t * objects for mouse events, you can set the <code>mouseChildren</code>\n\t * property of the parent instance to <code>false</code>.</p>\n\t *\n\t * <p> No event is dispatched by setting this property. You must use the\n\t * <code>addEventListener()</code> method to create interactive\n\t * functionality.</p>\n\t */\n\tpublic get mouseChildren():boolean\n\t{\n\t\treturn this._mouseChildren;\n\t}\n\n\tpublic set mouseChildren(value:boolean)\n\t{\n\t\tif (this._mouseChildren == value)\n\t\t\treturn;\n\n\t\tthis._mouseChildren = value;\n\n\t\tthis._pUpdateImplicitMouseEnabled(this._pParent? this._pParent.mouseChildren : true);\n\t}\n\n\t/**\n\t * Returns the number of children of this object.\n\t */\n\tpublic get numChildren():number /*int*/\n\t{\n\t\treturn this._children.length;\n\t}\n\n\t/**\n\t * Determines whether the children of the object are tab enabled. Enables or\n\t * disables tabbing for the children of the object. The default is\n\t * <code>true</code>.\n\t *\n\t * <p><b>Note:</b> Do not use the <code>tabChildren</code> property with\n\t * Flex. Instead, use the\n\t * <code>mx.core.UIComponent.hasFocusableChildren</code> property.</p>\n\t *\n\t * @throws IllegalOperationError Calling this property of the Stage object\n\t *                               throws an exception. The Stage object does\n\t *                               not implement this property.\n\t */\n\tpublic tabChildren:boolean;\n\n\t/**\n\t * Calling the <code>new DisplayObjectContainer()</code> constructor throws\n\t * an <code>ArgumentError</code> exception. You <i>can</i>, however, call\n\t * constructors for the following subclasses of DisplayObjectContainer:\n\t * <ul>\n\t *   <li><code>new Loader()</code></li>\n\t *   <li><code>new Sprite()</code></li>\n\t *   <li><code>new MovieClip()</code></li>\n\t * </ul>\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * Adds a child DisplayObject instance to this DisplayObjectContainer\n\t * instance. The child is added to the front(top) of all other children in\n\t * this DisplayObjectContainer instance.(To add a child to a specific index\n\t * position, use the <code>addChildAt()</code> method.)\n\t *\n\t * <p>If you add a child object that already has a different display object\n\t * container as a parent, the object is removed from the child list of the\n\t * other display object container. </p>\n\t *\n\t * <p><b>Note:</b> The command <code>stage.addChild()</code> can cause\n\t * problems with a published SWF file, including security problems and\n\t * conflicts with other loaded SWF files. There is only one Stage within a\n\t * Flash runtime instance, no matter how many SWF files you load into the\n\t * runtime. So, generally, objects should not be added to the Stage,\n\t * directly, at all. The only object the Stage should contain is the root\n\t * object. Create a DisplayObjectContainer to contain all of the items on the\n\t * display list. Then, if necessary, add that DisplayObjectContainer instance\n\t * to the Stage.</p>\n\t *\n\t * @param child The DisplayObject instance to add as a child of this\n\t *              DisplayObjectContainer instance.\n\t * @return The DisplayObject instance that you pass in the <code>child</code>\n\t *         parameter.\n\t * @throws ArgumentError Throws if the child is the same as the parent. Also\n\t *                       throws if the caller is a child(or grandchild etc.)\n\t *                       of the child being added.\n\t * @event added Dispatched when a display object is added to the display\n\t *              list.\n\t */\n\tpublic addChild(child:DisplayObject):DisplayObject\n\t{\n\t\tif (child == null)\n\t\t\tthrow new Error(\"Parameter child cannot be null.\");\n\n\t\t//if child already has a parent, remove it.\n\t\tif (child._pParent)\n\t\t\tchild._pParent.removeChildInternal(child);\n\n\t\tchild.iSetParent(this);\n\n\t\tthis._children.push(child);\n\n\t\treturn child;\n\t}\n\n\n\t/**\n\t * Adds a child DisplayObject instance to this DisplayObjectContainer\n\t * instance. The child is added at the index position specified. An index of\n\t * 0 represents the back(bottom) of the display list for this\n\t * DisplayObjectContainer object.\n\t *\n\t * <p>For example, the following example shows three display objects, labeled\n\t * a, b, and c, at index positions 0, 2, and 1, respectively:</p>\n\t *\n\t * <p>If you add a child object that already has a different display object\n\t * container as a parent, the object is removed from the child list of the\n\t * other display object container. </p>\n\t *\n\t * @param child The DisplayObject instance to add as a child of this\n\t *              DisplayObjectContainer instance.\n\t * @param index The index position to which the child is added. If you\n\t *              specify a currently occupied index position, the child object\n\t *              that exists at that position and all higher positions are\n\t *              moved up one position in the child list.\n\t * @return The DisplayObject instance that you pass in the <code>child</code>\n\t *         parameter.\n\t * @throws ArgumentError Throws if the child is the same as the parent. Also\n\t *                       throws if the caller is a child(or grandchild etc.)\n\t *                       of the child being added.\n\t * @throws RangeError    Throws if the index position does not exist in the\n\t *                       child list.\n\t * @event added Dispatched when a display object is added to the display\n\t *              list.\n\t */\n\tpublic addChildAt(child:DisplayObject, index:number /*int*/):DisplayObject\n\t{\n\t\treturn child;\n\t}\n\n\tpublic addChildren(...childarray:Array<DisplayObject>)\n\t{\n\t\tvar len:number = childarray.length;\n\t\tfor (var i:number = 0; i <  len; i++)\n\t\t\tthis.addChild(childarray[i]);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic clone():DisplayObject\n\t{\n\t\tvar clone:DisplayObjectContainer = new DisplayObjectContainer();\n\t\tclone.pivot = this.pivot;\n\t\tclone._iMatrix3D = this._iMatrix3D;\n\t\tclone.partition = this.partition;\n\t\tclone.name = name;\n\n\t\tvar len:number = this._children.length;\n\t\tfor (var i:number = 0; i < len; ++i)\n\t\t\tclone.addChild(this._children[i].clone());\n\n\t\t// todo: implement for all subtypes\n\t\treturn clone;\n\t}\n\n\t/**\n\t * Determines whether the specified display object is a child of the\n\t * DisplayObjectContainer instance or the instance itself. The search\n\t * includes the entire display list including this DisplayObjectContainer\n\t * instance. Grandchildren, great-grandchildren, and so on each return\n\t * <code>true</code>.\n\t *\n\t * @param child The child object to test.\n\t * @return <code>true</code> if the <code>child</code> object is a child of\n\t *         the DisplayObjectContainer or the container itself; otherwise\n\t *         <code>false</code>.\n\t */\n\tpublic contains(child:DisplayObject):boolean\n\t{\n\t\treturn this._children.indexOf(child) >= 0;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic disposeWithChildren()\n\t{\n\t\tthis.dispose();\n\n\t\twhile (this.numChildren > 0)\n\t\t\tthis.getChildAt(0).dispose();\n\t}\n\n\t/**\n\t * Returns the child display object instance that exists at the specified\n\t * index.\n\t *\n\t * @param index The index position of the child object.\n\t * @return The child display object at the specified index position.\n\t * @throws RangeError    Throws if the index does not exist in the child\n\t *                       list.\n\t */\n\tpublic getChildAt(index:number /*int*/):DisplayObject\n\t{\n\t\tvar child:DisplayObject = this._children[index];\n\n\t\tif (child == null)\n\t\t\tthrow new RangeError(\"Index does not exist in the child list of the caller\");\n\n\t\treturn child;\n\t}\n\n\t/**\n\t * Returns the child display object that exists with the specified name. If\n\t * more that one child display object has the specified name, the method\n\t * returns the first object in the child list.\n\t *\n\t * <p>The <code>getChildAt()</code> method is faster than the\n\t * <code>getChildByName()</code> method. The <code>getChildAt()</code> method\n\t * accesses a child from a cached array, whereas the\n\t * <code>getChildByName()</code> method has to traverse a linked list to\n\t * access a child.</p>\n\t *\n\t * @param name The name of the child to return.\n\t * @return The child display object with the specified name.\n\t */\n\tpublic getChildByName(name:string):DisplayObject\n\t{\n\t\tvar len:number = this._children.length;\n\t\tfor (var i:number = 0; i < len; ++i)\n\t\t\tif (this._children[i].name == name)\n\t\t\t\treturn this._children[i];\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Returns the index position of a <code>child</code> DisplayObject instance.\n\t *\n\t * @param child The DisplayObject instance to identify.\n\t * @return The index position of the child display object to identify.\n\t * @throws ArgumentError Throws if the child parameter is not a child of this\n\t *                       object.\n\t */\n\tpublic getChildIndex(child:DisplayObject):number /*int*/\n\t{\n\t\tvar childIndex:number = this._children.indexOf(child);\n\n\t\tif (childIndex == -1)\n\t\t\tthrow new ArgumentError(\"Child parameter is not a child of the caller\");\n\n\t\treturn childIndex;\n\t}\n\n\t/**\n\t * Returns an array of objects that lie under the specified point and are\n\t * children(or grandchildren, and so on) of this DisplayObjectContainer\n\t * instance. Any child objects that are inaccessible for security reasons are\n\t * omitted from the returned array. To determine whether this security\n\t * restriction affects the returned array, call the\n\t * <code>areInaccessibleObjectsUnderPoint()</code> method.\n\t *\n\t * <p>The <code>point</code> parameter is in the coordinate space of the\n\t * Stage, which may differ from the coordinate space of the display object\n\t * container(unless the display object container is the Stage). You can use\n\t * the <code>globalToLocal()</code> and the <code>localToGlobal()</code>\n\t * methods to convert points between these coordinate spaces.</p>\n\t *\n\t * @param point The point under which to look.\n\t * @return An array of objects that lie under the specified point and are\n\t *         children(or grandchildren, and so on) of this\n\t *         DisplayObjectContainer instance.\n\t */\n\tpublic getObjectsUnderPoint(point:Point):Array<DisplayObject>\n\t{\n\t\treturn new Array<DisplayObject>();\n\t}\n\n\t/**\n\t * Removes the specified <code>child</code> DisplayObject instance from the\n\t * child list of the DisplayObjectContainer instance. The <code>parent</code>\n\t * property of the removed child is set to <code>null</code> , and the object\n\t * is garbage collected if no other references to the child exist. The index\n\t * positions of any display objects above the child in the\n\t * DisplayObjectContainer are decreased by 1.\n\t *\n\t * <p>The garbage collector reallocates unused memory space. When a variable\n\t * or object is no longer actively referenced or stored somewhere, the\n\t * garbage collector sweeps through and wipes out the memory space it used to\n\t * occupy if no other references to it exist.</p>\n\t *\n\t * @param child The DisplayObject instance to remove.\n\t * @return The DisplayObject instance that you pass in the <code>child</code>\n\t *         parameter.\n\t * @throws ArgumentError Throws if the child parameter is not a child of this\n\t *                       object.\n\t */\n\tpublic removeChild(child:DisplayObject):DisplayObject\n\t{\n\t\tif (child == null)\n\t\t\tthrow new Error(\"Parameter child cannot be null\");\n\n\t\tthis.removeChildInternal(child);\n\n\t\tchild.iSetParent(null);\n\n\t\treturn child;\n\t}\n\n\t/**\n\t * Removes a child DisplayObject from the specified <code>index</code>\n\t * position in the child list of the DisplayObjectContainer. The\n\t * <code>parent</code> property of the removed child is set to\n\t * <code>null</code>, and the object is garbage collected if no other\n\t * references to the child exist. The index positions of any display objects\n\t * above the child in the DisplayObjectContainer are decreased by 1.\n\t *\n\t * <p>The garbage collector reallocates unused memory space. When a variable\n\t * or object is no longer actively referenced or stored somewhere, the\n\t * garbage collector sweeps through and wipes out the memory space it used to\n\t * occupy if no other references to it exist.</p>\n\t *\n\t * @param index The child index of the DisplayObject to remove.\n\t * @return The DisplayObject instance that was removed.\n\t * @throws RangeError    Throws if the index does not exist in the child\n\t *                       list.\n\t * @throws SecurityError This child display object belongs to a sandbox to\n\t *                       which the calling object does not have access. You\n\t *                       can avoid this situation by having the child movie\n\t *                       call the <code>Security.allowDomain()</code> method.\n\t */\n\tpublic removeChildAt(index:number /*int*/):DisplayObject\n\t{\n\t\treturn this.removeChild(this._children[index]);\n\t}\n\n\t/**\n\t * Removes all <code>child</code> DisplayObject instances from the child list\n\t * of the DisplayObjectContainer instance. The <code>parent</code> property\n\t * of the removed children is set to <code>null</code>, and the objects are\n\t * garbage collected if no other references to the children exist.\n\t *\n\t * The garbage collector reallocates unused memory space. When a variable or\n\t * object is no longer actively referenced or stored somewhere, the garbage\n\t * collector sweeps through and wipes out the memory space it used to occupy\n\t * if no other references to it exist.\n\t *\n\t * @param beginIndex The beginning position. A value smaller than 0 throws a RangeError.\n\t * @param endIndex The ending position. A value smaller than 0 throws a RangeError.\n\t * @throws RangeError    Throws if the beginIndex or endIndex positions do\n\t *                       not exist in the child list.\n\t */\n\tpublic removeChildren(beginIndex:number /*int*/ = 0, endIndex:number /*int*/ = 2147483647)\n\t{\n\t\tif (beginIndex < 0)\n\t\t\tthrow new RangeError(\"beginIndex is out of range of the child list\");\n\n\t\tif (endIndex > this._children.length)\n\t\t\tthrow new RangeError(\"endIndex is out of range of the child list\");\n\n\t\tfor(var i:number /*uint*/ = beginIndex; i < endIndex; i++)\n\t\t\tthis.removeChild(this._children[i]);\n\t}\n\n\t/**\n\t * Changes the position of an existing child in the display object container.\n\t * This affects the layering of child objects. For example, the following\n\t * example shows three display objects, labeled a, b, and c, at index\n\t * positions 0, 1, and 2, respectively:\n\t *\n\t * <p>When you use the <code>setChildIndex()</code> method and specify an\n\t * index position that is already occupied, the only positions that change\n\t * are those in between the display object's former and new position. All\n\t * others will stay the same. If a child is moved to an index LOWER than its\n\t * current index, all children in between will INCREASE by 1 for their index\n\t * reference. If a child is moved to an index HIGHER than its current index,\n\t * all children in between will DECREASE by 1 for their index reference. For\n\t * example, if the display object container in the previous example is named\n\t * <code>container</code>, you can swap the position of the display objects\n\t * labeled a and b by calling the following code:</p>\n\t *\n\t * <p>This code results in the following arrangement of objects:</p>\n\t *\n\t * @param child The child DisplayObject instance for which you want to change\n\t *              the index number.\n\t * @param index The resulting index number for the <code>child</code> display\n\t *              object.\n\t * @throws ArgumentError Throws if the child parameter is not a child of this\n\t *                       object.\n\t * @throws RangeError    Throws if the index does not exist in the child\n\t *                       list.\n\t */\n\tpublic setChildIndex(child:DisplayObject, index:number /*int*/)\n\t{\n\t\t//TODO\n\t}\n\n\t/**\n\t * Swaps the z-order (front-to-back order) of the two specified child\n\t * objects. All other child objects in the display object container remain in\n\t * the same index positions.\n\t *\n\t * @param child1 The first child object.\n\t * @param child2 The second child object.\n\t * @throws ArgumentError Throws if either child parameter is not a child of\n\t *                       this object.\n\t */\n\tpublic swapChildren(child1:DisplayObject, child2:DisplayObject)\n\t{\n\t\t//TODO\n\t}\n\n\t/**\n\t * Swaps the z-order(front-to-back order) of the child objects at the two\n\t * specified index positions in the child list. All other child objects in\n\t * the display object container remain in the same index positions.\n\t *\n\t * @param index1 The index position of the first child object.\n\t * @param index2 The index position of the second child object.\n\t * @throws RangeError If either index does not exist in the child list.\n\t */\n\tpublic swapChildrenAt(index1:number /*int*/, index2:number /*int*/)\n\t{\n\t\t//TODO\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tpublic pInvalidateSceneTransform()\n\t{\n\t\tsuper.pInvalidateSceneTransform();\n\n\t\tvar len:number = this._children.length;\n\t\tfor (var i:number = 0; i < len; ++i)\n\t\t\tthis._children[i].pInvalidateSceneTransform();\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tpublic _pUpdateImplicitMouseEnabled(value:boolean)\n\t{\n\t\tsuper._pUpdateImplicitMouseEnabled(value);\n\n\t\tvar len:number = this._children.length;\n\t\tfor (var i:number = 0; i < len; ++i)\n\t\t\tthis._children[i]._pUpdateImplicitMouseEnabled(this._mouseChildren);\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tpublic _pUpdateImplicitVisibility(value:boolean)\n\t{\n\t\tsuper._pUpdateImplicitVisibility(value);\n\n\t\tvar len:number = this._children.length;\n\t\tfor (var i:number = 0; i < len; ++i)\n\t\t\tthis._children[i]._pUpdateImplicitVisibility(this._pImplicitVisibility);\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tpublic _pUpdateImplicitPartition(value:Partition, scene:Scene)\n\t{\n\t\tsuper._pUpdateImplicitPartition(value, scene);\n\n\t\tvar len:number = this._children.length;\n\t\tfor (var i:number = 0; i < len; ++i)\n\t\t\tthis._children[i]._pUpdateImplicitPartition(this._pImplicitPartition, scene);\n\t}\n\n\t/**\n\t * @private\n\t *\n\t * @param child\n\t */\n\tprivate removeChildInternal(child:DisplayObject):DisplayObject\n\t{\n\t\tthis._children.splice(this.getChildIndex(child), 1);\n\n\t\treturn child;\n\t}\n}\n\nexport = DisplayObjectContainer;","import AssetLibraryBundle\t\t\t= require(\"awayjs-core/lib/library/AssetLibraryBundle\");\nimport AssetLoader\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetLoader\");\nimport AssetLoaderContext\t\t\t= require(\"awayjs-core/lib/library/AssetLoaderContext\");\nimport AssetLoaderToken\t\t\t\t= require(\"awayjs-core/lib/library/AssetLoaderToken\");\nimport URLRequest\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\nimport AssetEvent\t\t\t\t\t= require(\"awayjs-core/lib/events/AssetEvent\");\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\nimport IOErrorEvent\t\t\t\t\t= require(\"awayjs-core/lib/events/IOErrorEvent\");\nimport LoaderEvent\t\t\t\t\t= require(\"awayjs-core/lib/events/LoaderEvent\");\nimport ParserEvent\t\t\t\t\t= require(\"awayjs-core/lib/events/ParserEvent\");\nimport ParserBase\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\n\nimport DisplayObjectContainer\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\nimport DisplayObject\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport LoaderInfo\t\t\t\t\t= require(\"awayjs-display/lib/base/LoaderInfo\");\n\n/**\n * The Loader class is used to load SWF files or image(JPG, PNG, or GIF)\n * files. Use the <code>load()</code> method to initiate loading. The loaded\n * display object is added as a child of the Loader object.\n *\n * <p>Use the URLLoader class to load text or binary data.</p>\n *\n * <p>The Loader class overrides the following methods that it inherits,\n * because a Loader object can only have one child display object - the\n * display object that it loads. Calling the following methods throws an\n * exception: <code>addChild()</code>, <code>addChildAt()</code>,\n * <code>removeChild()</code>, <code>removeChildAt()</code>, and\n * <code>setChildIndex()</code>. To remove a loaded display object, you must\n * remove the <i>Loader</i> object from its parent DisplayObjectContainer\n * child array. </p>\n *\n * <p><b>Note:</b> The ActionScript 2.0 MovieClipLoader and LoadVars classes\n * are not used in ActionScript 3.0. The Loader and URLLoader classes replace\n * them.</p>\n *\n * <p>When you use the Loader class, consider the Flash Player and Adobe AIR\n * security model: </p>\n *\n * <ul>\n *   <li>You can load content from any accessible source. </li>\n *   <li>Loading is not allowed if the calling SWF file is in a network\n * sandbox and the file to be loaded is local. </li>\n *   <li>If the loaded content is a SWF file written with ActionScript 3.0, it\n * cannot be cross-scripted by a SWF file in another security sandbox unless\n * that cross-scripting arrangement was approved through a call to the\n * <code>System.allowDomain()</code> or the\n * <code>System.allowInsecureDomain()</code> method in the loaded content\n * file.</li>\n *   <li>If the loaded content is an AVM1 SWF file(written using ActionScript\n * 1.0 or 2.0), it cannot be cross-scripted by an AVM2 SWF file(written using\n * ActionScript 3.0). However, you can communicate between the two SWF files\n * by using the LocalConnection class.</li>\n *   <li>If the loaded content is an image, its data cannot be accessed by a\n * SWF file outside of the security sandbox, unless the domain of that SWF\n * file was included in a URL policy file at the origin domain of the\n * image.</li>\n *   <li>Movie clips in the local-with-file-system sandbox cannot script movie\n * clips in the local-with-networking sandbox, and the reverse is also\n * prevented. </li>\n *   <li>You cannot connect to commonly reserved ports. For a complete list of\n * blocked ports, see \"Restricting Networking APIs\" in the <i>ActionScript 3.0\n * Developer's Guide</i>. </li>\n * </ul>\n *\n * <p>However, in AIR, content in the <code>application</code> security\n * sandbox(content installed with the AIR application) are not restricted by\n * these security limitations.</p>\n *\n * <p>For more information related to security, see the Flash Player Developer\n * Center Topic: <a href=\"http://www.adobe.com/go/devnet_security_en\"\n * scope=\"external\">Security</a>.</p>\n *\n * <p>When loading a SWF file from an untrusted source(such as a domain other\n * than that of the Loader object's root SWF file), you may want to define a\n * mask for the Loader object, to prevent the loaded content(which is a child\n * of the Loader object) from drawing to portions of the Stage outside of that\n * mask, as shown in the following code:</p>\n */\nclass Loader extends DisplayObjectContainer\n{\n\t/**\n\t * Dispatched when any asset finishes parsing. Also see specific events for each\n\t * individual asset type (meshes, materials et c.)\n\t *\n\t * @eventType AssetEvent\n\t */\n\t//[Event(name=\"assetComplete\", type=\"AssetEvent\")]\n\n\n\t/**\n\t * Dispatched when a full resource (including dependencies) finishes loading.\n\t *\n\t * @eventType LoaderEvent\n\t */\n\t//[Event(name=\"resourceComplete\", type=\"LoaderEvent\")]\n\n\tprivate _loadingSessions:Array<AssetLoader>;\n\tprivate _useAssetLib:boolean;\n\tprivate _assetLibId:string;\n\tprivate _onResourceCompleteDelegate:Function;\n\tprivate _onAssetCompleteDelegate:Function;\n\n\tprivate _content:DisplayObject;\n\tprivate _contentLoaderInfo:LoaderInfo;\n\n\t/**\n\t * Contains the root display object of the SWF file or image(JPG, PNG, or\n\t * GIF) file that was loaded by using the <code>load()</code> or\n\t * <code>loadBytes()</code> methods.\n\t *\n\t * @throws SecurityError The loaded SWF file or image file belongs to a\n\t *                       security sandbox to which you do not have access.\n\t *                       For a loaded SWF file, you can avoid this situation\n\t *                       by having the file call the\n\t *                       <code>Security.allowDomain()</code> method or by\n\t *                       having the loading file specify a\n\t *                       <code>loaderContext</code> parameter with its\n\t *                       <code>securityDomain</code> property set to\n\t *                       <code>SecurityDomain.currentDomain</code> when you\n\t *                       call the <code>load()</code> or\n\t *                       <code>loadBytes()</code> method.\n\t */\n\tpublic get content():DisplayObject\n\t{\n\t\treturn this._content;\n\t}\n\n\t/**\n\t * Returns a LoaderInfo object corresponding to the object being loaded.\n\t * LoaderInfo objects are shared between the Loader object and the loaded\n\t * content object. The LoaderInfo object supplies loading progress\n\t * information and statistics about the loaded file.\n\t *\n\t * <p>Events related to the load are dispatched by the LoaderInfo object\n\t * referenced by the <code>contentLoaderInfo</code> property of the Loader\n\t * object. The <code>contentLoaderInfo</code> property is set to a valid\n\t * LoaderInfo object, even before the content is loaded, so that you can add\n\t * event listeners to the object prior to the load.</p>\n\t *\n\t * <p>To detect uncaught errors that happen in a loaded SWF, use the\n\t * <code>Loader.uncaughtErrorEvents</code> property, not the\n\t * <code>Loader.contentLoaderInfo.uncaughtErrorEvents</code> property.</p>\n\t */\n\tpublic get contentLoaderInfo():LoaderInfo\n\t{\n\t\treturn this._contentLoaderInfo;\n\t}\n\n\t/**\n\t * Creates a Loader object that you can use to load files, such as SWF, JPEG,\n\t * GIF, or PNG files. Call the <code>load()</code> method to load the asset\n\t * as a child of the Loader instance. You can then add the Loader object to\n\t * the display list(for instance, by using the <code>addChild()</code>\n\t * method of a DisplayObjectContainer instance). The asset appears on the\n\t * Stage as it loads.\n\t *\n\t * <p>You can also use a Loader instance \"offlist,\" that is without adding it\n\t * to a display object container on the display list. In this mode, the\n\t * Loader instance might be used to load a SWF file that contains additional\n\t * modules of an application. </p>\n\t *\n\t * <p>To detect when the SWF file is finished loading, you can use the events\n\t * of the LoaderInfo object associated with the\n\t * <code>contentLoaderInfo</code> property of the Loader object. At that\n\t * point, the code in the module SWF file can be executed to initialize and\n\t * start the module. In the offlist mode, a Loader instance might also be\n\t * used to load a SWF file that contains components or media assets. Again,\n\t * you can use the LoaderInfo object event notifications to detect when the\n\t * components are finished loading. At that point, the application can start\n\t * using the components and media assets in the library of the SWF file by\n\t * instantiating the ActionScript 3.0 classes that represent those components\n\t * and assets.</p>\n\t *\n\t * <p>To determine the status of a Loader object, monitor the following\n\t * events that the LoaderInfo object associated with the\n\t * <code>contentLoaderInfo</code> property of the Loader object:</p>\n\t *\n\t * <ul>\n\t *   <li>The <code>open</code> event is dispatched when loading begins.</li>\n\t *   <li>The <code>ioError</code> or <code>securityError</code> event is\n\t * dispatched if the file cannot be loaded or if an error occured during the\n\t * load process. </li>\n\t *   <li>The <code>progress</code> event fires continuously while the file is\n\t * being loaded.</li>\n\t *   <li>The <code>complete</code> event is dispatched when a file completes\n\t * downloading, but before the loaded movie clip's methods and properties are\n\t * available. </li>\n\t *   <li>The <code>init</code> event is dispatched after the properties and\n\t * methods of the loaded SWF file are accessible, so you can begin\n\t * manipulating the loaded SWF file. This event is dispatched before the\n\t * <code>complete</code> handler. In streaming SWF files, the\n\t * <code>init</code> event can occur significantly earlier than the\n\t * <code>complete</code> event. For most purposes, use the <code>init</code>\n\t * handler.</li>\n\t * </ul>\n\t */\n\tconstructor(useAssetLibrary:boolean = true, assetLibraryId:string = null)\n\t{\n\t\tsuper();\n\n\t\tthis._loadingSessions = new Array<AssetLoader>();\n\t\tthis._useAssetLib = useAssetLibrary;\n\t\tthis._assetLibId = assetLibraryId;\n\n\t\tthis._onResourceCompleteDelegate = (event:LoaderEvent) => this.onResourceComplete(event);\n\t\tthis._onAssetCompleteDelegate = (event:AssetEvent) => this.onAssetComplete(event);\n\t}\n\n\t/**\n\t * Cancels a <code>load()</code> method operation that is currently in\n\t * progress for the Loader instance.\n\t *\n\t */\n\tpublic close()\n\t{\n\t\tif (this._useAssetLib) {\n\t\t\tvar lib:AssetLibraryBundle;\n\t\t\tlib = AssetLibraryBundle.getInstance(this._assetLibId);\n\t\t\tlib.stopAllLoadingSessions();\n\t\t\tthis._loadingSessions = null;\n\t\t\treturn\n\t\t}\n\t\tvar i:number /*int*/;\n\t\tvar length:number /*int*/ = this._loadingSessions.length;\n\t\tfor (i = 0; i < length; i++) {\n\t\t\tthis.removeListeners(this._loadingSessions[i]);\n\t\t\tthis._loadingSessions[i].stop();\n\t\t\tthis._loadingSessions[i] = null;\n\t\t}\n\t\tthis._loadingSessions = null;\n\t}\n\n\t/**\n\t * Loads a SWF, JPEG, progressive JPEG, unanimated GIF, or PNG file into an\n\t * object that is a child of this Loader object. If you load an animated GIF\n\t * file, only the first frame is displayed. As the Loader object can contain\n\t * only a single child, issuing a subsequent <code>load()</code> request\n\t * terminates the previous request, if still pending, and commences a new\n\t * load.\n\t *\n\t * <p><b>Note</b>: In AIR 1.5 and Flash Player 10, the maximum size for a\n\t * loaded image is 8,191 pixels in width or height, and the total number of\n\t * pixels cannot exceed 16,777,215 pixels.(So, if an loaded image is 8,191\n\t * pixels wide, it can only be 2,048 pixels high.) In Flash Player 9 and\n\t * earlier and AIR 1.1 and earlier, the limitation is 2,880 pixels in height\n\t * and 2,880 pixels in width.</p>\n\t *\n\t * <p>A SWF file or image loaded into a Loader object inherits the position,\n\t * rotation, and scale properties of the parent display objects of the Loader\n\t * object. </p>\n\t *\n\t * <p>Use the <code>unload()</code> method to remove movies or images loaded\n\t * with this method, or to cancel a load operation that is in progress.</p>\n\t *\n\t * <p>You can prevent a SWF file from using this method by setting the\n\t * <code>allowNetworking</code> parameter of the the <code>object</code> and\n\t * <code>embed</code> tags in the HTML page that contains the SWF\n\t * content.</p>\n\t *\n\t * <p>When you use this method, consider the Flash Player security model,\n\t * which is described in the Loader class description. </p>\n\t *\n\t * <p> In Flash Player 10 and later, if you use a multipart Content-Type(for\n\t * example \"multipart/form-data\") that contains an upload(indicated by a\n\t * \"filename\" parameter in a \"content-disposition\" header within the POST\n\t * body), the POST operation is subject to the security rules applied to\n\t * uploads:</p>\n\t *\n\t * <ul>\n\t *   <li>The POST operation must be performed in response to a user-initiated\n\t * action, such as a mouse click or key press.</li>\n\t *   <li>If the POST operation is cross-domain(the POST target is not on the\n\t * same server as the SWF file that is sending the POST request), the target\n\t * server must provide a URL policy file that permits cross-domain\n\t * access.</li>\n\t * </ul>\n\t *\n\t * <p>Also, for any multipart Content-Type, the syntax must be valid\n\t * (according to the RFC2046 standard). If the syntax appears to be invalid,\n\t * the POST operation is subject to the security rules applied to\n\t * uploads.</p>\n\t *\n\t * <p>For more information related to security, see the Flash Player\n\t * Developer Center Topic: <a\n\t * href=\"http://www.adobe.com/go/devnet_security_en\"\n\t * scope=\"external\">Security</a>.</p>\n\t *\n\t * @param request The absolute or relative URL of the SWF, JPEG, GIF, or PNG\n\t *                file to be loaded. A relative path must be relative to the\n\t *                main SWF file. Absolute URLs must include the protocol\n\t *                reference, such as http:// or file:///. Filenames cannot\n\t *                include disk drive specifications.\n\t * @param context A LoaderContext object, which has properties that define\n\t *                the following:\n\t *                <ul>\n\t *                  <li>Whether or not to check for the existence of a policy\n\t *                file upon loading the object</li>\n\t *                  <li>The ApplicationDomain for the loaded object</li>\n\t *                  <li>The SecurityDomain for the loaded object</li>\n\t *                  <li>The ImageDecodingPolicy for the loaded image\n\t *                object</li>\n\t *                </ul>\n\t *\n\t *                <p>If the <code>context</code> parameter is not specified\n\t *                or refers to a null object, the loaded content remains in\n\t *                its own security domain.</p>\n\t *\n\t *                <p>For complete details, see the description of the\n\t *                properties in the <a\n\t *                href=\"../system/LoaderContext.html\">LoaderContext</a>\n\t *                class.</p>\n\t * @param ns      An optional namespace string under which the file is to be\n\t *                loaded, allowing the differentiation of two resources with\n\t *                identical assets.\n\t * @param parser  An optional parser object for translating the loaded data\n\t *                into a usable resource. If not provided, AssetLoader will\n\t *                attempt to auto-detect the file type.\n\t * @throws IOError               The <code>digest</code> property of the\n\t *                               <code>request</code> object is not\n\t *                               <code>null</code>. You should only set the\n\t *                               <code>digest</code> property of a URLRequest\n\t *                               object when calling the\n\t *                               <code>URLLoader.load()</code> method when\n\t *                               loading a SWZ file(an Adobe platform\n\t *                               component).\n\t * @throws IllegalOperationError If the <code>requestedContentParent</code>\n\t *                               property of the <code>context</code>\n\t *                               parameter is a <code>Loader</code>.\n\t * @throws IllegalOperationError If the <code>LoaderContext.parameters</code>\n\t *                               parameter is set to non-null and has some\n\t *                               values which are not Strings.\n\t * @throws SecurityError         The value of\n\t *                               <code>LoaderContext.securityDomain</code>\n\t *                               must be either <code>null</code> or\n\t *                               <code>SecurityDomain.currentDomain</code>.\n\t *                               This reflects the fact that you can only\n\t *                               place the loaded media in its natural\n\t *                               security sandbox or your own(the latter\n\t *                               requires a policy file).\n\t * @throws SecurityError         Local SWF files may not set\n\t *                               LoaderContext.securityDomain to anything\n\t *                               other than <code>null</code>. It is not\n\t *                               permitted to import non-local media into a\n\t *                               local sandbox, or to place other local media\n\t *                               in anything other than its natural sandbox.\n\t * @throws SecurityError         You cannot connect to commonly reserved\n\t *                               ports. For a complete list of blocked ports,\n\t *                               see \"Restricting Networking APIs\" in the\n\t *                               <i>ActionScript 3.0 Developer's Guide</i>.\n\t * @throws SecurityError         If the <code>applicationDomain</code> or\n\t *                               <code>securityDomain</code> properties of\n\t *                               the <code>context</code> parameter are from\n\t *                               a disallowed domain.\n\t * @throws SecurityError         If a local SWF file is attempting to use the\n\t *                               <code>securityDomain</code> property of the\n\t *                               <code>context</code> parameter.\n\t * @event asyncError    Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object if the\n\t *                      <code>LoaderContext.requestedContentParent</code>\n\t *                      property has been specified and it is not possible to\n\t *                      add the loaded content as a child to the specified\n\t *                      DisplayObjectContainer. This could happen if the\n\t *                      loaded content is a\n\t *                      <code>flash.display.AVM1Movie</code> or if the\n\t *                      <code>addChild()</code> call to the\n\t *                      requestedContentParent throws an error.\n\t * @event complete      Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object when the file has completed loading. The\n\t *                      <code>complete</code> event is always dispatched\n\t *                      after the <code>init</code> event.\n\t * @event httpStatus    Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object when a network request is made over HTTP and\n\t *                      Flash Player can detect the HTTP status code.\n\t * @event init          Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object when the properties and methods of the loaded\n\t *                      SWF file are accessible. The <code>init</code> event\n\t *                      always precedes the <code>complete</code> event.\n\t * @event ioError       Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object when an input or output error occurs that\n\t *                      causes a load operation to fail.\n\t * @event open          Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object when the loading operation starts.\n\t * @event progress      Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object as data is received while load operation\n\t *                      progresses.\n\t * @event securityError Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object if a SWF file in the local-with-filesystem\n\t *                      sandbox attempts to load content in the\n\t *                      local-with-networking sandbox, or vice versa.\n\t * @event securityError Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object if the\n\t *                      <code>LoaderContext.requestedContentParent</code>\n\t *                      property has been specified and the security sandbox\n\t *                      of the\n\t *                      <code>LoaderContext.requestedContentParent</code>\n\t *                      does not have access to the loaded SWF.\n\t * @event unload        Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object when a loaded object is removed.\n\t */\n\tpublic load(request:URLRequest, context:AssetLoaderContext = null, ns:string = null, parser:ParserBase = null):AssetLoaderToken\n\t{\n\t\tvar token:AssetLoaderToken;\n\n\t\tif (this._useAssetLib) {\n\t\t\tvar lib:AssetLibraryBundle;\n\t\t\tlib = AssetLibraryBundle.getInstance(this._assetLibId);\n\t\t\ttoken = lib.load(request, context, ns, parser);\n\t\t} else {\n\t\t\tvar loader:AssetLoader = new AssetLoader();\n\t\t\tthis._loadingSessions.push(loader);\n\t\t\ttoken = loader.load(request, context, ns, parser);\n\t\t}\n\n\t\ttoken.addEventListener(LoaderEvent.RESOURCE_COMPLETE, this._onResourceCompleteDelegate);\n\t\ttoken.addEventListener(AssetEvent.ASSET_COMPLETE, this._onAssetCompleteDelegate);\n\n\t\t// Error are handled separately (see documentation for addErrorHandler)\n\t\ttoken._iLoader._iAddErrorHandler(this.onLoadError);\n\t\ttoken._iLoader._iAddParseErrorHandler(this.onParseError);\n\n\t\treturn token;\n\t}\n\n\t/**\n\t * Loads from binary data stored in a ByteArray object.\n\t *\n\t * <p>The <code>loadBytes()</code> method is asynchronous. You must wait for\n\t * the \"init\" event before accessing the properties of a loaded object.</p>\n\t *\n\t * <p>When you use this method, consider the Flash Player security model,\n\t * which is described in the Loader class description. </p>\n\t *\n\t * @param bytes   A ByteArray object. The contents of the ByteArray can be\n\t *                any of the file formats supported by the Loader class: SWF,\n\t *                GIF, JPEG, or PNG.\n\t * @param context A LoaderContext object. Only the\n\t *                <code>applicationDomain</code> property of the\n\t *                LoaderContext object applies; the\n\t *                <code>checkPolicyFile</code> and\n\t *                <code>securityDomain</code> properties of the LoaderContext\n\t *                object do not apply.\n\t *\n\t *                <p>If the <code>context</code> parameter is not specified\n\t *                or refers to a null object, the content is loaded into the\n\t *                current security domain -  a process referred to as \"import\n\t *                loading\" in Flash Player security documentation.\n\t *                Specifically, if the loading SWF file trusts the remote SWF\n\t *                by incorporating the remote SWF into its code, then the\n\t *                loading SWF can import it directly into its own security\n\t *                domain.</p>\n\t *\n\t *                <p>For more information related to security, see the Flash\n\t *                Player Developer Center Topic: <a\n\t *                href=\"http://www.adobe.com/go/devnet_security_en\"\n\t *                scope=\"external\">Security</a>.</p>\n\t * @throws ArgumentError         If the <code>length</code> property of the\n\t *                               ByteArray object is not greater than 0.\n\t * @throws IllegalOperationError If the <code>checkPolicyFile</code> or\n\t *                               <code>securityDomain</code> property of the\n\t *                               <code>context</code> parameter are non-null.\n\t * @throws IllegalOperationError If the <code>requestedContentParent</code>\n\t *                               property of the <code>context</code>\n\t *                               parameter is a <code>Loader</code>.\n\t * @throws IllegalOperationError If the <code>LoaderContext.parameters</code>\n\t *                               parameter is set to non-null and has some\n\t *                               values which are not Strings.\n\t * @throws SecurityError         If the provided\n\t *                               <code>applicationDomain</code> property of\n\t *                               the <code>context</code> property is from a\n\t *                               disallowed domain.\n\t * @throws SecurityError         You cannot connect to commonly reserved\n\t *                               ports. For a complete list of blocked ports,\n\t *                               see \"Restricting Networking APIs\" in the\n\t *                               <i>ActionScript 3.0 Developer's Guide</i>.\n\t * @event asyncError    Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object if the\n\t *                      <code>LoaderContext.requestedContentParent</code>\n\t *                      property has been specified and it is not possible to\n\t *                      add the loaded content as a child to the specified\n\t *                      DisplayObjectContainer. This could happen if the\n\t *                      loaded content is a\n\t *                      <code>flash.display.AVM1Movie</code> or if the\n\t *                      <code>addChild()</code> call to the\n\t *                      requestedContentParent throws an error.\n\t * @event complete      Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object when the operation is complete. The\n\t *                      <code>complete</code> event is always dispatched\n\t *                      after the <code>init</code> event.\n\t * @event init          Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object when the properties and methods of the loaded\n\t *                      data are accessible. The <code>init</code> event\n\t *                      always precedes the <code>complete</code> event.\n\t * @event ioError       Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object when the runtime cannot parse the data in the\n\t *                      byte array.\n\t * @event open          Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object when the operation starts.\n\t * @event progress      Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object as data is transfered in memory.\n\t * @event securityError Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object if the\n\t *                      <code>LoaderContext.requestedContentParent</code>\n\t *                      property has been specified and the security sandbox\n\t *                      of the\n\t *                      <code>LoaderContext.requestedContentParent</code>\n\t *                      does not have access to the loaded SWF.\n\t * @event unload        Dispatched by the <code>contentLoaderInfo</code>\n\t *                      object when a loaded object is removed.\n\t */\n\tpublic loadData(data:any, context:AssetLoaderContext = null, ns:string = null, parser:ParserBase = null):AssetLoaderToken\n\t{\n\t\tvar token:AssetLoaderToken;\n\n\t\tif (this._useAssetLib) {\n\t\t\tvar lib:AssetLibraryBundle;\n\t\t\tlib = AssetLibraryBundle.getInstance(this._assetLibId);\n\t\t\ttoken = lib.loadData(data, context, ns, parser);\n\t\t} else {\n\t\t\tvar loader:AssetLoader = new AssetLoader();\n\t\t\tthis._loadingSessions.push(loader);\n\t\t\ttoken = loader.loadData(data, '', context, ns, parser);\n\t\t}\n\n\t\ttoken.addEventListener(LoaderEvent.RESOURCE_COMPLETE, this._onResourceCompleteDelegate);\n\t\ttoken.addEventListener(AssetEvent.ASSET_COMPLETE, this._onAssetCompleteDelegate);\n\n\t\t// Error are handled separately (see documentation for addErrorHandler)\n\t\ttoken._iLoader._iAddErrorHandler(this.onLoadError);\n\t\ttoken._iLoader._iAddParseErrorHandler(this.onParseError);\n\n\t\treturn token;\n\t}\n\n\t/**\n\t * Removes a child of this Loader object that was loaded by using the\n\t * <code>load()</code> method. The <code>property</code> of the associated\n\t * LoaderInfo object is reset to <code>null</code>. The child is not\n\t * necessarily destroyed because other objects might have references to it;\n\t * however, it is no longer a child of the Loader object.\n\t *\n\t * <p>As a best practice, before you unload a child SWF file, you should\n\t * explicitly close any streams in the child SWF file's objects, such as\n\t * LocalConnection, NetConnection, NetStream, and Sound objects. Otherwise,\n\t * audio in the child SWF file might continue to play, even though the child\n\t * SWF file was unloaded. To close streams in the child SWF file, add an\n\t * event listener to the child that listens for the <code>unload</code>\n\t * event. When the parent calls <code>Loader.unload()</code>, the\n\t * <code>unload</code> event is dispatched to the child. The following code\n\t * shows how you might do this:</p>\n\t * <pre xml:space=\"preserve\"> public closeAllStreams(evt:Event) {\n\t * myNetStream.close(); mySound.close(); myNetConnection.close();\n\t * myLocalConnection.close(); }\n\t * myMovieClip.loaderInfo.addEventListener(Event.UNLOAD,\n\t * closeAllStreams);</pre>\n\t *\n\t */\n\tpublic unload()\n\t{\n\t\t//TODO\n\t}\n\n\t/**\n\t * Enables a specific parser.\n\t * When no specific parser is set for a loading/parsing opperation,\n\t * loader3d can autoselect the correct parser to use.\n\t * A parser must have been enabled, to be considered when autoselecting the parser.\n\t *\n\t * @param parserClass The parser class to enable.\n\t * @see away.parsers.Parsers\n\t */\n\tpublic static enableParser(parserClass:Object)\n\t{\n\t\tAssetLoader.enableParser(parserClass);\n\t}\n\n\t/**\n\t * Enables a list of parsers.\n\t * When no specific parser is set for a loading/parsing opperation,\n\t * loader3d can autoselect the correct parser to use.\n\t * A parser must have been enabled, to be considered when autoselecting the parser.\n\t *\n\t * @param parserClasses A Vector of parser classes to enable.\n\t * @see away.parsers.Parsers\n\t */\n\tpublic static enableParsers(parserClasses:Array<Object>)\n\t{\n\t\tAssetLoader.enableParsers(parserClasses);\n\t}\n\n\n\tprivate removeListeners(dispatcher:EventDispatcher)\n\t{\n\t\tdispatcher.removeEventListener(LoaderEvent.RESOURCE_COMPLETE, this._onResourceCompleteDelegate);\n\t\tdispatcher.removeEventListener(AssetEvent.ASSET_COMPLETE, this._onAssetCompleteDelegate);\n\t}\n\n\tprivate onAssetComplete(event:AssetEvent)\n\t{\n\t\tthis.dispatchEvent(event);\n\t}\n\n\t/**\n\t * Called when an error occurs during loading\n\t */\n\tprivate onLoadError(event:LoaderEvent):boolean\n\t{\n\t\tif (this.hasEventListener(IOErrorEvent.IO_ERROR)) {\n\t\t\tthis.dispatchEvent(event);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Called when a an error occurs during parsing\n\t */\n\tprivate onParseError(event:ParserEvent):boolean\n\t{\n\t\tif (this.hasEventListener(ParserEvent.PARSE_ERROR)) {\n\t\t\tthis.dispatchEvent(event);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Called when the resource and all of its dependencies was retrieved.\n\t */\n\tprivate onResourceComplete(event:LoaderEvent)\n\t{\n\t\tthis._content = <DisplayObject> event.content;\n\n\t\tif (this._content)\n\t\t\tthis.addChild(this._content);\n\n\t\tthis.dispatchEvent(event);\n\t}\n}\n\nexport = Loader;","import EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\n\nimport DisplayObject\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport DisplayObjectContainer\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\nimport SceneEvent\t\t\t\t\t= require(\"awayjs-display/lib/events/SceneEvent\");\nimport NodeBase\t\t\t\t\t\t= require(\"awayjs-display/lib/partition/NodeBase\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\n\nclass Scene extends EventDispatcher\n{\n\tprivate _expandedPartitions:Array<Partition> = new Array<Partition>();\n\tprivate _partitions:Array<Partition> = new Array<Partition>();\n\tprivate _partition:Partition;\n\n\tpublic _iSceneGraphRoot:DisplayObjectContainer;\n\tpublic _iCollectionMark = 0;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._partition = new Partition(new NodeBase());\n\n\t\tthis._iSceneGraphRoot = new DisplayObjectContainer();\n\n\t\tthis._iSceneGraphRoot._iSetScene(this);\n\t\tthis._iSceneGraphRoot._iIsRoot = true;\n\t\tthis._iSceneGraphRoot.partition = this._partition;\n\t}\n\n\tpublic traversePartitions(traverser:CollectorBase)\n\t{\n\t\tvar i:number = 0;\n\t\tvar len:number = this._partitions.length;\n\n\t\ttraverser.scene = this;\n\n\t\tthis._iCollectionMark++;\n\n\t\twhile (i < len)\n\t\t\tthis._partitions[i++].traverse(traverser);\n\t}\n\n\tpublic get partition():Partition\n\t{\n\t\treturn this._iSceneGraphRoot.partition;\n\t}\n\n\tpublic set partition(value:Partition)\n\t{\n\t\tthis._iSceneGraphRoot.partition = value;\n\n\t\tthis.dispatchEvent(new SceneEvent(SceneEvent.PARTITION_CHANGED, this._iSceneGraphRoot));\n\t}\n\n\tpublic contains(child:DisplayObject):boolean\n\t{\n\t\treturn this._iSceneGraphRoot.contains(child);\n\t}\n\n\tpublic addChild(child:DisplayObject):DisplayObject\n\t{\n\t\treturn this._iSceneGraphRoot.addChild(child);\n\t}\n\n\tpublic removeChild(child:DisplayObject)\n\t{\n\t\tthis._iSceneGraphRoot.removeChild(child);\n\t}\n\n\tpublic removeChildAt(index:number)\n\t{\n\t\tthis._iSceneGraphRoot.removeChildAt(index);\n\t}\n\n\n\tpublic getChildAt(index:number):DisplayObject\n\t{\n\t\treturn this._iSceneGraphRoot.getChildAt(index);\n\t}\n\n\tpublic get numChildren():number\n\t{\n\t\treturn this._iSceneGraphRoot.numChildren;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iRegisterPartition(partition:Partition)\n\t{\n\t\tthis._expandedPartitions.push(partition);\n\n\t\t//ensure duplicates are not found in partitions array\n\t\tif (this._partitions.indexOf(partition) == -1)\n\t\t\tthis._partitions.push(partition);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iUnregisterPartition(partition:Partition)\n\t{\n\t\tthis._expandedPartitions.splice(this._expandedPartitions.indexOf(partition), 1);\n\n\t\t//if no more partition references found, remove from partitions array\n\t\tif (this._expandedPartitions.indexOf(partition) == -1)\n\t\t\tthis._partitions.splice(this._partitions.indexOf(partition), 1);\n\t}\n}\n\nexport = Scene;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Point\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport getTimer\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/getTimer\");\n\nimport Scene\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/Scene\");\nimport IPicker\t\t\t\t\t\t= require(\"awayjs-display/lib/pick/IPicker\");\nimport PickingCollisionVO\t\t\t= require(\"awayjs-display/lib/pick/PickingCollisionVO\");\nimport RaycastPicker\t\t\t\t= require(\"awayjs-display/lib/pick/RaycastPicker\");\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/render/IRenderer\");\nimport CSSRendererBase\t\t\t\t= require(\"awayjs-display/lib/render/CSSRendererBase\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport CameraEvent\t\t\t\t\t= require(\"awayjs-display/lib/events/CameraEvent\");\nimport SceneEvent\t\t\t\t\t= require(\"awayjs-display/lib/events/SceneEvent\");\nimport RendererEvent\t\t\t\t= require(\"awayjs-display/lib/events/RendererEvent\");\nimport MouseManager\t\t\t\t\t= require(\"awayjs-display/lib/managers/MouseManager\");\n\nclass View\n{\n\n\t/*\n\t *************************************************************************************************************************\n\t * Development Notes\n\t *************************************************************************************************************************\n\t *\n\t * ShareContext     - this is not being used at the moment integration with other frameworks is not yet implemented or tested\n\t *                    and ( _localPos / _globalPos ) position of viewport are the same for the moment\n\t *\n\t * Background\n\t *                  - this is currently not being included in our tests and is currently disabled\n\t *\n\t **************************************************************************************************************************\n\t */\n\n\t// Protected\n\tpublic _pScene:Scene;\n\tpublic _pCamera:Camera;\n\tpublic _pEntityCollector:CollectorBase;\n\tpublic _pRenderer:IRenderer;\n\n\t// Private\n\tprivate _aspectRatio:number;\n\tprivate _width:number = 0;\n\tprivate _height:number = 0;\n\n\tprivate _time:number = 0;\n\tprivate _deltaTime:number = 0;\n\tprivate _backgroundColor:number = 0x000000;\n\tprivate _backgroundAlpha:number = 1;\n\n\tprivate _viewportDirty:boolean = true;\n\tprivate _scissorDirty:boolean = true;\n\n\tprivate _onScenePartitionChangedDelegate:(event:SceneEvent) => void;\n\tprivate _onProjectionChangedDelegate:(event:CameraEvent) => void;\n\tprivate _onViewportUpdatedDelegate:(event:RendererEvent) => void;\n\tprivate _onScissorUpdatedDelegate:(event:RendererEvent) => void;\n\tprivate _mouseManager:MouseManager;\n\tprivate _mousePicker:IPicker = new RaycastPicker();\n\n\tprivate _htmlElement:HTMLDivElement;\n\tprivate _shareContext:boolean;\n\tpublic _pMouseX:number;\n\tpublic _pMouseY:number;\n\n\t/*\n\t ***********************************************************************\n\t * Disabled / Not yet implemented\n\t ***********************************************************************\n\t *\n\t * private _background:away.textures.Texture2DBase;\n\t *\n\t * public _pTouch3DManager:away.managers.Touch3DManager;\n\t *\n\t */\n\tconstructor(renderer:IRenderer, scene:Scene = null, camera:Camera = null)\n\t{\n\t\tthis._onScenePartitionChangedDelegate = (event:SceneEvent) => this.onScenePartitionChanged(event);\n\t\tthis._onProjectionChangedDelegate = (event:CameraEvent) => this.onProjectionChanged(event);\n\t\tthis._onViewportUpdatedDelegate = (event:RendererEvent) => this.onViewportUpdated(event);\n\t\tthis._onScissorUpdatedDelegate = (event:RendererEvent) => this.onScissorUpdated(event);\n\n\t\tthis.scene = scene || new Scene();\n\t\tthis.camera = camera || new Camera();\n\t\tthis.renderer = renderer;\n\n\t\t//make sure document border is zero\n\t\tdocument.body.style.margin = \"0px\";\n\n\t\tthis._htmlElement = document.createElement(\"div\");\n\t\tthis._htmlElement.style.position = \"absolute\";\n\n\t\tdocument.body.appendChild(this._htmlElement);\n\n\t\tthis._mouseManager = MouseManager.getInstance();\n\t\tthis._mouseManager.registerView(this);\n\n//\t\t\tif (this._shareContext)\n//\t\t\t\tthis._mouse3DManager.addViewLayer(this);\n\t}\n\n\t/**\n\t *\n\t * @param e\n\t */\n\tprivate onScenePartitionChanged(event:SceneEvent)\n\t{\n\t\tif (this._pCamera)\n\t\t\tthis._pScene.partition._iRegisterCamera(this._pCamera);\n\t}\n\n\tpublic layeredView:boolean; //TODO: something to enable this correctly\n\n\tpublic get mouseX():number\n\t{\n\t\treturn this._pMouseX;\n\t}\n\n\tpublic get mouseY():number\n\t{\n\t\treturn this._pMouseY;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get htmlElement():HTMLDivElement\n\t{\n\t\treturn this._htmlElement;\n\t}\n\t/**\n\t *\n\t */\n\tpublic get renderer():IRenderer\n\t{\n\t\treturn this._pRenderer;\n\t}\n\n\tpublic set renderer(value:IRenderer)\n\t{\n\t\tif (this._pRenderer == value)\n\t\t\treturn;\n\n\t\tif (this._pRenderer) {\n\t\t\tthis._pRenderer.dispose();\n\t\t\tthis._pRenderer.removeEventListener(RendererEvent.VIEWPORT_UPDATED, this._onViewportUpdatedDelegate);\n\t\t\tthis._pRenderer.removeEventListener(RendererEvent.SCISSOR_UPDATED, this._onScissorUpdatedDelegate);\n\t\t}\n\n\t\tthis._pRenderer = value;\n\n\t\tthis._pRenderer.addEventListener(RendererEvent.VIEWPORT_UPDATED, this._onViewportUpdatedDelegate);\n\t\tthis._pRenderer.addEventListener(RendererEvent.SCISSOR_UPDATED, this._onScissorUpdatedDelegate);\n\n\t\t//reset entity collector\n\t\tthis._pEntityCollector = this._pRenderer._iCreateEntityCollector();\n\n\t\tif (this._pCamera)\n\t\t\tthis._pEntityCollector.camera = this._pCamera;\n\n\t\t//reset back buffer\n\t\tthis._pRenderer._iBackgroundR = ((this._backgroundColor >> 16) & 0xff)/0xff;\n\t\tthis._pRenderer._iBackgroundG = ((this._backgroundColor >> 8) & 0xff)/0xff;\n\t\tthis._pRenderer._iBackgroundB = (this._backgroundColor & 0xff)/0xff;\n\t\tthis._pRenderer._iBackgroundAlpha = this._backgroundAlpha;\n\t\tthis._pRenderer.width = this._width;\n\t\tthis._pRenderer.height = this._height;\n\t\tthis._pRenderer.shareContext = this._shareContext;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get shareContext():boolean\n\t{\n\t\treturn this._shareContext;\n\t}\n\n\tpublic set shareContext(value:boolean)\n\t{\n\t\tif (this._shareContext == value)\n\t\t\treturn;\n\n\t\tthis._shareContext = value;\n\n\t\tif (this._pRenderer)\n\t\t\tthis._pRenderer.shareContext = this._shareContext;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get backgroundColor():number\n\t{\n\t\treturn this._backgroundColor;\n\t}\n\n\tpublic set backgroundColor(value:number)\n\t{\n\t\tif (this._backgroundColor == value)\n\t\t\treturn;\n\n\t\tthis._backgroundColor = value;\n\n\t\tthis._pRenderer._iBackgroundR = ((value >> 16) & 0xff)/0xff;\n\t\tthis._pRenderer._iBackgroundG = ((value >> 8) & 0xff)/0xff;\n\t\tthis._pRenderer._iBackgroundB = (value & 0xff)/0xff;\n\t}\n\n\t/**\n\t *\n\t * @returns {number}\n\t */\n\tpublic get backgroundAlpha():number\n\t{\n\t\treturn this._backgroundAlpha;\n\t}\n\n\t/**\n\t *\n\t * @param value\n\t */\n\tpublic set backgroundAlpha(value:number)\n\t{\n\t\tif (value > 1)\n\t\t\tvalue = 1;\n\t\telse if (value < 0)\n\t\t\tvalue = 0;\n\n\t\tif (this._backgroundAlpha == value)\n\t\t\treturn;\n\n\t\tthis._pRenderer._iBackgroundAlpha = this._backgroundAlpha = value;\n\t}\n\n\t/**\n\t *\n\t * @returns {Camera3D}\n\t */\n\tpublic get camera():Camera\n\t{\n\t\treturn this._pCamera;\n\t}\n\n\t/**\n\t * Set camera that's used to render the scene for this viewport\n\t */\n\tpublic set camera(value:Camera)\n\t{\n\t\tif (this._pCamera == value)\n\t\t\treturn;\n\n\t\tif (this._pCamera)\n\t\t\tthis._pCamera.removeEventListener(CameraEvent.PROJECTION_CHANGED, this._onProjectionChangedDelegate);\n\n\t\tthis._pCamera = value;\n\n\t\tif (this._pEntityCollector)\n\t\t\tthis._pEntityCollector.camera = this._pCamera;\n\n\t\tif (this._pScene)\n\t\t\tthis._pScene.partition._iRegisterCamera(this._pCamera);\n\n\t\tthis._pCamera.addEventListener(CameraEvent.PROJECTION_CHANGED, this._onProjectionChangedDelegate);\n\t\tthis._scissorDirty = true;\n\t\tthis._viewportDirty = true;\n\t}\n\n\t/**\n\t *\n\t * @returns {away.containers.Scene3D}\n\t */\n\tpublic get scene():Scene\n\t{\n\t\treturn this._pScene;\n\t}\n\n\t/**\n\t * Set the scene that's used to render for this viewport\n\t */\n\tpublic set scene(value:Scene)\n\t{\n\t\tif (this._pScene == value)\n\t\t\treturn;\n\n\t\tif (this._pScene)\n\t\t\tthis._pScene.removeEventListener(SceneEvent.PARTITION_CHANGED, this._onScenePartitionChangedDelegate);\n\n\t\tthis._pScene = value;\n\n\t\tthis._pScene.addEventListener(SceneEvent.PARTITION_CHANGED, this._onScenePartitionChangedDelegate);\n\n\t\tif (this._pCamera)\n\t\t\tthis._pScene.partition._iRegisterCamera(this._pCamera);\n\t}\n\n\t/**\n\t *\n\t * @returns {number}\n\t */\n\tpublic get deltaTime():number\n\t{\n\t\treturn this._deltaTime;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get width():number\n\t{\n\t\treturn this._width;\n\t}\n\n\tpublic set width(value:number)\n\t{\n\t\tif (this._width == value)\n\t\t\treturn;\n\n\t\tthis._width = value;\n\t\tthis._aspectRatio = this._width/this._height;\n\t\tthis._pCamera.projection._iAspectRatio = this._aspectRatio;\n\t\tthis._pRenderer.width = value;\n\t\tthis._htmlElement.style.width = value + \"px\";\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get height():number\n\t{\n\t\treturn this._height;\n\t}\n\n\tpublic set height(value:number)\n\t{\n\t\tif (this._height == value)\n\t\t\treturn;\n\n\t\tthis._height = value;\n\t\tthis._aspectRatio = this._width/this._height;\n\t\tthis._pCamera.projection._iAspectRatio = this._aspectRatio;\n\t\tthis._pRenderer.height = value;\n\t\tthis._htmlElement.style.height = value + \"px\";\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get mousePicker():IPicker\n\t{\n\t\treturn this._mousePicker;\n\t}\n\n\tpublic set mousePicker(value:IPicker)\n\t{\n\t\tif (this._mousePicker == value)\n\t\t\treturn;\n\n\t\tif (value == null)\n\t\t\tthis._mousePicker = new RaycastPicker();\n\t\telse\n\t\t\tthis._mousePicker = value;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get x():number\n\t{\n\t\treturn this._pRenderer.x;\n\t}\n\n\tpublic set x(value:number)\n\t{\n\t\tif (this._pRenderer.x == value)\n\t\t\treturn;\n\n\t\tthis._pRenderer.x == value;\n\t\tthis._htmlElement.style.left = value + \"px\";\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get y():number\n\t{\n\t\treturn this._pRenderer.y;\n\t}\n\n\tpublic set y(value:number)\n\t{\n\t\tif (this._pRenderer.y == value)\n\t\t\treturn;\n\n\t\tthis._pRenderer.y == value;\n\t\tthis._htmlElement.style.top = value + \"px\";\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get visible():boolean\n\t{\n\t\treturn (this._htmlElement.style.visibility == \"visible\");\n\t}\n\n\tpublic set visible(value:boolean)\n\t{\n\t\tthis._htmlElement.style.visibility = value? \"visible\" : \"hidden\";\n\t\t//TODO transfer visible property to associated context (if one exists)\n\t}\n\n\t/**\n\t *\n\t * @returns {number}\n\t */\n\tpublic get renderedFacesCount():number\n\t{\n\t\treturn 0; //TODO\n\t\t//return this._pEntityCollector._pNumTriangles;//numTriangles;\n\t}\n\n\t/**\n\t * Renders the view.\n\t */\n\tpublic render()\n\t{\n\t\tthis.pUpdateTime();\n\n\t\t//update view and size data\n\t\tthis._pCamera.projection._iAspectRatio = this._aspectRatio;\n\n\t\tif (this._scissorDirty) {\n\t\t\tthis._scissorDirty = false;\n\t\t\tthis._pCamera.projection._iUpdateScissorRect(this._pRenderer.scissorRect.x, this._pRenderer.scissorRect.y, this._pRenderer.scissorRect.width, this._pRenderer.scissorRect.height);\n\t\t}\n\n\t\tif (this._viewportDirty) {\n\t\t\tthis._viewportDirty = false;\n\t\t\tthis._pCamera.projection._iUpdateViewport(this._pRenderer.viewPort.x, this._pRenderer.viewPort.y, this._pRenderer.viewPort.width, this._pRenderer.viewPort.height);\n\t\t}\n\n\t\t// update picking\n\t\tif (!this._shareContext) {\n\t\t\tif (this.forceMouseMove && this._htmlElement == this._mouseManager._iActiveDiv && !this._mouseManager._iUpdateDirty)\n\t\t\t\tthis._mouseManager._iCollidingObject = this.mousePicker.getViewCollision(this._pMouseX, this._pMouseY, this);\n\n\t\t\tthis._mouseManager.fireMouseEvents(this.forceMouseMove);\n\t\t\t//_touch3DManager.fireTouchEvents();\n\t\t}\n\t\t//_touch3DManager.updateCollider();\n\n\t\t//clear entity collector ready for collection\n\t\tthis._pEntityCollector.clear();\n\n\t\t// collect stuff to render\n\t\tthis._pScene.traversePartitions(this._pEntityCollector);\n\n\t\t//render the contents of the entity collector\n\t\tthis._pRenderer.render(this._pEntityCollector);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic pUpdateTime():void\n\t{\n\t\tvar time:number = getTimer();\n\n\t\tif (this._time == 0)\n\t\t\tthis._time = time;\n\n\t\tthis._deltaTime = time - this._time;\n\t\tthis._time = time;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._pRenderer.dispose();\n\n\t\t// TODO: imeplement mouseManager / touch3DManager\n\t\tthis._mouseManager.unregisterView(this);\n\n\t\t//this._touch3DManager.disableTouchListeners(this);\n\t\t//this._touch3DManager.dispose();\n\n\t\tthis._mouseManager = null;\n\t\t//this._touch3DManager = null;\n\n\t\tthis._pRenderer = null;\n\t\tthis._pEntityCollector = null;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get iEntityCollector():CollectorBase\n\t{\n\t\treturn this._pEntityCollector;\n\t}\n\n\t/**\n\t *\n\t */\n\tprivate onProjectionChanged(event:CameraEvent)\n\t{\n\t\tthis._scissorDirty = true;\n\t\tthis._viewportDirty = true;\n\t}\n\n\t/**\n\t *\n\t */\n\tprivate onViewportUpdated(event:RendererEvent)\n\t{\n\t\tthis._viewportDirty = true;\n\t}\n\n\t/**\n\t *\n\t */\n\tprivate onScissorUpdated(event:RendererEvent)\n\t{\n\t\tthis._scissorDirty = true;\n\t}\n\n\tpublic project(point3d:Vector3D):Vector3D\n\t{\n\t\tvar v:Vector3D = this._pCamera.project(point3d);\n\t\tv.x = v.x*this._pRenderer.viewPort.width/2 + this._width*this._pCamera.projection.originX;\n\t\tv.y = v.y*this._pRenderer.viewPort.height/2 + this._height*this._pCamera.projection.originY;\n\n\t\treturn v;\n\t}\n\n\tpublic unproject(sX:number, sY:number, sZ:number):Vector3D\n\t{\n\t\treturn this._pCamera.unproject(2*(sX - this._width*this._pCamera.projection.originX)/this._pRenderer.viewPort.width, 2*(sY - this._height*this._pCamera.projection.originY)/this._pRenderer.viewPort.height, sZ);\n\n\t}\n\n\tpublic getRay(sX:number, sY:number, sZ:number):Vector3D\n\t{\n\t\treturn this._pCamera.getRay((sX*2 - this._width)/this._width, (sY*2 - this._height)/this._height, sZ);\n\t}\n\n\t/* TODO: implement Touch3DManager\n\t public get touchPicker():IPicker\n\t {\n\t return this._touch3DManager.touchPicker;\n\t }\n\t */\n\t/* TODO: implement Touch3DManager\n\t public set touchPicker( value:IPicker)\n\t {\n\t this._touch3DManager.touchPicker = value;\n\t }\n\t */\n\n\tpublic forceMouseMove:boolean;\n\n\t/*TODO: implement Background\n\t public get background():away.textures.Texture2DBase\n\t {\n\t return this._background;\n\t }\n\t */\n\t/*TODO: implement Background\n\t public set background( value:away.textures.Texture2DBase )\n\t {\n\t this._background = value;\n\t this._renderer.background = _background;\n\t }\n\t */\n\n\t// TODO: required dependency stageGL\n\tpublic updateCollider()\n\t{\n\t\tif (!this._shareContext) {\n\t\t\tif (this._htmlElement == this._mouseManager._iActiveDiv)\n\t\t\t\tthis._mouseManager._iCollidingObject = this.mousePicker.getViewCollision(this._pMouseX, this._pMouseY, this);\n\t\t} else {\n\t\t\tvar collidingObject:PickingCollisionVO = this.mousePicker.getViewCollision(this._pMouseX, this._pMouseY, this);\n\n\t\t\tif (this.layeredView || this._mouseManager._iCollidingObject == null || collidingObject.rayEntryDistance < this._mouseManager._iCollidingObject.rayEntryDistance)\n\t\t\t\tthis._mouseManager._iCollidingObject = collidingObject;\n\t\t}\n\t}\n}\n\nexport = View;","import AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nimport DisplayObject\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\n\nclass ControllerBase\n{\n\n\tpublic _pAutoUpdate:boolean = true;\n\tpublic _pTargetObject:DisplayObject;\n\n\tconstructor(targetObject:DisplayObject = null)\n\t{\n\t\tthis.targetObject = targetObject;\n\t}\n\n\tpublic pNotifyUpdate()\n\t{\n\t\tif (this._pTargetObject && this._pAutoUpdate) {\n\t\t\tthis._pTargetObject.invalidatePartition();\n\t\t}\n\t}\n\n\tpublic get targetObject():DisplayObject\n\t{\n\t\treturn this._pTargetObject;\n\t}\n\n\tpublic set targetObject(val:DisplayObject)\n\t{\n\t\tif (this._pTargetObject == val) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._pTargetObject && this._pAutoUpdate) {\n\t\t\tthis._pTargetObject._iController = null;\n\t\t}\n\t\tthis._pTargetObject = val;\n\n\t\tif (this._pTargetObject && this._pAutoUpdate) {\n\t\t\tthis._pTargetObject._iController = this;\n\t\t}\n\t\tthis.pNotifyUpdate();\n\t}\n\n\tpublic get autoUpdate():boolean\n\t{\n\t\treturn this._pAutoUpdate;\n\t}\n\n\tpublic set autoUpdate(val:boolean)\n\t{\n\t\tif (this._pAutoUpdate == val) {\n\t\t\treturn;\n\t\t}\n\t\tthis._pAutoUpdate = val;\n\n\t\tif (this._pTargetObject) {\n\t\t\tif (this._pTargetObject) {\n\t\t\t\tthis._pTargetObject._iController = this;\n\t\t\t} else {\n\t\t\t\tthis._pTargetObject._iController = null;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic update(interpolate:boolean = true)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n}\n\nexport = ControllerBase;","import MathConsts\t\t\t\t= require(\"awayjs-core/lib/geom/MathConsts\");\n\nimport ControllerBase\t\t\t= require(\"awayjs-display/lib/controllers/ControllerBase\");\nimport DisplayObject\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\n\n/**\n * Extended camera used to hover round a specified target object.\n *\n * @see    away3d.containers.View3D\n */\nclass FirstPersonController extends ControllerBase\n{\n\tpublic _iCurrentPanAngle:number = 0;\n\tpublic  _iCurrentTiltAngle:number = 90;\n\n\tprivate _panAngle:number = 0;\n\tprivate _tiltAngle:number = 90;\n\tprivate _minTiltAngle:number = -90;\n\tprivate _maxTiltAngle:number = 90;\n\tprivate _steps:number = 8;\n\tprivate _walkIncrement:number = 0;\n\tprivate _strafeIncrement:number = 0;\n\tprivate _wrapPanAngle:boolean = false;\n\n\tpublic fly:boolean = false;\n\n\t/**\n\t * Fractional step taken each time the <code>hover()</code> method is called. Defaults to 8.\n\t *\n\t * Affects the speed at which the <code>tiltAngle</code> and <code>panAngle</code> resolve to their targets.\n\t *\n\t * @see    #tiltAngle\n\t * @see    #panAngle\n\t */\n\tpublic get steps():number\n\t{\n\t\treturn this._steps;\n\t}\n\n\tpublic set steps(val:number)\n\t{\n\t\tval = (val < 1)? 1 : val;\n\n\t\tif (this._steps == val)\n\t\t\treturn;\n\n\t\tthis._steps = val;\n\n\t\tthis.pNotifyUpdate();\n\t}\n\n\t/**\n\t * Rotation of the camera in degrees around the y axis. Defaults to 0.\n\t */\n\tpublic get panAngle():number\n\t{\n\t\treturn this._panAngle;\n\t}\n\n\tpublic set panAngle(val:number)\n\t{\n\t\tif (this._panAngle == val)\n\t\t\treturn;\n\n\t\tthis._panAngle = val;\n\n\t\tthis.pNotifyUpdate();\n\t}\n\n\t/**\n\t * Elevation angle of the camera in degrees. Defaults to 90.\n\t */\n\tpublic get tiltAngle():number\n\t{\n\t\treturn this._tiltAngle;\n\t}\n\n\tpublic set tiltAngle(val:number)\n\t{\n\t\tval = Math.max(this._minTiltAngle, Math.min(this._maxTiltAngle, val));\n\n\t\tif (this._tiltAngle == val)\n\t\t\treturn;\n\n\t\tthis._tiltAngle = val;\n\n\t\tthis.pNotifyUpdate();\n\t}\n\n\t/**\n\t * Minimum bounds for the <code>tiltAngle</code>. Defaults to -90.\n\t *\n\t * @see    #tiltAngle\n\t */\n\tpublic get minTiltAngle():number\n\t{\n\t\treturn this._minTiltAngle;\n\t}\n\n\tpublic set minTiltAngle(val:number)\n\t{\n\t\tif (this._minTiltAngle == val)\n\t\t\treturn;\n\n\t\tthis._minTiltAngle = val;\n\n\t\tthis.tiltAngle = Math.max(this._minTiltAngle, Math.min(this._maxTiltAngle, this._tiltAngle));\n\t}\n\n\t/**\n\t * Maximum bounds for the <code>tiltAngle</code>. Defaults to 90.\n\t *\n\t * @see    #tiltAngle\n\t */\n\tpublic get maxTiltAngle():number\n\t{\n\t\treturn this._maxTiltAngle;\n\t}\n\n\tpublic set maxTiltAngle(val:number)\n\t{\n\t\tif (this._maxTiltAngle == val)\n\t\t\treturn;\n\n\t\tthis._maxTiltAngle = val;\n\n\t\tthis.tiltAngle = Math.max(this._minTiltAngle, Math.min(this._maxTiltAngle, this._tiltAngle));\n\t}\n\n\n\t/**\n\t * Defines whether the value of the pan angle wraps when over 360 degrees or under 0 degrees. Defaults to false.\n\t */\n\tpublic get wrapPanAngle():boolean\n\t{\n\t\treturn this._wrapPanAngle;\n\t}\n\n\tpublic set wrapPanAngle(val:boolean)\n\t{\n\t\tif (this._wrapPanAngle == val)\n\t\t\treturn;\n\n\t\tthis._wrapPanAngle = val;\n\n\t\tthis.pNotifyUpdate();\n\t}\n\n\t/**\n\t * Creates a new <code>HoverController</code> object.\n\t */\n\tconstructor(targetObject:DisplayObject = null, panAngle:number = 0, tiltAngle:number = 90, minTiltAngle:number = -90, maxTiltAngle:number = 90, steps:number = 8, wrapPanAngle:boolean = false)\n\t{\n\t\tsuper(targetObject);\n\n\t\tthis.panAngle = panAngle;\n\t\tthis.tiltAngle = tiltAngle;\n\t\tthis.minTiltAngle = minTiltAngle;\n\t\tthis.maxTiltAngle = maxTiltAngle;\n\t\tthis.steps = steps;\n\t\tthis.wrapPanAngle = wrapPanAngle;\n\n\t\t//values passed in contrustor are applied immediately\n\t\tthis._iCurrentPanAngle = this._panAngle;\n\t\tthis._iCurrentTiltAngle = this._tiltAngle;\n\t}\n\n\t/**\n\t * Updates the current tilt angle and pan angle values.\n\t *\n\t * Values are calculated using the defined <code>tiltAngle</code>, <code>panAngle</code> and <code>steps</code> variables.\n\t *\n\t * @param interpolate   If the update to a target pan- or tiltAngle is interpolated. Default is true.\n\t *\n\t * @see    #tiltAngle\n\t * @see    #panAngle\n\t * @see    #steps\n\t */\n\tpublic update(interpolate:boolean = true)\n\t{\n\t\tif (this._tiltAngle != this._iCurrentTiltAngle || this._panAngle != this._iCurrentPanAngle) {\n\n\t\t\tthis.pNotifyUpdate();\n\n\t\t\tif (this._wrapPanAngle) {\n\t\t\t\tif (this._panAngle < 0) {\n\t\t\t\t\tthis._iCurrentPanAngle += this._panAngle%360 + 360 - this._panAngle;\n\t\t\t\t\tthis._panAngle = this._panAngle%360 + 360;\n\t\t\t\t} else {\n\t\t\t\t\tthis._iCurrentPanAngle += this._panAngle%360 - this._panAngle;\n\t\t\t\t\tthis._panAngle = this._panAngle%360;\n\t\t\t\t}\n\n\t\t\t\twhile (this._panAngle - this._iCurrentPanAngle < -180)\n\t\t\t\t\tthis._iCurrentPanAngle -= 360;\n\n\t\t\t\twhile (this._panAngle - this._iCurrentPanAngle > 180)\n\t\t\t\t\tthis._iCurrentPanAngle += 360;\n\t\t\t}\n\n\t\t\tif (interpolate) {\n\t\t\t\tthis._iCurrentTiltAngle += (this._tiltAngle - this._iCurrentTiltAngle)/(this.steps + 1);\n\t\t\t\tthis._iCurrentPanAngle += (this._panAngle - this._iCurrentPanAngle)/(this.steps + 1);\n\t\t\t} else {\n\t\t\t\tthis._iCurrentTiltAngle = this._tiltAngle;\n\t\t\t\tthis._iCurrentPanAngle = this._panAngle;\n\t\t\t}\n\n\t\t\t//snap coords if angle differences are close\n\t\t\tif ((Math.abs(this.tiltAngle - this._iCurrentTiltAngle) < 0.01) && (Math.abs(this._panAngle - this._iCurrentPanAngle) < 0.01)) {\n\t\t\t\tthis._iCurrentTiltAngle = this._tiltAngle;\n\t\t\t\tthis._iCurrentPanAngle = this._panAngle;\n\t\t\t}\n\t\t}\n\n\t\tthis.targetObject.rotationX = this._iCurrentTiltAngle;\n\t\tthis.targetObject.rotationY = this._iCurrentPanAngle;\n\n\t\tif (this._walkIncrement) {\n\t\t\tif (this.fly) {\n\t\t\t\tthis.targetObject.transform.moveForward(this._walkIncrement);\n\t\t\t} else {\n\t\t\t\tthis.targetObject.x += this._walkIncrement*Math.sin(this._panAngle*MathConsts.DEGREES_TO_RADIANS);\n\t\t\t\tthis.targetObject.z += this._walkIncrement*Math.cos(this._panAngle*MathConsts.DEGREES_TO_RADIANS);\n\t\t\t}\n\t\t\tthis._walkIncrement = 0;\n\t\t}\n\n\t\tif (this._strafeIncrement) {\n\t\t\tthis.targetObject.transform.moveRight(this._strafeIncrement);\n\t\t\tthis._strafeIncrement = 0;\n\t\t}\n\n\t}\n\n\tpublic incrementWalk(val:number)\n\t{\n\t\tif (val == 0)\n\t\t\treturn;\n\n\t\tthis._walkIncrement += val;\n\n\t\tthis.pNotifyUpdate();\n\t}\n\n\tpublic incrementStrafe(val:number)\n\t{\n\t\tif (val == 0)\n\t\t\treturn;\n\n\t\tthis._strafeIncrement += val;\n\n\t\tthis.pNotifyUpdate();\n\t}\n\n}\n\nexport = FirstPersonController;","import DisplayObject\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport HoverController\t\t\t= require(\"awayjs-display/lib/controllers/HoverController\");\n\n/**\n * Controller used to follow behind an object on the XZ plane, with an optional\n * elevation (tiltAngle).\n *\n * @see    away3d.containers.View3D\n */\nclass FollowController extends HoverController\n{\n\tconstructor(targetObject:DisplayObject = null, lookAtObject:DisplayObject = null, tiltAngle:number = 45, distance:number = 700)\n\t{\n\t\tsuper(targetObject, lookAtObject, 0, tiltAngle, distance);\n\t}\n\n\tpublic update(interpolate:boolean = true)\n\t{\n\t\tinterpolate = interpolate; // unused: prevents warning\n\n\t\tif (!this.lookAtObject)\n\t\t\treturn;\n\n\t\tthis.panAngle = this._pLookAtObject.rotationY - 180;\n\t\tsuper.update();\n\t}\n}\n\nexport = FollowController;","import MathConsts\t\t\t\t= require(\"awayjs-core/lib/geom/MathConsts\");\nimport Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport DisplayObject\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport LookAtController\t\t\t= require(\"awayjs-display/lib/controllers/LookAtController\");\n\n/**\n * Extended camera used to hover round a specified target object.\n *\n * @see    away.containers.View\n */\nclass HoverController extends LookAtController\n{\n\tpublic _iCurrentPanAngle:number = 0;\n\tpublic _iCurrentTiltAngle:number = 90;\n\n\tprivate _panAngle:number = 0;\n\tprivate _tiltAngle:number = 90;\n\tprivate _distance:number = 1000;\n\tprivate _minPanAngle:number = -Infinity;\n\tprivate _maxPanAngle:number = Infinity;\n\tprivate _minTiltAngle:number = -90;\n\tprivate _maxTiltAngle:number = 90;\n\tprivate _steps:number = 8;\n\tprivate _yFactor:number = 2;\n\tprivate _wrapPanAngle:boolean = false;\n\tprivate _upAxis:Vector3D = new Vector3D();\n\n\t/**\n\t * Fractional step taken each time the <code>hover()</code> method is called. Defaults to 8.\n\t *\n\t * Affects the speed at which the <code>tiltAngle</code> and <code>panAngle</code> resolve to their targets.\n\t *\n\t * @see    #tiltAngle\n\t * @see    #panAngle\n\t */\n\tpublic get steps():number\n\t{\n\t\treturn this._steps;\n\t}\n\n\tpublic set steps(val:number)\n\t{\n\t\tval = (val < 1)? 1 : val;\n\n\t\tif (this._steps == val)\n\t\t\treturn;\n\n\t\tthis._steps = val;\n\n\t\tthis.pNotifyUpdate();\n\t}\n\n\t/**\n\t * Rotation of the camera in degrees around the y axis. Defaults to 0.\n\t */\n\tpublic get panAngle():number\n\t{\n\t\treturn this._panAngle;\n\t}\n\n\tpublic set panAngle(val:number)\n\t{\n\t\tval = Math.max(this._minPanAngle, Math.min(this._maxPanAngle, val));\n\n\t\tif (this._panAngle == val)\n\t\t\treturn;\n\n\t\tthis._panAngle = val;\n\n\t\tthis.pNotifyUpdate();\n\t}\n\n\t/**\n\t * Elevation angle of the camera in degrees. Defaults to 90.\n\t */\n\tpublic get tiltAngle():number\n\t{\n\t\treturn this._tiltAngle;\n\t}\n\n\tpublic set tiltAngle(val:number)\n\t{\n\t\tval = Math.max(this._minTiltAngle, Math.min(this._maxTiltAngle, val));\n\n\t\tif (this._tiltAngle == val)\n\t\t\treturn;\n\n\t\tthis._tiltAngle = val;\n\n\t\tthis.pNotifyUpdate();\n\t}\n\n\t/**\n\t * Distance between the camera and the specified target. Defaults to 1000.\n\t */\n\tpublic get distance():number\n\t{\n\t\treturn this._distance;\n\t}\n\n\tpublic set distance(val:number)\n\t{\n\t\tif (this._distance == val)\n\t\t\treturn;\n\n\t\tthis._distance = val;\n\n\t\tthis.pNotifyUpdate();\n\t}\n\n\t/**\n\t * Minimum bounds for the <code>panAngle</code>. Defaults to -Infinity.\n\t *\n\t * @see    #panAngle\n\t */\n\tpublic get minPanAngle():number\n\t{\n\t\treturn this._minPanAngle;\n\t}\n\n\tpublic set minPanAngle(val:number)\n\t{\n\t\tif (this._minPanAngle == val)\n\t\t\treturn;\n\n\t\tthis._minPanAngle = val;\n\n\t\tthis.panAngle = Math.max(this._minPanAngle, Math.min(this._maxPanAngle, this._panAngle));\n\t}\n\n\t/**\n\t * Maximum bounds for the <code>panAngle</code>. Defaults to Infinity.\n\t *\n\t * @see    #panAngle\n\t */\n\tpublic get maxPanAngle():number\n\t{\n\t\treturn this._maxPanAngle;\n\t}\n\n\tpublic set maxPanAngle(val:number)\n\t{\n\t\tif (this._maxPanAngle == val)\n\t\t\treturn;\n\n\t\tthis._maxPanAngle = val;\n\n\t\tthis.panAngle = Math.max(this._minPanAngle, Math.min(this._maxPanAngle, this._panAngle));\n\t}\n\n\t/**\n\t * Minimum bounds for the <code>tiltAngle</code>. Defaults to -90.\n\t *\n\t * @see    #tiltAngle\n\t */\n\tpublic get minTiltAngle():number\n\t{\n\t\treturn this._minTiltAngle;\n\t}\n\n\tpublic set minTiltAngle(val:number)\n\t{\n\t\tif (this._minTiltAngle == val)\n\t\t\treturn;\n\n\t\tthis._minTiltAngle = val;\n\n\t\tthis.tiltAngle = Math.max(this._minTiltAngle, Math.min(this._maxTiltAngle, this._tiltAngle));\n\t}\n\n\t/**\n\t * Maximum bounds for the <code>tiltAngle</code>. Defaults to 90.\n\t *\n\t * @see    #tiltAngle\n\t */\n\tpublic get maxTiltAngle():number\n\t{\n\t\treturn this._maxTiltAngle;\n\t}\n\n\tpublic set maxTiltAngle(val:number)\n\t{\n\t\tif (this._maxTiltAngle == val)\n\t\t\treturn;\n\n\t\tthis._maxTiltAngle = val;\n\n\t\tthis.tiltAngle = Math.max(this._minTiltAngle, Math.min(this._maxTiltAngle, this._tiltAngle));\n\t}\n\n\t/**\n\t * Fractional difference in distance between the horizontal camera orientation and vertical camera orientation. Defaults to 2.\n\t *\n\t * @see    #distance\n\t */\n\tpublic get yFactor():number\n\t{\n\t\treturn this._yFactor;\n\t}\n\n\tpublic set yFactor(val:number)\n\t{\n\t\tif (this._yFactor == val)\n\t\t\treturn;\n\n\t\tthis._yFactor = val;\n\n\t\tthis.pNotifyUpdate();\n\t}\n\n\t/**\n\t * Defines whether the value of the pan angle wraps when over 360 degrees or under 0 degrees. Defaults to false.\n\t */\n\tpublic get wrapPanAngle():boolean\n\t{\n\t\treturn this._wrapPanAngle;\n\t}\n\n\tpublic set wrapPanAngle(val:boolean)\n\t{\n\t\tif (this._wrapPanAngle == val)\n\t\t\treturn;\n\n\t\tthis._wrapPanAngle = val;\n\n\t\tthis.pNotifyUpdate();\n\t}\n\n\t/**\n\t * Creates a new <code>HoverController</code> object.\n\t */\n\tconstructor(targetObject:DisplayObject = null, lookAtObject:DisplayObject = null, panAngle:number = 0, tiltAngle:number = 90, distance:number = 1000, minTiltAngle:number = -90, maxTiltAngle:number = 90, minPanAngle:number = null, maxPanAngle:number = null, steps:number = 8, yFactor:number = 2, wrapPanAngle:boolean = false)\n\t{\n\t\tsuper(targetObject, lookAtObject);\n\n\t\tthis.distance = distance;\n\t\tthis.panAngle = panAngle;\n\t\tthis.tiltAngle = tiltAngle;\n\t\tthis.minPanAngle = ( minPanAngle != null )? minPanAngle : -Infinity;\n\t\tthis.maxPanAngle = ( maxPanAngle != null )? maxPanAngle : Infinity;\n\t\tthis.minTiltAngle = minTiltAngle;\n\t\tthis.maxTiltAngle = maxTiltAngle;\n\t\tthis.steps = steps;\n\t\tthis.yFactor = yFactor;\n\t\tthis.wrapPanAngle = wrapPanAngle;\n\n\t\t//values passed in contrustor are applied immediately\n\t\tthis._iCurrentPanAngle = this._panAngle;\n\t\tthis._iCurrentTiltAngle = this._tiltAngle;\n\t}\n\n\t/**\n\t * Updates the current tilt angle and pan angle values.\n\t *\n\t * Values are calculated using the defined <code>tiltAngle</code>, <code>panAngle</code> and <code>steps</code> variables.\n\t *\n\t * @param interpolate   If the update to a target pan- or tiltAngle is interpolated. Default is true.\n\t *\n\t * @see    #tiltAngle\n\t * @see    #panAngle\n\t * @see    #steps\n\t */\n\tpublic update(interpolate:boolean = true)\n\t{\n\t\tif (this._tiltAngle != this._iCurrentTiltAngle || this._panAngle != this._iCurrentPanAngle) {\n\n\t\t\tthis.pNotifyUpdate();\n\n\t\t\tif (this._wrapPanAngle) {\n\t\t\t\tif (this._panAngle < 0) {\n\t\t\t\t\tthis._iCurrentPanAngle += this._panAngle%360 + 360 - this._panAngle;\n\t\t\t\t\tthis._panAngle = this._panAngle%360 + 360;\n\t\t\t\t} else {\n\t\t\t\t\tthis._iCurrentPanAngle += this._panAngle%360 - this._panAngle;\n\t\t\t\t\tthis._panAngle = this._panAngle%360;\n\t\t\t\t}\n\n\t\t\t\twhile (this._panAngle - this._iCurrentPanAngle < -180)\n\t\t\t\t\tthis._iCurrentPanAngle -= 360;\n\n\t\t\t\twhile (this._panAngle - this._iCurrentPanAngle > 180)\n\t\t\t\t\tthis._iCurrentPanAngle += 360;\n\t\t\t}\n\n\t\t\tif (interpolate) {\n\t\t\t\tthis._iCurrentTiltAngle += (this._tiltAngle - this._iCurrentTiltAngle)/(this.steps + 1);\n\t\t\t\tthis._iCurrentPanAngle += (this._panAngle - this._iCurrentPanAngle)/(this.steps + 1);\n\t\t\t} else {\n\t\t\t\tthis._iCurrentPanAngle = this._panAngle;\n\t\t\t\tthis._iCurrentTiltAngle = this._tiltAngle;\n\t\t\t}\n\n\t\t\t//snap coords if angle differences are close\n\t\t\tif ((Math.abs(this.tiltAngle - this._iCurrentTiltAngle) < 0.01) && (Math.abs(this._panAngle - this._iCurrentPanAngle) < 0.01)) {\n\t\t\t\tthis._iCurrentTiltAngle = this._tiltAngle;\n\t\t\t\tthis._iCurrentPanAngle = this._panAngle;\n\t\t\t}\n\t\t}\n\n\t\tvar pos:Vector3D = (this.lookAtObject)? this.lookAtObject.transform.position : (this.lookAtPosition)? this.lookAtPosition : this._pOrigin;\n\t\tthis.targetObject.x = pos.x + this.distance*Math.sin(this._iCurrentPanAngle*MathConsts.DEGREES_TO_RADIANS)*Math.cos(this._iCurrentTiltAngle*MathConsts.DEGREES_TO_RADIANS);\n\t\tthis.targetObject.y = pos.y + this.distance*Math.sin(this._iCurrentTiltAngle*MathConsts.DEGREES_TO_RADIANS)*this.yFactor;\n\t\tthis.targetObject.z = pos.z + this.distance*Math.cos(this._iCurrentPanAngle*MathConsts.DEGREES_TO_RADIANS)*Math.cos(this._iCurrentTiltAngle*MathConsts.DEGREES_TO_RADIANS);\n\n\t\tthis._upAxis.x = -Math.sin(this._iCurrentPanAngle*MathConsts.DEGREES_TO_RADIANS)*Math.sin(this._iCurrentTiltAngle*MathConsts.DEGREES_TO_RADIANS);\n\t\tthis._upAxis.y = Math.cos(this._iCurrentTiltAngle*MathConsts.DEGREES_TO_RADIANS);\n\t\tthis._upAxis.z = -Math.cos(this._iCurrentPanAngle*MathConsts.DEGREES_TO_RADIANS)*Math.sin(this._iCurrentTiltAngle*MathConsts.DEGREES_TO_RADIANS);\n\n\t\tif (this._pTargetObject) {\n\t\t\tif (this._pLookAtPosition)\n\t\t\t\tthis._pTargetObject.lookAt(this._pLookAtPosition, this._upAxis);\n\t\t\telse if (this._pLookAtObject)\n\t\t\t\tthis._pTargetObject.lookAt(this._pLookAtObject.scene? this._pLookAtObject.scenePosition : this._pLookAtObject.transform.position, this._upAxis);\n\t\t}\n\t}\n}\n\nexport = HoverController;","import Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport DisplayObject\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport ControllerBase\t\t\t= require(\"awayjs-display/lib/controllers/ControllerBase\");\nimport DisplayObjectEvent\t\t= require(\"awayjs-display/lib/events/DisplayObjectEvent\");\n\nclass LookAtController extends ControllerBase\n{\n\tpublic _pLookAtPosition:Vector3D;\n\tpublic _pLookAtObject:DisplayObject;\n\tpublic _pOrigin:Vector3D = new Vector3D(0.0, 0.0, 0.0);\n\n\tprivate _onLookAtObjectChangedDelegate:(event:DisplayObjectEvent) => void;\n\n\tconstructor(targetObject:DisplayObject = null, lookAtObject:DisplayObject = null)\n\t{\n\t\tsuper(targetObject);\n\n\t\tthis._onLookAtObjectChangedDelegate = (event:DisplayObjectEvent) => this.onLookAtObjectChanged(event);\n\n\t\tif (lookAtObject)\n\t\t\tthis.lookAtObject = lookAtObject;\n\t\telse\n\t\t\tthis.lookAtPosition = new Vector3D();\n\t}\n\n\tpublic get lookAtPosition():Vector3D\n\t{\n\t\treturn this._pLookAtPosition;\n\t}\n\n\tpublic set lookAtPosition(val:Vector3D)\n\t{\n\t\tif (this._pLookAtObject) {\n\t\t\tthis._pLookAtObject.removeEventListener(DisplayObjectEvent.SCENETRANSFORM_CHANGED, this._onLookAtObjectChangedDelegate);\n\t\t\tthis._pLookAtObject = null;\n\t\t}\n\n\t\tthis._pLookAtPosition = val;\n\t\tthis.pNotifyUpdate();\n\t}\n\n\tpublic get lookAtObject():DisplayObject\n\t{\n\t\treturn this._pLookAtObject;\n\t}\n\n\tpublic set lookAtObject(val:DisplayObject)\n\t{\n\t\tif (this._pLookAtPosition)\n\t\t\tthis._pLookAtPosition = null;\n\n\t\tif (this._pLookAtObject == val)\n\t\t\treturn;\n\n\t\tif (this._pLookAtObject)\n\t\t\tthis._pLookAtObject.removeEventListener(DisplayObjectEvent.SCENETRANSFORM_CHANGED, this._onLookAtObjectChangedDelegate);\n\n\t\tthis._pLookAtObject = val;\n\n\t\tif (this._pLookAtObject)\n\t\t\tthis._pLookAtObject.addEventListener(DisplayObjectEvent.SCENETRANSFORM_CHANGED, this._onLookAtObjectChangedDelegate);\n\n\t\tthis.pNotifyUpdate();\n\t}\n\n\t//@override\n\tpublic update(interpolate:boolean = true)\n\t{\n\t\tif (this._pTargetObject) {\n\t\t\tif (this._pLookAtPosition)\n\t\t\t\tthis._pTargetObject.lookAt(this._pLookAtPosition);\n\t\t\telse if (this._pLookAtObject)\n\t\t\t\tthis._pTargetObject.lookAt(this._pLookAtObject.scene? this._pLookAtObject.scenePosition : this._pLookAtObject.transform.position);\n\t\t}\n\t}\n\n\tprivate onLookAtObjectChanged(event:DisplayObjectEvent)\n\t{\n\t\tthis.pNotifyUpdate();\n\t}\n}\n\nexport = LookAtController;","import Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport DisplayObject\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport LookAtController\t\t\t= require(\"awayjs-display/lib/controllers/LookAtController\");\n\n/**\n * Uses spring physics to animate the target object towards a position that is\n * defined as the lookAtTarget object's position plus the vector defined by the\n * positionOffset property.\n */\nclass SpringController extends LookAtController\n{\n\tprivate _velocity:Vector3D;\n\tprivate _dv:Vector3D;\n\tprivate _stretch:Vector3D;\n\tprivate _force:Vector3D;\n\tprivate _acceleration:Vector3D;\n\tprivate _desiredPosition:Vector3D;\n\n\t/**\n\t * Stiffness of the spring, how hard is it to extend. The higher it is, the more \"fixed\" the cam will be.\n\t * A number between 1 and 20 is recommended.\n\t */\n\tpublic stiffness:number;\n\n\t/**\n\t * Damping is the spring internal friction, or how much it resists the \"boinggggg\" effect. Too high and you'll lose it!\n\t * A number between 1 and 20 is recommended.\n\t */\n\tpublic damping:number;\n\n\t/**\n\t * Mass of the camera, if over 120 and it'll be very heavy to move.\n\t */\n\tpublic mass:number;\n\n\t/**\n\t * Offset of spring center from target in target object space, ie: Where the camera should ideally be in the target object space.\n\t */\n\tpublic positionOffset:Vector3D = new Vector3D(0, 500, -1000);\n\n\tconstructor(targetObject:DisplayObject = null, lookAtObject:DisplayObject = null, stiffness:number = 1, mass:number = 40, damping:number = 4)\n\t{\n\t\tsuper(targetObject, lookAtObject);\n\n\t\tthis.stiffness = stiffness;\n\t\tthis.damping = damping;\n\t\tthis.mass = mass;\n\n\t\tthis._velocity = new Vector3D();\n\t\tthis._dv = new Vector3D();\n\t\tthis._stretch = new Vector3D();\n\t\tthis._force = new Vector3D();\n\t\tthis._acceleration = new Vector3D();\n\t\tthis._desiredPosition = new Vector3D();\n\n\t}\n\n\tpublic update(interpolate:boolean = true)\n\t{\n\t\tvar offs:Vector3D;\n\n\t\tif (!this._pLookAtObject || !this._pTargetObject)\n\t\t\treturn;\n\n\t\toffs = this._pLookAtObject.transform.matrix3D.deltaTransformVector(this.positionOffset);\n\t\tthis._desiredPosition.x = this._pLookAtObject.x + offs.x;\n\t\tthis._desiredPosition.y = this._pLookAtObject.y + offs.y;\n\t\tthis._desiredPosition.z = this._pLookAtObject.z + offs.z;\n\n\t\tthis._stretch = this._pTargetObject.transform.position.add(this._desiredPosition);\n\t\tthis._stretch.scaleBy(-this.stiffness);\n\n\t\tthis._dv.copyFrom(this._velocity);\n\t\tthis._dv.scaleBy(this.damping);\n\n\t\tthis._force.x = this._stretch.x - this._dv.x;\n\t\tthis._force.y = this._stretch.y - this._dv.y;\n\t\tthis._force.z = this._stretch.z - this._dv.z;\n\n\t\tthis._acceleration.copyFrom(this._force);\n\t\tthis._acceleration.scaleBy(1/this.mass);\n\n\t\tthis._velocity.incrementBy(this._acceleration);\n\n\t\tthis._pTargetObject.transform.position = this._pTargetObject.transform.position.add(this._velocity);\n\n\t\tsuper.update();\n\t}\n}\n\nexport = SpringController;","class ContextMode\n{\n\tstatic AUTO:string = \"auto\";\n\tstatic WEBGL:string = \"webgl\";\n\tstatic FLASH:string = \"flash\";\n\tstatic NATIVE:string = \"native\";\n}\n\nexport = ContextMode;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport UVTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/UVTransform\");\nimport AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\n\nimport IAnimator\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimator\");\nimport DisplayObject\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\nimport BoundsType\t\t\t\t\t= require(\"awayjs-display/lib/bounds/BoundsType\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport EntityNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/EntityNode\");\nimport IRendererPool\t\t\t\t= require(\"awayjs-display/lib/pool/IRendererPool\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport MaterialEvent\t\t\t\t= require(\"awayjs-display/lib/events/MaterialEvent\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\n\n/**\n * The Billboard class represents display objects that represent bitmap images.\n * These can be images that you load with the <code>flash.Assets</code> or\n * <code>flash.display.Loader</code> classes, or they can be images that you\n * create with the <code>Billboard()</code> constructor.\n *\n * <p>The <code>Billboard()</code> constructor allows you to create a Billboard\n * object that contains a reference to a BitmapData object. After you create a\n * Billboard object, use the <code>addChild()</code> or <code>addChildAt()</code>\n * method of the parent DisplayObjectContainer instance to place the bitmap on\n * the display list.</p>\n *\n * <p>A Billboard object can share its BitmapData reference among several Billboard\n * objects, independent of translation or rotation properties. Because you can\n * create multiple Billboard objects that reference the same BitmapData object,\n * multiple display objects can use the same complex BitmapData object without\n * incurring the memory overhead of a BitmapData object for each display\n * object instance.</p>\n *\n * <p>A BitmapData object can be drawn to the screen by a Billboard object in one\n * of two ways: by using the default hardware renderer with a single hardware surface,\n * or by using the slower software renderer when 3D acceleration is not available.</p>\n *\n * <p>If you would prefer to perform a batch rendering command, rather than using a\n * single surface for each Billboard object, you can also draw to the screen using the\n * <code>drawTiles()</code> or <code>drawTriangles()</code> methods which are\n * available to <code>flash.display.Tilesheet</code> and <code>flash.display.Graphics\n * objects.</code></p>\n *\n * <p><b>Note:</b> The Billboard class is not a subclass of the InteractiveObject\n * class, so it cannot dispatch mouse events. However, you can use the\n * <code>addEventListener()</code> method of the display object container that\n * contains the Billboard object.</p>\n */\n\nclass Billboard extends DisplayObject implements IEntity, IRenderableOwner\n{\n\tprivate _animator:IAnimator;\n\tprivate _billboardWidth:number;\n\tprivate _billboardHeight:number;\n\tprivate _material:MaterialBase;\n\tprivate _uvTransform:UVTransform;\n\n\tprivate onSizeChangedDelegate:(event:MaterialEvent) => void;\n\n\t/**\n\t * Defines the animator of the mesh. Act on the mesh's geometry. Defaults to null\n\t */\n\tpublic get animator():IAnimator\n\t{\n\t\treturn this._animator;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.BILLBOARD;\n\t}\n\n\t/**\n\t * The BitmapData object being referenced.\n\t */\n\tpublic bitmapData:BitmapData; //TODO\n\n\t/**\n\t *\n\t */\n\tpublic get billboardHeight():number\n\t{\n\t\treturn this._billboardHeight;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get billboardWidth():number\n\t{\n\t\treturn this._billboardWidth;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get material():MaterialBase\n\t{\n\t\treturn this._material;\n\t}\n\n\tpublic set material(value:MaterialBase)\n\t{\n\t\tif (value == this._material)\n\t\t\treturn;\n\n\t\tif (this._material) {\n\t\t\tthis._material.iRemoveOwner(this);\n\t\t\tthis._material.removeEventListener(MaterialEvent.SIZE_CHANGED, this.onSizeChangedDelegate);\n\t\t}\n\n\n\t\tthis._material = value;\n\n\t\tif (this._material) {\n\t\t\tthis._material.iAddOwner(this);\n\t\t\tthis._material.addEventListener(MaterialEvent.SIZE_CHANGED, this.onSizeChangedDelegate);\n\t\t}\n\t}\n\n\t/**\n\t * Controls whether or not the Billboard object is snapped to the nearest pixel.\n\t * This value is ignored in the native and HTML5 targets.\n\t * The PixelSnapping class includes possible values:\n\t * <ul>\n\t *   <li><code>PixelSnapping.NEVER</code> - No pixel snapping occurs.</li>\n\t *   <li><code>PixelSnapping.ALWAYS</code> - The image is always snapped to\n\t * the nearest pixel, independent of transformation.</li>\n\t *   <li><code>PixelSnapping.AUTO</code> - The image is snapped to the\n\t * nearest pixel if it is drawn with no rotation or skew and it is drawn at a\n\t * scale factor of 99.9% to 100.1%. If these conditions are satisfied, the\n\t * bitmap image is drawn at 100% scale, snapped to the nearest pixel.\n\t * When targeting Flash Player, this value allows the image to be drawn as fast\n\t * as possible using the internal vector renderer.</li>\n\t * </ul>\n\t */\n\tpublic pixelSnapping:string; //TODO\n\n\t/**\n\t * Controls whether or not the bitmap is smoothed when scaled. If\n\t * <code>true</code>, the bitmap is smoothed when scaled. If\n\t * <code>false</code>, the bitmap is not smoothed when scaled.\n\t */\n\tpublic smoothing:boolean; //TODO\n\n\t/**\n\t *\n\t */\n\tpublic get uvTransform():UVTransform\n\t{\n\t\treturn this._uvTransform;\n\t}\n\n\tpublic set uvTransform(value:UVTransform)\n\t{\n\t\tthis._uvTransform = value;\n\t}\n\n\tconstructor(material:MaterialBase, pixelSnapping:string = \"auto\", smoothing:boolean = false)\n\t{\n\t\tsuper();\n\n\t\tthis._pIsEntity = true;\n\n\t\tthis.onSizeChangedDelegate = (event:MaterialEvent) => this.onSizeChanged(event);\n\n\t\tthis.material = material;\n\n\t\tthis._billboardWidth = material.width;\n\t\tthis._billboardHeight = material.height;\n\n\t\t//default bounds type\n\t\tthis._boundsType = BoundsType.AXIS_ALIGNED_BOX;\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tpublic _pUpdateBoxBounds()\n\t{\n\t\tsuper._pUpdateBoxBounds();\n\n\t\tthis._pBoxBounds.width = this._billboardWidth;\n\t\tthis._pBoxBounds.height = this._billboardHeight;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param shortestCollisionDistance\n\t * @param findClosest\n\t * @returns {boolean}\n\t *\n\t * @internal\n\t */\n\tpublic _iTestCollision(shortestCollisionDistance:number, findClosest:boolean):boolean\n\t{\n\t\treturn this._pPickingCollider.testBillboardCollision(this, this._pPickingCollisionVO, shortestCollisionDistance);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate onSizeChanged(event:MaterialEvent)\n\t{\n\t\tthis._billboardWidth = this._material.width;\n\t\tthis._billboardHeight = this._material.height;\n\n\t\tthis._pInvalidateBounds();\n\n\t\tvar len:number = this._pRenderables.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._pRenderables[i].invalidateGeometry();\n\t}\n\n\tpublic _iCollectRenderables(rendererPool:IRendererPool)\n\t{\n\t\t// Since this getter is invoked every iteration of the render loop, and\n\t\t// the prefab construct could affect the sub-meshes, the prefab is\n\t\t// validated here to give it a chance to rebuild.\n\t\tif (this._iSourcePrefab)\n\t\t\tthis._iSourcePrefab._iValidate();\n\n\t\tthis._iCollectRenderable(rendererPool);\n\t}\n\n\tpublic _iCollectRenderable(rendererPool:IRendererPool)\n\t{\n\t\trendererPool.applyBillboard(this);\n\t}\n\n\tpublic _pRegisterEntity(partition:Partition)\n\t{\n\t\tpartition._iRegisterEntity(this);\n\t}\n\n\tpublic _pUnregisterEntity(partition:Partition)\n\t{\n\t\tpartition._iUnregisterEntity(this);\n\t}\n}\n\nexport = Billboard;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Plane3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Plane3D\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport ProjectionEvent\t\t\t\t= require(\"awayjs-core/lib/events/ProjectionEvent\");\nimport IProjection\t\t\t\t\t= require(\"awayjs-core/lib/projections/IProjection\");\nimport PerspectiveProjection\t\t= require(\"awayjs-core/lib/projections/PerspectiveProjection\");\n\nimport BoundsType\t\t\t\t\t= require(\"awayjs-display/lib/bounds/BoundsType\");\nimport DisplayObjectContainer\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport CameraEvent\t\t\t\t\t= require(\"awayjs-display/lib/events/CameraEvent\");\nimport CameraNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/CameraNode\");\nimport EntityNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/EntityNode\");\nimport IRendererPool\t\t\t\t= require(\"awayjs-display/lib/pool/IRendererPool\");\n\n\nclass Camera extends DisplayObjectContainer implements IEntity\n{\n\tprivate _viewProjection:Matrix3D = new Matrix3D();\n\tprivate _viewProjectionDirty:Boolean = true;\n\tprivate _projection:IProjection;\n\tprivate _frustumPlanes:Array<Plane3D>;\n\tprivate _frustumPlanesDirty:Boolean = true;\n\tprivate _onProjectionMatrixChangedDelegate:(event:ProjectionEvent) => void;\n\n\tconstructor(projection:IProjection = null)\n\t{\n\t\tsuper();\n\n\t\tthis._pIsEntity = true;\n\n\t\tthis._onProjectionMatrixChangedDelegate = (event:ProjectionEvent) => this.onProjectionMatrixChanged(event);\n\n\t\tthis._projection = projection || new PerspectiveProjection();\n\t\tthis._projection.addEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);\n\n\t\tthis._frustumPlanes = [];\n\n\t\tfor (var i:number = 0; i < 6; ++i)\n\t\t\tthis._frustumPlanes[i] = new Plane3D();\n\n\t\tthis.z = -1000;\n\n\t\t//default bounds type\n\t\tthis._boundsType = BoundsType.NULL;\n\t}\n\n\t//@override\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.CAMERA;\n\t}\n\n\tprivate onProjectionMatrixChanged(event:ProjectionEvent)\n\t{\n\t\tthis._viewProjectionDirty = true;\n\t\tthis._frustumPlanesDirty = true;\n\t\tthis.dispatchEvent(event);\n\t}\n\n\tpublic get frustumPlanes():Array<Plane3D>\n\t{\n\t\tif (this._frustumPlanesDirty)\n\t\t\tthis.updateFrustum();\n\n\t\treturn this._frustumPlanes;\n\t}\n\n\tprivate updateFrustum()\n\t{\n\t\tvar a:number, b:number, c:number;\n\t\t//var d : Number;\n\t\tvar c11:number, c12:number, c13:number, c14:number;\n\t\tvar c21:number, c22:number, c23:number, c24:number;\n\t\tvar c31:number, c32:number, c33:number, c34:number;\n\t\tvar c41:number, c42:number, c43:number, c44:number;\n\t\tvar p:Plane3D;\n\t\tvar raw:number[] = new Array<number>(16);\n\t\t;//new Array(16 );away.utils.Matrix3DUtils.RAW_DATA_CONTAINER;//[];\n\t\tvar invLen:number;\n\t\tthis.viewProjection.copyRawDataTo(raw);\n\n\t\tc11 = raw[0];\n\t\tc12 = raw[4];\n\t\tc13 = raw[8];\n\t\tc14 = raw[12];\n\t\tc21 = raw[1];\n\t\tc22 = raw[5];\n\t\tc23 = raw[9];\n\t\tc24 = raw[13];\n\t\tc31 = raw[2];\n\t\tc32 = raw[6];\n\t\tc33 = raw[10];\n\t\tc34 = raw[14];\n\t\tc41 = raw[3];\n\t\tc42 = raw[7];\n\t\tc43 = raw[11];\n\t\tc44 = raw[15];\n\n\t\t// left plane\n\t\tp = this._frustumPlanes[0];\n\t\ta = c41 + c11;\n\t\tb = c42 + c12;\n\t\tc = c43 + c13;\n\t\tinvLen = 1/Math.sqrt(a*a + b*b + c*c);\n\t\tp.a = a*invLen;\n\t\tp.b = b*invLen;\n\t\tp.c = c*invLen;\n\t\tp.d = -(c44 + c14)*invLen;\n\n\t\t// right plane\n\t\tp = this._frustumPlanes[1];\n\t\ta = c41 - c11;\n\t\tb = c42 - c12;\n\t\tc = c43 - c13;\n\t\tinvLen = 1/Math.sqrt(a*a + b*b + c*c);\n\t\tp.a = a*invLen;\n\t\tp.b = b*invLen;\n\t\tp.c = c*invLen;\n\t\tp.d = (c14 - c44)*invLen;\n\n\t\t// bottom\n\t\tp = this._frustumPlanes[2];\n\t\ta = c41 + c21;\n\t\tb = c42 + c22;\n\t\tc = c43 + c23;\n\t\tinvLen = 1/Math.sqrt(a*a + b*b + c*c);\n\t\tp.a = a*invLen;\n\t\tp.b = b*invLen;\n\t\tp.c = c*invLen;\n\t\tp.d = -(c44 + c24)*invLen;\n\n\t\t// top\n\t\tp = this._frustumPlanes[3];\n\t\ta = c41 - c21;\n\t\tb = c42 - c22;\n\t\tc = c43 - c23;\n\t\tinvLen = 1/Math.sqrt(a*a + b*b + c*c);\n\t\tp.a = a*invLen;\n\t\tp.b = b*invLen;\n\t\tp.c = c*invLen;\n\t\tp.d = (c24 - c44)*invLen;\n\n\t\t// near\n\t\tp = this._frustumPlanes[4];\n\t\ta = c31;\n\t\tb = c32;\n\t\tc = c33;\n\t\tinvLen = 1/Math.sqrt(a*a + b*b + c*c);\n\t\tp.a = a*invLen;\n\t\tp.b = b*invLen;\n\t\tp.c = c*invLen;\n\t\tp.d = -c34*invLen;\n\n\t\t// far\n\t\tp = this._frustumPlanes[5];\n\t\ta = c41 - c31;\n\t\tb = c42 - c32;\n\t\tc = c43 - c33;\n\t\tinvLen = 1/Math.sqrt(a*a + b*b + c*c);\n\t\tp.a = a*invLen;\n\t\tp.b = b*invLen;\n\t\tp.c = c*invLen;\n\t\tp.d = (c34 - c44)*invLen;\n\n\t\tthis._frustumPlanesDirty = false;\n\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tpublic pInvalidateSceneTransform()\n\t{\n\t\tsuper.pInvalidateSceneTransform();\n\n\t\tthis._viewProjectionDirty = true;\n\t\tthis._frustumPlanesDirty = true;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get projection():IProjection\n\t{\n\t\treturn this._projection;\n\t}\n\n\tpublic set projection(value:IProjection)\n\t{\n\t\tif (this._projection == value)\n\t\t\treturn;\n\n\t\tif (!value)\n\t\t\tthrow new Error(\"Projection cannot be null!\");\n\n\t\tthis._projection.removeEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);\n\t\tthis._projection = value;\n\t\tthis._projection.addEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);\n\t\tthis.dispatchEvent(new CameraEvent(CameraEvent.PROJECTION_CHANGED, this));\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get viewProjection():Matrix3D\n\t{\n\t\tif (this._viewProjectionDirty) {\n\t\t\tthis._viewProjection.copyFrom(this.inverseSceneTransform);\n\t\t\tthis._viewProjection.append(this._projection.matrix);\n\t\t\tthis._viewProjectionDirty = false;\n\t\t}\n\n\t\treturn this._viewProjection;\n\t}\n\n\t/**\n\t * Calculates the ray in scene space from the camera to the given normalized coordinates in screen space.\n\t *\n\t * @param nX The normalised x coordinate in screen space, -1 corresponds to the left edge of the viewport, 1 to the right.\n\t * @param nY The normalised y coordinate in screen space, -1 corresponds to the top edge of the viewport, 1 to the bottom.\n\t * @param sZ The z coordinate in screen space, representing the distance into the screen.\n\t * @return The ray from the camera to the scene space position of the given screen coordinates.\n\t */\n\tpublic getRay(nX:number, nY:number, sZ:number):Vector3D\n\t{\n\t\treturn this.sceneTransform.deltaTransformVector(this._projection.unproject(nX, nY, sZ));\n\t}\n\n\t/**\n\t * Calculates the normalised position in screen space of the given scene position.\n\t *\n\t * @param point3d the position vector of the scene coordinates to be projected.\n\t * @return The normalised screen position of the given scene coordinates.\n\t */\n\tpublic project(point3d:Vector3D):Vector3D\n\t{\n\t\treturn this._projection.project(this.inverseSceneTransform.transformVector(point3d));\n\t}\n\n\t/**\n\t * Calculates the scene position of the given normalized coordinates in screen space.\n\t *\n\t * @param nX The normalised x coordinate in screen space, minus the originX offset of the projection property.\n\t * @param nY The normalised y coordinate in screen space, minus the originY offset of the projection property.\n\t * @param sZ The z coordinate in screen space, representing the distance into the screen.\n\t * @return The scene position of the given screen coordinates.\n\t */\n\tpublic unproject(nX:number, nY:number, sZ:number):Vector3D\n\t{\n\t\treturn this.sceneTransform.transformVector(this._projection.unproject(nX, nY, sZ));\n\t}\n\n\tpublic _iCollectRenderables(rendererPool:IRendererPool)\n\t{\n\t\t// Since this getter is invoked every iteration of the render loop, and\n\t\t// the prefab construct could affect the sub-meshes, the prefab is\n\t\t// validated here to give it a chance to rebuild.\n\t\tif (this._iSourcePrefab)\n\t\t\tthis._iSourcePrefab._iValidate();\n\n\t\tthis._iCollectRenderable(rendererPool);\n\t}\n\n\tpublic _iCollectRenderable(rendererPool:IRendererPool)\n\t{\n\t\t//nothing to do here\n\t}\n\n\tpublic _pRegisterEntity(partition:Partition)\n\t{\n\t\tpartition._iRegisterCamera(this);\n\t}\n\n\tpublic _pUnregisterEntity(partition:Partition)\n\t{\n\t\tpartition._iUnregisterCamera(this);\n\t}\n}\n\nexport = Camera;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport LightBase\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\nimport BoundsType\t\t\t\t\t= require(\"awayjs-display/lib/bounds/BoundsType\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport DirectionalLightNode\t\t\t= require(\"awayjs-display/lib/partition/DirectionalLightNode\");\nimport EntityNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/EntityNode\");\nimport IRendererPool\t\t\t\t= require(\"awayjs-display/lib/pool/IRendererPool\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport DirectionalShadowMapper\t\t= require(\"awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper\");\n\nclass DirectionalLight extends LightBase implements IEntity\n{\n\tprivate _direction:Vector3D;\n\tprivate _tmpLookAt:Vector3D;\n\tprivate _sceneDirection:Vector3D;\n\tprivate _pAabbPoints:Array<number> = new Array<number>(24);\n\tprivate _projAABBPoints:Array<number>;\n\n\tconstructor(xDir:number = 0, yDir:number = -1, zDir:number = 1)\n\t{\n\t\tsuper();\n\n\t\tthis._pIsEntity = true;\n\n\t\tthis.direction = new Vector3D(xDir, yDir, zDir);\n\n\t\tthis._sceneDirection = new Vector3D();\n\n\t\t//default bounds type\n\t\tthis._boundsType = BoundsType.NULL;\n\t}\n\n\tpublic get sceneDirection():Vector3D\n\t{\n\t\tif (this._pSceneTransformDirty)\n\t\t\tthis.pUpdateSceneTransform();\n\n\t\treturn this._sceneDirection;\n\t}\n\n\tpublic get direction():Vector3D\n\t{\n\t\treturn this._direction;\n\t}\n\n\tpublic set direction(value:Vector3D)\n\t{\n\t\tthis._direction = value;\n\n\t\tif (!this._tmpLookAt)\n\t\t\tthis._tmpLookAt = new Vector3D();\n\n\t\tthis._tmpLookAt.x = this.x + this._direction.x;\n\t\tthis._tmpLookAt.y = this.y + this._direction.y;\n\t\tthis._tmpLookAt.z = this.z + this._direction.z;\n\n\t\tthis.lookAt(this._tmpLookAt);\n\t}\n\n\t//@override\n\tpublic pUpdateSceneTransform()\n\t{\n\t\tsuper.pUpdateSceneTransform();\n\t\tthis.sceneTransform.copyColumnTo(2, this._sceneDirection);\n\t\tthis._sceneDirection.normalize();\n\t}\n\n\t//@override\n\tpublic pCreateShadowMapper():DirectionalShadowMapper\n\t{\n\t\treturn new DirectionalShadowMapper();\n\t}\n\n\t//override\n\tpublic iGetObjectProjectionMatrix(entity:IEntity, camera:Camera, target:Matrix3D = null):Matrix3D\n\t{\n\t\tvar raw:Array<number> = new Array<number>();\n\t\tvar m:Matrix3D = new Matrix3D();\n\n\t\tm.copyFrom(entity.getRenderSceneTransform(camera));\n\t\tm.append(this.inverseSceneTransform);\n\n\t\tif (!this._projAABBPoints)\n\t\t\tthis._projAABBPoints = [];\n\n\t\tm.transformVectors(this._pAabbPoints, this._projAABBPoints);\n\n\t\tvar xMin:number = Infinity, xMax:number = -Infinity;\n\t\tvar yMin:number = Infinity, yMax:number = -Infinity;\n\t\tvar zMin:number = Infinity, zMax:number = -Infinity;\n\t\tvar d:number;\n\t\tfor (var i:number = 0; i < 24;) {\n\t\t\td = this._projAABBPoints[i++];\n\n\t\t\tif (d < xMin)\n\t\t\t\txMin = d;\n\n\t\t\tif (d > xMax)\n\t\t\t\txMax = d;\n\n\t\t\td = this._projAABBPoints[i++];\n\n\t\t\tif (d < yMin)\n\t\t\t\tyMin = d;\n\n\t\t\tif (d > yMax)\n\t\t\t\tyMax = d;\n\n\t\t\td = this._projAABBPoints[i++];\n\n\t\t\tif (d < zMin)\n\t\t\t\tzMin = d;\n\n\t\t\tif (d > zMax)\n\t\t\t\tzMax = d;\n\t\t}\n\n\t\tvar invXRange:number = 1/(xMax - xMin);\n\t\tvar invYRange:number = 1/(yMax - yMin);\n\t\tvar invZRange:number = 1/(zMax - zMin);\n\t\traw[0] = 2*invXRange;\n\t\traw[5] = 2*invYRange;\n\t\traw[10] = invZRange;\n\t\traw[12] = -(xMax + xMin)*invXRange;\n\t\traw[13] = -(yMax + yMin)*invYRange;\n\t\traw[14] = -zMin*invZRange;\n\t\traw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[8] = raw[9] = raw[11] = 0;\n\t\traw[15] = 1;\n\n\t\tif (!target)\n\t\t\ttarget = new Matrix3D();\n\n\t\ttarget.copyRawDataFrom(raw);\n\t\ttarget.prepend(m);\n\n\t\treturn target;\n\t}\n\n\tpublic _iCollectRenderables(rendererPool:IRendererPool)\n\t{\n\t\t//nothing to do here\n\t}\n\n\tpublic _pRegisterEntity(partition:Partition)\n\t{\n\t\tpartition._iRegisterDirectionalLight(this);\n\t}\n\n\tpublic _pUnregisterEntity(partition:Partition)\n\t{\n\t\tpartition._iUnregisterDirectionalLight(this);\n\t}\n\n\n\t/**\n\t * //TODO\n\t *\n\t * @protected\n\t */\n\tpublic _pUpdateBoxBounds()\n\t{\n\t\tsuper._pUpdateBoxBounds();\n\n\t\t//update points\n\t\tvar minX:number = this._pBoxBounds.x;\n\t\tvar minY:number = this._pBoxBounds.y - this._pBoxBounds.height;\n\t\tvar minZ:number = this._pBoxBounds.z;\n\t\tvar maxX:number = this._pBoxBounds.x + this._pBoxBounds.width;\n\t\tvar maxY:number = this._pBoxBounds.y;\n\t\tvar maxZ:number = this._pBoxBounds.z + this._pBoxBounds.depth;\n\n\t\tthis._pAabbPoints[0] = minX;\n\t\tthis._pAabbPoints[1] = minY;\n\t\tthis._pAabbPoints[2] = minZ;\n\t\tthis._pAabbPoints[3] = maxX;\n\t\tthis._pAabbPoints[4] = minY;\n\t\tthis._pAabbPoints[5] = minZ;\n\t\tthis._pAabbPoints[6] = minX;\n\t\tthis._pAabbPoints[7] = maxY;\n\t\tthis._pAabbPoints[8] = minZ;\n\t\tthis._pAabbPoints[9] = maxX;\n\t\tthis._pAabbPoints[10] = maxY;\n\t\tthis._pAabbPoints[11] = minZ;\n\t\tthis._pAabbPoints[12] = minX;\n\t\tthis._pAabbPoints[13] = minY;\n\t\tthis._pAabbPoints[14] = maxZ;\n\t\tthis._pAabbPoints[15] = maxX;\n\t\tthis._pAabbPoints[16] = minY;\n\t\tthis._pAabbPoints[17] = maxZ;\n\t\tthis._pAabbPoints[18] = minX;\n\t\tthis._pAabbPoints[19] = maxY;\n\t\tthis._pAabbPoints[20] = maxZ;\n\t\tthis._pAabbPoints[21] = maxX;\n\t\tthis._pAabbPoints[22] = maxY;\n\t\tthis._pAabbPoints[23] = maxZ;\n\t}\n}\n\nexport = DirectionalLight;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport Error\t\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\n\nimport LightBase\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\nimport BoundsType\t\t\t\t\t= require(\"awayjs-display/lib/bounds/BoundsType\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport EntityNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/EntityNode\");\nimport LightProbeNode\t\t\t\t= require(\"awayjs-display/lib/partition/LightProbeNode\");\nimport IRendererPool\t\t\t\t= require(\"awayjs-display/lib/pool/IRendererPool\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport CubeTextureBase\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\n\nclass LightProbe extends LightBase implements IEntity\n{\n\tprivate _diffuseMap:CubeTextureBase;\n\tprivate _specularMap:CubeTextureBase;\n\n\tconstructor(diffuseMap:CubeTextureBase, specularMap:CubeTextureBase = null)\n\t{\n\t\tsuper();\n\n\t\tthis._pIsEntity = true;\n\n\t\tthis._diffuseMap = diffuseMap;\n\t\tthis._specularMap = specularMap;\n\n\t\t//default bounds type\n\t\tthis._boundsType = BoundsType.NULL;\n\t}\n\n\tpublic get diffuseMap():CubeTextureBase\n\t{\n\t\treturn this._diffuseMap;\n\t}\n\n\tpublic set diffuseMap(value:CubeTextureBase)\n\t{\n\t\tthis._diffuseMap = value;\n\t}\n\n\tpublic get specularMap():CubeTextureBase\n\t{\n\t\treturn this._specularMap;\n\t}\n\n\tpublic set specularMap(value:CubeTextureBase)\n\t{\n\t\tthis._specularMap = value;\n\t}\n\n\t//@override\n\tpublic iGetObjectProjectionMatrix(entity:IEntity, camera:Camera, target:Matrix3D = null):Matrix3D\n\t{\n\t\tthrow new Error(\"Object projection matrices are not supported for LightProbe objects!\");\n\t}\n\n\tpublic _iCollectRenderables(rendererPool:IRendererPool)\n\t{\n\t\t//nothing to do here\n\t}\n\n\tpublic _pRegisterEntity(partition:Partition)\n\t{\n\t\tpartition._iRegisterLightProbe(this);\n\t}\n\n\tpublic _pUnregisterEntity(partition:Partition)\n\t{\n\t\tpartition._iUnregisterLightProbe(this);\n\t}\n}\n\nexport = LightProbe;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport UVTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/UVTransform\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\n\nimport IAnimator\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimator\");\nimport DisplayObject\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\nimport BoundsType\t\t\t\t\t= require(\"awayjs-display/lib/bounds/BoundsType\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport EntityNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/EntityNode\");\nimport IRendererPool\t\t\t\t= require(\"awayjs-display/lib/pool/IRendererPool\");\nimport MaterialEvent\t\t\t\t= require(\"awayjs-display/lib/events/MaterialEvent\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\n\n/**\n * A Line Segment primitive.\n */\nclass LineSegment extends DisplayObject implements IEntity, IRenderableOwner\n{\n\tprivate _animator:IAnimator;\n\tprivate _material:MaterialBase;\n\tprivate _uvTransform:UVTransform;\n\n\tpublic _startPosition:Vector3D;\n\tpublic _endPosition:Vector3D;\n\tpublic _halfThickness:number;\n\n\n\t/**\n\t * Defines the animator of the line segment. Act on the line segment's geometry. Defaults to null\n\t */\n\tpublic get animator():IAnimator\n\t{\n\t\treturn this._animator;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.LINE_SEGMENT;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get startPostion():Vector3D\n\t{\n\t\treturn this._startPosition;\n\t}\n\n\tpublic set startPosition(value:Vector3D)\n\t{\n\t\tif (this._startPosition == value)\n\t\t\treturn;\n\n\t\tthis._startPosition = value;\n\n\t\tthis.notifyRenderableUpdate();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get endPosition():Vector3D\n\t{\n\t\treturn this._endPosition;\n\t}\n\n\tpublic set endPosition(value:Vector3D)\n\t{\n\t\tif (this._endPosition == value)\n\t\t\treturn;\n\n\t\tthis._endPosition = value;\n\n\t\tthis.notifyRenderableUpdate();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get material():MaterialBase\n\t{\n\t\treturn this._material;\n\t}\n\n\tpublic set material(value:MaterialBase)\n\t{\n\t\tif (this.material)\n\t\t\tthis.material.iRemoveOwner(this);\n\n\t\tthis._material = value;\n\n\t\tif (this.material)\n\t\t\tthis.material.iAddOwner(this);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get thickness():number\n\t{\n\t\treturn this._halfThickness*2;\n\t}\n\n\tpublic set thickness(value:number)\n\t{\n\t\tif (this._halfThickness == value)\n\t\t\treturn;\n\n\t\tthis._halfThickness = value*0.5;\n\n\t\tthis.notifyRenderableUpdate();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get uvTransform():UVTransform\n\t{\n\t\treturn this._uvTransform;\n\t}\n\n\tpublic set uvTransform(value:UVTransform)\n\t{\n\t\tthis._uvTransform = value;\n\t}\n\n\t/**\n\t * Create a line segment\n\t *\n\t * @param startPosition Start position of the line segment\n\t * @param endPosition Ending position of the line segment\n\t * @param thickness Thickness of the line\n\t */\n\tconstructor(material:MaterialBase, startPosition:Vector3D, endPosition:Vector3D, thickness:number = 1)\n\t{\n\t\tsuper();\n\n\t\tthis._pIsEntity = true;\n\n\t\tthis.material = material;\n\n\t\tthis._startPosition = startPosition;\n\t\tthis._endPosition = endPosition;\n\t\tthis._halfThickness = thickness*0.5;\n\n\t\t//default bounds type\n\t\tthis._boundsType = BoundsType.AXIS_ALIGNED_BOX;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._startPosition = null;\n\t\tthis._endPosition = null;\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tpublic _pUpdateBoxBounds()\n\t{\n\t\tsuper._pUpdateBoxBounds();\n\n\t\tthis._pBoxBounds.x = Math.min(this._startPosition.x, this._endPosition.x);\n\t\tthis._pBoxBounds.y = Math.min(this._startPosition.y, this._endPosition.y);\n\t\tthis._pBoxBounds.z = Math.min(this._startPosition.z, this._endPosition.z);\n\t\tthis._pBoxBounds.width = Math.abs(this._startPosition.x - this._endPosition.x);\n\t\tthis._pBoxBounds.height = Math.abs(this._startPosition.y - this._endPosition.y);\n\t\tthis._pBoxBounds.depth = Math.abs(this._startPosition.z - this._endPosition.z);\n\t}\n\n\tpublic _pUpdateSphereBounds()\n\t{\n\t\tsuper._pUpdateSphereBounds();\n\n\t\tthis._pUpdateBoxBounds();\n\n\t\tvar halfWidth:number = (this._endPosition.x - this._startPosition.x)/2;\n\t\tvar halfHeight:number = (this._endPosition.y - this._startPosition.y)/2;\n\t\tvar halfDepth:number = (this._endPosition.z - this._startPosition.z)/2;\n\t\tthis._pSphereBounds.x = this._startPosition.x + halfWidth;\n\t\tthis._pSphereBounds.y = this._startPosition.y + halfHeight;\n\t\tthis._pSphereBounds.z = this._startPosition.z + halfDepth;\n\t\tthis._pSphereBounds.radius = Math.sqrt(halfWidth*halfWidth + halfHeight*halfHeight + halfDepth*halfDepth);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate notifyRenderableUpdate()\n\t{\n\t\tvar len:number = this._pRenderables.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._pRenderables[i].invalidateGeometry(); //TODO improve performance by only using one geometry for all line segments\n\t}\n\n\tpublic _iCollectRenderables(rendererPool:IRendererPool)\n\t{\n\t\t// Since this getter is invoked every iteration of the render loop, and\n\t\t// the prefab construct could affect the sub-meshes, the prefab is\n\t\t// validated here to give it a chance to rebuild.\n\t\tif (this._iSourcePrefab)\n\t\t\tthis._iSourcePrefab._iValidate();\n\n\t\tthis._iCollectRenderable(rendererPool);\n\t}\n\n\tpublic _iCollectRenderable(rendererPool:IRendererPool)\n\t{\n\t\trendererPool.applyLineSegment(this);\n\t}\n\n\tpublic _pRegisterEntity(partition:Partition)\n\t{\n\t\tpartition._iRegisterEntity(this);\n\t}\n\n\tpublic _pUnregisterEntity(partition:Partition)\n\t{\n\t\tpartition._iUnregisterEntity(this);\n\t}\n}\n\nexport = LineSegment;","import Box\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Box\");\nimport UVTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/UVTransform\");\nimport AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\n\nimport IAnimator\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimator\");\nimport DisplayObject\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport Geometry\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\nimport ISubMesh\t\t\t\t\t\t= require(\"awayjs-display/lib/base/ISubMesh\");\nimport ISubMeshClass\t\t\t\t= require(\"awayjs-display/lib/base/ISubMeshClass\");\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport BoundsType\t\t\t\t\t= require(\"awayjs-display/lib/bounds/BoundsType\");\nimport DisplayObjectContainer\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport EntityNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/EntityNode\");\nimport IRendererPool\t\t\t\t= require(\"awayjs-display/lib/pool/IRendererPool\");\nimport GeometryEvent\t\t\t\t= require(\"awayjs-display/lib/events/GeometryEvent\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\n\n/**\n * Mesh is an instance of a Geometry, augmenting it with a presence in the scene graph, a material, and an animation\n * state. It consists out of SubMeshes, which in turn correspond to SubGeometries. SubMeshes allow different parts\n * of the geometry to be assigned different materials.\n */\nclass Mesh extends DisplayObjectContainer implements IEntity\n{\n\tprivate _uvTransform:UVTransform;\n\n\tprivate _subMeshes:Array<ISubMesh>;\n\tprivate _geometry:Geometry;\n\tprivate _material:MaterialBase;\n\tprivate _animator:IAnimator;\n\tprivate _castsShadows:boolean = true;\n\tprivate _shareAnimationGeometry:boolean = true;\n\n\tprivate _onGeometryBoundsInvalidDelegate:(event:GeometryEvent) => void;\n\tprivate _onSubGeometryAddedDelegate:(event:GeometryEvent) => void;\n\tprivate _onSubGeometryRemovedDelegate:(event:GeometryEvent) => void;\n\n\t/**\n\t * Defines the animator of the mesh. Act on the mesh's geometry.  Default value is <code>null</code>.\n\t */\n\tpublic get animator():IAnimator\n\t{\n\t\treturn this._animator;\n\t}\n\n\tpublic set animator(value:IAnimator)\n\t{\n\t\tif (this._animator)\n\t\t\tthis._animator.removeOwner(this);\n\n\t\tthis._animator = value;\n\n\t\tvar len:number = this._subMeshes.length;\n\t\tvar subMesh:ISubMesh;\n\n\t\tfor (var i:number = 0; i < len; ++i) {\n\t\t\tsubMesh = this._subMeshes[i];\n\n\t\t\t// cause material to be unregistered and registered again to work with the new animation type (if possible)\n\t\t\tif (subMesh.material) {\n\t\t\t\tsubMesh.material.iRemoveOwner(subMesh);\n\t\t\t\tsubMesh.material.iAddOwner(subMesh);\n\t\t\t}\n\n\t\t\t//invalidate any existing renderables in case they need to pull new geometry\n\t\t\tsubMesh._iInvalidateRenderableGeometry();\n\t\t}\n\n\t\tif (this._animator)\n\t\t\tthis._animator.addOwner(this);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.MESH;\n\t}\n\n\t/**\n\t * Indicates whether or not the Mesh can cast shadows. Default value is <code>true</code>.\n\t */\n\tpublic get castsShadows():boolean\n\t{\n\t\treturn this._castsShadows;\n\t}\n\n\tpublic set castsShadows(value:boolean)\n\t{\n\t\tthis._castsShadows = value;\n\t}\n\n\t/**\n\t * The geometry used by the mesh that provides it with its shape.\n\t */\n\tpublic get geometry():Geometry\n\t{\n\t\tif (this._iSourcePrefab)\n\t\t\tthis._iSourcePrefab._iValidate();\n\n\t\treturn this._geometry;\n\t}\n\n\tpublic set geometry(value:Geometry)\n\t{\n\t\tvar i:number;\n\n\t\tif (this._geometry) {\n\t\t\tthis._geometry.removeEventListener(GeometryEvent.BOUNDS_INVALID, this._onGeometryBoundsInvalidDelegate);\n\t\t\tthis._geometry.removeEventListener(GeometryEvent.SUB_GEOMETRY_ADDED, this._onSubGeometryAddedDelegate);\n\t\t\tthis._geometry.removeEventListener(GeometryEvent.SUB_GEOMETRY_REMOVED, this._onSubGeometryRemovedDelegate);\n\n\t\t\tfor (i = 0; i < this._subMeshes.length; ++i)\n\t\t\t\tthis._subMeshes[i].dispose();\n\n\t\t\tthis._subMeshes.length = 0;\n\t\t}\n\n\t\tthis._geometry = value;\n\n\t\tif (this._geometry) {\n\n\t\t\tthis._geometry.addEventListener(GeometryEvent.BOUNDS_INVALID, this._onGeometryBoundsInvalidDelegate);\n\t\t\tthis._geometry.addEventListener(GeometryEvent.SUB_GEOMETRY_ADDED, this._onSubGeometryAddedDelegate);\n\t\t\tthis._geometry.addEventListener(GeometryEvent.SUB_GEOMETRY_REMOVED, this._onSubGeometryRemovedDelegate);\n\n\t\t\tvar subGeoms:Array<SubGeometryBase> = this._geometry.subGeometries;\n\n\t\t\tfor (i = 0; i < subGeoms.length; ++i)\n\t\t\t\tthis.addSubMesh(subGeoms[i]);\n\t\t}\n\t}\n\n\t/**\n\t * The material with which to render the Mesh.\n\t */\n\tpublic get material():MaterialBase\n\t{\n\t\treturn this._material;\n\t}\n\n\tpublic set material(value:MaterialBase)\n\t{\n\t\tif (value == this._material)\n\t\t\treturn;\n\n\t\tvar i:number;\n\t\tvar len:number = this._subMeshes.length;\n\t\tvar subMesh:ISubMesh;\n\n\t\tfor (i = 0; i < len; i++)\n\t\t\tif (this._material && (subMesh = this._subMeshes[i]).material == this._material)\n\t\t\t\tthis._material.iRemoveOwner(subMesh);\n\n\t\tthis._material = value;\n\n\t\tfor (i = 0; i < len; i++)\n\t\t\tif (this._material && (subMesh = this._subMeshes[i]).material == this._material)\n\t\t\t\tthis._material.iAddOwner(subMesh);\n\t}\n\n\t/**\n\t * Indicates whether or not the mesh share the same animation geometry.\n\t */\n\tpublic get shareAnimationGeometry():boolean\n\t{\n\t\treturn this._shareAnimationGeometry;\n\t}\n\n\tpublic set shareAnimationGeometry(value:boolean)\n\t{\n\t\tthis._shareAnimationGeometry = value;\n\t}\n\n\t/**\n\t * The SubMeshes out of which the Mesh consists. Every SubMesh can be assigned a material to override the Mesh's\n\t * material.\n\t */\n\tpublic get subMeshes():Array<ISubMesh>\n\t{\n\t\t// Since this getter is invoked every iteration of the render loop, and\n\t\t// the prefab construct could affect the sub-meshes, the prefab is\n\t\t// validated here to give it a chance to rebuild.\n\t\tif (this._iSourcePrefab)\n\t\t\tthis._iSourcePrefab._iValidate();\n\n\t\treturn this._subMeshes;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get uvTransform():UVTransform\n\t{\n\t\treturn this._uvTransform;\n\t}\n\n\tpublic set uvTransform(value:UVTransform)\n\t{\n\t\tthis._uvTransform = value;\n\t}\n\n\t/**\n\t * Create a new Mesh object.\n\t *\n\t * @param geometry                    The geometry used by the mesh that provides it with its shape.\n\t * @param material    [optional]        The material with which to render the Mesh.\n\t */\n\tconstructor(geometry:Geometry, material:MaterialBase = null)\n\t{\n\t\tsuper();\n\n\t\tthis._pIsEntity = true;\n\n\t\tthis._subMeshes = new Array<ISubMesh>();\n\n\t\tthis._onGeometryBoundsInvalidDelegate = (event:GeometryEvent) => this.onGeometryBoundsInvalid(event);\n\t\tthis._onSubGeometryAddedDelegate = (event:GeometryEvent) => this.onSubGeometryAdded(event);\n\t\tthis._onSubGeometryRemovedDelegate = (event:GeometryEvent) => this.onSubGeometryRemoved(event);\n\n\t\t//this should never happen, but if people insist on trying to create their meshes before they have geometry to fill it, it becomes necessary\n\t\tthis.geometry = geometry || new Geometry();\n\n\t\tthis.material = material;\n\n\t\t//default bounds type\n\t\tthis._boundsType = BoundsType.AXIS_ALIGNED_BOX;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic bakeTransformations()\n\t{\n\t\tthis.geometry.applyTransformation(this._iMatrix3D);\n\t\tthis._iMatrix3D.identity();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\tsuper.dispose();\n\n\t\tthis.material = null;\n\t\tthis.geometry = null;\n\t}\n\n\t/**\n\t * Disposes mesh including the animator and children. This is a merely a convenience method.\n\t * @return\n\t */\n\tpublic disposeWithAnimatorAndChildren()\n\t{\n\t\tthis.disposeWithChildren();\n\n\t\t if (this._animator)\n\t\t\tthis._animator.dispose();\n\t}\n\n\t/**\n\t * Clones this Mesh instance along with all it's children, while re-using the same\n\t * material, geometry and animation set. The returned result will be a copy of this mesh,\n\t * containing copies of all of it's children.\n\t *\n\t * Properties that are re-used (i.e. not cloned) by the new copy include name,\n\t * geometry, and material. Properties that are cloned or created anew for the copy\n\t * include subMeshes, children of the mesh, and the animator.\n\t *\n\t * If you want to copy just the mesh, reusing it's geometry and material while not\n\t * cloning it's children, the simplest way is to create a new mesh manually:\n\t *\n\t * <code>\n\t * var clone : Mesh = new Mesh(original.geometry, original.material);\n\t * </code>\n\t */\n\tpublic clone():DisplayObject\n\t{\n\t\tvar clone:Mesh = new Mesh(this._geometry, this._material);\n\n\t\tclone._iMatrix3D = this._iMatrix3D;\n\t\tclone.pivot = this.pivot;\n\t\tclone.partition = this.partition;\n\t\tclone.boundsType = this.boundsType;\n\n\n\t\tclone.name = this.name;\n\t\tclone.castsShadows = this.castsShadows;\n\t\tclone.shareAnimationGeometry = this.shareAnimationGeometry;\n\t\tclone.mouseEnabled = this.mouseEnabled;\n\t\tclone.mouseChildren = this.mouseChildren;\n\t\t//this is of course no proper cloning\n\t\t//maybe use this instead?: http://blog.another-d-mention.ro/programming/how-to-clone-duplicate-an-object-in-actionscript-3/\n\t\tclone.extra = this.extra;\n\n\t\tvar len:number = this._subMeshes.length;\n\t\tfor (var i:number = 0; i < len; ++i)\n\t\t\tclone._subMeshes[i].material = this._subMeshes[i]._iGetExplicitMaterial();\n\n\n\t\tlen = this.numChildren;\n\t\tvar obj:any;\n\n\t\tfor (i = 0; i < len; ++i) {\n\t\t\tobj = this.getChildAt(i).clone();\n\t\t\tclone.addChild(<DisplayObjectContainer> obj);\n\t\t}\n\n\t\tif (this._animator)\n\t\t\tclone.animator = this._animator.clone();\n\n\t\treturn clone;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param subGeometry\n\t * @returns {SubMeshBase}\n\t */\n\tpublic getSubMeshFromSubGeometry(subGeometry:SubGeometryBase):ISubMesh\n\t{\n\t\treturn this._subMeshes[this._geometry.subGeometries.indexOf(subGeometry)];\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @protected\n\t */\n\tpublic _pUpdateBoxBounds()\n\t{\n\t\tsuper._pUpdateBoxBounds();\n\n\t\tvar i:number, j:number, p:number, len:number;\n\t\tvar subGeoms:Array<SubGeometryBase> = this._geometry.subGeometries;\n\t\tvar subGeom:SubGeometryBase;\n\t\tvar boundingPositions:Array<number>;\n\t\tvar numSubGeoms:number = subGeoms.length;\n\t\tvar minX:number, minY:number, minZ:number;\n\t\tvar maxX:number, maxY:number, maxZ:number;\n\n\t\tif (numSubGeoms > 0) {\n\t\t\ti = 0;\n\t\t\tsubGeom = subGeoms[0];\n\t\t\tboundingPositions = subGeom.getBoundingPositions();\n\t\t\tminX = maxX = boundingPositions[i];\n\t\t\tminY = maxY = boundingPositions[i + 1];\n\t\t\tminZ = maxZ = boundingPositions[i + 2];\n\n\t\t\tfor (j = 0; j < numSubGeoms; j++) {\n\t\t\t\tsubGeom = subGeoms[j];\n\t\t\t\tboundingPositions = subGeom.getBoundingPositions();\n\t\t\t\tlen = boundingPositions.length;\n\n\t\t\t\tfor (i = 0; i < len; i+=3) {\n\t\t\t\t\tp = boundingPositions[i];\n\t\t\t\t\tif (p < minX)\n\t\t\t\t\t\tminX = p;\n\t\t\t\t\telse if (p > maxX)\n\t\t\t\t\t\tmaxX = p;\n\n\t\t\t\t\tp = boundingPositions[i + 1];\n\n\t\t\t\t\tif (p < minY)\n\t\t\t\t\t\tminY = p;\n\t\t\t\t\telse if (p > maxY)\n\t\t\t\t\t\tmaxY = p;\n\n\t\t\t\t\tp = boundingPositions[i + 2];\n\n\t\t\t\t\tif (p < minZ)\n\t\t\t\t\t\tminZ = p;\n\t\t\t\t\telse if (p > maxZ)\n\t\t\t\t\t\tmaxZ = p;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._pBoxBounds.width = maxX - (this._pBoxBounds.x = minX);\n\t\t\tthis._pBoxBounds.height = maxY - (this._pBoxBounds.y = minY);\n\t\t\tthis._pBoxBounds.depth = maxZ - (this._pBoxBounds.z = minZ);\n\t\t} else {\n\t\t\tthis._pBoxBounds.setEmpty();\n\t\t}\n\t}\n\n\n\tpublic _pUpdateSphereBounds()\n\t{\n\t\tsuper._pUpdateSphereBounds();\n\n\t\tvar box:Box = this.getBox();\n\t\tvar centerX:number = box.x + box.width/2;\n\t\tvar centerY:number = box.y + box.height/2;\n\t\tvar centerZ:number = box.z + box.depth/2;\n\n\t\tvar i:number, j:number, p:number, len:number;\n\t\tvar subGeoms:Array<SubGeometryBase> = this._geometry.subGeometries;\n\t\tvar subGeom:SubGeometryBase;\n\t\tvar boundingPositions:Array<number>;\n\t\tvar numSubGeoms:number = subGeoms.length;\n\t\tvar maxRadiusSquared:number = 0;\n\t\tvar radiusSquared:number;\n\t\tvar distanceX:number;\n\t\tvar distanceY:number;\n\t\tvar distanceZ:number;\n\n\t\tif (numSubGeoms > 0) {\n\t\t\ti = 0;\n\t\t\tsubGeom = subGeoms[0];\n\t\t\tboundingPositions = subGeom.getBoundingPositions();\n\t\t\tfor (j = 0; j < numSubGeoms; j++) {\n\t\t\t\tsubGeom = subGeoms[j];\n\t\t\t\tboundingPositions = subGeom.getBoundingPositions();\n\t\t\t\tlen = boundingPositions.length;\n\n\t\t\t\tfor (i = 0; i < len; i += 3) {\n\t\t\t\t\tdistanceX = boundingPositions[i] - centerX;\n\t\t\t\t\tdistanceY = boundingPositions[i + 1] - centerY;\n\t\t\t\t\tdistanceZ = boundingPositions[i + 2] - centerZ;\n\t\t\t\t\tradiusSquared = distanceX*distanceX + distanceY*distanceY + distanceZ*distanceZ;\n\n\t\t\t\t\tif (maxRadiusSquared < radiusSquared)\n\t\t\t\t\t\tmaxRadiusSquared = radiusSquared;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._pSphereBounds.x = centerX;\n\t\tthis._pSphereBounds.y = centerY;\n\t\tthis._pSphereBounds.z = centerZ;\n\t\tthis._pSphereBounds.radius = Math.sqrt(maxRadiusSquared);\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @private\n\t */\n\tprivate onGeometryBoundsInvalid(event:GeometryEvent)\n\t{\n\t\tthis._pInvalidateBounds();\n\t}\n\n\t/**\n\t * Called when a SubGeometry was added to the Geometry.\n\t *\n\t * @private\n\t */\n\tprivate onSubGeometryAdded(event:GeometryEvent)\n\t{\n\t\tthis.addSubMesh(event.subGeometry);\n\t}\n\n\t/**\n\t * Called when a SubGeometry was removed from the Geometry.\n\t *\n\t * @private\n\t */\n\tprivate onSubGeometryRemoved(event:GeometryEvent)\n\t{\n\t\tvar subMesh:ISubMesh;\n\t\tvar subGeom:SubGeometryBase = event.subGeometry;\n\t\tvar len:number = this._subMeshes.length;\n\t\tvar i:number;\n\n\t\t// Important! This has to be done here, and not delayed until the\n\t\t// next render loop, since this may be caused by the geometry being\n\t\t// rebuilt IN THE RENDER LOOP. Invalidating and waiting will delay\n\t\t// it until the NEXT RENDER FRAME which is probably not desirable.\n\t\tfor (i = 0; i < len; ++i) {\n\n\t\t\tsubMesh = this._subMeshes[i];\n\n\t\t\tif (subMesh.subGeometry == subGeom) {\n\t\t\t\tsubMesh.dispose();\n\n\t\t\t\tthis._subMeshes.splice(i, 1);\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t--len;\n\t\tfor (; i < len; ++i)\n\t\t\tthis._subMeshes[i]._iIndex = i;\n\t}\n\n\t/**\n\t * Adds a SubMeshBase wrapping a SubGeometry.\n\t *\n\t * @param subGeometry\n\t */\n\tprivate addSubMesh(subGeometry:SubGeometryBase)\n\t{\n\t\tvar SubMeshClass:ISubMeshClass = subGeometry.subMeshClass;\n\n\t\tvar subMesh:ISubMesh = new SubMeshClass(subGeometry, this, null);\n\t\tvar len:number = this._subMeshes.length;\n\n\t\tsubMesh._iIndex = len;\n\n\t\tthis._subMeshes[len] = subMesh;\n\n\t\tthis._pInvalidateBounds();\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param shortestCollisionDistance\n\t * @param findClosest\n\t * @returns {boolean}\n\t *\n\t * @internal\n\t */\n\tpublic _iTestCollision(shortestCollisionDistance:number, findClosest:boolean):boolean\n\t{\n\t\treturn this._pPickingCollider.testMeshCollision(this, this._pPickingCollisionVO, shortestCollisionDistance, findClosest);\n\t}\n\n\t/**\n\t *\n\t * @param renderer\n\t *\n\t * @internal\n\t */\n\tpublic _iCollectRenderables(rendererPool:IRendererPool)\n\t{\n\t\t// Since this getter is invoked every iteration of the render loop, and\n\t\t// the prefab construct could affect the sub-meshes, the prefab is\n\t\t// validated here to give it a chance to rebuild.\n\t\tif (this._iSourcePrefab)\n\t\t\tthis._iSourcePrefab._iValidate();\n\n\t\tvar len:number /*uint*/ = this._subMeshes.length;\n\t\tfor (var i:number /*uint*/ = 0; i < len; i++)\n\t\t\tthis._subMeshes[i]._iCollectRenderable(rendererPool);\n\t}\n\n\tpublic _iInvalidateRenderableGeometries()\n\t{\n\t\tvar len:number = this._subMeshes.length;\n\t\tfor (var i:number = 0; i < len; ++i)\n\t\t\tthis._subMeshes[i]._iInvalidateRenderableGeometry();\n\t}\n\n\tpublic _pRegisterEntity(partition:Partition)\n\t{\n\t\tpartition._iRegisterEntity(this);\n\t}\n\n\tpublic _pUnregisterEntity(partition:Partition)\n\t{\n\t\tpartition._iUnregisterEntity(this);\n\t}\n}\n\nexport = Mesh;","import Box\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Box\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport LightBase\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\nimport BoundsType\t\t\t\t\t= require(\"awayjs-display/lib/bounds/BoundsType\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport EntityNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/EntityNode\");\nimport PointLightNode\t\t\t\t= require(\"awayjs-display/lib/partition/PointLightNode\");\nimport IRendererPool\t\t\t\t= require(\"awayjs-display/lib/pool/IRendererPool\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport CubeMapShadowMapper\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper\");\n\nclass PointLight extends LightBase implements IEntity\n{\n\tpublic _pRadius:number = 90000;\n\tpublic _pFallOff:number = 100000;\n\tpublic _pFallOffFactor:number;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._pIsEntity = true;\n\n\t\tthis._pFallOffFactor = 1/(this._pFallOff*this._pFallOff - this._pRadius*this._pRadius);\n\n\t\t//default bounds type\n\t\tthis._boundsType = BoundsType.SPHERE;\n\t}\n\n\tpublic pCreateShadowMapper():CubeMapShadowMapper\n\t{\n\t\treturn new CubeMapShadowMapper();\n\t}\n\n\tpublic get radius():number\n\t{\n\t\treturn this._pRadius;\n\t}\n\n\tpublic set radius(value:number)\n\t{\n\t\tthis._pRadius = value;\n\n\t\tif (this._pRadius < 0) {\n\t\t\tthis._pRadius = 0;\n\t\t} else if (this._pRadius > this._pFallOff) {\n\t\t\tthis._pFallOff = this._pRadius;\n\t\t\tthis._pInvalidateBounds();\n\t\t}\n\t\tthis._pFallOffFactor = 1/( this._pFallOff*this._pFallOff - this._pRadius*this._pRadius );\n\t}\n\n\tpublic iFallOffFactor():number\n\t{\n\t\treturn this._pFallOffFactor;\n\t}\n\n\tpublic get fallOff():number\n\t{\n\t\treturn this._pFallOff;\n\t}\n\n\tpublic set fallOff(value:number)\n\t{\n\t\tthis._pFallOff = value;\n\n\t\tif (this._pFallOff < 0)\n\t\t\tthis._pFallOff = 0;\n\n\t\tif (this._pFallOff < this._pRadius)\n\t\t\tthis._pRadius = this._pFallOff;\n\n\t\tthis._pFallOffFactor = 1/( this._pFallOff*this._pFallOff - this._pRadius*this._pRadius);\n\t\tthis._pInvalidateBounds();\n\t}\n\n\tpublic _pUpdateSphereBounds()\n\t{\n\t\tsuper._pUpdateSphereBounds();\n\n\t\tthis._pSphereBounds.radius = this._pFallOff;\n\t}\n\n\tpublic iGetObjectProjectionMatrix(entity:IEntity, camera:Camera, target:Matrix3D = null):Matrix3D\n\t{\n\t\tvar raw:number[] = new Array<number>(16);\n\t\tvar m:Matrix3D = new Matrix3D();\n\n\t\t// todo: do not use lookAt on Light\n\t\tm.copyFrom(entity.getRenderSceneTransform(camera));\n\t\tm.append(this._pParent.inverseSceneTransform);\n\t\tthis.lookAt(m.position);\n\n\t\tm.copyFrom(entity.getRenderSceneTransform(camera));\n\t\tm.append(this.inverseSceneTransform);\n\n\t\tvar box:Box = entity.getBox();\n\t\tvar v1:Vector3D = m.deltaTransformVector(new Vector3D(box.left, box.bottom, box.front));\n\t\tvar v2:Vector3D = m.deltaTransformVector(new Vector3D(box.right, box.top, box.back));\n\t\tvar d1:number = v1.x*v1.x + v1.y*v1.y + v1.z*v1.z;\n\t\tvar d2:number = v2.x*v2.x + v2.y*v2.y + v2.z*v2.z;\n\t\tvar d:number = Math.sqrt(d1 > d2? d1 : d2);\n\t\tvar zMin:number;\n\t\tvar zMax:number;\n\n\t\tvar z:number = m.rawData[14];\n\t\tzMin = z - d;\n\t\tzMax = z + d;\n\n\t\traw[5] = raw[0] = zMin/d;\n\t\traw[10] = zMax/(zMax - zMin);\n\t\traw[11] = 1;\n\t\traw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[8] = raw[9] = raw[12] = raw[13] = raw[15] = 0;\n\t\traw[14] = -zMin*raw[10];\n\n\t\tif (!target)\n\t\t\ttarget = new Matrix3D();\n\n\t\ttarget.copyRawDataFrom(raw);\n\t\ttarget.prepend(m);\n\n\t\treturn target;\n\t}\n\n\tpublic _iCollectRenderables(rendererPool:IRendererPool)\n\t{\n\t\t//nothing to do here\n\t}\n\n\tpublic _pRegisterEntity(partition:Partition)\n\t{\n\t\tpartition._iRegisterPointLight(this);\n\t}\n\n\tpublic _pUnregisterEntity(partition:Partition)\n\t{\n\t\tpartition._iUnregisterPointLight(this);\n\t}\n}\n\nexport = PointLight;","import DisplayObject\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport Graphics\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Graphics\");\n\n/**\n * This class is used to create lightweight shapes using the ActionScript\n * drawing application program interface(API). The Shape class includes a\n * <code>graphics</code> property, which lets you access methods from the\n * Graphics class.\n *\n * <p>The Sprite class also includes a <code>graphics</code>property, and it\n * includes other features not available to the Shape class. For example, a\n * Sprite object is a display object container, whereas a Shape object is not\n * (and cannot contain child display objects). For this reason, Shape objects\n * consume less memory than Sprite objects that contain the same graphics.\n * However, a Sprite object supports user input events, while a Shape object\n * does not.</p>\n */\nclass Shape extends DisplayObject\n{\n\tprivate _graphics:Graphics;\n\n\t/**\n\t * Specifies the Graphics object belonging to this Shape object, where vector\n\t * drawing commands can occur.\n\t */\n\tget graphics():Graphics\n\t{\n\t\treturn this._graphics;\n\t}\n\n\t/**\n\t * Creates a new Shape object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n}\n\nexport = Shape;","import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\nimport UVTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/UVTransform\");\nimport AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport CubeTextureBase\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\n\nimport IAnimationSet\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimationSet\");\nimport IAnimator\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimator\");\nimport DisplayObject\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport BoundsType\t\t\t\t\t= require(\"awayjs-display/lib/bounds/BoundsType\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport IRenderable\t\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderable\");\nimport IRenderablePool\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderablePool\");\nimport IRenderObject\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderObject\");\nimport SkyboxNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/SkyboxNode\");\nimport IRendererPool\t\t\t\t= require(\"awayjs-display/lib/pool/IRendererPool\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport LightPickerBase\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\n\n/**\n * A Skybox class is used to render a sky in the scene. It's always considered static and 'at infinity', and as\n * such it's always centered at the camera's position and sized to exactly fit within the camera's frustum, ensuring\n * the sky box is always as large as possible without being clipped.\n */\nclass Skybox extends DisplayObject implements IEntity, IRenderableOwner, IRenderObjectOwner\n{\n\tprivate _cubeMap:CubeTextureBase;\n\tpublic _pAlphaThreshold:number = 0;\n\tprivate _animationSet:IAnimationSet;\n\tpublic _pLightPicker:LightPickerBase;\n\tpublic _pBlendMode:string = BlendMode.NORMAL;\n\tprivate _renderObjects:Array<IRenderObject> = new Array<IRenderObject>();\n\tprivate _renderables:Array<IRenderable> = new Array<IRenderable>();\n\tprivate _uvTransform:UVTransform;\n\tprivate _owners:Array<IRenderableOwner>;\n\tprivate _mipmap:boolean = false;\n\tprivate _smooth:boolean = true;\n\t\n\tprivate _material:MaterialBase;\n\tprivate _animator:IAnimator;\n\n\t/**\n\t * The minimum alpha value for which pixels should be drawn. This is used for transparency that is either\n\t * invisible or entirely opaque, often used with textures for foliage, etc.\n\t * Recommended values are 0 to disable alpha, or 0.5 to create smooth edges. Default value is 0 (disabled).\n\t */\n\tpublic get alphaThreshold():number\n\t{\n\t\treturn this._pAlphaThreshold;\n\t}\n\n\tpublic set alphaThreshold(value:number)\n\t{\n\t\tif (value < 0)\n\t\t\tvalue = 0;\n\t\telse if (value > 1)\n\t\t\tvalue = 1;\n\n\t\tif (this._pAlphaThreshold == value)\n\t\t\treturn;\n\n\t\tthis._pAlphaThreshold = value;\n\n\t\tthis._pIinvalidatePasses();\n\t}\n\n\t/**\n\t * Indicates whether or not the Skybox texture should use mipmapping. Defaults to false.\n\t */\n\tpublic get mipmap():boolean\n\t{\n\t\treturn this._mipmap;\n\t}\n\n\tpublic set mipmap(value:boolean)\n\t{\n\t\tif (this._mipmap == value)\n\t\t\treturn;\n\n\t\tthis._mipmap = value;\n\n\t\tthis._pIinvalidatePasses();\n\t}\n\n\t/**\n\t * Indicates whether or not the Skybox texture should use smoothing. Defaults to true.\n\t */\n\tpublic get smooth():boolean\n\t{\n\t\treturn this._smooth;\n\t}\n\n\tpublic set smooth(value:boolean)\n\t{\n\t\tif (this._smooth == value)\n\t\t\treturn;\n\n\t\tthis._smooth = value;\n\n\t\tthis._pIinvalidatePasses();\n\t}\n\t\n\t/**\n\t * The light picker used by the material to provide lights to the material if it supports lighting.\n\t *\n\t * @see LightPickerBase\n\t * @see StaticLightPicker\n\t */\n\tpublic get lightPicker():LightPickerBase\n\t{\n\t\treturn this._pLightPicker;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get animationSet():IAnimationSet\n\t{\n\t\treturn this._animationSet;\n\t}\n\n\t/**\n\t * The blend mode to use when drawing this renderable. The following blend modes are supported:\n\t * <ul>\n\t * <li>BlendMode.NORMAL: No blending, unless the material inherently needs it</li>\n\t * <li>BlendMode.LAYER: Force blending. This will draw the object the same as NORMAL, but without writing depth writes.</li>\n\t * <li>BlendMode.MULTIPLY</li>\n\t * <li>BlendMode.ADD</li>\n\t * <li>BlendMode.ALPHA</li>\n\t * </ul>\n\t */\n\tpublic get blendMode():string\n\t{\n\t\treturn this._pBlendMode;\n\t}\n\n\tpublic set blendMode(value:string)\n\t{\n\t\tif (this._pBlendMode == value)\n\t\t\treturn;\n\n\t\tthis._pBlendMode = value;\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\tpublic _pInvalidateRenderObject()\n\t{\n\t\tvar len:number = this._renderObjects.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._renderObjects[i].invalidateRenderObject();\n\t}\n\n\t/**\n\t * Marks the shader programs for all passes as invalid, so they will be recompiled before the next use.\n\t *\n\t * @private\n\t */\n\tpublic _pIinvalidatePasses()\n\t{\n\t\tvar len:number = this._renderObjects.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._renderObjects[i].invalidatePasses();\n\t}\n\n\t/**\n\t * A list of the IRenderableOwners that use this material\n\t *\n\t * @private\n\t */\n\tpublic get iOwners():Array<IRenderableOwner>\n\t{\n\t\treturn this._owners;\n\t}\n\n\tpublic get animator():IAnimator\n\t{\n\t\treturn this._animator;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get uvTransform():UVTransform\n\t{\n\t\treturn this._uvTransform;\n\t}\n\n\tpublic set uvTransform(value:UVTransform)\n\t{\n\t\tthis._uvTransform = value;\n\t}\n\n\t/**\n\t* The cube texture to use as the skybox.\n\t*/\n\tpublic get cubeMap():CubeTextureBase\n\t{\n\t\treturn this._cubeMap;\n\t}\n\n\tpublic set cubeMap(value:CubeTextureBase)\n\t{\n\t\tif (value && this._cubeMap && (value.format != this._cubeMap.format))\n\t\t\tthis._pInvalidateRenderObject();\n\n\t\tthis._cubeMap = value;\n\t}\n\n\t/**\n\t * Create a new Skybox object.\n\t *\n\t * @param material\tThe material with which to render the Skybox.\n\t */\n\tconstructor(cubeMap:CubeTextureBase = null)\n\t{\n\t\tsuper();\n\n\t\tthis._pIsEntity = true;\n\t\tthis._owners = new Array<IRenderableOwner>(this);\n\n\t\tthis.cubeMap = cubeMap;\n\n\t\t//default bounds type\n\t\tthis._boundsType = BoundsType.NULL;\n\t}\n\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.SKYBOX;\n\t}\n\n\tpublic get castsShadows():boolean\n\t{\n\t\treturn false; //TODO\n\t}\n\n\t/**\n\t * Cleans up resources owned by the material, including passes. Textures are not owned by the material since they\n\t * could be used by other materials and will not be disposed.\n\t */\n\tpublic dispose()\n\t{\n\t\tvar i:number;\n\t\tvar len:number;\n\n\t\tlen = this._renderObjects.length;\n\t\tfor (i = 0; i < len; i++)\n\t\t\tthis._renderObjects[i].dispose();\n\n\t\tthis._renderObjects = new Array<IRenderObject>();\n\n\t\tvar len:number = this._renderables.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._renderables[i].dispose();\n\n\t\tthis._renderables = new Array<IRenderable>();\n\t}\n\n\tpublic _iCollectRenderables(rendererPool:IRendererPool)\n\t{\n\t\t//skybox do not get collected in the standard entity list\n\t}\n\n\tpublic _iCollectRenderable(rendererPool:IRendererPool)\n\t{\n\n\t}\n\n\tpublic _iAddRenderObject(renderObject:IRenderObject):IRenderObject\n\t{\n\t\tthis._renderObjects.push(renderObject);\n\n\t\treturn renderObject;\n\t}\n\n\tpublic _iRemoveRenderObject(renderObject:IRenderObject):IRenderObject\n\t{\n\t\tthis._renderObjects.splice(this._renderObjects.indexOf(renderObject), 1);\n\n\t\treturn renderObject;\n\t}\n\n\tpublic _iAddRenderable(renderable:IRenderable):IRenderable\n\t{\n\t\tthis._renderables.push(renderable);\n\n\t\treturn renderable;\n\t}\n\n\n\tpublic _iRemoveRenderable(renderable:IRenderable):IRenderable\n\t{\n\t\tvar index:number = this._renderables.indexOf(renderable);\n\n\t\tthis._renderables.splice(index, 1);\n\n\t\treturn renderable;\n\t}\n\n\t/**\n\t *\n\t * @param renderer\n\t *\n\t * @internal\n\t */\n\tpublic getRenderObject(renderablePool:IRenderablePool)\n\t{\n\t\treturn renderablePool.getSkyboxRenderObject(this);\n\t}\n\n\tpublic _pRegisterEntity(partition:Partition)\n\t{\n\t\tpartition._iRegisterSkybox(this);\n\t}\n\n\tpublic _pUnregisterEntity(partition:Partition)\n\t{\n\t\tpartition._iUnregisterSkybox(this);\n\t}\n}\n\nexport = Skybox;","import Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\n\nimport DisplayObject\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport AntiAliasType\t\t\t\t= require(\"awayjs-display/lib/text/AntiAliasType\");\nimport GridFitType\t\t\t\t\t= require(\"awayjs-display/lib/text/GridFitType\");\nimport TextFieldAutoSize\t\t\t= require(\"awayjs-display/lib/text/TextFieldAutoSize\");\nimport TextFieldType\t\t\t\t= require(\"awayjs-display/lib/text/TextFieldType\");\nimport TextFormat\t\t\t\t\t= require(\"awayjs-display/lib/text/TextFormat\");\nimport TextInteractionMode\t\t\t= require(\"awayjs-display/lib/text/TextInteractionMode\");\nimport TextLineMetrics\t\t\t\t= require(\"awayjs-display/lib/text/TextLineMetrics\");\n\n/**\n * The TextField class is used to create display objects for text display and\n * input. <ph outputclass=\"flexonly\">You can use the TextField class to\n * perform low-level text rendering. However, in Flex, you typically use the\n * Label, Text, TextArea, and TextInput controls to process text. <ph\n * outputclass=\"flashonly\">You can give a text field an instance name in the\n * Property inspector and use the methods and properties of the TextField\n * class to manipulate it with ActionScript. TextField instance names are\n * displayed in the Movie Explorer and in the Insert Target Path dialog box in\n * the Actions panel.\n *\n * <p>To create a text field dynamically, use the <code>TextField()</code>\n * constructor.</p>\n *\n * <p>The methods of the TextField class let you set, select, and manipulate\n * text in a dynamic or input text field that you create during authoring or\n * at runtime. </p>\n *\n * <p>ActionScript provides several ways to format your text at runtime. The\n * TextFormat class lets you set character and paragraph formatting for\n * TextField objects. You can apply Cascading Style Sheets(CSS) styles to\n * text fields by using the <code>TextField.styleSheet</code> property and the\n * StyleSheet class. You can use CSS to style built-in HTML tags, define new\n * formatting tags, or apply styles. You can assign HTML formatted text, which\n * optionally uses CSS styles, directly to a text field. HTML text that you\n * assign to a text field can contain embedded media(movie clips, SWF files,\n * GIF files, PNG files, and JPEG files). The text wraps around the embedded\n * media in the same way that a web browser wraps text around media embedded\n * in an HTML document. </p>\n *\n * <p>Flash Player supports a subset of HTML tags that you can use to format\n * text. See the list of supported HTML tags in the description of the\n * <code>htmlText</code> property.</p>\n * \n * @event change                    Dispatched after a control value is\n *                                  modified, unlike the\n *                                  <code>textInput</code> event, which is\n *                                  dispatched before the value is modified.\n *                                  Unlike the W3C DOM Event Model version of\n *                                  the <code>change</code> event, which\n *                                  dispatches the event only after the\n *                                  control loses focus, the ActionScript 3.0\n *                                  version of the <code>change</code> event\n *                                  is dispatched any time the control\n *                                  changes. For example, if a user types text\n *                                  into a text field, a <code>change</code>\n *                                  event is dispatched after every keystroke.\n * @event link                      Dispatched when a user clicks a hyperlink\n *                                  in an HTML-enabled text field, where the\n *                                  URL begins with \"event:\". The remainder of\n *                                  the URL after \"event:\" is placed in the\n *                                  text property of the LINK event.\n *\n *                                  <p><b>Note:</b> The default behavior,\n *                                  adding the text to the text field, occurs\n *                                  only when Flash Player generates the\n *                                  event, which in this case happens when a\n *                                  user attempts to input text. You cannot\n *                                  put text into a text field by sending it\n *                                  <code>textInput</code> events.</p>\n * @event scroll                    Dispatched by a TextField object\n *                                  <i>after</i> the user scrolls.\n * @event textInput                 Flash Player dispatches the\n *                                  <code>textInput</code> event when a user\n *                                  enters one or more characters of text.\n *                                  Various text input methods can generate\n *                                  this event, including standard keyboards,\n *                                  input method editors(IMEs), voice or\n *                                  speech recognition systems, and even the\n *                                  act of pasting plain text with no\n *                                  formatting or style information.\n * @event textInteractionModeChange Flash Player dispatches the\n *                                  <code>textInteractionModeChange</code>\n *                                  event when a user changes the interaction\n *                                  mode of a text field. for example on\n *                                  Android, one can toggle from NORMAL mode\n *                                  to SELECTION mode using context menu\n *                                  options\n */\nclass TextField extends DisplayObject\n{\n\tprivate _bottomScrollV:number;\n\tprivate _caretIndex:number;\n\tprivate _length:number;\n\tprivate _maxScrollH:number;\n\tprivate _maxScrollV:number;\n\tprivate _numLines:number;\n\tprivate _selectionBeginIndex:number;\n\tprivate _selectionEndIndex:number;\n\tprivate _text:string = \"\";\n\tprivate _textHeight:number;\n\tprivate _textInteractionMode:TextInteractionMode;\n\tprivate _textWidth:number;\n\n\tprivate _charBoundaries:Rectangle;\n\tprivate _charIndexAtPoint:number;\n\tprivate _firstCharInParagraph:number;\n\tprivate _imageReference:DisplayObject\n\tprivate _lineIndexAtPoint:number;\n\tprivate _lineIndexOfChar:number;\n\tprivate _lineLength:number;\n\tprivate _lineMetrics:TextLineMetrics;\n\tprivate _lineOffset:number;\n\tprivate _lineText:string;\n\tprivate _paragraphLength:number;\n\tprivate _textFormat:TextFormat;\n\n\t/**\n\t * When set to <code>true</code> and the text field is not in focus, Flash\n\t * Player highlights the selection in the text field in gray. When set to\n\t * <code>false</code> and the text field is not in focus, Flash Player does\n\t * not highlight the selection in the text field.\n\t * \n\t * @default false\n\t */\n\tpublic alwaysShowSelection:boolean\n\n\t/**\n\t * The type of anti-aliasing used for this text field. Use\n\t * <code>flash.text.AntiAliasType</code> constants for this property. You can\n\t * control this setting only if the font is embedded(with the\n\t * <code>embedFonts</code> property set to <code>true</code>). The default\n\t * setting is <code>flash.text.AntiAliasType.NORMAL</code>.\n\t *\n\t * <p>To set values for this property, use the following string values:</p>\n\t */\n\tpublic antiAliasType:AntiAliasType;\n\n\t/**\n\t * Controls automatic sizing and alignment of text fields. Acceptable values\n\t * for the <code>TextFieldAutoSize</code> constants:\n\t * <code>TextFieldAutoSize.NONE</code>(the default),\n\t * <code>TextFieldAutoSize.LEFT</code>, <code>TextFieldAutoSize.RIGHT</code>,\n\t * and <code>TextFieldAutoSize.CENTER</code>.\n\t *\n\t * <p>If <code>autoSize</code> is set to <code>TextFieldAutoSize.NONE</code>\n\t * (the default) no resizing occurs.</p>\n\t *\n\t * <p>If <code>autoSize</code> is set to <code>TextFieldAutoSize.LEFT</code>,\n\t * the text is treated as left-justified text, meaning that the left margin\n\t * of the text field remains fixed and any resizing of a single line of the\n\t * text field is on the right margin. If the text includes a line break(for\n\t * example, <code>\"\\n\"</code> or <code>\"\\r\"</code>), the bottom is also\n\t * resized to fit the next line of text. If <code>wordWrap</code> is also set\n\t * to <code>true</code>, only the bottom of the text field is resized and the\n\t * right side remains fixed.</p>\n\t *\n\t * <p>If <code>autoSize</code> is set to\n\t * <code>TextFieldAutoSize.RIGHT</code>, the text is treated as\n\t * right-justified text, meaning that the right margin of the text field\n\t * remains fixed and any resizing of a single line of the text field is on\n\t * the left margin. If the text includes a line break(for example,\n\t * <code>\"\\n\" or \"\\r\")</code>, the bottom is also resized to fit the next\n\t * line of text. If <code>wordWrap</code> is also set to <code>true</code>,\n\t * only the bottom of the text field is resized and the left side remains\n\t * fixed.</p>\n\t *\n\t * <p>If <code>autoSize</code> is set to\n\t * <code>TextFieldAutoSize.CENTER</code>, the text is treated as\n\t * center-justified text, meaning that any resizing of a single line of the\n\t * text field is equally distributed to both the right and left margins. If\n\t * the text includes a line break(for example, <code>\"\\n\"</code> or\n\t * <code>\"\\r\"</code>), the bottom is also resized to fit the next line of\n\t * text. If <code>wordWrap</code> is also set to <code>true</code>, only the\n\t * bottom of the text field is resized and the left and right sides remain\n\t * fixed.</p>\n\t * \n\t * @throws ArgumentError The <code>autoSize</code> specified is not a member\n\t *                       of flash.text.TextFieldAutoSize.\n\t */\n\tpublic autoSize:TextFieldAutoSize;\n\n\t/**\n\t * Specifies whether the text field has a background fill. If\n\t * <code>true</code>, the text field has a background fill. If\n\t * <code>false</code>, the text field has no background fill. Use the\n\t * <code>backgroundColor</code> property to set the background color of a\n\t * text field.\n\t * \n\t * @default false\n\t */\n\tpublic background:boolean;\n\n\t/**\n\t * The color of the text field background. The default value is\n\t * <code>0xFFFFFF</code>(white). This property can be retrieved or set, even\n\t * if there currently is no background, but the color is visible only if the\n\t * text field has the <code>background</code> property set to\n\t * <code>true</code>.\n\t */\n\tpublic backgroundColor:number /*int*/;\n\n\t/**\n\t * Specifies whether the text field has a border. If <code>true</code>, the\n\t * text field has a border. If <code>false</code>, the text field has no\n\t * border. Use the <code>borderColor</code> property to set the border color.\n\t * \n\t * @default false\n\t */\n\tpublic border:boolean;\n\n\t/**\n\t * The color of the text field border. The default value is\n\t * <code>0x000000</code>(black). This property can be retrieved or set, even\n\t * if there currently is no border, but the color is visible only if the text\n\t * field has the <code>border</code> property set to <code>true</code>.\n\t */\n\tpublic borderColor:number /*int*/;\n\n\t/**\n\t * An integer(1-based index) that indicates the bottommost line that is\n\t * currently visible in the specified text field. Think of the text field as\n\t * a window onto a block of text. The <code>scrollV</code> property is the\n\t * 1-based index of the topmost visible line in the window.\n\t *\n\t * <p>All the text between the lines indicated by <code>scrollV</code> and\n\t * <code>bottomScrollV</code> is currently visible in the text field.</p>\n\t */\n\tpublic get bottomScrollV():number /*int*/\n\t{\n\t\treturn this._bottomScrollV;\n\t}\n\n\t/**\n\t * The index of the insertion point(caret) position. If no insertion point\n\t * is displayed, the value is the position the insertion point would be if\n\t * you restored focus to the field(typically where the insertion point last\n\t * was, or 0 if the field has not had focus).\n\t *\n\t * <p>Selection span indexes are zero-based(for example, the first position\n\t * is 0, the second position is 1, and so on).</p>\n\t */\n\tpublic get caretIndex():number /*int*/\n\t{\n\t\treturn this._caretIndex;\n\t}\n\n\t/**\n\t * A Boolean value that specifies whether extra white space(spaces, line\n\t * breaks, and so on) in a text field with HTML text is removed. The default\n\t * value is <code>false</code>. The <code>condenseWhite</code> property only\n\t * affects text set with the <code>htmlText</code> property, not the\n\t * <code>text</code> property. If you set text with the <code>text</code>\n\t * property, <code>condenseWhite</code> is ignored.\n\t *\n\t * <p>If <code>condenseWhite</code> is set to <code>true</code>, use standard\n\t * HTML commands such as <code><BR></code> and <code><P></code> to place line\n\t * breaks in the text field.</p>\n\t *\n\t * <p>Set the <code>condenseWhite</code> property before setting the\n\t * <code>htmlText</code> property.</p>\n\t */\n\tpublic condenseWhite:boolean;\n\n\t/**\n\t * Specifies the format applied to newly inserted text, such as text entered\n\t * by a user or text inserted with the <code>replaceSelectedText()</code>\n\t * method.\n\t *\n\t * <p><b>Note:</b> When selecting characters to be replaced with\n\t * <code>setSelection()</code> and <code>replaceSelectedText()</code>, the\n\t * <code>defaultTextFormat</code> will be applied only if the text has been\n\t * selected up to and including the last character. Here is an example:</p>\n\t * <pre xml:space=\"preserve\"> public my_txt:TextField new TextField();\n\t * my_txt.text = \"Flash Macintosh version\"; public my_fmt:TextFormat = new\n\t * TextFormat(); my_fmt.color = 0xFF0000; my_txt.defaultTextFormat = my_fmt;\n\t * my_txt.setSelection(6,15); // partial text selected - defaultTextFormat\n\t * not applied my_txt.setSelection(6,23); // text selected to end -\n\t * defaultTextFormat applied my_txt.replaceSelectedText(\"Windows version\");\n\t * </pre>\n\t *\n\t * <p>When you access the <code>defaultTextFormat</code> property, the\n\t * returned TextFormat object has all of its properties defined. No property\n\t * is <code>null</code>.</p>\n\t *\n\t * <p><b>Note:</b> You can't set this property if a style sheet is applied to\n\t * the text field.</p>\n\t * \n\t * @throws Error This method cannot be used on a text field with a style\n\t *               sheet.\n\t */\n\tpublic defaultTextFormat:TextFormat;\n\n\t/**\n\t * Specifies whether the text field is a password text field. If the value of\n\t * this property is <code>true</code>, the text field is treated as a\n\t * password text field and hides the input characters using asterisks instead\n\t * of the actual characters. If <code>false</code>, the text field is not\n\t * treated as a password text field. When password mode is enabled, the Cut\n\t * and Copy commands and their corresponding keyboard shortcuts will not\n\t * function. This security mechanism prevents an unscrupulous user from using\n\t * the shortcuts to discover a password on an unattended computer.\n\t * \n\t * @default false\n\t */\n\tpublic displayAsPassword:boolean;\n\n\t/**\n\t * Specifies whether to render by using embedded font outlines. If\n\t * <code>false</code>, Flash Player renders the text field by using device\n\t * fonts.\n\t *\n\t * <p>If you set the <code>embedFonts</code> property to <code>true</code>\n\t * for a text field, you must specify a font for that text by using the\n\t * <code>font</code> property of a TextFormat object applied to the text\n\t * field. If the specified font is not embedded in the SWF file, the text is\n\t * not displayed.</p>\n\t * \n\t * @default false\n\t */\n\tpublic embedFonts:boolean;\n\n\t/**\n\t * The type of grid fitting used for this text field. This property applies\n\t * only if the <code>flash.text.AntiAliasType</code> property of the text\n\t * field is set to <code>flash.text.AntiAliasType.ADVANCED</code>.\n\t *\n\t * <p>The type of grid fitting used determines whether Flash Player forces\n\t * strong horizontal and vertical lines to fit to a pixel or subpixel grid,\n\t * or not at all.</p>\n\t *\n\t * <p>For the <code>flash.text.GridFitType</code> property, you can use the\n\t * following string values:</p>\n\t * \n\t * @default pixel\n\t */\n\tpublic gridFitType:GridFitType;\n\n\t/**\n\t * Contains the HTML representation of the text field contents.\n\t *\n\t * <p>Flash Player supports the following HTML tags:</p>\n\t *\n\t * <p>Flash Player and AIR also support explicit character codes, such as\n\t * &#38;(ASCII ampersand) and &#x20AC;(Unicode  symbol). </p>\n\t */\n\tpublic htmlText:string;\n\n\t/**\n\t * The number of characters in a text field. A character such as tab\n\t * (<code>\\t</code>) counts as one character.\n\t */\n\tpublic get length():number /*int*/\n\t{\n\t\treturn this._length;\n\t}\n\n\t/**\n\t * The maximum number of characters that the text field can contain, as\n\t * entered by a user. A script can insert more text than\n\t * <code>maxChars</code> allows; the <code>maxChars</code> property indicates\n\t * only how much text a user can enter. If the value of this property is\n\t * <code>0</code>, a user can enter an unlimited amount of text.\n\t * \n\t * @default 0\n\t */\n\tpublic maxChars:number /*int*/;\n\n\t/**\n\t * The maximum value of <code>scrollH</code>.\n\t */\n\tpublic maxScrollH():number /*int*/\n\t{\n\t\treturn this._maxScrollH;\n\t}\n\n\t/**\n\t * The maximum value of <code>scrollV</code>.\n\t */\n\tpublic maxScrollV():number /*int*/\n\t{\n\t\treturn this._maxScrollV;\n\t}\n\n\t/**\n\t * A Boolean value that indicates whether Flash Player automatically scrolls\n\t * multiline text fields when the user clicks a text field and rolls the\n\t * mouse wheel. By default, this value is <code>true</code>. This property is\n\t * useful if you want to prevent mouse wheel scrolling of text fields, or\n\t * implement your own text field scrolling.\n\t */\n\tpublic mouseWheelEnabled:boolean;\n\n\t/**\n\t * Indicates whether field is a multiline text field. If the value is\n\t * <code>true</code>, the text field is multiline; if the value is\n\t * <code>false</code>, the text field is a single-line text field. In a field\n\t * of type <code>TextFieldType.INPUT</code>, the <code>multiline</code> value\n\t * determines whether the <code>Enter</code> key creates a new line(a value\n\t * of <code>false</code>, and the <code>Enter</code> key is ignored). If you\n\t * paste text into a <code>TextField</code> with a <code>multiline</code>\n\t * value of <code>false</code>, newlines are stripped out of the text.\n\t * \n\t * @default false\n\t */\n\tpublic multiline:boolean;\n\n\t/**\n\t * Defines the number of text lines in a multiline text field. If\n\t * <code>wordWrap</code> property is set to <code>true</code>, the number of\n\t * lines increases when text wraps.\n\t */\n\tpublic get numLines():number /*int*/\n\t{\n\t\treturn this._numLines;\n\t}\n\n\t/**\n\t * Indicates the set of characters that a user can enter into the text field.\n\t * If the value of the <code>restrict</code> property is <code>null</code>,\n\t * you can enter any character. If the value of the <code>restrict</code>\n\t * property is an empty string, you cannot enter any character. If the value\n\t * of the <code>restrict</code> property is a string of characters, you can\n\t * enter only characters in the string into the text field. The string is\n\t * scanned from left to right. You can specify a range by using the hyphen\n\t * (-) character. Only user interaction is restricted; a script can put any\n\t * text into the text field. <ph outputclass=\"flashonly\">This property does\n\t * not synchronize with the Embed font options in the Property inspector.\n\t *\n\t * <p>If the string begins with a caret(^) character, all characters are\n\t * initially accepted and succeeding characters in the string are excluded\n\t * from the set of accepted characters. If the string does not begin with a\n\t * caret(^) character, no characters are initially accepted and succeeding\n\t * characters in the string are included in the set of accepted\n\t * characters.</p>\n\t *\n\t * <p>The following example allows only uppercase characters, spaces, and\n\t * numbers to be entered into a text field:</p>\n\t * <pre xml:space=\"preserve\"> my_txt.restrict = \"A-Z 0-9\"; </pre>\n\t *\n\t * <p>The following example includes all characters, but excludes lowercase\n\t * letters:</p>\n\t * <pre xml:space=\"preserve\"> my_txt.restrict = \"^a-z\"; </pre>\n\t *\n\t * <p>You can use a backslash to enter a ^ or - verbatim. The accepted\n\t * backslash sequences are \\-, \\^ or \\\\. The backslash must be an actual\n\t * character in the string, so when specified in ActionScript, a double\n\t * backslash must be used. For example, the following code includes only the\n\t * dash(-) and caret(^):</p>\n\t * <pre xml:space=\"preserve\"> my_txt.restrict = \"\\\\-\\\\^\"; </pre>\n\t *\n\t * <p>The ^ can be used anywhere in the string to toggle between including\n\t * characters and excluding characters. The following code includes only\n\t * uppercase letters, but excludes the uppercase letter Q:</p>\n\t * <pre xml:space=\"preserve\"> my_txt.restrict = \"A-Z^Q\"; </pre>\n\t *\n\t * <p>You can use the <code>\\u</code> escape sequence to construct\n\t * <code>restrict</code> strings. The following code includes only the\n\t * characters from ASCII 32(space) to ASCII 126(tilde).</p>\n\t * <pre xml:space=\"preserve\"> my_txt.restrict = \"\\u0020-\\u007E\"; </pre>\n\t * \n\t * @default null\n\t */\n\tpublic restrict:string;\n\n\t/**\n\t * The current horizontal scrolling position. If the <code>scrollH</code>\n\t * property is 0, the text is not horizontally scrolled. This property value\n\t * is an integer that represents the horizontal position in pixels.\n\t *\n\t * <p>The units of horizontal scrolling are pixels, whereas the units of\n\t * vertical scrolling are lines. Horizontal scrolling is measured in pixels\n\t * because most fonts you typically use are proportionally spaced; that is,\n\t * the characters can have different widths. Flash Player performs vertical\n\t * scrolling by line because users usually want to see a complete line of\n\t * text rather than a partial line. Even if a line uses multiple fonts, the\n\t * height of the line adjusts to fit the largest font in use.</p>\n\t *\n\t * <p><b>Note: </b>The <code>scrollH</code> property is zero-based, not\n\t * 1-based like the <code>scrollV</code> vertical scrolling property.</p>\n\t */\n\tpublic scrollH:number;\n\n\t/**\n\t * The vertical position of text in a text field. The <code>scrollV</code>\n\t * property is useful for directing users to a specific paragraph in a long\n\t * passage, or creating scrolling text fields.\n\t *\n\t * <p>The units of vertical scrolling are lines, whereas the units of\n\t * horizontal scrolling are pixels. If the first line displayed is the first\n\t * line in the text field, scrollV is set to 1(not 0). Horizontal scrolling\n\t * is measured in pixels because most fonts are proportionally spaced; that\n\t * is, the characters can have different widths. Flash performs vertical\n\t * scrolling by line because users usually want to see a complete line of\n\t * text rather than a partial line. Even if there are multiple fonts on a\n\t * line, the height of the line adjusts to fit the largest font in use.</p>\n\t */\n\tpublic scrollV:number;\n\n\t/**\n\t * A Boolean value that indicates whether the text field is selectable. The\n\t * value <code>true</code> indicates that the text is selectable. The\n\t * <code>selectable</code> property controls whether a text field is\n\t * selectable, not whether a text field is editable. A dynamic text field can\n\t * be selectable even if it is not editable. If a dynamic text field is not\n\t * selectable, the user cannot select its text.\n\t *\n\t * <p>If <code>selectable</code> is set to <code>false</code>, the text in\n\t * the text field does not respond to selection commands from the mouse or\n\t * keyboard, and the text cannot be copied with the Copy command. If\n\t * <code>selectable</code> is set to <code>true</code>, the text in the text\n\t * field can be selected with the mouse or keyboard, and the text can be\n\t * copied with the Copy command. You can select text this way even if the\n\t * text field is a dynamic text field instead of an input text field. </p>\n\t * \n\t * @default true\n\t */\n\tpublic selectable:boolean;\n\n\t/**\n\t * The zero-based character index value of the first character in the current\n\t * selection. For example, the first character is 0, the second character is\n\t * 1, and so on. If no text is selected, this property is the value of\n\t * <code>caretIndex</code>.\n\t */\n\tpublic get selectionBeginIndex():number /*int*/\n\t{\n\t\treturn this._selectionBeginIndex;\n\t}\n\n\t/**\n\t * The zero-based character index value of the last character in the current\n\t * selection. For example, the first character is 0, the second character is\n\t * 1, and so on. If no text is selected, this property is the value of\n\t * <code>caretIndex</code>.\n\t */\n\tpublic get selectionEndIndex():number /*int*/\n\t{\n\t\treturn this._selectionEndIndex;\n\t}\n\n\t/**\n\t * The sharpness of the glyph edges in this text field. This property applies\n\t * only if the <code>flash.text.AntiAliasType</code> property of the text\n\t * field is set to <code>flash.text.AntiAliasType.ADVANCED</code>. The range\n\t * for <code>sharpness</code> is a number from -400 to 400. If you attempt to\n\t * set <code>sharpness</code> to a value outside that range, Flash sets the\n\t * property to the nearest value in the range(either -400 or 400).\n\t * \n\t * @default 0\n\t */\n\tpublic sharpness:number;\n\n\t/**\n\t * Attaches a style sheet to the text field. For information on creating\n\t * style sheets, see the StyleSheet class and the <i>ActionScript 3.0\n\t * Developer's Guide</i>.\n\t *\n\t * <p>You can change the style sheet associated with a text field at any\n\t * time. If you change the style sheet in use, the text field is redrawn with\n\t * the new style sheet. You can set the style sheet to <code>null</code> or\n\t * <code>undefined</code> to remove the style sheet. If the style sheet in\n\t * use is removed, the text field is redrawn without a style sheet. </p>\n\t *\n\t * <p><b>Note:</b> If the style sheet is removed, the contents of both\n\t * <code>TextField.text</code> and <code> TextField.htmlText</code> change to\n\t * incorporate the formatting previously applied by the style sheet. To\n\t * preserve the original <code>TextField.htmlText</code> contents without the\n\t * formatting, save the value in a variable before removing the style\n\t * sheet.</p>\n\t */\n\tpublic styleSheet:StyleSheet;\n\n\t/**\n\t * A string that is the current text in the text field. Lines are separated\n\t * by the carriage return character(<code>'\\r'</code>, ASCII 13). This\n\t * property contains unformatted text in the text field, without HTML tags.\n\t *\n\t * <p>To get the text in HTML form, use the <code>htmlText</code>\n\t * property.</p>\n\t */\n\tpublic get text():string\n\t{\n\t\treturn this._text;\n\t}\n\n\tpublic set text(value:string)\n\t{\n\t\tif (this._text == value)\n\t\t\treturn;\n\n\t\tthis._text = value;\n\t}\n\n\t/**\n\t * The color of the text in a text field, in hexadecimal format. The\n\t * hexadecimal color system uses six digits to represent color values. Each\n\t * digit has 16 possible values or characters. The characters range from 0-9\n\t * and then A-F. For example, black is <code>0x000000</code>; white is\n\t * <code>0xFFFFFF</code>.\n\t * \n\t * @default 0(0x000000)\n\t */\n\tpublic textColor:number /*int*/;\n\n\t/**\n\t * The height of the text in pixels.\n\t */\n\tpublic get textHeight():number\n\t{\n\t\treturn this._textHeight;\n\t}\n\n\t/**\n\t * The interaction mode property, Default value is\n\t * TextInteractionMode.NORMAL. On mobile platforms, the normal mode implies\n\t * that the text can be scrolled but not selected. One can switch to the\n\t * selectable mode through the in-built context menu on the text field. On\n\t * Desktop, the normal mode implies that the text is in scrollable as well as\n\t * selection mode.\n\t */\n\tpublic get textInteractionMode():TextInteractionMode\n\t{\n\t\treturn this._textInteractionMode;\n\t}\n\n\t/**\n\t * The width of the text in pixels.\n\t */\n\tpublic get textWidth():number\n\t{\n\t\treturn this._textWidth;\n\t}\n\n\t/**\n\t * The thickness of the glyph edges in this text field. This property applies\n\t * only when <code>AntiAliasType</code> is set to\n\t * <code>AntiAliasType.ADVANCED</code>.\n\t *\n\t * <p>The range for <code>thickness</code> is a number from -200 to 200. If\n\t * you attempt to set <code>thickness</code> to a value outside that range,\n\t * the property is set to the nearest value in the range(either -200 or\n\t * 200).</p>\n\t * \n\t * @default 0\n\t */\n\tpublic thickness:number;\n\n\t/**\n\t * The type of the text field. Either one of the following TextFieldType\n\t * constants: <code>TextFieldType.DYNAMIC</code>, which specifies a dynamic\n\t * text field, which a user cannot edit, or <code>TextFieldType.INPUT</code>,\n\t * which specifies an input text field, which a user can edit.\n\t * \n\t * @default dynamic\n\t * @throws ArgumentError The <code>type</code> specified is not a member of\n\t *                       flash.text.TextFieldType.\n\t */\n\tpublic type:TextFieldType;\n\n\t/**\n\t * Specifies whether to copy and paste the text formatting along with the\n\t * text. When set to <code>true</code>, Flash Player copies and pastes\n\t * formatting(such as alignment, bold, and italics) when you copy and paste\n\t * between text fields. Both the origin and destination text fields for the\n\t * copy and paste procedure must have <code>useRichTextClipboard</code> set\n\t * to <code>true</code>. The default value is <code>false</code>.\n\t */\n\tpublic useRichTextClipboard:boolean;\n\n\t/**\n\t * A Boolean value that indicates whether the text field has word wrap. If\n\t * the value of <code>wordWrap</code> is <code>true</code>, the text field\n\t * has word wrap; if the value is <code>false</code>, the text field does not\n\t * have word wrap. The default value is <code>false</code>.\n\t */\n\tpublic wordWrap:boolean;\n\n\t/**\n\t * Creates a new TextField instance. After you create the TextField instance,\n\t * call the <code>addChild()</code> or <code>addChildAt()</code> method of\n\t * the parent DisplayObjectContainer object to add the TextField instance to\n\t * the display list.\n\t *\n\t * <p>The default size for a text field is 100 x 100 pixels.</p>\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * Appends the string specified by the <code>newText</code> parameter to the\n\t * end of the text of the text field. This method is more efficient than an\n\t * addition assignment(<code>+=</code>) on a <code>text</code> property\n\t * (such as <code>someTextField.text += moreText</code>), particularly for a\n\t * text field that contains a significant amount of content.\n\t * \n\t * @param newText The string to append to the existing text.\n\t */\n\tpublic appendText(newText:string)\n\t{\n\t\t//TODO\n\t}\n\n\t/**\n\t * Returns a rectangle that is the bounding box of the character.\n\t * \n\t * @param charIndex The zero-based index value for the character(for\n\t *                  example, the first position is 0, the second position is\n\t *                  1, and so on).\n\t * @return A rectangle with <code>x</code> and <code>y</code> minimum and\n\t *         maximum values defining the bounding box of the character.\n\t */\n\tpublic getCharBoundaries(charIndex:number):Rectangle\n\t{\n\t\treturn this._charBoundaries;\n\t}\n\n\t/**\n\t * Returns the zero-based index value of the character at the point specified\n\t * by the <code>x</code> and <code>y</code> parameters.\n\t * \n\t * @param x The <i>x</i> coordinate of the character.\n\t * @param y The <i>y</i> coordinate of the character.\n\t * @return The zero-based index value of the character(for example, the\n\t *         first position is 0, the second position is 1, and so on). Returns\n\t *         -1 if the point is not over any character.\n\t */\n\tpublic getCharIndexAtPoint(x:number, y:number):number /*int*/\n\t{\n\t\treturn this._charIndexAtPoint;\n\t}\n\n\t/**\n\t * Given a character index, returns the index of the first character in the\n\t * same paragraph.\n\t * \n\t * @param charIndex The zero-based index value of the character(for example,\n\t *                  the first character is 0, the second character is 1, and\n\t *                  so on).\n\t * @return The zero-based index value of the first character in the same\n\t *         paragraph.\n\t * @throws RangeError The character index specified is out of range.\n\t */\n\tpublic getFirstCharInParagraph(charIndex:number /*int*/):number /*int*/\n\t{\n\t\treturn this._firstCharInParagraph;\n\t}\n\n\t/**\n\t * Returns a DisplayObject reference for the given <code>id</code>, for an\n\t * image or SWF file that has been added to an HTML-formatted text field by\n\t * using an <code><img></code> tag. The <code><img></code> tag is in the\n\t * following format:\n\t *\n\t * <p><pre xml:space=\"preserve\"><code> <img src = 'filename.jpg' id =\n\t * 'instanceName' ></code></pre></p>\n\t * \n\t * @param id The <code>id</code> to match(in the <code>id</code> attribute\n\t *           of the <code><img></code> tag).\n\t * @return The display object corresponding to the image or SWF file with the\n\t *         matching <code>id</code> attribute in the <code><img></code> tag\n\t *         of the text field. For media loaded from an external source, this\n\t *         object is a Loader object, and, once loaded, the media object is a\n\t *         child of that Loader object. For media embedded in the SWF file,\n\t *         it is the loaded object. If no <code><img></code> tag with the\n\t *         matching <code>id</code> exists, the method returns\n\t *         <code>null</code>.\n\t */\n\tpublic getImageReference(id:string):DisplayObject\n\t{\n\t\treturn this._imageReference;\n\t}\n\n\t/**\n\t * Returns the zero-based index value of the line at the point specified by\n\t * the <code>x</code> and <code>y</code> parameters.\n\t * \n\t * @param x The <i>x</i> coordinate of the line.\n\t * @param y The <i>y</i> coordinate of the line.\n\t * @return The zero-based index value of the line(for example, the first\n\t *         line is 0, the second line is 1, and so on). Returns -1 if the\n\t *         point is not over any line.\n\t */\n\tpublic getLineIndexAtPoint(x:number, y:number):number /*int*/\n\t{\n\t\treturn this._lineIndexAtPoint;\n\t}\n\n\t/**\n\t * Returns the zero-based index value of the line containing the character\n\t * specified by the <code>charIndex</code> parameter.\n\t * \n\t * @param charIndex The zero-based index value of the character(for example,\n\t *                  the first character is 0, the second character is 1, and\n\t *                  so on).\n\t * @return The zero-based index value of the line.\n\t * @throws RangeError The character index specified is out of range.\n\t */\n\tpublic getLineIndexOfChar(charIndex:number /*int*/):number /*int*/\n\t{\n\t\treturn this._lineIndexOfChar;\n\t}\n\n\t/**\n\t * Returns the number of characters in a specific text line.\n\t * \n\t * @param lineIndex The line number for which you want the length.\n\t * @return The number of characters in the line.\n\t * @throws RangeError The line number specified is out of range.\n\t */\n\tpublic getLineLength(lineIndex:number /*int*/):number /*int*/\n\t{\n\t\treturn this._lineLength;\n\t}\n\n\t/**\n\t * Returns metrics information about a given text line.\n\t * \n\t * @param lineIndex The line number for which you want metrics information.\n\t * @return A TextLineMetrics object.\n\t * @throws RangeError The line number specified is out of range.\n\t */\n\tpublic getLineMetrics(lineIndex:number /*int*/):TextLineMetrics\n\t{\n\t\treturn this._lineMetrics;\n\t}\n\n\t/**\n\t * Returns the character index of the first character in the line that the\n\t * <code>lineIndex</code> parameter specifies.\n\t * \n\t * @param lineIndex The zero-based index value of the line(for example, the\n\t *                  first line is 0, the second line is 1, and so on).\n\t * @return The zero-based index value of the first character in the line.\n\t * @throws RangeError The line number specified is out of range.\n\t */\n\tpublic getLineOffset(lineIndex:number /*int*/):number /*int*/\n\t{\n\t\treturn this._lineOffset;\n\t}\n\n\t/**\n\t * Returns the text of the line specified by the <code>lineIndex</code>\n\t * parameter.\n\t * \n\t * @param lineIndex The zero-based index value of the line(for example, the\n\t *                  first line is 0, the second line is 1, and so on).\n\t * @return The text string contained in the specified line.\n\t * @throws RangeError The line number specified is out of range.\n\t */\n\tpublic getLineText(lineIndex:number /*int*/):string\n\t{\n\t\treturn this._lineText;\n\t}\n\n\t/**\n\t * Given a character index, returns the length of the paragraph containing\n\t * the given character. The length is relative to the first character in the\n\t * paragraph(as returned by <code>getFirstCharInParagraph()</code>), not to\n\t * the character index passed in.\n\t * \n\t * @param charIndex The zero-based index value of the character(for example,\n\t *                  the first character is 0, the second character is 1, and\n\t *                  so on).\n\t * @return Returns the number of characters in the paragraph.\n\t * @throws RangeError The character index specified is out of range.\n\t */\n\tpublic getParagraphLength(charIndex:number /*int*/):number /*int*/\n\t{\n\t\treturn this._paragraphLength;\n\t}\n\n\t/**\n\t * Returns a TextFormat object that contains formatting information for the\n\t * range of text that the <code>beginIndex</code> and <code>endIndex</code>\n\t * parameters specify. Only properties that are common to the entire text\n\t * specified are set in the resulting TextFormat object. Any property that is\n\t * <i>mixed</i>, meaning that it has different values at different points in\n\t * the text, has a value of <code>null</code>.\n\t *\n\t * <p>If you do not specify values for these parameters, this method is\n\t * applied to all the text in the text field. </p>\n\t *\n\t * <p>The following table describes three possible usages:</p>\n\t * \n\t * @return The TextFormat object that represents the formatting properties\n\t *         for the specified text.\n\t * @throws RangeError The <code>beginIndex</code> or <code>endIndex</code>\n\t *                    specified is out of range.\n\t */\n\tpublic getTextFormat(beginIndex:number /*int*/ = -1, endIndex:number /*int*/ = -1):TextFormat\n\t{\n\t\treturn this._textFormat;\n\t}\n\n\t/**\n\t * Replaces the current selection with the contents of the <code>value</code>\n\t * parameter. The text is inserted at the position of the current selection,\n\t * using the current default character format and default paragraph format.\n\t * The text is not treated as HTML.\n\t *\n\t * <p>You can use the <code>replaceSelectedText()</code> method to insert and\n\t * delete text without disrupting the character and paragraph formatting of\n\t * the rest of the text.</p>\n\t *\n\t * <p><b>Note:</b> This method does not work if a style sheet is applied to\n\t * the text field.</p>\n\t * \n\t * @param value The string to replace the currently selected text.\n\t * @throws Error This method cannot be used on a text field with a style\n\t *               sheet.\n\t */\n\tpublic replaceSelectedText(value:string)\n\t{\n\n\t}\n\n\t/**\n\t * Replaces the range of characters that the <code>beginIndex</code> and\n\t * <code>endIndex</code> parameters specify with the contents of the\n\t * <code>newText</code> parameter. As designed, the text from\n\t * <code>beginIndex</code> to <code>endIndex-1</code> is replaced.\n\t *\n\t * <p><b>Note:</b> This method does not work if a style sheet is applied to\n\t * the text field.</p>\n\t * \n\t * @param beginIndex The zero-based index value for the start position of the\n\t *                   replacement range.\n\t * @param endIndex   The zero-based index position of the first character\n\t *                   after the desired text span.\n\t * @param newText    The text to use to replace the specified range of\n\t *                   characters.\n\t * @throws Error This method cannot be used on a text field with a style\n\t *               sheet.\n\t */\n\tpublic replaceText(beginIndex:number /*int*/, endIndex:number /*int*/, newText:string)\n\t{\n\n\t}\n\n\t/**\n\t * Sets as selected the text designated by the index values of the first and\n\t * last characters, which are specified with the <code>beginIndex</code> and\n\t * <code>endIndex</code> parameters. If the two parameter values are the\n\t * same, this method sets the insertion point, as if you set the\n\t * <code>caretIndex</code> property.\n\t * \n\t * @param beginIndex The zero-based index value of the first character in the\n\t *                   selection(for example, the first character is 0, the\n\t *                   second character is 1, and so on).\n\t * @param endIndex   The zero-based index value of the last character in the\n\t *                   selection.\n\t */\n\tpublic setSelection(beginIndex:number /*int*/, endIndex:number /*int*/)\n\t{\n\n\t}\n\n\t/**\n\t * Applies the text formatting that the <code>format</code> parameter\n\t * specifies to the specified text in a text field. The value of\n\t * <code>format</code> must be a TextFormat object that specifies the desired\n\t * text formatting changes. Only the non-null properties of\n\t * <code>format</code> are applied to the text field. Any property of\n\t * <code>format</code> that is set to <code>null</code> is not applied. By\n\t * default, all of the properties of a newly created TextFormat object are\n\t * set to <code>null</code>.\n\t *\n\t * <p><b>Note:</b> This method does not work if a style sheet is applied to\n\t * the text field.</p>\n\t *\n\t * <p>The <code>setTextFormat()</code> method changes the text formatting\n\t * applied to a range of characters or to the entire body of text in a text\n\t * field. To apply the properties of format to all text in the text field, do\n\t * not specify values for <code>beginIndex</code> and <code>endIndex</code>.\n\t * To apply the properties of the format to a range of text, specify values\n\t * for the <code>beginIndex</code> and the <code>endIndex</code> parameters.\n\t * You can use the <code>length</code> property to determine the index\n\t * values.</p>\n\t *\n\t * <p>The two types of formatting information in a TextFormat object are\n\t * character level formatting and paragraph level formatting. Each character\n\t * in a text field can have its own character formatting settings, such as\n\t * font name, font size, bold, and italic.</p>\n\t *\n\t * <p>For paragraphs, the first character of the paragraph is examined for\n\t * the paragraph formatting settings for the entire paragraph. Examples of\n\t * paragraph formatting settings are left margin, right margin, and\n\t * indentation.</p>\n\t *\n\t * <p>Any text inserted manually by the user, or replaced by the\n\t * <code>replaceSelectedText()</code> method, receives the default text field\n\t * formatting for new text, and not the formatting specified for the text\n\t * insertion point. To set the default formatting for new text, use\n\t * <code>defaultTextFormat</code>.</p>\n\t * \n\t * @param format A TextFormat object that contains character and paragraph\n\t *               formatting information.\n\t * @throws Error      This method cannot be used on a text field with a style\n\t *                    sheet.\n\t * @throws RangeError The <code>beginIndex</code> or <code>endIndex</code>\n\t *                    specified is out of range.\n\t */\n\tpublic setTextFormat(format:TextFormat, beginIndex:number /*int*/ = -1, endIndex:number /*int*/ = -1)\n\t{\n\n\t}\n\n\t/**\n\t * Returns true if an embedded font is available with the specified\n\t * <code>fontName</code> and <code>fontStyle</code> where\n\t * <code>Font.fontType</code> is <code>flash.text.FontType.EMBEDDED</code>.\n\t * Starting with Flash Player 10, two kinds of embedded fonts can appear in a\n\t * SWF file. Normal embedded fonts are only used with TextField objects. CFF\n\t * embedded fonts are only used with the flash.text.engine classes. The two\n\t * types are distinguished by the <code>fontType</code> property of the\n\t * <code>Font</code> class, as returned by the <code>enumerateFonts()</code>\n\t * function.\n\t *\n\t * <p>TextField cannot use a font of type <code>EMBEDDED_CFF</code>. If\n\t * <code>embedFonts</code> is set to <code>true</code> and the only font\n\t * available at run time with the specified name and style is of type\n\t * <code>EMBEDDED_CFF</code>, Flash Player fails to render the text, as if no\n\t * embedded font were available with the specified name and style.</p>\n\t *\n\t * <p>If both <code>EMBEDDED</code> and <code>EMBEDDED_CFF</code> fonts are\n\t * available with the same name and style, the <code>EMBEDDED</code> font is\n\t * selected and text renders with the <code>EMBEDDED</code> font.</p>\n\t * \n\t * @param fontName  The name of the embedded font to check.\n\t * @param fontStyle Specifies the font style to check. Use\n\t *                  <code>flash.text.FontStyle</code>\n\t * @return <code>true</code> if a compatible embedded font is available,\n\t *         otherwise <code>false</code>.\n\t * @throws ArgumentError The <code>fontStyle</code> specified is not a member\n\t *                       of <code>flash.text.FontStyle</code>.\n\t */\n\tpublic static isFontCompatible(fontName:string, fontStyle:string):boolean\n\t{\n\t\treturn false;\n\t}\n}\n\nexport = TextField;","import Error\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\n\nclass CastError extends Error\n{\n\tconstructor(message:string)\n\t{\n\t\tsuper(message);\n\t}\n}\n\nexport = CastError;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nimport Camera\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\n/**\n * @class away.events.CameraEvent\n */\nclass CameraEvent extends Event\n{\n\tpublic static PROJECTION_CHANGED:string = \"projectionChanged\";\n\n\tprivate _camera:Camera;\n\n\tconstructor(type:string, camera:Camera)\n\t{\n\t\tsuper(type);\n\n\t\tthis._camera = camera;\n\t}\n\n\tpublic get camera():Camera\n\t{\n\t\treturn this._camera;\n\t}\n}\n\nexport = CameraEvent;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nimport DisplayObject\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\n\nclass DisplayObjectEvent extends Event\n{\n\tpublic static VISIBLITY_UPDATED:string = \"visiblityUpdated\";\n\tpublic static SCENETRANSFORM_CHANGED:string = \"scenetransformChanged\";\n\tpublic static SCENE_CHANGED:string = \"sceneChanged\";\n\tpublic static POSITION_CHANGED:string = \"positionChanged\";\n\tpublic static ROTATION_CHANGED:string = \"rotationChanged\";\n\tpublic static SCALE_CHANGED:string = \"scaleChanged\";\n\n\tpublic object:DisplayObject;\n\n\tconstructor(type:string, object:DisplayObject)\n\t{\n\t\tsuper(type);\n\t\tthis.object = object;\n\t}\n}\n\nexport = DisplayObjectEvent;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nimport SubGeometryBase\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\n\n/**\n* Dispatched to notify changes in a geometry object's state.\n*\n* @class away.events.GeometryEvent\n* @see away3d.core.base.Geometry\n*/\nclass GeometryEvent extends Event\n{\n\t/**\n\t * Dispatched when a TriangleSubGeometry was added to the dispatching Geometry.\n\t */\n\tpublic static SUB_GEOMETRY_ADDED:string = \"SubGeometryAdded\";\n\n\t/**\n\t * Dispatched when a TriangleSubGeometry was removed from the dispatching Geometry.\n\t */\n\tpublic static SUB_GEOMETRY_REMOVED:string = \"SubGeometryRemoved\";\n\n\tpublic static BOUNDS_INVALID:string = \"BoundsInvalid\";\n\n\tprivate _subGeometry:SubGeometryBase;\n\n\t/**\n\t * Create a new GeometryEvent\n\t * @param type The event type.\n\t * @param subGeometry An optional TriangleSubGeometry object that is the subject of this event.\n\t */\n\tconstructor(type:string, subGeometry:SubGeometryBase = null)\n\t{\n\t\tsuper(type);\n\n\t\tthis._subGeometry = subGeometry;\n\t}\n\n\t/**\n\t * The TriangleSubGeometry object that is the subject of this event, if appropriate.\n\t */\n\tpublic get subGeometry():SubGeometryBase\n\t{\n\t\treturn this._subGeometry;\n\t}\n\n\t/**\n\t * Clones the event.\n\t * @return An exact duplicate of the current object.\n\t */\n\tpublic clone():Event\n\t{\n\t\treturn new GeometryEvent(this.type, this._subGeometry);\n\t}\n}\n\nexport = GeometryEvent;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nclass LightEvent extends Event\n{\n\n\tpublic static CASTS_SHADOW_CHANGE:string = \"castsShadowChange\";\n\n\tconstructor(type:string)\n\t{\n\t\tsuper(type);\n\t}\n\n\t//@override\n\tpublic clone():Event\n\t{\n\t\treturn new LightEvent(this.type);\n\t}\n}\n\nexport = LightEvent;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nclass MaterialEvent extends Event\n{\n\tpublic static SIZE_CHANGED:string = \"sizeChanged\";\n\n\tconstructor(type:string)\n\t{\n\t\tsuper(type);\n\t}\n}\n\nexport = MaterialEvent;","import Point\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\nimport Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nimport DisplayObject\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport IRenderableOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\nimport View\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/View\");\nimport MaterialBase\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\n\n/**\n * A MouseEvent is dispatched when a mouse event occurs over a mouseEnabled object in View.\n * TODO: we don't have screenZ data, tho this should be easy to implement\n */\nclass MouseEvent extends Event\n{\n\t// Private.\n\tpublic _iAllowedToPropagate:boolean = true;\n\tpublic _iParentEvent:MouseEvent;\n\n\t/**\n\t * Defines the value of the type property of a mouseOver3d event object.\n\t */\n\tpublic static MOUSE_OVER:string = \"mouseOver3d\";\n\n\t/**\n\t * Defines the value of the type property of a mouseOut3d event object.\n\t */\n\tpublic static MOUSE_OUT:string = \"mouseOut3d\";\n\n\t/**\n\t * Defines the value of the type property of a mouseUp3d event object.\n\t */\n\tpublic static MOUSE_UP:string = \"mouseUp3d\";\n\n\t/**\n\t * Defines the value of the type property of a mouseDown3d event object.\n\t */\n\tpublic static MOUSE_DOWN:string = \"mouseDown3d\";\n\n\t/**\n\t * Defines the value of the type property of a mouseMove3d event object.\n\t */\n\tpublic static MOUSE_MOVE:string = \"mouseMove3d\";\n\n\t/**\n\t * Defines the value of the type property of a rollOver3d event object.\n\t */\n//\t\tpublic static ROLL_OVER : string = \"rollOver3d\";\n\n\t/**\n\t * Defines the value of the type property of a rollOut3d event object.\n\t */\n//\t\tpublic static ROLL_OUT : string = \"rollOut3d\";\n\n\t/**\n\t * Defines the value of the type property of a click3d event object.\n\t */\n\tpublic static CLICK:string = \"click3d\";\n\n\t/**\n\t * Defines the value of the type property of a doubleClick3d event object.\n\t */\n\tpublic static DOUBLE_CLICK:string = \"doubleClick3d\";\n\n\t/**\n\t * Defines the value of the type property of a mouseWheel3d event object.\n\t */\n\tpublic static MOUSE_WHEEL:string = \"mouseWheel3d\";\n\n\t/**\n\t * The horizontal coordinate at which the event occurred in view coordinates.\n\t */\n\tpublic screenX:number;\n\n\t/**\n\t * The vertical coordinate at which the event occurred in view coordinates.\n\t */\n\tpublic screenY:number;\n\n\t/**\n\t * The view object inside which the event took place.\n\t */\n\tpublic view:View;\n\n\t/**\n\t * The 3d object inside which the event took place.\n\t */\n\tpublic object:DisplayObject;\n\n\t/**\n\t * The renderable owner inside which the event took place.\n\t */\n\tpublic renderableOwner:IRenderableOwner;\n\n\t/**\n\t * The material of the 3d element inside which the event took place.\n\t */\n\tpublic material:MaterialBase;\n\n\t/**\n\t * The uv coordinate inside the draw primitive where the event took place.\n\t */\n\tpublic uv:Point;\n\n\t/**\n\t * The index of the face where the event took place.\n\t */\n\tpublic index:number;\n\n\t/**\n\t * The index of the subGeometry where the event took place.\n\t */\n\tpublic subGeometryIndex:number;\n\n\t/**\n\t * The position in object space where the event took place\n\t */\n\tpublic localPosition:Vector3D;\n\n\t/**\n\t * The normal in object space where the event took place\n\t */\n\tpublic localNormal:Vector3D;\n\n\t/**\n\t * Indicates whether the Control key is active (true) or inactive (false).\n\t */\n\tpublic ctrlKey:boolean;\n\n\t/**\n\t * Indicates whether the Alt key is active (true) or inactive (false).\n\t */\n\tpublic altKey:boolean;\n\n\t/**\n\t * Indicates whether the Shift key is active (true) or inactive (false).\n\t */\n\tpublic shiftKey:boolean;\n\n\t/**\n\t * Indicates how many lines should be scrolled for each unit the user rotates the mouse wheel.\n\t */\n\tpublic delta:number;\n\n\t/**\n\t * Create a new MouseEvent object.\n\t * @param type The type of the MouseEvent.\n\t */\n\tconstructor(type:string)\n\t{\n\t\tsuper(type);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get bubbles():boolean\n\t{\n\t\tvar doesBubble:boolean = this._iAllowedToPropagate;\n\t\tthis._iAllowedToPropagate = true;\n\n\t\t// Don't bubble if propagation has been stopped.\n\t\treturn doesBubble;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic stopPropagation()\n\t{\n\t\tthis._iAllowedToPropagate = false;\n\n\t\tif (this._iParentEvent)\n\t\t\tthis._iParentEvent.stopPropagation();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic stopImmediatePropagation()\n\t{\n\t\tthis._iAllowedToPropagate = false;\n\n\t\tif (this._iParentEvent)\n\t\t\tthis._iParentEvent.stopImmediatePropagation();\n\t}\n\n\t/**\n\t * Creates a copy of the MouseEvent object and sets the value of each property to match that of the original.\n\t */\n\tpublic clone():Event\n\t{\n\t\tvar result:MouseEvent = new MouseEvent(this.type);\n\n\t\t/* TODO: Debug / test - look into isDefaultPrevented\n\t\t if (isDefaultPrevented())\n\t\t result.preventDefault();\n\t\t */\n\n\t\tresult.screenX = this.screenX;\n\t\tresult.screenY = this.screenY;\n\n\t\tresult.view = this.view;\n\t\tresult.object = this.object;\n\t\tresult.renderableOwner = this.renderableOwner;\n\t\tresult.material = this.material;\n\t\tresult.uv = this.uv;\n\t\tresult.localPosition = this.localPosition;\n\t\tresult.localNormal = this.localNormal;\n\t\tresult.index = this.index;\n\t\tresult.subGeometryIndex = this.subGeometryIndex;\n\t\tresult.delta = this.delta;\n\n\t\tresult.ctrlKey = this.ctrlKey;\n\t\tresult.shiftKey = this.shiftKey;\n\n\t\tresult._iParentEvent = this;\n\t\tresult._iAllowedToPropagate = this._iAllowedToPropagate;\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * The position in scene space where the event took place\n\t */\n\tpublic get scenePosition():Vector3D\n\t{\n\t\treturn this.object.sceneTransform.transformVector(this.localPosition);\n\t}\n\n\t/**\n\t * The normal in scene space where the event took place\n\t */\n\tpublic get sceneNormal():Vector3D\n\t{\n\t\tvar sceneNormal:Vector3D = this.object.sceneTransform.deltaTransformVector(this.localNormal);\n\t\tsceneNormal.normalize();\n\n\t\treturn sceneNormal;\n\t}\n}\n\nexport = MouseEvent;","import Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\n\n/**\n * Dispatched to notify changes in a sub geometry object's state.\n *\n * @class away.events.RenderableOwnerEvent\n * @see away.core.base.Geometry\n */\nclass RenderableOwnerEvent extends Event\n{\n\t/**\n\t * Dispatched when a Renderable owners's render object owner has been updated.\n\t */\n\tpublic static RENDER_OBJECT_OWNER_UPDATED:string = \"renderObjectOwnerUpdated\";\n\n\tprivate _renderObjectOwner:IRenderObjectOwner;\n\n\t/**\n\t * Create a new GeometryEvent\n\t * @param type The event type.\n\t * @param dataType An optional data type of the vertex data being updated.\n\t */\n\tconstructor(type:string, renderObjectOwner:IRenderObjectOwner)\n\t{\n\t\tsuper(type);\n\n\t\tthis._renderObjectOwner = renderObjectOwner;\n\t}\n\n\t/**\n\t * The renderobject owner of the renderable owner.\n\t */\n\tpublic get renderObjectOwner():IRenderObjectOwner\n\t{\n\t\treturn this._renderObjectOwner;\n\t}\n\n\t/**\n\t * Clones the event.\n\t *\n\t * @return An exact duplicate of the current object.\n\t */\n\tpublic clone():Event\n\t{\n\t\treturn new RenderableOwnerEvent(this.type, this._renderObjectOwner);\n\t}\n}\n\nexport = RenderableOwnerEvent;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nclass RendererEvent extends Event\n{\n\tpublic static VIEWPORT_UPDATED:string = \"viewportUpdated\";\n\tpublic static SCISSOR_UPDATED:string = \"scissorUpdated\";\n\n\tconstructor(type:string)\n\t{\n\t\tsuper(type);\n\t}\n}\n\nexport = RendererEvent;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nclass ResizeEvent extends Event\n{\n\tpublic static RESIZE:string = \"resize\";\n\n\tprivate _oldHeight:number;\n\tprivate _oldWidth:number;\n\n\tconstructor(type:string, oldHeight:number = NaN, oldWidth:number = NaN)\n\t{\n\t\tsuper(type);\n\n\t\tthis._oldHeight = oldHeight;\n\t\tthis._oldWidth = oldWidth;\n\t}\n\n\tpublic get oldHeight():number\n\t{\n\t\treturn this._oldHeight;\n\t}\n\n\tpublic get oldWidth():number\n\t{\n\t\treturn this._oldWidth;\n\t}\n}\n\nexport = ResizeEvent;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nimport DisplayObject\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\n\nclass SceneEvent extends Event\n{\n\t/**\n\t *\n\t */\n\tpublic static ADDED_TO_SCENE:string = \"addedToScene\";\n\n\t/**\n\t *\n\t */\n\tpublic static REMOVED_FROM_SCENE:string = \"removedFromScene\";\n\n\t/**\n\t *\n\t */\n\tpublic static PARTITION_CHANGED:string = \"partitionChanged\";\n\n\t/**\n\t *\n\t */\n\tpublic displayObject:DisplayObject;\n\n\tconstructor(type:string, displayObject:DisplayObject)\n\t{\n\t\tsuper(type);\n\n\t\tthis.displayObject = displayObject;\n\t}\n}\n\nexport = SceneEvent;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nclass StageEvent extends Event\n{\n\tpublic static CONTEXT_CREATED:string = \"contextCreated\";\n\tpublic static CONTEXT_DISPOSED:string = \"contextDisposed\";\n\tpublic static CONTEXT_RECREATED:string = \"contextRecreated\";\n\tpublic static VIEWPORT_UPDATED:string = \"viewportUpdated\";\n\n\tconstructor(type:string)\n\t{\n\t\tsuper(type);\n\t}\n}\n\nexport = StageEvent;","import Event\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\n/**\n * Dispatched to notify changes in a sub geometry object's state.\n *\n * @class away.events.SubGeometryEvent\n * @see away.core.base.Geometry\n */\nclass SubGeometryEvent extends Event\n{\n\t/**\n\t * Dispatched when a TriangleSubGeometry's index data has been updated.\n\t */\n\tpublic static INDICES_UPDATED:string = \"indicesUpdated\";\n\n\t/**\n\t * Dispatched when a TriangleSubGeometry's vertex data has been updated.\n\t */\n\tpublic static VERTICES_UPDATED:string = \"verticesUpdated\";\n\n\tprivate _dataType:string;\n\n\t/**\n\t * Create a new GeometryEvent\n\t * @param type The event type.\n\t * @param dataType An optional data type of the vertex data being updated.\n\t */\n\tconstructor(type:string, dataType:string = \"\")\n\t{\n\t\tsuper(type);\n\n\t\tthis._dataType = dataType;\n\t}\n\n\t/**\n\t * The data type of the vertex data.\n\t */\n\tpublic get dataType():string\n\t{\n\t\treturn this._dataType;\n\t}\n\n\t/**\n\t * Clones the event.\n\t *\n\t * @return An exact duplicate of the current object.\n\t */\n\tpublic clone():Event\n\t{\n\t\treturn new SubGeometryEvent(this.type, this._dataType);\n\t}\n}\n\nexport = SubGeometryEvent;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport BitmapTexture\t\t\t\t= require(\"awayjs-core/lib/textures/BitmapTexture\");\n\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport BasicMaterial\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\n\nclass DefaultMaterialManager\n{\n\tprivate static _defaultBitmapData:BitmapData;\n\tprivate static _defaultTriangleMaterial:BasicMaterial;\n\tprivate static _defaultLineMaterial:BasicMaterial;\n\tprivate static _defaultTexture:BitmapTexture;\n\n\tpublic static getDefaultMaterial(renderableOwner:IRenderableOwner = null):MaterialBase\n\t{\n\t\tif (renderableOwner != null && renderableOwner.assetType == AssetType.LINE_SUB_MESH) {\n\t\t\tif (!DefaultMaterialManager._defaultLineMaterial)\n\t\t\t\tDefaultMaterialManager.createDefaultLineMaterial();\n\n\t\t\treturn DefaultMaterialManager._defaultLineMaterial;\n\t\t} else {\n\t\t\tif (!DefaultMaterialManager._defaultTriangleMaterial)\n\t\t\t\tDefaultMaterialManager.createDefaultTriangleMaterial();\n\n\t\t\treturn DefaultMaterialManager._defaultTriangleMaterial;\n\t\t}\n\t}\n\n\tpublic static getDefaultTexture(renderableOwner:IRenderableOwner = null):BitmapTexture\n\t{\n\t\tif (!DefaultMaterialManager._defaultTexture)\n\t\t\tDefaultMaterialManager.createDefaultTexture();\n\n\t\treturn DefaultMaterialManager._defaultTexture;\n\t}\n\n\tprivate static createDefaultTexture()\n\t{\n\t\tDefaultMaterialManager._defaultBitmapData = DefaultMaterialManager.createCheckeredBitmapData();\n\t\tDefaultMaterialManager._defaultTexture = new BitmapTexture(DefaultMaterialManager._defaultBitmapData);\n\t\tDefaultMaterialManager._defaultTexture.name = \"defaultTexture\";\n\t}\n\n\tpublic static createCheckeredBitmapData():BitmapData\n\t{\n\t\tvar b:BitmapData = new BitmapData(8, 8, false, 0x000000);\n\n\t\t//create chekerboard\n\t\tvar i:number, j:number;\n\t\tfor (i = 0; i < 8; i++) {\n\t\t\tfor (j = 0; j < 8; j++) {\n\t\t\t\tif ((j & 1) ^ (i & 1)) {\n\t\t\t\t\tb.setPixel(i, j, 0XFFFFFF);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn b;\n\t}\n\n\tprivate static createDefaultTriangleMaterial()\n\t{\n\t\tif (!DefaultMaterialManager._defaultTexture)\n\t\t\tDefaultMaterialManager.createDefaultTexture();\n\n\t\tDefaultMaterialManager._defaultTriangleMaterial = new BasicMaterial(DefaultMaterialManager._defaultTexture);\n\t\tDefaultMaterialManager._defaultTriangleMaterial.mipmap = false;\n\t\tDefaultMaterialManager._defaultTriangleMaterial.smooth = false;\n\t\tDefaultMaterialManager._defaultTriangleMaterial.name = \"defaultTriangleMaterial\";\n\t}\n\n\tprivate static createDefaultLineMaterial()\n\t{\n\t\tDefaultMaterialManager._defaultLineMaterial = new BasicMaterial();\n\t\tDefaultMaterialManager._defaultLineMaterial.name = \"defaultLineMaterial\";\n\t}\n}\n\nexport = DefaultMaterialManager;","import Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport DisplayObject\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport View\t\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/View\");\nimport PickingCollisionVO\t\t\t= require(\"awayjs-display/lib/pick/PickingCollisionVO\");\nimport AwayMouseEvent\t\t\t\t= require(\"awayjs-display/lib/events/MouseEvent\");\n\n/**\n * MouseManager enforces a singleton pattern and is not intended to be instanced.\n * it provides a manager class for detecting mouse hits on scene objects and sending out mouse events.\n */\nclass MouseManager\n{\n\tprivate static _instance:MouseManager;\n\n\tprivate _viewLookup:Array<View> = new Array<View>();\n\n\tpublic _iActiveDiv:HTMLDivElement;\n\tpublic _iUpdateDirty:boolean;\n\tpublic _iCollidingObject:PickingCollisionVO;\n\t\n\tprivate _nullVector:Vector3D = new Vector3D();\n\tprivate _previousCollidingObject:PickingCollisionVO;\n\tprivate _queuedEvents:Array<AwayMouseEvent> = new Array<AwayMouseEvent>();\n\n\tprivate _mouseMoveEvent:MouseEvent;\n\n\tprivate _mouseUp:AwayMouseEvent = new AwayMouseEvent(AwayMouseEvent.MOUSE_UP);\n\tprivate _mouseClick:AwayMouseEvent = new AwayMouseEvent(AwayMouseEvent.CLICK);\n\tprivate _mouseOut:AwayMouseEvent = new AwayMouseEvent(AwayMouseEvent.MOUSE_OUT);\n\tprivate _mouseDown:AwayMouseEvent = new AwayMouseEvent(AwayMouseEvent.MOUSE_DOWN);\n\tprivate _mouseMove:AwayMouseEvent = new AwayMouseEvent(AwayMouseEvent.MOUSE_MOVE);\n\tprivate _mouseOver:AwayMouseEvent = new AwayMouseEvent(AwayMouseEvent.MOUSE_OVER);\n\tprivate _mouseWheel:AwayMouseEvent = new AwayMouseEvent(AwayMouseEvent.MOUSE_WHEEL);\n\tprivate _mouseDoubleClick:AwayMouseEvent = new AwayMouseEvent(AwayMouseEvent.DOUBLE_CLICK);\n\n\tprivate onClickDelegate:(event:MouseEvent) => void;\n\tprivate onDoubleClickDelegate:(event:MouseEvent) => void;\n\tprivate onMouseDownDelegate:(event:MouseEvent) => void;\n\tprivate onMouseMoveDelegate:(event:MouseEvent) => void;\n\tprivate onMouseUpDelegate:(event:MouseEvent) => void;\n\tprivate onMouseWheelDelegate:(event:MouseEvent) => void;\n\tprivate onMouseOverDelegate:(event:MouseEvent) => void;\n\tprivate onMouseOutDelegate:(event:MouseEvent) => void;\n\n\t/**\n\t * Creates a new <code>MouseManager</code> object.\n\t */\n\tconstructor()\n\t{\n\t\tthis.onClickDelegate = (event:MouseEvent) => this.onClick(event);\n\t\tthis.onDoubleClickDelegate = (event:MouseEvent) => this.onDoubleClick(event);\n\t\tthis.onMouseDownDelegate = (event:MouseEvent) => this.onMouseDown(event);\n\t\tthis.onMouseMoveDelegate = (event:MouseEvent) => this.onMouseMove(event);\n\t\tthis.onMouseUpDelegate = (event:MouseEvent) => this.onMouseUp(event);\n\t\tthis.onMouseWheelDelegate = (event:MouseEvent) => this.onMouseWheel(event);\n\t\tthis.onMouseOverDelegate = (event:MouseEvent) => this.onMouseOver(event);\n\t\tthis.onMouseOutDelegate = (event:MouseEvent) => this.onMouseOut(event);\n\t}\n\n\tpublic static getInstance():MouseManager\n\t{\n\t\tif (this._instance)\n\t\t\treturn this._instance;\n\n\t\treturn (this._instance = new MouseManager());\n\t}\n\n\tpublic fireMouseEvents(forceMouseMove:boolean)\n\t{\n\t\t // If colliding object has changed, queue over/out events.\n\t\tif (this._iCollidingObject != this._previousCollidingObject) {\n\t\t\tif (this._previousCollidingObject)\n\t\t\t\tthis.queueDispatch(this._mouseOut, this._mouseMoveEvent, this._previousCollidingObject);\n\n\t\t\tif (this._iCollidingObject)\n\t\t\t\tthis.queueDispatch(this._mouseOver, this._mouseMoveEvent);\n\t\t}\n\n\t\t // Fire mouse move events here if forceMouseMove is on.\n\t\tif (forceMouseMove && this._iCollidingObject)\n\t\t\tthis.queueDispatch( this._mouseMove, this._mouseMoveEvent);\n\n\t\tvar event:AwayMouseEvent;\n\t\tvar dispatcher:DisplayObject;\n\n\t\t // Dispatch all queued events.\n\t\tvar len:number = this._queuedEvents.length;\n\t\tfor (var i:number = 0; i < len; ++i) {\n\t\t\t// Only dispatch from first implicitly enabled object ( one that is not a child of a mouseChildren = false hierarchy ).\n\t\t\tevent = this._queuedEvents[i];\n\t\t\tdispatcher = event.object;\n\n\t\t\twhile (dispatcher && !dispatcher._iIsMouseEnabled())\n\t\t\t\tdispatcher = dispatcher.parent;\n\n\t\t\tif (dispatcher)\n\t\t\t\tdispatcher.dispatchEvent(event);\n\t\t}\n\n\t\tthis._queuedEvents.length = 0;\n\n\t\tthis._previousCollidingObject = this._iCollidingObject;\n\n\t\tthis._iUpdateDirty = false;\n\t}\n\n//\t\tpublic addViewLayer(view:View)\n//\t\t{\n//\t\t\tvar stg:Stage = view.stage;\n//\n//\t\t\t// Add instance to mouse3dmanager to fire mouse events for multiple views\n//\t\t\tif (!view.stageGL.mouse3DManager)\n//\t\t\t\tview.stageGL.mouse3DManager = this;\n//\n//\t\t\tif (!hasKey(view))\n//\t\t\t\t_view3Ds[view] = 0;\n//\n//\t\t\t_childDepth = 0;\n//\t\t\ttraverseDisplayObjects(stg);\n//\t\t\t_viewCount = _childDepth;\n//\t\t}\n\n\tpublic registerView(view:View)\n\t{\n\t\tview.htmlElement.addEventListener(\"click\", this.onClickDelegate);\n\t\tview.htmlElement.addEventListener(\"dblclick\", this.onDoubleClickDelegate);\n\t\tview.htmlElement.addEventListener(\"mousedown\", this.onMouseDownDelegate);\n\t\tview.htmlElement.addEventListener(\"mousemove\", this.onMouseMoveDelegate);\n\t\tview.htmlElement.addEventListener(\"mouseup\", this.onMouseUpDelegate);\n\t\tview.htmlElement.addEventListener(\"mousewheel\", this.onMouseWheelDelegate);\n\t\tview.htmlElement.addEventListener(\"mouseover\", this.onMouseOverDelegate);\n\t\tview.htmlElement.addEventListener(\"mouseout\", this.onMouseOutDelegate);\n\n\t\tthis._viewLookup.push(view);\n\t}\n\n\tpublic unregisterView(view:View)\n\t{\n\t\tview.htmlElement.removeEventListener(\"click\", this.onClickDelegate);\n\t\tview.htmlElement.removeEventListener(\"dblclick\", this.onDoubleClickDelegate);\n\t\tview.htmlElement.removeEventListener(\"mousedown\", this.onMouseDownDelegate);\n\t\tview.htmlElement.removeEventListener(\"mousemove\", this.onMouseMoveDelegate);\n\t\tview.htmlElement.removeEventListener(\"mouseup\", this.onMouseUpDelegate);\n\t\tview.htmlElement.removeEventListener(\"mousewheel\", this.onMouseWheelDelegate);\n\t\tview.htmlElement.removeEventListener(\"mouseover\", this.onMouseOverDelegate);\n\t\tview.htmlElement.removeEventListener(\"mouseout\", this.onMouseOutDelegate);\n\n\t\tthis._viewLookup.slice(this._viewLookup.indexOf(view), 1);\n\t}\n\n\t// ---------------------------------------------------------------------\n\t// Private.\n\t// ---------------------------------------------------------------------\n\n\tprivate queueDispatch(event:AwayMouseEvent, sourceEvent:MouseEvent, collider:PickingCollisionVO = null)\n\t{\n\t\t// 2D properties.\n\t\tif (sourceEvent) {\n\t\t\tevent.ctrlKey = sourceEvent.ctrlKey;\n\t\t\tevent.altKey = sourceEvent.altKey;\n\t\t\tevent.shiftKey = sourceEvent.shiftKey;\n\t\t\tevent.screenX = sourceEvent.clientX;\n\t\t\tevent.screenY = sourceEvent.clientY;\n\t\t}\n\n\t\tif (collider == null)\n\t\t\tcollider = this._iCollidingObject;\n\n\t\t// 3D properties.\n\t\tif (collider) {\n\t\t\t// Object.\n\t\t\tevent.object = collider.displayObject;\n\t\t\tevent.renderableOwner = collider.renderableOwner;\n\t\t\t// UV.\n\t\t\tevent.uv = collider.uv;\n\t\t\t// Position.\n\t\t\tevent.localPosition = collider.localPosition? collider.localPosition.clone() : null;\n\t\t\t// Normal.\n\t\t\tevent.localNormal = collider.localNormal? collider.localNormal.clone() : null;\n\t\t\t// Face index.\n\t\t\tevent.index = collider.index;\n\t\t} else {\n\t\t\t// Set all to null.\n\t\t\tevent.uv = null;\n\t\t\tevent.object = null;\n\t\t\tevent.localPosition = this._nullVector;\n\t\t\tevent.localNormal = this._nullVector;\n\t\t\tevent.index = 0;\n\t\t\tevent.subGeometryIndex = 0;\n\t\t}\n\n\t\t// Store event to be dispatched later.\n\t\tthis._queuedEvents.push(event);\n\t}\n\n\t// ---------------------------------------------------------------------\n\t// Listeners.\n\t// ---------------------------------------------------------------------\n\n\tprivate onMouseMove(event:MouseEvent)\n\t{\n\t\tthis.updateColliders(event);\n\n\t\tif (this._iCollidingObject)\n\t\t\tthis.queueDispatch(this._mouseMove, this._mouseMoveEvent = event);\n\t}\n\n\tprivate onMouseOut(event:MouseEvent)\n\t{\n\t\tthis._iActiveDiv = null;\n\n\t\tthis.updateColliders(event);\n\n\t\tif (this._iCollidingObject)\n\t\t\tthis.queueDispatch(this._mouseOut, event);\n\t}\n\n\tprivate onMouseOver(event:MouseEvent)\n\t{\n\t\tthis._iActiveDiv = <HTMLDivElement> event.target;\n\n\t\tthis.updateColliders(event);\n\n\t\tif (this._iCollidingObject)\n\t\t\tthis.queueDispatch( this._mouseOver, event);\n\t}\n\n\tprivate onClick(event:MouseEvent)\n\t{\n\t\tthis.updateColliders(event);\n\n\t\tif (this._iCollidingObject)\n\t\t\tthis.queueDispatch(this._mouseClick, event);\n\t}\n\n\tprivate onDoubleClick(event:MouseEvent)\n\t{\n\t\tthis.updateColliders(event);\n\n\t\tif (this._iCollidingObject)\n\t\t\tthis.queueDispatch(this._mouseDoubleClick, event);\n\t}\n\n\tprivate onMouseDown(event:MouseEvent)\n\t{\n\t\tthis._iActiveDiv = <HTMLDivElement> event.target;\n\n\t\tthis.updateColliders(event);\n\n\t\tif (this._iCollidingObject)\n\t\t\tthis.queueDispatch(this._mouseDown, event);\n\t}\n\n\tprivate onMouseUp(event:MouseEvent)\n\t{\n\t\tthis.updateColliders(event);\n\n\t\tif (this._iCollidingObject)\n\t\t\tthis.queueDispatch(this._mouseUp , event);\n\t}\n\n\tprivate onMouseWheel(event:MouseEvent)\n\t{\n\t\tthis.updateColliders(event);\n\n\t\tif (this._iCollidingObject)\n\t\t\tthis.queueDispatch(this._mouseWheel, event);\n\t}\n\n\n\tprivate updateColliders(event:MouseEvent)\n\t{\n\t\tif (this._iUpdateDirty)\n\t\t\treturn;\n\n\t\tvar view:View;\n\t\tvar bounds:ClientRect;\n\t\tvar mouseX:number = event.clientX;\n\t\tvar mouseY:number = event.clientY;\n\t\tvar len:number = this._viewLookup.length;\n\t\tfor (var i:number = 0; i < len; i++) {\n\t\t\tview = this._viewLookup[i];\n\t\t\tbounds = view.htmlElement.getBoundingClientRect();\n\t\t\tif (mouseX < bounds.left || mouseX > bounds.right || mouseY < bounds.top || mouseY > bounds.bottom) {\n\t\t\t\tview._pMouseX = null;\n\t\t\t\tview._pMouseY = null;\n\t\t\t} else {\n\t\t\t\tview._pMouseX = mouseX + bounds.left;\n\t\t\t\tview._pMouseY = mouseY + bounds.top;\n\t\t\t\tview.updateCollider();\n\n\t\t\t\tif (view.layeredView && this._iCollidingObject)\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tthis._iUpdateDirty = true;\n\t}\n}\n\nexport = MouseManager;","import Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport IRenderablePool\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderablePool\");\nimport IRenderObject\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderObject\");\n\n/**\n * BasicMaterial forms an abstract base class for the default shaded materials provided by Stage,\n * using material methods to define their appearance.\n */\nclass BasicMaterial extends MaterialBase implements IRenderObjectOwner\n{\n\t/**\n\t * Creates a new BasicMaterial object.\n\t *\n\t * @param texture The texture used for the material's albedo color.\n\t * @param smooth Indicates whether the texture should be filtered when sampled. Defaults to true.\n\t * @param repeat Indicates whether the texture should be tiled when sampled. Defaults to false.\n\t * @param mipmap Indicates whether or not any used textures should use mipmapping. Defaults to false.\n\t */\n\tconstructor(texture?:Texture2DBase, smooth?:boolean, repeat?:boolean, mipmap?:boolean);\n\tconstructor(color?:number, alpha?:number);\n\tconstructor(textureColor:any = null, smoothAlpha:any = null, repeat:boolean = false, mipmap:boolean = false)\n\t{\n\t\tsuper();\n\n\t\tif (textureColor instanceof Texture2DBase) {\n\t\t\tthis.texture = <Texture2DBase> textureColor;\n\n\t\t\tthis.smooth = (smoothAlpha == null)? true : false;\n\t\t\tthis.repeat = repeat;\n\t\t\tthis.mipmap = mipmap;\n\t\t} else {\n\t\t\tthis.color = textureColor? Number(textureColor) : 0xCCCCCC;\n\t\t\tthis.alpha = (smoothAlpha == null)? 1 : Number(smoothAlpha);\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @param renderer\n\t *\n\t * @internal\n\t */\n\tpublic getRenderObject(renderablePool:IRenderablePool):IRenderObject\n\t{\n\t\treturn renderablePool.getMaterialRenderObject(this);\n\t}\n}\n\nexport = BasicMaterial;","import MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport ImageTexture\t\t\t\t\t= require(\"awayjs-core/lib/textures/ImageTexture\");\nimport Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\n/**\n * MaterialBase forms an abstract base class for any material.\n * A material consists of several passes, each of which constitutes at least one render call. Several passes could\n * be used for special effects (render lighting for many lights in several passes, render an outline in a separate\n * pass) or to provide additional render-to-texture passes (rendering diffuse light to texture for texture-space\n * subsurface scattering, or rendering a depth map for specialized self-shadowing).\n *\n * Away3D provides default materials trough SinglePassMaterialBase and MultiPassMaterialBase, which use modular\n * methods to build the shader code. MaterialBase can be extended to build specific and high-performant custom\n * shaders, or entire new material frameworks.\n */\nclass CSSMaterialBase extends MaterialBase\n{\n\tprivate _imageElement:HTMLImageElement;\n\tprivate _imageStyle:MSStyleCSSProperties;\n\n\n\tpublic get imageElement():HTMLImageElement\n\t{\n\t\treturn this._imageElement;\n\t}\n\n\tpublic get imageStyle():MSStyleCSSProperties\n\t{\n\t\treturn this._imageStyle;\n\t}\n\n\t/**\n\t * The texture object to use for the albedo colour.\n\t */\n\tpublic get texture():Texture2DBase\n\t{\n\t\treturn this._pTexture;\n\t}\n\n\tpublic set texture(value:Texture2DBase)\n\t{\n\t\tif (this._pTexture == value)\n\t\t\treturn;\n\n\t\tthis._pTexture = value;\n\n\t\tif (value instanceof ImageTexture) {\n\t\t\tthis._imageElement = (<ImageTexture> value).htmlImageElement;\n\n\t\t\tvar node:HTMLStyleElement = document.createElement(\"style\");\n\t\t\tnode.type = \"text/css\";\n\t\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(node);\n\n\t\t\tvar sheet:CSSStyleSheet = <CSSStyleSheet> document.styleSheets[document.styleSheets.length - 1];\n\t\t\tsheet.insertRule(\".material\" + this.id + \"{ }\", 0);\n\t\t\tvar style:MSStyleCSSProperties = (<CSSStyleRule> sheet.cssRules[0]).style;\n\n\t\t\tstyle.backgroundImage = \"url(\" + this._imageElement.src + \")\";\n\t\t\tstyle.backgroundSize = \"100% 100%\";\n\t\t\tstyle.position = \"absolute\";\n\t\t\tstyle.width = this._imageElement.width + \"px\";\n\t\t\tstyle.height = this._imageElement.height + \"px\";\n\t\t\tstyle.transformOrigin\n\t\t\t\t= style[\"-webkit-transform-origin\"]\n\t\t\t\t= style[\"-moz-transform-origin\"]\n\t\t\t\t= style[\"-o-transform-origin\"]\n\t\t\t\t= style[\"-ms-transform-origin\"] = \"0% 0%\";\n\n\t\t\tthis._pHeight = this._imageElement.height;\n\t\t\tthis._pWidth = this._imageElement.width;\n\n\t\t\tthis._pNotifySizeChanged();\n\t\t}\n\t}\n\n\t/**\n\t * Creates a new MaterialBase object.\n\t */\n\tconstructor(texture:Texture2DBase = null, smooth:boolean = true, repeat:boolean = false)\n\t{\n\t\tsuper();\n\n\t\tthis._iMaterialId = Number(this.id);\n\n\t\tthis.texture = texture;\n\n\t\tthis.smooth = smooth;\n\t\tthis.repeat = repeat;\n\t}\n}\n\nexport = CSSMaterialBase;","/**\n * Enumeration class for defining which lighting types affect the specific material\n * lighting component (diffuse and specular). This can be useful if, for example, you\n * want to use light probes for diffuse global lighting, but want specular reflections from\n * traditional light sources without those affecting the diffuse light.\n *\n * @see away.materials.ColorMaterial.diffuseLightSources\n * @see away.materials.ColorMaterial.specularLightSources\n * @see away.materials.TextureMaterial.diffuseLightSources\n * @see away.materials.TextureMaterial.specularLightSources\n */\nclass LightSources\n{\n\t/**\n\t * Defines normal lights are to be used as the source for the lighting\n\t * component.\n\t */\n\tpublic static LIGHTS:number = 0x01;\n\n\t/**\n\t * Defines that global lighting probes are to be used as the source for the\n\t * lighting component.\n\t */\n\tpublic static PROBES:number = 0x02;\n\n\t/**\n\t * Defines that both normal and global lighting probes  are to be used as the\n\t * source for the lighting component. This is equivalent to LightSources.LIGHTS | LightSources.PROBES.\n\t */\n\tpublic static ALL:number = 0x03;\n}\n\nexport = LightSources;","import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\nimport ColorTransform\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\nimport AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport IAsset\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport NamedAssetBase\t\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\nimport Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport IAnimationSet\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimationSet\");\nimport IAnimator\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimator\");\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\nimport IRenderObject\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderObject\");\nimport IRenderablePool\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderablePool\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport MaterialEvent\t\t\t\t= require(\"awayjs-display/lib/events/MaterialEvent\");\nimport RenderableOwnerEvent\t\t\t= require(\"awayjs-display/lib/events/RenderableOwnerEvent\");\nimport LightPickerBase\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/render/IRenderer\");\n\n\n/**\n * MaterialBase forms an abstract base class for any material.\n * A material consists of several passes, each of which constitutes at least one render call. Several passes could\n * be used for special effects (render lighting for many lights in several passes, render an outline in a separate\n * pass) or to provide additional render-to-texture passes (rendering diffuse light to texture for texture-space\n * subsurface scattering, or rendering a depth map for specialized self-shadowing).\n *\n * Away3D provides default materials trough SinglePassMaterialBase and TriangleMaterial, which use modular\n * methods to build the shader code. MaterialBase can be extended to build specific and high-performant custom\n * shaders, or entire new material frameworks.\n */\nclass MaterialBase extends NamedAssetBase implements IRenderObjectOwner\n{\n\tprivate _colorTransform:ColorTransform;\n\tprivate _alphaBlending:boolean = false;\n\tprivate _alpha:number = 1;\n\t\n\tprivate _sizeChanged:MaterialEvent;\n\tprivate _renderObjects:Array<IRenderObject> = new Array<IRenderObject>();\n\n\tpublic _pAlphaThreshold:number = 0;\n\tpublic _pAnimateUVs:boolean = false;\n\tprivate _enableLightFallOff:boolean = true;\n\tprivate _specularLightSources:number = 0x01;\n\tprivate _diffuseLightSources:number = 0x03;\n\n\t/**\n\t * An object to contain any extra data.\n\t */\n\tpublic extra:Object;\n\n\t/**\n\t * A value that can be used by materials that only work with a given type of renderer. The renderer can test the\n\t * classification to choose which render path to use. For example, a deferred material could set this value so\n\t * that the deferred renderer knows not to take the forward rendering path.\n\t *\n\t * @private\n\t */\n\tpublic _iClassification:string;\n\n\n\t/**\n\t * An id for this material used to sort the renderables by shader program, which reduces Program state changes.\n\t *\n\t * @private\n\t */\n\tpublic _iMaterialId:number = 0;\n\n\tpublic _iBaseScreenPassIndex:number = 0;\n\n\tprivate _bothSides:boolean = false; // update\n\tprivate _animationSet:IAnimationSet;\n\n\t/**\n\t * A list of material owners, renderables or custom Entities.\n\t */\n\tprivate _owners:Array<IRenderableOwner>;\n\n\tprivate _alphaPremultiplied:boolean;\n\n\tpublic _pBlendMode:string = BlendMode.NORMAL;\n\n\tprivate _mipmap:boolean = true;\n\tprivate _smooth:boolean = true;\n\tprivate _repeat:boolean = false;\n\tprivate _color:number = 0xFFFFFF;\n\tpublic _pTexture:Texture2DBase;\n\n\tpublic _pLightPicker:LightPickerBase;\n\n\tpublic _pHeight:number = 1;\n\tpublic _pWidth:number = 1;\n\n\tprivate _onLightChangeDelegate:(event:Event) => void;\n\n\n\t/**\n\t *\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.MATERIAL;;\n\t}\n\n\t/**\n\t * Creates a new MaterialBase object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._iMaterialId = Number(this.id);\n\n\t\tthis._owners = new Array<IRenderableOwner>();\n\n\t\tthis._onLightChangeDelegate = (event:Event) => this.onLightsChange(event);\n\n\t\tthis.alphaPremultiplied = false; //TODO: work out why this is different for WebGL\n\t}\n\n\t/**\n\t * The alpha of the surface.\n\t */\n\tpublic get alpha():number\n\t{\n\t\treturn this._alpha;\n\t}\n\n\tpublic set alpha(value:number)\n\t{\n\t\tif (value > 1)\n\t\t\tvalue = 1;\n\t\telse if (value < 0)\n\t\t\tvalue = 0;\n\n\t\tif (this._alpha == value)\n\t\t\treturn;\n\n\t\tthis._alpha = value;\n\n\t\tif (this._colorTransform == null)\n\t\t\tthis._colorTransform = new ColorTransform();\n\n\t\tthis._colorTransform.alphaMultiplier = value;\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\t/**\n\t * The ColorTransform object to transform the colour of the material with. Defaults to null.\n\t */\n\tpublic get colorTransform():ColorTransform\n\t{\n\t\treturn this._colorTransform;\n\t}\n\n\tpublic set colorTransform(value:ColorTransform)\n\t{\n\t\tthis._colorTransform = value;\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\t/**\n\t * Indicates whether or not the material has transparency. If binary transparency is sufficient, for\n\t * example when using textures of foliage, consider using alphaThreshold instead.\n\t */\n\tpublic get alphaBlending():boolean\n\t{\n\t\treturn this._alphaBlending;\n\t}\n\n\tpublic set alphaBlending(value:boolean)\n\t{\n\t\tif (this._alphaBlending == value)\n\t\t\treturn;\n\n\t\tthis._alphaBlending = value;\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\t\n\t/**\n\t *\n\t */\n\tpublic get height():number\n\t{\n\t\treturn this._pHeight;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get animationSet():IAnimationSet\n\t{\n\t\treturn this._animationSet;\n\t}\n\n\n\t/**\n\t * The light picker used by the material to provide lights to the material if it supports lighting.\n\t *\n\t * @see LightPickerBase\n\t * @see StaticLightPicker\n\t */\n\tpublic get lightPicker():LightPickerBase\n\t{\n\t\treturn this._pLightPicker;\n\t}\n\n\tpublic set lightPicker(value:LightPickerBase)\n\t{\n\t\tif (this._pLightPicker == value)\n\t\t\treturn;\n\n\t\tif (this._pLightPicker)\n\t\t\tthis._pLightPicker.removeEventListener(Event.CHANGE, this._onLightChangeDelegate);\n\n\t\tthis._pLightPicker = value;\n\n\t\tif (this._pLightPicker)\n\t\t\tthis._pLightPicker.addEventListener(Event.CHANGE, this._onLightChangeDelegate);\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\t/**\n\t * Indicates whether or not any used textures should use mipmapping. Defaults to true.\n\t */\n\tpublic get mipmap():boolean\n\t{\n\t\treturn this._mipmap;\n\t}\n\n\tpublic set mipmap(value:boolean)\n\t{\n\t\tif (this._mipmap == value)\n\t\t\treturn;\n\n\t\tthis._mipmap = value;\n\n\t\tthis._pInvalidatePasses();\n\t}\n\n\t/**\n\t * Indicates whether or not any used textures should use smoothing. Defaults to true.\n\t */\n\tpublic get smooth():boolean\n\t{\n\t\treturn this._smooth;\n\t}\n\n\tpublic set smooth(value:boolean)\n\t{\n\t\tif (this._smooth == value)\n\t\t\treturn;\n\n\t\tthis._smooth = value;\n\n\t\tthis._pInvalidatePasses();\n\t}\n\n\t/**\n\t * Indicates whether or not any used textures should be tiled. If set to false, texture samples are clamped to\n\t * the texture's borders when the uv coordinates are outside the [0, 1] interval. Defaults to false.\n\t */\n\tpublic get repeat():boolean\n\t{\n\t\treturn this._repeat;\n\t}\n\n\tpublic set repeat(value:boolean)\n\t{\n\t\tif (this._repeat == value)\n\t\t\treturn;\n\n\t\tthis._repeat = value;\n\n\t\tthis._pInvalidatePasses();\n\t}\n\n\t/**\n\t * The diffuse reflectivity color of the surface.\n\t */\n\tpublic get color():number\n\t{\n\t\treturn this._color;\n\t}\n\n\tpublic set color(value:number)\n\t{\n\t\tif (this._color == value)\n\t\t\treturn;\n\n\t\tthis._color = value;\n\n\t\tthis._pInvalidatePasses();\n\t}\n\n\t/**\n\t * The texture object to use for the albedo colour.\n\t */\n\tpublic get texture():Texture2DBase\n\t{\n\t\treturn this._pTexture;\n\t}\n\n\tpublic set texture(value:Texture2DBase)\n\t{\n\t\tif (this._pTexture == value)\n\t\t\treturn;\n\n\t\tthis._pTexture = value;\n\n\t\tthis._pInvalidatePasses();\n\n\t\tthis._pHeight = this._pTexture.height;\n\t\tthis._pWidth = this._pTexture.width;\n\n\t\tthis._pNotifySizeChanged();\n\t}\n\n\t/**\n\t * Specifies whether or not the UV coordinates should be animated using a transformation matrix.\n\t */\n\tpublic get animateUVs():boolean\n\t{\n\t\treturn this._pAnimateUVs;\n\t}\n\n\tpublic set animateUVs(value:boolean)\n\t{\n\t\tif (this._pAnimateUVs == value)\n\t\t\treturn;\n\n\t\tthis._pAnimateUVs = value;\n\n\t\tthis._pInvalidatePasses();\n\t}\n\n\t/**\n\t * Whether or not to use fallOff and radius properties for lights. This can be used to improve performance and\n\t * compatibility for constrained mode.\n\t */\n\tpublic get enableLightFallOff():boolean\n\t{\n\t\treturn this._enableLightFallOff;\n\t}\n\n\tpublic set enableLightFallOff(value:boolean)\n\t{\n\t\tif (this._enableLightFallOff == value)\n\t\t\treturn;\n\n\t\tthis._enableLightFallOff = value;\n\n\t\tthis._pInvalidatePasses();\n\t}\n\n\t/**\n\t * Define which light source types to use for diffuse reflections. This allows choosing between regular lights\n\t * and/or light probes for diffuse reflections.\n\t *\n\t * @see away3d.materials.LightSources\n\t */\n\tpublic get diffuseLightSources():number\n\t{\n\t\treturn this._diffuseLightSources;\n\t}\n\n\tpublic set diffuseLightSources(value:number)\n\t{\n\t\tif (this._diffuseLightSources == value)\n\t\t\treturn;\n\n\t\tthis._diffuseLightSources = value;\n\n\t\tthis._pInvalidatePasses();\n\t}\n\n\t/**\n\t * Define which light source types to use for specular reflections. This allows choosing between regular lights\n\t * and/or light probes for specular reflections.\n\t *\n\t * @see away3d.materials.LightSources\n\t */\n\tpublic get specularLightSources():number\n\t{\n\t\treturn this._specularLightSources;\n\t}\n\n\tpublic set specularLightSources(value:number)\n\t{\n\t\tif (this._specularLightSources == value)\n\t\t\treturn;\n\n\t\tthis._specularLightSources = value;\n\n\t\tthis._pInvalidatePasses();\n\t}\n\n\t/**\n\t * Cleans up resources owned by the material, including passes. Textures are not owned by the material since they\n\t * could be used by other materials and will not be disposed.\n\t */\n\tpublic dispose()\n\t{\n\t\tvar i:number;\n\t\tvar len:number;\n\n\t\tlen = this._renderObjects.length;\n\t\tfor (i = 0; i < len; i++)\n\t\t\tthis._renderObjects[i].dispose();\n\n\t\tthis._renderObjects = new Array<IRenderObject>();\n\t}\n\n\t/**\n\t * Defines whether or not the material should cull triangles facing away from the camera.\n\t */\n\tpublic get bothSides():boolean\n\t{\n\t\treturn this._bothSides;\n\t}\n\n\tpublic set bothSides(value:boolean)\n\t{\n\t\tif (this._bothSides = value)\n\t\t\treturn;\n\n\t\tthis._bothSides = value;\n\n\t\tthis._pInvalidatePasses();\n\t}\n\n\t/**\n\t * The blend mode to use when drawing this renderable. The following blend modes are supported:\n\t * <ul>\n\t * <li>BlendMode.NORMAL: No blending, unless the material inherently needs it</li>\n\t * <li>BlendMode.LAYER: Force blending. This will draw the object the same as NORMAL, but without writing depth writes.</li>\n\t * <li>BlendMode.MULTIPLY</li>\n\t * <li>BlendMode.ADD</li>\n\t * <li>BlendMode.ALPHA</li>\n\t * </ul>\n\t */\n\tpublic get blendMode():string\n\t{\n\t\treturn this._pBlendMode;\n\t}\n\n\tpublic set blendMode(value:string)\n\t{\n\t\tif (this._pBlendMode == value)\n\t\t\treturn;\n\n\t\tthis._pBlendMode = value;\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\t/**\n\t * Indicates whether visible textures (or other pixels) used by this material have\n\t * already been premultiplied. Toggle this if you are seeing black halos around your\n\t * blended alpha edges.\n\t */\n\tpublic get alphaPremultiplied():boolean\n\t{\n\t\treturn this._alphaPremultiplied;\n\t}\n\n\tpublic set alphaPremultiplied(value:boolean)\n\t{\n\t\tif (this._alphaPremultiplied == value)\n\t\t\treturn;\n\n\t\tthis._alphaPremultiplied = value;\n\n\t\tthis._pInvalidatePasses();\n\t}\n\n\t/**\n\t * The minimum alpha value for which pixels should be drawn. This is used for transparency that is either\n\t * invisible or entirely opaque, often used with textures for foliage, etc.\n\t * Recommended values are 0 to disable alpha, or 0.5 to create smooth edges. Default value is 0 (disabled).\n\t */\n\tpublic get alphaThreshold():number\n\t{\n\t\treturn this._pAlphaThreshold;\n\t}\n\n\tpublic set alphaThreshold(value:number)\n\t{\n\t\tif (value < 0)\n\t\t\tvalue = 0;\n\t\telse if (value > 1)\n\t\t\tvalue = 1;\n\n\t\tif (this._pAlphaThreshold == value)\n\t\t\treturn;\n\n\t\tthis._pAlphaThreshold = value;\n\n\t\tthis._pInvalidatePasses();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get width():number\n\t{\n\t\treturn this._pWidth;\n\t}\n\n\t//\n\t// MATERIAL MANAGEMENT\n\t//\n\t/**\n\t * Mark an IRenderableOwner as owner of this material.\n\t * Assures we're not using the same material across renderables with different animations, since the\n\t * Programs depend on animation. This method needs to be called when a material is assigned.\n\t *\n\t * @param owner The IRenderableOwner that had this material assigned\n\t *\n\t * @internal\n\t */\n\tpublic iAddOwner(owner:IRenderableOwner)\n\t{\n\t\tthis._owners.push(owner);\n\n\t\tvar animationSet:IAnimationSet;\n\t\tvar animator:IAnimator = <IAnimator> owner.animator;\n\n\t\tif (animator)\n\t\t\tanimationSet = <IAnimationSet> animator.animationSet;\n\n\t\tif (owner.animator) {\n\t\t\tif (this._animationSet && animationSet != this._animationSet) {\n\t\t\t\tthrow new Error(\"A Material instance cannot be shared across material owners with different animation sets\");\n\t\t\t} else {\n\t\t\t\tif (this._animationSet != animationSet) {\n\n\t\t\t\t\tthis._animationSet = animationSet;\n\n\t\t\t\t\tthis.invalidateAnimation();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\towner.dispatchEvent(new RenderableOwnerEvent(RenderableOwnerEvent.RENDER_OBJECT_OWNER_UPDATED, this));\n\t}\n\n\t/**\n\t * Removes an IRenderableOwner as owner.\n\t * @param owner\n\t *\n\t * @internal\n\t */\n\tpublic iRemoveOwner(owner:IRenderableOwner)\n\t{\n\t\tthis._owners.splice(this._owners.indexOf(owner), 1);\n\n\t\tif (this._owners.length == 0) {\n\t\t\tthis._animationSet = null;\n\n\t\t\tthis.invalidateAnimation();\n\t\t}\n\n\t\towner.dispatchEvent(new RenderableOwnerEvent(RenderableOwnerEvent.RENDER_OBJECT_OWNER_UPDATED, this));\n\t}\n\n\t/**\n\t * A list of the IRenderableOwners that use this material\n\t *\n\t * @private\n\t */\n\tpublic get iOwners():Array<IRenderableOwner>\n\t{\n\t\treturn this._owners;\n\t}\n\n\t/**\n\t * Marks the shader programs for all passes as invalid, so they will be recompiled before the next use.\n\t *\n\t * @private\n\t */\n\tpublic _pInvalidatePasses()\n\t{\n\t\tvar len:number = this._renderObjects.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._renderObjects[i].invalidatePasses();\n\t}\n\n\tprivate invalidateAnimation()\n\t{\n\t\tvar len:number = this._renderObjects.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._renderObjects[i].invalidateAnimation();\n\t}\n\t\n\tpublic _pInvalidateRenderObject()\n\t{\n\t\tvar len:number = this._renderObjects.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._renderObjects[i].invalidateRenderObject();\n\t}\n\n\t/**\n\t * Called when the light picker's configuration changed.\n\t */\n\tprivate onLightsChange(event:Event)\n\t{\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\tpublic _pNotifySizeChanged()\n\t{\n\t\tif (!this._sizeChanged)\n\t\t\tthis._sizeChanged = new MaterialEvent(MaterialEvent.SIZE_CHANGED);\n\n\t\tthis.dispatchEvent(this._sizeChanged);\n\t}\n\n\tpublic _iAddRenderObject(renderObject:IRenderObject):IRenderObject\n\t{\n\t\tthis._renderObjects.push(renderObject);\n\n\t\treturn renderObject;\n\t}\n\n\tpublic _iRemoveRenderObject(renderObject:IRenderObject):IRenderObject\n\t{\n\t\tthis._renderObjects.splice(this._renderObjects.indexOf(renderObject), 1);\n\n\t\treturn renderObject;\n\t}\n\n\t/**\n\t *\n\t * @param renderer\n\t *\n\t * @internal\n\t */\n\tpublic getRenderObject(renderablePool:IRenderablePool):IRenderObject\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n}\n\nexport = MaterialBase;","import Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport NamedAssetBase\t\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\nimport IAsset\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\n\nimport LightBase\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\nimport IRenderable\t\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderable\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport DirectionalLight\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\nimport LightProbe\t\t\t\t\t= require(\"awayjs-display/lib/entities/LightProbe\");\nimport PointLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\n\n/**\n * LightPickerBase provides an abstract base clase for light picker classes. These classes are responsible for\n * feeding materials with relevant lights. Usually, StaticLightPicker can be used, but LightPickerBase can be\n * extended to provide more application-specific dynamic selection of lights.\n *\n * @see StaticLightPicker\n */\nclass LightPickerBase extends NamedAssetBase implements IAsset\n{\n\tpublic _pNumPointLights:number = 0;\n\tpublic _pNumDirectionalLights:number = 0;\n\tpublic _pNumCastingPointLights:number = 0;\n\tpublic _pNumCastingDirectionalLights:number = 0;\n\tpublic _pNumLightProbes:number = 0;\n\n\tpublic _pAllPickedLights:Array<LightBase>;\n\tpublic _pPointLights:Array<PointLight>;\n\tpublic _pCastingPointLights:Array<PointLight>;\n\tpublic _pDirectionalLights:Array<DirectionalLight>;\n\tpublic _pCastingDirectionalLights:Array<DirectionalLight>;\n\tpublic _pLightProbes:Array<LightProbe>;\n\tpublic _pLightProbeWeights:Array<number>;\n\n\t/**\n\t * Creates a new LightPickerBase object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * Disposes resources used by the light picker.\n\t */\n\tpublic dispose()\n\t{\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.LIGHT_PICKER;\n\t}\n\n\t/**\n\t * The maximum amount of directional lights that will be provided.\n\t */\n\tpublic get numDirectionalLights():number\n\t{\n\t\treturn this._pNumDirectionalLights;\n\t}\n\n\t/**\n\t * The maximum amount of point lights that will be provided.\n\t */\n\tpublic get numPointLights():number\n\t{\n\t\treturn this._pNumPointLights;\n\t}\n\n\t/**\n\t * The maximum amount of directional lights that cast shadows.\n\t */\n\tpublic get numCastingDirectionalLights():number\n\t{\n\t\treturn this._pNumCastingDirectionalLights;\n\t}\n\n\t/**\n\t * The amount of point lights that cast shadows.\n\t */\n\tpublic get numCastingPointLights():number\n\t{\n\t\treturn this._pNumCastingPointLights;\n\t}\n\n\t/**\n\t * The maximum amount of light probes that will be provided.\n\t */\n\tpublic get numLightProbes():number\n\t{\n\t\treturn this._pNumLightProbes;\n\t}\n\n\t/**\n\t * The collected point lights to be used for shading.\n\t */\n\tpublic get pointLights():Array<PointLight>\n\t{\n\t\treturn this._pPointLights;\n\t}\n\n\t/**\n\t * The collected directional lights to be used for shading.\n\t */\n\tpublic get directionalLights():Array<DirectionalLight>\n\t{\n\t\treturn this._pDirectionalLights;\n\t}\n\n\t/**\n\t * The collected point lights that cast shadows to be used for shading.\n\t */\n\tpublic get castingPointLights():Array<PointLight>\n\t{\n\t\treturn this._pCastingPointLights;\n\t}\n\n\t/**\n\t * The collected directional lights that cast shadows to be used for shading.\n\t */\n\tpublic get castingDirectionalLights():Array<DirectionalLight>\n\t{\n\t\treturn this._pCastingDirectionalLights;\n\t}\n\n\t/**\n\t * The collected light probes to be used for shading.\n\t */\n\tpublic get lightProbes():Array<LightProbe>\n\t{\n\t\treturn this._pLightProbes;\n\t}\n\n\t/**\n\t * The weights for each light probe, defining their influence on the object.\n\t */\n\tpublic get lightProbeWeights():Array<number>\n\t{\n\t\treturn this._pLightProbeWeights;\n\t}\n\n\t/**\n\t * A collection of all the collected lights.\n\t */\n\tpublic get allPickedLights():Array<LightBase>\n\t{\n\t\treturn this._pAllPickedLights;\n\t}\n\n\t/**\n\t * Updates set of lights for a given renderable and EntityCollector. Always call super.collectLights() after custom overridden code.\n\t */\n\tpublic collectLights(renderable:IRenderable)\n\t{\n\t\tthis.updateProbeWeights(renderable);\n\t}\n\n\t/**\n\t * Updates the weights for the light probes, based on the renderable's position relative to them.\n\t * @param renderable The renderble for which to calculate the light probes' influence.\n\t */\n\tprivate updateProbeWeights(renderable:IRenderable)\n\t{\n\t\t// todo: this will cause the same calculations to occur per TriangleSubMesh. See if this can be improved.\n\t\tvar objectPos:Vector3D = renderable.sourceEntity.scenePosition;\n\t\tvar lightPos:Vector3D;\n\n\t\tvar rx:number = objectPos.x, ry:number = objectPos.y, rz:number = objectPos.z;\n\t\tvar dx:number, dy:number, dz:number;\n\t\tvar w:number, total:number = 0;\n\t\tvar i:number;\n\n\t\t// calculates weights for probes\n\t\tfor (i = 0; i < this._pNumLightProbes; ++i) {\n\n\t\t\tlightPos = this._pLightProbes[i].scenePosition;\n\t\t\tdx = rx - lightPos.x;\n\t\t\tdy = ry - lightPos.y;\n\t\t\tdz = rz - lightPos.z;\n\t\t\t// weight is inversely proportional to square of distance\n\t\t\tw = dx*dx + dy*dy + dz*dz;\n\n\t\t\t// just... huge if at the same spot\n\t\t\tw = w > .00001? 1/w : 50000000;\n\t\t\tthis._pLightProbeWeights[i] = w;\n\t\t\ttotal += w;\n\t\t}\n\n\t\t// normalize\n\t\ttotal = 1/total;\n\n\t\tfor (i = 0; i < this._pNumLightProbes; ++i)\n\t\t\tthis._pLightProbeWeights[i] *= total;\n\t}\n}\n\nexport = LightPickerBase;","import Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nimport LightBase\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\nimport DirectionalLight\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\nimport LightProbe\t\t\t\t\t= require(\"awayjs-display/lib/entities/LightProbe\");\nimport PointLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\nimport LightEvent\t\t\t\t\t= require(\"awayjs-display/lib/events/LightEvent\");\nimport LightPickerBase\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\n\n/**\n * StaticLightPicker is a light picker that provides a static set of lights. The lights can be reassigned, but\n * if the configuration changes (number of directional lights, point lights, etc), a material recompilation may\n * occur.\n */\nclass StaticLightPicker extends LightPickerBase\n{\n\tprivate _lights:Array<any>;\n\tprivate _onCastShadowChangeDelegate:Function;\n\n\t/**\n\t * Creates a new StaticLightPicker object.\n\t * @param lights The lights to be used for shading.\n\t */\n\tconstructor(lights)\n\t{\n\t\tsuper();\n\n\t\tthis._onCastShadowChangeDelegate = (event:LightEvent) => this.onCastShadowChange(event);\n\n\t\tthis.lights = lights;\n\t}\n\n\t/**\n\t * The lights used for shading.\n\t */\n\tpublic get lights()\n\t{\n\t\treturn this._lights;\n\t}\n\n\tpublic set lights(value:Array<any>)\n\t{\n\t\tvar numPointLights:number = 0;\n\t\tvar numDirectionalLights:number = 0;\n\t\tvar numCastingPointLights:number = 0;\n\t\tvar numCastingDirectionalLights:number = 0;\n\t\tvar numLightProbes:number = 0;\n\t\tvar light:LightBase;\n\n\t\tif (this._lights)\n\t\t\tthis.clearListeners();\n\n\t\tthis._lights = value;\n\t\tthis._pAllPickedLights = value;\n\t\tthis._pPointLights = new Array<PointLight>();\n\t\tthis._pCastingPointLights = new Array<PointLight>();\n\t\tthis._pDirectionalLights = new Array<DirectionalLight>();\n\t\tthis._pCastingDirectionalLights = new Array<DirectionalLight>();\n\t\tthis._pLightProbes = new Array<LightProbe>();\n\n\t\tvar len:number = value.length;\n\n\t\tfor (var i:number = 0; i < len; ++i) {\n\t\t\tlight = value[i];\n\t\t\tlight.addEventListener(LightEvent.CASTS_SHADOW_CHANGE, this._onCastShadowChangeDelegate);\n\n\t\t\tif (light instanceof PointLight) {\n\t\t\t\tif (light.castsShadows)\n\t\t\t\t\tthis._pCastingPointLights[numCastingPointLights++] = <PointLight> light;\n\t\t\t\telse\n\t\t\t\t\tthis._pPointLights[numPointLights++] = <PointLight> light;\n\n\t\t\t} else if (light instanceof DirectionalLight) {\n\t\t\t\tif (light.castsShadows)\n\t\t\t\t\tthis._pCastingDirectionalLights[numCastingDirectionalLights++] = <DirectionalLight> light;\n\t\t\t\telse\n\t\t\t\t\tthis._pDirectionalLights[numDirectionalLights++] = <DirectionalLight> light;\n\n\t\t\t} else if (light instanceof LightProbe) {\n\t\t\t\tthis._pLightProbes[numLightProbes++] = <LightProbe> light;\n\t\t\t}\n\t\t}\n\n\t\tif (this._pNumDirectionalLights == numDirectionalLights && this._pNumPointLights == numPointLights && this._pNumLightProbes == numLightProbes && this._pNumCastingPointLights == numCastingPointLights && this._pNumCastingDirectionalLights == numCastingDirectionalLights)\n\t\t\treturn;\n\n\t\tthis._pNumDirectionalLights = numDirectionalLights;\n\t\tthis._pNumCastingDirectionalLights = numCastingDirectionalLights;\n\t\tthis._pNumPointLights = numPointLights;\n\t\tthis._pNumCastingPointLights = numCastingPointLights;\n\t\tthis._pNumLightProbes = numLightProbes;\n\n\t\t// MUST HAVE MULTIPLE OF 4 ELEMENTS!\n\t\tthis._pLightProbeWeights = new Array<number>(Math.ceil(numLightProbes/4)*4);\n\n\t\t// notify material lights have changed\n\t\tthis.dispatchEvent(new Event(Event.CHANGE));\n\n\t}\n\n\t/**\n\t * Remove configuration change listeners on the lights.\n\t */\n\tprivate clearListeners()\n\t{\n\t\tvar len:number = this._lights.length;\n\t\tfor (var i:number = 0; i < len; ++i)\n\t\t\tthis._lights[i].removeEventListener(LightEvent.CASTS_SHADOW_CHANGE, this._onCastShadowChangeDelegate);\n\t}\n\n\t/**\n\t * Notifies the material of a configuration change.\n\t */\n\tprivate onCastShadowChange(event:LightEvent)\n\t{\n\t\t// TODO: Assign to special caster collections, just append it to the lights in SinglePass\n\t\t// But keep seperated in multipass\n\n\t\tvar light:LightBase = <LightBase> event.target;\n\n\t\tif (light instanceof PointLight)\n\t\t\tthis.updatePointCasting(<PointLight> light);\n\t\telse if (light instanceof DirectionalLight)\n\t\t\tthis.updateDirectionalCasting(<DirectionalLight> light);\n\n\t\tthis.dispatchEvent(new Event(Event.CHANGE));\n\t}\n\n\t/**\n\t * Called when a directional light's shadow casting configuration changes.\n\t */\n\tprivate updateDirectionalCasting(light:DirectionalLight)\n\t{\n\t\tvar dl:DirectionalLight = <DirectionalLight> light;\n\n\t\tif (light.castsShadows) {\n\t\t\t--this._pNumDirectionalLights;\n\t\t\t++this._pNumCastingDirectionalLights;\n\n\n\t\t\tthis._pDirectionalLights.splice(this._pDirectionalLights.indexOf(dl), 1);\n\t\t\tthis._pCastingDirectionalLights.push(light);\n\n\t\t} else {\n\t\t\t++this._pNumDirectionalLights;\n\t\t\t--this._pNumCastingDirectionalLights;\n\n\t\t\tthis._pCastingDirectionalLights.splice(this._pCastingDirectionalLights.indexOf(dl), 1);\n\t\t\tthis._pDirectionalLights.push(light);\n\t\t}\n\t}\n\n\t/**\n\t * Called when a point light's shadow casting configuration changes.\n\t */\n\tprivate updatePointCasting(light:PointLight)\n\t{\n\t\tvar pl:PointLight = <PointLight> light;\n\n\t\tif (light.castsShadows) {\n\t\t\t--this._pNumPointLights;\n\t\t\t++this._pNumCastingPointLights;\n\t\t\tthis._pPointLights.splice(this._pPointLights.indexOf(pl), 1);\n\t\t\tthis._pCastingPointLights.push(light);\n\t\t} else {\n\t\t\t++this._pNumPointLights;\n\t\t\t--this._pNumCastingPointLights;\n\n\t\t\tthis._pCastingPointLights.splice(this._pCastingPointLights.indexOf(pl), 1);\n\t\t\tthis._pPointLights.push(light);\n\t\t}\n\t}\n}\n\nexport = StaticLightPicker;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\nimport IEventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/IEventDispatcher\");\nimport FreeMatrixProjection\t\t\t= require(\"awayjs-core/lib/projections/FreeMatrixProjection\");\nimport IProjection\t\t\t\t\t= require(\"awayjs-core/lib/projections/IProjection\");\n\nimport Scene\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/Scene\");\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/render/IRenderer\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport DirectionalShadowMapper\t\t= require(\"awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper\");\nimport RenderTexture\t\t\t\t= require(\"awayjs-core/lib/textures/RenderTexture\");\nimport TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nclass CascadeShadowMapper extends DirectionalShadowMapper implements IEventDispatcher\n{\n\tpublic _pScissorRects:Rectangle[];\n\tprivate _pScissorRectsInvalid:boolean = true;\n\tprivate _splitRatios:number[];\n\n\tprivate _numCascades:number /*int*/;\n\tprivate _depthCameras:Array<Camera>;\n\tprivate _depthLenses:Array<FreeMatrixProjection>;\n\n\tprivate _texOffsetsX:Array<number>;\n\tprivate _texOffsetsY:Array<number>;\n\n\tprivate _changeDispatcher:EventDispatcher;\n\tprivate _nearPlaneDistances:number[];\n\n\tconstructor(numCascades:number /*uint*/ = 3)\n\t{\n\t\tsuper();\n\n\t\tif (numCascades < 1 || numCascades > 4)\n\t\t\tthrow new Error(\"numCascades must be an integer between 1 and 4\");\n\n\t\tthis._numCascades = numCascades;\n\t\tthis._changeDispatcher = new EventDispatcher(this);\n\t\tthis.init();\n\t}\n\n\tpublic getSplitRatio(index:number /*uint*/):number\n\t{\n\t\treturn this._splitRatios[index];\n\t}\n\n\tpublic setSplitRatio(index:number /*uint*/, value:number)\n\t{\n\t\tif (value < 0)\n\t\t\tvalue = 0;\n\t\telse if (value > 1)\n\t\t\tvalue = 1;\n\n\t\tif (index >= this._numCascades)\n\t\t\tthrow new Error(\"index must be smaller than the number of cascades!\");\n\n\t\tthis._splitRatios[index] = value;\n\t}\n\n\tpublic getDepthProjections(partition:number /*uint*/):Matrix3D\n\t{\n\t\treturn this._depthCameras[partition].viewProjection;\n\t}\n\n\tprivate init()\n\t{\n\t\tthis._splitRatios = new Array<number>(this._numCascades);\n\t\tthis._nearPlaneDistances = new Array<number>(this._numCascades);\n\n\t\tvar s:number = 1;\n\t\tfor (var i:number /*int*/ = this._numCascades - 1; i >= 0; --i) {\n\t\t\tthis._splitRatios[i] = s;\n\t\t\ts *= .4;\n\t\t}\n\n\t\tthis._texOffsetsX = Array<number>(-1, 1, -1, 1);\n\t\tthis._texOffsetsY = Array<number>(1, 1, -1, -1);\n\t\tthis._pScissorRects = new Array<Rectangle>(4);\n\t\tthis._depthLenses = new Array<FreeMatrixProjection>();\n\t\tthis._depthCameras = new Array<Camera>();\n\n\t\tfor (i = 0; i < this._numCascades; ++i) {\n\t\t\tthis._depthLenses[i] = new FreeMatrixProjection();\n\t\t\tthis._depthCameras[i] = new Camera(this._depthLenses[i]);\n\t\t}\n\t}\n\n\tpublic _pSetDepthMapSize(value:number /*uint*/)\n\t{\n\t\tsuper._pSetDepthMapSize(value);\n\n\t\tthis.invalidateScissorRects();\n\t}\n\n\tprivate invalidateScissorRects()\n\t{\n\t\tthis._pScissorRectsInvalid = true;\n\t}\n\n\tpublic get numCascades():number /*int*/\n\t{\n\t\treturn this._numCascades;\n\t}\n\n\tpublic set numCascades(value:number /*int*/)\n\t{\n\t\tif (value == this._numCascades)\n\t\t\treturn;\n\n\t\tif (value < 1 || value > 4)\n\t\t\tthrow new Error(\"numCascades must be an integer between 1 and 4\");\n\n\t\tthis._numCascades = value;\n\t\tthis.invalidateScissorRects();\n\t\tthis.init();\n\t\tthis.dispatchEvent(new Event(Event.CHANGE));\n\t}\n\n\tpublic pDrawDepthMap(target:RenderTexture, scene:Scene, renderer:IRenderer)\n\t{\n\t\tif (this._pScissorRectsInvalid)\n\t\t\tthis.updateScissorRects();\n\n\t\tthis._pCasterCollector.cullPlanes = this._pCullPlanes;\n\t\tthis._pCasterCollector.camera = this._pOverallDepthCamera;\n\t\tthis._pCasterCollector.clear();\n\t\tscene.traversePartitions(this._pCasterCollector);\n\n\t\trenderer._iRenderCascades(this._pCasterCollector, target, this._numCascades, this._pScissorRects, this._depthCameras);\n\t}\n\n\tprivate updateScissorRects()\n\t{\n\t\tvar half:number = this._pDepthMapSize*.5;\n\n\t\tthis._pScissorRects[0] = new Rectangle(0, 0, half, half);\n\t\tthis._pScissorRects[1] = new Rectangle(half, 0, half, half);\n\t\tthis._pScissorRects[2] = new Rectangle(0, half, half, half);\n\t\tthis._pScissorRects[3] = new Rectangle(half, half, half, half);\n\n\t\tthis._pScissorRectsInvalid = false;\n\t}\n\n\tpublic pUpdateDepthProjection(viewCamera:Camera)\n\t{\n\t\tvar matrix:Matrix3D;\n\t\tvar projection:IProjection = viewCamera.projection;\n\t\tvar projectionNear:number = projection.near;\n\t\tvar projectionRange:number = projection.far - projectionNear;\n\n\t\tthis.pUpdateProjectionFromFrustumCorners(viewCamera, viewCamera.projection.frustumCorners, this._pMatrix);\n\t\tthis._pMatrix.appendScale(.96, .96, 1);\n\t\tthis._pOverallDepthProjection.matrix = this._pMatrix;\n\t\tthis.pUpdateCullPlanes(viewCamera);\n\n\t\tfor (var i:number /*int*/ = 0; i < this._numCascades; ++i) {\n\t\t\tmatrix = this._depthLenses[i].matrix;\n\n\t\t\tthis._nearPlaneDistances[i] = projectionNear + this._splitRatios[i]*projectionRange;\n\t\t\tthis._depthCameras[i].transform = this._pOverallDepthCamera.transform;\n\n\t\t\tthis.updateProjectionPartition(matrix, this._splitRatios[i], this._texOffsetsX[i], this._texOffsetsY[i]);\n\n\t\t\tthis._depthLenses[i].matrix = matrix;\n\t\t}\n\t}\n\n\tprivate updateProjectionPartition(matrix:Matrix3D, splitRatio:number, texOffsetX:number, texOffsetY:number)\n\t{\n\t\tvar raw:Array<number> = Matrix3DUtils.RAW_DATA_CONTAINER;\n\t\tvar xN:number, yN:number, zN:number;\n\t\tvar xF:number, yF:number, zF:number;\n\t\tvar minX:number = Number.POSITIVE_INFINITY, minY:number = Number.POSITIVE_INFINITY, minZ:number;\n\t\tvar maxX:number = Number.NEGATIVE_INFINITY, maxY:number = Number.NEGATIVE_INFINITY, maxZ:number = Number.NEGATIVE_INFINITY;\n\t\tvar i:number /*uint*/ = 0;\n\n\t\twhile (i < 12) {\n\t\t\txN = this._pLocalFrustum[i];\n\t\t\tyN = this._pLocalFrustum[i + 1];\n\t\t\tzN = this._pLocalFrustum[i + 2];\n\t\t\txF = xN + (this._pLocalFrustum[i + 12] - xN)*splitRatio;\n\t\t\tyF = yN + (this._pLocalFrustum[i + 13] - yN)*splitRatio;\n\t\t\tzF = zN + (this._pLocalFrustum[i + 14] - zN)*splitRatio;\n\t\t\tif (xN < minX)\n\t\t\t\tminX = xN;\n\t\t\tif (xN > maxX)\n\t\t\t\tmaxX = xN;\n\t\t\tif (yN < minY)\n\t\t\t\tminY = yN;\n\t\t\tif (yN > maxY)\n\t\t\t\tmaxY = yN;\n\t\t\tif (zN > maxZ)\n\t\t\t\tmaxZ = zN;\n\t\t\tif (xF < minX)\n\t\t\t\tminX = xF;\n\t\t\tif (xF > maxX)\n\t\t\t\tmaxX = xF;\n\t\t\tif (yF < minY)\n\t\t\t\tminY = yF;\n\t\t\tif (yF > maxY)\n\t\t\t\tmaxY = yF;\n\t\t\tif (zF > maxZ)\n\t\t\t\tmaxZ = zF;\n\t\t\ti += 3;\n\t\t}\n\n\t\tminZ = 1;\n\n\t\tvar w:number = (maxX - minX);\n\t\tvar h:number = (maxY - minY);\n\t\tvar d:number = 1/(maxZ - minZ);\n\n\t\tif (minX < 0)\n\t\t\tminX -= this._pSnap; // because int() rounds up for < 0\n\t\tif (minY < 0)\n\t\t\tminY -= this._pSnap;\n\t\tminX = Math.floor(minX/this._pSnap)*this._pSnap;\n\t\tminY = Math.floor(minY/this._pSnap)*this._pSnap;\n\n\t\tvar snap2:number = 2*this._pSnap;\n\t\tw = Math.floor(w/snap2 + 1)*snap2;\n\t\th = Math.floor(h/snap2 + 1)*snap2;\n\n\t\tmaxX = minX + w;\n\t\tmaxY = minY + h;\n\n\t\tw = 1/w;\n\t\th = 1/h;\n\n\t\traw[0] = 2*w;\n\t\traw[5] = 2*h;\n\t\traw[10] = d;\n\t\traw[12] = -(maxX + minX)*w;\n\t\traw[13] = -(maxY + minY)*h;\n\t\traw[14] = -minZ*d;\n\t\traw[15] = 1;\n\t\traw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[8] = raw[9] = raw[11] = 0;\n\n\t\tmatrix.copyRawDataFrom(raw);\n\t\tmatrix.appendScale(.96, .96, 1);\n\t\tmatrix.appendTranslation(texOffsetX, texOffsetY, 0);\n\t\tmatrix.appendScale(.5, .5, 1);\n\t}\n\n\tpublic addEventListener(type:string, listener:Function)\n\t{\n\t\tthis._changeDispatcher.addEventListener(type, listener);\n\t}\n\n\tpublic removeEventListener(type:string, listener:Function)\n\t{\n\t\tthis._changeDispatcher.removeEventListener(type, listener);\n\t}\n\n\tpublic dispatchEvent(event:Event)\n\t{\n\t\treturn this._changeDispatcher.dispatchEvent(event);\n\t}\n\n\tpublic hasEventListener(type:string):boolean\n\t{\n\t\treturn this._changeDispatcher.hasEventListener(type);\n\t}\n\n\tget _iNearPlaneDistances():Array<number>\n\t{\n\t\treturn this._nearPlaneDistances;\n\t}\n}\n\nexport = CascadeShadowMapper;","import Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport PartialImplementationError\t= require(\"awayjs-core/lib/errors/PartialImplementationError\");\nimport PerspectiveProjection\t\t= require(\"awayjs-core/lib/projections/PerspectiveProjection\");\n\nimport Scene\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/Scene\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport PointLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\nimport ShadowMapperBase\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/ShadowMapperBase\");\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/render/IRenderer\");\nimport RenderTexture\t\t\t\t= require(\"awayjs-core/lib/textures/RenderTexture\");\nimport TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nclass CubeMapShadowMapper extends ShadowMapperBase\n{\n\tprivate _depthCameras:Array<Camera>;\n\tprivate _projections:Array<PerspectiveProjection>;\n\tprivate _needsRender:Array<boolean>;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._pDepthMapSize = 512;\n\t\tthis._needsRender = new Array();\n\t\tthis.initCameras();\n\t}\n\n\tprivate initCameras()\n\t{\n\t\tthis._depthCameras = new Array();\n\t\tthis._projections = new Array();\n\n\t\t// posX, negX, posY, negY, posZ, negZ\n\t\tthis.addCamera(0, 90, 0);\n\t\tthis.addCamera(0, -90, 0);\n\t\tthis.addCamera(-90, 0, 0);\n\t\tthis.addCamera(90, 0, 0);\n\t\tthis.addCamera(0, 0, 0);\n\t\tthis.addCamera(0, 180, 0);\n\t}\n\n\tprivate addCamera(rotationX:number, rotationY:number, rotationZ:number)\n\t{\n\t\tvar cam:Camera = new Camera();\n\t\tcam.rotationX = rotationX;\n\t\tcam.rotationY = rotationY;\n\t\tcam.rotationZ = rotationZ;\n\t\tcam.projection.near = .01;\n\n\t\tvar projection:PerspectiveProjection = <PerspectiveProjection> cam.projection;\n\t\tprojection.fieldOfView = 90;\n\t\tthis._projections.push(projection);\n\t\tcam.projection._iAspectRatio = 1;\n\t\tthis._depthCameras.push(cam);\n\t}\n\n\t//@override\n\tpublic pCreateDepthTexture():TextureProxyBase\n\t{\n\t\tthrow new PartialImplementationError();\n\t\t/*\n\t\t return new RenderCubeTexture( this._depthMapSize );\n\t\t */\n\t}\n\n\t//@override\n\tpublic pUpdateDepthProjection(viewCamera:Camera)\n\t{\n\t\tvar light:PointLight = <PointLight>(this._pLight);\n\t\tvar maxDistance:number = light._pFallOff;\n\t\tvar pos:Vector3D = this._pLight.scenePosition;\n\n\t\t// todo: faces outside frustum which are pointing away from camera need not be rendered!\n\t\tfor (var i:number = 0; i < 6; ++i) {\n\t\t\tthis._projections[i].far = maxDistance;\n\t\t\tthis._depthCameras[i].transform.position = pos;\n\t\t\tthis._needsRender[i] = true;\n\t\t}\n\t}\n\n\t//@override\n\tpublic pDrawDepthMap(target:RenderTexture, scene:Scene, renderer:IRenderer)\n\t{\n\t\tfor (var i:number = 0; i < 6; ++i) {\n\t\t\tif (this._needsRender[i]) {\n\t\t\t\tthis._pCasterCollector.camera = this._depthCameras[i];\n\t\t\t\tthis._pCasterCollector.clear();\n\t\t\t\tscene.traversePartitions(this._pCasterCollector);\n\t\t\t\trenderer._iRender(this._pCasterCollector, target, null, i)\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport = CubeMapShadowMapper;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Plane3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Plane3D\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport FreeMatrixProjection\t\t\t= require(\"awayjs-core/lib/projections/FreeMatrixProjection\");\n\nimport Scene\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/Scene\");\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/render/IRenderer\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport DirectionalLight\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\nimport ShadowMapperBase\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/ShadowMapperBase\");\nimport RenderTexture\t\t\t\t= require(\"awayjs-core/lib/textures/RenderTexture\");\nimport TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nclass DirectionalShadowMapper extends ShadowMapperBase\n{\n\tpublic _pOverallDepthCamera:Camera;\n\tpublic _pLocalFrustum:Array<number>;\n\n\tpublic _pLightOffset:number = 10000;\n\tpublic _pMatrix:Matrix3D;\n\tpublic _pOverallDepthProjection:FreeMatrixProjection;\n\tpublic _pSnap:number = 64;\n\n\tpublic _pCullPlanes:Array<Plane3D>;\n\tpublic _pMinZ:number;\n\tpublic _pMaxZ:number;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._pCullPlanes = [];\n\t\tthis._pOverallDepthProjection = new FreeMatrixProjection();\n\t\tthis._pOverallDepthCamera = new Camera(this._pOverallDepthProjection);\n\t\tthis._pLocalFrustum = [];\n\t\tthis._pMatrix = new Matrix3D();\n\t}\n\n\tpublic get snap():number\n\t{\n\t\treturn this._pSnap;\n\t}\n\n\tpublic set snap(value:number)\n\t{\n\t\tthis._pSnap = value;\n\t}\n\n\tpublic get lightOffset():number\n\t{\n\t\treturn this._pLightOffset;\n\t}\n\n\tpublic set lightOffset(value:number)\n\t{\n\t\tthis._pLightOffset = value;\n\t}\n\n\t//@arcane\n\tpublic get iDepthProjection():Matrix3D\n\t{\n\t\treturn this._pOverallDepthCamera.viewProjection;\n\t}\n\n\t//@arcane\n\tpublic get depth():number\n\t{\n\t\treturn this._pMaxZ - this._pMinZ;\n\t}\n\n\t//@override\n\tpublic pDrawDepthMap(target:TextureProxyBase, scene:Scene, renderer:IRenderer)\n\t{\n\t\tthis._pCasterCollector.camera = this._pOverallDepthCamera;\n\t\tthis._pCasterCollector.cullPlanes = this._pCullPlanes;\n\t\tthis._pCasterCollector.clear();\n\t\tscene.traversePartitions(this._pCasterCollector);\n\t\trenderer._iRender(this._pCasterCollector, target);\n\t}\n\n\t//@protected\n\tpublic pUpdateCullPlanes(viewCamera:Camera)\n\t{\n\t\tvar lightFrustumPlanes:Array<Plane3D> = this._pOverallDepthCamera.frustumPlanes;\n\t\tvar viewFrustumPlanes:Array<Plane3D> = viewCamera.frustumPlanes;\n\t\tthis._pCullPlanes.length = 4;\n\n\t\tthis._pCullPlanes[0] = lightFrustumPlanes[0];\n\t\tthis._pCullPlanes[1] = lightFrustumPlanes[1];\n\t\tthis._pCullPlanes[2] = lightFrustumPlanes[2];\n\t\tthis._pCullPlanes[3] = lightFrustumPlanes[3];\n\n\t\tvar light:DirectionalLight = <DirectionalLight> this._pLight;\n\t\tvar dir:Vector3D = light.sceneDirection;\n\t\tvar dirX:number = dir.x;\n\t\tvar dirY:number = dir.y;\n\t\tvar dirZ:number = dir.z;\n\t\tvar j:number = 4;\n\t\tfor (var i:number = 0; i < 6; ++i) {\n\t\t\tvar plane:Plane3D = viewFrustumPlanes[i];\n\t\t\tif (plane.a*dirX + plane.b*dirY + plane.c*dirZ < 0)\n\t\t\t\tthis._pCullPlanes[j++] = plane;\n\t\t}\n\t}\n\n\t//@override\n\tpublic pUpdateDepthProjection(viewCamera:Camera)\n\t{\n\t\tthis.pUpdateProjectionFromFrustumCorners(viewCamera, viewCamera.projection.frustumCorners, this._pMatrix);\n\t\tthis._pOverallDepthProjection.matrix = this._pMatrix;\n\t\tthis.pUpdateCullPlanes(viewCamera);\n\t}\n\n\tpublic pUpdateProjectionFromFrustumCorners(viewCamera:Camera, corners:Array<number>, matrix:Matrix3D)\n\t{\n\t\tvar raw:Array<number> = new Array<number>();\n\t\tvar dir:Vector3D;\n\t\tvar x:number, y:number, z:number;\n\t\tvar minX:number, minY:number;\n\t\tvar maxX:number, maxY:number;\n\t\tvar i:number;\n\n\t\tvar light:DirectionalLight = <DirectionalLight> this._pLight;\n\t\tdir = light.sceneDirection;\n\t\tthis._pOverallDepthCamera.transform.matrix3D = this._pLight.sceneTransform;\n\t\tx = Math.floor((viewCamera.x - dir.x*this._pLightOffset)/this._pSnap)*this._pSnap;\n\t\ty = Math.floor((viewCamera.y - dir.y*this._pLightOffset)/this._pSnap)*this._pSnap;\n\t\tz = Math.floor((viewCamera.z - dir.z*this._pLightOffset)/this._pSnap)*this._pSnap;\n\t\tthis._pOverallDepthCamera.x = x;\n\t\tthis._pOverallDepthCamera.y = y;\n\t\tthis._pOverallDepthCamera.z = z;\n\n\t\tthis._pMatrix.copyFrom(this._pOverallDepthCamera.inverseSceneTransform);\n\t\tthis._pMatrix.prepend(viewCamera.sceneTransform);\n\t\tthis._pMatrix.transformVectors(corners, this._pLocalFrustum);\n\n\t\tminX = maxX = this._pLocalFrustum[0];\n\t\tminY = maxY = this._pLocalFrustum[1];\n\t\tthis._pMaxZ = this._pLocalFrustum[2];\n\n\t\ti = 3;\n\t\twhile (i < 24) {\n\t\t\tx = this._pLocalFrustum[i];\n\t\t\ty = this._pLocalFrustum[i + 1];\n\t\t\tz = this._pLocalFrustum[i + 2];\n\t\t\tif (x < minX)\n\t\t\t\tminX = x;\n\t\t\tif (x > maxX)\n\t\t\t\tmaxX = x;\n\t\t\tif (y < minY)\n\t\t\t\tminY = y;\n\t\t\tif (y > maxY)\n\t\t\t\tmaxY = y;\n\t\t\tif (z > this._pMaxZ)\n\t\t\t\tthis._pMaxZ = z;\n\t\t\ti += 3;\n\t\t}\n\n\t\tthis._pMinZ = 1;\n\n\t\tvar w:number = maxX - minX;\n\t\tvar h:number = maxY - minY;\n\t\tvar d:number = 1/(this._pMaxZ - this._pMinZ);\n\n\t\tif (minX < 0)\n\t\t\tminX -= this._pSnap; // because int() rounds up for < 0\n\n\t\tif (minY < 0)\n\t\t\tminY -= this._pSnap;\n\n\t\tminX = Math.floor(minX/this._pSnap)*this._pSnap;\n\t\tminY = Math.floor(minY/this._pSnap)*this._pSnap;\n\n\t\tvar snap2:number = 2*this._pSnap;\n\t\tw = Math.floor(w/snap2 + 2)*snap2;\n\t\th = Math.floor(h/snap2 + 2)*snap2;\n\n\t\tmaxX = minX + w;\n\t\tmaxY = minY + h;\n\n\t\tw = 1/w;\n\t\th = 1/h;\n\n\t\traw[0] = 2*w;\n\t\traw[5] = 2*h;\n\t\traw[10] = d;\n\t\traw[12] = -(maxX + minX)*w;\n\t\traw[13] = -(maxY + minY)*h;\n\t\traw[14] = -this._pMinZ*d;\n\t\traw[15] = 1;\n\t\traw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[8] = raw[9] = raw[11] = 0;\n\n\t\tmatrix.copyRawDataFrom(raw);\n\t}\n}\n\nexport = DirectionalShadowMapper;","import Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport DirectionalShadowMapper\t\t= require(\"awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper\");\n\nclass NearDirectionalShadowMapper extends DirectionalShadowMapper\n{\n\tprivate _coverageRatio:number;\n\n\tconstructor(coverageRatio:number = .5)\n\t{\n\t\tsuper();\n\n\t\tthis.coverageRatio = coverageRatio;\n\t}\n\n\t/**\n\t * A value between 0 and 1 to indicate the ratio of the view frustum that needs to be covered by the shadow map.\n\t */\n\tpublic get coverageRatio():number\n\t{\n\t\treturn this._coverageRatio;\n\t}\n\n\tpublic set coverageRatio(value:number)\n\t{\n\t\tif (value > 1)\n\t\t\tvalue = 1; else if (value < 0)\n\t\t\tvalue = 0;\n\n\t\tthis._coverageRatio = value;\n\t}\n\n\tpublic pUpdateDepthProjection(viewCamera:Camera)\n\t{\n\t\tvar corners:Array<number> = viewCamera.projection.frustumCorners;\n\n\t\tfor (var i:number /*int*/ = 0; i < 12; ++i) {\n\t\t\tvar v:number = corners[i];\n\t\t\tthis._pLocalFrustum[i] = v;\n\t\t\tthis._pLocalFrustum[i + 12] = v + (corners[i + 12] - v)*this._coverageRatio;\n\t\t}\n\n\t\tthis.pUpdateProjectionFromFrustumCorners(viewCamera, this._pLocalFrustum, this._pMatrix);\n\t\tthis._pOverallDepthProjection.matrix = this._pMatrix;\n\t}\n}\n\nexport = NearDirectionalShadowMapper;","import AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nimport Scene\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/Scene\");\nimport LightBase\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/render/IRenderer\");\nimport EntityCollector\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\nimport ShadowCasterCollector\t\t= require(\"awayjs-display/lib/traverse/ShadowCasterCollector\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport RenderTexture\t\t\t\t= require(\"awayjs-core/lib/textures/RenderTexture\");\nimport TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nclass ShadowMapperBase\n{\n\n\tpublic _pCasterCollector:ShadowCasterCollector;\n\n\tprivate _depthMap:TextureProxyBase;\n\tpublic _pDepthMapSize:number = 2048;\n\tpublic _pLight:LightBase;\n\tprivate _explicitDepthMap:boolean;\n\tprivate _autoUpdateShadows:boolean = true;\n\tpublic _iShadowsInvalid:boolean;\n\n\tconstructor()\n\t{\n\t\tthis._pCasterCollector = this.pCreateCasterCollector();\n\t}\n\n\tpublic pCreateCasterCollector()\n\t{\n\t\treturn new ShadowCasterCollector();\n\t}\n\n\tpublic get autoUpdateShadows():boolean\n\t{\n\t\treturn this._autoUpdateShadows;\n\t}\n\n\tpublic set autoUpdateShadows(value:boolean)\n\t{\n\t\tthis._autoUpdateShadows = value;\n\t}\n\n\tpublic updateShadows()\n\t{\n\t\tthis._iShadowsInvalid = true;\n\t}\n\n\tpublic iSetDepthMap(depthMap:TextureProxyBase)\n\t{\n\t\tif (this._depthMap == depthMap)\n\t\t\treturn;\n\n\t\tif (this._depthMap && !this._explicitDepthMap)\n\t\t\tthis._depthMap.dispose();\n\n\t\tthis._depthMap = depthMap;\n\n\t\tif (this._depthMap) {\n\t\t\tthis._explicitDepthMap = true;\n\t\t\tthis._pDepthMapSize = this._depthMap.size;\n\t\t} else {\n\t\t\tthis._explicitDepthMap = false;\n\t\t}\n\t}\n\n\tpublic get light():LightBase\n\t{\n\t\treturn this._pLight;\n\t}\n\n\tpublic set light(value:LightBase)\n\t{\n\t\tthis._pLight = value;\n\t}\n\n\tpublic get depthMap():TextureProxyBase\n\t{\n\t\tif (!this._depthMap)\n\t\t\tthis._depthMap = this.pCreateDepthTexture();\n\n\t\treturn this._depthMap;\n\t}\n\n\tpublic get depthMapSize():number\n\t{\n\t\treturn this._pDepthMapSize;\n\t}\n\n\tpublic set depthMapSize(value:number)\n\t{\n\t\tif (value == this._pDepthMapSize)\n\t\t\treturn;\n\n\t\tthis._pSetDepthMapSize(value);\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._pCasterCollector = null;\n\n\t\tif (this._depthMap && !this._explicitDepthMap)\n\t\t\tthis._depthMap.dispose();\n\n\t\tthis._depthMap = null;\n\t}\n\n\tpublic pCreateDepthTexture():TextureProxyBase\n\t{\n\t\treturn new RenderTexture(this._pDepthMapSize, this._pDepthMapSize);\n\t}\n\n\tpublic iRenderDepthMap(entityCollector:EntityCollector, renderer:IRenderer)\n\t{\n\t\tthis._iShadowsInvalid = false;\n\n\t\tthis.pUpdateDepthProjection(entityCollector.camera);\n\n\t\tif (!this._depthMap)\n\t\t\tthis._depthMap = this.pCreateDepthTexture();\n\n\t\tthis.pDrawDepthMap(this._depthMap, entityCollector.scene, renderer);\n\t}\n\n\tpublic pUpdateDepthProjection(viewCamera:Camera)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic pDrawDepthMap(target:TextureProxyBase, scene:Scene, renderer:IRenderer)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic _pSetDepthMapSize(value)\n\t{\n\t\tthis._pDepthMapSize = value;\n\n\t\tif (this._explicitDepthMap) {\n\t\t\tthrow Error(\"Cannot set depth map size for the current renderer.\");\n\t\t} else if (this._depthMap) {\n\t\t\tthis._depthMap.dispose();\n\t\t\tthis._depthMap = null;\n\t\t}\n\t}\n}\n\nexport = ShadowMapperBase;","import EntityNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/EntityNode\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport EntityNodePool\t\t\t\t= require(\"awayjs-display/lib/pool/EntityNodePool\");\n\n/**\n * @class away.partition.CameraNode\n */\nclass CameraNode extends EntityNode\n{\n\tpublic static id:string = \"cameraNode\";\n\n\tconstructor(pool:EntityNodePool, camera:IEntity, partition:Partition)\n\t{\n\t\tsuper(pool, camera, partition);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic acceptTraverser(traverser:CollectorBase)\n\t{\n\t\t// todo: dead end for now, if it has a debug mesh, then sure accept that\n\t}\n}\n\nexport = CameraNode;","import EntityNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/EntityNode\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport EntityNodePool\t\t\t\t= require(\"awayjs-display/lib/pool/EntityNodePool\");\n\n/**\n * @class away.partition.DirectionalLightNode\n */\nclass DirectionalLightNode extends EntityNode\n{\n\tpublic static id:string = \"directionalLightNode\";\n\n\tprivate _directionalLight:IEntity;\n\n\t/**\n\t *\n\t * @param directionalLight\n\t */\n\tconstructor(pool:EntityNodePool, directionalLight:IEntity, partition:Partition)\n\t{\n\t\tsuper(pool, directionalLight, partition);\n\n\t\tthis._directionalLight = directionalLight;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic acceptTraverser(traverser:CollectorBase)\n\t{\n\t\tif (traverser.enterNode(this))\n\t\t\ttraverser.applyDirectionalLight(this._directionalLight);\n\t}\n\n\t/**\n\t *\n\t * @returns {boolean}\n\t */\n\tpublic isCastingShadow():boolean\n\t{\n\t\treturn false;\n\t}\n}\n\nexport = DirectionalLightNode;","import Plane3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Plane3D\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AxisAlignedBoundingBox\t\t= require(\"awayjs-display/lib/bounds/AxisAlignedBoundingBox\");\nimport BoundingSphere\t\t\t\t= require(\"awayjs-display/lib/bounds/BoundingSphere\");\nimport BoundingVolumeBase\t\t\t= require(\"awayjs-display/lib/bounds/BoundingVolumeBase\");\nimport BoundsType\t\t\t\t\t= require(\"awayjs-display/lib/bounds/BoundsType\");\nimport NullBounds\t\t\t\t\t= require(\"awayjs-display/lib/bounds/NullBounds\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport NodeBase\t\t\t\t\t\t= require(\"awayjs-display/lib/partition/NodeBase\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport Mesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\nimport PickingCollisionVO\t\t\t= require(\"awayjs-display/lib/pick/PickingCollisionVO\");\nimport EntityNodePool\t\t\t\t= require(\"awayjs-display/lib/pool/EntityNodePool\");\n\n/**\n * @class away.partition.EntityNode\n */\nclass EntityNode extends NodeBase\n{\n\tpublic static id:string = \"entityNode\";\n\n\tprivate _pool:EntityNodePool;\n\tprivate _entity:IEntity;\n\tprivate _partition:Partition;\n\tprivate _bounds:BoundingVolumeBase;\n\tpublic _iUpdateQueueNext:EntityNode;\n\n\tconstructor(pool:EntityNodePool, entity:IEntity, partition:Partition)\n\t{\n\t\tsuper();\n\t\tthis._pool = pool;\n\t\tthis._entity = entity;\n\t\tthis._partition = partition;\n\t\tthis._iNumEntities = 1;\n\n\t\tthis.updateBounds();\n\n\t\tthis.debugVisible = this._entity.debugVisible;\n\t}\n\n\tpublic get entity():IEntity\n\t{\n\t\treturn this._entity;\n\t}\n\n\tpublic removeFromParent():void\n\t{\n\t\tif (this._iParent)\n\t\t\tthis._iParent.iRemoveNode(this);\n\n\t\tthis._iParent = null;\n\t}\n\n\t/**\n\t *\n\t * @returns {boolean}\n\t */\n\tpublic isCastingShadow():boolean\n\t{\n\t\treturn this.entity.castsShadows;\n\t}\n\n\t/**\n\t *\n\t * @param planes\n\t * @param numPlanes\n\t * @returns {boolean}\n\t */\n\tpublic isInFrustum(planes:Array<Plane3D>, numPlanes:number):boolean\n\t{\n\t\tif (!this._entity._iIsVisible())\n\t\t\treturn false;\n\n\t\treturn this._bounds.isInFrustum(planes, numPlanes);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic acceptTraverser(traverser:CollectorBase)\n\t{\n\t\tif (traverser.enterNode(this)) {\n\t\t\ttraverser.applyEntity(this._entity);\n\n\t\t\tif (this._pImplicitDebugVisible && traverser.isEntityCollector)\n\t\t\t\ttraverser.applyEntity(this._pDebugEntity);\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic isIntersectingRay(rayPosition:Vector3D, rayDirection:Vector3D):boolean\n\t{\n\t\tif (!this._entity._iIsVisible())\n\t\t\treturn false;\n\n\t\tvar pickingCollisionVO:PickingCollisionVO = this._entity._iPickingCollisionVO;\n\t\tpickingCollisionVO.localRayPosition = this._entity.inverseSceneTransform.transformVector(rayPosition);\n\t\tpickingCollisionVO.localRayDirection = this._entity.inverseSceneTransform.deltaTransformVector(rayDirection);\n\n\t\tif (!pickingCollisionVO.localNormal)\n\t\t\tpickingCollisionVO.localNormal = new Vector3D();\n\n\t\tvar rayEntryDistance:number = this._bounds.rayIntersection(pickingCollisionVO.localRayPosition, pickingCollisionVO.localRayDirection, pickingCollisionVO.localNormal);\n\n\t\tif (rayEntryDistance < 0)\n\t\t\treturn false;\n\n\t\tpickingCollisionVO.rayEntryDistance = rayEntryDistance;\n\t\tpickingCollisionVO.rayPosition = rayPosition;\n\t\tpickingCollisionVO.rayDirection = rayDirection;\n\t\tpickingCollisionVO.rayOriginIsInsideBounds = rayEntryDistance == 0;\n\n\t\treturn true;\n\t}\n\n\t/**\n\t *\n\t * @protected\n\t */\n\tpublic _pCreateDebugEntity():IEntity\n\t{\n\t\treturn this._bounds.boundsPrimitive;\n\t}\n\n\tpublic invalidatePartition()\n\t{\n\t\tthis._bounds.invalidate();\n\n\t\tthis._partition.iMarkForUpdate(this);\n\t}\n\n\tpublic updateBounds()\n\t{\n\t\tif (this._entity.boundsType == BoundsType.AXIS_ALIGNED_BOX)\n\t\t\tthis._bounds = new AxisAlignedBoundingBox(this._entity);\n\t\telse if (this._entity.boundsType == BoundsType.SPHERE)\n\t\t\tthis._bounds = new BoundingSphere(this._entity);\n\t\telse if (this._entity.boundsType == BoundsType.NULL)\n\t\t\tthis._bounds = new NullBounds();\n\n\t\tthis.updateDebugEntity();\n\t}\n}\n\nexport = EntityNode;","import EntityNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/EntityNode\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport EntityNodePool\t\t\t\t= require(\"awayjs-display/lib/pool/EntityNodePool\");\n\n/**\n * @class away.partition.LightProbeNode\n */\nclass LightProbeNode extends EntityNode\n{\n\tpublic static id:string = \"lightProbeNode\";\n\n\tprivate _lightProbe:IEntity;\n\n\t/**\n\t *\n\t * @param lightProbe\n\t */\n\tconstructor(pool:EntityNodePool, lightProbe:IEntity, partition:Partition)\n\t{\n\t\tsuper(pool, lightProbe, partition);\n\n\t\tthis._lightProbe = lightProbe;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic acceptTraverser(traverser:CollectorBase)\n\t{\n\t\tif (traverser.enterNode(this))\n\t\t\ttraverser.applyLightProbe(this._lightProbe);\n\t}\n\n\t/**\n\t *\n\t * @returns {boolean}\n\t */\n\tpublic isCastingShadow():boolean\n\t{\n\t\treturn false;\n\t}\n}\n\nexport = LightProbeNode;","import Plane3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Plane3D\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\n\n/**\n * @class away.partition.NodeBase\n */\nclass NodeBase\n{\n\tprivate _debugChildrenVisible:boolean;\n\tprivate _explicitDebugVisible:boolean;\n\tpublic _pImplicitDebugVisible:boolean;\n\tpublic _iParent:NodeBase;\n\tpublic _pChildNodes:Array<NodeBase>;\n\tpublic _pNumChildNodes:number = 0;\n\n\tpublic _pDebugEntity:IEntity;\n\n\tpublic _iNumEntities:number = 0;\n\tpublic _iCollectionMark:number;// = 0;\n\n\t/**\n\t *\n\t */\n\tpublic get debugVisible():boolean\n\t{\n\t\treturn this._explicitDebugVisible;\n\t}\n\n\tpublic set debugVisible(value:boolean)\n\t{\n\t\tif (this._explicitDebugVisible == value)\n\t\t\treturn;\n\n\t\tthis._explicitDebugVisible = value;\n\n\t\tthis._iUpdateImplicitDebugVisible(this._iParent? this._iParent.debugChildrenVisible : false);\n\n\t}\n\n\tpublic get debugChildrenVisible():boolean\n\t{\n\t\treturn this._debugChildrenVisible;\n\t}\n\n\tpublic set debugChildrenVisible(value:boolean)\n\t{\n\t\tif (this._debugChildrenVisible == value)\n\t\t\treturn;\n\n\t\tthis._debugChildrenVisible = value;\n\n\t\tfor (var i:number = 0; i < this._pNumChildNodes; ++i)\n\t\t\tthis._pChildNodes[i]._iUpdateImplicitDebugVisible(this._debugChildrenVisible);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get parent():NodeBase\n\t{\n\t\treturn this._iParent;\n\t}\n\n\t/**\n\t *\n\t * @protected\n\t */\n\tpublic get _pNumEntities():number\n\t{\n\t\treturn this._iNumEntities;\n\t}\n\n\t/**\n\t *\n\t */\n\tconstructor()\n\t{\n\t\tthis._pChildNodes = new Array<NodeBase>();\n\t}\n\n\t/**\n\t *\n\t * @param planes\n\t * @param numPlanes\n\t * @returns {boolean}\n\t * @internal\n\t */\n\tpublic isInFrustum(planes:Array<Plane3D>, numPlanes:number):boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t *\n\t * @param rayPosition\n\t * @param rayDirection\n\t * @returns {boolean}\n\t */\n\tpublic isIntersectingRay(rayPosition:Vector3D, rayDirection:Vector3D):boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t *\n\t * @returns {boolean}\n\t */\n\tpublic isCastingShadow():boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t *\n\t * @param entity\n\t * @returns {away.partition.NodeBase}\n\t */\n\tpublic findPartitionForEntity(entity:IEntity):NodeBase\n\t{\n\t\treturn this;\n\t}\n\n\t/**\n\t *\n\t * @param traverser\n\t */\n\tpublic acceptTraverser(traverser:CollectorBase)\n\t{\n\t\tif (this._pNumEntities == 0 && !this._pImplicitDebugVisible)\n\t\t\treturn;\n\n\t\tif (traverser.enterNode(this)) {\n\t\t\tvar i:number = 0;\n\n\t\t\twhile (i < this._pNumChildNodes)\n\t\t\t\tthis._pChildNodes[i++].acceptTraverser(traverser);\n\n\t\t\tif (this._pImplicitDebugVisible && traverser.isEntityCollector)\n\t\t\t\ttraverser.applyEntity(this._pDebugEntity);\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @protected\n\t */\n\tpublic applyDebugEntity(traverser:CollectorBase)\n\t{\n\t\tif (this._pDebugEntity == null)\n\t\t\tthis._pDebugEntity = this._pCreateDebugEntity();\n\n\t\ttraverser.applyEntity(this._pDebugEntity);\n\t}\n\n\t/**\n\t *\n\t * @param node\n\t * @internal\n\t */\n\tpublic iAddNode(node:NodeBase)\n\t{\n\t\tnode._iParent = this;\n\t\tthis._iNumEntities += node._pNumEntities;\n\t\tthis._pChildNodes[ this._pNumChildNodes++ ] = node;\n\n\t\tnode._iUpdateImplicitDebugVisible(this.debugChildrenVisible);\n\n\t\tvar numEntities:number = node._pNumEntities;\n\t\tnode = this;\n\n\t\tdo {\n\t\t\tnode._iNumEntities += numEntities;\n\t\t} while ((node = node._iParent) != null);\n\t}\n\n\t/**\n\t *\n\t * @param node\n\t * @internal\n\t */\n\tpublic iRemoveNode(node:NodeBase)\n\t{\n\t\tvar index:number = this._pChildNodes.indexOf(node);\n\t\tthis._pChildNodes[index] = this._pChildNodes[--this._pNumChildNodes];\n\t\tthis._pChildNodes.pop();\n\n\t\tnode._iUpdateImplicitDebugVisible(false);\n\n\t\tvar numEntities:number = node._pNumEntities;\n\t\tnode = this;\n\n\t\tdo {\n\t\t\tnode._pNumEntities -= numEntities;\n\t\t} while ((node = node._iParent) != null);\n\t}\n\n\tprivate _iUpdateImplicitDebugVisible(value:boolean)\n\t{\n\t\tif (this._pImplicitDebugVisible == this._explicitDebugVisible || value)\n\t\t\treturn;\n\n\t\tthis._pImplicitDebugVisible = this._explicitDebugVisible || value;\n\n\t\tfor (var i:number = 0; i < this._pNumChildNodes; ++i)\n\t\t\tthis._pChildNodes[i]._iUpdateImplicitDebugVisible(this._debugChildrenVisible);\n\n\t\tif (this._pImplicitDebugVisible) {\n\t\t\tthis._pDebugEntity = this._pCreateDebugEntity();\n\t\t} else {\n\t\t\t//this._pDebugEntity.dispose();\n\t\t\tthis._pDebugEntity = null;\n\t\t}\n\t\t\n\t}\n\n\tpublic updateDebugEntity()\n\t{\n\t\tif (this._pImplicitDebugVisible) {\n\t\t\t//this._pDebugEntity.dispose();\n\t\t\tthis._pDebugEntity = this._pCreateDebugEntity();\n\t\t}\n\t}\n\n\tpublic _pCreateDebugEntity():IEntity\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n}\n\nexport = NodeBase;","/**\n * @class away.partition.NullNode\n */\nclass NullNode\n{\n\tconstructor()\n\t{\n\t}\n}\n\nexport = NullNode;","import Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport DirectionalLight\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport LightProbe\t\t\t\t\t= require(\"awayjs-display/lib/entities/LightProbe\");\nimport PointLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\nimport CameraNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/CameraNode\");\nimport DirectionalLightNode\t\t\t= require(\"awayjs-display/lib/partition/DirectionalLightNode\");\nimport EntityNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/EntityNode\");\nimport LightProbeNode\t\t\t\t= require(\"awayjs-display/lib/partition/LightProbeNode\");\nimport PointLightNode\t\t\t\t= require(\"awayjs-display/lib/partition/PointLightNode\");\nimport SkyboxNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/SkyboxNode\");\nimport NodeBase\t\t\t\t\t\t= require(\"awayjs-display/lib/partition/NodeBase\");\nimport NullNode\t\t\t\t\t\t= require(\"awayjs-display/lib/partition/NullNode\");\nimport EntityNodePool\t\t\t\t= require(\"awayjs-display/lib/pool/EntityNodePool\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\n\n/**\n * @class away.partition.Partition\n */\nclass Partition\n{\n\tprivate _cameraNodePool:EntityNodePool;\n\tprivate _directionalLightNodePool:EntityNodePool;\n\tprivate _entityNodePool:EntityNodePool;\n\tprivate _lightProbeNodePool:EntityNodePool;\n\tprivate _pointLightNodePool:EntityNodePool;\n\tprivate _skyboxNodePool:EntityNodePool;\n\n\tpublic _rootNode:NodeBase;\n\tprivate _updatesMade:Boolean = false;\n\tprivate _updateQueue:EntityNode;\n\n\tconstructor(rootNode:NodeBase)\n\t{\n\t\tthis._rootNode = rootNode || <NodeBase> new NullNode();\n\n\t\tthis._cameraNodePool = new EntityNodePool(CameraNode, this);\n\t\tthis._directionalLightNodePool = new EntityNodePool(DirectionalLightNode, this);\n\t\tthis._entityNodePool = new EntityNodePool(EntityNode, this);\n\t\tthis._lightProbeNodePool = new EntityNodePool(LightProbeNode, this);\n\t\tthis._pointLightNodePool = new EntityNodePool(PointLightNode, this);\n\t\tthis._skyboxNodePool = new EntityNodePool(SkyboxNode, this);\n\t}\n\n\tpublic get rootNode():NodeBase\n\t{\n\t\treturn this._rootNode;\n\t}\n\n\tpublic traverse(traverser:CollectorBase)\n\t{\n\t\tif (this._updatesMade)\n\t\t\tthis.updateEntities();\n\n\t\tthis._rootNode.acceptTraverser(traverser);\n\t}\n\n\tpublic iMarkForUpdate(node:EntityNode)\n\t{\n\t\tvar t:EntityNode = this._updateQueue;\n\n\t\twhile (t) {\n\t\t\tif (node == t)\n\t\t\t\treturn;\n\n\t\t\tt = t._iUpdateQueueNext;\n\t\t}\n\n\t\tnode._iUpdateQueueNext = this._updateQueue;\n\n\t\tthis._updateQueue = node;\n\t\tthis._updatesMade = true;\n\t}\n\n\tpublic iRemoveEntity(node:EntityNode)\n\t{\n\t\tvar t:EntityNode;\n\n\t\tnode.removeFromParent();\n\n\t\tif (node == this._updateQueue) {\n\t\t\tthis._updateQueue = node._iUpdateQueueNext;\n\t\t} else {\n\t\t\tt = this._updateQueue;\n\t\t\twhile (t && t._iUpdateQueueNext != node)\n\t\t\t\tt = t._iUpdateQueueNext;\n\n\t\t\tif (t)\n\t\t\t\tt._iUpdateQueueNext = node._iUpdateQueueNext;\n\t\t}\n\n\t\tnode._iUpdateQueueNext = null;\n\n\t\tif (!this._updateQueue)\n\t\t\tthis._updatesMade = false;\n\t}\n\n\tprivate updateEntities()\n\t{\n\t\tvar node:EntityNode = this._updateQueue;\n\t\tvar targetNode:NodeBase;\n\t\tvar t:EntityNode;\n\t\tthis._updateQueue = null;\n\t\tthis._updatesMade = false;\n\n\t\tdo {\n\t\t\ttargetNode = this._rootNode.findPartitionForEntity(node.entity);\n\n\t\t\tif (node.parent != targetNode) {\n\t\t\t\tif (node)\n\t\t\t\t\tnode.removeFromParent();\n\n\t\t\t\ttargetNode.iAddNode(node);\n\t\t\t}\n\n\t\t\tt = node._iUpdateQueueNext;\n\t\t\tnode._iUpdateQueueNext = null;\n\n\t\t\t//required for controllers with autoUpdate set to true\n\t\t\tnode.entity._iInternalUpdate();\n\n\t\t} while ((node = t) != null);\n\t}\n\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iRegisterCamera(camera:Camera)\n\t{\n\t\tthis.iMarkForUpdate(this._cameraNodePool.getItem(camera));\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iRegisterDirectionalLight(directionalLight:DirectionalLight)\n\t{\n\t\tthis.iMarkForUpdate(this._directionalLightNodePool.getItem(directionalLight));\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iRegisterEntity(entity:IEntity)\n\t{\n\t\tthis.iMarkForUpdate(this._entityNodePool.getItem(entity));\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iRegisterLightProbe(lightProbe:LightProbe)\n\t{\n\t\tthis.iMarkForUpdate(this._lightProbeNodePool.getItem(lightProbe));\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iRegisterPointLight(pointLight:PointLight)\n\t{\n\t\tthis.iMarkForUpdate(this._pointLightNodePool.getItem(pointLight));\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iRegisterSkybox(skybox:Skybox)\n\t{\n\t\tthis.iMarkForUpdate(this._skyboxNodePool.getItem(skybox));\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iUnregisterCamera(camera:Camera)\n\t{\n\t\tthis.iRemoveEntity(this._cameraNodePool.disposeItem(camera));\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iUnregisterDirectionalLight(directionalLight:DirectionalLight)\n\t{\n\t\tthis.iRemoveEntity(this._directionalLightNodePool.disposeItem(directionalLight));\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iUnregisterEntity(entity:IEntity)\n\t{\n\t\tthis.iRemoveEntity(this._entityNodePool.disposeItem(entity));\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iUnregisterLightProbe(lightProbe:LightProbe)\n\t{\n\t\tthis.iRemoveEntity(this._lightProbeNodePool.disposeItem(lightProbe));\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iUnregisterPointLight(pointLight:PointLight)\n\t{\n\t\tthis.iRemoveEntity(this._pointLightNodePool.disposeItem(pointLight));\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic _iUnregisterSkybox(skybox:Skybox)\n\t{\n\t\tthis.iRemoveEntity(this._skyboxNodePool.disposeItem(skybox));\n\t}\n}\n\nexport = Partition;","import NodeBase\t\t\t\t\t\t= require(\"awayjs-display/lib/partition/NodeBase\");\nimport EntityNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/EntityNode\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport EntityNodePool\t\t\t\t= require(\"awayjs-display/lib/pool/EntityNodePool\");\n\n/**\n * @class away.partition.PointLightNode\n */\nclass PointLightNode extends EntityNode\n{\n\tpublic static id:string = \"pointLightNode\";\n\n\tprivate _pointLight:IEntity;\n\n\t/**\n\t *\n\t * @param pointLight\n\t */\n\tconstructor(pool:EntityNodePool, pointLight:IEntity, partition:Partition)\n\t{\n\t\tsuper(pool, pointLight, partition);\n\n\t\tthis._pointLight = pointLight;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic acceptTraverser(traverser:CollectorBase)\n\t{\n\t\tif (traverser.enterNode(this))\n\t\t\ttraverser.applyPointLight(this._pointLight);\n\t}\n\n\t/**\n\t *\n\t * @returns {boolean}\n\t */\n\tpublic isCastingShadow():boolean\n\t{\n\t\treturn false;\n\t}\n}\n\nexport = PointLightNode;","import Plane3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Plane3D\");\n\nimport NodeBase\t\t\t\t\t\t= require(\"awayjs-display/lib/partition/NodeBase\");\nimport EntityNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/EntityNode\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport EntityNodePool\t\t\t\t= require(\"awayjs-display/lib/pool/EntityNodePool\");\n\n/**\n * SkyboxNode is a space partitioning leaf node that contains a Skybox object.\n *\n * @class away.partition.SkyboxNode\n */\nclass SkyboxNode extends EntityNode\n{\n\tpublic static id:string = \"skyboxNode\";\n\n\tprivate _skyBox:IEntity;\n\n\t/**\n\t * Creates a new SkyboxNode object.\n\t * @param skyBox The Skybox to be contained in the node.\n\t */\n\tconstructor(pool:EntityNodePool, skyBox:IEntity, partition:Partition)\n\t{\n\t\tsuper(pool, skyBox, partition);\n\n\t\tthis._skyBox = skyBox;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic acceptTraverser(traverser:CollectorBase)\n\t{\n\t\tif (traverser.enterNode(<NodeBase> this))\n\t\t\ttraverser.applySkybox(this._skyBox);\n\t}\n\n\t/**\n\t *\n\t * @param planes\n\t * @param numPlanes\n\t * @returns {boolean}\n\t */\n\tpublic isInFrustum(planes:Array<Plane3D>, numPlanes:number):boolean\n\t{\n\t\tif (!this._skyBox._iIsVisible)\n\t\t\treturn false;\n\n\t\t//a skybox is always in view unless its visibility is set to false\n\t\treturn true;\n\t}\n}\n\nexport = SkyboxNode;","import Point\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport DisplayObject\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\n\n/**\n * Value object for a picking collision returned by a picking collider. Created as unique objects on display objects\n *\n * @see away.base.DisplayObject#pickingCollisionVO\n * @see away.core.pick.IPickingCollider\n *\n * @class away.pick.PickingCollisionVO\n */\nclass PickingCollisionVO\n{\n\t/**\n\t * The display object to which this collision object belongs.\n\t */\n\tpublic displayObject:DisplayObject;\n\n\t/**\n\t * The local position of the collision on the entity's surface.\n\t */\n\tpublic localPosition:Vector3D;\n\n\t/**\n\t * The local normal vector at the position of the collision.\n\t */\n\tpublic localNormal:Vector3D;\n\n\t/**\n\t * The uv coordinate at the position of the collision.\n\t */\n\tpublic uv:Point;\n\n\t/**\n\t * The index of the face where the event took pl ace.\n\t */\n\tpublic index:number;\n\n\t/**\n\t * The index of the subGeometry where the event took place.\n\t */\n//\t\tpublic subGeometryIndex:number;\n\n\t/**\n\t * The starting position of the colliding ray in local coordinates.\n\t */\n\tpublic localRayPosition:Vector3D;\n\n\t/**\n\t * The direction of the colliding ray in local coordinates.\n\t */\n\tpublic localRayDirection:Vector3D;\n\n\t/**\n\t * The starting position of the colliding ray in scene coordinates.\n\t */\n\tpublic rayPosition:Vector3D;\n\n\t/**\n\t * The direction of the colliding ray in scene coordinates.\n\t */\n\tpublic rayDirection:Vector3D;\n\n\t/**\n\t * Determines if the ray position is contained within the entity bounds.\n\t *\n\t * @see away3d.entities.Entity#bounds\n\t */\n\tpublic rayOriginIsInsideBounds:boolean;\n\n\t/**\n\t * The distance along the ray from the starting position to the calculated intersection entry point with the entity.\n\t */\n\tpublic rayEntryDistance:number;\n\n\t/**\n\t * The material ownwer associated with a collision.\n\t */\n\tpublic renderableOwner:IRenderableOwner;\n\n\t/**\n\t * Creates a new <code>PickingCollisionVO</code> object.\n\t *\n\t * @param entity The entity to which this collision object belongs.\n\t */\n\tconstructor(displayObject:DisplayObject)\n\t{\n\t\tthis.displayObject = displayObject;\n\t}\n\n}\n\nexport = PickingCollisionVO;","import Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Scene\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/Scene\");\nimport View\t\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/View\");\nimport IPicker\t\t\t\t\t\t= require(\"awayjs-display/lib/pick/IPicker\");\nimport PickingCollisionVO\t\t\t= require(\"awayjs-display/lib/pick/PickingCollisionVO\");\nimport EntityListItem\t\t\t\t= require(\"awayjs-display/lib/pool/EntityListItem\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport RaycastCollector\t\t\t\t= require(\"awayjs-display/lib/traverse/RaycastCollector\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\n\n/**\n * Picks a 3d object from a view or scene by 3D raycast calculations.\n * Performs an initial coarse boundary calculation to return a subset of entities whose bounding volumes intersect with the specified ray,\n * then triggers an optional picking collider on individual entity objects to further determine the precise values of the picking ray collision.\n *\n * @class away.pick.RaycastPicker\n */\nclass RaycastPicker implements IPicker\n{\n\tprivate _findClosestCollision:boolean;\n\tprivate _raycastCollector:RaycastCollector;\n\tprivate _ignoredEntities = [];\n\tprivate _onlyMouseEnabled:boolean = true;\n\n\tprivate _entities:Array<IEntity>;\n\tprivate _numEntities:number = 0;\n\tprivate _hasCollisions:boolean;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get onlyMouseEnabled():boolean\n\t{\n\t\treturn this._onlyMouseEnabled;\n\t}\n\n\tpublic set onlyMouseEnabled(value:boolean)\n\t{\n\t\tthis._onlyMouseEnabled = value;\n\t}\n\n\t/**\n\t * Creates a new <code>RaycastPicker</code> object.\n\t *\n\t * @param findClosestCollision Determines whether the picker searches for the closest bounds collision along the ray,\n\t * or simply returns the first collision encountered. Defaults to false.\n\t */\n\tconstructor(findClosestCollision:boolean = false)\n\t{\n\t\tthis._raycastCollector = new RaycastCollector();\n\n\t\tthis._findClosestCollision = findClosestCollision;\n\t\tthis._entities = new Array<IEntity>();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getViewCollision(x:number, y:number, view:View):PickingCollisionVO\n\t{\n\t\t//update ray\n\t\tvar rayPosition:Vector3D = view.unproject(x, y, 0);\n\t\tvar rayDirection:Vector3D = view.unproject(x, y, 1).subtract(rayPosition);\n\n\t\treturn this.getSceneCollision(rayPosition, rayDirection, view.scene);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getSceneCollision(rayPosition:Vector3D, rayDirection:Vector3D, scene:Scene):PickingCollisionVO\n\t{\n\t\t//clear collector\n\t\tthis._raycastCollector.clear();\n\n\t\t//setup ray vectors\n\t\tthis._raycastCollector.rayPosition = rayPosition;\n\t\tthis._raycastCollector.rayDirection = rayDirection;\n\n\t\t// collect entities to test\n\t\tscene.traversePartitions(this._raycastCollector);\n\n\t\tthis._numEntities = 0;\n\t\tvar node:EntityListItem = this._raycastCollector.entityHead;\n\t\tvar entity:IEntity;\n\n\t\twhile (node) {\n\t\t\tif (!this.isIgnored(entity = node.entity))\n\t\t\t\tthis._entities[this._numEntities++] = entity;\n\n\t\t\tnode = node.next;\n\t\t}\n\n\t\t//early out if no collisions detected\n\t\tif (!this._numEntities)\n\t\t\treturn null;\n\n\t\treturn this.getPickingCollisionVO(this._raycastCollector);\n\t}\n\n//\t\tpublic getEntityCollision(position:Vector3D, direction:Vector3D, entities:Array<IEntity>):PickingCollisionVO\n//\t\t{\n//\t\t\tthis._numEntities = 0;\n//\n//\t\t\tvar entity:IEntity;\n//\t\t\tvar l:number = entities.length;\n//\n//\t\t\tfor (var c:number = 0; c < l; c++) {\n//\t\t\t\tentity = entities[c];\n//\n//\t\t\t\tif (entity.isIntersectingRay(position, direction))\n//\t\t\t\t\tthis._entities[this._numEntities++] = entity;\n//\t\t\t}\n//\n//\t\t\treturn this.getPickingCollisionVO(this._raycastCollector);\n//\t\t}\n\n\tpublic setIgnoreList(entities)\n\t{\n\t\tthis._ignoredEntities = entities;\n\t}\n\n\tprivate isIgnored(entity:IEntity):boolean\n\t{\n\t\tif (this._onlyMouseEnabled && !entity._iIsMouseEnabled())\n\t\t\treturn true;\n\n\t\tvar len:number = this._ignoredEntities.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tif (this._ignoredEntities[i] == entity)\n\t\t\t\treturn true;\n\n\t\treturn false;\n\t}\n\n\tprivate sortOnNearT(entity1:IEntity, entity2:IEntity):number\n\t{\n\t\treturn entity1._iPickingCollisionVO.rayEntryDistance > entity2._iPickingCollisionVO.rayEntryDistance? 1 : -1;\n\t}\n\n\tprivate getPickingCollisionVO(collector:CollectorBase):PickingCollisionVO\n\t{\n\t\t// trim before sorting\n\t\tthis._entities.length = this._numEntities;\n\n\t\t// Sort entities from closest to furthest.\n\t\tthis._entities = this._entities.sort(this.sortOnNearT); // TODO - test sort filter in JS\n\n\t\t// ---------------------------------------------------------------------\n\t\t// Evaluate triangle collisions when needed.\n\t\t// Replaces collision data provided by bounds collider with more precise data.\n\t\t// ---------------------------------------------------------------------\n\n\t\tvar shortestCollisionDistance:number = Number.MAX_VALUE;\n\t\tvar bestCollisionVO:PickingCollisionVO;\n\t\tvar pickingCollisionVO:PickingCollisionVO;\n\t\tvar entity:IEntity;\n\t\tvar i:number;\n\n\t\tfor (i = 0; i < this._numEntities; ++i) {\n\t\t\tentity = this._entities[i];\n\t\t\tpickingCollisionVO = entity._iPickingCollisionVO;\n\t\t\tif (entity.pickingCollider) {\n\t\t\t\t// If a collision exists, update the collision data and stop all checks.\n\t\t\t\tif ((bestCollisionVO == null || pickingCollisionVO.rayEntryDistance < bestCollisionVO.rayEntryDistance) && entity._iTestCollision(shortestCollisionDistance, this._findClosestCollision)) {\n\t\t\t\t\tshortestCollisionDistance = pickingCollisionVO.rayEntryDistance;\n\t\t\t\t\tbestCollisionVO = pickingCollisionVO;\n\t\t\t\t\tif (!this._findClosestCollision) {\n\t\t\t\t\t\tthis.updateLocalPosition(pickingCollisionVO);\n\t\t\t\t\t\treturn pickingCollisionVO;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (bestCollisionVO == null || pickingCollisionVO.rayEntryDistance < bestCollisionVO.rayEntryDistance) { // A bounds collision with no triangle collider stops all checks.\n\t\t\t\t// Note: a bounds collision with a ray origin inside its bounds is ONLY ever used\n\t\t\t\t// to enable the detection of a corresponsding triangle collision.\n\t\t\t\t// Therefore, bounds collisions with a ray origin inside its bounds can be ignored\n\t\t\t\t// if it has been established that there is NO triangle collider to test\n\t\t\t\tif (!pickingCollisionVO.rayOriginIsInsideBounds) {\n\t\t\t\t\tthis.updateLocalPosition(pickingCollisionVO);\n\t\t\t\t\treturn pickingCollisionVO;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn bestCollisionVO;\n\t}\n\n\tprivate updateLocalPosition(pickingCollisionVO:PickingCollisionVO)\n\t{\n\t\tvar collisionPos:Vector3D = ( pickingCollisionVO.localPosition == null )? (pickingCollisionVO.localPosition = new Vector3D()) : pickingCollisionVO.localPosition;\n\n\t\tvar rayDir:Vector3D = pickingCollisionVO.localRayDirection;\n\t\tvar rayPos:Vector3D = pickingCollisionVO.localRayPosition;\n\t\tvar t:number = pickingCollisionVO.rayEntryDistance;\n\t\tcollisionPos.x = rayPos.x + t*rayDir.x;\n\t\tcollisionPos.y = rayPos.y + t*rayDir.y;\n\t\tcollisionPos.z = rayPos.z + t*rayDir.z;\n\t}\n\n\tpublic dispose()\n\t{\n\t\t//TODO\n\t}\n}\n\nexport = RaycastPicker;","import CSSRenderableBase\t\t\t= require(\"awayjs-display/lib/pool/CSSRenderableBase\");\nimport IRenderablePool\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderablePool\");\nimport Billboard\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\n\n/**\n * @class away.pool.RenderableListItem\n */\nclass CSSBillboardRenderable extends CSSRenderableBase\n{\n\tpublic static id:string = \"billboard\";\n\n\tconstructor(pool:IRenderablePool, billboard:Billboard)\n\t{\n\t\tsuper(pool, billboard, billboard);\n\n\t\tvar div:HTMLDivElement = <HTMLDivElement> document.createElement(\"div\");\n\t\tdiv.onmousedown = (event:MouseEvent) => false;\n\n\t\tthis.htmlElement = div;\n\n\t\tvar style:MSStyleCSSProperties = div.style;\n\n\t\tstyle.position = \"absolute\";\n\t\tstyle.transformOrigin\n\t\t\t= style[\"-webkit-transform-origin\"]\n\t\t\t= style[\"-moz-transform-origin\"]\n\t\t\t= style[\"-o-transform-origin\"]\n\t\t\t= style[\"-ms-transform-origin\"] = \"0% 0%\";\n\n\t\tvar img:HTMLDivElement = <HTMLDivElement> document.createElement(\"div\");\n\n\t\tdiv.appendChild(img);\n\n\t\timg.className = \"material\" + billboard.material.id;\n\t}\n}\n\nexport = CSSBillboardRenderable;","import CSSRenderableBase\t\t\t= require(\"awayjs-display/lib/pool/CSSRenderableBase\");\nimport IRenderablePool\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderablePool\");\nimport LineSegment\t\t\t\t\t= require(\"awayjs-display/lib/entities/LineSegment\");\n\n/**\n * @class away.pool.RenderableListItem\n */\nclass CSSLineSegmentRenderable extends CSSRenderableBase\n{\n\tpublic static id:string = \"lineSegment\";\n\n\tconstructor(pool:IRenderablePool, lineSegment:LineSegment)\n\t{\n\t\tsuper(pool, lineSegment, lineSegment);\n\n\t\tvar div:HTMLDivElement = <HTMLDivElement> document.createElement(\"div\");\n\t\tdiv.onmousedown = (event:MouseEvent) => false;\n\n\t\tthis.htmlElement = div;\n\n\t\tvar style:MSStyleCSSProperties = div.style;\n\n\t\tstyle.position = \"absolute\";\n\t\tstyle.transformOrigin\n\t\t\t= style[\"-webkit-transform-origin\"]\n\t\t\t= style[\"-moz-transform-origin\"]\n\t\t\t= style[\"-o-transform-origin\"]\n\t\t\t= style[\"-ms-transform-origin\"] = \"0% 0%\";\n\n\t\tvar img:HTMLDivElement = <HTMLDivElement> document.createElement(\"div\");\n\n\t\tdiv.appendChild(img);\n\n\t\timg.className = \"material\" + lineSegment.material.id;\n\t}\n}\n\nexport = CSSLineSegmentRenderable;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\n\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\nimport IRenderable\t\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderable\");\nimport IRenderablePool\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderablePool\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\n\n/**\n * @class away.pool.RenderableListItem\n */\nclass CSSRenderableBase implements IRenderable\n{\n\t/**\n\t *\n\t */\n\tprivate _pool:IRenderablePool;\n\n\t/**\n\t *\n\t */\n\tpublic next:CSSRenderableBase;\n\n\t/**\n\t *\n\t */\n\tpublic materialId:number;\n\n\t/**\n\t *\n\t */\n\tpublic renderOrderId:number;\n\n\t/**\n\t *\n\t */\n\tpublic zIndex:number;\n\n\t/**\n\t *\n\t */\n\tpublic cascaded:boolean;\n\n\t/**\n\t *\n\t */\n\tpublic renderSceneTransform:Matrix3D;\n\n\t/**\n\t *\n\t */\n\tpublic sourceEntity:IEntity;\n\n\t/**\n\t *\n\t */\n\tpublic renderObjectId:number;\n\n\t/**\n\t *\n\t */\n\tpublic renderableOwner:IRenderableOwner;\n\n\t/**\n\t *\n\t */\n\tpublic htmlElement:HTMLElement;\n\n\t/**\n\t *\n\t * @param sourceEntity\n\t * @param material\n\t * @param animator\n\t */\n\tconstructor(pool:IRenderablePool, sourceEntity:IEntity, renderableOwner:IRenderableOwner)\n\t{\n\t\t//store a reference to the pool for later disposal\n\t\tthis._pool = pool;\n\n\t\tthis.sourceEntity = sourceEntity;\n\n\t\tthis.renderableOwner = renderableOwner;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._pool.disposeItem(this.renderableOwner);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic invalidateGeometry()\n\t{\n\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic invalidateIndexData()\n\t{\n\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic invalidateVertexData(dataType:string)\n\t{\n\n\t}\n}\n\nexport = CSSRenderableBase;","import CSSRenderableBase\t\t\t= require(\"awayjs-display/lib/pool/CSSRenderableBase\");\nimport IRenderablePool\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderablePool\");\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\n\n\n/**\n * @class away.pool.CSSSkyboxRenderable\n */\nclass CSSSkyboxRenderable extends CSSRenderableBase\n{\n\tpublic static id:string = \"skybox\";\n\n\tconstructor(pool:IRenderablePool, skyBox:Skybox)\n\t{\n\t\tsuper(pool, skyBox, skyBox);\n\n\t\tvar div:HTMLDivElement = <HTMLDivElement> document.createElement(\"div\");\n\t\tdiv.onmousedown = (event:MouseEvent) => false;\n\n\t\tthis.htmlElement = div;\n\n\t\tvar style:MSStyleCSSProperties = div.style;\n\t\tvar img:HTMLDivElement;\n\n\t\t//create the six images that make up the skybox\n\t\tstyle.position = \"absolute\";\n\t\tstyle.transformOrigin\n\t\t\t= style[\"-webkit-transform-origin\"]\n\t\t\t= style[\"-moz-transform-origin\"]\n\t\t\t= style[\"-o-transform-origin\"]\n\t\t\t= style[\"-ms-transform-origin\"] = \"0% 0%\";\n\n\t\timg = <HTMLDivElement> document.createElement(\"div\");\n\n\t\tdiv.appendChild(img);\n\n\t\timg.className = \"material\" + skyBox.id;\n\t}\n}\n\nexport = CSSSkyboxRenderable;","import EntityListItem\t\t\t\t= require(\"awayjs-display/lib/pool/EntityListItem\");\n\n/**\n * @class away.pool.EntityListItemPool\n */\nclass EntityListItemPool\n{\n\tprivate _pool:Array<EntityListItem>;\n\tprivate _index:number = 0;\n\tprivate _poolSize:number = 0;\n\n\t/**\n\t *\n\t */\n\tconstructor()\n\t{\n\t\tthis._pool = new Array<EntityListItem>();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic getItem():EntityListItem\n\t{\n\t\tvar item:EntityListItem;\n\t\tif (this._index == this._poolSize) {\n\t\t\titem = new EntityListItem();\n\t\t\tthis._pool[this._index++] = item;\n\t\t\t++this._poolSize;\n\t\t} else {\n\t\t\titem = this._pool[this._index++];\n\t\t}\n\t\treturn item;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic freeAll()\n\t{\n\t\tthis._index = 0;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._pool.length = 0;\n\t}\n}\n\nexport = EntityListItemPool;","import IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\n\n/**\n * @class away.pool.EntityListItem\n */\nclass EntityListItem\n{\n\t/**\n\t *\n\t */\n\tpublic entity:IEntity;\n\n\t/**\n\t *\n\t */\n\tpublic next:EntityListItem;\n}\n\nexport = EntityListItem;","import IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport EntityNode\t\t\t\t\t= require(\"awayjs-display/lib/partition/EntityNode\");\nimport Partition\t\t\t\t\t= require(\"awayjs-display/lib/partition/Partition\");\nimport IEntityNodeClass\t\t\t\t= require(\"awayjs-display/lib/pool/IEntityNodeClass\");\n\n/**\n * @class away.pool.EntityNodePool\n */\nclass EntityNodePool\n{\n\tprivate _entityNodePool:Object = new Object();\n\tprivate _entityNodeClass:IEntityNodeClass;\n\tprivate _partition:Partition;\n\n\t/**\n\t * //TODO\n\t *\n\t * @param entityNodeClass\n\t */\n\tconstructor(entityNodeClass:IEntityNodeClass, partition:Partition)\n\t{\n\t\tthis._entityNodeClass = entityNodeClass;\n\t\tthis._partition = partition;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param entity\n\t * @returns EntityNode\n\t */\n\tpublic getItem(entity:IEntity):EntityNode\n\t{\n\t\treturn (this._entityNodePool[entity.id] || (this._entityNodePool[entity.id] = entity._iAddEntityNode(new this._entityNodeClass(this, entity, this._partition))));\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param entity\n\t */\n\tpublic disposeItem(entity:IEntity):EntityNode\n\t{\n\t\tvar entityNode:EntityNode = this._entityNodePool[entity.id];\n\n\t\tif (entityNode) {\n\t\t\tentity._iRemoveEntityNode(entityNode);\n\n\t\t\tthis._entityNodePool[entity.id] = null;\n\t\t}\n\n\t\treturn entityNode;\n\t}\n}\n\nexport = EntityNodePool;","import NamedAssetBase\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nimport DisplayObject\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\n\n/**\n * PrefabBase is an abstract base class for prefabs, which are prebuilt display objects that allow easy cloning and updating\n */\nclass PrefabBase extends NamedAssetBase\n{\n\tpublic _pObjects:Array<DisplayObject> = new Array<DisplayObject>();\n\n//\t\tpublic _pBatchObjects:Array<BatchObject> = new Array<BatchObject>();\n\n\t/**\n\t * Creates a new PrefabBase object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * Returns a display object generated from this prefab\n\t */\n\tpublic getNewObject():DisplayObject\n\t{\n\t\tvar object:DisplayObject = this._pCreateObject();\n\n\t\tthis._pObjects.push(object);\n\n\t\treturn object;\n\t}\n\n//\t\tpublic getNewBatchObject():BatchObject\n//\t\t{\n//\t\t\tvar object:BatchObject = this._pCreateBatchObject();\n//\n//\t\t\tthis._pBatchObjects.push(object);\n//\n//\t\t\treturn object;\n//\t\t}\n\n\tpublic _pCreateObject():DisplayObject\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic _iValidate()\n\t{\n\t\t// To be overridden when necessary\n\t}\n}\n\nexport = PrefabBase;","import IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\n\nimport LineSubGeometry\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\nimport SubGeometryBase\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport TriangleSubGeometry\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport PrimitivePrefabBase\t\t= require(\"awayjs-display/lib/prefabs/PrimitivePrefabBase\");\n\n/**\n * A Capsule primitive mesh.\n */\nclass PrimitiveCapsulePrefab extends PrimitivePrefabBase implements IAsset\n{\n\tprivate _radius:number;\n\tprivate _height:number;\n\tprivate _segmentsW:number;\n\tprivate _segmentsH:number;\n\tprivate _yUp:boolean;\n\tprivate _numVertices:number = 0;\n\n\t/**\n\t * The radius of the capsule.\n\t */\n\tpublic get radius():number\n\t{\n\t\treturn this._radius;\n\t}\n\n\tpublic set radius(value:number)\n\t{\n\t\tthis._radius = value;\n\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * The height of the capsule.\n\t */\n\tpublic get height():number\n\t{\n\t\treturn this._height;\n\t}\n\n\tpublic set height(value:number)\n\t{\n\t\tthis._height = value;\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * Defines the number of horizontal segments that make up the capsule. Defaults to 16.\n\t */\n\tpublic get segmentsW():number\n\t{\n\t\treturn this._segmentsW;\n\t}\n\n\tpublic set segmentsW(value:number)\n\t{\n\t\tthis._segmentsW = value;\n\n\t\tthis._pInvalidateGeometry();\n\t\tthis._pInvalidateUVs();\n\t}\n\n\t/**\n\t * Defines the number of vertical segments that make up the capsule. Defaults to 15. Must be uneven.\n\t */\n\tpublic get segmentsH():number\n\t{\n\t\treturn this._segmentsH;\n\t}\n\n\tpublic set segmentsH(value:number)\n\t{\n\t\tthis._segmentsH = (value%2 == 0)? value + 1 : value;\n\n\t\tthis._pInvalidateGeometry();\n\t\tthis._pInvalidateUVs();\n\t}\n\n\t/**\n\t * Defines whether the capsule poles should lay on the Y-axis (true) or on the Z-axis (false).\n\t */\n\tpublic get yUp():boolean\n\t{\n\t\treturn this._yUp;\n\t}\n\n\tpublic set yUp(value:boolean)\n\t{\n\t\tthis._yUp = value;\n\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * Creates a new Capsule object.\n\t * @param radius The radius of the capsule.\n\t * @param height The height of the capsule.\n\t * @param segmentsW Defines the number of horizontal segments that make up the capsule. Defaults to 16.\n\t * @param segmentsH Defines the number of vertical segments that make up the capsule. Defaults to 15. Must be uneven value.\n\t * @param yUp Defines whether the capsule poles should lay on the Y-axis (true) or on the Z-axis (false).\n\t */\n\tconstructor(radius:number = 50, height:number = 100, segmentsW:number = 16, segmentsH:number = 15, yUp:boolean = true)\n\t{\n\t\tsuper();\n\n\t\tthis._radius = radius;\n\t\tthis._height = height;\n\t\tthis._segmentsW = segmentsW;\n\t\tthis._segmentsH = (segmentsH%2 == 0)? segmentsH + 1 : segmentsH;\n\t\tthis._yUp = yUp;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pBuildGeometry(target:SubGeometryBase, geometryType:string)\n\t{\n\t\tvar indices:Array<number> /*uint*/;\n\t\tvar positions:Array<number>;\n\t\tvar normals:Array<number>;\n\t\tvar tangents:Array<number>;\n\n\t\tvar i:number;\n\t\tvar j:number;\n\t\tvar triIndex:number = 0;\n\t\tvar index:number = 0;\n\t\tvar startIndex:number;\n\t\tvar comp1:number, comp2:number, t1:number, t2:number;\n\t\tvar numIndices:number = 0;\n\n\t\tif (geometryType == \"triangleSubGeometry\") {\n\n\t\t\tvar triangleGeometry:TriangleSubGeometry = <TriangleSubGeometry> target;\n\n\t\t\t// evaluate target number of vertices, triangles and indices\n\t\t\tthis._numVertices = (this._segmentsH + 1)*(this._segmentsW + 1); // segmentsH + 1 because of closure, segmentsW + 1 because of closure\n\t\t\tnumIndices = (this._segmentsH - 1)*this._segmentsW*6; // each level has segmentH quads, each of 2 triangles\n\n\t\t\t// need to initialize raw arrays or can be reused?\n\t\t\tif (this._numVertices == triangleGeometry.numVertices) {\n\t\t\t\tindices = triangleGeometry.indices;\n\t\t\t\tpositions = triangleGeometry.positions;\n\t\t\t\tnormals = triangleGeometry.vertexNormals;\n\t\t\t\ttangents = triangleGeometry.vertexTangents;\n\t\t\t} else {\n\t\t\t\tindices = new Array<number>(numIndices)\n\t\t\t\tpositions = new Array<number>(this._numVertices*3);\n\t\t\t\tnormals = new Array<number>(this._numVertices*3);\n\t\t\t\ttangents = new Array<number>(this._numVertices*3);\n\n\t\t\t\tthis._pInvalidateUVs();\n\t\t\t}\n\n\t\t\tfor (j = 0; j <= this._segmentsH; ++j) {\n\n\t\t\t\tvar horangle:number = Math.PI*j/this._segmentsH;\n\t\t\t\tvar z:number = -this._radius*Math.cos(horangle);\n\t\t\t\tvar ringradius:number = this._radius*Math.sin(horangle);\n\n\t\t\t\tstartIndex = index;\n\n\t\t\t\tfor (i = 0; i <= this._segmentsW; ++i) {\n\t\t\t\t\tvar verangle:number = 2*Math.PI*i/this._segmentsW;\n\t\t\t\t\tvar x:number = ringradius*Math.cos(verangle);\n\t\t\t\t\tvar offset:number = j > this._segmentsH/2? this._height/2 : -this._height/2;\n\t\t\t\t\tvar y:number = ringradius*Math.sin(verangle);\n\t\t\t\t\tvar normLen:number = 1/Math.sqrt(x*x + y*y + z*z);\n\t\t\t\t\tvar tanLen:number = Math.sqrt(y*y + x*x);\n\n\t\t\t\t\tif (this._yUp) {\n\t\t\t\t\t\tt1 = 0;\n\t\t\t\t\t\tt2 = tanLen > .007? x/tanLen : 0;\n\t\t\t\t\t\tcomp1 = -z;\n\t\t\t\t\t\tcomp2 = y;\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tt1 = tanLen > .007? x/tanLen : 0;\n\t\t\t\t\t\tt2 = 0;\n\t\t\t\t\t\tcomp1 = y;\n\t\t\t\t\t\tcomp2 = z;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (i == this._segmentsW) {\n\n\t\t\t\t\t\tpositions[index] = positions[startIndex];\n\t\t\t\t\t\tpositions[index + 1] = positions[startIndex + 1];\n\t\t\t\t\t\tpositions[index + 2] = positions[startIndex + 2];\n\t\t\t\t\t\tnormals[index] = (normals[startIndex] + (x*normLen))*.5;\n\t\t\t\t\t\tnormals[index + 1] = (normals[startIndex + 1] + ( comp1*normLen))*.5;\n\t\t\t\t\t\tnormals[index + 2] = (normals[startIndex + 2] + (comp2*normLen))*.5;\n\t\t\t\t\t\ttangents[index] = (tangents[startIndex] + (tanLen > .007? -y/tanLen : 1))*.5;\n\t\t\t\t\t\ttangents[index + 1] = (tangents[startIndex + 1] + t1)*.5;\n\t\t\t\t\t\ttangents[index + 2] = (tangents[startIndex + 2] + t2)*.5;\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// vertex\n\t\t\t\t\t\tpositions[index] = x;\n\t\t\t\t\t\tpositions[index + 1] = (this._yUp)? comp1 - offset : comp1;\n\t\t\t\t\t\tpositions[index + 2] = (this._yUp)? comp2 : comp2 + offset;\n\t\t\t\t\t\t// normal\n\t\t\t\t\t\tnormals[index] = x*normLen;\n\t\t\t\t\t\tnormals[index + 1] = comp1*normLen;\n\t\t\t\t\t\tnormals[index + 2] = comp2*normLen;\n\t\t\t\t\t\t// tangent\n\t\t\t\t\t\ttangents[index] = tanLen > .007? -y/tanLen : 1;\n\t\t\t\t\t\ttangents[index + 1] = t1;\n\t\t\t\t\t\ttangents[index + 2] = t2;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (i > 0 && j > 0) {\n\t\t\t\t\t\tvar a:number = (this._segmentsW + 1)*j + i;\n\t\t\t\t\t\tvar b:number = (this._segmentsW + 1)*j + i - 1;\n\t\t\t\t\t\tvar c:number = (this._segmentsW + 1)*(j - 1) + i - 1;\n\t\t\t\t\t\tvar d:number = (this._segmentsW + 1)*(j - 1) + i;\n\n\t\t\t\t\t\tif (j == this._segmentsH) {\n\t\t\t\t\t\t\tpositions[index] = positions[startIndex];\n\t\t\t\t\t\t\tpositions[index + 1] = positions[startIndex + 1];\n\t\t\t\t\t\t\tpositions[index + 2] = positions[startIndex + 2];\n\n\t\t\t\t\t\t\tindices[triIndex++] = a;\n\t\t\t\t\t\t\tindices[triIndex++] = c;\n\t\t\t\t\t\t\tindices[triIndex++] = d;\n\n\t\t\t\t\t\t} else if (j == 1) {\n\t\t\t\t\t\t\tindices[triIndex++] = a;\n\t\t\t\t\t\t\tindices[triIndex++] = b;\n\t\t\t\t\t\t\tindices[triIndex++] = c;\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tindices[triIndex++] = a;\n\t\t\t\t\t\t\tindices[triIndex++] = b;\n\t\t\t\t\t\t\tindices[triIndex++] = c;\n\t\t\t\t\t\t\tindices[triIndex++] = a;\n\t\t\t\t\t\t\tindices[triIndex++] = c;\n\t\t\t\t\t\t\tindices[triIndex++] = d;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tindex += 3;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// build real data from raw data\n\t\t\ttriangleGeometry.updateIndices(indices);\n\n\t\t\ttriangleGeometry.updatePositions(positions);\n\t\t\ttriangleGeometry.updateVertexNormals(normals);\n\t\t\ttriangleGeometry.updateVertexTangents(tangents);\n\n\t\t} else if (geometryType == \"lineSubGeometry\") {\n\t\t\t//TODO\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pBuildUVs(target:SubGeometryBase, geometryType:string)\n\t{\n\t\tvar i:number, j:number;\n\t\tvar uvs:Array<number>;\n\n\n\t\tif (geometryType == \"triangleSubGeometry\") {\n\n\t\t\tvar triangleGeometry:TriangleSubGeometry = <TriangleSubGeometry> target;\n\n\t\t\t// need to initialize raw array or can be reused?\n\t\t\tif (triangleGeometry.uvs && this._numVertices == triangleGeometry.numVertices) {\n\t\t\t\tuvs = triangleGeometry.uvs;\n\t\t\t} else {\n\t\t\t\tuvs = new Array<number>(this._numVertices*2);\n\t\t\t}\n\n\t\t\t// current uv component index\n\t\t\tvar index:number = 0;\n\n\t\t\t// surface\n\t\t\tfor (j = 0; j <= this._segmentsH; ++j) {\n\t\t\t\tfor (i = 0; i <= this._segmentsW; ++i) {\n\t\t\t\t\t// revolution vertex\n\t\t\t\t\tuvs[index++] = ( i/this._segmentsW )*triangleGeometry.scaleU;\n\t\t\t\t\tuvs[index++] = ( j/this._segmentsH )*triangleGeometry.scaleV;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// build real data from raw data\n\t\t\ttriangleGeometry.updateUVs(uvs);\n\n\t\t} else if (geometryType == \"lineSubGeometry\") {\n\t\t\t//nothing to do here\n\t\t}\n\t}\n}\n\nexport = PrimitiveCapsulePrefab;","import IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\n\nimport PrimitiveCylinderPrefab\t= require(\"awayjs-display/lib/prefabs/PrimitiveCylinderPrefab\");\n\n/**\n * A UV Cone primitive mesh.\n */\nclass PrimitiveConePrefab extends PrimitiveCylinderPrefab implements IAsset\n{\n\n\t/**\n\t * The radius of the bottom end of the cone.\n\t */\n\tpublic get radius():number\n\t{\n\t\treturn this._pBottomRadius;\n\t}\n\n\tpublic set radius(value:number)\n\t{\n\t\tthis._pBottomRadius = value;\n\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * Creates a new Cone object.\n\t * @param radius The radius of the bottom end of the cone\n\t * @param height The height of the cone\n\t * @param segmentsW Defines the number of horizontal segments that make up the cone. Defaults to 16.\n\t * @param segmentsH Defines the number of vertical segments that make up the cone. Defaults to 1.\n\t * @param yUp Defines whether the cone poles should lay on the Y-axis (true) or on the Z-axis (false).\n\t */\n\tconstructor(radius:number = 50, height:number = 100, segmentsW:number = 16, segmentsH:number = 1, closed:boolean = true, yUp:boolean = true)\n\t{\n\t\tsuper(0, radius, height, segmentsW, segmentsH, false, closed, true, yUp);\n\t}\n}\n\nexport = PrimitiveConePrefab;","import IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\n\nimport LineSubGeometry\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\nimport SubGeometryBase\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport TriangleSubGeometry\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport PrimitivePrefabBase\t\t= require(\"awayjs-display/lib/prefabs/PrimitivePrefabBase\");\n\n/**\n * A Cube primitive prefab.\n */\nclass PrimitiveCubePrefab extends PrimitivePrefabBase implements IAsset\n{\n\tprivate _width:number;\n\tprivate _height:number;\n\tprivate _depth:number;\n\tprivate _tile6:boolean;\n\n\tprivate _segmentsW:number;\n\tprivate _segmentsH:number;\n\tprivate _segmentsD:number;\n\n\t/**\n\t * Creates a new Cube object.\n\t * @param width The size of the cube along its X-axis.\n\t * @param height The size of the cube along its Y-axis.\n\t * @param depth The size of the cube along its Z-axis.\n\t * @param segmentsW The number of segments that make up the cube along the X-axis.\n\t * @param segmentsH The number of segments that make up the cube along the Y-axis.\n\t * @param segmentsD The number of segments that make up the cube along the Z-axis.\n\t * @param tile6 The type of uv mapping to use. When true, a texture will be subdivided in a 2x3 grid, each used for a single face. When false, the entire image is mapped on each face.\n\t */\n\tconstructor(width:number = 100, height:number = 100, depth:number = 100, segmentsW:number = 1, segmentsH:number = 1, segmentsD:number = 1, tile6:boolean = true)\n\t{\n\t\tsuper();\n\n\t\tthis._width = width;\n\t\tthis._height = height;\n\t\tthis._depth = depth;\n\t\tthis._segmentsW = segmentsW;\n\t\tthis._segmentsH = segmentsH;\n\t\tthis._segmentsD = segmentsD;\n\t\tthis._tile6 = tile6;\n\t}\n\n\t/**\n\t * The size of the cube along its X-axis.\n\t */\n\tpublic get width():number\n\t{\n\t\treturn this._width;\n\t}\n\n\tpublic set width(value:number)\n\t{\n\t\tthis._width = value;\n\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * The size of the cube along its Y-axis.\n\t */\n\tpublic get height():number\n\t{\n\t\treturn this._height;\n\t}\n\n\tpublic set height(value:number)\n\t{\n\t\tthis._height = value;\n\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * The size of the cube along its Z-axis.\n\t */\n\tpublic get depth():number\n\t{\n\t\treturn this._depth;\n\t}\n\n\tpublic set depth(value:number)\n\t{\n\t\tthis._depth = value;\n\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * The type of uv mapping to use. When false, the entire image is mapped on each face.\n\t * When true, a texture will be subdivided in a 3x2 grid, each used for a single face.\n\t * Reading the tiles from left to right, top to bottom they represent the faces of the\n\t * cube in the following order: bottom, top, back, left, front, right. This creates\n\t * several shared edges (between the top, front, left and right faces) which simplifies\n\t * texture painting.\n\t */\n\tpublic get tile6():boolean\n\t{\n\t\treturn this._tile6;\n\t}\n\n\tpublic set tile6(value:boolean)\n\t{\n\t\tthis._tile6 = value;\n\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * The number of segments that make up the cube along the X-axis. Defaults to 1.\n\t */\n\tpublic get segmentsW():number\n\t{\n\t\treturn this._segmentsW;\n\t}\n\n\tpublic set segmentsW(value:number)\n\t{\n\t\tthis._segmentsW = value;\n\n\t\tthis._pInvalidateGeometry();\n\t\tthis._pInvalidateUVs();\n\t}\n\n\t/**\n\t * The number of segments that make up the cube along the Y-axis. Defaults to 1.\n\t */\n\tpublic get segmentsH():number\n\t{\n\t\treturn this._segmentsH;\n\t}\n\n\tpublic set segmentsH(value:number)\n\t{\n\t\tthis._segmentsH = value;\n\n\t\tthis._pInvalidateGeometry();\n\t\tthis._pInvalidateUVs();\n\t}\n\n\t/**\n\t * The number of segments that make up the cube along the Z-axis. Defaults to 1.\n\t */\n\tpublic get segmentsD():number\n\t{\n\t\treturn this._segmentsD;\n\t}\n\n\tpublic set segmentsD(value:number)\n\t{\n\t\tthis._segmentsD = value;\n\n\t\tthis._pInvalidateGeometry();\n\t\tthis._pInvalidateUVs();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pBuildGeometry(target:SubGeometryBase, geometryType:string)\n\t{\n\t\tvar indices:Array<number> /*uint*/;\n\t\tvar positions:Array<number>;\n\t\tvar normals:Array<number>;\n\t\tvar tangents:Array<number>;\n\n\t\tvar tl:number, tr:number, bl:number, br:number;\n\t\tvar i:number, j:number, inc:number = 0;\n\n\t\tvar vidx:number, fidx:number; // indices\n\t\tvar hw:number, hh:number, hd:number; // halves\n\t\tvar dw:number, dh:number, dd:number; // deltas\n\n\t\tvar outer_pos:number;\n\t\tvar numIndices:number;\n\t\tvar numVertices:number;\n\n\t\t// half cube dimensions\n\t\thw = this._width/2;\n\t\thh = this._height/2;\n\t\thd = this._depth/2;\n\n\t\tif (geometryType == \"triangleSubGeometry\") {\n\n\t\t\tvar triangleGeometry:TriangleSubGeometry = <TriangleSubGeometry> target;\n\n\t\t\tnumVertices = ((this._segmentsW + 1)*(this._segmentsH + 1) + (this._segmentsW + 1)*(this._segmentsD + 1) + (this._segmentsH + 1)*(this._segmentsD + 1))*2;\n\n\t\t\tnumIndices = ((this._segmentsW*this._segmentsH + this._segmentsW*this._segmentsD + this._segmentsH*this._segmentsD)*12);\n\n\t\t\tif (numVertices == triangleGeometry.numVertices && triangleGeometry.indices != null) {\n\t\t\t\tindices = triangleGeometry.indices;\n\t\t\t\tpositions = triangleGeometry.positions;\n\t\t\t\tnormals = triangleGeometry.vertexNormals;\n\t\t\t\ttangents = triangleGeometry.vertexTangents;\n\t\t\t} else {\n\t\t\t\tindices = new Array<number>(numIndices);\n\t\t\t\tpositions = new Array<number>(numVertices*3);\n\t\t\t\tnormals = new Array<number>(numVertices*3);\n\t\t\t\ttangents = new Array<number>(numVertices*3);\n\n\t\t\t\tthis._pInvalidateUVs();\n\t\t\t}\n\n\t\t\tvidx = 0;\n\t\t\tfidx = 0;\n\n\t\t\t// Segment dimensions\n\t\t\tdw = this._width/this._segmentsW;\n\t\t\tdh = this._height/this._segmentsH;\n\t\t\tdd = this._depth/this._segmentsD;\n\n\t\t\tfor (i = 0; i <= this._segmentsW; i++) {\n\t\t\t\touter_pos = -hw + i*dw;\n\n\t\t\t\tfor (j = 0; j <= this._segmentsH; j++) {\n\t\t\t\t\t// front\n\t\t\t\t\tpositions[vidx] = outer_pos;\n\t\t\t\t\tpositions[vidx + 1] = -hh + j*dh;\n\t\t\t\t\tpositions[vidx + 2] = -hd;\n\t\t\t\t\tnormals[vidx] = 0;\n\t\t\t\t\tnormals[vidx + 1] = 0;\n\t\t\t\t\tnormals[vidx + 2] = -1;\n\t\t\t\t\ttangents[vidx] = 1;\n\t\t\t\t\ttangents[vidx + 1] = 0;\n\t\t\t\t\ttangents[vidx + 2] = 0;\n\t\t\t\t\tvidx += 3;\n\n\t\t\t\t\t// back\n\t\t\t\t\tpositions[vidx] = outer_pos;\n\t\t\t\t\tpositions[vidx + 1] = -hh + j*dh;\n\t\t\t\t\tpositions[vidx + 2] = hd;\n\t\t\t\t\tnormals[vidx] = 0;\n\t\t\t\t\tnormals[vidx + 1] = 0;\n\t\t\t\t\tnormals[vidx + 2] = 1;\n\t\t\t\t\ttangents[vidx] = -1;\n\t\t\t\t\ttangents[vidx + 1] = 0;\n\t\t\t\t\ttangents[vidx + 2] = 0;\n\t\t\t\t\tvidx += 3;\n\n\t\t\t\t\tif (i && j) {\n\t\t\t\t\t\ttl = 2*((i - 1)*(this._segmentsH + 1) + (j - 1));\n\t\t\t\t\t\ttr = 2*(i*(this._segmentsH + 1) + (j - 1));\n\t\t\t\t\t\tbl = tl + 2;\n\t\t\t\t\t\tbr = tr + 2;\n\n\t\t\t\t\t\tindices[fidx++] = tl;\n\t\t\t\t\t\tindices[fidx++] = bl;\n\t\t\t\t\t\tindices[fidx++] = br;\n\t\t\t\t\t\tindices[fidx++] = tl;\n\t\t\t\t\t\tindices[fidx++] = br;\n\t\t\t\t\t\tindices[fidx++] = tr;\n\t\t\t\t\t\tindices[fidx++] = tr + 1;\n\t\t\t\t\t\tindices[fidx++] = br + 1;\n\t\t\t\t\t\tindices[fidx++] = bl + 1;\n\t\t\t\t\t\tindices[fidx++] = tr + 1;\n\t\t\t\t\t\tindices[fidx++] = bl + 1;\n\t\t\t\t\t\tindices[fidx++] = tl + 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tinc += 2*(this._segmentsW + 1)*(this._segmentsH + 1);\n\n\t\t\tfor (i = 0; i <= this._segmentsW; i++) {\n\t\t\t\touter_pos = -hw + i*dw;\n\n\t\t\t\tfor (j = 0; j <= this._segmentsD; j++) {\n\t\t\t\t\t// top\n\t\t\t\t\tpositions[vidx] = outer_pos;\n\t\t\t\t\tpositions[vidx + 1] = hh;\n\t\t\t\t\tpositions[vidx + 2] = -hd + j*dd;\n\t\t\t\t\tnormals[vidx] = 0;\n\t\t\t\t\tnormals[vidx + 1] = 1;\n\t\t\t\t\tnormals[vidx + 2] = 0;\n\t\t\t\t\ttangents[vidx] = 1;\n\t\t\t\t\ttangents[vidx + 1] = 0;\n\t\t\t\t\ttangents[vidx + 2] = 0;\n\t\t\t\t\tvidx += 3;\n\n\t\t\t\t\t// bottom\n\t\t\t\t\tpositions[vidx] = outer_pos;\n\t\t\t\t\tpositions[vidx + 1] = -hh;\n\t\t\t\t\tpositions[vidx + 2] = -hd + j*dd;\n\t\t\t\t\tnormals[vidx] = 0;\n\t\t\t\t\tnormals[vidx + 1] = -1;\n\t\t\t\t\tnormals[vidx + 2] = 0;\n\t\t\t\t\ttangents[vidx] = 1;\n\t\t\t\t\ttangents[vidx + 1] = 0;\n\t\t\t\t\ttangents[vidx + 2] = 0;\n\t\t\t\t\tvidx += 3;\n\n\t\t\t\t\tif (i && j) {\n\t\t\t\t\t\ttl = inc + 2*((i - 1)*(this._segmentsD + 1) + (j - 1));\n\t\t\t\t\t\ttr = inc + 2*(i*(this._segmentsD + 1) + (j - 1));\n\t\t\t\t\t\tbl = tl + 2;\n\t\t\t\t\t\tbr = tr + 2;\n\n\t\t\t\t\t\tindices[fidx++] = tl;\n\t\t\t\t\t\tindices[fidx++] = bl;\n\t\t\t\t\t\tindices[fidx++] = br;\n\t\t\t\t\t\tindices[fidx++] = tl;\n\t\t\t\t\t\tindices[fidx++] = br;\n\t\t\t\t\t\tindices[fidx++] = tr;\n\t\t\t\t\t\tindices[fidx++] = tr + 1;\n\t\t\t\t\t\tindices[fidx++] = br + 1;\n\t\t\t\t\t\tindices[fidx++] = bl + 1;\n\t\t\t\t\t\tindices[fidx++] = tr + 1;\n\t\t\t\t\t\tindices[fidx++] = bl + 1;\n\t\t\t\t\t\tindices[fidx++] = tl + 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tinc += 2*(this._segmentsW + 1)*(this._segmentsD + 1);\n\n\t\t\tfor (i = 0; i <= this._segmentsD; i++) {\n\t\t\t\touter_pos = hd - i*dd;\n\n\t\t\t\tfor (j = 0; j <= this._segmentsH; j++) {\n\t\t\t\t\t// left\n\t\t\t\t\tpositions[vidx] = -hw;\n\t\t\t\t\tpositions[vidx+1] = -hh + j*dh;\n\t\t\t\t\tpositions[vidx+2] = outer_pos;\n\t\t\t\t\tnormals[vidx] = -1;\n\t\t\t\t\tnormals[vidx+1] = 0;\n\t\t\t\t\tnormals[vidx+2] = 0;\n\t\t\t\t\ttangents[vidx] = 0;\n\t\t\t\t\ttangents[vidx+1] = 0;\n\t\t\t\t\ttangents[vidx+2] = -1;\n\t\t\t\t\tvidx += 3;\n\n\t\t\t\t\t// right\n\t\t\t\t\tpositions[vidx] = hw;\n\t\t\t\t\tpositions[vidx+1] = -hh + j*dh;\n\t\t\t\t\tpositions[vidx+2] = outer_pos;\n\t\t\t\t\tnormals[vidx] = 1;\n\t\t\t\t\tnormals[vidx+1] = 0;\n\t\t\t\t\tnormals[vidx+2] = 0;\n\t\t\t\t\ttangents[vidx] = 0;\n\t\t\t\t\ttangents[vidx+1] = 0;\n\t\t\t\t\ttangents[vidx+2] = 1;\n\t\t\t\t\tvidx += 3;\n\n\t\t\t\t\tif (i && j) {\n\t\t\t\t\t\ttl = inc + 2*((i - 1)*(this._segmentsH + 1) + (j - 1));\n\t\t\t\t\t\ttr = inc + 2*(i*(this._segmentsH + 1) + (j - 1));\n\t\t\t\t\t\tbl = tl + 2;\n\t\t\t\t\t\tbr = tr + 2;\n\n\t\t\t\t\t\tindices[fidx++] = tl;\n\t\t\t\t\t\tindices[fidx++] = bl;\n\t\t\t\t\t\tindices[fidx++] = br;\n\t\t\t\t\t\tindices[fidx++] = tl;\n\t\t\t\t\t\tindices[fidx++] = br;\n\t\t\t\t\t\tindices[fidx++] = tr;\n\t\t\t\t\t\tindices[fidx++] = tr + 1;\n\t\t\t\t\t\tindices[fidx++] = br + 1;\n\t\t\t\t\t\tindices[fidx++] = bl + 1;\n\t\t\t\t\t\tindices[fidx++] = tr + 1;\n\t\t\t\t\t\tindices[fidx++] = bl + 1;\n\t\t\t\t\t\tindices[fidx++] = tl + 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttriangleGeometry.updateIndices(indices);\n\n\t\t\ttriangleGeometry.updatePositions(positions);\n\t\t\ttriangleGeometry.updateVertexNormals(normals);\n\t\t\ttriangleGeometry.updateVertexTangents(tangents);\n\n\t\t} else if (geometryType == \"lineSubGeometry\") {\n\t\t\tvar lineGeometry:LineSubGeometry = <LineSubGeometry> target;\n\n\t\t\tvar numSegments:number = this._segmentsH*4 +  this._segmentsW*4 + this._segmentsD*4;\n\t\t\tvar startPositions:Array<number>;\n\t\t\tvar endPositions:Array<number>;\n\t\t\tvar thickness:Array<number>;\n\n\t\t\tif (lineGeometry.indices != null && numSegments == lineGeometry.numSegments) {\n\t\t\t\tstartPositions = lineGeometry.startPositions;\n\t\t\t\tendPositions = lineGeometry.endPositions;\n\t\t\t\tthickness = lineGeometry.thickness;\n\t\t\t} else {\n\t\t\t\tstartPositions = new Array<number>(numSegments*3);\n\t\t\t\tendPositions = new Array<number>(numSegments*3);\n\t\t\t\tthickness = new Array<number>(numSegments);\n\t\t\t}\n\n\t\t\tvidx = 0;\n\n\t\t\tfidx = 0;\n\n\t\t\t//front/back face\n\t\t\tfor (i = 0; i < this._segmentsH; ++i) {\n\t\t\t\tstartPositions[vidx] = -hw;\n\t\t\t\tstartPositions[vidx + 1] = i*this._height/this._segmentsH - hh;\n\t\t\t\tstartPositions[vidx + 2] = -hd;\n\n\t\t\t\tendPositions[vidx] = hw;\n\t\t\t\tendPositions[vidx + 1] = i*this._height/this._segmentsH - hh\n\t\t\t\tendPositions[vidx + 2] = -hd;\n\n\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\tvidx += 3;\n\n\t\t\t\tstartPositions[vidx] = -hw;\n\t\t\t\tstartPositions[vidx + 1] = hh - i*this._height/this._segmentsH;\n\t\t\t\tstartPositions[vidx + 2] = hd;\n\n\t\t\t\tendPositions[vidx] = hw;\n\t\t\t\tendPositions[vidx + 1] = hh - i*this._height/this._segmentsH;\n\t\t\t\tendPositions[vidx + 2] = hd;\n\n\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\tvidx += 3;\n\t\t\t}\n\n\t\t\tfor (i = 0; i < this._segmentsW; ++i) {\n\t\t\t\tstartPositions[vidx] = i*this._width/this._segmentsW - hw;\n\t\t\t\tstartPositions[vidx + 1] = -hh;\n\t\t\t\tstartPositions[vidx + 2] = -hd;\n\n\t\t\t\tendPositions[vidx] = i*this._width/this._segmentsW - hw;\n\t\t\t\tendPositions[vidx + 1] = hh;\n\t\t\t\tendPositions[vidx + 2] = -hd;\n\n\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\tvidx += 3;\n\n\t\t\t\tstartPositions[vidx] = hw - i*this._width/this._segmentsW;\n\t\t\t\tstartPositions[vidx + 1] = -hh;\n\t\t\t\tstartPositions[vidx + 2] = hd;\n\n\t\t\t\tendPositions[vidx] = hw - i*this._width/this._segmentsW;\n\t\t\t\tendPositions[vidx + 1] = hh;\n\t\t\t\tendPositions[vidx + 2] = hd;\n\n\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\tvidx += 3;\n\t\t\t}\n\n\t\t\t//left/right face\n\t\t\tfor (i = 0; i < this._segmentsH; ++i) {\n\t\t\t\tstartPositions[vidx] = -hw;\n\t\t\t\tstartPositions[vidx + 1] = i*this._height/this._segmentsH - hh;\n\t\t\t\tstartPositions[vidx + 2] = -hd;\n\n\t\t\t\tendPositions[vidx] = -hw;\n\t\t\t\tendPositions[vidx + 1] = i*this._height/this._segmentsH - hh\n\t\t\t\tendPositions[vidx + 2] = hd;\n\n\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\tvidx += 3;\n\n\t\t\t\tstartPositions[vidx] = hw;\n\t\t\t\tstartPositions[vidx + 1] = hh - i*this._height/this._segmentsH;\n\t\t\t\tstartPositions[vidx + 2] = -hd;\n\n\t\t\t\tendPositions[vidx] = hw;\n\t\t\t\tendPositions[vidx + 1] = hh - i*this._height/this._segmentsH;\n\t\t\t\tendPositions[vidx + 2] = hd;\n\n\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\tvidx += 3;\n\t\t\t}\n\n\t\t\tfor (i = 0; i < this._segmentsD; ++i) {\n\t\t\t\tstartPositions[vidx] = hw\n\t\t\t\tstartPositions[vidx + 1] = -hh;\n\t\t\t\tstartPositions[vidx + 2] = i*this._depth/this._segmentsD - hd;\n\n\t\t\t\tendPositions[vidx] = hw;\n\t\t\t\tendPositions[vidx + 1] = hh;\n\t\t\t\tendPositions[vidx + 2] = i*this._depth/this._segmentsD - hd;\n\n\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\tvidx += 3;\n\n\t\t\t\tstartPositions[vidx] = -hw;\n\t\t\t\tstartPositions[vidx + 1] = -hh;\n\t\t\t\tstartPositions[vidx + 2] = hd - i*this._depth/this._segmentsD;\n\n\t\t\t\tendPositions[vidx] = -hw;\n\t\t\t\tendPositions[vidx + 1] = hh;\n\t\t\t\tendPositions[vidx + 2] = hd - i*this._depth/this._segmentsD;\n\n\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\tvidx += 3;\n\t\t\t}\n\n\n\t\t\t//top/bottom face\n\t\t\tfor (i = 0; i < this._segmentsD; ++i) {\n\t\t\t\tstartPositions[vidx] = -hw;\n\t\t\t\tstartPositions[vidx + 1] = -hh;\n\t\t\t\tstartPositions[vidx + 2] = hd - i*this._depth/this._segmentsD;\n\n\t\t\t\tendPositions[vidx] = hw;\n\t\t\t\tendPositions[vidx + 1] = -hh;\n\t\t\t\tendPositions[vidx + 2] = hd - i*this._depth/this._segmentsD;\n\n\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\tvidx += 3;\n\n\t\t\t\tstartPositions[vidx] = -hw;\n\t\t\t\tstartPositions[vidx + 1] = hh;\n\t\t\t\tstartPositions[vidx + 2] = i*this._depth/this._segmentsD - hd;\n\n\t\t\t\tendPositions[vidx] = hw;\n\t\t\t\tendPositions[vidx + 1] = hh;\n\t\t\t\tendPositions[vidx + 2] = i*this._depth/this._segmentsD - hd;\n\n\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\tvidx += 3;\n\t\t\t}\n\n\t\t\tfor (i = 0; i < this._segmentsW; ++i) {\n\t\t\t\tstartPositions[vidx] = hw - i*this._width/this._segmentsW;\n\t\t\t\tstartPositions[vidx + 1] = -hh;\n\t\t\t\tstartPositions[vidx + 2] = -hd;\n\n\t\t\t\tendPositions[vidx] = hw - i*this._width/this._segmentsW;\n\t\t\t\tendPositions[vidx + 1] = -hh;\n\t\t\t\tendPositions[vidx + 2] = hd;\n\n\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\tvidx += 3;\n\n\t\t\t\tstartPositions[vidx] = i*this._width/this._segmentsW - hw;\n\t\t\t\tstartPositions[vidx + 1] = hh;\n\t\t\t\tstartPositions[vidx + 2] = -hd;\n\n\t\t\t\tendPositions[vidx] = i*this._width/this._segmentsW - hw;\n\t\t\t\tendPositions[vidx + 1] = hh;\n\t\t\t\tendPositions[vidx + 2] = hd;\n\n\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\tvidx += 3;\n\t\t\t}\n\n\t\t\t// build real data from raw data\n\t\t\tlineGeometry.updatePositions(startPositions, endPositions);\n\t\t\tlineGeometry.updateThickness(thickness);\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pBuildUVs(target:SubGeometryBase, geometryType:string)\n\t{\n\t\tvar i:number, j:number, index:number;\n\t\tvar uvs:Array<number>;\n\n\t\tvar u_tile_dim:number, v_tile_dim:number;\n\t\tvar u_tile_step:number, v_tile_step:number;\n\t\tvar tl0u:number, tl0v:number;\n\t\tvar tl1u:number, tl1v:number;\n\t\tvar du:number, dv:number;\n\t\tvar numVertices:number;\n\n\t\tif (geometryType == \"triangleSubGeometry\") {\n\n\t\t\tnumVertices = ((this._segmentsW + 1)*(this._segmentsH + 1) + (this._segmentsW + 1)*(this._segmentsD + 1) + (this._segmentsH + 1)*(this._segmentsD + 1))*2;\n\n\t\t\tvar triangleGeometry:TriangleSubGeometry = <TriangleSubGeometry> target;\n\n\t\t\tif (numVertices == triangleGeometry.numVertices && triangleGeometry.uvs != null) {\n\t\t\t\tuvs = triangleGeometry.uvs;\n\t\t\t} else {\n\t\t\t\tuvs = new Array<number>(numVertices*2);\n\t\t\t}\n\n\t\t\tif (this._tile6) {\n\t\t\t\tu_tile_dim = u_tile_step = 1/3;\n\t\t\t\tv_tile_dim = v_tile_step = 1/2;\n\t\t\t} else {\n\t\t\t\tu_tile_dim = v_tile_dim = 1;\n\t\t\t\tu_tile_step = v_tile_step = 0;\n\t\t\t}\n\n\t\t\t// Create planes two and two, the same way that they were\n\t\t\t// constructed in the buildGeometry() function. First calculate\n\t\t\t// the top-left UV coordinate for both planes, and then loop\n\t\t\t// over the points, calculating the UVs from these numbers.\n\n\t\t\t// When tile6 is true, the layout is as follows:\n\t\t\t//       .-----.-----.-----. (1,1)\n\t\t\t//       | Bot |  T  | Bak |\n\t\t\t//       |-----+-----+-----|\n\t\t\t//       |  L  |  F  |  R  |\n\t\t\t// (0,0)'-----'-----'-----'\n\n\t\t\tindex = 0;\n\n\t\t\t// FRONT / BACK\n\t\t\ttl0u = 1*u_tile_step;\n\t\t\ttl0v = 1*v_tile_step;\n\t\t\ttl1u = 2*u_tile_step;\n\t\t\ttl1v = 0*v_tile_step;\n\t\t\tdu = u_tile_dim/this._segmentsW;\n\t\t\tdv = v_tile_dim/this._segmentsH;\n\t\t\tfor (i = 0; i <= this._segmentsW; i++) {\n\t\t\t\tfor (j = 0; j <= this._segmentsH; j++) {\n\t\t\t\t\tuvs[index++] = ( tl0u + i*du )*triangleGeometry.scaleU;\n\t\t\t\t\tuvs[index++] = ( tl0v + (v_tile_dim - j*dv))*triangleGeometry.scaleV;\n\n\t\t\t\t\tuvs[index++] = ( tl1u + (u_tile_dim - i*du))*triangleGeometry.scaleU;\n\t\t\t\t\tuvs[index++] = ( tl1v + (v_tile_dim - j*dv))*triangleGeometry.scaleV;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// TOP / BOTTOM\n\t\t\ttl0u = 1*u_tile_step;\n\t\t\ttl0v = 0*v_tile_step;\n\t\t\ttl1u = 0*u_tile_step;\n\t\t\ttl1v = 0*v_tile_step;\n\t\t\tdu = u_tile_dim/this._segmentsW;\n\t\t\tdv = v_tile_dim/this._segmentsD;\n\t\t\tfor (i = 0; i <= this._segmentsW; i++) {\n\t\t\t\tfor (j = 0; j <= this._segmentsD; j++) {\n\t\t\t\t\tuvs[index++] = ( tl0u + i*du)*triangleGeometry.scaleU;\n\t\t\t\t\tuvs[index++] = ( tl0v + (v_tile_dim - j*dv))*triangleGeometry.scaleV;\n\n\t\t\t\t\tuvs[index++] = ( tl1u + i*du)*triangleGeometry.scaleU;\n\t\t\t\t\tuvs[index++] = ( tl1v + j*dv)*triangleGeometry.scaleV;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// LEFT / RIGHT\n\t\t\ttl0u = 0*u_tile_step;\n\t\t\ttl0v = 1*v_tile_step;\n\t\t\ttl1u = 2*u_tile_step;\n\t\t\ttl1v = 1*v_tile_step;\n\t\t\tdu = u_tile_dim/this._segmentsD;\n\t\t\tdv = v_tile_dim/this._segmentsH;\n\t\t\tfor (i = 0; i <= this._segmentsD; i++) {\n\t\t\t\tfor (j = 0; j <= this._segmentsH; j++) {\n\t\t\t\t\tuvs[index++] = ( tl0u + i*du)*triangleGeometry.scaleU;\n\t\t\t\t\tuvs[index++] = ( tl0v + (v_tile_dim - j*dv))*triangleGeometry.scaleV;\n\n\t\t\t\t\tuvs[index++] = ( tl1u + (u_tile_dim - i*du))*triangleGeometry.scaleU;\n\t\t\t\t\tuvs[index++] = ( tl1v + (v_tile_dim - j*dv))*triangleGeometry.scaleV;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttriangleGeometry.updateUVs(uvs);\n\n\t\t} else if (geometryType == \"lineSubGeometry\") {\n\t\t\t//nothing to do here\n\t\t}\n\t}\n}\n\nexport = PrimitiveCubePrefab;","import IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\n\nimport LineSubGeometry\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\nimport SubGeometryBase\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport TriangleSubGeometry\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport PrimitivePrefabBase\t\t= require(\"awayjs-display/lib/prefabs/PrimitivePrefabBase\");\n\n/**\n * A Cylinder primitive mesh.\n */\nclass PrimitiveCylinderPrefab extends PrimitivePrefabBase implements IAsset\n{\n\tpublic _pBottomRadius:number;\n\tpublic _pSegmentsW:number;\n\tpublic _pSegmentsH:number;\n\n\tprivate _topRadius:number;\n\tprivate _height:number;\n\n\tprivate _topClosed:boolean;\n\tprivate _bottomClosed:boolean;\n\tprivate _surfaceClosed:boolean;\n\tprivate _yUp:boolean;\n\tprivate _numVertices:number = 0;\n\n\t/**\n\t * The radius of the top end of the cylinder.\n\t */\n\tpublic get topRadius():number\n\t{\n\t\treturn this._topRadius;\n\t}\n\n\tpublic set topRadius(value:number)\n\t{\n\t\tthis._topRadius = value;\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * The radius of the bottom end of the cylinder.\n\t */\n\tpublic get bottomRadius():number\n\t{\n\t\treturn this._pBottomRadius;\n\t}\n\n\tpublic set bottomRadius(value:number)\n\t{\n\t\tthis._pBottomRadius = value;\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * The radius of the top end of the cylinder.\n\t */\n\tpublic get height():number\n\t{\n\t\treturn this._height;\n\t}\n\n\tpublic set height(value:number)\n\t{\n\t\tthis._height = value;\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * Defines the number of horizontal segments that make up the cylinder. Defaults to 16.\n\t */\n\tpublic get segmentsW():number\n\t{\n\t\treturn this._pSegmentsW;\n\t}\n\n\tpublic set segmentsW(value:number)\n\t{\n\t\tthis.setSegmentsW(value);\n\t}\n\n\tpublic setSegmentsW(value:number)\n\t{\n\t\tthis._pSegmentsW = value;\n\t\tthis._pInvalidateGeometry();\n\t\tthis._pInvalidateUVs();\n\t}\n\n\t/**\n\t * Defines the number of vertical segments that make up the cylinder. Defaults to 1.\n\t */\n\tpublic get segmentsH():number\n\t{\n\t\treturn this._pSegmentsH;\n\t}\n\n\tpublic set segmentsH(value:number)\n\t{\n\n\t\tthis.setSegmentsH(value)\n\n\t}\n\n\tpublic setSegmentsH(value:number)\n\t{\n\t\tthis._pSegmentsH = value;\n\t\tthis._pInvalidateGeometry();\n\t\tthis._pInvalidateUVs();\n\n\t}\n\n\t/**\n\t * Defines whether the top end of the cylinder is closed (true) or open.\n\t */\n\tpublic get topClosed():boolean\n\t{\n\t\treturn this._topClosed;\n\t}\n\n\tpublic set topClosed(value:boolean)\n\t{\n\t\tthis._topClosed = value;\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * Defines whether the bottom end of the cylinder is closed (true) or open.\n\t */\n\tpublic get bottomClosed():boolean\n\t{\n\t\treturn this._bottomClosed;\n\t}\n\n\tpublic set bottomClosed(value:boolean)\n\t{\n\t\tthis._bottomClosed = value;\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * Defines whether the cylinder poles should lay on the Y-axis (true) or on the Z-axis (false).\n\t */\n\tpublic get yUp():boolean\n\t{\n\t\treturn this._yUp;\n\t}\n\n\tpublic set yUp(value:boolean)\n\t{\n\t\tthis._yUp = value;\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * Creates a new Cylinder object.\n\t * @param topRadius The radius of the top end of the cylinder.\n\t * @param bottomRadius The radius of the bottom end of the cylinder\n\t * @param height The radius of the bottom end of the cylinder\n\t * @param segmentsW Defines the number of horizontal segments that make up the cylinder. Defaults to 16.\n\t * @param segmentsH Defines the number of vertical segments that make up the cylinder. Defaults to 1.\n\t * @param topClosed Defines whether the top end of the cylinder is closed (true) or open.\n\t * @param bottomClosed Defines whether the bottom end of the cylinder is closed (true) or open.\n\t * @param yUp Defines whether the cone poles should lay on the Y-axis (true) or on the Z-axis (false).\n\t */\n\tconstructor(topRadius:number = 50, bottomRadius:number = 50, height:number = 100, segmentsW:number = 16, segmentsH:number = 1, topClosed:boolean = true, bottomClosed:boolean = true, surfaceClosed:boolean = true, yUp:boolean = true)\n\t{\n\t\tsuper();\n\n\t\tthis._topRadius = topRadius;\n\t\tthis._pBottomRadius = bottomRadius;\n\t\tthis._height = height;\n\t\tthis._pSegmentsW = segmentsW;\n\t\tthis._pSegmentsH = segmentsH;\n\t\tthis._topClosed = topClosed;\n\t\tthis._bottomClosed = bottomClosed;\n\t\tthis._surfaceClosed = surfaceClosed;\n\t\tthis._yUp = yUp;\n\t}\n\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pBuildGeometry(target:SubGeometryBase, geometryType:string)\n\t{\n\t\tvar indices:Array<number> /*uint*/;\n\t\tvar positions:Array<number>;\n\t\tvar normals:Array<number>;\n\t\tvar tangents:Array<number>;\n\n\t\tvar i:number;\n\t\tvar j:number;\n\t\tvar x:number;\n\t\tvar y:number;\n\t\tvar z:number;\n\t\tvar vidx:number;\n\t\tvar fidx:number;\n\n\t\tvar radius:number;\n\t\tvar revolutionAngle:number;\n\n\t\tvar dr:number;\n\t\tvar latNormElev:number;\n\t\tvar latNormBase:number;\n\t\tvar numIndices:number = 0;\n\n\t\tvar comp1:number;\n\t\tvar comp2:number;\n\t\tvar startIndex:number = 0;\n\t\tvar nextVertexIndex:number = 0;\n\t\tvar centerVertexIndex:number = 0;\n\n\t\tvar t1:number;\n\t\tvar t2:number;\n\n\t\t// reset utility variables\n\t\tthis._numVertices = 0;\n\n\t\t// evaluate revolution steps\n\t\tvar revolutionAngleDelta:number = 2*Math.PI/this._pSegmentsW;\n\n\t\tif (geometryType == \"triangleSubGeometry\") {\n\n\t\t\tvar triangleGeometry:TriangleSubGeometry = <TriangleSubGeometry> target;\n\n\t\t\t// evaluate target number of vertices, triangles and indices\n\t\t\tif (this._surfaceClosed) {\n\t\t\t\tthis._numVertices += (this._pSegmentsH + 1)*(this._pSegmentsW + 1); // segmentsH + 1 because of closure, segmentsW + 1 because of UV unwrapping\n\t\t\t\tnumIndices += this._pSegmentsH*this._pSegmentsW*6; // each level has segmentW quads, each of 2 triangles\n\t\t\t}\n\t\t\tif (this._topClosed) {\n\t\t\t\tthis._numVertices += 2*(this._pSegmentsW + 1); // segmentsW + 1 because of unwrapping\n\t\t\t\tnumIndices += this._pSegmentsW*3; // one triangle for each segment\n\t\t\t}\n\t\t\tif (this._bottomClosed) {\n\t\t\t\tthis._numVertices += 2*(this._pSegmentsW + 1);\n\t\t\t\tnumIndices += this._pSegmentsW*3;\n\t\t\t}\n\n\t\t\t// need to initialize raw arrays or can be reused?\n\t\t\tif (this._numVertices == triangleGeometry.numVertices) {\n\t\t\t\tindices = triangleGeometry.indices;\n\t\t\t\tpositions = triangleGeometry.positions;\n\t\t\t\tnormals = triangleGeometry.vertexNormals;\n\t\t\t\ttangents = triangleGeometry.vertexTangents;\n\t\t\t} else {\n\t\t\t\tindices = new Array<number>(numIndices)\n\t\t\t\tpositions = new Array<number>(this._numVertices*3);\n\t\t\t\tnormals = new Array<number>(this._numVertices*3);\n\t\t\t\ttangents = new Array<number>(this._numVertices*3);\n\n\t\t\t\tthis._pInvalidateUVs();\n\t\t\t}\n\n\t\t\tvidx = 0;\n\t\t\tfidx = 0;\n\n\t\t\t// top\n\t\t\tif (this._topClosed && this._topRadius > 0) {\n\n\t\t\t\tz = -0.5*this._height;\n\n\t\t\t\t// central vertex\n\t\t\t\tif (this._yUp) {\n\t\t\t\t\tt1 = 1;\n\t\t\t\t\tt2 = 0;\n\t\t\t\t\tcomp1 = -z;\n\t\t\t\t\tcomp2 = 0;\n\n\t\t\t\t} else {\n\t\t\t\t\tt1 = 0;\n\t\t\t\t\tt2 = -1;\n\t\t\t\t\tcomp1 = 0;\n\t\t\t\t\tcomp2 = z;\n\t\t\t\t}\n\n\t\t\t\tpositions[vidx] = 0;\n\t\t\t\tpositions[vidx + 1] = comp1;\n\t\t\t\tpositions[vidx + 2] = comp2;\n\t\t\t\tnormals[vidx] = 0;\n\t\t\t\tnormals[vidx + 1] = t1;\n\t\t\t\tnormals[vidx + 2] = t2;\n\t\t\t\ttangents[vidx] = 1;\n\t\t\t\ttangents[vidx + 1] = 0;\n\t\t\t\ttangents[vidx + 2] = 0;\n\t\t\t\tvidx += 3;\n\n\t\t\t\tnextVertexIndex += 1;\n\n\t\t\t\tfor (i = 0; i <= this._pSegmentsW; ++i) {\n\n\t\t\t\t\t// revolution vertex\n\t\t\t\t\trevolutionAngle = i*revolutionAngleDelta;\n\t\t\t\t\tx = this._topRadius*Math.cos(revolutionAngle);\n\t\t\t\t\ty = this._topRadius*Math.sin(revolutionAngle);\n\n\t\t\t\t\tif (this._yUp) {\n\t\t\t\t\t\tcomp1 = -z;\n\t\t\t\t\t\tcomp2 = y;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcomp1 = y;\n\t\t\t\t\t\tcomp2 = z;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (i == this._pSegmentsW) {\n\t\t\t\t\t\tpositions[vidx] = positions[startIndex + 3];\n\t\t\t\t\t\tpositions[vidx + 1] = positions[startIndex + 4];\n\t\t\t\t\t\tpositions[vidx + 2] = positions[startIndex + 5];\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpositions[vidx] = x;\n\t\t\t\t\t\tpositions[vidx + 1] = comp1;\n\t\t\t\t\t\tpositions[vidx + 2] = comp2;\n\t\t\t\t\t}\n\n\t\t\t\t\tnormals[vidx] = 0;\n\t\t\t\t\tnormals[vidx + 1] = t1;\n\t\t\t\t\tnormals[vidx + 2] = t2;\n\t\t\t\t\ttangents[vidx] = 1;\n\t\t\t\t\ttangents[vidx + 1] = 0;\n\t\t\t\t\ttangents[vidx + 2] = 0;\n\t\t\t\t\tvidx += 3;\n\n\t\t\t\t\tif (i > 0) {\n\t\t\t\t\t\t// add triangle\n\t\t\t\t\t\tindices[fidx++] = nextVertexIndex - 1;\n\t\t\t\t\t\tindices[fidx++] = centerVertexIndex;\n\t\t\t\t\t\tindices[fidx++] = nextVertexIndex;\n\t\t\t\t\t}\n\n\t\t\t\t\tnextVertexIndex += 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// bottom\n\t\t\tif (this._bottomClosed && this._pBottomRadius > 0) {\n\n\t\t\t\tz = 0.5*this._height;\n\n\t\t\t\tstartIndex = nextVertexIndex*3;\n\n\t\t\t\tcenterVertexIndex = nextVertexIndex;\n\n\t\t\t\t// central vertex\n\t\t\t\tif (this._yUp) {\n\t\t\t\t\tt1 = -1;\n\t\t\t\t\tt2 = 0;\n\t\t\t\t\tcomp1 = -z;\n\t\t\t\t\tcomp2 = 0;\n\t\t\t\t} else {\n\t\t\t\t\tt1 = 0;\n\t\t\t\t\tt2 = 1;\n\t\t\t\t\tcomp1 = 0;\n\t\t\t\t\tcomp2 = z;\n\t\t\t\t}\n\n\t\t\t\tif (i > 0) {\n\t\t\t\t\tpositions[vidx] = 0;\n\t\t\t\t\tpositions[vidx + 1] = comp1;\n\t\t\t\t\tpositions[vidx + 2] = comp2;\n\t\t\t\t\tnormals[vidx] = 0;\n\t\t\t\t\tnormals[vidx + 1] = t1;\n\t\t\t\t\tnormals[vidx + 2] = t2;\n\t\t\t\t\ttangents[vidx] = 1;\n\t\t\t\t\ttangents[vidx + 1] = 0;\n\t\t\t\t\ttangents[vidx + 2] = 0;\n\t\t\t\t\tvidx += 3;\n\t\t\t\t}\n\n\t\t\t\tnextVertexIndex += 1;\n\n\t\t\t\tfor (i = 0; i <= this._pSegmentsW; ++i) {\n\n\t\t\t\t\t// revolution vertex\n\t\t\t\t\trevolutionAngle = i*revolutionAngleDelta;\n\t\t\t\t\tx = this._pBottomRadius*Math.cos(revolutionAngle);\n\t\t\t\t\ty = this._pBottomRadius*Math.sin(revolutionAngle);\n\n\t\t\t\t\tif (this._yUp) {\n\t\t\t\t\t\tcomp1 = -z;\n\t\t\t\t\t\tcomp2 = y;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcomp1 = y;\n\t\t\t\t\t\tcomp2 = z;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (i == this._pSegmentsW) {\n\t\t\t\t\t\tpositions[vidx] = positions[startIndex + 3];\n\t\t\t\t\t\tpositions[vidx + 1] = positions[startIndex + 4];\n\t\t\t\t\t\tpositions[vidx + 2] = positions[startIndex + 5];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpositions[vidx] = x;\n\t\t\t\t\t\tpositions[vidx + 1] = comp1;\n\t\t\t\t\t\tpositions[vidx + 2] = comp2;\n\t\t\t\t\t}\n\n\t\t\t\t\tnormals[vidx] = 0;\n\t\t\t\t\tnormals[vidx + 1] = t1;\n\t\t\t\t\tnormals[vidx + 2] = t2;\n\t\t\t\t\ttangents[vidx] = 1;\n\t\t\t\t\ttangents[vidx + 1] = 0;\n\t\t\t\t\ttangents[vidx + 2] = 0;\n\t\t\t\t\tvidx += 3;\n\n\t\t\t\t\tif (i > 0) {\n\t\t\t\t\t\t// add triangle\n\t\t\t\t\t\tindices[fidx++] = nextVertexIndex - 1;\n\t\t\t\t\t\tindices[fidx++] = nextVertexIndex;\n\t\t\t\t\t\tindices[fidx++] = centerVertexIndex;\n\t\t\t\t\t}\n\n\t\t\t\t\tnextVertexIndex += 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// The normals on the lateral surface all have the same incline, i.e.\n\t\t\t// the \"elevation\" component (Y or Z depending on yUp) is constant.\n\t\t\t// Same principle goes for the \"base\" of these vectors, which will be\n\t\t\t// calculated such that a vector [base,elev] will be a unit vector.\n\t\t\tdr = (this._pBottomRadius - this._topRadius);\n\t\t\tlatNormElev = dr/this._height;\n\t\t\tlatNormBase = (latNormElev == 0)? 1 : this._height/dr;\n\n\t\t\t// lateral surface\n\t\t\tif (this._surfaceClosed) {\n\t\t\t\tvar a:number;\n\t\t\t\tvar b:number;\n\t\t\t\tvar c:number;\n\t\t\t\tvar d:number;\n\t\t\t\tvar na0:number, na1:number, naComp1:number, naComp2:number;\n\n\t\t\t\tfor (j = 0; j <= this._pSegmentsH; ++j) {\n\t\t\t\t\tradius = this._topRadius - ((j/this._pSegmentsH)*(this._topRadius - this._pBottomRadius));\n\t\t\t\t\tz = -(this._height/2) + (j/this._pSegmentsH*this._height);\n\n\t\t\t\t\tstartIndex = nextVertexIndex*3;\n\n\t\t\t\t\tfor (i = 0; i <= this._pSegmentsW; ++i) {\n\t\t\t\t\t\t// revolution vertex\n\t\t\t\t\t\trevolutionAngle = i*revolutionAngleDelta;\n\t\t\t\t\t\tx = radius*Math.cos(revolutionAngle);\n\t\t\t\t\t\ty = radius*Math.sin(revolutionAngle);\n\t\t\t\t\t\tna0 = latNormBase*Math.cos(revolutionAngle);\n\t\t\t\t\t\tna1 = latNormBase*Math.sin(revolutionAngle);\n\n\t\t\t\t\t\tif (this._yUp) {\n\t\t\t\t\t\t\tt1 = 0;\n\t\t\t\t\t\t\tt2 = -na0;\n\t\t\t\t\t\t\tcomp1 = -z;\n\t\t\t\t\t\t\tcomp2 = y;\n\t\t\t\t\t\t\tnaComp1 = latNormElev;\n\t\t\t\t\t\t\tnaComp2 = na1;\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tt1 = -na0;\n\t\t\t\t\t\t\tt2 = 0;\n\t\t\t\t\t\t\tcomp1 = y;\n\t\t\t\t\t\t\tcomp2 = z;\n\t\t\t\t\t\t\tnaComp1 = na1;\n\t\t\t\t\t\t\tnaComp2 = latNormElev;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (i == this._pSegmentsW) {\n\t\t\t\t\t\t\tpositions[vidx] = positions[startIndex];\n\t\t\t\t\t\t\tpositions[vidx + 1] = positions[startIndex + 1];\n\t\t\t\t\t\t\tpositions[vidx + 2] = positions[startIndex + 2];\n\t\t\t\t\t\t\tnormals[vidx] = na0;\n\t\t\t\t\t\t\tnormals[vidx + 1] = latNormElev;\n\t\t\t\t\t\t\tnormals[vidx + 2] = na1;\n\t\t\t\t\t\t\ttangents[vidx] = na1;\n\t\t\t\t\t\t\ttangents[vidx + 1] = t1;\n\t\t\t\t\t\t\ttangents[vidx + 2] = t2;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpositions[vidx] = x;\n\t\t\t\t\t\t\tpositions[vidx + 1] = comp1;\n\t\t\t\t\t\t\tpositions[vidx + 2] = comp2;\n\t\t\t\t\t\t\tnormals[vidx] = na0;\n\t\t\t\t\t\t\tnormals[vidx + 1] = naComp1;\n\t\t\t\t\t\t\tnormals[vidx + 2] = naComp2;\n\t\t\t\t\t\t\ttangents[vidx] = -na1;\n\t\t\t\t\t\t\ttangents[vidx + 1] = t1;\n\t\t\t\t\t\t\ttangents[vidx + 2] = t2;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvidx += 3;\n\n\t\t\t\t\t\t// close triangle\n\t\t\t\t\t\tif (i > 0 && j > 0) {\n\t\t\t\t\t\t\ta = nextVertexIndex; // current\n\t\t\t\t\t\t\tb = nextVertexIndex - 1; // previous\n\t\t\t\t\t\t\tc = b - this._pSegmentsW - 1; // previous of last level\n\t\t\t\t\t\t\td = a - this._pSegmentsW - 1; // current of last level\n\n\t\t\t\t\t\t\tindices[fidx++] = a;\n\t\t\t\t\t\t\tindices[fidx++] = b;\n\t\t\t\t\t\t\tindices[fidx++] = c;\n\n\t\t\t\t\t\t\tindices[fidx++] = a;\n\t\t\t\t\t\t\tindices[fidx++] = c;\n\t\t\t\t\t\t\tindices[fidx++] = d;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnextVertexIndex++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// build real data from raw data\n\t\t\ttriangleGeometry.updateIndices(indices);\n\n\t\t\ttriangleGeometry.updatePositions(positions);\n\t\t\ttriangleGeometry.updateVertexNormals(normals);\n\t\t\ttriangleGeometry.updateVertexTangents(tangents);\n\n\t\t} else if (geometryType == \"lineSubGeometry\") {\n\t\t\tvar lineGeometry:LineSubGeometry = <LineSubGeometry> target;\n\n\t\t\tvar numSegments:number = (this._pSegmentsH + 1)*(this._pSegmentsW) + this._pSegmentsW;\n\t\t\tvar startPositions:Array<number>;\n\t\t\tvar endPositions:Array<number>;\n\t\t\tvar thickness:Array<number>;\n\n\t\t\tif (lineGeometry.indices != null && numSegments == lineGeometry.numSegments) {\n\t\t\t\tstartPositions = lineGeometry.startPositions;\n\t\t\t\tendPositions = lineGeometry.endPositions;\n\t\t\t\tthickness = lineGeometry.thickness;\n\t\t\t} else {\n\t\t\t\tstartPositions = new Array<number>(numSegments*3);\n\t\t\t\tendPositions = new Array<number>(numSegments*3);\n\t\t\t\tthickness = new Array<number>(numSegments);\n\t\t\t}\n\n\t\t\tvidx = 0;\n\n\t\t\tfidx = 0;\n\n\t\t\t//horizonal lines\n\n\t\t\tfor (j = 0; j <= this._pSegmentsH; ++j) {\n\t\t\t\tradius = this._topRadius - ((j/this._pSegmentsH)*(this._topRadius - this._pBottomRadius));\n\t\t\t\tz = this._height*(j/this._pSegmentsH - 0.5);\n\n\t\t\t\tfor (i = 0; i <= this._pSegmentsW; ++i) {\n\t\t\t\t\t// revolution vertex\n\t\t\t\t\trevolutionAngle = i*revolutionAngleDelta;\n\t\t\t\t\tx = radius*Math.cos(revolutionAngle);\n\t\t\t\t\ty = radius*Math.sin(revolutionAngle);\n\n\t\t\t\t\tif (this._yUp) {\n\t\t\t\t\t\tcomp1 = -z;\n\t\t\t\t\t\tcomp2 = y;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcomp1 = y;\n\t\t\t\t\t\tcomp2 = z;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (i > 0) {\n\t\t\t\t\t\tendPositions[vidx] = x;\n\t\t\t\t\t\tendPositions[vidx + 1] = comp1;\n\t\t\t\t\t\tendPositions[vidx + 2] = comp2;\n\n\t\t\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\t\t\tvidx += 3;\n\n\t\t\t\t\t\t//vertical lines\n\t\t\t\t\t\tstartPositions[vidx] = endPositions[vidx - this._pSegmentsW*6];\n\t\t\t\t\t\tstartPositions[vidx + 1] = endPositions[vidx + 1 - this._pSegmentsW*6];\n\t\t\t\t\t\tstartPositions[vidx + 2] = endPositions[vidx + 2 - this._pSegmentsW*6];\n\n\t\t\t\t\t\tendPositions[vidx] = x;\n\t\t\t\t\t\tendPositions[vidx + 1] = comp1;\n\t\t\t\t\t\tendPositions[vidx + 2] = comp2;\n\n\t\t\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\t\t\tvidx += 3;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (i < this._pSegmentsW) {\n\t\t\t\t\t\tstartPositions[vidx] = x;\n\t\t\t\t\t\tstartPositions[vidx + 1] = comp1;\n\t\t\t\t\t\tstartPositions[vidx + 2] = comp2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// build real data from raw data\n\t\t\tlineGeometry.updatePositions(startPositions, endPositions);\n\t\t\tlineGeometry.updateThickness(thickness);\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pBuildUVs(target:SubGeometryBase, geometryType:string)\n\t{\n\t\tvar i:number;\n\t\tvar j:number;\n\t\tvar x:number;\n\t\tvar y:number;\n\t\tvar revolutionAngle:number;\n\t\tvar uvs:Array<number>;\n\n\t\tif (geometryType == \"triangleSubGeometry\") {\n\n\t\t\tvar triangleGeometry:TriangleSubGeometry = <TriangleSubGeometry> target;\n\n\t\t\t// need to initialize raw array or can be reused?\n\t\t\tif (triangleGeometry.uvs && this._numVertices == triangleGeometry.numVertices) {\n\t\t\t\tuvs = triangleGeometry.uvs;\n\t\t\t} else {\n\t\t\t\tuvs = new Array<number>(this._numVertices*2);\n\t\t\t}\n\n\t\t\t// evaluate revolution steps\n\t\t\tvar revolutionAngleDelta:number = 2*Math.PI/this._pSegmentsW;\n\n\t\t\t// current uv component index\n\t\t\tvar index:number = 0;\n\n\t\t\t// top\n\t\t\tif (this._topClosed) {\n\n\t\t\t\tuvs[index++] = 0.5*triangleGeometry.scaleU; // central vertex\n\t\t\t\tuvs[index++] = 0.5*triangleGeometry.scaleV;\n\n\t\t\t\tfor (i = 0; i <= this._pSegmentsW; ++i) {\n\n\t\t\t\t\trevolutionAngle = i*revolutionAngleDelta;\n\t\t\t\t\tx = 0.5 + 0.5* -Math.cos(revolutionAngle);\n\t\t\t\t\ty = 0.5 + 0.5*Math.sin(revolutionAngle);\n\n\t\t\t\t\tuvs[index++] = x*triangleGeometry.scaleU; // revolution vertex\n\t\t\t\t\tuvs[index++] = y*triangleGeometry.scaleV;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// bottom\n\t\t\tif (this._bottomClosed) {\n\n\t\t\t\tuvs[index++] = 0.5*triangleGeometry.scaleU; // central vertex\n\t\t\t\tuvs[index++] = 0.5*triangleGeometry.scaleV;\n\n\t\t\t\tfor (i = 0; i <= this._pSegmentsW; ++i) {\n\n\t\t\t\t\trevolutionAngle = i*revolutionAngleDelta;\n\t\t\t\t\tx = 0.5 + 0.5*Math.cos(revolutionAngle);\n\t\t\t\t\ty = 0.5 + 0.5*Math.sin(revolutionAngle);\n\n\t\t\t\t\tuvs[index++] = x*triangleGeometry.scaleU; // revolution vertex\n\t\t\t\t\tuvs[index++] = y*triangleGeometry.scaleV;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// lateral surface\n\t\t\tif (this._surfaceClosed) {\n\t\t\t\tfor (j = 0; j <= this._pSegmentsH; ++j) {\n\t\t\t\t\tfor (i = 0; i <= this._pSegmentsW; ++i) {\n\t\t\t\t\t\t// revolution vertex\n\t\t\t\t\t\tuvs[index++] = ( i/this._pSegmentsW )*triangleGeometry.scaleU;\n\t\t\t\t\t\tuvs[index++] = ( j/this._pSegmentsH )*triangleGeometry.scaleV;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// build real data from raw data\n\t\t\ttriangleGeometry.updateUVs(uvs);\n\n\t\t} else if (geometryType == \"lineSubGeometry\") {\n\t\t\t//nothing to do here\n\t\t}\n\t}\n}\n\nexport = PrimitiveCylinderPrefab;","import IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\n\nimport LineSubGeometry\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\nimport SubGeometryBase\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport TriangleSubGeometry\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport PrimitivePrefabBase\t\t= require(\"awayjs-display/lib/prefabs/PrimitivePrefabBase\");\n\n/**\n * A Plane primitive mesh.\n */\nclass PrimitivePlanePrefab extends PrimitivePrefabBase implements IAsset\n{\n\tprivate _segmentsW:number;\n\tprivate _segmentsH:number;\n\tprivate _yUp:boolean;\n\tprivate _width:number;\n\tprivate _height:number;\n\tprivate _doubleSided:boolean;\n\n\t/**\n\t * Creates a new Plane object.\n\t * @param width The width of the plane.\n\t * @param height The height of the plane.\n\t * @param segmentsW The number of segments that make up the plane along the X-axis.\n\t * @param segmentsH The number of segments that make up the plane along the Y or Z-axis.\n\t * @param yUp Defines whether the normal vector of the plane should point along the Y-axis (true) or Z-axis (false).\n\t * @param doubleSided Defines whether the plane will be visible from both sides, with correct vertex normals.\n\t */\n\tconstructor(width:number = 100, height:number = 100, segmentsW:number = 1, segmentsH:number = 1, yUp:boolean = true, doubleSided:boolean = false)\n\t{\n\n\t\tsuper();\n\n\t\tthis._segmentsW = segmentsW;\n\t\tthis._segmentsH = segmentsH;\n\t\tthis._yUp = yUp;\n\t\tthis._width = width;\n\t\tthis._height = height;\n\t\tthis._doubleSided = doubleSided;\n\n\t}\n\n\t/**\n\t * The number of segments that make up the plane along the X-axis. Defaults to 1.\n\t */\n\tpublic get segmentsW():number\n\t{\n\t\treturn this._segmentsW;\n\t}\n\n\tpublic set segmentsW(value:number)\n\t{\n\n\t\tthis._segmentsW = value;\n\n\t\tthis._pInvalidateGeometry();\n\t\tthis._pInvalidateUVs();\n\n\t}\n\n\t/**\n\t * The number of segments that make up the plane along the Y or Z-axis, depending on whether yUp is true or\n\t * false, respectively. Defaults to 1.\n\t */\n\tpublic get segmentsH():number\n\t{\n\t\treturn this._segmentsH;\n\t}\n\n\tpublic set segmentsH(value:number)\n\t{\n\n\t\tthis._segmentsH = value;\n\n\t\tthis._pInvalidateGeometry();\n\t\tthis._pInvalidateUVs();\n\n\t}\n\n\t/**\n\t *  Defines whether the normal vector of the plane should point along the Y-axis (true) or Z-axis (false). Defaults to true.\n\t */\n\tpublic get yUp():boolean\n\t{\n\t\treturn this._yUp;\n\t}\n\n\tpublic set yUp(value:boolean)\n\t{\n\t\tthis._yUp = value;\n\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * Defines whether the plane will be visible from both sides, with correct vertex normals (as opposed to bothSides on Material). Defaults to false.\n\t */\n\tpublic get doubleSided():boolean\n\t{\n\t\treturn this._doubleSided;\n\t}\n\n\tpublic set doubleSided(value:boolean)\n\t{\n\t\tthis._doubleSided = value;\n\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * The width of the plane.\n\t */\n\tpublic get width():number\n\t{\n\t\treturn this._width;\n\t}\n\n\tpublic set width(value:number)\n\t{\n\t\tthis._width = value;\n\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * The height of the plane.\n\t */\n\tpublic get height():number\n\t{\n\t\treturn this._height;\n\t}\n\n\tpublic set height(value:number)\n\t{\n\t\tthis._height = value;\n\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pBuildGeometry(target:SubGeometryBase, geometryType:string)\n\t{\n\t\tvar indices:Array<number> /*uint*/;\n\t\tvar x:number, y:number;\n\t\tvar numIndices:number;\n\t\tvar base:number;\n\t\tvar tw:number = this._segmentsW + 1;\n\t\tvar numVertices:number;\n\n\t\tvar vidx:number, fidx:number; // indices\n\n\t\tvar xi:number;\n\t\tvar yi:number;\n\n\t\tif (geometryType == \"triangleSubGeometry\") {\n\n\t\t\tvar triangleGeometry:TriangleSubGeometry = <TriangleSubGeometry> target;\n\n\t\t\tvar numVertices:number = (this._segmentsH + 1)*tw;\n\t\t\tvar positions:Array<number>;\n\t\t\tvar normals:Array<number>;\n\t\t\tvar tangents:Array<number>;\n\n\t\t\tif (this._doubleSided)\n\t\t\t\tnumVertices *= 2;\n\n\t\t\tnumIndices = this._segmentsH*this._segmentsW*6;\n\n\t\t\tif (this._doubleSided)\n\t\t\t\tnumIndices *= 2;\n\n\t\t\tif (triangleGeometry.indices != null && numIndices == triangleGeometry.indices.length) {\n\t\t\t\tindices = triangleGeometry.indices;\n\t\t\t} else {\n\t\t\t\tindices = new Array<number>(numIndices);\n\n\t\t\t\tthis._pInvalidateUVs();\n\t\t\t}\n\n\t\t\tif (numVertices == triangleGeometry.numVertices) {\n\t\t\t\tpositions = triangleGeometry.positions;\n\t\t\t\tnormals = triangleGeometry.vertexNormals;\n\t\t\t\ttangents = triangleGeometry.vertexTangents;\n\t\t\t} else {\n\t\t\t\tpositions = new Array<number>(numVertices*3);\n\t\t\t\tnormals = new Array<number>(numVertices*3);\n\t\t\t\ttangents = new Array<number>(numVertices*3);\n\n\t\t\t\tthis._pInvalidateUVs();\n\t\t\t}\n\n\t\t\tfidx = 0;\n\n\t\t\tvidx = 0;\n\n\t\t\tfor (yi = 0; yi <= this._segmentsH; ++yi) {\n\n\t\t\t\tfor (xi = 0; xi <= this._segmentsW; ++xi) {\n\t\t\t\t\tx = (xi/this._segmentsW - .5)*this._width;\n\t\t\t\t\ty = (yi/this._segmentsH - .5)*this._height;\n\n\t\t\t\t\tpositions[vidx] = x;\n\t\t\t\t\tif (this._yUp) {\n\t\t\t\t\t\tpositions[vidx + 1] = 0;\n\t\t\t\t\t\tpositions[vidx + 2] = y;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpositions[vidx + 1] = y;\n\t\t\t\t\t\tpositions[vidx + 2] = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tnormals[vidx] = 0;\n\n\t\t\t\t\tif (this._yUp) {\n\t\t\t\t\t\tnormals[vidx + 1] = 1;\n\t\t\t\t\t\tnormals[vidx + 2] = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnormals[vidx + 1] = 0;\n\t\t\t\t\t\tnormals[vidx + 2] = -1;\n\t\t\t\t\t}\n\n\t\t\t\t\ttangents[vidx] = 1;\n\t\t\t\t\ttangents[vidx + 1] = 0;\n\t\t\t\t\ttangents[vidx + 2] = 0;\n\n\t\t\t\t\tvidx += 3;\n\n\t\t\t\t\t// add vertex with same position, but with inverted normal & tangent\n\t\t\t\t\tif (this._doubleSided) {\n\n\t\t\t\t\t\tfor (var i:number = vidx; i < vidx + 3; ++i) {\n\t\t\t\t\t\t\tpositions[i] = positions[i - 3];\n\t\t\t\t\t\t\tnormals[i] = -normals[i - 3];\n\t\t\t\t\t\t\ttangents[i] = -tangents[i - 3];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvidx += 3;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif (xi != this._segmentsW && yi != this._segmentsH) {\n\n\t\t\t\t\t\tbase = xi + yi*tw;\n\t\t\t\t\t\tvar mult:number = this._doubleSided? 2 : 1;\n\n\t\t\t\t\t\tindices[fidx++] = base*mult;\n\t\t\t\t\t\tindices[fidx++] = (base + tw)*mult;\n\t\t\t\t\t\tindices[fidx++] = (base + tw + 1)*mult;\n\t\t\t\t\t\tindices[fidx++] = base*mult;\n\t\t\t\t\t\tindices[fidx++] = (base + tw + 1)*mult;\n\t\t\t\t\t\tindices[fidx++] = (base + 1)*mult;\n\n\t\t\t\t\t\tif (this._doubleSided) {\n\n\t\t\t\t\t\t\tindices[fidx++] = (base + tw + 1)*mult + 1;\n\t\t\t\t\t\t\tindices[fidx++] = (base + tw)*mult + 1;\n\t\t\t\t\t\t\tindices[fidx++] = base*mult + 1;\n\t\t\t\t\t\t\tindices[fidx++] = (base + 1)*mult + 1;\n\t\t\t\t\t\t\tindices[fidx++] = (base + tw + 1)*mult + 1;\n\t\t\t\t\t\t\tindices[fidx++] = base*mult + 1;\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttriangleGeometry.updateIndices(indices);\n\n\t\t\ttriangleGeometry.updatePositions(positions);\n\t\t\ttriangleGeometry.updateVertexNormals(normals);\n\t\t\ttriangleGeometry.updateVertexTangents(tangents);\n\n\t\t} else if (geometryType == \"lineSubGeometry\") {\n\t\t\tvar lineGeometry:LineSubGeometry = <LineSubGeometry> target;\n\n\t\t\tvar numSegments:number = (this._segmentsH + 1) + tw;\n\t\t\tvar startPositions:Array<number>;\n\t\t\tvar endPositions:Array<number>;\n\t\t\tvar thickness:Array<number>;\n\n\t\t\tvar hw:number = this._width/2;\n\t\t\tvar hh:number = this._height/2;\n\n\n\t\t\tif (lineGeometry.indices != null && numSegments == lineGeometry.numSegments) {\n\t\t\t\tstartPositions = lineGeometry.startPositions;\n\t\t\t\tendPositions = lineGeometry.endPositions;\n\t\t\t\tthickness = lineGeometry.thickness;\n\t\t\t} else {\n\t\t\t\tstartPositions = new Array<number>(numSegments*3);\n\t\t\t\tendPositions = new Array<number>(numSegments*3);\n\t\t\t\tthickness = new Array<number>(numSegments);\n\t\t\t}\n\n\t\t\tfidx = 0;\n\n\t\t\tvidx = 0;\n\n\t\t\tfor (yi = 0; yi <= this._segmentsH; ++yi) {\n\t\t\t\tstartPositions[vidx] = -hw;\n\t\t\t\tstartPositions[vidx + 1] = 0;\n\t\t\t\tstartPositions[vidx + 2] = yi*this._height - hh;\n\n\t\t\t\tendPositions[vidx] = hw;\n\t\t\t\tendPositions[vidx + 1] = 0;\n\t\t\t\tendPositions[vidx + 2] = yi*this._height - hh;\n\n\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\tvidx += 3;\n\t\t\t}\n\n\n\t\t\tfor (xi = 0; xi <= this._segmentsW; ++xi) {\n\t\t\t\tstartPositions[vidx] = xi*this._width - hw;\n\t\t\t\tstartPositions[vidx + 1] = 0;\n\t\t\t\tstartPositions[vidx + 2] = -hh;\n\n\t\t\t\tendPositions[vidx] = xi*this._width - hw;\n\t\t\t\tendPositions[vidx + 1] = 0;\n\t\t\t\tendPositions[vidx + 2] = hh;\n\n\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\tvidx += 3;\n\t\t\t}\n\n\t\t\t// build real data from raw data\n\t\t\tlineGeometry.updatePositions(startPositions, endPositions);\n\t\t\tlineGeometry.updateThickness(thickness);\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pBuildUVs(target:SubGeometryBase, geometryType:string)\n\t{\n\t\tvar uvs:Array<number>;\n\t\tvar numVertices:number;\n\n\t\tif (geometryType == \"triangleSubGeometry\") {\n\n\t\t\tnumVertices = ( this._segmentsH + 1 )*( this._segmentsW + 1 );\n\n\t\t\tif (this._doubleSided)\n\t\t\t\tnumVertices *= 2;\n\n\t\t\tvar triangleGeometry:TriangleSubGeometry = <TriangleSubGeometry> target;\n\n\t\t\tif (triangleGeometry.uvs && numVertices == triangleGeometry.numVertices) {\n\t\t\t\tuvs = triangleGeometry.uvs;\n\t\t\t} else {\n\t\t\t\tuvs = new Array<number>(numVertices*2);\n\t\t\t\tthis._pInvalidateGeometry()\n\t\t\t}\n\n\t\t\tvar index:number = 0;\n\n\t\t\tfor (var yi:number = 0; yi <= this._segmentsH; ++yi) {\n\n\t\t\t\tfor (var xi:number = 0; xi <= this._segmentsW; ++xi) {\n\t\t\t\t\tuvs[index] = (xi/this._segmentsW)*triangleGeometry.scaleU;\n\t\t\t\t\tuvs[index + 1] = (1 - yi/this._segmentsH)*triangleGeometry.scaleV;\n\t\t\t\t\tindex += 2;\n\n\t\t\t\t\tif (this._doubleSided) {\n\t\t\t\t\t\tuvs[index] = (xi/this._segmentsW)*triangleGeometry.scaleU;\n\t\t\t\t\t\tuvs[index+1] = (1 - yi/this._segmentsH)*triangleGeometry.scaleV;\n\t\t\t\t\t\tindex += 2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttriangleGeometry.updateUVs(uvs);\n\n\n\t\t} else if (geometryType == \"lineSubGeometry\") {\n\t\t\t//nothing to do here\n\t\t}\n\t}\n}\n\nexport = PrimitivePlanePrefab;","import IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\n\nimport PrimitiveCylinderPrefab\t= require(\"awayjs-display/lib/prefabs/PrimitiveCylinderPrefab\");\n\n/**\n * A UV RegularPolygon primitive mesh.\n */\nclass PrimitivePolygonPrefab extends PrimitiveCylinderPrefab implements IAsset\n{\n\n\t/**\n\t * The radius of the regular polygon.\n\t */\n\tpublic get radius():number\n\t{\n\t\treturn this._pBottomRadius;\n\t}\n\n\tpublic set radius(value:number)\n\t{\n\t\tthis._pBottomRadius = value;\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * The number of sides of the regular polygon.\n\t */\n\tpublic get sides():number\n\t{\n\t\treturn this._pSegmentsW;\n\t}\n\n\tpublic set sides(value:number)\n\t{\n\t\tthis.setSegmentsW(value);\n\t}\n\n\t/**\n\t * The number of subdivisions from the edge to the center of the regular polygon.\n\t */\n\tpublic get subdivisions():number\n\t{\n\t\treturn this._pSegmentsH;\n\t}\n\n\tpublic set subdivisions(value:number)\n\t{\n\t\tthis.setSegmentsH(value);\n\t}\n\n\t/**\n\t * Creates a new RegularPolygon disc object.\n\t * @param radius The radius of the regular polygon\n\t * @param sides Defines the number of sides of the regular polygon.\n\t * @param yUp Defines whether the regular polygon should lay on the Y-axis (true) or on the Z-axis (false).\n\t */\n\tconstructor(radius:number = 100, sides:number = 16, yUp:boolean = true)\n\t{\n\t\tsuper(radius, 0, 0, sides, 1, true, false, false, yUp);\n\t}\n}\n\nexport = PrimitivePolygonPrefab;","import AssetType\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nimport DisplayObject\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport Geometry\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\nimport SubGeometryBase\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport TriangleSubGeometry\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport LineSubGeometry\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\nimport Mesh\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\nimport MaterialBase\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport PrefabBase\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrefabBase\");\n\n/**\n * PrimitivePrefabBase is an abstract base class for polytope prefabs, which are simple pre-built geometric shapes\n */\nclass PrimitivePrefabBase extends PrefabBase\n{\n\tpublic _geomDirty:boolean = true;\n\tpublic _uvDirty:boolean = true;\n\n\tprivate _material:MaterialBase;\n\tprivate _geometry:Geometry;\n\tprivate _subGeometry:SubGeometryBase;\n\tprivate _geometryType:string;\n\tprivate _geometryTypeDirty:boolean = true;\n\n\n\t/**\n\t *\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.PRIMITIVE_PREFAB;\n\t}\n\n\t/**\n\t * \n\t */\n\tpublic get geometryType():string\n\t{\n\t\treturn this._geometryType;\n\t}\n\t\n\tpublic set geometryType(value:string)\n\t{\n\t\tif (this._geometryType == value)\n\t\t\treturn;\n\n\t\tthis._geometryType = value;\n\t\t\n\t\tthis.invalidateGeometryType();\n\t}\n\n\tpublic get geometry():Geometry\n\t{\n\t\tthis._iValidate();\n\n\t\treturn this._geometry;\n\t}\n\n\t/**\n\t * The material with which to render the primitive.\n\t */\n\tpublic get material():MaterialBase\n\t{\n\t\treturn this._material;\n\t}\n\n\tpublic set material(value:MaterialBase)\n\t{\n\t\tif (value == this._material)\n\t\t\treturn;\n\n\t\tthis._material = value;\n\n\t\tvar len:number = this._pObjects.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\t(<Mesh> this._pObjects[i]).material = this._material;\n\t}\n\n\t/**\n\t * Creates a new PrimitivePrefabBase object.\n\t *\n\t * @param material The material with which to render the object\n\t */\n\tconstructor(material:MaterialBase = null, geometryType:string = \"triangleSubGeometry\")\n\t{\n\t\tsuper();\n\n\t\tthis._geometry = new Geometry();\n\t\tthis._material = material;\n\t\tthis._geometryType = geometryType;\n\t}\n\n\t/**\n\t * Builds the primitive's geometry when invalid. This method should not be called directly. The calling should\n\t * be triggered by the invalidateGeometry method (and in turn by updateGeometry).\n\t */\n\tpublic _pBuildGeometry(target:SubGeometryBase, geometryType:string)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * Builds the primitive's uv coordinates when invalid. This method should not be called directly. The calling\n\t * should be triggered by the invalidateUVs method (and in turn by updateUVs).\n\t */\n\tpublic _pBuildUVs(target:SubGeometryBase, geometryType:string)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * Invalidates the primitive's geometry type, causing it to be updated when requested.\n\t */\n\tpublic invalidateGeometryType()\n\t{\n\t\tthis._geometryTypeDirty = true;\n\t\tthis._geomDirty = true;\n\t\tthis._uvDirty = true;\n\t}\n\t\n\t/**\n\t * Invalidates the primitive's geometry, causing it to be updated when requested.\n\t */\n\tpublic _pInvalidateGeometry()\n\t{\n\t\tthis._geomDirty = true;\n\t}\n\n\t/**\n\t * Invalidates the primitive's uv coordinates, causing them to be updated when requested.\n\t */\n\tpublic _pInvalidateUVs()\n\t{\n\t\tthis._uvDirty = true;\n\t}\n\n\t/**\n\t * Updates the subgeometry when invalid.\n\t */\n\tprivate updateGeometryType()\n\t{\n\t\t//remove any existing sub geometry\n\t\tif (this._subGeometry)\n\t\t\tthis._geometry.removeSubGeometry(this._subGeometry);\n\n\t\tif (this._geometryType == \"triangleSubGeometry\") {\n\t\t\tvar triangleGeometry:TriangleSubGeometry = new TriangleSubGeometry(true);\n\t\t\ttriangleGeometry.autoDeriveNormals = false;\n\t\t\ttriangleGeometry.autoDeriveTangents = false;\n\t\t\ttriangleGeometry.autoDeriveUVs = false;\n\t\t\tthis._geometry.addSubGeometry(triangleGeometry);\n\t\t\tthis._subGeometry = triangleGeometry;\n\t\t} else if (this._geometryType == \"lineSubGeometry\") {\n\t\t\tthis._geometry.addSubGeometry(this._subGeometry = new LineSubGeometry());\n\t\t}\n\n\t\tthis._geometryTypeDirty = false;\n\t}\n\n\t\n\t/**\n\t * Updates the geometry when invalid.\n\t */\n\tprivate updateGeometry()\n\t{\n\t\tthis._pBuildGeometry(this._subGeometry, this._geometryType);\n\n\t\tthis._geomDirty = false;\n\t}\n\n\t/**\n\t * Updates the uv coordinates when invalid.\n\t */\n\tprivate updateUVs()\n\t{\n\t\tthis._pBuildUVs(this._subGeometry, this._geometryType);\n\n\t\tthis._uvDirty = false;\n\t}\n\n\tpublic _iValidate()\n\t{\n\t\tif (this._geometryTypeDirty)\n\t\t\tthis.updateGeometryType();\n\t\t\n\t\tif (this._geomDirty)\n\t\t\tthis.updateGeometry();\n\n\t\tif (this._uvDirty)\n\t\t\tthis.updateUVs();\n\t}\n\n\n\tpublic _pCreateObject():DisplayObject\n\t{\n\t\tvar mesh:Mesh = new Mesh(this._geometry, this._material);\n\t\tmesh._iSourcePrefab = this;\n\n\t\treturn mesh;\n\t}\n\n\n//\t\tpublic _pCreateBatchObject():BatchObject\n//\t\t{\n//\t\t\tvar batch:BatchObject = new BatchObject(this._geometry, this._material);\n//\t\t\tbatch._iSourcePrefab = this;\n//\n//\t\t\treturn batch;\n//\t\t}\n}\n\nexport = PrimitivePrefabBase;","import IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\n\nimport LineSubGeometry\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\nimport SubGeometryBase\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport TriangleSubGeometry\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport PrimitivePrefabBase\t\t= require(\"awayjs-display/lib/prefabs/PrimitivePrefabBase\");\n\n/**\n * A UV Sphere primitive mesh.\n */\nclass PrimitiveSpherePrefab extends PrimitivePrefabBase implements IAsset\n{\n\tprivate _radius:number;\n\tprivate _segmentsW:number;\n\tprivate _segmentsH:number;\n\tprivate _yUp:boolean;\n\n\t/**\n\t * The radius of the sphere.\n\t */\n\tpublic get radius():number\n\t{\n\t\treturn this._radius;\n\t}\n\n\tpublic set radius(value:number)\n\t{\n\t\tthis._radius = value;\n\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * Defines the number of horizontal segments that make up the sphere. Defaults to 16.\n\t */\n\tpublic get segmentsW():number\n\t{\n\t\treturn this._segmentsW;\n\t}\n\n\tpublic set segmentsW(value:number)\n\t{\n\t\tthis._segmentsW = value;\n\n\t\tthis._pInvalidateGeometry();\n\t\tthis._pInvalidateUVs();\n\t}\n\n\t/**\n\t * Defines the number of vertical segments that make up the sphere. Defaults to 12.\n\t */\n\tpublic get segmentsH():number\n\t{\n\t\treturn this._segmentsH;\n\t}\n\n\tpublic set segmentsH(value:number)\n\t{\n\t\tthis._segmentsH = value;\n\n\t\tthis._pInvalidateGeometry();\n\t\tthis._pInvalidateUVs();\n\t}\n\n\t/**\n\t * Defines whether the sphere poles should lay on the Y-axis (true) or on the Z-axis (false).\n\t */\n\tpublic get yUp():boolean\n\t{\n\t\treturn this._yUp;\n\t}\n\n\tpublic set yUp(value:boolean)\n\t{\n\t\tthis._yUp = value;\n\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * Creates a new Sphere object.\n\t *\n\t * @param radius The radius of the sphere.\n\t * @param segmentsW Defines the number of horizontal segments that make up the sphere.\n\t * @param segmentsH Defines the number of vertical segments that make up the sphere.\n\t * @param yUp Defines whether the sphere poles should lay on the Y-axis (true) or on the Z-axis (false).\n\t */\n\tconstructor(radius:number = 50, segmentsW:number = 16, segmentsH:number = 12, yUp:boolean = true)\n\t{\n\t\tsuper();\n\n\t\tthis._radius = radius;\n\t\tthis._segmentsW = segmentsW;\n\t\tthis._segmentsH = segmentsH;\n\t\tthis._yUp = yUp;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pBuildGeometry(target:SubGeometryBase, geometryType:string)\n\t{\n\t\tvar indices:Array<number> /*uint*/;\n\t\tvar positions:Array<number>;\n\t\tvar normals:Array<number>;\n\t\tvar tangents:Array<number>;\n\n\t\tvar i:number;\n\t\tvar j:number;\n\t\tvar vidx:number, fidx:number; // indices\n\n\t\tvar comp1:number;\n\t\tvar comp2:number;\n\t\tvar numVertices:number;\n\n\n\t\tif (geometryType == \"triangleSubGeometry\") {\n\n\t\t\tvar triangleGeometry:TriangleSubGeometry = <TriangleSubGeometry> target;\n\n\t\t\tnumVertices = (this._segmentsH + 1)*(this._segmentsW + 1);\n\n\t\t\tif (numVertices == triangleGeometry.numVertices && triangleGeometry.indices != null) {\n\t\t\t\tindices = triangleGeometry.indices;\n\t\t\t\tpositions = triangleGeometry.positions;\n\t\t\t\tnormals = triangleGeometry.vertexNormals;\n\t\t\t\ttangents = triangleGeometry.vertexTangents;\n\t\t\t} else {\n\t\t\t\tindices = new Array<number>((this._segmentsH - 1)*this._segmentsW*6);\n\t\t\t\tpositions = new Array<number>(numVertices*3);\n\t\t\t\tnormals = new Array<number>(numVertices*3);\n\t\t\t\ttangents = new Array<number>(numVertices*3);\n\n\t\t\t\tthis._pInvalidateUVs();\n\t\t\t}\n\n\t\t\tvidx = 0;\n\t\t\tfidx = 0;\n\n\t\t\tvar startIndex:number;\n\t\t\tvar t1:number;\n\t\t\tvar t2:number;\n\n\t\t\tfor (j = 0; j <= this._segmentsH; ++j) {\n\n\t\t\t\tstartIndex = vidx;\n\n\t\t\t\tvar horangle:number = Math.PI*j/this._segmentsH;\n\t\t\t\tvar z:number = -this._radius*Math.cos(horangle);\n\t\t\t\tvar ringradius:number = this._radius*Math.sin(horangle);\n\n\t\t\t\tfor (i = 0; i <= this._segmentsW; ++i) {\n\t\t\t\t\tvar verangle:number = 2*Math.PI*i/this._segmentsW;\n\t\t\t\t\tvar x:number = ringradius*Math.cos(verangle);\n\t\t\t\t\tvar y:number = ringradius*Math.sin(verangle);\n\t\t\t\t\tvar normLen:number = 1/Math.sqrt(x*x + y*y + z*z);\n\t\t\t\t\tvar tanLen:number = Math.sqrt(y*y + x*x);\n\n\t\t\t\t\tif (this._yUp) {\n\n\t\t\t\t\t\tt1 = 0;\n\t\t\t\t\t\tt2 = tanLen > .007? x/tanLen : 0;\n\t\t\t\t\t\tcomp1 = -z;\n\t\t\t\t\t\tcomp2 = y;\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tt1 = tanLen > .007? x/tanLen : 0;\n\t\t\t\t\t\tt2 = 0;\n\t\t\t\t\t\tcomp1 = y;\n\t\t\t\t\t\tcomp2 = z;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (i == this._segmentsW) {\n\t\t\t\t\t\tpositions[vidx] = positions[startIndex];\n\t\t\t\t\t\tpositions[vidx+1] = positions[startIndex + 1];\n\t\t\t\t\t\tpositions[vidx+2] = positions[startIndex + 2];\n\t\t\t\t\t\tnormals[vidx] = normals[startIndex] + (x*normLen)*.5;\n\t\t\t\t\t\tnormals[vidx+1] = normals[startIndex + 1] + ( comp1*normLen)*.5;\n\t\t\t\t\t\tnormals[vidx+2] = normals[startIndex + 2] + (comp2*normLen)*.5;\n\t\t\t\t\t\ttangents[vidx] = tanLen > .007? -y/tanLen : 1;\n\t\t\t\t\t\ttangents[vidx+1] = t1;\n\t\t\t\t\t\ttangents[vidx+2] = t2;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tpositions[vidx] = x;\n\t\t\t\t\t\tpositions[vidx+1] = comp1;\n\t\t\t\t\t\tpositions[vidx+2] = comp2;\n\t\t\t\t\t\tnormals[vidx] = x*normLen;\n\t\t\t\t\t\tnormals[vidx+1] = comp1*normLen;\n\t\t\t\t\t\tnormals[vidx+2] = comp2*normLen;\n\t\t\t\t\t\ttangents[vidx] = tanLen > .007? -y/tanLen : 1;\n\t\t\t\t\t\ttangents[vidx+1] = t1;\n\t\t\t\t\t\ttangents[vidx+2] = t2;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (i > 0 && j > 0) {\n\n\t\t\t\t\t\tvar a:number = (this._segmentsW + 1)*j + i;\n\t\t\t\t\t\tvar b:number = (this._segmentsW + 1)*j + i - 1;\n\t\t\t\t\t\tvar c:number = (this._segmentsW + 1)*(j - 1) + i - 1;\n\t\t\t\t\t\tvar d:number = (this._segmentsW + 1)*(j - 1) + i;\n\n\t\t\t\t\t\tif (j == this._segmentsH) {\n\n\t\t\t\t\t\t\tpositions[vidx] = positions[startIndex];\n\t\t\t\t\t\t\tpositions[vidx + 1] = positions[startIndex + 1];\n\t\t\t\t\t\t\tpositions[vidx + 2] = positions[startIndex + 2];\n\n\t\t\t\t\t\t\tindices[fidx++] = a;\n\t\t\t\t\t\t\tindices[fidx++] = c;\n\t\t\t\t\t\t\tindices[fidx++] = d;\n\n\t\t\t\t\t\t} else if (j == 1) {\n\n\t\t\t\t\t\t\tindices[fidx++] = a;\n\t\t\t\t\t\t\tindices[fidx++] = b;\n\t\t\t\t\t\t\tindices[fidx++] = c;\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tindices[fidx++] = a;\n\t\t\t\t\t\t\tindices[fidx++] = b;\n\t\t\t\t\t\t\tindices[fidx++] = c;\n\t\t\t\t\t\t\tindices[fidx++] = a;\n\t\t\t\t\t\t\tindices[fidx++] = c;\n\t\t\t\t\t\t\tindices[fidx++] = d;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvidx += 3;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttriangleGeometry.updateIndices(indices);\n\n\t\t\ttriangleGeometry.updatePositions(positions);\n\t\t\ttriangleGeometry.updateVertexNormals(normals);\n\t\t\ttriangleGeometry.updateVertexTangents(tangents);\n\n\t\t} else if (geometryType == \"lineSubGeometry\") {\n\n\t\t\tvar lineGeometry:LineSubGeometry = <LineSubGeometry> target;\n\n\t\t\tvar numSegments:number = (this._segmentsH - 1)*this._segmentsW*2;\n\t\t\tvar startPositions:Array<number>;\n\t\t\tvar endPositions:Array<number>;\n\t\t\tvar thickness:Array<number>;\n\n\t\t\tif (lineGeometry.indices != null && numSegments == lineGeometry.numSegments) {\n\t\t\t\tstartPositions = lineGeometry.startPositions;\n\t\t\t\tendPositions = lineGeometry.endPositions;\n\t\t\t\tthickness = lineGeometry.thickness;\n\t\t\t} else {\n\t\t\t\tstartPositions = new Array<number>(numSegments*3);\n\t\t\t\tendPositions = new Array<number>(numSegments*3);\n\t\t\t\tthickness = new Array<number>(numSegments);\n\t\t\t}\n\n\t\t\tvidx = 0;\n\n\t\t\tfidx = 0;\n\n\t\t\tfor (j = 0; j <= this._segmentsH; ++j) {\n\n\t\t\t\tvar horangle:number = Math.PI*j/this._segmentsH;\n\t\t\t\tvar z:number = -this._radius*Math.cos(horangle);\n\t\t\t\tvar ringradius:number = this._radius*Math.sin(horangle);\n\n\t\t\t\tfor (i = 0; i <= this._segmentsW; ++i) {\n\t\t\t\t\tvar verangle:number = 2*Math.PI*i/this._segmentsW;\n\t\t\t\t\tvar x:number = ringradius*Math.cos(verangle);\n\t\t\t\t\tvar y:number = ringradius*Math.sin(verangle);\n\n\t\t\t\t\tif (this._yUp) {\n\t\t\t\t\t\tcomp1 = -z;\n\t\t\t\t\t\tcomp2 = y;\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcomp1 = y;\n\t\t\t\t\t\tcomp2 = z;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (i > 0 && j > 0) {\n\t\t\t\t\t\t//horizonal lines\n\t\t\t\t\t\tif (j < this._segmentsH) {\n\t\t\t\t\t\t\tendPositions[vidx] = x;\n\t\t\t\t\t\t\tendPositions[vidx + 1] = comp1;\n\t\t\t\t\t\t\tendPositions[vidx + 2] = comp2;\n\n\t\t\t\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\t\t\t\tvidx += 3;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//vertical lines\n\t\t\t\t\t\tstartPositions[vidx] = endPositions[vidx - this._segmentsW*6];\n\t\t\t\t\t\tstartPositions[vidx + 1] = endPositions[vidx + 1 - this._segmentsW*6];\n\t\t\t\t\t\tstartPositions[vidx + 2] = endPositions[vidx + 2 - this._segmentsW*6];\n\n\t\t\t\t\t\tendPositions[vidx] = x;\n\t\t\t\t\t\tendPositions[vidx + 1] = comp1;\n\t\t\t\t\t\tendPositions[vidx + 2] = comp2;\n\n\t\t\t\t\t\tthickness[fidx++] = 1;\n\n\t\t\t\t\t\tvidx += 3;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (i < this._segmentsW && j > 0 && j < this._segmentsH) {\n\t\t\t\t\t\tstartPositions[vidx] = x;\n\t\t\t\t\t\tstartPositions[vidx + 1] = comp1;\n\t\t\t\t\t\tstartPositions[vidx + 2] = comp2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// build real data from raw data\n\t\t\tlineGeometry.updatePositions(startPositions, endPositions);\n\t\t\tlineGeometry.updateThickness(thickness);\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pBuildUVs(target:SubGeometryBase, geometryType:string)\n\t{\n\t\tvar i:number, j:number;\n\t\tvar numVertices:number = (this._segmentsH + 1)*(this._segmentsW + 1);\n\t\tvar uvs:Array<number>;\n\n\n\t\tif (geometryType == \"triangleSubGeometry\") {\n\n\t\t\tnumVertices = (this._segmentsH + 1)*(this._segmentsW + 1);\n\n\t\t\tvar triangleGeometry:TriangleSubGeometry = <TriangleSubGeometry> target;\n\n\t\t\tif (numVertices == triangleGeometry.numVertices && triangleGeometry.uvs != null) {\n\t\t\t\tuvs = triangleGeometry.uvs;\n\t\t\t} else {\n\t\t\t\tuvs = new Array<number>(numVertices*2);\n\t\t\t}\n\n\t\t\tvar index:number = 0;\n\t\t\tfor (j = 0; j <= this._segmentsH; ++j) {\n\t\t\t\tfor (i = 0; i <= this._segmentsW; ++i) {\n\t\t\t\t\tuvs[index++] = ( i/this._segmentsW )*triangleGeometry.scaleU;\n\t\t\t\t\tuvs[index++] = ( j/this._segmentsH )*triangleGeometry.scaleV;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttriangleGeometry.updateUVs(uvs);\n\n\t\t} else if (geometryType == \"lineSubGeometry\") {\n\t\t\t//nothing to do here\n\t\t}\n\t}\n}\n\nexport = PrimitiveSpherePrefab;","import IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\n\nimport SubGeometryBase\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport TriangleSubGeometry\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport PrimitivePrefabBase\t\t= require(\"awayjs-display/lib/prefabs/PrimitivePrefabBase\");\n\n/**\n * A UV Cylinder primitive mesh.\n */\nclass PrimitiveTorusPrefab extends PrimitivePrefabBase implements IAsset\n{\n\tprivate _radius:number;\n\tprivate _tubeRadius:number;\n\tprivate _segmentsR:number;\n\tprivate _segmentsT:number;\n\tprivate _yUp:boolean;\n\tprivate _numVertices:number = 0;\n\n\t/**\n\t * The radius of the torus.\n\t */\n\tpublic get radius():number\n\t{\n\t\treturn this._radius;\n\t}\n\n\tpublic set radius(value:number)\n\t{\n\t\tthis._radius = value;\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * The radius of the inner tube of the torus.\n\t */\n\tpublic get tubeRadius():number\n\t{\n\t\treturn this._tubeRadius;\n\t}\n\n\tpublic set tubeRadius(value:number)\n\t{\n\t\tthis._tubeRadius = value;\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * Defines the number of horizontal segments that make up the torus. Defaults to 16.\n\t */\n\tpublic get segmentsR():number\n\t{\n\t\treturn this._segmentsR;\n\t}\n\n\tpublic set segmentsR(value:number)\n\t{\n\t\tthis._segmentsR = value;\n\t\tthis._pInvalidateGeometry();\n\t\tthis._pInvalidateUVs();\n\t}\n\n\t/**\n\t * Defines the number of vertical segments that make up the torus. Defaults to 8.\n\t */\n\tpublic get segmentsT():number\n\t{\n\t\treturn this._segmentsT;\n\t}\n\n\tpublic set segmentsT(value:number)\n\t{\n\t\tthis._segmentsT = value;\n\t\tthis._pInvalidateGeometry();\n\t\tthis._pInvalidateUVs();\n\t}\n\n\t/**\n\t * Defines whether the torus poles should lay on the Y-axis (true) or on the Z-axis (false).\n\t */\n\tpublic get yUp():boolean\n\t{\n\t\treturn this._yUp;\n\t}\n\n\tpublic set yUp(value:boolean)\n\t{\n\t\tthis._yUp = value;\n\t\tthis._pInvalidateGeometry();\n\t}\n\n\t/**\n\t * Creates a new <code>Torus</code> object.\n\t * @param radius The radius of the torus.\n\t * @param tuebRadius The radius of the inner tube of the torus.\n\t * @param segmentsR Defines the number of horizontal segments that make up the torus.\n\t * @param segmentsT Defines the number of vertical segments that make up the torus.\n\t * @param yUp Defines whether the torus poles should lay on the Y-axis (true) or on the Z-axis (false).\n\t */\n\tconstructor(radius:number = 50, tubeRadius:number = 50, segmentsR:number = 16, segmentsT:number = 8, yUp:boolean = true)\n\t{\n\t\tsuper();\n\n\t\tthis._radius = radius;\n\t\tthis._tubeRadius = tubeRadius;\n\t\tthis._segmentsR = segmentsR;\n\t\tthis._segmentsT = segmentsT;\n\t\tthis._yUp = yUp;\n\t}\n\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pBuildGeometry(target:SubGeometryBase, geometryType:string)\n\t{\n\t\tvar indices:Array<number> /*uint*/;\n\t\tvar positions:Array<number>;\n\t\tvar normals:Array<number>;\n\t\tvar tangents:Array<number>;\n\n\t\tvar i:number, j:number;\n\t\tvar x:number, y:number, z:number, nx:number, ny:number, nz:number, revolutionAngleR:number, revolutionAngleT:number;\n\t\tvar vidx:number;\n\t\tvar fidx:number;\n\t\tvar numIndices:number = 0;\n\n\t\tif (geometryType == \"triangleSubGeometry\") {\n\n\t\t\tvar triangleGeometry:TriangleSubGeometry = <TriangleSubGeometry> target;\n\n\t\t\t// evaluate target number of vertices, triangles and indices\n\t\t\tthis._numVertices = (this._segmentsT + 1)*(this._segmentsR + 1); // segmentsT + 1 because of closure, segmentsR + 1 because of closure\n\t\t\tnumIndices = this._segmentsT*this._segmentsR*6; // each level has segmentR quads, each of 2 triangles\n\n\t\t\t// need to initialize raw arrays or can be reused?\n\t\t\tif (this._numVertices == triangleGeometry.numVertices) {\n\t\t\t\tindices = triangleGeometry.indices;\n\t\t\t\tpositions = triangleGeometry.positions;\n\t\t\t\tnormals = triangleGeometry.vertexNormals;\n\t\t\t\ttangents = triangleGeometry.vertexTangents;\n\t\t\t} else {\n\t\t\t\tindices = new Array<number>(numIndices)\n\t\t\t\tpositions = new Array<number>(this._numVertices*3);\n\t\t\t\tnormals = new Array<number>(this._numVertices*3);\n\t\t\t\ttangents = new Array<number>(this._numVertices*3);\n\n\t\t\t\tthis._pInvalidateUVs();\n\t\t\t}\n\n\n\t\t\tvidx = 0;\n\t\t\tfidx = 0;\n\n\t\t\t// evaluate revolution steps\n\t\t\tvar revolutionAngleDeltaR:number = 2*Math.PI/this._segmentsR;\n\t\t\tvar revolutionAngleDeltaT:number = 2*Math.PI/this._segmentsT;\n\n\t\t\tvar comp1:number, comp2:number;\n\t\t\tvar t1:number, t2:number, n1:number, n2:number;\n\t\t\tvar startIndex:number = 0;\n\t\t\tvar nextVertexIndex:number = 0;\n\n\t\t\t// surface\n\t\t\tvar a:number, b:number, c:number, d:number, length:number;\n\n\t\t\tfor (j = 0; j <= this._segmentsT; ++j) {\n\n\t\t\t\tstartIndex = nextVertexIndex*3;\n\n\t\t\t\tfor (i = 0; i <= this._segmentsR; ++i) {\n\n\t\t\t\t\t// revolution vertex\n\t\t\t\t\trevolutionAngleR = i*revolutionAngleDeltaR;\n\t\t\t\t\trevolutionAngleT = j*revolutionAngleDeltaT;\n\n\t\t\t\t\tlength = Math.cos(revolutionAngleT);\n\t\t\t\t\tnx = length*Math.cos(revolutionAngleR);\n\t\t\t\t\tny = length*Math.sin(revolutionAngleR);\n\t\t\t\t\tnz = Math.sin(revolutionAngleT);\n\n\t\t\t\t\tx = this._radius*Math.cos(revolutionAngleR) + this._tubeRadius*nx;\n\t\t\t\t\ty = this._radius*Math.sin(revolutionAngleR) + this._tubeRadius*ny;\n\t\t\t\t\tz = (j == this._segmentsT)? 0 : this._tubeRadius*nz;\n\n\t\t\t\t\tif (this._yUp) {\n\n\t\t\t\t\t\tn1 = -nz;\n\t\t\t\t\t\tn2 = ny;\n\t\t\t\t\t\tt1 = 0;\n\t\t\t\t\t\tt2 = (length? nx/length : x/this._radius);\n\t\t\t\t\t\tcomp1 = -z;\n\t\t\t\t\t\tcomp2 = y;\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tn1 = ny;\n\t\t\t\t\t\tn2 = nz;\n\t\t\t\t\t\tt1 = (length? nx/length : x/this._radius);\n\t\t\t\t\t\tt2 = 0;\n\t\t\t\t\t\tcomp1 = y;\n\t\t\t\t\t\tcomp2 = z;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (i == this._segmentsR) {\n\t\t\t\t\t\tpositions[vidx] = x;\n\t\t\t\t\t\tpositions[vidx + 1] = positions[startIndex + 1];\n\t\t\t\t\t\tpositions[vidx + 2] = positions[startIndex + 2];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpositions[vidx] = x;\n\t\t\t\t\t\tpositions[vidx + 1] = comp1;\n\t\t\t\t\t\tpositions[vidx + 2] = comp2;\n\t\t\t\t\t}\n\n\t\t\t\t\tnormals[vidx] = nx;\n\t\t\t\t\tnormals[vidx + 1] = n1;\n\t\t\t\t\tnormals[vidx + 2] = n2;\n\t\t\t\t\ttangents[vidx] = -(length? ny/length : y/this._radius);\n\t\t\t\t\ttangents[vidx + 1] = t1;\n\t\t\t\t\ttangents[vidx + 2] = t2;\n\n\t\t\t\t\tvidx += 3;\n\n\t\t\t\t\t// close triangle\n\t\t\t\t\tif (i > 0 && j > 0) {\n\t\t\t\t\t\ta = nextVertexIndex; // current\n\t\t\t\t\t\tb = nextVertexIndex - 1; // previous\n\t\t\t\t\t\tc = b - this._segmentsR - 1; // previous of last level\n\t\t\t\t\t\td = a - this._segmentsR - 1; // current of last level\n\n\t\t\t\t\t\tindices[fidx++] = a;\n\t\t\t\t\t\tindices[fidx++] = b;\n\t\t\t\t\t\tindices[fidx++] = c;\n\n\t\t\t\t\t\tindices[fidx++] = a;\n\t\t\t\t\t\tindices[fidx++] = c;\n\t\t\t\t\t\tindices[fidx++] = d;\n\t\t\t\t\t}\n\n\t\t\t\t\tnextVertexIndex++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// build real data from raw data\n\t\t\ttriangleGeometry.updateIndices(indices);\n\n\t\t\ttriangleGeometry.updatePositions(positions);\n\t\t\ttriangleGeometry.updateVertexNormals(normals);\n\t\t\ttriangleGeometry.updateVertexTangents(tangents);\n\n\t\t} else if (geometryType == \"lineSubGeometry\") {\n\t\t\t//TODO\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pBuildUVs(target:SubGeometryBase, geometryType:string)\n\t{\n\n\t\tvar i:number, j:number;\n\t\tvar uvs:Array<number>;\n\n\n\t\tif (geometryType == \"triangleSubGeometry\") {\n\n\t\t\tvar triangleGeometry:TriangleSubGeometry = <TriangleSubGeometry> target;\n\n\t\t\t// need to initialize raw array or can be reused?\n\t\t\tif (triangleGeometry.uvs && this._numVertices == triangleGeometry.numVertices) {\n\t\t\t\tuvs = triangleGeometry.uvs;\n\t\t\t} else {\n\t\t\t\tuvs = new Array<number>(this._numVertices*2);\n\t\t\t}\n\n\t\t\t// current uv component index\n\t\t\tvar index:number = 0;\n\n\t\t\t// surface\n\t\t\tfor (j = 0; j <= this._segmentsT; ++j) {\n\t\t\t\tfor (i = 0; i <= this._segmentsR; ++i) {\n\t\t\t\t\t// revolution vertex\n\t\t\t\t\tuvs[index++] = ( i/this._segmentsR )*triangleGeometry.scaleU;\n\t\t\t\t\tuvs[index++] = ( j/this._segmentsT )*triangleGeometry.scaleV;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// build real data from raw data\n\t\t\ttriangleGeometry.updateUVs(uvs);\n\n\t\t} else if (geometryType == \"lineSubGeometry\") {\n\t\t\t//nothing to do here\n\t\t}\n\t}\n}\n\nexport = PrimitiveTorusPrefab;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport CoordinateSystem\t\t\t\t= require(\"awayjs-core/lib/projections/CoordinateSystem\");\n\nimport CSSRenderableBase\t\t\t= require(\"awayjs-display/lib/pool/CSSRenderableBase\");\nimport CSSRendererBase\t\t\t\t= require(\"awayjs-display/lib/render/CSSRendererBase\");\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/render/IRenderer\");\nimport CSSEntityCollector\t\t\t= require(\"awayjs-display/lib/traverse/CSSEntityCollector\");\nimport EntityCollector\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport CSSMaterialBase\t\t\t\t= require(\"awayjs-display/lib/materials/CSSMaterialBase\");\n\n\n/**\n * The DefaultRenderer class provides the default rendering method. It renders the scene graph objects using the\n * materials assigned to them.\n *\n * @class away.render.DefaultRenderer\n */\nclass CSSDefaultRenderer extends CSSRendererBase implements IRenderer\n{\n\tprivate _container:HTMLDivElement;\n\tprivate _context:HTMLDivElement;\n\tprivate _contextStyle:MSStyleCSSProperties;\n\tprivate _contextMatrix:Matrix3D = new Matrix3D();\n\t\n\tprivate _activeMaterial:CSSMaterialBase;\n\tprivate _skyboxProjection:Matrix3D = new Matrix3D();\n\tprivate _transform:Matrix3D = new Matrix3D();\n\n\t/**\n\t * Creates a new CSSDefaultRenderer object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\t//create container for the renderer\n\t\tthis._container = document.createElement(\"div\");\n\t\tthis._container.style.overflow = \"hidden\";\n\t\tthis._container.style.position = \"absolute\";\n\t\t\n\t\t//add container to body\n\t\tdocument.body.appendChild(this._container);\n\n\t\t//create conxtext for the renderer\n\t\tthis._context = document.createElement(\"div\");\n\t\tthis._contextStyle = this._context.style;\n\t\tthis._contextStyle.position = \"absolute\";\n\t\tthis._contextStyle.transformStyle\n\t\t\t= this._contextStyle[\"-webkit-transform-style\"]\n\t\t\t= this._contextStyle[\"-moz-transform-style\"]\n\t\t\t= this._contextStyle[\"-o-transform-style\"]\n\t\t\t= this._contextStyle[\"-ms-transform-style\"] = \"preserve-3d\";\n\t\tthis._contextStyle.transformOrigin\n\t\t\t= this._contextStyle[\"-webkit-transform-origin\"]\n\t\t\t= this._contextStyle[\"-moz-transform-origin\"]\n\t\t\t= this._contextStyle[\"-o-transform-origin\"]\n\t\t\t= this._contextStyle[\"-ms-transform-origin\"] = \"0% 0%\";\n\n\t\t//add context to container\n\t\tthis._container.appendChild(this._context);\n\t}\n\n\t/**\n\t *\n\t * @param entityCollector\n\t */\n\tpublic render(entityCollector:CollectorBase)\n\t{\n\t\tsuper.render(entityCollector);\n\n\t\tif (this._pBackBufferInvalid)// reset or update render settings\n\t\t\tthis.pUpdateBackBuffer();\n\n\t\tthis._iRender(<EntityCollector> entityCollector);\n\n\t\tthis._pBackBufferInvalid = false;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic pDraw(entityCollector:EntityCollector)\n\t{\n//\t\t\tif (entityCollector.skyBox) {\n//\t\t\t\tif (this._activeMaterial)\n//\t\t\t\t\tthis._activeMaterial.iDeactivate(this._pStageGL);\n//\n//\t\t\t\tthis._activeMaterial = null;\n//\n//\t\t\t\tthis._pContext.setDepthTest(false, away.gl.ContextGLCompareMode.ALWAYS);\n//\t\t\t\tthis.drawSkybox(entityCollector);\n//\n//\t\t\t}\n//\n//\t\t\tvar which:number = target? DefaultRenderer.SCREEN_PASSES : DefaultRenderer.ALL_PASSES;\n\n\t\tvar sheet:CSSStyleSheet = <CSSStyleSheet> document.styleSheets[document.styleSheets.length - 1];\n\n\t\tfor (var i:number = 0; i < sheet.cssRules.length; i++) {\n\t\t\tvar style:MSStyleCSSProperties = (<CSSStyleRule> sheet.cssRules[i]).style;\n\t\t\tstyle.transform\n\t\t\t\t= style[\"-webkit-transform\"]\n\t\t\t\t= style[\"-moz-transform\"]\n\t\t\t\t= style[\"-o-transform\"]\n\t\t\t\t= style[\"-ms-transform\"] = (entityCollector.camera.projection.coordinateSystem == CoordinateSystem.RIGHT_HANDED)? \"\" : \"scale3d(1, -1, 1) translateY(-\" + style.height + \")\";\n\t\t}\n\n\t\tthis.drawRenderables(this._renderableHead, entityCollector);\n\n//\t\t\tif (this._activeMaterial)\n//\t\t\t\tthis._activeMaterial.iDeactivate(this._pStageGL);\n\n\t\tthis._activeMaterial = null;\n\t}\n\n\t/**\n\t * Updates the backbuffer properties.\n\t */\n\tpublic pUpdateBackBuffer()\n\t{\n\t\tthis._container.style.width = this._width + \"px\";\n\t\tthis._container.style.height = this._height + \"px\";\n\t\tthis._container.style.clip = \"rect(0px, \" + this._width + \"px, \" + this._height + \"px, 0px)\";\n\n\t\t//update context matrix\n\t\tthis._contextMatrix.rawData[0] = this._width/2;\n\t\tthis._contextMatrix.rawData[5] = -this._height/2;\n\t\tthis._contextMatrix.rawData[10] = -1; //fix for innaccurate z-sort\n\t\tthis._contextMatrix.rawData[12] = this._width/2;\n\t\tthis._contextMatrix.rawData[13] = this._height/2;\n\n\t\t//update context tranform\n\t\tthis._contextStyle.transform\n\t\t\t= this._contextStyle[\"-webkit-transform\"]\n\t\t\t= this._contextStyle[\"-moz-transform\"]\n\t\t\t= this._contextStyle[\"-o-transform\"]\n\t\t\t= this._contextStyle[\"-ms-transform\"] = this._contextMatrix.toString();\n\n\t\tthis._pBackBufferInvalid = false;\n\t}\n\n\t/**\n\t * Draw the skybox if present.\n\t * @param entityCollector The EntityCollector containing all potentially visible information.\n\t */\n\tprivate drawSkybox(entityCollector:CSSEntityCollector)\n\t{\n\t\t//TODO\n\t}\n\n\t/**\n\t * Draw a list of renderables.\n\t * @param renderables The renderables to draw.\n\t * @param entityCollector The EntityCollector containing all potentially visible information.\n\t */\n\tprivate drawRenderables(item:CSSRenderableBase, entityCollector:EntityCollector)\n\t{\n\t\tvar viewProjection:Matrix3D = entityCollector.camera.viewProjection.clone();\n\n\t\twhile (item) {\n\t\t\t//this._activeMaterial = <CSSMaterialBase> item.materialOwner.material;\n\n\t\t\t//serialise transform and apply to html element\n\t\t\tthis._transform.copyRawDataFrom(item.renderSceneTransform.rawData);\n\t\t\tthis._transform.append(viewProjection);\n\n\t\t\tvar style:MSStyleCSSProperties = item.htmlElement.style;\n\n\t\t\tstyle.transform\n\t\t\t\t= style[\"-webkit-transform\"]\n\t\t\t\t= style[\"-moz-transform\"]\n\t\t\t\t= style[\"-o-transform\"]\n\t\t\t\t= style[\"-ms-transform\"] = this._transform.toString();\n\n\t\t\tstyle.transformStyle\n\t\t\t\t= style[\"-webkit-transform-style\"]\n\t\t\t\t= style[\"-moz-transform-style\"]\n\t\t\t\t= style[\"-o-transform-style\"]\n\t\t\t\t= style[\"-ms-transform-style\"] = \"preserve-3d\";\n\n\t\t\t//check if child requires adding to the view\n\t\t\tif (!this._context.contains(item.htmlElement))\n\t\t\t\tthis._context.appendChild(item.htmlElement);\n\n\t\t\titem = item.next;\n\t\t}\n\n//\t\t\tvar numPasses:number;\n//\t\t\tvar j:number;\n//\t\t\tvar camera:away.entities.Camera = entityCollector.camera;\n//\t\t\tvar item2:away.render.CSSRenderableBase;\n//\n//\t\t\twhile (item) {\n//\t\t\t\tthis._activeMaterial = item.material;\n//\n//\t\t\t\tthis._activeMaterial.iUpdateMaterial(this._pContext);\n//\n//\t\t\t\tnumPasses = this._activeMaterial._iNumPasses;\n//\n//\t\t\t\tj = 0;\n//\n//\t\t\t\tdo {\n//\t\t\t\t\titem2 = item;\n//\n//\t\t\t\t\tvar rttMask:number = this._activeMaterial.iPassRendersToTexture(j)? 1 : 2;\n//\n//\t\t\t\t\tif ((rttMask & which) != 0) {\n//\t\t\t\t\t\tthis._activeMaterial.iActivatePass(j, this._pStageGL, camera);\n//\n//\t\t\t\t\t\tdo {\n//\t\t\t\t\t\t\tthis._activeMaterial.iRenderPass(j, item2, this._pStageGL, entityCollector);\n//\n//\t\t\t\t\t\t\titem2 = item2.next;\n//\n//\t\t\t\t\t\t} while (item2 && item2.material == this._activeMaterial);\n//\n//\t\t\t\t\t\tthis._activeMaterial.iDeactivatePass(j, this._pStageGL);\n//\n//\t\t\t\t\t} else {\n//\t\t\t\t\t\tdo {\n//\t\t\t\t\t\t\titem2 = item2.next;\n//\n//\t\t\t\t\t\t} while (item2 && item2.renderable.material == this._activeMaterial);\n//\t\t\t\t\t}\n//\t\t\t\t} while (++j < numPasses);\n//\n//\t\t\t\titem = item2;\n//\t\t\t}\n\t}\n\n\tpublic dispose()\n\t{\n\t\tsuper.dispose();\n\n\t\t//TODO\n\t}\n\n\n\tpublic _iCreateEntityCollector():CollectorBase\n\t{\n\t\treturn new CSSEntityCollector();\n\t}\n}\n\nexport = CSSDefaultRenderer;","import Point\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\n\nimport LineSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/LineSubMesh\");\nimport TriangleSubMesh\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\nimport CSSBillboardRenderable\t\t= require(\"awayjs-display/lib/pool/CSSBillboardRenderable\");\nimport CSSLineSegmentRenderable\t\t= require(\"awayjs-display/lib/pool/CSSLineSegmentRenderable\");\nimport CSSRenderableBase\t\t\t= require(\"awayjs-display/lib/pool/CSSRenderableBase\");\nimport EntityListItem\t\t\t\t= require(\"awayjs-display/lib/pool/EntityListItem\");\nimport IRenderablePool\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderablePool\");\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/render/IRenderer\");\nimport IEntitySorter\t\t\t\t= require(\"awayjs-display/lib/sort/IEntitySorter\");\nimport CSSEntityCollector\t\t\t= require(\"awayjs-display/lib/traverse/CSSEntityCollector\");\nimport EntityCollector\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport Billboard\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\nimport RendererEvent\t\t\t\t= require(\"awayjs-display/lib/events/RendererEvent\");\nimport CSSMaterialBase\t\t\t\t= require(\"awayjs-display/lib/materials/CSSMaterialBase\");\nimport TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\n/**\n * RendererBase forms an abstract base class for classes that are used in the rendering pipeline to render the\n * contents of a partition\n *\n * @class away.render.RendererBase\n */\nclass CSSRendererBase extends EventDispatcher\n{\n\tprivate _billboardRenderablePool:IRenderablePool;\n\tprivate _lineSegmentRenderablePool:IRenderablePool;\n\n\tpublic _pCamera:Camera;\n\tpublic _iEntryPoint:Vector3D;\n\tpublic _pCameraForward:Vector3D;\n\n\tprivate _backgroundR:number = 0;\n\tprivate _backgroundG:number = 0;\n\tprivate _backgroundB:number = 0;\n\tprivate _backgroundAlpha:number = 1;\n\tprivate _shareContext:boolean = false;\n\n\tpublic _pBackBufferInvalid:boolean = true;\n\tpublic _depthTextureInvalid:boolean = true;\n\n\tpublic _renderableHead:CSSRenderableBase;\n\n\tpublic _width:number;\n\tpublic _height:number;\n\n\tprivate _viewPort:Rectangle = new Rectangle();\n\tprivate _viewportDirty:boolean;\n\tprivate _scissorRect:Rectangle = new Rectangle();\n\tprivate _scissorDirty:boolean;\n\n\tprivate _localPos:Point = new Point();\n\tprivate _globalPos:Point = new Point();\n\n\tprivate _scissorUpdated:RendererEvent;\n\tprivate _viewPortUpdated:RendererEvent;\n\n\t/**\n\t * A viewPort rectangle equivalent of the StageGL size and position.\n\t */\n\tpublic get viewPort():Rectangle\n\t{\n\t\treturn this._viewPort;\n\t}\n\n\t/**\n\t * A scissor rectangle equivalent of the view size and position.\n\t */\n\tpublic get scissorRect():Rectangle\n\t{\n\t\treturn this._scissorRect;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get x():number\n\t{\n\t\treturn this._localPos.x;\n\t}\n\n\tpublic set x(value:number)\n\t{\n\t\tif (this.x == value)\n\t\t\treturn;\n\n\t\tthis.updateGlobalPos();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get y():number\n\t{\n\t\treturn this._localPos.y;\n\t}\n\n\tpublic set y(value:number)\n\t{\n\t\tif (this.y == value)\n\t\t\treturn;\n\n\t\tthis._globalPos.y = this._localPos.y = value;\n\n\t\tthis.updateGlobalPos();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get width():number\n\t{\n\t\treturn this._width;\n\t}\n\n\tpublic set width(value:number)\n\t{\n\t\tif (this._width == value)\n\t\t\treturn;\n\n\t\tthis._width = value;\n\t\tthis._scissorRect.width = value;\n\t\tthis._viewPort.width = value;\n\n\t\tthis._pBackBufferInvalid = true;\n\t\tthis._depthTextureInvalid = true;\n\n\t\tthis.notifyViewportUpdate();\n\t\tthis.notifyScissorUpdate();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get height():number\n\t{\n\t\treturn this._height;\n\t}\n\n\tpublic set height(value:number)\n\t{\n\t\tif (this._height == value)\n\t\t\treturn;\n\n\t\tthis._height = value;\n\t\tthis._scissorRect.height = value;\n\t\tthis._viewPort.height = value;\n\n\t\tthis._pBackBufferInvalid = true;\n\t\tthis._depthTextureInvalid = true;\n\n\t\tthis.notifyViewportUpdate();\n\t\tthis.notifyScissorUpdate();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic renderableSorter:IEntitySorter;\n\n\t/**\n\t * Creates a new RendererBase object.\n\t */\n\tconstructor(renderToTexture:boolean = false, forceSoftware:boolean = false, profile:string = \"baseline\")\n\t{\n\t\tsuper();\n\n\t\t//this._billboardRenderablePool = RenderablePool.getPool(CSSBillboardRenderable);\n\t\t//this._lineSegmentRenderablePool = RenderablePool.getPool(CSSLineSegmentRenderable);\n\n\t\tthis._viewPort = new Rectangle();\n\n\t\tif (this._width == 0)\n\t\t\tthis.width = window.innerWidth;\n\n\t\tif (this._height == 0)\n\t\t\tthis.height = window.innerHeight;\n\t}\n\n\t/**\n\t * The background color's red component, used when clearing.\n\t *\n\t * @private\n\t */\n\tpublic get _iBackgroundR():number\n\t{\n\t\treturn this._backgroundR;\n\t}\n\n\tpublic set _iBackgroundR(value:number)\n\t{\n\t\tif (this._backgroundR == value)\n\t\t\treturn;\n\n\t\tthis._backgroundR = value;\n\n\t\tthis._pBackBufferInvalid = true;\n\t}\n\n\t/**\n\t * The background color's green component, used when clearing.\n\t *\n\t * @private\n\t */\n\tpublic get _iBackgroundG():number\n\t{\n\t\treturn this._backgroundG;\n\t}\n\n\tpublic set _iBackgroundG(value:number)\n\t{\n\t\tif (this._backgroundG == value)\n\t\t\treturn;\n\n\t\tthis._backgroundG = value;\n\n\t\tthis._pBackBufferInvalid = true;\n\t}\n\n\t/**\n\t * The background color's blue component, used when clearing.\n\t *\n\t * @private\n\t */\n\tpublic get _iBackgroundB():number\n\t{\n\t\treturn this._backgroundB;\n\t}\n\n\tpublic set _iBackgroundB(value:number)\n\t{\n\t\tif (this._backgroundB == value)\n\t\t\treturn;\n\n\t\tthis._backgroundB = value;\n\n\t\tthis._pBackBufferInvalid = true;\n\t}\n\n\tpublic get shareContext():boolean\n\t{\n\t\treturn this._shareContext;\n\t}\n\n\tpublic set shareContext(value:boolean)\n\t{\n\t\tif (this._shareContext == value)\n\t\t\treturn;\n\n\t\tthis._shareContext = value;\n\n\t\tthis.updateGlobalPos();\n\t}\n\n\t/**\n\t * Disposes the resources used by the RendererBase.\n\t */\n\tpublic dispose()\n\t{\n\t\t/*\n\t\t if (_backgroundImageRenderer) {\n\t\t _backgroundImageRenderer.dispose();\n\t\t _backgroundImageRenderer = null;\n\t\t }\n\t\t */\n\t}\n\n\tpublic render(entityCollector:CollectorBase)\n\t{\n\t\tthis._viewportDirty = false;\n\t\tthis._scissorDirty = false;\n\t}\n\n\t/**\n\t * Renders the potentially visible geometry to the back buffer or texture.\n\t * @param entityCollector The EntityCollector object containing the potentially visible geometry.\n\t * @param scissorRect\n\t */\n\tpublic _iRender(entityCollector:EntityCollector, target:TextureProxyBase = null, scissorRect:Rectangle = null, surfaceSelector:number = 0)\n\t{\n\t\tif (!entityCollector.entityHead)\n\t\t\treturn;\n\n\t\tthis.pExecuteRender(entityCollector, scissorRect);\n\t}\n\n\tpublic _iRenderCascades(entityCollector:CollectorBase, target:TextureProxyBase, numCascades:number, scissorRects:Array<Rectangle>, cameras:Array<Camera>)\n\t{\n\n\t}\n\tpublic pCollectRenderables(entityCollector:CollectorBase)\n\t{\n\t\t////reset head values\n\t\t//this._renderableHead = null;\n\t\t//\n\t\t////grab entity head\n\t\t//var item:EntityListItem = entityCollector.entityHead;\n\t\t//\n\t\t////set temp values for entry point and camera forward vector\n\t\t//this._pCamera = entityCollector.camera;\n\t\t//this._iEntryPoint = this._pCamera.scenePosition;\n\t\t//this._pCameraForward = this._pCamera.transform.forwardVector;\n\t\t//\n\t\t////iterate through all entities\n\t\t//while (item) {\n\t\t//\t//item.entity._iCollectRenderables(this);\n\t\t//\titem = item.next;\n\t\t//}\n\t}\n\n\t/**\n\t * Renders the potentially visible geometry to the back buffer or texture. Only executed if everything is set up.\n\t * @param entityCollector The EntityCollector object containing the potentially visible geometry.\n\t * @param scissorRect\n\t */\n\tpublic pExecuteRender(entityCollector:CSSEntityCollector, scissorRect:Rectangle = null)\n\t{\n\t\tthis.pCollectRenderables(entityCollector);\n\n\t\tthis.pDraw(entityCollector);\n\t}\n\n\t/**\n\t * Performs the actual drawing of dom objects to the target.\n\t *\n\t * @param entityCollector The EntityCollector object containing the potentially visible dom objects.\n\t */\n\tpublic pDraw(entityCollector:CSSEntityCollector)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic get _iBackgroundAlpha():number\n\t{\n\t\treturn this._backgroundAlpha;\n\t}\n\n\tpublic set _iBackgroundAlpha(value:number)\n\t{\n\t\tif (this._backgroundAlpha == value)\n\t\t\treturn;\n\n\t\tthis._backgroundAlpha = value;\n\n\t\tthis._pBackBufferInvalid = true;\n\t}\n\n\t/**\n\t *\n\t * @param billboard\n\t */\n\tpublic applyBillboard(billboard:Billboard)\n\t{\n\t\t//this._applyRenderable(<CSSRenderableBase> this._billboardRenderablePool.getItem(billboard));\n\t}\n\n\t/**\n\t *\n\t * @param lineSubMesh\n\t */\n\tpublic applyLineSubMesh(lineSubMesh:LineSubMesh)\n\t{\n\t\t//this._applyRenderable(<CSSRenderableBase> this._billboardRenderablePool.getItem(lineSegment));\n\t}\n\n\t/**\n\t *\n\t * @param skybox\n\t */\n\tpublic applySkybox(skybox:Skybox)\n\t{\n\n\t}\n\n\t/**\n\t *\n\t * @param triangleSubMesh\n\t */\n\tpublic applyTriangleSubMesh(triangleSubMesh:TriangleSubMesh)\n\t{\n\n\t}\n\n\t/**\n\t *\n\t * @param renderable\n\t * @private\n\t */\n\tprivate _applyRenderable(renderable:CSSRenderableBase)\n\t{\n\t\tvar material:CSSMaterialBase;// = <CSSMaterialBase> renderable.renderableOwner.material;\n\t\tvar entity:IEntity = renderable.sourceEntity;\n\t\tvar position:Vector3D = entity.scenePosition;\n\n\t\tif (material) {\n\t\t\t//set ids for faster referencing\n\t\t\trenderable.materialId = material._iMaterialId;\n//\t\t\t\trenderable.renderOrderId = material._iRenderOrderId;\n\t\t\trenderable.cascaded = false;\n\n\t\t\t// project onto camera's z-axis\n\t\t\tposition = this._iEntryPoint.subtract(position);\n\t\t\trenderable.zIndex = entity.zOffset - position.dotProduct(this._pCameraForward);\n\n\t\t\t//store reference to scene transform\n\t\t\trenderable.renderSceneTransform = renderable.sourceEntity.getRenderSceneTransform(this._pCamera);\n\n\t\t\t//store reference to next item in list\n\t\t\trenderable.next = this._renderableHead;\n\t\t\tthis._renderableHead = renderable;\n\t\t}\n\t}\n\n\n\t/**\n\t * @private\n\t */\n\tprivate notifyScissorUpdate()\n\t{\n\t\tif (this._scissorDirty)\n\t\t\treturn;\n\n\t\tthis._scissorDirty = true;\n\n\t\tif (!this._scissorUpdated)\n\t\t\tthis._scissorUpdated = new RendererEvent(RendererEvent.SCISSOR_UPDATED);\n\n\t\tthis.dispatchEvent(this._scissorUpdated);\n\t}\n\n\n\t/**\n\t * @private\n\t */\n\tprivate notifyViewportUpdate()\n\t{\n\t\tif (this._viewportDirty)\n\t\t\treturn;\n\n\t\tthis._viewportDirty = true;\n\n\t\tif (!this._viewPortUpdated)\n\t\t\tthis._viewPortUpdated = new RendererEvent(RendererEvent.VIEWPORT_UPDATED);\n\n\t\tthis.dispatchEvent(this._viewPortUpdated);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic updateGlobalPos()\n\t{\n\t\tthis._viewPort.x = this._globalPos.x;\n\t\tthis._viewPort.y = this._globalPos.y;\n\n\t\tthis.notifyViewportUpdate();\n\t\tthis.notifyScissorUpdate();\n\t}\n\n\n\tpublic _iCreateEntityCollector():CollectorBase\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n}\n\nexport = CSSRendererBase;","import IRenderable\t\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderable\");\nimport IEntitySorter\t\t\t\t= require(\"awayjs-display/lib/sort/IEntitySorter\");\n\n/**\n * @class away.sort.RenderableMergeSort\n */\nclass RenderableMergeSort implements IEntitySorter\n{\n\tpublic sortBlendedRenderables(head:IRenderable):IRenderable\n\t{\n\t\tvar headB:IRenderable;\n\t\tvar fast:IRenderable;\n\t\tvar slow:IRenderable;\n\n\t\tif (!head || !head.next) {\n\t\t\treturn head;\n\t\t}\n\n\t\t// split in two sublists\n\t\tslow = head;\n\t\tfast = head.next;\n\n\t\twhile (fast) {\n\t\t\tfast = fast.next;\n\t\t\tif (fast) {\n\t\t\t\tslow = slow.next;\n\t\t\t\tfast = fast.next;\n\t\t\t}\n\t\t}\n\n\t\theadB = slow.next;\n\t\tslow.next = null;\n\n\t\t// recurse\n\t\thead = this.sortBlendedRenderables(head);\n\t\theadB = this.sortBlendedRenderables(headB);\n\n\t\t// merge sublists while respecting order\n\t\tvar result:IRenderable;\n\t\tvar curr:IRenderable;\n\t\tvar l:IRenderable;\n\n\t\tif (!head)\n\t\t\treturn headB;\n\t\tif (!headB)\n\t\t\treturn head;\n\n\t\twhile (head && headB) {\n\t\t\tif (head.zIndex < headB.zIndex) {\n\t\t\t\tl = head;\n\t\t\t\thead = head.next;\n\t\t\t} else {\n\t\t\t\tl = headB;\n\t\t\t\theadB = headB.next;\n\t\t\t}\n\n\t\t\tif (!result)\n\t\t\t\tresult = l; else\n\t\t\t\tcurr.next = l;\n\n\t\t\tcurr = l;\n\t\t}\n\n\t\tif (head)\n\t\t\tcurr.next = head; else if (headB)\n\t\t\tcurr.next = headB;\n\n\t\treturn result;\n\t}\n\n\tpublic sortOpaqueRenderables(head:IRenderable):IRenderable\n\t{\n\t\tvar headB:IRenderable;\n\t\tvar fast:IRenderable, slow:IRenderable;\n\n\t\tif (!head || !head.next) {\n\t\t\treturn head;\n\t\t}\n\n\t\t// split in two sublists\n\t\tslow = head;\n\t\tfast = head.next;\n\n\t\twhile (fast) {\n\t\t\tfast = fast.next;\n\t\t\tif (fast) {\n\t\t\t\tslow = slow.next;\n\t\t\t\tfast = fast.next;\n\t\t\t}\n\t\t}\n\n\t\theadB = slow.next;\n\t\tslow.next = null;\n\n\t\t// recurse\n\t\thead = this.sortOpaqueRenderables(head);\n\t\theadB = this.sortOpaqueRenderables(headB);\n\n\t\t// merge sublists while respecting order\n\t\tvar result:IRenderable;\n\t\tvar curr:IRenderable;\n\t\tvar l:IRenderable;\n\t\tvar cmp:number = 0;\n\n\t\tif (!head)\n\t\t\treturn headB;\n\t\tif (!headB)\n\t\t\treturn head;\n\n\t\twhile (head && headB && head != null && headB != null) {\n\n\t\t\t// first sort per render order id (reduces program3D switches),\n\t\t\t// then on render object id (reduces setting props),\n\t\t\t// then on zIndex (reduces overdraw)\n\t\t\tvar aid:number = head.renderOrderId;\n\t\t\tvar bid:number = headB.renderOrderId;\n\n\t\t\tif (aid == bid) {\n\t\t\t\tvar ma:number = head.renderObjectId;\n\t\t\t\tvar mb:number = headB.renderObjectId;\n\n\t\t\t\tif (ma == mb) {\n\t\t\t\t\tif (head.zIndex < headB.zIndex)\n\t\t\t\t\t\tcmp = 1; else\n\t\t\t\t\t\tcmp = -1;\n\t\t\t\t} else if (ma > mb) {\n\t\t\t\t\tcmp = 1;\n\t\t\t\t} else {\n\t\t\t\t\tcmp = -1;\n\t\t\t\t}\n\t\t\t} else if (aid > bid) {\n\t\t\t\tcmp = 1;\n\t\t\t} else {\n\t\t\t\tcmp = -1;\n\t\t\t}\n\n\t\t\tif (cmp < 0) {\n\t\t\t\tl = head;\n\t\t\t\thead = head.next;\n\t\t\t} else {\n\t\t\t\tl = headB;\n\t\t\t\theadB = headB.next;\n\t\t\t}\n\n\t\t\tif (!result) {\n\t\t\t\tresult = l;\n\t\t\t\tcurr = l;\n\t\t\t} else {\n\t\t\t\tcurr.next = l;\n\t\t\t\tcurr = l;\n\t\t\t}\n\t\t}\n\n\t\tif (head)\n\t\t\tcurr.next = head; else if (headB)\n\t\t\tcurr.next = headB;\n\n\t\treturn result;\n\t}\n}\n\nexport = RenderableMergeSort;","/**\n * The AntiAliasType class provides values for anti-aliasing in the\n * away.text.TextField class.\n */\nclass AntiAliasType\n{\n\t/**\n\t * Sets anti-aliasing to advanced anti-aliasing. Advanced anti-aliasing\n\t * allows font faces to be rendered at very high quality at small sizes. It\n\t * is best used with applications that have a lot of small text. Advanced\n\t * anti-aliasing is not recommended for very large fonts(larger than 48\n\t * points). This constant is used for the <code>antiAliasType</code> property\n\t * in the TextField class. Use the syntax\n\t * <code>AntiAliasType.ADVANCED</code>.\n\t */\n\tpublic static ADVANCED:string = \"advanced\";\n\n\t/**\n\t * Sets anti-aliasing to the anti-aliasing that is used in Flash Player 7 and\n\t * earlier. This setting is recommended for applications that do not have a\n\t * lot of text. This constant is used for the <code>antiAliasType</code>\n\t * property in the TextField class. Use the syntax\n\t * <code>AntiAliasType.NORMAL</code>.\n\t */\n\tpublic static NORMAL:string = \"normal\";\n}\n\nexport = AntiAliasType;","/**\n * The GridFitType class defines values for grid fitting in the TextField class.\n */\nclass GridFitType\n{\n\t/**\n\t * Doesn't set grid fitting. Horizontal and vertical lines in the glyphs are\n\t * not forced to the pixel grid. This constant is used in setting the\n\t * <code>gridFitType</code> property of the TextField class. This is often a\n\t * good setting for animation or for large font sizes. Use the syntax\n\t * <code>GridFitType.NONE</code>.\n\t */\n\tpublic static NONE:string = \"none\";\n\n\t/**\n\t * Fits strong horizontal and vertical lines to the pixel grid. This constant\n\t * is used in setting the <code>gridFitType</code> property of the TextField\n\t * class. This setting only works for left-justified text fields and acts\n\t * like the <code>GridFitType.SUBPIXEL</code> constant in static text. This\n\t * setting generally provides the best readability for left-aligned text. Use\n\t * the syntax <code>GridFitType.PIXEL</code>.\n\t */\n\tpublic static PIXEL:string = \"pixel\";\n\n\t/**\n\t * Fits strong horizontal and vertical lines to the sub-pixel grid on LCD\n\t * monitors. (Red, green, and blue are actual pixels on an LCD screen.) This\n\t * is often a good setting for right-aligned or center-aligned dynamic text,\n\t * and it is sometimes a useful tradeoff for animation vs. text quality. This\n\t * constant is used in setting the <code>gridFitType</code> property of the\n\t * TextField class. Use the syntax <code>GridFitType.SUBPIXEL</code>.\n\t */\n\tpublic static SUBPIXEL:string = \"subpixel\";\n}\n\nexport = GridFitType;","/**\n * The TextFieldAutoSize class is an enumeration of constant values used in\n * setting the <code>autoSize</code> property of the TextField class.\n */\nclass TextFieldAutoSize\n{\n\t/**\n\t * Specifies that the text is to be treated as center-justified text. Any\n\t * resizing of a single line of a text field is equally distributed to both\n\t * the right and left sides.\n\t */\n\tpublic static CENTER:string = \"center\";\n\n\t/**\n\t * Specifies that the text is to be treated as left-justified text, meaning\n\t * that the left side of the text field remains fixed and any resizing of a\n\t * single line is on the right side.\n\t */\n\tpublic static LEFT:string = \"left\";\n\n\t/**\n\t * Specifies that no resizing is to occur.\n\t */\n\tpublic static NONE:string = \"none\";\n\n\t/**\n\t * Specifies that the text is to be treated as right-justified text, meaning\n\t * that the right side of the text field remains fixed and any resizing of a\n\t * single line is on the left side.\n\t */\n\tpublic static RIGHT:string = \"right\";\n}\n\nexport = TextFieldAutoSize;","/**\n * The TextFieldType class is an enumeration of constant values used in setting the\n * <code>type</code> property of the TextField class.\n *\n * @see away.entities.TextField#type\n */\nclass TextFieldType\n{\n\t/**\n\t * Used to specify a <code>dynamic</code> TextField.\n\t */\n\tpublic static DYNAMIC:string = \"dynamic\";\n\n\t/**\n\t * Used to specify an <code>input</code> TextField.\n\t */\n\tpublic static INPUT:string = \"input\";\n}\n\nexport = TextFieldType;","/**\n * The TextFormatAlign class provides values for text alignment in the\n * TextFormat class.\n */\nclass TextFormatAlign\n{\n\t/**\n\t * Constant; centers the text in the text field. Use the syntax\n\t * <code>TextFormatAlign.CENTER</code>.\n\t */\n\tpublic CENTER:string = \"center\";\n\n\t/**\n\t * Constant; justifies text within the text field. Use the syntax\n\t * <code>TextFormatAlign.JUSTIFY</code>.\n\t */\n\tpublic JUSTIFY:string = \"justify\";\n\n\t/**\n\t * Constant; aligns text to the left within the text field. Use the syntax\n\t * <code>TextFormatAlign.LEFT</code>.\n\t */\n\tpublic LEFT:string = \"left\";\n\n\t/**\n\t * Constant; aligns text to the right within the text field. Use the syntax\n\t * <code>TextFormatAlign.RIGHT</code>.\n\t */\n\tpublic RIGHT:string = \"right\";\n}\n\nexport = TextFormatAlign;","/**\n * The TextFormat class represents character formatting information. Use the\n * TextFormat class to create specific text formatting for text fields. You\n * can apply text formatting to both static and dynamic text fields. The\n * properties of the TextFormat class apply to device and embedded fonts.\n * However, for embedded fonts, bold and italic text actually require specific\n * fonts. If you want to display bold or italic text with an embedded font,\n * you need to embed the bold and italic variations of that font.\n *\n * <p> You must use the constructor <code>new TextFormat()</code> to create a\n * TextFormat object before setting its properties. When you apply a\n * TextFormat object to a text field using the\n * <code>TextField.defaultTextFormat</code> property or the\n * <code>TextField.setTextFormat()</code> method, only its defined properties\n * are applied. Use the <code>TextField.defaultTextFormat</code> property to\n * apply formatting BEFORE you add text to the <code>TextField</code>, and the\n * <code>setTextFormat()</code> method to add formatting AFTER you add text to\n * the <code>TextField</code>. The TextFormat properties are <code>null</code>\n * by default because if you don't provide values for the properties, Flash\n * Player uses its own default formatting. The default formatting that Flash\n * Player uses for each property(if property's value is <code>null</code>) is\n * as follows:</p>\n *\n * <p>The default formatting for each property is also described in each\n * property description.</p>\n */\nclass TextFormat\n{\n\n\t/**\n\t * Indicates the alignment of the paragraph. Valid values are TextFormatAlign\n\t * constants.\n\t *\n\t * @default TextFormatAlign.LEFT\n\t * @throws ArgumentError The <code>align</code> specified is not a member of\n\t *                       flash.text.TextFormatAlign.\n\t */\n\tpublic align:string;\n\n\t/**\n\t * Indicates the block indentation in pixels. Block indentation is applied to\n\t * an entire block of text; that is, to all lines of the text. In contrast,\n\t * normal indentation(<code>TextFormat.indent</code>) affects only the first\n\t * line of each paragraph. If this property is <code>null</code>, the\n\t * TextFormat object does not specify block indentation(block indentation is\n\t * 0).\n\t */\n\tpublic blockIndent:number;\n\n\t/**\n\t * Specifies whether the text is boldface. The default value is\n\t * <code>null</code>, which means no boldface is used. If the value is\n\t * <code>true</code>, then the text is boldface.\n\t */\n\tpublic bold:boolean;\n\n\t/**\n\t * Indicates that the text is part of a bulleted list. In a bulleted list,\n\t * each paragraph of text is indented. To the left of the first line of each\n\t * paragraph, a bullet symbol is displayed. The default value is\n\t * <code>null</code>, which means no bulleted list is used.\n\t */\n\tpublic bullet:boolean;\n\n\t/**\n\t * Indicates the color of the text. A number containing three 8-bit RGB\n\t * components; for example, 0xFF0000 is red, and 0x00FF00 is green. The\n\t * default value is <code>null</code>, which means that Flash Player uses the\n\t * color black(0x000000).\n\t */\n\tpublic color:boolean;\n\n\t/**\n\t * The name of the font for text in this text format, as a string. The\n\t * default value is <code>null</code>, which means that Flash Player uses\n\t * Times New Roman font for the text.\n\t */\n\tpublic font:string;\n\n\t/**\n\t * Indicates the indentation from the left margin to the first character in\n\t * the paragraph. The default value is <code>null</code>, which indicates\n\t * that no indentation is used.\n\t */\n\tpublic indent:number;\n\n\t/**\n\t * Indicates whether text in this text format is italicized. The default\n\t * value is <code>null</code>, which means no italics are used.\n\t */\n\tpublic italic:boolean;\n\n\t/**\n\t * A Boolean value that indicates whether kerning is enabled\n\t * (<code>true</code>) or disabled(<code>false</code>). Kerning adjusts the\n\t * pixels between certain character pairs to improve readability, and should\n\t * be used only when necessary, such as with headings in large fonts. Kerning\n\t * is supported for embedded fonts only.\n\t *\n\t * <p>Certain fonts such as Verdana and monospaced fonts, such as Courier\n\t * New, do not support kerning.</p>\n\t *\n\t * <p>The default value is <code>null</code>, which means that kerning is not\n\t * enabled.</p>\n\t */\n\tpublic kerning:boolean;\n\n\t/**\n\t * An integer representing the amount of vertical space(called\n\t * <i>leading</i>) between lines. The default value is <code>null</code>,\n\t * which indicates that the amount of leading used is 0.\n\t */\n\tpublic leading:number;\n\n\t/**\n\t * The left margin of the paragraph, in pixels. The default value is\n\t * <code>null</code>, which indicates that the left margin is 0 pixels.\n\t */\n\tpublic leftMargin:number;\n\n\t/**\n\t * A number representing the amount of space that is uniformly distributed\n\t * between all characters. The value specifies the number of pixels that are\n\t * added to the advance after each character. The default value is\n\t * <code>null</code>, which means that 0 pixels of letter spacing is used.\n\t * You can use decimal values such as <code>1.75</code>.\n\t */\n\tpublic letterSpacing:number;\n\n\t/**\n\t * The right margin of the paragraph, in pixels. The default value is\n\t * <code>null</code>, which indicates that the right margin is 0 pixels.\n\t */\n\tpublic rightMargin:number;\n\n\t/**\n\t * The size in pixels of text in this text format. The default value is\n\t * <code>null</code>, which means that a size of 12 is used.\n\t */\n\tpublic size:number;\n\n\t/**\n\t * Specifies custom tab stops as an array of non-negative integers. Each tab\n\t * stop is specified in pixels. If custom tab stops are not specified\n\t * (<code>null</code>), the default tab stop is 4(average character width).\n\t */\n\tpublic tabStops:Array<number /*int*/> = new Array<number>();\n\n\t/**\n\t * Indicates the target window where the hyperlink is displayed. If the\n\t * target window is an empty string, the text is displayed in the default\n\t * target window <code>_self</code>. You can choose a custom name or one of\n\t * the following four names: <code>_self</code> specifies the current frame\n\t * in the current window, <code>_blank</code> specifies a new window,\n\t * <code>_parent</code> specifies the parent of the current frame, and\n\t * <code>_top</code> specifies the top-level frame in the current window. If\n\t * the <code>TextFormat.url</code> property is an empty string or\n\t * <code>null</code>, you can get or set this property, but the property will\n\t * have no effect.\n\t */\n\tpublic target:string;\n\n\t/**\n\t * Indicates whether the text that uses this text format is underlined\n\t * (<code>true</code>) or not(<code>false</code>). This underlining is\n\t * similar to that produced by the <code><U></code> tag, but the latter is\n\t * not true underlining, because it does not skip descenders correctly. The\n\t * default value is <code>null</code>, which indicates that underlining is\n\t * not used.\n\t */\n\tpublic underline:boolean;\n\n\t/**\n\t * Indicates the target URL for the text in this text format. If the\n\t * <code>url</code> property is an empty string, the text does not have a\n\t * hyperlink. The default value is <code>null</code>, which indicates that\n\t * the text does not have a hyperlink.\n\t *\n\t * <p><b>Note:</b> The text with the assigned text format must be set with\n\t * the <code>htmlText</code> property for the hyperlink to work.</p>\n\t */\n\tpublic url:string;\n\n\t/**\n\t * Creates a TextFormat object with the specified properties. You can then\n\t * change the properties of the TextFormat object to change the formatting of\n\t * text fields.\n\t *\n\t * <p>Any parameter may be set to <code>null</code> to indicate that it is\n\t * not defined. All of the parameters are optional; any omitted parameters\n\t * are treated as <code>null</code>.</p>\n\t *\n\t * @param font        The name of a font for text as a string.\n\t * @param size        An integer that indicates the size in pixels.\n\t * @param color       The color of text using this text format. A number\n\t *                    containing three 8-bit RGB components; for example,\n\t *                    0xFF0000 is red, and 0x00FF00 is green.\n\t * @param bold        A Boolean value that indicates whether the text is\n\t *                    boldface.\n\t * @param italic      A Boolean value that indicates whether the text is\n\t *                    italicized.\n\t * @param underline   A Boolean value that indicates whether the text is\n\t *                    underlined.\n\t * @param url         The URL to which the text in this text format\n\t *                    hyperlinks. If <code>url</code> is an empty string, the\n\t *                    text does not have a hyperlink.\n\t * @param target      The target window where the hyperlink is displayed. If\n\t *                    the target window is an empty string, the text is\n\t *                    displayed in the default target window\n\t *                    <code>_self</code>. If the <code>url</code> parameter\n\t *                    is set to an empty string or to the value\n\t *                    <code>null</code>, you can get or set this property,\n\t *                    but the property will have no effect.\n\t * @param align       The alignment of the paragraph, as a TextFormatAlign\n\t *                    value.\n\t * @param leftMargin  Indicates the left margin of the paragraph, in pixels.\n\t * @param rightMargin Indicates the right margin of the paragraph, in pixels.\n\t * @param indent      An integer that indicates the indentation from the left\n\t *                    margin to the first character in the paragraph.\n\t * @param leading     A number that indicates the amount of leading vertical\n\t *                    space between lines.\n\t */\n\tconstructor(font:string = \"Times New Roman\", size:number = 12, color:number /*int*/ = 0x000000, bold:boolean = false, italic:boolean = false, underline:boolean = false, url:string = \"\", target:string = \"\", align:string = \"left\", leftMargin:number = 0, rightMargin:number = 0, indent:number = 0, leading:number = 0)\n\t{\n\t\tthis.font = font;\n\t\tthis.size = size;\n\t\tthis.bold = bold;\n\t\tthis.italic = italic;\n\t\tthis.underline = underline;\n\t\tthis.url = url;\n\t\tthis.target = target;\n\t\tthis.align = align;\n\t\tthis.leftMargin = leftMargin;\n\t\tthis.rightMargin = rightMargin;\n\t\tthis.indent = indent;\n\t\tthis.leading = leading;\n\t}\n}\n\nexport = TextFormat;","/**\n * A class that defines the Interactive mode of a text field object.\n *\n * @see away.entities.TextField#textInteractionMode\n */\nclass TextInteractionMode\n{\n\t/**\n\t * The text field's default interaction mode is NORMAL and it varies across\n\t * platform. On Desktop, the normal mode implies that the text field is in\n\t * scrollable + selection mode. On Mobile platforms like Android, normal mode\n\t * implies that the text field can only be scrolled but the text can not be\n\t * selected.\n\t */\n\tpublic static NORMAL:string = \"normal\";\n\n\t/**\n\t * On mobile platforms like Android, the text field starts in normal mode\n\t * (which implies scroll and non-selectable mode). The user can switch to\n\t * selection mode through the in-built context menu of the text field object.\n\t */\n\tpublic static SELECTION:string = \"selection\";\n}\n\nexport = TextInteractionMode;","/**\n * The TextLineMetrics class contains information about the text position and\n * measurements of a line of text within a text field. All measurements are in\n * pixels. Objects of this class are returned by the \n * <code>away.entities.TextField.getLineMetrics()</code> method.\n */\nclass TextLineMetrics\n{\n\t/**\n\t * The ascent value of the text is the length from the baseline to the top of\n\t * the line height in pixels.\n\t */\n\tpublic ascent:number;\n\n\t/**\n\t * The descent value of the text is the length from the baseline to the\n\t * bottom depth of the line in pixels.\n\t */\n\tpublic descent:number;\n\n\t/**\n\t * The height value of the text of the selected lines (not necessarily the\n\t * complete text) in pixels. The height of the text line does not include the\n\t * gutter height.\n\t */\n\tpublic height:number;\n\n\t/**\n\t * The leading value is the measurement of the vertical distance between the\n\t * lines of text.\n\t */\n\tpublic leading:number;\n\n\t/**\n\t * The width value is the width of the text of the selected lines (not\n\t * necessarily the complete text) in pixels. The width of the text line is\n\t * not the same as the width of the text field. The width of the text line is\n\t * relative to the text field width, minus the gutter width of 4 pixels\n\t * (2 pixels on each side).\n\t */\n\tpublic width:number;\n\n\t/**\n\t * The x value is the left position of the first character in pixels. This\n\t * value includes the margin, indent (if any), and gutter widths.\n\t */\n\tpublic x:number;\n\n\t/**\n\t * Creates a TextLineMetrics object. The TextLineMetrics object contains\n\t * information about the text metrics of a line of text in a text field.\n\t * Objects of this class are returned by the\n\t * away.entities.TextField.getLineMetrics() method.\n\t *\n\t * @param x           The left position of the first character in pixels.\n\t * @param width       The width of the text of the selected lines (not\n\t *                    necessarily the complete text) in pixels.\n\t * @param height      The height of the text of the selected lines (not\n\t *                    necessarily the complete text) in pixels.\n\t * @param ascent      The length from the baseline to the top of the line\n\t *                    height in pixels.\n\t * @param descent     The length from the baseline to the bottom depth of\n\t *                    the line in pixels.\n\t * @param leading     The measurement of the vertical distance between the\n\t *                    lines of text.\n\t */\n\tconstructor(x:number = NaN, width:number = NaN, height:number = NaN, ascent:number = NaN, descent:number = NaN, leading:number = NaN)\n\t{\n\n\t}\n}\n\nexport = TextLineMetrics;","import CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\n\n/**\n * @class away.traverse.CSSEntityCollector\n */\nclass CSSEntityCollector extends CollectorBase\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n}\n\nexport = CSSEntityCollector;","import Plane3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Plane3D\");\n\nimport Scene\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/Scene\");\nimport EntityListItem\t\t\t\t= require(\"awayjs-display/lib/pool/EntityListItem\");\nimport EntityListItemPool\t\t\t= require(\"awayjs-display/lib/pool/EntityListItemPool\");\nimport NodeBase\t\t\t\t\t\t= require(\"awayjs-display/lib/partition/NodeBase\");\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/render/IRenderer\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\n\n/**\n * @class away.traverse.CollectorBase\n */\nclass CollectorBase\n{\n\tpublic scene:Scene;\n\n\tpublic _pEntityHead:EntityListItem;\n\tpublic _pEntityListItemPool:EntityListItemPool;\n\tpublic _pCamera:Camera;\n\tprivate _customCullPlanes:Array<Plane3D>;\n\tprivate _cullPlanes:Array<Plane3D>;\n\tprivate _numCullPlanes:number = 0;\n\tpublic _pNumEntities:number = 0;\n\tpublic _pNumInteractiveEntities:number = 0;\n\n\tpublic isEntityCollector:boolean;\n\n\tconstructor()\n\t{\n\t\tthis._pEntityListItemPool = new EntityListItemPool();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get camera():Camera\n\t{\n\t\treturn this._pCamera;\n\t}\n\n\tpublic set camera(value:Camera)\n\t{\n\t\tthis._pCamera = value;\n\t\tthis._cullPlanes = this._pCamera.frustumPlanes;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get cullPlanes():Array<Plane3D>\n\t{\n\t\treturn this._customCullPlanes;\n\t}\n\n\tpublic set cullPlanes(value:Array<Plane3D>)\n\t{\n\t\tthis._customCullPlanes = value;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get entityHead():EntityListItem\n\t{\n\t\treturn this._pEntityHead;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get numEntities():number\n\t{\n\t\treturn this._pNumEntities;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get numInteractiveEntities():number\n\t{\n\t\treturn this._pNumInteractiveEntities;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic clear()\n\t{\n\t\tthis._pNumEntities = this._pNumInteractiveEntities = 0;\n\t\tthis._cullPlanes = this._customCullPlanes? this._customCullPlanes : ( this._pCamera? this._pCamera.frustumPlanes : null );\n\t\tthis._numCullPlanes = this._cullPlanes? this._cullPlanes.length : 0;\n\t\tthis._pEntityHead = null;\n\t\tthis._pEntityListItemPool.freeAll();\n\t}\n\n\t/**\n\t *\n\t * @param node\n\t * @returns {boolean}\n\t */\n\tpublic enterNode(node:NodeBase):boolean\n\t{\n\t\tvar enter:boolean = this.scene._iCollectionMark != node._iCollectionMark && node.isInFrustum(this._cullPlanes, this._numCullPlanes);\n\n\t\tnode._iCollectionMark = this.scene._iCollectionMark;\n\n\t\treturn enter;\n\t}\n\n\t/**\n\t *\n\t * @param entity\n\t */\n\tpublic applyDirectionalLight(entity:IEntity)\n\t{\n\t\t//don't do anything here\n\t}\n\n\t/**\n\t *\n\t * @param entity\n\t */\n\tpublic applyEntity(entity:IEntity)\n\t{\n\t\tthis._pNumEntities++;\n\n\t\tif (entity._iIsMouseEnabled())\n\t\t\tthis._pNumInteractiveEntities++;\n\n\t\tvar item:EntityListItem = this._pEntityListItemPool.getItem();\n\t\titem.entity = entity;\n\n\t\titem.next = this._pEntityHead;\n\t\tthis._pEntityHead = item;\n\t}\n\n\t/**\n\t *\n\t * @param entity\n\t */\n\tpublic applyLightProbe(entity:IEntity)\n\t{\n\t\t//don't do anything here\n\t}\n\n\t/**\n\t *\n\t * @param entity\n\t */\n\tpublic applyPointLight(entity:IEntity)\n\t{\n\t\t//don't do anything here\n\t}\n\n\t/**\n\t *\n\t * @param entity\n\t */\n\tpublic applySkybox(entity:IEntity)\n\t{\n\t\t//don't do anything here\n\t}\n}\n\nexport = CollectorBase;","import LightBase\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport DirectionalLight\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport LightProbe\t\t\t\t\t= require(\"awayjs-display/lib/entities/LightProbe\");\nimport PointLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\n\n/**\n * @class away.traverse.EntityCollector\n */\nclass EntityCollector extends CollectorBase\n{\n\tpublic _pSkybox:Skybox;\n\tpublic _pLights:Array<LightBase>;\n\tprivate _directionalLights:Array<DirectionalLight>;\n\tprivate _pointLights:Array<PointLight>;\n\tprivate _lightProbes:Array<LightProbe>;\n\n\tpublic _pNumLights:number = 0;\n\n\tprivate _numDirectionalLights:number = 0;\n\tprivate _numPointLights:number = 0;\n\tprivate _numLightProbes:number = 0;\n\n\t/**\n\t *\n\t */\n\tpublic get directionalLights():Array<DirectionalLight>\n\t{\n\t\treturn this._directionalLights;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get lightProbes():Array<LightProbe>\n\t{\n\t\treturn this._lightProbes;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get lights():Array<LightBase>\n\t{\n\t\treturn this._pLights;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get pointLights():Array<PointLight>\n\t{\n\t\treturn this._pointLights;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get skyBox():Skybox\n\t{\n\t\treturn this._pSkybox;\n\t}\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._pLights = new Array<LightBase>();\n\t\tthis._directionalLights = new Array<DirectionalLight>();\n\t\tthis._pointLights = new Array<PointLight>();\n\t\tthis._lightProbes = new Array<LightProbe>();\n\n\t\tthis.isEntityCollector = true;\n\t}\n\n\t/**\n\t *\n\t * @param entity\n\t */\n\tpublic applyDirectionalLight(entity:IEntity)\n\t{\n\t\tthis._directionalLights[ this._numDirectionalLights++ ] = <DirectionalLight> entity;\n\t}\n\n\t/**\n\t *\n\t * @param entity\n\t */\n\tpublic applyLightProbe(entity:IEntity)\n\t{\n\t\tthis._lightProbes[ this._numLightProbes++ ] = <LightProbe> entity;\n\t}\n\n\t/**\n\t *\n\t * @param entity\n\t */\n\tpublic applyPointLight(entity:IEntity)\n\t{\n\t\tthis._pointLights[ this._numPointLights++ ] = <PointLight> entity;\n\t}\n\n\t/**\n\t *\n\t * @param entity\n\t */\n\tpublic applySkybox(entity:IEntity)\n\t{\n\t\tthis._pSkybox = <Skybox> entity;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic clear()\n\t{\n\t\tsuper.clear();\n\n\t\tthis._pSkybox = null;\n\n\t\tif (this._pNumLights > 0)\n\t\t\tthis._pLights.length = this._pNumLights = 0;\n\n\t\tif (this._numDirectionalLights > 0)\n\t\t\tthis._directionalLights.length = this._numDirectionalLights = 0;\n\n\t\tif (this._numPointLights > 0)\n\t\t\tthis._pointLights.length = this._numPointLights = 0;\n\n\t\tif (this._numLightProbes > 0)\n\t\t\tthis._lightProbes.length = this._numLightProbes = 0;\n\t}\n}\n\nexport = EntityCollector;","import Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport NodeBase\t\t\t\t\t\t= require(\"awayjs-display/lib/partition/NodeBase\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\n\n/**\n * The RaycastCollector class is a traverser for scene partitions that collects all scene graph entities that are\n * considered intersecting with the defined ray.\n *\n * @see away.partition.Partition\n * @see away.entities.IEntity\n *\n * @class away.traverse.RaycastCollector\n */\nclass RaycastCollector extends CollectorBase\n{\n\tprivate _rayPosition:Vector3D = new Vector3D();\n\tprivate _rayDirection:Vector3D = new Vector3D();\n\n\tpublic _iCollectionMark:number = 0;\n\n\t/**\n\t * Provides the starting position of the ray.\n\t */\n\tpublic get rayPosition():Vector3D\n\t{\n\t\treturn this._rayPosition;\n\t}\n\n\tpublic set rayPosition(value:Vector3D)\n\t{\n\t\tthis._rayPosition = value;\n\t}\n\n\t/**\n\t * Provides the direction vector of the ray.\n\t */\n\tpublic get rayDirection():Vector3D\n\t{\n\t\treturn this._rayDirection;\n\t}\n\n\tpublic set rayDirection(value:Vector3D)\n\t{\n\t\tthis._rayDirection = value;\n\t}\n\n\t/**\n\t * Creates a new RaycastCollector object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * Returns true if the current node is at least partly in the frustum. If so, the partition node knows to pass on the traverser to its children.\n\t *\n\t * @param node The Partition3DNode object to frustum-test.\n\t */\n\tpublic enterNode(node:NodeBase):boolean\n\t{\n\t\treturn node.isIntersectingRay(this._rayPosition, this._rayDirection);\n\t}\n}\n\nexport = RaycastCollector;","import NodeBase\t\t\t\t\t\t= require(\"awayjs-display/lib/partition/NodeBase\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\n\n/**\n * @class away.traverse.ShadowCasterCollector\n */\nclass ShadowCasterCollector extends CollectorBase\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic enterNode(node:NodeBase):boolean\n\t{\n\t\tvar enter:boolean = this.scene._iCollectionMark != node._iCollectionMark && node.isCastingShadow();\n\n\t\tif (!enter) {\n\t\t\tnode._iCollectionMark = this.scene._iCollectionMark;\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn super.enterNode(node);\n\t}\n}\n\nexport = ShadowCasterCollector;","import BitmapData\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport CastError\t\t\t\t= require(\"awayjs-display/lib/errors/CastError\");\nimport BitmapTexture\t\t\t= require(\"awayjs-core/lib/textures/BitmapTexture\");\nimport ImageTexture\t\t\t\t= require(\"awayjs-core/lib/textures/ImageTexture\");\n\n/**\n * Helper class for casting assets to usable objects\n */\nclass Cast\n{\n\tprivate static _colorNames:Object;\n\tprivate static _hexChars:string = \"0123456789abcdefABCDEF\";\n\n\tprivate static _notClasses:Object = new Object();\n\tprivate static _classes:Object = new Object();\n\n\tpublic static string(data:any):string\n\t{\n\t\tif (typeof(data) == 'function')\n\t\t\tdata = new data;\n\n\t\tif (typeof(data) == 'string')\n\t\t\treturn data;\n\n\t\treturn <string> data;\n\t}\n\n\tpublic static byteArray(data:any):ByteArray\n\t{\n\t\tif (typeof(data) == 'function')\n\t\t\tdata = new data;\n\n\t\tif (data instanceof ByteArray)\n\t\t\treturn data;\n\n\t\treturn <ByteArray> data;\n\t}\n\n\t//        public static xml(data:any):XML\n\t//        {\n\t//            if (typeof(data) == 'function')\n\t//                data = new data;\n\t//\n\t//            if (data is XML)\n\t//                return data;\n\t//\n\t//            return XML(data);\n\t//        }\n\n\tprivate static isHex(str:string):boolean\n\t{\n\t\tvar length:number /*int*/ = str.length;\n\t\tfor (var i:number /*int*/ = 0; i < length; ++i) {\n\t\t\tif (this._hexChars.indexOf(str.charAt(i)) == -1)\n\t\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tpublic static tryColor(data:any):number /*uint*/\n\t{\n\t\tif (typeof(data) == 'number' /*uint*/)\n\t\t\treturn Math.floor(<number> data);\n\n\t\tif (typeof(data) == 'string') {\n\t\t\tif (data == \"random\")\n\t\t\t\treturn Math.floor(Math.random()*0x1000000);\n\n\t\t\tif (this._colorNames == null) {\n\t\t\t\tthis._colorNames = new Object();\n\t\t\t\tthis._colorNames[\"steelblue\"] = 0x4682B4;\n\t\t\t\tthis._colorNames[\"royalblue\"] = 0x041690;\n\t\t\t\tthis._colorNames[\"cornflowerblue\"] = 0x6495ED;\n\t\t\t\tthis._colorNames[\"lightsteelblue\"] = 0xB0C4DE;\n\t\t\t\tthis._colorNames[\"mediumslateblue\"] = 0x7B68EE;\n\t\t\t\tthis._colorNames[\"slateblue\"] = 0x6A5ACD;\n\t\t\t\tthis._colorNames[\"darkslateblue\"] = 0x483D8B;\n\t\t\t\tthis._colorNames[\"midnightblue\"] = 0x191970;\n\t\t\t\tthis._colorNames[\"navy\"] = 0x000080;\n\t\t\t\tthis._colorNames[\"darkblue\"] = 0x00008B;\n\t\t\t\tthis._colorNames[\"mediumblue\"] = 0x0000CD;\n\t\t\t\tthis._colorNames[\"blue\"] = 0x0000FF;\n\t\t\t\tthis._colorNames[\"dodgerblue\"] = 0x1E90FF;\n\t\t\t\tthis._colorNames[\"deepskyblue\"] = 0x00BFFF;\n\t\t\t\tthis._colorNames[\"lightskyblue\"] = 0x87CEFA;\n\t\t\t\tthis._colorNames[\"skyblue\"] = 0x87CEEB;\n\t\t\t\tthis._colorNames[\"lightblue\"] = 0xADD8E6;\n\t\t\t\tthis._colorNames[\"powderblue\"] = 0xB0E0E6;\n\t\t\t\tthis._colorNames[\"azure\"] = 0xF0FFFF;\n\t\t\t\tthis._colorNames[\"lightcyan\"] = 0xE0FFFF;\n\t\t\t\tthis._colorNames[\"paleturquoise\"] = 0xAFEEEE;\n\t\t\t\tthis._colorNames[\"mediumturquoise\"] = 0x48D1CC;\n\t\t\t\tthis._colorNames[\"lightseagreen\"] = 0x20B2AA;\n\t\t\t\tthis._colorNames[\"darkcyan\"] = 0x008B8B;\n\t\t\t\tthis._colorNames[\"teal\"] = 0x008080;\n\t\t\t\tthis._colorNames[\"cadetblue\"] = 0x5F9EA0;\n\t\t\t\tthis._colorNames[\"darkturquoise\"] = 0x00CED1;\n\t\t\t\tthis._colorNames[\"aqua\"] = 0x00FFFF;\n\t\t\t\tthis._colorNames[\"cyan\"] = 0x00FFFF;\n\t\t\t\tthis._colorNames[\"turquoise\"] = 0x40E0D0;\n\t\t\t\tthis._colorNames[\"aquamarine\"] = 0x7FFFD4;\n\t\t\t\tthis._colorNames[\"mediumaquamarine\"] = 0x66CDAA;\n\t\t\t\tthis._colorNames[\"darkseagreen\"] = 0x8FBC8F;\n\t\t\t\tthis._colorNames[\"mediumseagreen\"] = 0x3CB371;\n\t\t\t\tthis._colorNames[\"seagreen\"] = 0x2E8B57;\n\t\t\t\tthis._colorNames[\"darkgreen\"] = 0x006400;\n\t\t\t\tthis._colorNames[\"green\"] = 0x008000;\n\t\t\t\tthis._colorNames[\"forestgreen\"] = 0x228B22;\n\t\t\t\tthis._colorNames[\"limegreen\"] = 0x32CD32;\n\t\t\t\tthis._colorNames[\"lime\"] = 0x00FF00;\n\t\t\t\tthis._colorNames[\"chartreuse\"] = 0x7FFF00;\n\t\t\t\tthis._colorNames[\"lawngreen\"] = 0x7CFC00;\n\t\t\t\tthis._colorNames[\"greenyellow\"] = 0xADFF2F;\n\t\t\t\tthis._colorNames[\"yellowgreen\"] = 0x9ACD32;\n\t\t\t\tthis._colorNames[\"palegreen\"] = 0x98FB98;\n\t\t\t\tthis._colorNames[\"lightgreen\"] = 0x90EE90;\n\t\t\t\tthis._colorNames[\"springgreen\"] = 0x00FF7F;\n\t\t\t\tthis._colorNames[\"mediumspringgreen\"] = 0x00FA9A;\n\t\t\t\tthis._colorNames[\"darkolivegreen\"] = 0x556B2F;\n\t\t\t\tthis._colorNames[\"olivedrab\"] = 0x6B8E23;\n\t\t\t\tthis._colorNames[\"olive\"] = 0x808000;\n\t\t\t\tthis._colorNames[\"darkkhaki\"] = 0xBDB76B;\n\t\t\t\tthis._colorNames[\"darkgoldenrod\"] = 0xB8860B;\n\t\t\t\tthis._colorNames[\"goldenrod\"] = 0xDAA520;\n\t\t\t\tthis._colorNames[\"gold\"] = 0xFFD700;\n\t\t\t\tthis._colorNames[\"yellow\"] = 0xFFFF00;\n\t\t\t\tthis._colorNames[\"khaki\"] = 0xF0E68C;\n\t\t\t\tthis._colorNames[\"palegoldenrod\"] = 0xEEE8AA;\n\t\t\t\tthis._colorNames[\"blanchedalmond\"] = 0xFFEBCD;\n\t\t\t\tthis._colorNames[\"moccasin\"] = 0xFFE4B5;\n\t\t\t\tthis._colorNames[\"wheat\"] = 0xF5DEB3;\n\t\t\t\tthis._colorNames[\"navajowhite\"] = 0xFFDEAD;\n\t\t\t\tthis._colorNames[\"burlywood\"] = 0xDEB887;\n\t\t\t\tthis._colorNames[\"tan\"] = 0xD2B48C;\n\t\t\t\tthis._colorNames[\"rosybrown\"] = 0xBC8F8F;\n\t\t\t\tthis._colorNames[\"sienna\"] = 0xA0522D;\n\t\t\t\tthis._colorNames[\"saddlebrown\"] = 0x8B4513;\n\t\t\t\tthis._colorNames[\"chocolate\"] = 0xD2691E;\n\t\t\t\tthis._colorNames[\"peru\"] = 0xCD853F;\n\t\t\t\tthis._colorNames[\"sandybrown\"] = 0xF4A460;\n\t\t\t\tthis._colorNames[\"darkred\"] = 0x8B0000;\n\t\t\t\tthis._colorNames[\"maroon\"] = 0x800000;\n\t\t\t\tthis._colorNames[\"brown\"] = 0xA52A2A;\n\t\t\t\tthis._colorNames[\"firebrick\"] = 0xB22222;\n\t\t\t\tthis._colorNames[\"indianred\"] = 0xCD5C5C;\n\t\t\t\tthis._colorNames[\"lightcoral\"] = 0xF08080;\n\t\t\t\tthis._colorNames[\"salmon\"] = 0xFA8072;\n\t\t\t\tthis._colorNames[\"darksalmon\"] = 0xE9967A;\n\t\t\t\tthis._colorNames[\"lightsalmon\"] = 0xFFA07A;\n\t\t\t\tthis._colorNames[\"coral\"] = 0xFF7F50;\n\t\t\t\tthis._colorNames[\"tomato\"] = 0xFF6347;\n\t\t\t\tthis._colorNames[\"darkorange\"] = 0xFF8C00;\n\t\t\t\tthis._colorNames[\"orange\"] = 0xFFA500;\n\t\t\t\tthis._colorNames[\"orangered\"] = 0xFF4500;\n\t\t\t\tthis._colorNames[\"crimson\"] = 0xDC143C;\n\t\t\t\tthis._colorNames[\"red\"] = 0xFF0000;\n\t\t\t\tthis._colorNames[\"deeppink\"] = 0xFF1493;\n\t\t\t\tthis._colorNames[\"fuchsia\"] = 0xFF00FF;\n\t\t\t\tthis._colorNames[\"magenta\"] = 0xFF00FF;\n\t\t\t\tthis._colorNames[\"hotpink\"] = 0xFF69B4;\n\t\t\t\tthis._colorNames[\"lightpink\"] = 0xFFB6C1;\n\t\t\t\tthis._colorNames[\"pink\"] = 0xFFC0CB;\n\t\t\t\tthis._colorNames[\"palevioletred\"] = 0xDB7093;\n\t\t\t\tthis._colorNames[\"mediumvioletred\"] = 0xC71585;\n\t\t\t\tthis._colorNames[\"purple\"] = 0x800080;\n\t\t\t\tthis._colorNames[\"darkmagenta\"] = 0x8B008B;\n\t\t\t\tthis._colorNames[\"mediumpurple\"] = 0x9370DB;\n\t\t\t\tthis._colorNames[\"blueviolet\"] = 0x8A2BE2;\n\t\t\t\tthis._colorNames[\"indigo\"] = 0x4B0082;\n\t\t\t\tthis._colorNames[\"darkviolet\"] = 0x9400D3;\n\t\t\t\tthis._colorNames[\"darkorchid\"] = 0x9932CC;\n\t\t\t\tthis._colorNames[\"mediumorchid\"] = 0xBA55D3;\n\t\t\t\tthis._colorNames[\"orchid\"] = 0xDA70D6;\n\t\t\t\tthis._colorNames[\"violet\"] = 0xEE82EE;\n\t\t\t\tthis._colorNames[\"plum\"] = 0xDDA0DD;\n\t\t\t\tthis._colorNames[\"thistle\"] = 0xD8BFD8;\n\t\t\t\tthis._colorNames[\"lavender\"] = 0xE6E6FA;\n\t\t\t\tthis._colorNames[\"ghostwhite\"] = 0xF8F8FF;\n\t\t\t\tthis._colorNames[\"aliceblue\"] = 0xF0F8FF;\n\t\t\t\tthis._colorNames[\"mintcream\"] = 0xF5FFFA;\n\t\t\t\tthis._colorNames[\"honeydew\"] = 0xF0FFF0;\n\t\t\t\tthis._colorNames[\"lightgoldenrodyellow\"] = 0xFAFAD2;\n\t\t\t\tthis._colorNames[\"lemonchiffon\"] = 0xFFFACD;\n\t\t\t\tthis._colorNames[\"cornsilk\"] = 0xFFF8DC;\n\t\t\t\tthis._colorNames[\"lightyellow\"] = 0xFFFFE0;\n\t\t\t\tthis._colorNames[\"ivory\"] = 0xFFFFF0;\n\t\t\t\tthis._colorNames[\"floralwhite\"] = 0xFFFAF0;\n\t\t\t\tthis._colorNames[\"linen\"] = 0xFAF0E6;\n\t\t\t\tthis._colorNames[\"oldlace\"] = 0xFDF5E6;\n\t\t\t\tthis._colorNames[\"antiquewhite\"] = 0xFAEBD7;\n\t\t\t\tthis._colorNames[\"bisque\"] = 0xFFE4C4;\n\t\t\t\tthis._colorNames[\"peachpuff\"] = 0xFFDAB9;\n\t\t\t\tthis._colorNames[\"papayawhip\"] = 0xFFEFD5;\n\t\t\t\tthis._colorNames[\"beige\"] = 0xF5F5DC;\n\t\t\t\tthis._colorNames[\"seashell\"] = 0xFFF5EE;\n\t\t\t\tthis._colorNames[\"lavenderblush\"] = 0xFFF0F5;\n\t\t\t\tthis._colorNames[\"mistyrose\"] = 0xFFE4E1;\n\t\t\t\tthis._colorNames[\"snow\"] = 0xFFFAFA;\n\t\t\t\tthis._colorNames[\"white\"] = 0xFFFFFF;\n\t\t\t\tthis._colorNames[\"whitesmoke\"] = 0xF5F5F5;\n\t\t\t\tthis._colorNames[\"gainsboro\"] = 0xDCDCDC;\n\t\t\t\tthis._colorNames[\"lightgrey\"] = 0xD3D3D3;\n\t\t\t\tthis._colorNames[\"silver\"] = 0xC0C0C0;\n\t\t\t\tthis._colorNames[\"darkgrey\"] = 0xA9A9A9;\n\t\t\t\tthis._colorNames[\"grey\"] = 0x808080;\n\t\t\t\tthis._colorNames[\"lightslategrey\"] = 0x778899;\n\t\t\t\tthis._colorNames[\"slategrey\"] = 0x708090;\n\t\t\t\tthis._colorNames[\"dimgrey\"] = 0x696969;\n\t\t\t\tthis._colorNames[\"darkslategrey\"] = 0x2F4F4F;\n\t\t\t\tthis._colorNames[\"black\"] = 0x000000;\n\t\t\t\tthis._colorNames[\"transparent\"] = 0xFF000000;\n\t\t\t}\n\n\t\t\tif (this._colorNames[data] != null)\n\t\t\t\treturn this._colorNames[data];\n\n\t\t\tif (((<string> data).length == 6) && this.isHex(data))\n\t\t\t\treturn parseInt(\"0x\" + data);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tpublic static color(data:any):number /*uint*/\n\t{\n\t\tvar result:number /*uint*/ = this.tryColor(data);\n\n\t\tif (result == null)\n\t\t\tthrow new CastError(\"Can't cast to color: \" + data);\n\n\t\treturn result;\n\t}\n\n\tpublic static tryClass(name:string):any\n\t{\n\t\tif (this._notClasses[name])\n\t\t\treturn name;\n\n\t\tvar result:any = this._classes[name];\n\n\t\tif (result != null)\n\t\t\treturn result;\n\n\t\ttry {\n\t\t\tresult = window[name];\n\t\t\tthis._classes[name] = result;\n\t\t\treturn result;\n\t\t} catch (e /*ReferenceError*/) {\n\t\t}\n\n\t\tthis._notClasses[name] = true;\n\n\t\treturn name;\n\t}\n\n\tpublic static bitmapData(data:any):BitmapData\n\t{\n\t\tif (data == null)\n\t\t\treturn null;\n\n\t\tif (typeof(data) == 'string')\n\t\t\tdata = this.tryClass(data);\n\n\t\tif (typeof(data) == 'function') {\n\t\t\ttry {\n\t\t\t\tdata = new data();\n\t\t\t} catch (e /*ArgumentError*/) {\n\t\t\t\tdata = new data(0, 0);\n\t\t\t}\n\t\t}\n\n\t\tif (data instanceof BitmapData)\n\t\t\treturn data;\n\n\t\tif (data instanceof ImageTexture)\n\t\t\tdata = (<ImageTexture> data).htmlImageElement;\n\n\t\tif (data instanceof HTMLImageElement) {\n\t\t\tvar imageElement:HTMLImageElement = <HTMLImageElement> data;\n\t\t\tvar bitmapData:BitmapData = new BitmapData(imageElement.width, imageElement.height, true, 0x0);\n\t\t\tbitmapData.draw(imageElement)\n\t\t\treturn bitmapData;\n\t\t}\n\n\t\t//            if (data is DisplayObject) {\n\t\t//                var ds:DisplayObject = data as DisplayObject;\n\t\t//                var bmd:BitmapData = new BitmapData(ds.width, ds.height, true, 0x00FFFFFF);\n\t\t//                var mat:Matrix = ds.transform.matrix.clone();\n\t\t//                mat.tx = 0;\n\t\t//                mat.ty = 0;\n\t\t//                bmd.draw(ds, mat, ds.transform.colorTransform, ds.blendMode, bmd.rect, true);\n\t\t//                return bmd;\n\t\t//            }\n\n\t\tthrow new CastError(\"Can't cast to BitmapData: \" + data);\n\t}\n\n\tpublic static bitmapTexture(data:any):BitmapTexture\n\t{\n\t\tif (data == null)\n\t\t\treturn null;\n\n\t\tif (typeof(data) == 'string')\n\t\t\tdata = this.tryClass(data);\n\n\t\tif (typeof(data) == 'function') {\n\t\t\ttry {\n\t\t\t\tdata = new data();\n\t\t\t} catch (e /*ArgumentError*/) {\n\t\t\t\tdata = new data(0, 0);\n\t\t\t}\n\t\t}\n\n\t\tif (data instanceof BitmapTexture)\n\t\t\treturn data;\n\n\t\ttry {\n\t\t\tvar bmd:BitmapData = Cast.bitmapData(data);\n\t\t\treturn new BitmapTexture(bmd);\n\t\t} catch (e /*CastError*/) {\n\t\t}\n\n\t\tthrow new CastError(\"Can't cast to BitmapTexture: \" + data);\n\t}\n}\n\nexport = Cast;","class MethodMaterialMode\n{\n\t/**\n\t *\n\t */\n\tpublic static SINGLE_PASS:string = \"singlePass\";\n\n\t/**\n\t *\n\t */\n\tpublic static MULTI_PASS:string = \"multiPass\";\n}\n\nexport = MethodMaterialMode;","import Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport StaticLightPicker\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/StaticLightPicker\");\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport IRenderObject\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderObject\");\n\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\n\nimport AmbientBasicMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/AmbientBasicMethod\");\nimport DiffuseBasicMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod\");\nimport EffectMethodBase\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\nimport NormalBasicMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/NormalBasicMethod\");\nimport ShadowMapMethodBase\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase\");\nimport SpecularBasicMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularBasicMethod\");\nimport MethodMaterialMode\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\n\nimport MethodRenderablePool\t\t\t= require(\"awayjs-methodmaterials/lib/pool/MethodRenderablePool\");\n\n/**\n * MethodMaterial forms an abstract base class for the default shaded materials provided by Stage,\n * using material methods to define their appearance.\n */\nclass MethodMaterial extends MaterialBase\n{\n\tprivate _effectMethods:Array<EffectMethodBase> = new Array<EffectMethodBase>();\n\tprivate _mode:string;\n\n\tprivate _ambientMethod:AmbientBasicMethod = new AmbientBasicMethod();\n\tprivate _shadowMethod:ShadowMapMethodBase;\n\tprivate _diffuseMethod:DiffuseBasicMethod = new DiffuseBasicMethod();\n\tprivate _normalMethod:NormalBasicMethod = new NormalBasicMethod();\n\tprivate _specularMethod:SpecularBasicMethod = new SpecularBasicMethod();\n\n\n\tprivate _depthCompareMode:string = ContextGLCompareMode.LESS_EQUAL;\n\n\t/**\n\t * Creates a new MethodMaterial object.\n\t *\n\t * @param texture The texture used for the material's albedo color.\n\t * @param smooth Indicates whether the texture should be filtered when sampled. Defaults to true.\n\t * @param repeat Indicates whether the texture should be tiled when sampled. Defaults to false.\n\t * @param mipmap Indicates whether or not any used textures should use mipmapping. Defaults to false.\n\t */\n\tconstructor(texture?:Texture2DBase, smooth?:boolean, repeat?:boolean, mipmap?:boolean);\n\tconstructor(color?:number, alpha?:number);\n\tconstructor(textureColor:any = null, smoothAlpha:any = null, repeat:boolean = false, mipmap:boolean = true)\n\t{\n\t\tsuper();\n\n\t\tthis._mode = MethodMaterialMode.SINGLE_PASS;\n\n\t\tif (textureColor instanceof Texture2DBase) {\n\t\t\tthis.texture = <Texture2DBase> textureColor;\n\n\t\t\tthis.smooth = (smoothAlpha == null)? true : false;\n\t\t\tthis.repeat = repeat;\n\t\t\tthis.mipmap = mipmap;\n\t\t} else {\n\t\t\tthis.color = (textureColor == null)? 0xFFFFFF : Number(textureColor);\n\t\t\tthis.alpha = (smoothAlpha == null)? 1 : Number(smoothAlpha);\n\t\t}\n\t}\n\n\n\tpublic get mode():string\n\t{\n\t\treturn this._mode;\n\t}\n\n\tpublic set mode(value:string)\n\t{\n\t\tif (this._mode == value)\n\t\t\treturn;\n\n\t\tthis._mode = value;\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\t/**\n\t * The depth compare mode used to render the renderables using this material.\n\t *\n\t * @see away.stagegl.ContextGLCompareMode\n\t */\n\n\tpublic get depthCompareMode():string\n\t{\n\t\treturn this._depthCompareMode;\n\t}\n\n\tpublic set depthCompareMode(value:string)\n\t{\n\t\tif (this._depthCompareMode == value)\n\t\t\treturn;\n\n\t\tthis._depthCompareMode = value;\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\t/**\n\t * The texture object to use for the ambient colour.\n\t */\n\tpublic get diffuseTexture():Texture2DBase\n\t{\n\t\treturn this._diffuseMethod.texture;\n\t}\n\n\tpublic set diffuseTexture(value:Texture2DBase)\n\t{\n\t\tthis._diffuseMethod.texture = value;\n\t}\n\n\t/**\n\t * The method that provides the ambient lighting contribution. Defaults to AmbientBasicMethod.\n\t */\n\tpublic get ambientMethod():AmbientBasicMethod\n\t{\n\t\treturn this._ambientMethod;\n\t}\n\n\tpublic set ambientMethod(value:AmbientBasicMethod)\n\t{\n\t\tif (this._ambientMethod == value)\n\t\t\treturn;\n\n\t\tif (value && this._ambientMethod)\n\t\t\tvalue.copyFrom(this._ambientMethod);\n\n\t\tthis._ambientMethod = value;\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\t/**\n\t * The method used to render shadows cast on this surface, or null if no shadows are to be rendered. Defaults to null.\n\t */\n\tpublic get shadowMethod():ShadowMapMethodBase\n\t{\n\t\treturn this._shadowMethod;\n\t}\n\n\tpublic set shadowMethod(value:ShadowMapMethodBase)\n\t{\n\t\tif (this._shadowMethod == value)\n\t\t\treturn;\n\n\t\tif (value && this._shadowMethod)\n\t\t\tvalue.copyFrom(this._shadowMethod);\n\n\t\tthis._shadowMethod = value;\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\t/**\n\t * The method that provides the diffuse lighting contribution. Defaults to DiffuseBasicMethod.\n\t */\n\tpublic get diffuseMethod():DiffuseBasicMethod\n\t{\n\t\treturn this._diffuseMethod;\n\t}\n\n\tpublic set diffuseMethod(value:DiffuseBasicMethod)\n\t{\n\t\tif (this._diffuseMethod == value)\n\t\t\treturn;\n\n\t\tif (value && this._diffuseMethod)\n\t\t\tvalue.copyFrom(this._diffuseMethod);\n\n\t\tthis._diffuseMethod = value;\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\t/**\n\t * The method that provides the specular lighting contribution. Defaults to SpecularBasicMethod.\n\t */\n\tpublic get specularMethod():SpecularBasicMethod\n\t{\n\t\treturn this._specularMethod;\n\t}\n\n\tpublic set specularMethod(value:SpecularBasicMethod)\n\t{\n\t\tif (this._specularMethod == value)\n\t\t\treturn;\n\n\t\tif (value && this._specularMethod)\n\t\t\tvalue.copyFrom(this._specularMethod);\n\n\t\tthis._specularMethod = value;\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\t/**\n\t * The method used to generate the per-pixel normals. Defaults to NormalBasicMethod.\n\t */\n\tpublic get normalMethod():NormalBasicMethod\n\t{\n\t\treturn this._normalMethod;\n\t}\n\n\tpublic set normalMethod(value:NormalBasicMethod)\n\t{\n\t\tif (this._normalMethod == value)\n\t\t\treturn;\n\n\t\tif (value && this._normalMethod)\n\t\t\tvalue.copyFrom(this._normalMethod);\n\n\t\tthis._normalMethod = value;\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\tpublic get numEffectMethods():number\n\t{\n\t\treturn this._effectMethods.length;\n\t}\n\n\t/**\n\t * Appends an \"effect\" shading method to the shader. Effect methods are those that do not influence the lighting\n\t * but modulate the shaded colour, used for fog, outlines, etc. The method will be applied to the result of the\n\t * methods added prior.\n\t */\n\tpublic addEffectMethod(method:EffectMethodBase)\n\t{\n\t\tthis._effectMethods.push(method);\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\t/**\n\t * Returns the method added at the given index.\n\t * @param index The index of the method to retrieve.\n\t * @return The method at the given index.\n\t */\n\tpublic getEffectMethodAt(index:number):EffectMethodBase\n\t{\n\t\treturn this._effectMethods[index];\n\t}\n\n\t/**\n\t * Adds an effect method at the specified index amongst the methods already added to the material. Effect\n\t * methods are those that do not influence the lighting but modulate the shaded colour, used for fog, outlines,\n\t * etc. The method will be applied to the result of the methods with a lower index.\n\t */\n\tpublic addEffectMethodAt(method:EffectMethodBase, index:number)\n\t{\n\t\tthis._effectMethods.splice(index, 0, method);\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\t/**\n\t * Removes an effect method from the material.\n\t * @param method The method to be removed.\n\t */\n\tpublic removeEffectMethod(method:EffectMethodBase)\n\t{\n\t\tthis._effectMethods.splice(this._effectMethods.indexOf(method), 1);\n\n\t\tthis._pInvalidateRenderObject();\n\t}\n\n\t/**\n\t * The normal map to modulate the direction of the surface for each texel. The default normal method expects\n\t * tangent-space normal maps, but others could expect object-space maps.\n\t */\n\tpublic get normalMap():Texture2DBase\n\t{\n\t\treturn this._normalMethod.normalMap;\n\t}\n\n\tpublic set normalMap(value:Texture2DBase)\n\t{\n\t\tthis._normalMethod.normalMap = value;\n\t}\n\n\t/**\n\t * A specular map that defines the strength of specular reflections for each texel in the red channel,\n\t * and the gloss factor in the green channel. You can use SpecularBitmapTexture if you want to easily set\n\t * specular and gloss maps from grayscale images, but correctly authored images are preferred.\n\t */\n\tpublic get specularMap():Texture2DBase\n\t{\n\t\treturn this._specularMethod.texture;\n\t}\n\n\tpublic set specularMap(value:Texture2DBase)\n\t{\n\t\tthis._specularMethod.texture = value;\n\t}\n\n\t/**\n\t * The glossiness of the material (sharpness of the specular highlight).\n\t */\n\tpublic get gloss():number\n\t{\n\t\treturn this._specularMethod.gloss;\n\t}\n\n\tpublic set gloss(value:number)\n\t{\n\t\tthis._specularMethod.gloss = value;\n\t}\n\n\t/**\n\t * The strength of the ambient reflection.\n\t */\n\tpublic get ambient():number\n\t{\n\t\treturn this._ambientMethod.ambient;\n\t}\n\n\tpublic set ambient(value:number)\n\t{\n\t\tthis._ambientMethod.ambient = value;\n\t}\n\n\t/**\n\t * The overall strength of the specular reflection.\n\t */\n\tpublic get specular():number\n\t{\n\t\treturn this._specularMethod.specular;\n\t}\n\n\tpublic set specular(value:number)\n\t{\n\t\tthis._specularMethod.specular = value;\n\t}\n\n\t/**\n\t * The colour of the ambient reflection.\n\t */\n\tpublic get ambientColor():number\n\t{\n\t\treturn this._diffuseMethod.ambientColor;\n\t}\n\n\tpublic set ambientColor(value:number)\n\t{\n\t\tthis._diffuseMethod.ambientColor = value;\n\t}\n\n\t/**\n\t * The colour of the diffuse reflection.\n\t */\n\tpublic get diffuseColor():number\n\t{\n\t\treturn this._diffuseMethod.diffuseColor;\n\t}\n\n\tpublic set diffuseColor(value:number)\n\t{\n\t\tthis._diffuseMethod.diffuseColor = value;\n\t}\n\n\t/**\n\t * The colour of the specular reflection.\n\t */\n\tpublic get specularColor():number\n\t{\n\t\treturn this._specularMethod.specularColor;\n\t}\n\n\tpublic set specularColor(value:number)\n\t{\n\t\tthis._specularMethod.specularColor = value;\n\t}\n\n\t/**\n\t *\n\t * @param renderer\n\t *\n\t * @internal\n\t */\n\tpublic getRenderObject(renderablePool:MethodRenderablePool):IRenderObject\n\t{\n\t\treturn renderablePool.getMethodRenderObject(this);\n\t}\n}\n\nexport = MethodMaterial;","import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\nimport Matrix\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport AbstractMethodError\t\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport BlendMode\t\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport IRenderObjectOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport StaticLightPicker\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/StaticLightPicker\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLCompareMode\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\n\nimport RendererBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\nimport RenderObjectPool\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\nimport ShadingMethodEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/ShadingMethodEvent\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport RenderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport IRenderableClass\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\n\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\nimport MethodPassMode\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/passes/MethodPassMode\");\nimport MethodPass\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/passes/MethodPass\");\nimport AmbientBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/AmbientBasicMethod\");\nimport DiffuseBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod\");\nimport EffectColorTransformMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod\");\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\nimport LightingMethodBase\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/LightingMethodBase\");\nimport NormalBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/NormalBasicMethod\");\nimport ShadowMapMethodBase\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase\");\nimport SpecularBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularBasicMethod\");\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\n\n/**\n * CompiledPass forms an abstract base class for the default compiled pass materials provided by Away3D,\n * using material methods to define their appearance.\n */\nclass RenderMethodMaterialObject extends RenderObjectBase\n{\n\t/**\n\t *\n\t */\n\tpublic static id:string = \"method\";\n\n\tprivate _material:MethodMaterial;\n\tprivate _screenPass:MethodPass;\n\tprivate _casterLightPass:MethodPass;\n\tprivate _nonCasterLightPasses:Array<MethodPass>;\n\t\n\t/**\n\t * The maximum total number of lights provided by the light picker.\n\t */\n\tprivate get numLights():number\n\t{\n\t\treturn this._material.lightPicker? this._material.lightPicker.numLightProbes + this._material.lightPicker.numDirectionalLights + this._material.lightPicker.numPointLights + this._material.lightPicker.numCastingDirectionalLights + this._material.lightPicker.numCastingPointLights : 0;\n\t}\n\n\t/**\n\t * The amount of lights that don't cast shadows.\n\t */\n\tprivate get numNonCasters():number\n\t{\n\t\treturn this._material.lightPicker? this._material.lightPicker.numLightProbes + this._material.lightPicker.numDirectionalLights + this._material.lightPicker.numPointLights : 0;\n\t}\n\n\t/**\n\t * Creates a new CompiledPass object.\n\t *\n\t * @param material The material to which this pass belongs.\n\t */\n\tconstructor(pool:RenderObjectPool, material:MethodMaterial, renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tsuper(pool, material, renderableClass, stage);\n\n\t\tthis._material = material;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdateRenderObject()\n\t{\n\t\tsuper._pUpdateRenderObject();\n\n\t\tthis.initPasses();\n\n\t\tthis.setBlendAndCompareModes();\n\n\t\tthis._pClearScreenPasses();\n\n\t\tif (this._material.mode == MethodMaterialMode.MULTI_PASS) {\n\t\t\tif (this._casterLightPass)\n\t\t\t\tthis._pAddScreenPass(this._casterLightPass);\n\n\t\t\tif (this._nonCasterLightPasses)\n\t\t\t\tfor (var i:number = 0; i < this._nonCasterLightPasses.length; ++i)\n\t\t\t\t\tthis._pAddScreenPass(this._nonCasterLightPasses[i]);\n\t\t}\n\n\t\tif (this._screenPass)\n\t\t\tthis._pAddScreenPass(this._screenPass);\n\t}\n\n\t/**\n\t * Initializes all the passes and their dependent passes.\n\t */\n\tprivate initPasses()\n\t{\n\t\t// let the effects pass handle everything if there are no lights, when there are effect methods applied\n\t\t// after shading, or when the material mode is single pass.\n\t\tif (this.numLights == 0 || this._material.numEffectMethods > 0 || this._material.mode == MethodMaterialMode.SINGLE_PASS)\n\t\t\tthis.initEffectPass();\n\t\telse if (this._screenPass)\n\t\t\tthis.removeEffectPass();\n\n\t\t// only use a caster light pass if shadows need to be rendered\n\t\tif (this._material.shadowMethod && this._material.mode == MethodMaterialMode.MULTI_PASS)\n\t\t\tthis.initCasterLightPass();\n\t\telse if (this._casterLightPass)\n\t\t\tthis.removeCasterLightPass();\n\n\t\t// only use non caster light passes if there are lights that don't cast\n\t\tif (this.numNonCasters > 0 && this._material.mode == MethodMaterialMode.MULTI_PASS)\n\t\t\tthis.initNonCasterLightPasses();\n\t\telse if (this._nonCasterLightPasses)\n\t\t\tthis.removeNonCasterLightPasses();\n\t}\n\n\t/**\n\t * Sets up the various blending modes for all screen passes, based on whether or not there are previous passes.\n\t */\n\tprivate setBlendAndCompareModes()\n\t{\n\t\tvar forceSeparateMVP:boolean = Boolean(this._casterLightPass || this._screenPass);\n\n\t\t// caster light pass is always first if it exists, hence it uses normal blending\n\t\tif (this._casterLightPass) {\n\t\t\tthis._casterLightPass.forceSeparateMVP = forceSeparateMVP;\n\t\t\tthis._casterLightPass.setBlendMode(BlendMode.NORMAL);\n\t\t\tthis._casterLightPass.depthCompareMode = this._material.depthCompareMode;\n\t\t}\n\n\t\tif (this._nonCasterLightPasses) {\n\t\t\tvar firstAdditiveIndex:number = 0;\n\n\t\t\t// if there's no caster light pass, the first non caster light pass will be the first\n\t\t\t// and should use normal blending\n\t\t\tif (!this._casterLightPass) {\n\t\t\t\tthis._nonCasterLightPasses[0].forceSeparateMVP = forceSeparateMVP;\n\t\t\t\tthis._nonCasterLightPasses[0].setBlendMode(BlendMode.NORMAL);\n\t\t\t\tthis._nonCasterLightPasses[0].depthCompareMode = this._material.depthCompareMode;\n\t\t\t\tfirstAdditiveIndex = 1;\n\t\t\t}\n\n\t\t\t// all lighting passes following the first light pass should use additive blending\n\t\t\tfor (var i:number = firstAdditiveIndex; i < this._nonCasterLightPasses.length; ++i) {\n\t\t\t\tthis._nonCasterLightPasses[i].forceSeparateMVP = forceSeparateMVP;\n\t\t\t\tthis._nonCasterLightPasses[i].setBlendMode(BlendMode.ADD);\n\t\t\t\tthis._nonCasterLightPasses[i].depthCompareMode = ContextGLCompareMode.LESS_EQUAL;\n\t\t\t}\n\t\t}\n\n\t\tif (this._casterLightPass || this._nonCasterLightPasses) {\n\t\t\t//cannot be blended by blendmode property if multipass enabled\n\t\t\tthis._pRequiresBlending = false;\n\n\t\t\t// there are light passes, so this should be blended in\n\t\t\tif (this._screenPass) {\n\t\t\t\tthis._screenPass.mode = MethodPassMode.EFFECTS;\n\t\t\t\tthis._screenPass.depthCompareMode = ContextGLCompareMode.LESS_EQUAL;\n\t\t\t\tthis._screenPass.setBlendMode(BlendMode.LAYER);\n\t\t\t\tthis._screenPass.forceSeparateMVP = forceSeparateMVP;\n\t\t\t}\n\n\t\t} else if (this._screenPass) {\n\t\t\tthis._pRequiresBlending = (this._material.blendMode != BlendMode.NORMAL || this._material.alphaBlending || (this._material.colorTransform && this._material.colorTransform.alphaMultiplier < 1));\n\t\t\t// effects pass is the only pass, so it should just blend normally\n\t\t\tthis._screenPass.mode = MethodPassMode.SUPER_SHADER;\n\t\t\tthis._screenPass.depthCompareMode = this._material.depthCompareMode;\n\t\t\tthis._screenPass.preserveAlpha = this._pRequiresBlending;\n\t\t\tthis._screenPass.colorTransform = this._material.colorTransform;\n\t\t\tthis._screenPass.setBlendMode((this._material.blendMode == BlendMode.NORMAL && this._pRequiresBlending)? BlendMode.LAYER : this._material.blendMode);\n\t\t\tthis._screenPass.forceSeparateMVP = false;\n\t\t}\n\t}\n\n\tprivate initCasterLightPass()\n\t{\n\n\t\tif (this._casterLightPass == null)\n\t\t\tthis._casterLightPass = new MethodPass(MethodPassMode.LIGHTING, this, this._material, this._renderableClass, this._stage);\n\n\t\tthis._casterLightPass.lightPicker = new StaticLightPicker([this._material.shadowMethod.castingLight]);\n\t\tthis._casterLightPass.shadowMethod = this._material.shadowMethod;\n\t\tthis._casterLightPass.diffuseMethod = this._material.diffuseMethod;\n\t\tthis._casterLightPass.ambientMethod = this._material.ambientMethod;\n\t\tthis._casterLightPass.normalMethod = this._material.normalMethod;\n\t\tthis._casterLightPass.specularMethod = this._material.specularMethod;\n\t}\n\n\tprivate removeCasterLightPass()\n\t{\n\t\tthis._casterLightPass.dispose();\n\t\tthis._pRemoveScreenPass(this._casterLightPass);\n\t\tthis._casterLightPass = null;\n\t}\n\n\tprivate initNonCasterLightPasses()\n\t{\n\t\tthis.removeNonCasterLightPasses();\n\t\tvar pass:MethodPass;\n\t\tvar numDirLights:number = this._material.lightPicker.numDirectionalLights;\n\t\tvar numPointLights:number = this._material.lightPicker.numPointLights;\n\t\tvar numLightProbes:number = this._material.lightPicker.numLightProbes;\n\t\tvar dirLightOffset:number = 0;\n\t\tvar pointLightOffset:number = 0;\n\t\tvar probeOffset:number = 0;\n\n\t\tif (!this._casterLightPass) {\n\t\t\tnumDirLights += this._material.lightPicker.numCastingDirectionalLights;\n\t\t\tnumPointLights += this._material.lightPicker.numCastingPointLights;\n\t\t}\n\n\t\tthis._nonCasterLightPasses = new Array<MethodPass>();\n\n\t\twhile (dirLightOffset < numDirLights || pointLightOffset < numPointLights || probeOffset < numLightProbes) {\n\t\t\tpass = new MethodPass(MethodPassMode.LIGHTING, this, this._material, this._renderableClass, this._stage);\n\t\t\tpass.includeCasters = this._material.shadowMethod == null;\n\t\t\tpass.directionalLightsOffset = dirLightOffset;\n\t\t\tpass.pointLightsOffset = pointLightOffset;\n\t\t\tpass.lightProbesOffset = probeOffset;\n\t\t\tpass.lightPicker = this._material.lightPicker;\n\t\t\tpass.diffuseMethod = this._material.diffuseMethod;\n\t\t\tpass.ambientMethod = this._material.ambientMethod;\n\t\t\tpass.normalMethod = this._material.normalMethod;\n\t\t\tpass.specularMethod = this._material.specularMethod;\n\t\t\tthis._nonCasterLightPasses.push(pass);\n\n\t\t\tdirLightOffset += pass.numDirectionalLights;\n\t\t\tpointLightOffset += pass.numPointLights;\n\t\t\tprobeOffset += pass.numLightProbes;\n\t\t}\n\t}\n\n\tprivate removeNonCasterLightPasses()\n\t{\n\t\tif (!this._nonCasterLightPasses)\n\t\t\treturn;\n\n\t\tfor (var i:number = 0; i < this._nonCasterLightPasses.length; ++i)\n\t\t\tthis._pRemoveScreenPass(this._nonCasterLightPasses[i]);\n\n\t\tthis._nonCasterLightPasses = null;\n\t}\n\n\tprivate removeEffectPass()\n\t{\n\t\tif (this._screenPass.ambientMethod != this._material.ambientMethod)\n\t\t\tthis._screenPass.ambientMethod.dispose();\n\n\t\tif (this._screenPass.diffuseMethod != this._material.diffuseMethod)\n\t\t\tthis._screenPass.diffuseMethod.dispose();\n\n\t\tif (this._screenPass.specularMethod != this._material.specularMethod)\n\t\t\tthis._screenPass.specularMethod.dispose();\n\n\t\tif (this._screenPass.normalMethod != this._material.normalMethod)\n\t\t\tthis._screenPass.normalMethod.dispose();\n\n\t\tthis._pRemoveScreenPass(this._screenPass);\n\t\tthis._screenPass = null;\n\t}\n\n\tprivate initEffectPass()\n\t{\n\t\tif (this._screenPass == null)\n\t\t\tthis._screenPass = new MethodPass(MethodPassMode.SUPER_SHADER, this, this._material, this._renderableClass, this._stage);\n\n\t\tif (this._material.mode == MethodMaterialMode.SINGLE_PASS) {\n\t\t\tthis._screenPass.ambientMethod = this._material.ambientMethod;\n\t\t\tthis._screenPass.diffuseMethod = this._material.diffuseMethod;\n\t\t\tthis._screenPass.specularMethod = this._material.specularMethod;\n\t\t\tthis._screenPass.normalMethod = this._material.normalMethod;\n\t\t\tthis._screenPass.shadowMethod = this._material.shadowMethod;\n\t\t} else if (this._material.mode == MethodMaterialMode.MULTI_PASS) {\n\t\t\tif (this.numLights == 0) {\n\t\t\t\tthis._screenPass.ambientMethod = this._material.ambientMethod;\n\t\t\t} else {\n\t\t\t\tthis._screenPass.ambientMethod = null;\n\t\t\t}\n\n\t\t\tthis._screenPass.preserveAlpha = false;\n\t\t\tthis._screenPass.normalMethod = this._material.normalMethod;\n\t\t}\n\n\t\t//update effect methods\n\t\tvar i:number = 0;\n\t\tvar effectMethod:EffectMethodBase;\n\t\tvar len:number = Math.max(this._material.numEffectMethods, this._screenPass.numEffectMethods);\n\n\t\twhile (i < len) {\n\t\t\teffectMethod = this._material.getEffectMethodAt(i);\n\t\t\tif (effectMethod != this._screenPass.getEffectMethodAt(i)) {\n\t\t\t\tthis._screenPass.removeEffectMethodAt(i);\n\n\t\t\t\tif (effectMethod != null) {\n\t\t\t\t\tif (i < this._screenPass.numEffectMethods)\n\t\t\t\t\t\tthis._screenPass.addEffectMethodAt(effectMethod, i);\n\t\t\t\t\telse\n\t\t\t\t\t\tthis._screenPass.addEffectMethod(effectMethod);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ti++;\n\t\t}\n\t}\n\t\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\tsuper.dispose();\n\n\t\t//TODO\n\t}\n}\n\nexport = RenderMethodMaterialObject;","import ShadingMethodBase\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadingMethodBase\");\n\n/**\n * MethodVO contains data for a given shader object for the use within a single material.\n * This allows shader methods to be shared across materials while their non-public state differs.\n */\nclass MethodVO\n{\n\tpublic useMethod:boolean = true;\n\n\tpublic method:ShadingMethodBase;\n\n\t// public register indices\n\tpublic texturesIndex:number;\n\tpublic secondaryTexturesIndex:number; // sometimes needed for composites\n\tpublic vertexConstantsIndex:number;\n\tpublic secondaryVertexConstantsIndex:number; // sometimes needed for composites\n\tpublic fragmentConstantsIndex:number;\n\tpublic secondaryFragmentConstantsIndex:number; // sometimes needed for composites\n\n\t// internal stuff for the material to know before assembling code\n\tpublic needsProjection:boolean;\n\tpublic needsView:boolean;\n\tpublic needsNormals:boolean;\n\tpublic needsTangents:boolean;\n\tpublic needsUV:boolean;\n\tpublic needsSecondaryUV:boolean;\n\tpublic needsGlobalVertexPos:boolean;\n\tpublic needsGlobalFragmentPos:boolean;\n\n\tpublic usesTexture:boolean;\n\n\t/**\n\t * Creates a new MethodVO object.\n\t */\n\tconstructor(method:ShadingMethodBase)\n\t{\n\t\tthis.method = method;\n\t}\n\n\t/**\n\t * Resets the values of the value object to their \"unused\" state.\n\t */\n\tpublic reset()\n\t{\n\t\tthis.method.iReset();\n\n\t\tthis.texturesIndex = -1;\n\t\tthis.vertexConstantsIndex = -1;\n\t\tthis.fragmentConstantsIndex = -1;\n\n\t\tthis.needsProjection = false;\n\t\tthis.needsView = false;\n\t\tthis.needsNormals = false;\n\t\tthis.needsTangents = false;\n\t\tthis.needsUV = false;\n\t\tthis.needsSecondaryUV = false;\n\t\tthis.needsGlobalVertexPos = false;\n\t\tthis.needsGlobalFragmentPos = false;\n\t}\n}\n\nexport = MethodVO;\n","import Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport ShadingMethodBase\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadingMethodBase\");\n\n/**\n * AmbientBasicMethod provides the default shading method for uniform ambient lighting.\n */\nclass AmbientBasicMethod extends ShadingMethodBase\n{\n\tprivate _color:number = 0xffffff;\n\tprivate _alpha:number = 1;\n\n\tprivate _colorR:number = 1;\n\tprivate _colorG:number = 1;\n\tprivate _colorB:number = 1;\n\n\tprivate _ambient:number = 1;\n\n\t/**\n\t * Creates a new AmbientBasicMethod object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tmethodVO.needsUV = Boolean(shaderObject.texture != null);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tif (!methodVO.needsUV) {\n\t\t\tthis._color = shaderObject.color;\n\t\t\tthis.updateColor();\n\t\t}\n\t}\n\n\t/**\n\t * The strength of the ambient reflection of the surface.\n\t */\n\tpublic get ambient():number\n\t{\n\t\treturn this._ambient;\n\t}\n\n\tpublic set ambient(value:number)\n\t{\n\t\tif (this._ambient == value)\n\t\t\treturn;\n\n\t\tthis._ambient = value;\n\n\t\tthis.updateColor();\n\t}\n\n\t/**\n\t * The alpha component of the surface.\n\t */\n\tpublic get alpha():number\n\t{\n\t\treturn this._alpha;\n\t}\n\n\tpublic set alpha(value:number)\n\t{\n\t\tif (this._alpha == value)\n\t\t\treturn;\n\n\t\tthis._alpha = value;\n\n\t\tthis.updateColor();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic copyFrom(method:ShadingMethodBase)\n\t{\n\t\tvar m:any = method;\n\t\tvar b:AmbientBasicMethod = <AmbientBasicMethod> m;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar ambientInputRegister:ShaderRegisterElement;\n\n\t\tif (methodVO.needsUV) {\n\t\t\tambientInputRegister = registerCache.getFreeTextureReg();\n\n\t\t\tmethodVO.texturesIndex = ambientInputRegister.index;\n\n\t\t\tcode += ShaderCompilerHelper.getTex2DSampleCode(targetReg, sharedRegisters, ambientInputRegister, shaderObject.texture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, false);\n\n\t\t\tif (shaderObject.alphaThreshold > 0) {\n\t\t\t\tvar cutOffReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\t\t\tmethodVO.fragmentConstantsIndex = cutOffReg.index*4;\n\n\t\t\t\tcode += \"sub \" + targetReg + \".w, \" + targetReg + \".w, \" + cutOffReg + \".x\\n\" +\n\t\t\t\t\t\"kil \" + targetReg + \".w\\n\" +\n\t\t\t\t\t\"add \" + targetReg + \".w, \" + targetReg + \".w, \" + cutOffReg + \".x\\n\";\n\t\t\t}\n\n\t\t} else {\n\t\t\tambientInputRegister = registerCache.getFreeFragmentConstant();\n\t\t\tmethodVO.fragmentConstantsIndex = ambientInputRegister.index*4;\n\n\t\t\tcode += \"mov \" + targetReg + \", \" + ambientInputRegister + \"\\n\";\n\t\t}\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tif (methodVO.needsUV) {\n\t\t\tstage.activateTexture(methodVO.texturesIndex, shaderObject.texture, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\n\t\t\tif (shaderObject.alphaThreshold > 0)\n\t\t\t\tshaderObject.fragmentConstantData[methodVO.fragmentConstantsIndex] = shaderObject.alphaThreshold;\n\t\t} else {\n\t\t\tvar index:number = methodVO.fragmentConstantsIndex;\n\t\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\t\tdata[index] = this._colorR;\n\t\t\tdata[index + 1] = this._colorG;\n\t\t\tdata[index + 2] = this._colorB;\n\t\t\tdata[index + 3] = this._alpha;\n\t\t}\n\t}\n\n\t/**\n\t * Updates the ambient color data used by the render state.\n\t */\n\tprivate updateColor()\n\t{\n\t\tthis._colorR = ((this._color >> 16) & 0xff)/0xff*this._ambient;\n\t\tthis._colorG = ((this._color >> 8) & 0xff)/0xff*this._ambient;\n\t\tthis._colorB = (this._color & 0xff)/0xff*this._ambient;\n\t}\n}\n\nexport = AmbientBasicMethod;","import CubeTextureBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport AmbientBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/AmbientBasicMethod\");\n\n/**\n * AmbientEnvMapMethod provides a diffuse shading method that uses a diffuse irradiance environment map to\n * approximate global lighting rather than lights.\n */\nclass AmbientEnvMapMethod extends AmbientBasicMethod\n{\n\tprivate _cubeTexture:CubeTextureBase;\n\t\n\t/**\n\t * Creates a new <code>AmbientEnvMapMethod</code> object.\n\t *\n\t * @param envMap The cube environment map to use for the ambient lighting.\n\t */\n\tconstructor(envMap:CubeTextureBase)\n\t{\n\t\tsuper();\n\t\tthis._cubeTexture = envMap;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tsuper.iInitVO(shaderObject, methodVO);\n\n\t\tmethodVO.needsNormals = true;\n\t}\n\t\n\t/**\n\t * The cube environment map to use for the diffuse lighting.\n\t */\n\tpublic get envMap():CubeTextureBase\n\t{\n\t\treturn this._cubeTexture;\n\t}\n\t\n\tpublic set envMap(value:CubeTextureBase)\n\t{\n\t\tthis._cubeTexture = value;\n\t}\n\t\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tsuper.iActivate(shaderObject, methodVO, stage);\n\n\t\tstage.activateCubeTexture(methodVO.texturesIndex, this._cubeTexture, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\t}\n\t\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar ambientInputRegister:ShaderRegisterElement;\n\t\tvar cubeMapReg:ShaderRegisterElement = regCache.getFreeTextureReg();\n\t\tmethodVO.texturesIndex = cubeMapReg.index;\n\t\t\n\t\tcode += ShaderCompilerHelper.getTexCubeSampleCode(targetReg, cubeMapReg, this._cubeTexture, shaderObject.useSmoothTextures, shaderObject.useMipmapping, sharedRegisters.normalFragment);\n\n\t\tambientInputRegister = regCache.getFreeFragmentConstant();\n\t\tmethodVO.fragmentConstantsIndex = ambientInputRegister.index;\n\t\t\n\t\tcode += \"add \" + targetReg + \".xyz, \" + targetReg + \".xyz, \" + ambientInputRegister + \".xyz\\n\";\n\t\t\n\t\treturn code;\n\t}\n}\n\nexport = AmbientEnvMapMethod;","import Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderLightingObject\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\nimport MethodVO\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport ShadingMethodBase\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadingMethodBase\");\nimport LightingMethodBase\t\t\t= require(\"awayjs-methodmaterials/lib/methods/LightingMethodBase\");\n\n/**\n * DiffuseBasicMethod provides the default shading method for Lambert (dot3) diffuse lighting.\n */\nclass DiffuseBasicMethod extends LightingMethodBase\n{\n\tprivate _multiply:boolean = true;\n\n\tpublic _pUseTexture:boolean;\n\tpublic _pTotalLightColorReg:ShaderRegisterElement;\n\tpublic _pDiffuseInputRegister:ShaderRegisterElement;\n\n\tprivate _texture:Texture2DBase;\n\tprivate _diffuseColor:number = 0xffffff;\n\tprivate _ambientColor:number = 0xffffff;\n\tprivate _diffuseR:number = 1;\n\tprivate _diffuseG:number = 1;\n\tprivate _diffuseB:number = 1;\n\tprivate _ambientR:number = 1;\n\tprivate _ambientG:number = 1;\n\tprivate _ambientB:number = 1;\n\n\tpublic _pIsFirstLight:boolean;\n\n\t/**\n\t * Creates a new DiffuseBasicMethod object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\tpublic iIsUsed(shaderObject:ShaderLightingObject):boolean\n\t{\n\t\tif (!shaderObject.numLights)\n\t\t\treturn false;\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Set internally if diffuse color component multiplies or replaces the ambient color\n\t */\n\tpublic get multiply():boolean\n\t{\n\t\treturn this._multiply;\n\t}\n\n\tpublic set multiply(value:boolean)\n\t{\n\t\tif (this._multiply == value)\n\t\t\treturn;\n\n\t\tthis._multiply = value;\n\n\t\tthis.iInvalidateShaderProgram();\n\t}\n\n\tpublic iInitVO(shaderObject:ShaderLightingObject, methodVO:MethodVO)\n\t{\n\t\tmethodVO.needsUV = this._pUseTexture;\n\t\tmethodVO.needsNormals = shaderObject.numLights > 0;\n\t}\n\n\t/**\n\t * Forces the creation of the texture's mipmaps.\n\t * @param stage The Stage used by the renderer\n\t */\n\tpublic generateMip(stage:Stage)\n\t{\n\t\tif (this._pUseTexture)\n\t\t\tstage.activateTexture(0, this._texture, true, true, true);\n\t}\n\n\t/**\n\t * The color of the diffuse reflection when not using a texture.\n\t */\n\tpublic get diffuseColor():number\n\t{\n\t\treturn this._diffuseColor;\n\t}\n\n\tpublic set diffuseColor(value:number)\n\t{\n\t\tif (this._diffuseColor == value)\n\t\t\treturn;\n\n\t\tthis._diffuseColor = value;\n\n\t\tthis.updateDiffuse();\n\t}\n\n\t/**\n\t * The color of the ambient reflection\n\t */\n\tpublic get ambientColor():number\n\t{\n\t\treturn this._ambientColor;\n\t}\n\n\tpublic set ambientColor(value:number)\n\t{\n\t\tif (this._ambientColor == value)\n\t\t\treturn;\n\n\t\tthis._ambientColor = value;\n\n\t\tthis.updateAmbient();\n\t}\n\n\n\t/**\n\t * The bitmapData to use to define the diffuse reflection color per texel.\n\t */\n\tpublic get texture():Texture2DBase\n\t{\n\t\treturn this._texture;\n\t}\n\n\tpublic set texture(value:Texture2DBase)\n\t{\n\t\tvar b:boolean = (value != null);\n\n\t\tif (b != this._pUseTexture || (value && this._texture && (value.format != this._texture.format)))\n\t\t\tthis.iInvalidateShaderProgram();\n\n\t\tthis._pUseTexture = b;\n\t\tthis._texture = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._texture = null;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic copyFrom(method:ShadingMethodBase)\n\t{\n\t\tvar diff:DiffuseBasicMethod = <DiffuseBasicMethod> method;\n\n\t\tthis.texture = diff.texture;\n\t\tthis.multiply = diff.multiply;\n\t\tthis.diffuseColor = diff.diffuseColor;\n\t\tthis.ambientColor = diff.ambientColor;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iCleanCompilationData()\n\t{\n\t\tsuper.iCleanCompilationData();\n\n\t\tthis._pTotalLightColorReg = null;\n\t\tthis._pDiffuseInputRegister = null;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPreLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\n\t\tthis._pIsFirstLight = true;\n\n\t\tthis._pTotalLightColorReg = registerCache.getFreeFragmentVectorTemp();\n\t\tregisterCache.addFragmentTempUsages(this._pTotalLightColorReg, 1);\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCodePerLight(shaderObject:ShaderLightingObject, methodVO:MethodVO, lightDirReg:ShaderRegisterElement, lightColReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar t:ShaderRegisterElement;\n\n\t\t// write in temporary if not first light, so we can add to total diffuse colour\n\t\tif (this._pIsFirstLight) {\n\t\t\tt = this._pTotalLightColorReg;\n\t\t} else {\n\t\t\tt = registerCache.getFreeFragmentVectorTemp();\n\t\t\tregisterCache.addFragmentTempUsages(t, 1);\n\t\t}\n\n\t\tcode += \"dp3 \" + t + \".x, \" + lightDirReg + \", \" + sharedRegisters.normalFragment + \"\\n\" +\n\t\t\t\t\"max \" + t + \".w, \" + t + \".x, \" + sharedRegisters.commons + \".y\\n\";\n\n\t\tif (shaderObject.usesLightFallOff)\n\t\t\tcode += \"mul \" + t + \".w, \" + t + \".w, \" + lightDirReg + \".w\\n\";\n\n\t\tif (this._iModulateMethod != null)\n\t\t\tcode += this._iModulateMethod(shaderObject, methodVO, t, registerCache, sharedRegisters);\n\n\t\tcode += \"mul \" + t + \", \" + t + \".w, \" + lightColReg + \"\\n\";\n\n\t\tif (!this._pIsFirstLight) {\n\t\t\tcode += \"add \" + this._pTotalLightColorReg + \".xyz, \" + this._pTotalLightColorReg + \", \" + t + \"\\n\";\n\t\t\tregisterCache.removeFragmentTempUsage(t);\n\t\t}\n\n\t\tthis._pIsFirstLight = false;\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCodePerProbe(shaderObject:ShaderLightingObject, methodVO:MethodVO, cubeMapReg:ShaderRegisterElement, weightRegister:string, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar t:ShaderRegisterElement;\n\n\t\t// write in temporary if not first light, so we can add to total diffuse colour\n\t\tif (this._pIsFirstLight) {\n\t\t\tt = this._pTotalLightColorReg;\n\t\t} else {\n\t\t\tt = registerCache.getFreeFragmentVectorTemp();\n\t\t\tregisterCache.addFragmentTempUsages(t, 1);\n\t\t}\n\n\t\tcode += \"tex \" + t + \", \" + sharedRegisters.normalFragment + \", \" + cubeMapReg + \" <cube,linear,miplinear>\\n\" +\n\t\t\t\t\"mul \" + t + \".xyz, \" + t + \".xyz, \" + weightRegister + \"\\n\";\n\n\t\tif (this._iModulateMethod != null)\n\t\t\tcode += this._iModulateMethod(shaderObject, methodVO, t, registerCache, sharedRegisters);\n\n\t\tif (!this._pIsFirstLight) {\n\t\t\tcode += \"add \" + this._pTotalLightColorReg + \".xyz, \" + this._pTotalLightColorReg + \", \" + t + \"\\n\";\n\t\t\tregisterCache.removeFragmentTempUsage(t);\n\t\t}\n\n\t\tthis._pIsFirstLight = false;\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPostLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\n\t\tvar albedo:ShaderRegisterElement;\n\t\tvar cutOffReg:ShaderRegisterElement;\n\n\t\t// incorporate input from ambient\n\t\tif (sharedRegisters.shadowTarget)\n\t\t\tcode += this.pApplyShadow(shaderObject, methodVO, registerCache, sharedRegisters);\n\n\t\talbedo = registerCache.getFreeFragmentVectorTemp();\n\t\tregisterCache.addFragmentTempUsages(albedo, 1);\n\n\t\tvar ambientColorRegister:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tmethodVO.fragmentConstantsIndex = ambientColorRegister.index*4;\n\n\t\tif (this._pUseTexture) {\n\t\t\tthis._pDiffuseInputRegister = registerCache.getFreeTextureReg();\n\n\t\t\tmethodVO.texturesIndex = this._pDiffuseInputRegister.index;\n\n\t\t\tcode += ShaderCompilerHelper.getTex2DSampleCode(albedo, sharedRegisters, this._pDiffuseInputRegister, this._texture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping);\n\n\t\t} else {\n\t\t\tthis._pDiffuseInputRegister = registerCache.getFreeFragmentConstant();\n\n\t\t\tcode += \"mov \" + albedo + \", \" + this._pDiffuseInputRegister + \"\\n\";\n\t\t}\n\n\t\tcode += \"sat \" + this._pTotalLightColorReg + \", \" + this._pTotalLightColorReg + \"\\n\" +\n\t\t\t\"mul \" + albedo + \".xyz, \" + albedo + \", \" + this._pTotalLightColorReg + \"\\n\";\n\n\t\tif (this._multiply) {\n\t\t\tcode += \"add \" + albedo + \".xyz, \" + albedo + \", \" + ambientColorRegister + \"\\n\" +\n\t\t\t\t\"mul \" + targetReg + \".xyz, \" + targetReg + \", \" + albedo + \"\\n\";\n\t\t} else {\n\t\t\tcode += \"mul \" + targetReg + \".xyz, \" + targetReg + \", \" + ambientColorRegister + \"\\n\" +\n\t\t\t\t\"mul \" + this._pTotalLightColorReg + \".xyz, \" + targetReg + \", \" + this._pTotalLightColorReg + \"\\n\" +\n\t\t\t\t\"sub \" + targetReg + \".xyz, \" + targetReg + \", \" + this._pTotalLightColorReg + \"\\n\" +\n\t\t\t\t\"add \" + targetReg + \".xyz, \" + targetReg + \", \" + albedo + \"\\n\";\n\t\t}\n\n\t\tregisterCache.removeFragmentTempUsage(this._pTotalLightColorReg);\n\t\tregisterCache.removeFragmentTempUsage(albedo);\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * Generate the code that applies the calculated shadow to the diffuse light\n\t * @param methodVO The MethodVO object for which the compilation is currently happening.\n\t * @param regCache The register cache the compiler is currently using for the register management.\n\t */\n\tpublic pApplyShadow(shaderObject:ShaderLightingObject, methodVO:MethodVO, regCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"mul \" + this._pTotalLightColorReg + \".xyz, \" + this._pTotalLightColorReg + \", \" + sharedRegisters.shadowTarget + \".w\\n\";\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderLightingObject, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tif (this._pUseTexture) {\n\t\t\tstage.activateTexture(methodVO.texturesIndex, this._texture, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\t\t} else {\n\t\t\tvar index:number = methodVO.fragmentConstantsIndex;\n\t\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\t\tdata[index + 4] = this._diffuseR;\n\t\t\tdata[index + 5] = this._diffuseG;\n\t\t\tdata[index + 6] = this._diffuseB;\n\t\t\tdata[index + 7] = 1;\n\t\t}\n\t}\n\n\t/**\n\t * Updates the diffuse color data used by the render state.\n\t */\n\tprivate updateDiffuse()\n\t{\n\t\tthis._diffuseR = ((this._diffuseColor >> 16) & 0xff)/0xff;\n\t\tthis._diffuseG = ((this._diffuseColor >> 8) & 0xff)/0xff;\n\t\tthis._diffuseB = (this._diffuseColor & 0xff)/0xff;\n\t}\n\n\t/**\n\t * Updates the ambient color data used by the render state.\n\t */\n\tprivate updateAmbient()\n\t{\n\t\tthis._ambientR = ((this._ambientColor >> 16) & 0xff)/0xff;\n\t\tthis._ambientG = ((this._ambientColor >> 8) & 0xff)/0xff;\n\t\tthis._ambientB = (this._ambientColor & 0xff)/0xff;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iSetRenderState(shaderObject:ShaderLightingObject, methodVO:MethodVO, renderable:RenderableBase, stage:Stage, camera:Camera)\n\t{\n\t\t//TODO move this to Activate (ambientR/G/B currently calc'd in render state)\n\t\tif (shaderObject.numLights > 0) {\n\t\t\tvar index:number = methodVO.fragmentConstantsIndex;\n\t\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\t\tdata[index] = shaderObject.ambientR*this._ambientR;\n\t\t\tdata[index + 1] = shaderObject.ambientG*this._ambientG;\n\t\t\tdata[index + 2] = shaderObject.ambientB*this._ambientB;\n\t\t\tdata[index + 3] = 1;\n\t\t}\n\t}\n}\n\nexport = DiffuseBasicMethod;","import Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport DiffuseBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod\");\nimport DiffuseCompositeMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod\");\n\n/**\n * DiffuseCelMethod provides a shading method to add diffuse cel (cartoon) shading.\n */\nclass DiffuseCelMethod extends DiffuseCompositeMethod\n{\n\tprivate _levels:number /*uint*/;\n\tprivate _dataReg:ShaderRegisterElement;\n\tprivate _smoothness:number = .1;\n\n\t/**\n\t * Creates a new DiffuseCelMethod object.\n\t * @param levels The amount of shadow gradations.\n\t * @param baseMethod An optional diffuse method on which the cartoon shading is based. If omitted, DiffuseBasicMethod is used.\n\t */\n\tconstructor(levels:number /*uint*/ = 3, baseMethod:DiffuseBasicMethod = null)\n\t{\n\t\tsuper(null, baseMethod);\n\n\t\tthis.baseMethod._iModulateMethod = (shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData) => this.clampDiffuse(shaderObject, methodVO, targetReg, registerCache, sharedRegisters);\n\n\t\tthis._levels = levels;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderLightingObject, methodVO:MethodVO)\n\t{\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number /*int*/ = methodVO.secondaryFragmentConstantsIndex;\n\t\tsuper.iInitConstants(shaderObject, methodVO);\n\t\tdata[index + 1] = 1;\n\t\tdata[index + 2] = 0;\n\t}\n\n\t/**\n\t * The amount of shadow gradations.\n\t */\n\tpublic get levels():number /*uint*/\n\t{\n\t\treturn this._levels;\n\t}\n\n\tpublic set levels(value:number /*uint*/)\n\t{\n\t\tthis._levels = value;\n\t}\n\n\t/**\n\t * The smoothness of the edge between 2 shading levels.\n\t */\n\tpublic get smoothness():number\n\t{\n\t\treturn this._smoothness;\n\t}\n\n\tpublic set smoothness(value:number)\n\t{\n\t\tthis._smoothness = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iCleanCompilationData()\n\t{\n\t\tsuper.iCleanCompilationData();\n\t\tthis._dataReg = null;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPreLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tthis._dataReg = registerCache.getFreeFragmentConstant();\n\t\tmethodVO.secondaryFragmentConstantsIndex = this._dataReg.index*4;\n\n\t\treturn super.iGetFragmentPreLightingCode(shaderObject, methodVO, registerCache, sharedRegisters);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderLightingObject, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tsuper.iActivate(shaderObject, methodVO, stage);\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number /*int*/ = methodVO.secondaryFragmentConstantsIndex;\n\t\tdata[index] = this._levels;\n\t\tdata[index + 3] = this._smoothness;\n\t}\n\n\t/**\n\t * Snaps the diffuse shading of the wrapped method to one of the levels.\n\t * @param vo The MethodVO used to compile the current shader.\n\t * @param t The register containing the diffuse strength in the \"w\" component.\n\t * @param regCache The register cache used for the shader compilation.\n\t * @param sharedRegisters The shared register data for this shader.\n\t * @return The AGAL fragment code for the method.\n\t */\n\tprivate clampDiffuse(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"mul \" + targetReg + \".w, \" + targetReg + \".w, \" + this._dataReg + \".x\\n\" +\n\t\t\t\"frc \" + targetReg + \".z, \" + targetReg + \".w\\n\" +\n\t\t\t\"sub \" + targetReg + \".y, \" + targetReg + \".w, \" + targetReg + \".z\\n\" +\n\t\t\t\"mov \" + targetReg + \".x, \" + this._dataReg + \".x\\n\" +\n\t\t\t\"sub \" + targetReg + \".x, \" + targetReg + \".x, \" + this._dataReg + \".y\\n\" +\n\t\t\t\"rcp \" + targetReg + \".x,\" + targetReg + \".x\\n\" +\n\t\t\t\"mul \" + targetReg + \".w, \" + targetReg + \".y, \" + targetReg + \".x\\n\" +\n\n\t\t\t// previous clamped strength\n\t\t\t\"sub \" + targetReg + \".y, \" + targetReg + \".w, \" + targetReg + \".x\\n\" +\n\n\t\t\t// fract/epsilon (so 0 - epsilon will become 0 - 1)\n\t\t\t\"div \" + targetReg + \".z, \" + targetReg + \".z, \" + this._dataReg + \".w\\n\" +\n\t\t\t\"sat \" + targetReg + \".z, \" + targetReg + \".z\\n\" +\n\n\t\t\t\"mul \" + targetReg + \".w, \" + targetReg + \".w, \" + targetReg + \".z\\n\" +\n\t\t\t// 1-z\n\t\t\t\"sub \" + targetReg + \".z, \" + this._dataReg + \".y, \" + targetReg + \".z\\n\" +\n\t\t\t\"mul \" + targetReg + \".y, \" + targetReg + \".y, \" + targetReg + \".z\\n\" +\n\t\t\t\"add \" + targetReg + \".w, \" + targetReg + \".w, \" + targetReg + \".y\\n\" +\n\t\t\t\"sat \" + targetReg + \".w, \" + targetReg + \".w\\n\";\n\t}\n}\n\nexport = DiffuseCelMethod;","import Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShadingMethodEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/ShadingMethodEvent\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport DiffuseBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod\");\n\n/**\n * DiffuseCompositeMethod provides a base class for diffuse methods that wrap a diffuse method to alter the\n * calculated diffuse reflection strength.\n */\nclass DiffuseCompositeMethod extends DiffuseBasicMethod\n{\n\tpublic pBaseMethod:DiffuseBasicMethod;\n\n\tprivate _onShaderInvalidatedDelegate:Function;\n\n\t/**\n\t * Creates a new <code>DiffuseCompositeMethod</code> object.\n\t *\n\t * @param modulateMethod The method which will add the code to alter the base method's strength. It needs to have the signature clampDiffuse(t:ShaderRegisterElement, regCache:ShaderRegisterCache):string, in which t.w will contain the diffuse strength.\n\t * @param baseMethod The base diffuse method on which this method's shading is based.\n\t */\n\tconstructor(modulateMethod:(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData) => string, baseMethod:DiffuseBasicMethod = null)\n\t{\n\t\tsuper();\n\n\t\tthis._onShaderInvalidatedDelegate = (event:ShadingMethodEvent) => this.onShaderInvalidated(event);\n\n\t\tthis.pBaseMethod = baseMethod || new DiffuseBasicMethod();\n\t\tthis.pBaseMethod._iModulateMethod = modulateMethod;\n\t\tthis.pBaseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, this._onShaderInvalidatedDelegate);\n\t}\n\n\t/**\n\t * The base diffuse method on which this method's shading is based.\n\t */\n\tpublic get baseMethod():DiffuseBasicMethod\n\t{\n\t\treturn this.pBaseMethod;\n\t}\n\n\tpublic set baseMethod(value:DiffuseBasicMethod)\n\t{\n\t\tif (this.pBaseMethod == value)\n\t\t\treturn;\n\n\t\tthis.pBaseMethod.removeEventListener(ShadingMethodEvent.SHADER_INVALIDATED, this._onShaderInvalidatedDelegate);\n\t\tthis.pBaseMethod = value;\n\t\tthis.pBaseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, this._onShaderInvalidatedDelegate);\n\t\tthis.iInvalidateShaderProgram();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderLightingObject, methodVO:MethodVO)\n\t{\n\t\tthis.pBaseMethod.iInitVO(shaderObject, methodVO);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderLightingObject, methodVO:MethodVO)\n\t{\n\t\tthis.pBaseMethod.iInitConstants(shaderObject, methodVO);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\tthis.pBaseMethod.removeEventListener(ShadingMethodEvent.SHADER_INVALIDATED, this._onShaderInvalidatedDelegate);\n\t\tthis.pBaseMethod.dispose();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get texture():Texture2DBase\n\t{\n\t\treturn this.pBaseMethod.texture;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic set texture(value:Texture2DBase)\n\t{\n\t\tthis.pBaseMethod.texture = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get diffuseColor():number\n\t{\n\t\treturn this.pBaseMethod.diffuseColor;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic set diffuseColor(value:number)\n\t{\n\t\tthis.pBaseMethod.diffuseColor = value;\n\t}\n\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get ambientColor():number\n\t{\n\t\treturn this.pBaseMethod.ambientColor;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic set ambientColor(value:number)\n\t{\n\t\tthis.pBaseMethod.ambientColor = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPreLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn this.pBaseMethod.iGetFragmentPreLightingCode(shaderObject, methodVO, registerCache, sharedRegisters);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCodePerLight(shaderObject:ShaderLightingObject, methodVO:MethodVO, lightDirReg:ShaderRegisterElement, lightColReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = this.pBaseMethod.iGetFragmentCodePerLight(shaderObject, methodVO, lightDirReg, lightColReg, registerCache, sharedRegisters);\n\t\tthis._pTotalLightColorReg = this.pBaseMethod._pTotalLightColorReg;\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCodePerProbe(shaderObject:ShaderLightingObject, methodVO:MethodVO, cubeMapReg:ShaderRegisterElement, weightRegister:string, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = this.pBaseMethod.iGetFragmentCodePerProbe(shaderObject, methodVO, cubeMapReg, weightRegister, registerCache, sharedRegisters);\n\t\tthis._pTotalLightColorReg = this.pBaseMethod._pTotalLightColorReg;\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderLightingObject, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tthis.pBaseMethod.iActivate(shaderObject, methodVO, stage);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iSetRenderState(shaderObject:ShaderLightingObject, methodVO:MethodVO, renderable:RenderableBase, stage:Stage, camera:Camera)\n\t{\n\t\tthis.pBaseMethod.iSetRenderState(shaderObject, methodVO, renderable, stage, camera);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iDeactivate(shaderObject:ShaderLightingObject, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tthis.pBaseMethod.iDeactivate(shaderObject, methodVO, stage);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetVertexCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn this.pBaseMethod.iGetVertexCode(shaderObject, methodVO, registerCache, sharedRegisters);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPostLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn this.pBaseMethod.iGetFragmentPostLightingCode(shaderObject, methodVO, targetReg, registerCache, sharedRegisters);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iReset()\n\t{\n\t\tthis.pBaseMethod.iReset();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iCleanCompilationData()\n\t{\n\t\tsuper.iCleanCompilationData();\n\t\tthis.pBaseMethod.iCleanCompilationData();\n\t}\n\n\t/**\n\t * Called when the base method's shader code is invalidated.\n\t */\n\tprivate onShaderInvalidated(event:ShadingMethodEvent)\n\t{\n\t\tthis.iInvalidateShaderProgram();\n\t}\n}\n\nexport = DiffuseCompositeMethod;","import ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport DiffuseBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod\");\n\n/**\n * DiffuseDepthMethod provides a debug method to visualise depth maps\n */\nclass DiffuseDepthMethod extends DiffuseBasicMethod\n{\n\t/**\n\t * Creates a new DiffuseBasicMethod object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number /*int*/ = methodVO.fragmentConstantsIndex;\n\t\tdata[index] = 1.0;\n\t\tdata[index + 1] = 1/255.0;\n\t\tdata[index + 2] = 1/65025.0;\n\t\tdata[index + 3] = 1/16581375.0;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPostLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar temp:ShaderRegisterElement;\n\t\tvar decReg:ShaderRegisterElement;\n\n\t\tif (!this._pUseTexture)\n\t\t\tthrow new Error(\"DiffuseDepthMethod requires texture!\");\n\n\t\t// incorporate input from ambient\n\t\tif (shaderObject.numLights > 0) {\n\t\t\tif (sharedRegisters.shadowTarget)\n\t\t\t\tcode += \"mul \" + this._pTotalLightColorReg + \".xyz, \" + this._pTotalLightColorReg + \".xyz, \" + sharedRegisters.shadowTarget + \".w\\n\";\n\t\t\tcode += \"add \" + targetReg + \".xyz, \" + this._pTotalLightColorReg + \".xyz, \" + targetReg + \".xyz\\n\" +\n\t\t\t\t\"sat \" + targetReg + \".xyz, \" + targetReg + \".xyz\\n\";\n\t\t\tregisterCache.removeFragmentTempUsage(this._pTotalLightColorReg);\n\t\t}\n\n\t\ttemp = shaderObject.numLights > 0? registerCache.getFreeFragmentVectorTemp():targetReg;\n\n\t\tthis._pDiffuseInputRegister = registerCache.getFreeTextureReg();\n\t\tmethodVO.texturesIndex = this._pDiffuseInputRegister.index;\n\t\tdecReg = registerCache.getFreeFragmentConstant();\n\t\tmethodVO.fragmentConstantsIndex = decReg.index*4;\n\t\tcode += ShaderCompilerHelper.getTex2DSampleCode(temp, sharedRegisters, this._pDiffuseInputRegister, this.texture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping) +\n\t\t\t\"dp4 \" + temp + \".x, \" + temp + \", \" + decReg + \"\\n\" +\n\t\t\t\"mov \" + temp + \".yz, \" + temp + \".xx\t\t\t\\n\" +\n\t\t\t\"mov \" + temp + \".w, \" + decReg + \".x\\n\" +\n\t\t\t\"sub \" + temp + \".xyz, \" + decReg + \".xxx, \" + temp + \".xyz\\n\";\n\n\t\tif (shaderObject.numLights == 0)\n\t\t\treturn code;\n\n\t\tcode += \"mul \" + targetReg + \".xyz, \" + temp + \".xyz, \" + targetReg + \".xyz\\n\" +\n\t\t\t\"mov \" + targetReg + \".w, \" + temp + \".w\\n\";\n\n\t\treturn code;\n\t}\n}\n\nexport = DiffuseDepthMethod;","import Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport DiffuseBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod\");\n\n/**\n * DiffuseGradientMethod is an alternative to DiffuseBasicMethod in which the shading can be modulated with a gradient\n * to introduce color-tinted shading as opposed to the single-channel diffuse strength. This can be used as a crude\n * approximation to subsurface scattering (for instance, the mid-range shading for skin can be tinted red to similate\n * scattered light within the skin attributing to the final colour)\n */\nclass DiffuseGradientMethod extends DiffuseBasicMethod\n{\n\tprivate _gradientTextureRegister:ShaderRegisterElement;\n\tprivate _gradient:Texture2DBase;\n\n\t/**\n\t * Creates a new DiffuseGradientMethod object.\n\t * @param gradient A texture that contains the light colour based on the angle. This can be used to change\n\t * the light colour due to subsurface scattering when the surface faces away from the light.\n\t */\n\tconstructor(gradient:Texture2DBase)\n\t{\n\t\tsuper();\n\n\t\tthis._gradient = gradient;\n\t}\n\n\t/**\n\t * A texture that contains the light colour based on the angle. This can be used to change the light colour\n\t * due to subsurface scattering when the surface faces away from the light.\n\t */\n\tpublic get gradient():Texture2DBase\n\t{\n\t\treturn this._gradient;\n\t}\n\n\tpublic set gradient(value:Texture2DBase)\n\t{\n\t\tif (value.format != this._gradient.format)\n\t\t\tthis.iInvalidateShaderProgram();\n\t\tthis._gradient = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iCleanCompilationData()\n\t{\n\t\tsuper.iCleanCompilationData();\n\t\tthis._gradientTextureRegister = null;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPreLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = super.iGetFragmentPreLightingCode(shaderObject, methodVO, registerCache, sharedRegisters);\n\t\tthis._pIsFirstLight = true;\n\n\t\tif (shaderObject.numLights > 0) {\n\t\t\tthis._gradientTextureRegister = registerCache.getFreeTextureReg();\n\t\t\tmethodVO.secondaryTexturesIndex = this._gradientTextureRegister.index;\n\t\t}\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCodePerLight(shaderObject:ShaderLightingObject, methodVO:MethodVO, lightDirReg:ShaderRegisterElement, lightColReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar t:ShaderRegisterElement;\n\n\t\t// write in temporary if not first light, so we can add to total diffuse colour\n\t\tif (this._pIsFirstLight)\n\t\t\tt = this._pTotalLightColorReg;\n\t\telse {\n\t\t\tt = registerCache.getFreeFragmentVectorTemp();\n\t\t\tregisterCache.addFragmentTempUsages(t, 1);\n\t\t}\n\n\t\tcode += \"dp3 \" + t + \".w, \" + lightDirReg + \".xyz, \" + sharedRegisters.normalFragment + \".xyz\\n\" +\n\t\t\t\"mul \" + t + \".w, \" + t + \".w, \" + sharedRegisters.commons + \".x\\n\" +\n\t\t\t\"add \" + t + \".w, \" + t + \".w, \" + sharedRegisters.commons + \".x\\n\" +\n\t\t\t\"mul \" + t + \".xyz, \" + t + \".w, \" + lightDirReg + \".w\\n\";\n\n\t\tif (this._iModulateMethod != null)\n\t\t\tcode += this._iModulateMethod(shaderObject, methodVO, t, registerCache, sharedRegisters);\n\n\t\tcode += ShaderCompilerHelper.getTex2DSampleCode(t, sharedRegisters, this._gradientTextureRegister, this._gradient, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping, t, \"clamp\") +\n\t\t\t//\t\t\t\t\t\"mul \" + t + \".xyz, \" + t + \".xyz, \" + t + \".w\\n\" +\n\t\t\t\"mul \" + t + \".xyz, \" + t + \".xyz, \" + lightColReg + \".xyz\\n\";\n\n\t\tif (!this._pIsFirstLight) {\n\t\t\tcode += \"add \" + this._pTotalLightColorReg + \".xyz, \" + this._pTotalLightColorReg + \".xyz, \" + t + \".xyz\\n\";\n\t\t\tregisterCache.removeFragmentTempUsage(t);\n\t\t}\n\n\t\tthis._pIsFirstLight = false;\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic pApplyShadow(shaderObject:ShaderLightingObject, methodVO:MethodVO, regCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar t:ShaderRegisterElement = regCache.getFreeFragmentVectorTemp();\n\n\t\treturn \"mov \" + t + \", \" + sharedRegisters.shadowTarget + \".wwww\\n\" +\n\t\t\tShaderCompilerHelper.getTex2DSampleCode(t, sharedRegisters, this._gradientTextureRegister, this._gradient, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping, t, \"clamp\") +\n\t\t\t\"mul \" + this._pTotalLightColorReg + \".xyz, \" + this._pTotalLightColorReg + \", \" + t + \"\\n\";\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderLightingObject, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tsuper.iActivate(shaderObject, methodVO, stage);\n\n\t\tstage.activateTexture(methodVO.secondaryTexturesIndex, this._gradient, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\t}\n}\n\nexport = DiffuseGradientMethod;","import Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport DiffuseBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod\");\nimport DiffuseCompositeMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod\");\n\n/**\n * DiffuseLightMapMethod provides a diffuse shading method that uses a light map to modulate the calculated diffuse\n * lighting. It is different from EffectLightMapMethod in that the latter modulates the entire calculated pixel color, rather\n * than only the diffuse lighting value.\n */\nclass DiffuseLightMapMethod extends DiffuseCompositeMethod\n{\n\t/**\n\t * Indicates the light map should be multiplied with the calculated shading result.\n\t * This can be used to add pre-calculated shadows or occlusion.\n\t */\n\tpublic static MULTIPLY:string = \"multiply\";\n\n\t/**\n\t * Indicates the light map should be added into the calculated shading result.\n\t * This can be used to add pre-calculated lighting or global illumination.\n\t */\n\tpublic static ADD:string = \"add\";\n\n\tprivate _lightMapTexture:Texture2DBase;\n\tprivate _blendMode:string;\n\tprivate _useSecondaryUV:boolean;\n\n\t/**\n\t * Creates a new DiffuseLightMapMethod method.\n\t *\n\t * @param lightMap The texture containing the light map.\n\t * @param blendMode The blend mode with which the light map should be applied to the lighting result.\n\t * @param useSecondaryUV Indicates whether the secondary UV set should be used to map the light map.\n\t * @param baseMethod The diffuse method used to calculate the regular diffuse-based lighting.\n\t */\n\tconstructor(lightMap:Texture2DBase, blendMode:string = \"multiply\", useSecondaryUV:boolean = false, baseMethod:DiffuseBasicMethod = null)\n\t{\n\t\tsuper(null, baseMethod);\n\n\t\tthis._useSecondaryUV = useSecondaryUV;\n\t\tthis._lightMapTexture = lightMap;\n\t\tthis.blendMode = blendMode;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderLightingObject, methodVO:MethodVO)\n\t{\n\t\tmethodVO.needsSecondaryUV = this._useSecondaryUV;\n\t\tmethodVO.needsUV = !this._useSecondaryUV;\n\t}\n\n\t/**\n\t * The blend mode with which the light map should be applied to the lighting result.\n\t *\n\t * @see DiffuseLightMapMethod.ADD\n\t * @see DiffuseLightMapMethod.MULTIPLY\n\t */\n\tpublic get blendMode():string\n\t{\n\t\treturn this._blendMode;\n\t}\n\n\tpublic set blendMode(value:string)\n\t{\n\t\tif (value != DiffuseLightMapMethod.ADD && value != DiffuseLightMapMethod.MULTIPLY)\n\t\t\tthrow new Error(\"Unknown blendmode!\");\n\n\t\tif (this._blendMode == value)\n\t\t\treturn;\n\n\t\tthis._blendMode = value;\n\n\t\tthis.iInvalidateShaderProgram();\n\t}\n\n\t/**\n\t * The texture containing the light map data.\n\t */\n\tpublic get lightMapTexture():Texture2DBase\n\t{\n\t\treturn this._lightMapTexture;\n\t}\n\n\tpublic set lightMapTexture(value:Texture2DBase)\n\t{\n\t\tthis._lightMapTexture = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderLightingObject, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tstage.activateTexture(methodVO.secondaryTexturesIndex, this._lightMapTexture, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\n\t\tsuper.iActivate(shaderObject, methodVO, stage);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPostLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string;\n\t\tvar lightMapReg:ShaderRegisterElement = registerCache.getFreeTextureReg();\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tmethodVO.secondaryTexturesIndex = lightMapReg.index;\n\n\t\tcode = ShaderCompilerHelper.getTex2DSampleCode(temp, sharedRegisters, lightMapReg, this._lightMapTexture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping, sharedRegisters.secondaryUVVarying);\n\n\t\tswitch (this._blendMode) {\n\t\t\tcase DiffuseLightMapMethod.MULTIPLY:\n\t\t\t\tcode += \"mul \" + this._pTotalLightColorReg + \", \" + this._pTotalLightColorReg + \", \" + temp + \"\\n\";\n\t\t\t\tbreak;\n\t\t\tcase DiffuseLightMapMethod.ADD:\n\t\t\t\tcode += \"add \" + this._pTotalLightColorReg + \", \" + this._pTotalLightColorReg + \", \" + temp + \"\\n\";\n\t\t\t\tbreak;\n\t\t}\n\n\t\tcode += super.iGetFragmentPostLightingCode(shaderObject, methodVO, targetReg, registerCache, sharedRegisters);\n\n\t\treturn code;\n\t}\n}\n\nexport = DiffuseLightMapMethod;","import Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport DiffuseBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod\");\nimport DiffuseCompositeMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod\");\nimport SingleObjectDepthPass\t\t\t= require(\"awayjs-methodmaterials/lib/passes/SingleObjectDepthPass\");\n\n/**\n * DiffuseSubSurfaceMethod provides a depth map-based diffuse shading method that mimics the scattering of\n * light inside translucent surfaces. It allows light to shine through an object and to soften the diffuse shading.\n * It can be used for candle wax, ice, skin, ...\n */\nclass DiffuseSubSurfaceMethod extends DiffuseCompositeMethod\n{\n\tprivate _depthPass:SingleObjectDepthPass;\n\tprivate _lightProjVarying:ShaderRegisterElement;\n\tprivate _propReg:ShaderRegisterElement;\n\tprivate _scattering:number;\n\tprivate _translucency:number = 1;\n\tprivate _lightColorReg:ShaderRegisterElement;\n\tprivate _scatterColor:number /*uint*/ = 0xffffff;\n\tprivate _colorReg:ShaderRegisterElement;\n\tprivate _decReg:ShaderRegisterElement;\n\tprivate _scatterR:number = 1.0;\n\tprivate _scatterG:number = 1.0;\n\tprivate _scatterB:number = 1.0;\n\tprivate _targetReg:ShaderRegisterElement;\n\t\n\t/**\n\t * Creates a new <code>DiffuseSubSurfaceMethod</code> object.\n\t *\n\t * @param depthMapSize The size of the depth map used.\n\t * @param depthMapOffset The amount by which the rendered object will be inflated, to prevent depth map rounding errors.\n\t * @param baseMethod The diffuse method used to calculate the regular diffuse-based lighting.\n\t */\n\tconstructor(depthMapSize:number /*int*/ = 512, depthMapOffset:number = 15, baseMethod:DiffuseBasicMethod = null)\n\t{\n\t\tsuper(null, baseMethod);\n\n\t\tthis.pBaseMethod._iModulateMethod = (shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData) => this.scatterLight(shaderObject, methodVO, targetReg, registerCache, sharedRegisters);\n\n\t\t//this._passes = new Array<MaterialPassGLBase>();\n\t\t//this._depthPass = new SingleObjectDepthPass();\n\t\t//this._depthPass.textureSize = depthMapSize;\n\t\t//this._depthPass.polyOffset = depthMapOffset;\n\t\t//this._passes.push(this._depthPass);\n\t\tthis._scattering = 0.2;\n\t\tthis._translucency = 1;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderLightingObject, methodVO:MethodVO)\n\t{\n\t\tsuper.iInitConstants(shaderObject, methodVO);\n\n\t\tvar data:Array<number> = shaderObject.vertexConstantData;\n\t\tvar index:number /*int*/ = methodVO.secondaryVertexConstantsIndex;\n\t\tdata[index] = .5;\n\t\tdata[index + 1] = -.5;\n\t\tdata[index + 2] = 0;\n\t\tdata[index + 3] = 1;\n\t\t\n\t\tdata = shaderObject.fragmentConstantData;\n\t\tindex = methodVO.secondaryFragmentConstantsIndex;\n\t\tdata[index + 3] = 1.0;\n\t\tdata[index + 4] = 1.0;\n\t\tdata[index + 5] = 1/255;\n\t\tdata[index + 6] = 1/65025;\n\t\tdata[index + 7] = 1/16581375;\n\t\tdata[index + 10] = .5;\n\t\tdata[index + 11] = -.1;\n\t}\n\t\n\tpublic iCleanCompilationData()\n\t{\n\t\tsuper.iCleanCompilationData();\n\n\t\tthis._lightProjVarying = null;\n\t\tthis._propReg = null;\n\t\tthis._lightColorReg = null;\n\t\tthis._colorReg = null;\n\t\tthis._decReg = null;\n\t\tthis._targetReg = null;\n\t}\n\t\n\t/**\n\t * The amount by which the light scatters. It can be used to set the translucent surface's thickness. Use low\n\t * values for skin.\n\t */\n\tpublic get scattering():number\n\t{\n\t\treturn this._scattering;\n\t}\n\t\n\tpublic set scattering(value:number)\n\t{\n\t\tthis._scattering = value;\n\t}\n\t\n\t/**\n\t * The translucency of the object.\n\t */\n\tpublic get translucency():number\n\t{\n\t\treturn this._translucency;\n\t}\n\t\n\tpublic set translucency(value:number)\n\t{\n\t\tthis._translucency = value;\n\t}\n\t\n\t/**\n\t * The colour of the \"insides\" of the object, ie: the colour the light becomes after leaving the object.\n\t */\n\tpublic get scatterColor():number /*uint*/\n\t{\n\t\treturn this._scatterColor;\n\t}\n\t\n\tpublic set scatterColor(scatterColor:number /*uint*/)\n\t{\n\t\tthis._scatterColor = scatterColor;\n\t\tthis._scatterR = ((scatterColor >> 16) & 0xff)/0xff;\n\t\tthis._scatterG = ((scatterColor >> 8) & 0xff)/0xff;\n\t\tthis._scatterB = (scatterColor & 0xff)/0xff;\n\t}\n\t\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetVertexCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = super.iGetVertexCode(shaderObject, methodVO, registerCache, sharedRegisters);\n\t\tvar lightProjection:ShaderRegisterElement;\n\t\tvar toTexRegister:ShaderRegisterElement;\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeVertexVectorTemp();\n\t\t\n\t\ttoTexRegister = registerCache.getFreeVertexConstant();\n\t\tmethodVO.secondaryVertexConstantsIndex = toTexRegister.index*4;\n\n\t\tthis._lightProjVarying = registerCache.getFreeVarying();\n\t\tlightProjection = registerCache.getFreeVertexConstant();\n\t\tregisterCache.getFreeVertexConstant();\n\t\tregisterCache.getFreeVertexConstant();\n\t\tregisterCache.getFreeVertexConstant();\n\t\t\n\t\tcode += \"m44 \" + temp + \", vt0, \" + lightProjection + \"\\n\" +\n\t\t\t\"div \" + temp + \".xyz, \" + temp + \".xyz, \" + temp + \".w\\n\" +\n\t\t\t\"mul \" + temp + \".xy, \" + temp + \".xy, \" + toTexRegister + \".xy\\n\" +\n\t\t\t\"add \" + temp + \".xy, \" + temp + \".xy, \" + toTexRegister + \".xx\\n\" +\n\t\t\t\"mov \" + this._lightProjVarying + \".xyz, \" + temp + \".xyz\\n\" +\n\t\t\t\"mov \" + this._lightProjVarying + \".w, va0.w\\n\";\n\t\t\n\t\treturn code;\n\t}\n\t\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPreLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tthis._colorReg = registerCache.getFreeFragmentConstant();\n\t\tthis._decReg = registerCache.getFreeFragmentConstant();\n\t\tthis._propReg = registerCache.getFreeFragmentConstant();\n\t\tmethodVO.secondaryFragmentConstantsIndex = this._colorReg.index*4;\n\t\t\n\t\treturn super.iGetFragmentPreLightingCode(shaderObject, methodVO, registerCache, sharedRegisters);\n\t}\n\t\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCodePerLight(shaderObject:ShaderLightingObject, methodVO:MethodVO, lightDirReg:ShaderRegisterElement, lightColReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tthis._pIsFirstLight = true;\n\t\tthis._lightColorReg = lightColReg;\n\t\treturn super.iGetFragmentCodePerLight(shaderObject, methodVO, lightDirReg, lightColReg, registerCache, sharedRegisters);\n\t}\n\t\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPostLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = super.iGetFragmentPostLightingCode(shaderObject, methodVO, targetReg, registerCache, sharedRegisters);\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\t\n\t\tcode += \"mul \" + temp + \".xyz, \" + this._lightColorReg + \".xyz, \" + this._targetReg + \".w\\n\" +\n\t\t\t\"mul \" + temp + \".xyz, \" + temp + \".xyz, \" + this._colorReg + \".xyz\\n\" +\n\t\t\t\"add \" + targetReg + \".xyz, \" + targetReg + \".xyz, \" + temp + \".xyz\\n\";\n\t\t\n\t\tif (this._targetReg != sharedRegisters.viewDirFragment)\n\t\t\tregisterCache.removeFragmentTempUsage(targetReg);\n\t\t\n\t\treturn code;\n\t}\n\t\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderLightingObject, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tsuper.iActivate(shaderObject, methodVO, stage);\n\t\t\n\t\tvar index:number /*int*/ = methodVO.secondaryFragmentConstantsIndex;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tdata[index] = this._scatterR;\n\t\tdata[index + 1] = this._scatterG;\n\t\tdata[index + 2] = this._scatterB;\n\t\tdata[index + 8] = this._scattering;\n\t\tdata[index + 9] = this._translucency;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iSetRenderState(shaderObject:ShaderObjectBase, methodVO:MethodVO, renderable:RenderableBase, stage:Stage, camera:Camera)\n\t{\n\t\tstage.activateTexture(methodVO.secondaryTexturesIndex, this._depthPass._iGetDepthMap(renderable), shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\n\t\tthis._depthPass._iGetProjection(renderable).copyRawDataTo(shaderObject.vertexConstantData, methodVO.secondaryVertexConstantsIndex + 4, true);\n\t}\n\t\n\t/**\n\t * Generates the code for this method\n\t */\n\tprivate scatterLight(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\t// only scatter first light\n\t\tif (!this._pIsFirstLight)\n\t\t\treturn \"\";\n\n\t\tthis._pIsFirstLight = false;\n\n\t\tvar code:string = \"\";\n\t\tvar depthReg:ShaderRegisterElement = registerCache.getFreeTextureReg();\n\n\t\tif (sharedRegisters.viewDirFragment) {\n\t\t\tthis._targetReg = sharedRegisters.viewDirFragment;\n\t\t} else {\n\t\t\tthis._targetReg = registerCache.getFreeFragmentVectorTemp();\n\t\t\tregisterCache.addFragmentTempUsages(this._targetReg, 1);\n\t\t}\n\n\t\tmethodVO.secondaryTexturesIndex = depthReg.index;\n\t\t\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tcode += \"tex \" + temp + \", \" + this._lightProjVarying + \", \" + depthReg + \" <2d,nearest,clamp>\\n\" +\n\t\t\t// reencode RGBA\n\t\t\t\"dp4 \" + targetReg + \".z, \" + temp + \", \" + this._decReg + \"\\n\";\n\t\t// currentDistanceToLight - closestDistanceToLight\n\t\tcode += \"sub \" + targetReg + \".z, \" + this._lightProjVarying + \".z, \" + targetReg + \".z\\n\" +\n\t\t\t\n\t\t\t\"sub \" + targetReg + \".z, \" + this._propReg + \".x, \" + targetReg + \".z\\n\" +\n\t\t\t\"mul \" + targetReg + \".z, \" + this._propReg + \".y, \" + targetReg + \".z\\n\" +\n\t\t\t\"sat \" + targetReg + \".z, \" + targetReg + \".z\\n\" +\n\t\t\t\n\t\t\t// targetReg.x contains dot(lightDir, normal)\n\t\t\t// modulate according to incident light angle (scatter = scatter*(-.5*dot(light, normal) + .5)\n\t\t\t\"neg \" + targetReg + \".y, \" + targetReg + \".x\\n\" +\n\t\t\t\"mul \" + targetReg + \".y, \" + targetReg + \".y, \" + this._propReg + \".z\\n\" +\n\t\t\t\"add \" + targetReg + \".y, \" + targetReg + \".y, \" + this._propReg + \".z\\n\" +\n\t\t\t\"mul \" + this._targetReg + \".w, \" + targetReg + \".z, \" + targetReg + \".y\\n\" +\n\t\t\t\n\t\t\t// blend diffuse: d' = (1-s)*d + s*1\n\t\t\t\"sub \" + targetReg + \".y, \" + this._colorReg + \".w, \" + this._targetReg + \".w\\n\" +\n\t\t\t\"mul \" + targetReg + \".w, \" + targetReg + \".w, \" + targetReg + \".y\\n\";\n\t\t\n\t\treturn code;\n\t}\n}\n\nexport = DiffuseSubSurfaceMethod;","import Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport DiffuseBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod\");\n\n/**\n * DiffuseWrapMethod is an alternative to DiffuseBasicMethod in which the light is allowed to be \"wrapped around\" the normally dark area, to some extent.\n * It can be used as a crude approximation to Oren-Nayar or simple subsurface scattering.\n */\nclass DiffuseWrapMethod extends DiffuseBasicMethod\n{\n\tprivate _wrapDataRegister:ShaderRegisterElement;\n\tprivate _wrapFactor:number;\n\n\t/**\n\t * Creates a new DiffuseWrapMethod object.\n\t * @param wrapFactor A factor to indicate the amount by which the light is allowed to wrap\n\t */\n\tconstructor(wrapFactor:number = .5)\n\t{\n\t\tsuper();\n\n\t\tthis.wrapFactor = wrapFactor;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iCleanCompilationData()\n\t{\n\t\tsuper.iCleanCompilationData();\n\n\t\tthis._wrapDataRegister = null;\n\t}\n\n\t/**\n\t * A factor to indicate the amount by which the light is allowed to wrap.\n\t */\n\tpublic get wrapFactor():number\n\t{\n\t\treturn this._wrapFactor;\n\t}\n\n\tpublic set wrapFactor(value:number)\n\t{\n\t\tthis._wrapFactor = value;\n\t\tthis._wrapFactor = 1/(value + 1);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPreLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = super.iGetFragmentPreLightingCode(shaderObject, methodVO, registerCache, sharedRegisters);\n\t\tthis._pIsFirstLight = true;\n\t\tthis._wrapDataRegister = registerCache.getFreeFragmentConstant();\n\t\tmethodVO.secondaryFragmentConstantsIndex = this._wrapDataRegister.index*4;\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCodePerLight(shaderObject:ShaderLightingObject, methodVO:MethodVO, lightDirReg:ShaderRegisterElement, lightColReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar t:ShaderRegisterElement;\n\n\t\t// write in temporary if not first light, so we can add to total diffuse colour\n\t\tif (this._pIsFirstLight) {\n\t\t\tt = this._pTotalLightColorReg;\n\t\t} else {\n\t\t\tt = registerCache.getFreeFragmentVectorTemp();\n\t\t\tregisterCache.addFragmentTempUsages(t, 1);\n\t\t}\n\n\t\tcode += \"dp3 \" + t + \".x, \" + lightDirReg + \".xyz, \" + sharedRegisters.normalFragment + \".xyz\\n\" +\n\t\t\t\"add \" + t + \".y, \" + t + \".x, \" + this._wrapDataRegister + \".x\\n\" +\n\t\t\t\"mul \" + t + \".y, \" + t + \".y, \" + this._wrapDataRegister + \".y\\n\" +\n\t\t\t\"sat \" + t + \".w, \" + t + \".y\\n\" +\n\t\t\t\"mul \" + t + \".xz, \" + t + \".w, \" + lightDirReg + \".wz\\n\";\n\n\t\tif (this._iModulateMethod != null)\n\t\t\tcode += this._iModulateMethod(shaderObject, methodVO, lightDirReg, registerCache, sharedRegisters);\n\n\t\tcode += \"mul \" + t + \", \" + t + \".x, \" + lightColReg + \"\\n\";\n\n\t\tif (!this._pIsFirstLight) {\n\t\t\tcode += \"add \" + this._pTotalLightColorReg + \".xyz, \" + this._pTotalLightColorReg + \".xyz, \" + t + \".xyz\\n\";\n\t\t\tregisterCache.removeFragmentTempUsage(t);\n\t\t}\n\n\t\tthis._pIsFirstLight = false;\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderLightingObject, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tsuper.iActivate(shaderObject, methodVO, stage);\n\n\t\tvar index:number /*int*/ = methodVO.secondaryFragmentConstantsIndex;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tdata[index] = this._wrapFactor;\n\t\tdata[index + 1] = 1/(this._wrapFactor + 1);\n\t}\n}\n\nexport = DiffuseWrapMethod;","import Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\n\n/**\n * EffectAlphaMaskMethod allows the use of an additional texture to specify the alpha value of the material. When used\n * with the secondary uv set, it allows for a tiled main texture with independently varying alpha (useful for water\n * etc).\n */\nclass EffectAlphaMaskMethod extends EffectMethodBase\n{\n\tprivate _texture:Texture2DBase;\n\tprivate _useSecondaryUV:boolean;\n\n\t/**\n\t * Creates a new EffectAlphaMaskMethod object.\n\t *\n\t * @param texture The texture to use as the alpha mask.\n\t * @param useSecondaryUV Indicated whether or not the secondary uv set for the mask. This allows mapping alpha independently.\n\t */\n\tconstructor(texture:Texture2DBase, useSecondaryUV:boolean = false)\n\t{\n\t\tsuper();\n\n\t\tthis._texture = texture;\n\t\tthis._useSecondaryUV = useSecondaryUV;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tmethodVO.needsSecondaryUV = this._useSecondaryUV;\n\t\tmethodVO.needsUV = !this._useSecondaryUV;\n\t}\n\n\t/**\n\t * Indicated whether or not the secondary uv set for the mask. This allows mapping alpha independently, for\n\t * instance to tile the main texture and normal map while providing untiled alpha, for example to define the\n\t * transparency over a tiled water surface.\n\t */\n\tpublic get useSecondaryUV():boolean\n\t{\n\t\treturn this._useSecondaryUV;\n\t}\n\n\tpublic set useSecondaryUV(value:boolean)\n\t{\n\t\tif (this._useSecondaryUV == value)\n\t\t\treturn;\n\t\tthis._useSecondaryUV = value;\n\t\tthis.iInvalidateShaderProgram();\n\t}\n\n\t/**\n\t * The texture to use as the alpha mask.\n\t */\n\tpublic get texture():Texture2DBase\n\t{\n\t\treturn this._texture;\n\t}\n\n\tpublic set texture(value:Texture2DBase)\n\t{\n\t\tthis._texture = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderLightingObject, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tstage.activateTexture(methodVO.texturesIndex, this._texture, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar textureReg:ShaderRegisterElement = registerCache.getFreeTextureReg();\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tvar uvReg:ShaderRegisterElement = this._useSecondaryUV? sharedRegisters.secondaryUVVarying : sharedRegisters.uvVarying;\n\t\tmethodVO.texturesIndex = textureReg.index;\n\n\t\treturn ShaderCompilerHelper.getTex2DSampleCode(temp, sharedRegisters, textureReg, this._texture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping, uvReg) +\n\t\t\t\"mul \" + targetReg + \", \" + targetReg + \", \" + temp + \".x\\n\";\n\t}\n}\n\nexport = EffectAlphaMaskMethod;","import Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\n\n/**\n * EffectColorMatrixMethod provides a shading method that changes the colour of a material analogous to a ColorMatrixFilter.\n */\nclass EffectColorMatrixMethod extends EffectMethodBase\n{\n\tprivate _matrix:Array<number>;\n\n\t/**\n\t * Creates a new EffectColorTransformMethod.\n\t *\n\t * @param matrix An array of 20 items for 4 x 5 color transform.\n\t */\n\tconstructor(matrix:Array<number>)\n\t{\n\t\tsuper();\n\n\t\tif (matrix.length != 20)\n\t\t\tthrow new Error(\"Matrix length must be 20!\");\n\n\t\tthis._matrix = matrix;\n\t}\n\n\t/**\n\t * The 4 x 5 matrix to transform the color of the material.\n\t */\n\tpublic get colorMatrix():Array<number>\n\t{\n\t\treturn this._matrix;\n\t}\n\n\tpublic set colorMatrix(value:Array<number>)\n\t{\n\t\tthis._matrix = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar colorMultReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tregisterCache.getFreeFragmentConstant();\n\t\tregisterCache.getFreeFragmentConstant();\n\t\tregisterCache.getFreeFragmentConstant();\n\n\t\tvar colorOffsetReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\n\t\tmethodVO.fragmentConstantsIndex = colorMultReg.index*4;\n\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\n\t\tcode += \"m44 \" + temp + \", \" + targetReg + \", \" + colorMultReg + \"\\n\" +\n\t\t\t\t\"add \" + targetReg + \", \" + temp + \", \" + colorOffsetReg + \"\\n\";\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tvar matrix:Array<number> = this._matrix;\n\t\tvar index:number /*int*/ = methodVO.fragmentConstantsIndex;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\n\t\t// r\n\t\tdata[index] = matrix[0];\n\t\tdata[index + 1] = matrix[1];\n\t\tdata[index + 2] = matrix[2];\n\t\tdata[index + 3] = matrix[3];\n\n\t\t// g\n\t\tdata[index + 4] = matrix[5];\n\t\tdata[index + 5] = matrix[6];\n\t\tdata[index + 6] = matrix[7];\n\t\tdata[index + 7] = matrix[8];\n\n\t\t// b\n\t\tdata[index + 8] = matrix[10];\n\t\tdata[index + 9] = matrix[11];\n\t\tdata[index + 10] = matrix[12];\n\t\tdata[index + 11] = matrix[13];\n\n\t\t// a\n\t\tdata[index + 12] = matrix[15];\n\t\tdata[index + 13] = matrix[16];\n\t\tdata[index + 14] = matrix[17];\n\t\tdata[index + 15] = matrix[18];\n\n\t\t// rgba offset\n\t\tdata[index + 16] = matrix[4];\n\t\tdata[index + 17] = matrix[9];\n\t\tdata[index + 18] = matrix[14];\n\t\tdata[index + 19] = matrix[19];\n\t}\n}\n\nexport = EffectColorMatrixMethod;","import ColorTransform\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport EffectMethodBase\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\n\n/**\n * EffectColorTransformMethod provides a shading method that changes the colour of a material analogous to a\n * ColorTransform object.\n */\nclass EffectColorTransformMethod extends EffectMethodBase\n{\n\tprivate _colorTransform:ColorTransform;\n\n\t/**\n\t * Creates a new EffectColorTransformMethod.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * The ColorTransform object to transform the colour of the material with.\n\t */\n\tpublic get colorTransform():ColorTransform\n\t{\n\t\treturn this._colorTransform;\n\t}\n\n\tpublic set colorTransform(value:ColorTransform)\n\t{\n\t\tthis._colorTransform = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar colorMultReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar colorOffsReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\n\t\tmethodVO.fragmentConstantsIndex = colorMultReg.index*4;\n\n\t\t//TODO: AGAL <> GLSL\n\n\t\tcode += \"mul \" + targetReg + \", \" + targetReg + \", \" + colorMultReg + \"\\n\" + \"add \" + targetReg + \", \" + targetReg + \", \" + colorOffsReg + \"\\n\";\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tvar inv:number = 1/0xff;\n\t\tvar index:number = methodVO.fragmentConstantsIndex;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\n\t\tdata[index] = this._colorTransform.redMultiplier;\n\t\tdata[index + 1] = this._colorTransform.greenMultiplier;\n\t\tdata[index + 2] = this._colorTransform.blueMultiplier;\n\t\tdata[index + 3] = this._colorTransform.alphaMultiplier;\n\t\tdata[index + 4] = this._colorTransform.redOffset*inv;\n\t\tdata[index + 5] = this._colorTransform.greenOffset*inv;\n\t\tdata[index + 6] = this._colorTransform.blueOffset*inv;\n\t\tdata[index + 7] = this._colorTransform.alphaOffset*inv;\n\n\t}\n}\n\nexport = EffectColorTransformMethod;","import CubeTextureBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\n\n/**\n * EffectEnvMapMethod provides a material method to perform reflection mapping using cube maps.\n */\nclass EffectEnvMapMethod extends EffectMethodBase\n{\n\tprivate _cubeTexture:CubeTextureBase;\n\tprivate _alpha:number;\n\tprivate _mask:Texture2DBase;\n\n\t/**\n\t * Creates an EffectEnvMapMethod object.\n\t * @param envMap The environment map containing the reflected scene.\n\t * @param alpha The reflectivity of the surface.\n\t */\n\tconstructor(envMap:CubeTextureBase, alpha:number = 1)\n\t{\n\t\tsuper();\n\t\tthis._cubeTexture = envMap;\n\t\tthis._alpha = alpha;\n\n\t}\n\n\t/**\n\t * An optional texture to modulate the reflectivity of the surface.\n\t */\n\tpublic get mask():Texture2DBase\n\t{\n\t\treturn this._mask;\n\t}\n\n\tpublic set mask(value:Texture2DBase)\n\t{\n\t\tif (value != this._mask || (value && this._mask && (value.format != this._mask.format)))\n\t\t\tthis.iInvalidateShaderProgram();\n\n\t\tthis._mask = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tmethodVO.needsNormals = true;\n\t\tmethodVO.needsView = true;\n\t\tmethodVO.needsUV = this._mask != null;\n\t}\n\n\t/**\n\t * The cubic environment map containing the reflected scene.\n\t */\n\tpublic get envMap():CubeTextureBase\n\t{\n\t\treturn this._cubeTexture;\n\t}\n\n\tpublic set envMap(value:CubeTextureBase)\n\t{\n\t\tthis._cubeTexture = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t}\n\n\t/**\n\t * The reflectivity of the surface.\n\t */\n\tpublic get alpha():number\n\t{\n\t\treturn this._alpha;\n\t}\n\n\tpublic set alpha(value:number)\n\t{\n\t\tthis._alpha = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tshaderObject.fragmentConstantData[methodVO.fragmentConstantsIndex] = this._alpha;\n\n\t\tstage.activateCubeTexture(methodVO.texturesIndex, this._cubeTexture, shaderObject.useSmoothTextures,shaderObject.useMipmapping);\n\n\t\tif (this._mask)\n\t\t\tstage.activateTexture(methodVO.texturesIndex + 1, this._mask,  shaderObject.repeatTextures, shaderObject.useSmoothTextures,shaderObject.useMipmapping);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar dataRegister:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tvar code:string = \"\";\n\t\tvar cubeMapReg:ShaderRegisterElement = registerCache.getFreeTextureReg();\n\n\t\tmethodVO.texturesIndex = cubeMapReg.index;\n\t\tmethodVO.fragmentConstantsIndex = dataRegister.index*4;\n\n\t\tregisterCache.addFragmentTempUsages(temp, 1);\n\t\tvar temp2:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\n\t\t// r = I - 2(I.N)*N\n\t\tcode += \"dp3 \" + temp + \".w, \" + sharedRegisters.viewDirFragment + \".xyz, \" + sharedRegisters.normalFragment + \".xyz\\n\" +\n\t\t\t\t\"add \" + temp + \".w, \" + temp + \".w, \" + temp + \".w\\n\" +\n\t\t\t\t\"mul \" + temp + \".xyz, \" + sharedRegisters.normalFragment + \".xyz, \" + temp + \".w\\n\" +\n\t\t\t\t\"sub \" + temp + \".xyz, \" + temp + \".xyz, \" + sharedRegisters.viewDirFragment + \".xyz\\n\" +\n\t\t\tShaderCompilerHelper.getTexCubeSampleCode(temp, cubeMapReg, this._cubeTexture, shaderObject.useSmoothTextures, shaderObject.useMipmapping, temp) +\n\t\t\t\t\"sub \" + temp2 + \".w, \" + temp + \".w, fc0.x\\n\" + // -.5\n\t\t\t\t\"kil \" + temp2 + \".w\\n\" +\t// used for real time reflection mapping - if alpha is not 1 (mock texture) kil output\n\t\t\t\t\"sub \" + temp + \", \" + temp + \", \" + targetReg + \"\\n\";\n\n\t\tif (this._mask)\n\t\t\tcode += ShaderCompilerHelper.getTex2DSampleCode(temp2, sharedRegisters, registerCache.getFreeTextureReg(), this._mask, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping) +\n\t\t\t\t\"mul \" + temp + \", \" + temp2 + \", \" + temp + \"\\n\";\n\n\t\tcode += \"mul \" + temp + \", \" + temp + \", \" + dataRegister + \".x\\n\" +\n\t\t\t\t\"add \" + targetReg + \", \" + targetReg + \", \" + temp + \"\\n\";\n\n\t\tregisterCache.removeFragmentTempUsage(temp);\n\n\t\treturn code;\n\t}\n}\n\nexport = EffectEnvMapMethod;","import Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\n\n/**\n * EffectFogMethod provides a method to add distance-based fog to a material.\n */\nclass EffectFogMethod extends EffectMethodBase\n{\n\tprivate _minDistance:number = 0;\n\tprivate _maxDistance:number = 1000;\n\tprivate _fogColor:number /*uint*/;\n\tprivate _fogR:number;\n\tprivate _fogG:number;\n\tprivate _fogB:number;\n\n\t/**\n\t * Creates a new EffectFogMethod object.\n\t * @param minDistance The distance from which the fog starts appearing.\n\t * @param maxDistance The distance at which the fog is densest.\n\t * @param fogColor The colour of the fog.\n\t */\n\tconstructor(minDistance:number, maxDistance:number, fogColor:number /*uint*/ = 0x808080)\n\t{\n\t\tsuper();\n\t\tthis.minDistance = minDistance;\n\t\tthis.maxDistance = maxDistance;\n\t\tthis.fogColor = fogColor;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderLightingObject, methodVO:MethodVO)\n\t{\n\t\tmethodVO.needsProjection = true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number /*int*/ = methodVO.fragmentConstantsIndex;\n\t\tdata[index + 3] = 1;\n\t\tdata[index + 6] = 0;\n\t\tdata[index + 7] = 0;\n\t}\n\n\t/**\n\t * The distance from which the fog starts appearing.\n\t */\n\tpublic get minDistance():number\n\t{\n\t\treturn this._minDistance;\n\t}\n\n\tpublic set minDistance(value:number)\n\t{\n\t\tthis._minDistance = value;\n\t}\n\n\t/**\n\t * The distance at which the fog is densest.\n\t */\n\tpublic get maxDistance():number\n\t{\n\t\treturn this._maxDistance;\n\t}\n\n\tpublic set maxDistance(value:number)\n\t{\n\t\tthis._maxDistance = value;\n\t}\n\n\t/**\n\t * The colour of the fog.\n\t */\n\tpublic get fogColor():number /*uint*/\n\t{\n\t\treturn this._fogColor;\n\t}\n\n\tpublic set fogColor(value:number/*uint*/)\n\t{\n\t\tthis._fogColor = value;\n\t\tthis._fogR = ((value >> 16) & 0xff)/0xff;\n\t\tthis._fogG = ((value >> 8) & 0xff)/0xff;\n\t\tthis._fogB = (value & 0xff)/0xff;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number /*int*/ = methodVO.fragmentConstantsIndex;\n\t\tdata[index] = this._fogR;\n\t\tdata[index + 1] = this._fogG;\n\t\tdata[index + 2] = this._fogB;\n\t\tdata[index + 4] = this._minDistance;\n\t\tdata[index + 5] = 1/(this._maxDistance - this._minDistance);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar fogColor:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar fogData:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tregisterCache.addFragmentTempUsages(temp, 1);\n\t\tvar temp2:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tvar code:string = \"\";\n\t\tmethodVO.fragmentConstantsIndex = fogColor.index*4;\n\n\t\tcode += \"sub \" + temp2 + \".w, \" + sharedRegisters.projectionFragment + \".z, \" + fogData + \".x\\n\" +\n\t\t\t\t\"mul \" + temp2 + \".w, \" + temp2 + \".w, \" + fogData + \".y\\n\" +\n\t\t\t\t\"sat \" + temp2 + \".w, \" + temp2 + \".w\\n\" +\n\t\t\t\t\"sub \" + temp + \", \" + fogColor + \", \" + targetReg + \"\\n\" + // (fogColor- col)\n\t\t\t\t\"mul \" + temp + \", \" + temp + \", \" + temp2 + \".w\\n\" + // (fogColor- col)*fogRatio\n\t\t\t\t\"add \" + targetReg + \", \" + targetReg + \", \" + temp + \"\\n\"; // fogRatio*(fogColor- col) + col\n\n\t\tregisterCache.removeFragmentTempUsage(temp);\n\n\t\treturn code;\n\t}\n}\n\nexport = EffectFogMethod;","import CubeTextureBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\n\n/**\n * EffectFresnelEnvMapMethod provides a method to add fresnel-based reflectivity to an object using cube maps, which gets\n * stronger as the viewing angle becomes more grazing.\n */\nclass EffectFresnelEnvMapMethod extends EffectMethodBase\n{\n\tprivate _cubeTexture:CubeTextureBase;\n\tprivate _fresnelPower:number = 5;\n\tprivate _normalReflectance:number = 0;\n\tprivate _alpha:number;\n\tprivate _mask:Texture2DBase;\n\n\t/**\n\t * Creates a new <code>EffectFresnelEnvMapMethod</code> object.\n\t *\n\t * @param envMap The environment map containing the reflected scene.\n\t * @param alpha The reflectivity of the material.\n\t */\n\tconstructor(envMap:CubeTextureBase, alpha:number = 1)\n\t{\n\t\tsuper();\n\n\t\tthis._cubeTexture = envMap;\n\t\tthis._alpha = alpha;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tmethodVO.needsNormals = true;\n\t\tmethodVO.needsView = true;\n\t\tmethodVO.needsUV = this._mask != null;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tshaderObject.fragmentConstantData[methodVO.fragmentConstantsIndex + 3] = 1;\n\t}\n\n\t/**\n\t * An optional texture to modulate the reflectivity of the surface.\n\t */\n\tpublic get mask():Texture2DBase\n\t{\n\t\treturn this._mask;\n\t}\n\n\tpublic set mask(value:Texture2DBase)\n\t{\n\t\tif (Boolean(value) != Boolean(this._mask) ||\n\t\t\t(value && this._mask && (value.format != this._mask.format))) {\n\t\t\tthis.iInvalidateShaderProgram();\n\t\t}\n\t\tthis._mask = value;\n\t}\n\n\t/**\n\t * The power used in the Fresnel equation. Higher values make the fresnel effect more pronounced. Defaults to 5.\n\t */\n\tpublic get fresnelPower():number\n\t{\n\t\treturn this._fresnelPower;\n\t}\n\n\tpublic set fresnelPower(value:number)\n\t{\n\t\tthis._fresnelPower = value;\n\t}\n\n\t/**\n\t * The cubic environment map containing the reflected scene.\n\t */\n\tpublic get envMap():CubeTextureBase\n\t{\n\t\treturn this._cubeTexture;\n\t}\n\n\tpublic set envMap(value:CubeTextureBase)\n\t{\n\t\tthis._cubeTexture = value;\n\t}\n\n\t/**\n\t * The reflectivity of the surface.\n\t */\n\tpublic get alpha():number\n\t{\n\t\treturn this._alpha;\n\t}\n\n\tpublic set alpha(value:number)\n\t{\n\t\tthis._alpha = value;\n\t}\n\n\t/**\n\t * The minimum amount of reflectance, ie the reflectance when the view direction is normal to the surface or light direction.\n\t */\n\tpublic get normalReflectance():number\n\t{\n\t\treturn this._normalReflectance;\n\t}\n\n\tpublic set normalReflectance(value:number)\n\t{\n\t\tthis._normalReflectance = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number /*int*/ = methodVO.fragmentConstantsIndex;\n\t\tdata[index] = this._alpha;\n\t\tdata[index + 1] = this._normalReflectance;\n\t\tdata[index + 2] = this._fresnelPower;\n\n\t\tstage.activateCubeTexture(methodVO.texturesIndex, this._cubeTexture, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\n\t\tif (this._mask)\n\t\t\tstage.activateTexture(methodVO.texturesIndex + 1, this._mask, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar dataRegister:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tvar code:string = \"\";\n\t\tvar cubeMapReg:ShaderRegisterElement = registerCache.getFreeTextureReg();\n\t\tvar viewDirReg:ShaderRegisterElement = sharedRegisters.viewDirFragment;\n\t\tvar normalReg:ShaderRegisterElement = sharedRegisters.normalFragment;\n\n\t\tmethodVO.texturesIndex = cubeMapReg.index;\n\t\tmethodVO.fragmentConstantsIndex = dataRegister.index*4;\n\n\t\tregisterCache.addFragmentTempUsages(temp, 1);\n\t\tvar temp2:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\n\t\t// r = V - 2(V.N)*N\n\t\tcode += \"dp3 \" + temp + \".w, \" + viewDirReg + \".xyz, \" + normalReg + \".xyz\\n\" +\n\t\t\t\t\"add \" + temp + \".w, \" + temp + \".w, \" + temp + \".w\\n\" +\n\t\t\t\t\"mul \" + temp + \".xyz, \" + normalReg + \".xyz, \" + temp + \".w\\n\" +\n\t\t\t\t\"sub \" + temp + \".xyz, \" + temp + \".xyz, \" + viewDirReg + \".xyz\\n\" +\n\t\t\tShaderCompilerHelper.getTexCubeSampleCode(temp, cubeMapReg, this._cubeTexture, shaderObject.useSmoothTextures, shaderObject.useMipmapping, temp) +\n\t\t\t\t\"sub \" + temp2 + \".w, \" + temp + \".w, fc0.x\\n\" +               \t// -.5\n\t\t\t\t\"kil \" + temp2 + \".w\\n\" +\t// used for real time reflection mapping - if alpha is not 1 (mock texture) kil output\n\t\t\t\t\"sub \" + temp + \", \" + temp + \", \" + targetReg + \"\\n\";\n\n\t\t// calculate fresnel term\n\t\tcode += \"dp3 \" + viewDirReg + \".w, \" + viewDirReg + \".xyz, \" + normalReg + \".xyz\\n\" +  // dot(V, H)\n\t\t\t\t\"sub \" + viewDirReg + \".w, \" + dataRegister + \".w, \" + viewDirReg + \".w\\n\" +       // base = 1-dot(V, H)\n\t\t\t\t\"pow \" + viewDirReg + \".w, \" + viewDirReg + \".w, \" + dataRegister + \".z\\n\" +       // exp = pow(base, 5)\n\t\t\t\t\"sub \" + normalReg + \".w, \" + dataRegister + \".w, \" + viewDirReg + \".w\\n\" +        // 1 - exp\n\t\t\t\t\"mul \" + normalReg + \".w, \" + dataRegister + \".y, \" + normalReg + \".w\\n\" +         // f0*(1 - exp)\n\t\t\t\t\"add \" + viewDirReg + \".w, \" + viewDirReg + \".w, \" + normalReg + \".w\\n\" +          // exp + f0*(1 - exp)\n\n\t\t\t\t// total alpha\n\t\t\t\t\"mul \" + viewDirReg + \".w, \" + dataRegister + \".x, \" + viewDirReg + \".w\\n\";\n\n\t\tif (this._mask) {\n\t\t\tvar maskReg:ShaderRegisterElement = registerCache.getFreeTextureReg();\n\t\t\tcode += ShaderCompilerHelper.getTex2DSampleCode(temp2, sharedRegisters, maskReg, this._mask, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping) +\n\t\t\t\t\"mul \" + viewDirReg + \".w, \" + temp2 + \".x, \" + viewDirReg + \".w\\n\";\n\t\t}\n\n\t\t// blend\n\t\tcode += \"mul \" + temp + \", \" + temp + \", \" + viewDirReg + \".w\\n\" +\n\t\t\t\t\"add \" + targetReg + \", \" + targetReg + \", \" + temp + \"\\n\";\n\n\t\tregisterCache.removeFragmentTempUsage(temp);\n\n\t\treturn code;\n\t}\n}\n\nexport = EffectFresnelEnvMapMethod;","import Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\n\n/**\n * EffectLightMapMethod provides a method that allows applying a light map texture to the calculated pixel colour.\n * It is different from DiffuseLightMapMethod in that the latter only modulates the diffuse shading value rather\n * than the whole pixel colour.\n */\nclass EffectLightMapMethod extends EffectMethodBase\n{\n\t/**\n\t * Indicates the light map should be multiplied with the calculated shading result.\n\t */\n\tpublic static MULTIPLY:string = \"multiply\";\n\n\t/**\n\t * Indicates the light map should be added into the calculated shading result.\n\t */\n\tpublic static ADD:string = \"add\";\n\n\tprivate _texture:Texture2DBase;\n\n\tprivate _blendMode:string;\n\tprivate _useSecondaryUV:boolean;\n\n\t/**\n\t * Creates a new EffectLightMapMethod object.\n\t *\n\t * @param texture The texture containing the light map.\n\t * @param blendMode The blend mode with which the light map should be applied to the lighting result.\n\t * @param useSecondaryUV Indicates whether the secondary UV set should be used to map the light map.\n\t */\n\tconstructor(texture:Texture2DBase, blendMode:string = \"multiply\", useSecondaryUV:boolean = false)\n\t{\n\t\tsuper();\n\n\t\tthis._useSecondaryUV = useSecondaryUV;\n\t\tthis._texture = texture;\n\t\tthis.blendMode = blendMode;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tmethodVO.needsUV = !this._useSecondaryUV;\n\t\tmethodVO.needsSecondaryUV = this._useSecondaryUV;\n\t}\n\n\t/**\n\t * The blend mode with which the light map should be applied to the lighting result.\n\t *\n\t * @see EffectLightMapMethod.ADD\n\t * @see EffectLightMapMethod.MULTIPLY\n\t */\n\tpublic get blendMode():string\n\t{\n\t\treturn this._blendMode;\n\t}\n\n\tpublic set blendMode(value:string)\n\t{\n\t\tif (value != EffectLightMapMethod.ADD && value != EffectLightMapMethod.MULTIPLY)\n\t\t\tthrow new Error(\"Unknown blendmode!\");\n\t\tif (this._blendMode == value)\n\t\t\treturn;\n\n\t\tthis._blendMode = value;\n\n\t\tthis.iInvalidateShaderProgram();\n\t}\n\n\t/**\n\t * The texture containing the light map.\n\t */\n\tpublic get texture():Texture2DBase\n\t{\n\t\treturn this._texture;\n\t}\n\n\tpublic set texture(value:Texture2DBase)\n\t{\n\t\tif (value.format != this._texture.format)\n\t\t\tthis.iInvalidateShaderProgram();\n\n\t\tthis._texture = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tstage.activateTexture(methodVO.texturesIndex, this._texture, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\n\t\tsuper.iActivate(shaderObject, methodVO, stage);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string;\n\t\tvar lightMapReg:ShaderRegisterElement = registerCache.getFreeTextureReg();\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tmethodVO.texturesIndex = lightMapReg.index;\n\n\t\tcode = ShaderCompilerHelper.getTex2DSampleCode(temp, sharedRegisters, lightMapReg, this._texture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping, this._useSecondaryUV? sharedRegisters.secondaryUVVarying : sharedRegisters.uvVarying);\n\n\t\tswitch (this._blendMode) {\n\t\t\tcase EffectLightMapMethod.MULTIPLY:\n\t\t\t\tcode += \"mul \" + targetReg + \", \" + targetReg + \", \" + temp + \"\\n\";\n\t\t\t\tbreak;\n\t\t\tcase EffectLightMapMethod.ADD:\n\t\t\t\tcode += \"add \" + targetReg + \", \" + targetReg + \", \" + temp + \"\\n\";\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn code;\n\t}\n}\n\nexport = EffectLightMapMethod;","import AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport IAsset\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport ShadingMethodBase\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadingMethodBase\");\n\n/**\n * EffectMethodBase forms an abstract base class for shader methods that are not dependent on light sources,\n * and are in essence post-process effects on the materials.\n */\nclass EffectMethodBase extends ShadingMethodBase implements IAsset\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.EFFECTS_METHOD;\n\t}\n\n\t/**\n\t * Get the fragment shader code that should be added after all per-light code. Usually composits everything to the target register.\n\t * @param methodVO The MethodVO object containing the method data for the currently compiled material pass.\n\t * @param regCache The register cache used during the compilation.\n\t * @param targetReg The register that will be containing the method's output.\n\t * @private\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tthrow new AbstractMethodError();\n\t\treturn \"\";\n\t}\n}\n\nexport = EffectMethodBase;","import CubeTextureBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\n\n/**\n * EffectRefractionEnvMapMethod provides a method to add refracted transparency based on cube maps.\n */\nclass EffectRefractionEnvMapMethod extends EffectMethodBase\n{\n\tprivate _envMap:CubeTextureBase;\n\n\tprivate _dispersionR:number = 0;\n\tprivate _dispersionG:number = 0;\n\tprivate _dispersionB:number = 0;\n\tprivate _useDispersion:boolean;\n\tprivate _refractionIndex:number;\n\tprivate _alpha:number = 1;\n\n\t/**\n\t * Creates a new EffectRefractionEnvMapMethod object. Example values for dispersion are: dispersionR: -0.03, dispersionG: -0.01, dispersionB: = .0015\n\t *\n\t * @param envMap The environment map containing the refracted scene.\n\t * @param refractionIndex The refractive index of the material.\n\t * @param dispersionR The amount of chromatic dispersion of the red channel. Defaults to 0 (none).\n\t * @param dispersionG The amount of chromatic dispersion of the green channel. Defaults to 0 (none).\n\t * @param dispersionB The amount of chromatic dispersion of the blue channel. Defaults to 0 (none).\n\t */\n\tconstructor(envMap:CubeTextureBase, refractionIndex:number = .1, dispersionR:number = 0, dispersionG:number = 0, dispersionB:number = 0)\n\t{\n\t\tsuper();\n\t\tthis._envMap = envMap;\n\t\tthis._dispersionR = dispersionR;\n\t\tthis._dispersionG = dispersionG;\n\t\tthis._dispersionB = dispersionB;\n\t\tthis._useDispersion = !(this._dispersionR == this._dispersionB && this._dispersionR == this._dispersionG);\n\t\tthis._refractionIndex = refractionIndex;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tvar index:number /*int*/ = methodVO.fragmentConstantsIndex;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tdata[index + 4] = 1;\n\t\tdata[index + 5] = 0;\n\t\tdata[index + 7] = 1;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tmethodVO.needsNormals = true;\n\t\tmethodVO.needsView = true;\n\t}\n\n\t/**\n\t * The cube environment map to use for the refraction.\n\t */\n\tpublic get envMap():CubeTextureBase\n\t{\n\t\treturn this._envMap;\n\t}\n\n\tpublic set envMap(value:CubeTextureBase)\n\t{\n\t\tthis._envMap = value;\n\t}\n\n\t/**\n\t * The refractive index of the material.\n\t */\n\tpublic get refractionIndex():number\n\t{\n\t\treturn this._refractionIndex;\n\t}\n\n\tpublic set refractionIndex(value:number)\n\t{\n\t\tthis._refractionIndex = value;\n\t}\n\n\t/**\n\t * The amount of chromatic dispersion of the red channel. Defaults to 0 (none).\n\t */\n\tpublic get dispersionR():number\n\t{\n\t\treturn this._dispersionR;\n\t}\n\n\tpublic set dispersionR(value:number)\n\t{\n\t\tthis._dispersionR = value;\n\n\t\tvar useDispersion:boolean = !(this._dispersionR == this._dispersionB && this._dispersionR == this._dispersionG);\n\t\tif (this._useDispersion != useDispersion) {\n\t\t\tthis.iInvalidateShaderProgram();\n\t\t\tthis._useDispersion = useDispersion;\n\t\t}\n\t}\n\n\t/**\n\t * The amount of chromatic dispersion of the green channel. Defaults to 0 (none).\n\t */\n\tpublic get dispersionG():number\n\t{\n\t\treturn this._dispersionG;\n\t}\n\n\tpublic set dispersionG(value:number)\n\t{\n\t\tthis._dispersionG = value;\n\n\t\tvar useDispersion:boolean = !(this._dispersionR == this._dispersionB && this._dispersionR == this._dispersionG);\n\t\tif (this._useDispersion != useDispersion) {\n\t\t\tthis.iInvalidateShaderProgram();\n\t\t\tthis._useDispersion = useDispersion;\n\t\t}\n\t}\n\n\t/**\n\t * The amount of chromatic dispersion of the blue channel. Defaults to 0 (none).\n\t */\n\tpublic get dispersionB():number\n\t{\n\t\treturn this._dispersionB;\n\t}\n\n\tpublic set dispersionB(value:number)\n\t{\n\t\tthis._dispersionB = value;\n\n\t\tvar useDispersion:boolean = !(this._dispersionR == this._dispersionB && this._dispersionR == this._dispersionG);\n\t\tif (this._useDispersion != useDispersion) {\n\t\t\tthis.iInvalidateShaderProgram();\n\t\t\tthis._useDispersion = useDispersion;\n\t\t}\n\t}\n\n\t/**\n\t * The amount of transparency of the object. Warning: the alpha applies to the refracted color, not the actual\n\t * material. A value of 1 will make it appear fully transparent.\n\t */\n\tpublic get alpha():number\n\t{\n\t\treturn this._alpha;\n\t}\n\n\tpublic set alpha(value:number)\n\t{\n\t\tthis._alpha = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tvar index:number /*int*/ = methodVO.fragmentConstantsIndex;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\n\t\tdata[index] = this._dispersionR + this._refractionIndex;\n\n\t\tif (this._useDispersion) {\n\t\t\tdata[index + 1] = this._dispersionG + this._refractionIndex;\n\t\t\tdata[index + 2] = this._dispersionB + this._refractionIndex;\n\t\t}\n\t\tdata[index + 3] = this._alpha;\n\n\t\tstage.activateCubeTexture(methodVO.texturesIndex, this._envMap, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\t// todo: data2.x could use common reg, so only 1 reg is used\n\t\tvar data:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar data2:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar code:string = \"\";\n\t\tvar cubeMapReg:ShaderRegisterElement = registerCache.getFreeTextureReg();\n\t\tvar refractionDir:ShaderRegisterElement;\n\t\tvar refractionColor:ShaderRegisterElement;\n\t\tvar temp:ShaderRegisterElement;\n\n\t\tmethodVO.texturesIndex = cubeMapReg.index;\n\t\tmethodVO.fragmentConstantsIndex = data.index*4;\n\n\t\trefractionDir = registerCache.getFreeFragmentVectorTemp();\n\t\tregisterCache.addFragmentTempUsages(refractionDir, 1);\n\t\trefractionColor = registerCache.getFreeFragmentVectorTemp();\n\t\tregisterCache.addFragmentTempUsages(refractionColor, 1);\n\n\t\ttemp = registerCache.getFreeFragmentVectorTemp();\n\n\t\tvar viewDirReg:ShaderRegisterElement = sharedRegisters.viewDirFragment;\n\t\tvar normalReg:ShaderRegisterElement = sharedRegisters.normalFragment;\n\n\t\tcode += \"neg \" + viewDirReg + \".xyz, \" + viewDirReg + \".xyz\\n\";\n\n\t\tcode += \"dp3 \" + temp + \".x, \" + viewDirReg + \".xyz, \" + normalReg + \".xyz\\n\" +\n\t\t\t\"mul \" + temp + \".w, \" + temp + \".x, \" + temp + \".x\\n\" +\n\t\t\t\"sub \" + temp + \".w, \" + data2 + \".x, \" + temp + \".w\\n\" +\n\t\t\t\"mul \" + temp + \".w, \" + data + \".x, \" + temp + \".w\\n\" +\n\t\t\t\"mul \" + temp + \".w, \" + data + \".x, \" + temp + \".w\\n\" +\n\t\t\t\"sub \" + temp + \".w, \" + data2 + \".x, \" + temp + \".w\\n\" +\n\t\t\t\"sqt \" + temp + \".y, \" + temp + \".w\\n\" +\n\n\t\t\t\"mul \" + temp + \".x, \" + data + \".x, \" + temp + \".x\\n\" +\n\t\t\t\"add \" + temp + \".x, \" + temp + \".x, \" + temp + \".y\\n\" +\n\t\t\t\"mul \" + temp + \".xyz, \" + temp + \".x, \" + normalReg + \".xyz\\n\" +\n\n\t\t\t\"mul \" + refractionDir + \", \" + data + \".x, \" + viewDirReg + \"\\n\" +\n\t\t\t\"sub \" + refractionDir + \".xyz, \" + refractionDir + \".xyz, \" + temp + \".xyz\\n\" +\n\t\t\t\"nrm \" + refractionDir + \".xyz, \" + refractionDir + \".xyz\\n\";\n\t\tcode += ShaderCompilerHelper.getTexCubeSampleCode(refractionColor, cubeMapReg, this._envMap, shaderObject.useSmoothTextures, shaderObject.useMipmapping, refractionDir) +\n\t\t\t\"sub \" + refractionColor + \".w, \" + refractionColor + \".w, fc0.x\t\\n\" +\n\t\t\t\"kil \" + refractionColor + \".w\\n\";\n\n\t\tif (this._useDispersion) {\n\t\t\t// GREEN\n\t\t\tcode += \"dp3 \" + temp + \".x, \" + viewDirReg + \".xyz, \" + normalReg + \".xyz\\n\" +\n\t\t\t\t\"mul \" + temp + \".w, \" + temp + \".x, \" + temp + \".x\\n\" +\n\t\t\t\t\"sub \" + temp + \".w, \" + data2 + \".x, \" + temp + \".w\\n\" +\n\t\t\t\t\"mul \" + temp + \".w, \" + data + \".y, \" + temp + \".w\\n\" +\n\t\t\t\t\"mul \" + temp + \".w, \" + data + \".y, \" + temp + \".w\\n\" +\n\t\t\t\t\"sub \" + temp + \".w, \" + data2 + \".x, \" + temp + \".w\\n\" +\n\t\t\t\t\"sqt \" + temp + \".y, \" + temp + \".w\\n\" +\n\n\t\t\t\t\"mul \" + temp + \".x, \" + data + \".y, \" + temp + \".x\\n\" +\n\t\t\t\t\"add \" + temp + \".x, \" + temp + \".x, \" + temp + \".y\\n\" +\n\t\t\t\t\"mul \" + temp + \".xyz, \" + temp + \".x, \" + normalReg + \".xyz\\n\" +\n\n\t\t\t\t\"mul \" + refractionDir + \", \" + data + \".y, \" + viewDirReg + \"\\n\" +\n\t\t\t\t\"sub \" + refractionDir + \".xyz, \" + refractionDir + \".xyz, \" + temp + \".xyz\\n\" +\n\t\t\t\t\"nrm \" + refractionDir + \".xyz, \" + refractionDir + \".xyz\\n\";\n\t\t\tcode += ShaderCompilerHelper.getTexCubeSampleCode(temp, cubeMapReg, this._envMap, shaderObject.useSmoothTextures, shaderObject.useMipmapping, refractionDir) +\n\t\t\t\t\"mov \" + refractionColor + \".y, \" + temp + \".y\\n\";\n\n\t\t\t// BLUE\n\t\t\tcode += \"dp3 \" + temp + \".x, \" + viewDirReg + \".xyz, \" + normalReg + \".xyz\\n\" +\n\t\t\t\t\"mul \" + temp + \".w, \" + temp + \".x, \" + temp + \".x\\n\" +\n\t\t\t\t\"sub \" + temp + \".w, \" + data2 + \".x, \" + temp + \".w\\n\" +\n\t\t\t\t\"mul \" + temp + \".w, \" + data + \".z, \" + temp + \".w\\n\" +\n\t\t\t\t\"mul \" + temp + \".w, \" + data + \".z, \" + temp + \".w\\n\" +\n\t\t\t\t\"sub \" + temp + \".w, \" + data2 + \".x, \" + temp + \".w\\n\" +\n\t\t\t\t\"sqt \" + temp + \".y, \" + temp + \".w\\n\" +\n\n\t\t\t\t\"mul \" + temp + \".x, \" + data + \".z, \" + temp + \".x\\n\" +\n\t\t\t\t\"add \" + temp + \".x, \" + temp + \".x, \" + temp + \".y\\n\" +\n\t\t\t\t\"mul \" + temp + \".xyz, \" + temp + \".x, \" + normalReg + \".xyz\\n\" +\n\n\t\t\t\t\"mul \" + refractionDir + \", \" + data + \".z, \" + viewDirReg + \"\\n\" +\n\t\t\t\t\"sub \" + refractionDir + \".xyz, \" + refractionDir + \".xyz, \" + temp + \".xyz\\n\" +\n\t\t\t\t\"nrm \" + refractionDir + \".xyz, \" + refractionDir + \".xyz\\n\";\n\t\t\tcode += ShaderCompilerHelper.getTexCubeSampleCode(temp, cubeMapReg, this._envMap, shaderObject.useSmoothTextures, shaderObject.useMipmapping, refractionDir) +\n\t\t\t\t\"mov \" + refractionColor + \".z, \" + temp + \".z\\n\";\n\t\t}\n\n\t\tregisterCache.removeFragmentTempUsage(refractionDir);\n\n\t\tcode += \"sub \" + refractionColor + \".xyz, \" + refractionColor + \".xyz, \" + targetReg + \".xyz\\n\" +\n\t\t\t\"mul \" + refractionColor + \".xyz, \" + refractionColor + \".xyz, \" + data + \".w\\n\" +\n\t\t\t\"add \" + targetReg + \".xyz, \" + targetReg + \".xyz, \" + refractionColor + \".xyz\\n\";\n\n\t\tregisterCache.removeFragmentTempUsage(refractionColor);\n\n\t\t// restore\n\t\tcode += \"neg \" + viewDirReg + \".xyz, \" + viewDirReg + \".xyz\\n\";\n\n\t\treturn code;\n\t}\n}\n\nexport = EffectRefractionEnvMapMethod;","import Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\n\n/**\n * EffectRimLightMethod provides a method to add rim lighting to a material. This adds a glow-like effect to edges of objects.\n */\nclass EffectRimLightMethod extends EffectMethodBase\n{\n\tpublic static ADD:string = \"add\";\n\tpublic static MULTIPLY:string = \"multiply\";\n\tpublic static MIX:string = \"mix\";\n\n\tprivate _color:number /*uint*/;\n\tprivate _blendMode:string;\n\tprivate _colorR:number;\n\tprivate _colorG:number;\n\tprivate _colorB:number;\n\tprivate _strength:number;\n\tprivate _power:number;\n\n\t/**\n\t * Creates a new <code>EffectRimLightMethod</code> object.\n\t *\n\t * @param color The colour of the rim light.\n\t * @param strength The strength of the rim light.\n\t * @param power The power of the rim light. Higher values will result in a higher edge fall-off.\n\t * @param blend The blend mode with which to add the light to the object.\n\t */\n\tconstructor(color:number /*uint*/ = 0xffffff, strength:number = .4, power:number = 2, blend:string = \"mix\")\n\t{\n\t\tsuper();\n\n\t\tthis._blendMode = blend;\n\t\tthis._strength = strength;\n\t\tthis._power = power;\n\n\t\tthis.color = color;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tshaderObject.fragmentConstantData[methodVO.fragmentConstantsIndex + 3] = 1;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tmethodVO.needsNormals = true;\n\t\tmethodVO.needsView = true;\n\t}\n\n\n\t/**\n\t * The blend mode with which to add the light to the object.\n\t *\n\t * EffectRimLightMethod.MULTIPLY multiplies the rim light with the material's colour.\n\t * EffectRimLightMethod.ADD adds the rim light with the material's colour.\n\t * EffectRimLightMethod.MIX provides normal alpha blending.\n\t */\n\tpublic get blendMode():string\n\t{\n\t\treturn this._blendMode;\n\t}\n\n\tpublic set blendMode(value:string)\n\t{\n\t\tif (this._blendMode == value)\n\t\t\treturn;\n\n\t\tthis._blendMode = value;\n\n\t\tthis.iInvalidateShaderProgram();\n\t}\n\n\t/**\n\t * The color of the rim light.\n\t */\n\tpublic get color():number /*uint*/\n\t{\n\t\treturn this._color;\n\t}\n\n\tpublic set color(value:number /*uint*/)\n\t{\n\t\tthis._color = value;\n\t\tthis._colorR = ((value >> 16) & 0xff)/0xff;\n\t\tthis._colorG = ((value >> 8) & 0xff)/0xff;\n\t\tthis._colorB = (value & 0xff)/0xff;\n\t}\n\n\t/**\n\t * The strength of the rim light.\n\t */\n\tpublic get strength():number\n\t{\n\t\treturn this._strength;\n\t}\n\n\tpublic set strength(value:number)\n\t{\n\t\tthis._strength = value;\n\t}\n\n\t/**\n\t * The power of the rim light. Higher values will result in a higher edge fall-off.\n\t */\n\tpublic get power():number\n\t{\n\t\treturn this._power;\n\t}\n\n\tpublic set power(value:number)\n\t{\n\t\tthis._power = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tvar index:number /*int*/ = methodVO.fragmentConstantsIndex;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tdata[index] = this._colorR;\n\t\tdata[index + 1] = this._colorG;\n\t\tdata[index + 2] = this._colorB;\n\t\tdata[index + 4] = this._strength;\n\t\tdata[index + 5] = this._power;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar dataRegister:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar dataRegister2:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tvar code:string = \"\";\n\n\t\tmethodVO.fragmentConstantsIndex = dataRegister.index*4;\n\n\t\tcode += \"dp3 \" + temp + \".x, \" + sharedRegisters.viewDirFragment + \".xyz, \" + sharedRegisters.normalFragment + \".xyz\\n\" +\n\t\t\t\"sat \" + temp + \".x, \" + temp + \".x\\n\" +\n\t\t\t\"sub \" + temp + \".x, \" + dataRegister + \".w, \" + temp + \".x\\n\" +\n\t\t\t\"pow \" + temp + \".x, \" + temp + \".x, \" + dataRegister2 + \".y\\n\" +\n\t\t\t\"mul \" + temp + \".x, \" + temp + \".x, \" + dataRegister2 + \".x\\n\" +\n\t\t\t\"sub \" + temp + \".x, \" + dataRegister + \".w, \" + temp + \".x\\n\" +\n\t\t\t\"mul \" + targetReg + \".xyz, \" + targetReg + \".xyz, \" + temp + \".x\\n\" +\n\t\t\t\"sub \" + temp + \".w, \" + dataRegister + \".w, \" + temp + \".x\\n\";\n\n\t\tif (this._blendMode == EffectRimLightMethod.ADD) {\n\t\t\tcode += \"mul \" + temp + \".xyz, \" + temp + \".w, \" + dataRegister + \".xyz\\n\" +\n\t\t\t\t\"add \" + targetReg + \".xyz, \" + targetReg + \".xyz, \" + temp + \".xyz\\n\";\n\t\t} else if (this._blendMode == EffectRimLightMethod.MULTIPLY) {\n\t\t\tcode += \"mul \" + temp + \".xyz, \" + temp + \".w, \" + dataRegister + \".xyz\\n\" +\n\t\t\t\t\"mul \" + targetReg + \".xyz, \" + targetReg + \".xyz, \" + temp + \".xyz\\n\";\n\t\t} else {\n\t\t\tcode += \"sub \" + temp + \".xyz, \" + dataRegister + \".xyz, \" + targetReg + \".xyz\\n\" +\n\t\t\t\t\"mul \" + temp + \".xyz, \" + temp + \".xyz, \" + temp + \".w\\n\" +\n\t\t\t\t\"add \" + targetReg + \".xyz, \" + targetReg + \".xyz, \" + temp + \".xyz\\n\";\n\t\t}\n\n\t\treturn code;\n\t}\n}\n\nexport = EffectRimLightMethod;","import ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderLightingObject\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport ShadingMethodBase\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadingMethodBase\");\n\n/**\n * LightingMethodBase provides an abstract base method for shading methods that uses lights.\n * Used for diffuse and specular shaders only.\n */\nclass LightingMethodBase extends ShadingMethodBase\n{\n\t/**\n\t * A method that is exposed to wrappers in case the strength needs to be controlled\n\t */\n\tpublic _iModulateMethod:(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData) => string;\n\n\t/**\n\t * Creates a new LightingMethodBase.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * Get the fragment shader code that will be needed before any per-light code is added.\n\t * @param methodVO The MethodVO object containing the method data for the currently compiled material pass.\n\t * @param regCache The register cache used during the compilation.\n\t * @private\n\t */\n\tpublic iGetFragmentPreLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Get the fragment shader code that will generate the code relevant to a single light.\n\t *\n\t * @param methodVO The MethodVO object containing the method data for the currently compiled material pass.\n\t * @param lightDirReg The register containing the light direction vector.\n\t * @param lightColReg The register containing the light colour.\n\t * @param regCache The register cache used during the compilation.\n\t */\n\tpublic iGetFragmentCodePerLight(shaderObject:ShaderLightingObject, methodVO:MethodVO, lightDirReg:ShaderRegisterElement, lightColReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Get the fragment shader code that will generate the code relevant to a single light probe object.\n\t *\n\t * @param methodVO The MethodVO object containing the method data for the currently compiled material pass.\n\t * @param cubeMapReg The register containing the cube map for the current probe\n\t * @param weightRegister A string representation of the register + component containing the current weight\n\t * @param regCache The register cache providing any necessary registers to the shader\n\t */\n\tpublic iGetFragmentCodePerProbe(shaderObject:ShaderLightingObject, methodVO:MethodVO, cubeMapReg:ShaderRegisterElement, weightRegister:string, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Get the fragment shader code that should be added after all per-light code. Usually composits everything to the target register.\n\t *\n\t * @param methodVO The MethodVO object containing the method data for the currently compiled material pass.\n\t * @param regCache The register cache used during the compilation.\n\t * @param targetReg The register containing the final shading output.\n\t * @private\n\t */\n\tpublic iGetFragmentPostLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"\";\n\t}\n}\n\nexport = LightingMethodBase;","import Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport ShadingMethodBase\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadingMethodBase\");\n\n/**\n * NormalBasicMethod is the default method for standard tangent-space normal mapping.\n */\nclass NormalBasicMethod extends ShadingMethodBase\n{\n\tprivate _texture:Texture2DBase;\n\tprivate _useTexture:boolean;\n\tpublic _pNormalTextureRegister:ShaderRegisterElement;\n\n\t/**\n\t * Creates a new NormalBasicMethod object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\tpublic iIsUsed(shaderObject:ShaderObjectBase):boolean\n\t{\n\t\tif (!this._useTexture || !shaderObject.normalDependencies)\n\t\t\treturn false;\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tmethodVO.needsUV = this._useTexture;\n\t}\n\n\t/**\n\t * Indicates whether or not this method outputs normals in tangent space. Override for object-space normals.\n\t */\n\tpublic iOutputsTangentNormals():boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic copyFrom(method:ShadingMethodBase)\n\t{\n\t\tvar s:any = method;\n\t\tvar bnm:NormalBasicMethod = <NormalBasicMethod> method;\n\n\t\tif (bnm.normalMap != null)\n\t\t\tthis.normalMap = bnm.normalMap;\n\t}\n\n\t/**\n\t * The texture containing the normals per pixel.\n\t */\n\tpublic get normalMap():Texture2DBase\n\t{\n\t\treturn this._texture;\n\t}\n\n\tpublic set normalMap(value:Texture2DBase)\n\t{\n\t\tvar b:boolean = (value != null);\n\n\t\tif (b != this._useTexture || (value && this._texture && (value.format != this._texture.format)))\n\t\t\tthis.iInvalidateShaderProgram();\n\n\t\tthis._useTexture = b;\n\t\tthis._texture = value;\n\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iCleanCompilationData()\n\t{\n\t\tsuper.iCleanCompilationData();\n\t\tthis._pNormalTextureRegister = null;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\tif (this._texture)\n\t\t\tthis._texture = null;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tif (methodVO.texturesIndex >= 0)\n\t\t\tstage.activateTexture(methodVO.texturesIndex, this._texture, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tthis._pNormalTextureRegister = registerCache.getFreeTextureReg();\n\n\t\tmethodVO.texturesIndex = this._pNormalTextureRegister.index;\n\n\t\treturn ShaderCompilerHelper.getTex2DSampleCode(targetReg, sharedRegisters, this._pNormalTextureRegister, this._texture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping) +\n\t\t\t\"sub \" + targetReg + \".xyz, \" + targetReg + \".xyz, \" + sharedRegisters.commons + \".xxx\\n\" +\n\t\t\t\"nrm \" + targetReg + \".xyz, \" + targetReg + \"\\n\";\n\t}\n}\n\nexport = NormalBasicMethod;","import Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport NormalBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/NormalBasicMethod\");\nimport ShadingMethodBase\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadingMethodBase\");\n\n/**\n * NormalHeightMapMethod provides a normal map method that uses a height map to calculate the normals.\n */\nclass NormalHeightMapMethod extends NormalBasicMethod\n{\n\tprivate _worldXYRatio:number;\n\tprivate _worldXZRatio:number;\n\n\t/**\n\t * Creates a new NormalHeightMapMethod method.\n\t *\n\t * @param heightMap The texture containing the height data. 0 means low, 1 means high.\n\t * @param worldWidth The width of the 'world'. This is used to map uv coordinates' u component to scene dimensions.\n\t * @param worldHeight The height of the 'world'. This is used to map the height map values to scene dimensions.\n\t * @param worldDepth The depth of the 'world'. This is used to map uv coordinates' v component to scene dimensions.\n\t */\n\tconstructor(heightMap:Texture2DBase, worldWidth:number, worldHeight:number, worldDepth:number)\n\t{\n\t\tsuper();\n\n\t\tthis.normalMap = heightMap;\n\t\tthis._worldXYRatio = worldWidth/worldHeight;\n\t\tthis._worldXZRatio = worldDepth/worldHeight;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tvar index:number /*int*/ = methodVO.fragmentConstantsIndex;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tdata[index] = 1/this.normalMap.width;\n\t\tdata[index + 1] = 1/this.normalMap.height;\n\t\tdata[index + 2] = 0;\n\t\tdata[index + 3] = 1;\n\t\tdata[index + 4] = this._worldXYRatio;\n\t\tdata[index + 5] = this._worldXZRatio;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get tangentSpace():boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic copyFrom(method:ShadingMethodBase)\n\t{\n\t\tsuper.copyFrom(method);\n\n\t\tthis._worldXYRatio = (<NormalHeightMapMethod> method)._worldXYRatio;\n\t\tthis._worldXZRatio = (<NormalHeightMapMethod> method)._worldXZRatio;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tvar dataReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar dataReg2:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tthis._pNormalTextureRegister = registerCache.getFreeTextureReg();\n\t\tmethodVO.texturesIndex = this._pNormalTextureRegister.index;\n\t\tmethodVO.fragmentConstantsIndex = dataReg.index*4;\n\n\t\treturn ShaderCompilerHelper.getTex2DSampleCode(targetReg, sharedRegisters, this._pNormalTextureRegister, this.normalMap, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping, sharedRegisters.uvVarying, \"clamp\") +\n\n\t\t\t\"add \" + temp + \", \" + sharedRegisters.uvVarying + \", \" + dataReg + \".xzzz\\n\" +\n\n\t\t\tShaderCompilerHelper.getTex2DSampleCode(temp, sharedRegisters, this._pNormalTextureRegister, this.normalMap, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping, temp, \"clamp\") +\n\n\t\t\t\"sub \" + targetReg + \".x, \" + targetReg + \".x, \" + temp + \".x\\n\" +\n\t\t\t\"add \" + temp + \", \" + sharedRegisters.uvVarying + \", \" + dataReg + \".zyzz\\n\" +\n\n\t\t\tShaderCompilerHelper.getTex2DSampleCode(temp, sharedRegisters, this._pNormalTextureRegister, this.normalMap, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping, temp, \"clamp\") +\n\n\t\t\t\"sub \" + targetReg + \".z, \" + targetReg + \".z, \" + temp + \".x\\n\" +\n\t\t\t\"mov \" + targetReg + \".y, \" + dataReg + \".w\\n\" +\n\t\t\t\"mul \" + targetReg + \".xz, \" + targetReg + \".xz, \" + dataReg2 + \".xy\\n\" +\n\t\t\t\"nrm \" + targetReg + \".xyz, \" + targetReg + \".xyz\\n\";\n\t}\n}\n\nexport = NormalHeightMapMethod;","import Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport NormalBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/NormalBasicMethod\");\n\n/**\n * NormalSimpleWaterMethod provides a basic normal map method to create water ripples by translating two wave normal maps.\n */\nclass NormalSimpleWaterMethod extends NormalBasicMethod\n{\n\tprivate _texture2:Texture2DBase;\n\tprivate _normalTextureRegister2:ShaderRegisterElement;\n\tprivate _useSecondNormalMap:boolean = false;\n\tprivate _water1OffsetX:number = 0;\n\tprivate _water1OffsetY:number = 0;\n\tprivate _water2OffsetX:number = 0;\n\tprivate _water2OffsetY:number = 0;\n\n\t/**\n\t * Creates a new NormalSimpleWaterMethod object.\n\t * @param waveMap1 A normal map containing one layer of a wave structure.\n\t * @param waveMap2 A normal map containing a second layer of a wave structure.\n\t */\n\tconstructor(waveMap1:Texture2DBase, waveMap2:Texture2DBase)\n\t{\n\t\tsuper();\n\t\tthis.normalMap = waveMap1;\n\t\tthis.secondaryNormalMap = waveMap2;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tvar index:number = methodVO.fragmentConstantsIndex;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tdata[index] = .5;\n\t\tdata[index + 1] = 0;\n\t\tdata[index + 2] = 0;\n\t\tdata[index + 3] = 1;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tsuper.iInitVO(shaderObject, methodVO);\n\n\t\tthis._useSecondNormalMap = this.normalMap != this.secondaryNormalMap;\n\t}\n\n\t/**\n\t * The translation of the first wave layer along the X-axis.\n\t */\n\tpublic get water1OffsetX():number\n\t{\n\t\treturn this._water1OffsetX;\n\t}\n\n\tpublic set water1OffsetX(value:number)\n\t{\n\t\tthis._water1OffsetX = value;\n\t}\n\n\t/**\n\t * The translation of the first wave layer along the Y-axis.\n\t */\n\tpublic get water1OffsetY():number\n\t{\n\t\treturn this._water1OffsetY;\n\t}\n\n\tpublic set water1OffsetY(value:number)\n\t{\n\t\tthis._water1OffsetY = value;\n\t}\n\n\t/**\n\t * The translation of the second wave layer along the X-axis.\n\t */\n\tpublic get water2OffsetX():number\n\t{\n\t\treturn this._water2OffsetX;\n\t}\n\n\tpublic set water2OffsetX(value:number)\n\t{\n\t\tthis._water2OffsetX = value;\n\t}\n\n\t/**\n\t * The translation of the second wave layer along the Y-axis.\n\t */\n\tpublic get water2OffsetY():number\n\t{\n\t\treturn this._water2OffsetY;\n\t}\n\n\tpublic set water2OffsetY(value:number)\n\t{\n\t\tthis._water2OffsetY = value;\n\t}\n\n\t/**\n\t * A second normal map that will be combined with the first to create a wave-like animation pattern.\n\t */\n\tpublic get secondaryNormalMap():Texture2DBase\n\t{\n\t\treturn this._texture2;\n\t}\n\n\tpublic set secondaryNormalMap(value:Texture2DBase)\n\t{\n\t\tthis._texture2 = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iCleanCompilationData()\n\t{\n\t\tsuper.iCleanCompilationData();\n\t\tthis._normalTextureRegister2 = null;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\tsuper.dispose();\n\t\tthis._texture2 = null;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tsuper.iActivate(shaderObject, methodVO, stage);\n\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number = methodVO.fragmentConstantsIndex;\n\n\t\tdata[index + 4] = this._water1OffsetX;\n\t\tdata[index + 5] = this._water1OffsetY;\n\t\tdata[index + 6] = this._water2OffsetX;\n\t\tdata[index + 7] = this._water2OffsetY;\n\n\t\t//if (this._useSecondNormalMap >= 0)\n\t\tif (this._useSecondNormalMap)\n\t\t\tstage.activateTexture(methodVO.texturesIndex + 1, this._texture2, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tvar dataReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar dataReg2:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tthis._pNormalTextureRegister = registerCache.getFreeTextureReg();\n\t\tthis._normalTextureRegister2 = this._useSecondNormalMap? registerCache.getFreeTextureReg():this._pNormalTextureRegister;\n\t\tmethodVO.texturesIndex = this._pNormalTextureRegister.index;\n\n\t\tmethodVO.fragmentConstantsIndex = dataReg.index*4;\n\n\t\treturn \"add \" + temp + \", \" + sharedRegisters.uvVarying + \", \" + dataReg2 + \".xyxy\\n\" +\n\t\t\tShaderCompilerHelper.getTex2DSampleCode(targetReg, sharedRegisters, this._pNormalTextureRegister, this.normalMap, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping, temp) +\n\t\t\t\"add \" + temp + \", \" + sharedRegisters.uvVarying + \", \" + dataReg2 + \".zwzw\\n\" +\n\t\t\tShaderCompilerHelper.getTex2DSampleCode(temp, sharedRegisters, this._normalTextureRegister2, this._texture2, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping, temp) +\n\t\t\t\"add \" + targetReg + \", \" + targetReg + \", \" + temp + \"\t\t\\n\" +\n\t\t\t\"mul \" + targetReg + \", \" + targetReg + \", \" + dataReg + \".x\t\\n\" +\n\t\t\t\"sub \" + targetReg + \".xyz, \" + targetReg + \".xyz, \" + sharedRegisters.commons + \".xxx\t\\n\" +\n\t\t\t\"nrm \" + targetReg + \".xyz, \" + targetReg + \".xyz\t\t\t\t\t\t\t\\n\";\n\t}\n}\n\nexport = NormalSimpleWaterMethod;","import NamedAssetBase\t\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\n\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport ShadingMethodEvent\t\t\t= require(\"awayjs-renderergl/lib/events/ShadingMethodEvent\");\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\n\n\n/**\n * ShadingMethodBase provides an abstract base method for shading methods, used by compiled passes to compile\n * the final shading program.\n */\nclass ShadingMethodBase extends NamedAssetBase\n{\n\t/**\n\t * Create a new ShadingMethodBase object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\tpublic iIsUsed(shaderObject:ShaderObjectBase):boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Initializes the properties for a MethodVO, including register and texture indices.\n\t *\n\t * @param methodVO The MethodVO object linking this method with the pass currently being compiled.\n\t *\n\t * @internal\n\t */\n\tpublic iInitVO(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\n\t}\n\n\t/**\n\t * Initializes unchanging shader constants using the data from a MethodVO.\n\t *\n\t * @param methodVO The MethodVO object linking this method with the pass currently being compiled.\n\t *\n\t * @internal\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\n\n\t}\n\n\t/**\n\t * Indicates whether or not this method expects normals in tangent space. Override for object-space normals.\n\t */\n\tpublic iUsesTangentSpace():boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Cleans up any resources used by the current object.\n\t */\n\tpublic dispose()\n\t{\n\n\t}\n\n\t/**\n\t * Resets the compilation state of the method.\n\t *\n\t * @internal\n\t */\n\tpublic iReset()\n\t{\n\t\tthis.iCleanCompilationData();\n\t}\n\n\t/**\n\t * Resets the method's state for compilation.\n\t *\n\t * @internal\n\t */\n\tpublic iCleanCompilationData()\n\t{\n\t}\n\n\t/**\n\t * Get the vertex shader code for this method.\n\t * @param vo The MethodVO object linking this method with the pass currently being compiled.\n\t * @param regCache The register cache used during the compilation.\n\t *\n\t * @internal\n\t */\n\tpublic iGetVertexCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn null;\n\t}\n\n\t/**\n\t * Sets the render state for this method.\n\t *\n\t * @param methodVO The MethodVO object linking this method with the pass currently being compiled.\n\t * @param stage The Stage object currently used for rendering.\n\t *\n\t * @internal\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\n\t}\n\n\t/**\n\t * Sets the render state for a single renderable.\n\t *\n\t * @param vo The MethodVO object linking this method with the pass currently being compiled.\n\t * @param renderable The renderable currently being rendered.\n\t * @param stage The Stage object currently used for rendering.\n\t * @param camera The camera from which the scene is currently rendered.\n\t *\n\t * @internal\n\t */\n\tpublic iSetRenderState(shaderObject:ShaderObjectBase, methodVO:MethodVO, renderable:RenderableBase, stage:Stage, camera:Camera)\n\t{\n\n\t}\n\n\t/**\n\t * Clears the render state for this method.\n\t * @param vo The MethodVO object linking this method with the pass currently being compiled.\n\t * @param stage The Stage object currently used for rendering.\n\t *\n\t * @internal\n\t */\n\tpublic iDeactivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\n\t}\n\n\t/**\n\t * Marks the shader program as invalid, so it will be recompiled before the next render.\n\t *\n\t * @internal\n\t */\n\tpublic iInvalidateShaderProgram()\n\t{\n\t\tthis.dispatchEvent(new ShadingMethodEvent(ShadingMethodEvent.SHADER_INVALIDATED));\n\t}\n\n\t/**\n\t * Copies the state from a ShadingMethodBase object into the current object.\n\t */\n\tpublic copyFrom(method:ShadingMethodBase)\n\t{\n\t}\n}\n\nexport = ShadingMethodBase;","import Event\t\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport DirectionalLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\nimport CascadeShadowMapper\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/CascadeShadowMapper\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport ShadingMethodEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/ShadingMethodEvent\");\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport ShadowMapMethodBase\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase\");\nimport ShadowMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMethodBase\");\n\n/**\n * ShadowCascadeMethod is a shadow map method to apply cascade shadow mapping on materials.\n * Must be used with a DirectionalLight with a CascadeShadowMapper assigned to its shadowMapper property.\n *\n * @see away.lights.CascadeShadowMapper\n */\nclass ShadowCascadeMethod extends ShadowMapMethodBase\n{\n\tprivate _baseMethod:ShadowMethodBase;\n\tprivate _cascadeShadowMapper:CascadeShadowMapper;\n\tprivate _depthMapCoordVaryings:Array<ShaderRegisterElement>;\n\tprivate _cascadeProjections:Array<ShaderRegisterElement>;\n\n\t/**\n\t * Creates a new ShadowCascadeMethod object.\n\t *\n\t * @param shadowMethodBase The shadow map sampling method used to sample individual cascades (fe: ShadowHardMethod, ShadowSoftMethod)\n\t */\n\tconstructor(shadowMethodBase:ShadowMethodBase)\n\t{\n\t\tsuper(shadowMethodBase.castingLight);\n\n\t\tthis._baseMethod = shadowMethodBase;\n\t\tif (!(this._pCastingLight instanceof DirectionalLight))\n\t\t\tthrow new Error(\"ShadowCascadeMethod is only compatible with DirectionalLight\");\n\n\t\tthis._cascadeShadowMapper = <CascadeShadowMapper> this._pCastingLight.shadowMapper;\n\n\t\tif (!this._cascadeShadowMapper)\n\t\t\tthrow new Error(\"ShadowCascadeMethod requires a light that has a CascadeShadowMapper instance assigned to shadowMapper.\");\n\n\t\tthis._cascadeShadowMapper.addEventListener(Event.CHANGE, (event:Event) => this.onCascadeChange(event));\n\t\tthis._baseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, (event:ShadingMethodEvent) => this.onShaderInvalidated(event));\n\t}\n\n\t/**\n\t * The shadow map sampling method used to sample individual cascades. These are typically those used in conjunction\n\t * with a DirectionalShadowMapper.\n\t *\n\t * @see ShadowHardMethod\n\t * @see ShadowSoftMethod\n\t */\n\tpublic get baseMethod():ShadowMethodBase\n\t{\n\t\treturn this._baseMethod;\n\t}\n\n\tpublic set baseMethod(value:ShadowMethodBase)\n\t{\n\t\tif (this._baseMethod == value)\n\t\t\treturn;\n\n\t\tthis._baseMethod.removeEventListener(ShadingMethodEvent.SHADER_INVALIDATED, (event:ShadingMethodEvent) => this.onShaderInvalidated(event));\n\n\t\tthis._baseMethod = value;\n\n\t\tthis._baseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, (event:ShadingMethodEvent) => this.onShaderInvalidated(event));\n\n\t\tthis.iInvalidateShaderProgram();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderLightingObject, methodVO:MethodVO)\n\t{\n\t\tvar tempVO:MethodVO = new MethodVO(this._baseMethod);\n\t\tthis._baseMethod.iInitVO(shaderObject, tempVO);\n\n\t\tmethodVO.needsGlobalVertexPos = true;\n\t\tmethodVO.needsProjection = true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tvar fragmentData:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar vertexData:Array<number> = shaderObject.vertexConstantData;\n\t\tvar index:number = methodVO.fragmentConstantsIndex;\n\t\tfragmentData[index] = 1.0;\n\t\tfragmentData[index + 1] = 1/255.0;\n\t\tfragmentData[index + 2] = 1/65025.0;\n\t\tfragmentData[index + 3] = 1/16581375.0;\n\n\t\tfragmentData[index + 6] = .5;\n\t\tfragmentData[index + 7] = -.5;\n\n\t\tindex = methodVO.vertexConstantsIndex;\n\t\tvertexData[index] = .5;\n\t\tvertexData[index + 1] = -.5;\n\t\tvertexData[index + 2] = 0;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iCleanCompilationData()\n\t{\n\t\tsuper.iCleanCompilationData();\n\t\tthis._cascadeProjections = null;\n\t\tthis._depthMapCoordVaryings = null;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetVertexCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar dataReg:ShaderRegisterElement = registerCache.getFreeVertexConstant();\n\n\t\tthis.initProjectionsRegs(registerCache);\n\t\tmethodVO.vertexConstantsIndex = dataReg.index*4;\n\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeVertexVectorTemp();\n\n\t\tfor (var i:number = 0; i < this._cascadeShadowMapper.numCascades; ++i) {\n\t\t\tcode += \"m44 \" + temp + \", \" + sharedRegisters.globalPositionVertex + \", \" + this._cascadeProjections[i] + \"\\n\" +\n\t\t\t\t\"add \" + this._depthMapCoordVaryings[i] + \", \" + temp + \", \" + dataReg + \".zzwz\\n\";\n\t\t}\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * Creates the registers for the cascades' projection coordinates.\n\t */\n\tprivate initProjectionsRegs(registerCache:ShaderRegisterCache)\n\t{\n\t\tthis._cascadeProjections = new Array<ShaderRegisterElement>(this._cascadeShadowMapper.numCascades);\n\t\tthis._depthMapCoordVaryings = new Array<ShaderRegisterElement>(this._cascadeShadowMapper.numCascades);\n\n\t\tfor (var i:number = 0; i < this._cascadeShadowMapper.numCascades; ++i) {\n\t\t\tthis._depthMapCoordVaryings[i] = registerCache.getFreeVarying();\n\t\t\tthis._cascadeProjections[i] = registerCache.getFreeVertexConstant();\n\t\t\tregisterCache.getFreeVertexConstant();\n\t\t\tregisterCache.getFreeVertexConstant();\n\t\t\tregisterCache.getFreeVertexConstant();\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar numCascades:number = this._cascadeShadowMapper.numCascades;\n\t\tvar depthMapRegister:ShaderRegisterElement = registerCache.getFreeTextureReg();\n\t\tvar decReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar dataReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar planeDistanceReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar planeDistances:Array<string> = Array<string>( planeDistanceReg + \".x\", planeDistanceReg + \".y\", planeDistanceReg + \".z\", planeDistanceReg + \".w\" );\n\t\tvar code:string;\n\n\t\tmethodVO.fragmentConstantsIndex = decReg.index*4;\n\t\tmethodVO.texturesIndex = depthMapRegister.index;\n\n\t\tvar inQuad:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tregisterCache.addFragmentTempUsages(inQuad, 1);\n\t\tvar uvCoord:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tregisterCache.addFragmentTempUsages(uvCoord, 1);\n\n\t\t// assume lowest partition is selected, will be overwritten later otherwise\n\t\tcode = \"mov \" + uvCoord + \", \" + this._depthMapCoordVaryings[numCascades - 1] + \"\\n\";\n\n\t\tfor (var i:number = numCascades - 2; i >= 0; --i) {\n\t\t\tvar uvProjection:ShaderRegisterElement = this._depthMapCoordVaryings[i];\n\n\t\t\t// calculate if in texturemap (result == 0 or 1, only 1 for a single partition)\n\t\t\tcode += \"slt \" + inQuad + \".z, \" + sharedRegisters.projectionFragment + \".z, \" + planeDistances[i] + \"\\n\"; // z = x > minX, w = y > minY\n\n\t\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\n\t\t\t// linearly interpolate between old and new uv coords using predicate value == conditional toggle to new value if predicate == 1 (true)\n\t\t\tcode += \"sub \" + temp + \", \" + uvProjection + \", \" + uvCoord + \"\\n\" +\n\t\t\t\t\"mul \" + temp + \", \" + temp + \", \" + inQuad + \".z\\n\" +\n\t\t\t\t\"add \" + uvCoord + \", \" + uvCoord + \", \" + temp + \"\\n\";\n\t\t}\n\n\t\tregisterCache.removeFragmentTempUsage(inQuad);\n\n\t\tcode += \"div \" + uvCoord + \", \" + uvCoord + \", \" + uvCoord + \".w\\n\" +\n\t\t\t\"mul \" + uvCoord + \".xy, \" + uvCoord + \".xy, \" + dataReg + \".zw\\n\" +\n\t\t\t\"add \" + uvCoord + \".xy, \" + uvCoord + \".xy, \" + dataReg + \".zz\\n\";\n\n\t\tcode += this._baseMethod._iGetCascadeFragmentCode(shaderObject, methodVO, decReg, depthMapRegister, uvCoord, targetReg, registerCache, sharedRegisters) +\n\t\t\t\"add \" + targetReg + \".w, \" + targetReg + \".w, \" + dataReg + \".y\\n\";\n\n\t\tregisterCache.removeFragmentTempUsage(uvCoord);\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tstage.activateTexture(methodVO.texturesIndex, <Texture2DBase> this._pCastingLight.shadowMapper.depthMap, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\n\t\tvar vertexData:Array<number> = shaderObject.vertexConstantData;\n\t\tvar vertexIndex:number = methodVO.vertexConstantsIndex;\n\n\t\tshaderObject.vertexConstantData[methodVO.vertexConstantsIndex + 3] = -1/(this._cascadeShadowMapper.depth*this._pEpsilon);\n\n\t\tvar numCascades:number = this._cascadeShadowMapper.numCascades;\n\t\tvertexIndex += 4;\n\t\tfor (var k:number = 0; k < numCascades; ++k) {\n\t\t\tthis._cascadeShadowMapper.getDepthProjections(k).copyRawDataTo(vertexData, vertexIndex, true);\n\t\t\tvertexIndex += 16;\n\t\t}\n\n\t\tvar fragmentData:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar fragmentIndex:number = methodVO.fragmentConstantsIndex;\n\t\tfragmentData[fragmentIndex + 5] = 1 - this._pAlpha;\n\n\t\tvar nearPlaneDistances:Array<number> = this._cascadeShadowMapper._iNearPlaneDistances;\n\n\t\tfragmentIndex += 8;\n\t\tfor (var i:number = 0; i < numCascades; ++i)\n\t\t\tfragmentData[fragmentIndex + i] = nearPlaneDistances[i];\n\n\t\tthis._baseMethod.iActivateForCascade(shaderObject, methodVO, stage);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iSetRenderState(shaderObject:ShaderObjectBase, methodVO:MethodVO, renderable:RenderableBase, stage:Stage, camera:Camera)\n\t{\n\t}\n\n\t/**\n\t * Called when the shadow mappers cascade configuration changes.\n\t */\n\tprivate onCascadeChange(event:Event)\n\t{\n\t\tthis.iInvalidateShaderProgram();\n\t}\n\n\t/**\n\t * Called when the base method's shader code is invalidated.\n\t */\n\tprivate onShaderInvalidated(event:ShadingMethodEvent)\n\t{\n\t\tthis.iInvalidateShaderProgram();\n\t}\n}\n\nexport = ShadowCascadeMethod;","import BitmapData\t\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport BitmapTexture\t\t\t\t\t= require(\"awayjs-core/lib/textures/BitmapTexture\");\n\nimport DirectionalLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport ShadowMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMethodBase\");\n\n/**\n * ShadowDitheredMethod provides a soft shadowing technique by randomly distributing sample points differently for each fragment.\n */\nclass ShadowDitheredMethod extends ShadowMethodBase\n{\n\tprivate static _grainTexture:BitmapTexture;\n\tprivate static _grainUsages:number /*int*/;\n\tprivate static _grainBitmapData:BitmapData;\n\tprivate _depthMapSize:number /*int*/;\n\tprivate _range:number;\n\tprivate _numSamples:number /*int*/;\n\n\t/**\n\t * Creates a new ShadowDitheredMethod object.\n\t * @param castingLight The light casting the shadows\n\t * @param numSamples The amount of samples to take for dithering. Minimum 1, maximum 24.\n\t */\n\tconstructor(castingLight:DirectionalLight, numSamples:number /*int*/ = 4, range:number = 1)\n\t{\n\t\tsuper(castingLight);\n\n\t\tthis._depthMapSize = this._pCastingLight.shadowMapper.depthMapSize;\n\n\t\tthis.numSamples = numSamples;\n\t\tthis.range = range;\n\n\t\t++ShadowDitheredMethod._grainUsages;\n\n\t\tif (!ShadowDitheredMethod._grainTexture)\n\t\t\tthis.initGrainTexture();\n\t}\n\n\t/**\n\t * The amount of samples to take for dithering. Minimum 1, maximum 24. The actual maximum may depend on the\n\t * complexity of the shader.\n\t */\n\tpublic get numSamples():number /*int*/\n\t{\n\t\treturn this._numSamples;\n\t}\n\n\tpublic set numSamples(value:number /*int*/)\n\t{\n\t\tthis._numSamples = value;\n\t\tif (this._numSamples < 1)\n\t\t\tthis._numSamples = 1; else if (this._numSamples > 24)\n\t\t\tthis._numSamples = 24;\n\t\tthis.iInvalidateShaderProgram();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderLightingObject, methodVO:MethodVO)\n\t{\n\t\tsuper.iInitVO(shaderObject, methodVO);\n\n\t\tmethodVO.needsProjection = true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tsuper.iInitConstants(shaderObject, methodVO);\n\n\t\tvar fragmentData:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number /*int*/ = methodVO.fragmentConstantsIndex;\n\t\tfragmentData[index + 8] = 1/this._numSamples;\n\t}\n\n\t/**\n\t * The range in the shadow map in which to distribute the samples.\n\t */\n\tpublic get range():number\n\t{\n\t\treturn this._range*2;\n\t}\n\n\tpublic set range(value:number)\n\t{\n\t\tthis._range = value/2;\n\t}\n\n\t/**\n\t * Creates a texture containing the dithering noise texture.\n\t */\n\tprivate initGrainTexture()\n\t{\n\t\tShadowDitheredMethod._grainBitmapData = new BitmapData(64, 64, false);\n\t\tvar vec:Array<number> /*uint*/ = new Array<number>();\n\t\tvar len:number /*uint*/ = 4096;\n\t\tvar step:number = 1/(this._depthMapSize*this._range);\n\t\tvar r:number, g:number;\n\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\n\t\t\tr = 2*(Math.random() - .5);\n\t\t\tg = 2*(Math.random() - .5);\n\t\t\tif (r < 0)\n\t\t\t\tr -= step; else\n\t\t\t\tr += step;\n\t\t\tif (g < 0)\n\t\t\t\tg -= step; else\n\t\t\t\tg += step;\n\t\t\tif (r > 1)\n\t\t\t\tr = 1; else if (r < -1)\n\t\t\t\tr = -1;\n\t\t\tif (g > 1)\n\t\t\t\tg = 1; else if (g < -1)\n\t\t\t\tg = -1;\n\t\t\tvec[i] = (Math.floor((r*.5 + .5)*0xff) << 16) | (Math.floor((g*.5 + .5)*0xff) << 8);\n\t\t}\n\n\t\tShadowDitheredMethod._grainBitmapData.setArray(ShadowDitheredMethod._grainBitmapData.rect, vec);\n\t\tShadowDitheredMethod._grainTexture = new BitmapTexture(ShadowDitheredMethod._grainBitmapData);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\tif (--ShadowDitheredMethod._grainUsages == 0) {\n\t\t\tShadowDitheredMethod._grainTexture.dispose();\n\t\t\tShadowDitheredMethod._grainBitmapData.dispose();\n\t\t\tShadowDitheredMethod._grainTexture = null;\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tsuper.iActivate(shaderObject, methodVO, stage);\n\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number /*uint*/ = methodVO.fragmentConstantsIndex;\n\t\tdata[index + 9] = (stage.width - 1)/63;\n\t\tdata[index + 10] = (stage.height - 1)/63;\n\t\tdata[index + 11] = 2*this._range/this._depthMapSize;\n\n\t\tstage.activateTexture(methodVO.texturesIndex + 1, ShadowDitheredMethod._grainTexture, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pGetPlanarFragmentCode(methodVO:MethodVO, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar depthMapRegister:ShaderRegisterElement = regCache.getFreeTextureReg();\n\t\tvar decReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\t\tvar dataReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\t\tvar customDataReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\n\t\tmethodVO.fragmentConstantsIndex = decReg.index*4;\n\t\tmethodVO.texturesIndex = depthMapRegister.index;\n\n\t\treturn this.getSampleCode(customDataReg, depthMapRegister, decReg, targetReg, regCache, sharedRegisters);\n\t}\n\n\t/**\n\t * Get the actual shader code for shadow mapping\n\t * @param regCache The register cache managing the registers.\n\t * @param depthMapRegister The texture register containing the depth map.\n\t * @param decReg The register containing the depth map decoding data.\n\t * @param targetReg The target register to add the shadow coverage.\n\t */\n\tprivate getSampleCode(customDataReg:ShaderRegisterElement, depthMapRegister:ShaderRegisterElement, decReg:ShaderRegisterElement, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar grainRegister:ShaderRegisterElement = regCache.getFreeTextureReg();\n\t\tvar uvReg:ShaderRegisterElement = regCache.getFreeFragmentVectorTemp();\n\t\tvar numSamples:number /*int*/ = this._numSamples;\n\t\tregCache.addFragmentTempUsages(uvReg, 1);\n\n\t\tvar temp:ShaderRegisterElement = regCache.getFreeFragmentVectorTemp();\n\n\t\tvar projectionReg:ShaderRegisterElement = sharedRegisters.projectionFragment;\n\n\t\tcode += \"div \" + uvReg + \", \" + projectionReg + \", \" + projectionReg + \".w\\n\" + \"mul \" + uvReg + \".xy, \" + uvReg + \".xy, \" + customDataReg + \".yz\\n\";\n\n\t\twhile (numSamples > 0) {\n\t\t\tif (numSamples == this._numSamples)\n\t\t\t\tcode += \"tex \" + uvReg + \", \" + uvReg + \", \" + grainRegister + \" <2d,nearest,repeat,mipnone>\\n\";\n\t\t\telse\n\t\t\t\tcode += \"tex \" + uvReg + \", \" + uvReg + \".zwxy, \" + grainRegister + \" <2d,nearest,repeat,mipnone>\\n\";\n\n\t\t\t// keep grain in uvReg.zw\n\t\t\tcode += \"sub \" + uvReg + \".zw, \" + uvReg + \".xy, fc0.xx\\n\" + // uv-.5\n\t\t\t\t\"mul \" + uvReg + \".zw, \" + uvReg + \".zw, \" + customDataReg + \".w\\n\"; // (tex unpack scale and tex scale in one)\n\n\t\t\tif (numSamples == this._numSamples) {\n\t\t\t\t// first sample\n\t\t\t\tcode += \"add \" + uvReg + \".xy, \" + uvReg + \".zw, \" + this._pDepthMapCoordReg + \".xy\\n\" +\n\t\t\t\t\t\"tex \" + temp + \", \" + uvReg + \", \" + depthMapRegister + \" <2d,nearest,clamp,mipnone>\\n\" +\n\t\t\t\t\t\"dp4 \" + temp + \".z, \" + temp + \", \" + decReg + \"\\n\" +\n\t\t\t\t\t\"slt \" + targetReg + \".w, \" + this._pDepthMapCoordReg + \".z, \" + temp + \".z\\n\"; // 0 if in shadow\n\t\t\t} else {\n\t\t\t\tcode += this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);\n\t\t\t}\n\n\t\t\tif (numSamples > 4)\n\t\t\t\tcode += \"add \" + uvReg + \".xy, \" + uvReg + \".xy, \" + uvReg + \".zw\\n\" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);\n\n\t\t\tif (numSamples > 1)\n\t\t\t\tcode += \"sub \" + uvReg + \".xy, \" + this._pDepthMapCoordReg + \".xy, \" + uvReg + \".zw\\n\" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);\n\n\t\t\tif (numSamples > 5)\n\t\t\t\tcode += \"sub \" + uvReg + \".xy, \" + uvReg + \".xy, \" + uvReg + \".zw\\n\" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);\n\n\t\t\tif (numSamples > 2) {\n\t\t\t\tcode += \"neg \" + uvReg + \".w, \" + uvReg + \".w\\n\"; // will be rotated 90 degrees when being accessed as wz\n\t\t\t\tcode += \"add \" + uvReg + \".xy, \" + uvReg + \".wz, \" + this._pDepthMapCoordReg + \".xy\\n\" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);\n\t\t\t}\n\n\t\t\tif (numSamples > 6)\n\t\t\t\tcode += \"add \" + uvReg + \".xy, \" + uvReg + \".xy, \" + uvReg + \".wz\\n\" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);\n\n\t\t\tif (numSamples > 3)\n\t\t\t\tcode += \"sub \" + uvReg + \".xy, \" + this._pDepthMapCoordReg + \".xy, \" + uvReg + \".wz\\n\" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);\n\n\t\t\tif (numSamples > 7)\n\t\t\t\tcode += \"sub \" + uvReg + \".xy, \" + uvReg + \".xy, \" + uvReg + \".wz\\n\" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);\n\n\t\t\tnumSamples -= 8;\n\t\t}\n\n\t\tregCache.removeFragmentTempUsage(uvReg);\n\t\tcode += \"mul \" + targetReg + \".w, \" + targetReg + \".w, \" + customDataReg + \".x\\n\"; // average\n\t\treturn code;\n\t}\n\n\t/**\n\t * Adds the code for another tap to the shader code.\n\t * @param uvReg The uv register for the tap.\n\t * @param depthMapRegister The texture register containing the depth map.\n\t * @param decReg The register containing the depth map decoding data.\n\t * @param targetReg The target register to add the tap comparison result.\n\t * @param regCache The register cache managing the registers.\n\t * @return\n\t */\n\tprivate addSample(uvReg:ShaderRegisterElement, depthMapRegister:ShaderRegisterElement, decReg:ShaderRegisterElement, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache):string\n\t{\n\t\tvar temp:ShaderRegisterElement = regCache.getFreeFragmentVectorTemp();\n\n\t\treturn \"tex \" + temp + \", \" + uvReg + \", \" + depthMapRegister + \" <2d,nearest,clamp,mipnone>\\n\" +\n\t\t\t\"dp4 \" + temp + \".z, \" + temp + \", \" + decReg + \"\\n\" +\n\t\t\t\"slt \" + temp + \".z, \" + this._pDepthMapCoordReg + \".z, \" + temp + \".z\\n\" + // 0 if in shadow\n\t\t\t\"add \" + targetReg + \".w, \" + targetReg + \".w, \" + temp + \".z\\n\";\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivateForCascade(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number /*uint*/ = methodVO.secondaryFragmentConstantsIndex;\n\t\tdata[index] = 1/this._numSamples;\n\t\tdata[index + 1] = (stage.width - 1)/63;\n\t\tdata[index + 2] = (stage.height - 1)/63;\n\t\tdata[index + 3] = 2*this._range/this._depthMapSize;\n\n\t\tstage.activateTexture(methodVO.texturesIndex + 1, ShadowDitheredMethod._grainTexture, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGetCascadeFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, decodeRegister:ShaderRegisterElement, depthTexture:ShaderRegisterElement, depthProjection:ShaderRegisterElement, targetRegister:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tthis._pDepthMapCoordReg = depthProjection;\n\n\t\tvar dataReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tmethodVO.secondaryFragmentConstantsIndex = dataReg.index*4;\n\n\t\treturn this.getSampleCode(dataReg, depthTexture, decodeRegister, targetRegister, registerCache, sharedRegisters);\n\t}\n}\n\nexport = ShadowDitheredMethod;","import DirectionalLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport ShadowMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMethodBase\");\n\n/**\n * ShadowFilteredMethod provides a softened shadowing technique by bilinearly interpolating shadow comparison\n * results of neighbouring pixels.\n */\nclass ShadowFilteredMethod extends ShadowMethodBase\n{\n\t/**\n\t * Creates a new DiffuseBasicMethod object.\n\t *\n\t * @param castingLight The light casting the shadow\n\t */\n\tconstructor(castingLight:DirectionalLight)\n\t{\n\t\tsuper(castingLight);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderLightingObject, methodVO:MethodVO)\n\t{\n\t\tsuper.iInitConstants(shaderObject, methodVO);\n\n\t\tvar fragmentData:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number /*int*/ = methodVO.fragmentConstantsIndex;\n\t\tfragmentData[index + 8] = .5;\n\t\tvar size:number /*int*/ = this.castingLight.shadowMapper.depthMapSize;\n\t\tfragmentData[index + 9] = size;\n\t\tfragmentData[index + 10] = 1/size;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pGetPlanarFragmentCode(methodVO:MethodVO, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar depthMapRegister:ShaderRegisterElement = regCache.getFreeTextureReg();\n\t\tvar decReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\t\tvar dataReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\t\t// TODO: not used\n\t\tdataReg = dataReg;\n\t\tvar customDataReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\t\tvar depthCol:ShaderRegisterElement = regCache.getFreeFragmentVectorTemp();\n\t\tvar uvReg:ShaderRegisterElement;\n\t\tvar code:string = \"\";\n\t\tmethodVO.fragmentConstantsIndex = decReg.index*4;\n\n\t\tregCache.addFragmentTempUsages(depthCol, 1);\n\n\t\tuvReg = regCache.getFreeFragmentVectorTemp();\n\t\tregCache.addFragmentTempUsages(uvReg, 1);\n\n\t\tcode += \"mov \" + uvReg + \", \" + this._pDepthMapCoordReg + \"\\n\" +\n\n\t\t\t\"tex \" + depthCol + \", \" + this._pDepthMapCoordReg + \", \" + depthMapRegister + \" <2d, nearest, clamp>\\n\" + \"dp4 \" + depthCol + \".z, \" + depthCol + \", \" + decReg + \"\\n\" + \"slt \" + uvReg + \".z, \" + this._pDepthMapCoordReg + \".z, \" + depthCol + \".z\\n\" +   // 0 if in shadow\n\n\t\t\t\"add \" + uvReg + \".x, \" + this._pDepthMapCoordReg + \".x, \" + customDataReg + \".z\\n\" + \t// (1, 0)\n\t\t\t\"tex \" + depthCol + \", \" + uvReg + \", \" + depthMapRegister + \" <2d, nearest, clamp>\\n\" + \"dp4 \" + depthCol + \".z, \" + depthCol + \", \" + decReg + \"\\n\" + \"slt \" + uvReg + \".w, \" + this._pDepthMapCoordReg + \".z, \" + depthCol + \".z\\n\" +   // 0 if in shadow\n\n\t\t\t\"mul \" + depthCol + \".x, \" + this._pDepthMapCoordReg + \".x, \" + customDataReg + \".y\\n\" + \"frc \" + depthCol + \".x, \" + depthCol + \".x\\n\" + \"sub \" + uvReg + \".w, \" + uvReg + \".w, \" + uvReg + \".z\\n\" + \"mul \" + uvReg + \".w, \" + uvReg + \".w, \" + depthCol + \".x\\n\" + \"add \" + targetReg + \".w, \" + uvReg + \".z, \" + uvReg + \".w\\n\" +\n\n\t\t\t\"mov \" + uvReg + \".x, \" + this._pDepthMapCoordReg + \".x\\n\" + \"add \" + uvReg + \".y, \" + this._pDepthMapCoordReg + \".y, \" + customDataReg + \".z\\n\" +\t// (0, 1)\n\t\t\t\"tex \" + depthCol + \", \" + uvReg + \", \" + depthMapRegister + \" <2d, nearest, clamp>\\n\" + \"dp4 \" + depthCol + \".z, \" + depthCol + \", \" + decReg + \"\\n\" + \"slt \" + uvReg + \".z, \" + this._pDepthMapCoordReg + \".z, \" + depthCol + \".z\\n\" +   // 0 if in shadow\n\n\t\t\t\"add \" + uvReg + \".x, \" + this._pDepthMapCoordReg + \".x, \" + customDataReg + \".z\\n\" +\t// (1, 1)\n\t\t\t\"tex \" + depthCol + \", \" + uvReg + \", \" + depthMapRegister + \" <2d, nearest, clamp>\\n\" + \"dp4 \" + depthCol + \".z, \" + depthCol + \", \" + decReg + \"\\n\" + \"slt \" + uvReg + \".w, \" + this._pDepthMapCoordReg + \".z, \" + depthCol + \".z\\n\" +   // 0 if in shadow\n\n\t\t\t// recalculate fraction, since we ran out of registers :(\n\t\t\t\"mul \" + depthCol + \".x, \" + this._pDepthMapCoordReg + \".x, \" + customDataReg + \".y\\n\" + \"frc \" + depthCol + \".x, \" + depthCol + \".x\\n\" + \"sub \" + uvReg + \".w, \" + uvReg + \".w, \" + uvReg + \".z\\n\" + \"mul \" + uvReg + \".w, \" + uvReg + \".w, \" + depthCol + \".x\\n\" + \"add \" + uvReg + \".w, \" + uvReg + \".z, \" + uvReg + \".w\\n\" +\n\n\t\t\t\"mul \" + depthCol + \".x, \" + this._pDepthMapCoordReg + \".y, \" + customDataReg + \".y\\n\" + \"frc \" + depthCol + \".x, \" + depthCol + \".x\\n\" + \"sub \" + uvReg + \".w, \" + uvReg + \".w, \" + targetReg + \".w\\n\" + \"mul \" + uvReg + \".w, \" + uvReg + \".w, \" + depthCol + \".x\\n\" + \"add \" + targetReg + \".w, \" + targetReg + \".w, \" + uvReg + \".w\\n\";\n\n\t\tregCache.removeFragmentTempUsage(depthCol);\n\t\tregCache.removeFragmentTempUsage(uvReg);\n\n\t\tmethodVO.texturesIndex = depthMapRegister.index;\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivateForCascade(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tvar size:number /*int*/ = this.castingLight.shadowMapper.depthMapSize;\n\t\tvar index:number /*int*/ = methodVO.secondaryFragmentConstantsIndex;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tdata[index] = size;\n\t\tdata[index + 1] = 1/size;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGetCascadeFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, decodeRegister:ShaderRegisterElement, depthTexture:ShaderRegisterElement, depthProjection:ShaderRegisterElement, targetRegister:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string;\n\t\tvar dataReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tmethodVO.secondaryFragmentConstantsIndex = dataReg.index*4;\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tregisterCache.addFragmentTempUsages(temp, 1);\n\t\tvar predicate:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tregisterCache.addFragmentTempUsages(predicate, 1);\n\n\t\tcode = \"tex \" + temp + \", \" + depthProjection + \", \" + depthTexture + \" <2d, nearest, clamp>\\n\" + \"dp4 \" + temp + \".z, \" + temp + \", \" + decodeRegister + \"\\n\" + \"slt \" + predicate + \".x, \" + depthProjection + \".z, \" + temp + \".z\\n\" +\n\n\t\t\t\"add \" + depthProjection + \".x, \" + depthProjection + \".x, \" + dataReg + \".y\\n\" + \"tex \" + temp + \", \" + depthProjection + \", \" + depthTexture + \" <2d, nearest, clamp>\\n\" + \"dp4 \" + temp + \".z, \" + temp + \", \" + decodeRegister + \"\\n\" + \"slt \" + predicate + \".z, \" + depthProjection + \".z, \" + temp + \".z\\n\" +\n\n\t\t\t\"add \" + depthProjection + \".y, \" + depthProjection + \".y, \" + dataReg + \".y\\n\" + \"tex \" + temp + \", \" + depthProjection + \", \" + depthTexture + \" <2d, nearest, clamp>\\n\" + \"dp4 \" + temp + \".z, \" + temp + \", \" + decodeRegister + \"\\n\" + \"slt \" + predicate + \".w, \" + depthProjection + \".z, \" + temp + \".z\\n\" +\n\n\t\t\t\"sub \" + depthProjection + \".x, \" + depthProjection + \".x, \" + dataReg + \".y\\n\" + \"tex \" + temp + \", \" + depthProjection + \", \" + depthTexture + \" <2d, nearest, clamp>\\n\" + \"dp4 \" + temp + \".z, \" + temp + \", \" + decodeRegister + \"\\n\" + \"slt \" + predicate + \".y, \" + depthProjection + \".z, \" + temp + \".z\\n\" +\n\n\t\t\t\"mul \" + temp + \".xy, \" + depthProjection + \".xy, \" + dataReg + \".x\\n\" + \"frc \" + temp + \".xy, \" + temp + \".xy\\n\" +\n\n\t\t\t// some strange register juggling to prevent agal bugging out\n\t\t\t\"sub \" + depthProjection + \", \" + predicate + \".xyzw, \" + predicate + \".zwxy\\n\" + \"mul \" + depthProjection + \", \" + depthProjection + \", \" + temp + \".x\\n\" +\n\n\t\t\t\"add \" + predicate + \".xy, \" + predicate + \".xy, \" + depthProjection + \".zw\\n\" +\n\n\t\t\t\"sub \" + predicate + \".y, \" + predicate + \".y, \" + predicate + \".x\\n\" + \"mul \" + predicate + \".y, \" + predicate + \".y, \" + temp + \".y\\n\" + \"add \" + targetRegister + \".w, \" + predicate + \".x, \" + predicate + \".y\\n\";\n\n\t\tregisterCache.removeFragmentTempUsage(temp);\n\t\tregisterCache.removeFragmentTempUsage(predicate);\n\t\treturn code;\n\t}\n}\n\nexport = ShadowFilteredMethod;","import LightBase\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport ShadowMethodBase\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMethodBase\");\n\n/**\n * ShadowHardMethod provides the cheapest shadow map method by using a single tap without any filtering.\n */\nclass ShadowHardMethod extends ShadowMethodBase\n{\n\t/**\n\t * Creates a new ShadowHardMethod object.\n\t */\n\tconstructor(castingLight:LightBase)\n\t{\n\t\tsuper(castingLight);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pGetPlanarFragmentCode(methodVO:MethodVO, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar depthMapRegister:ShaderRegisterElement = regCache.getFreeTextureReg();\n\t\tvar decReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\n\t\t// needs to be reserved anyway. DO NOT REMOVE\n\t\tvar dataReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\n\t\tvar depthCol:ShaderRegisterElement = regCache.getFreeFragmentVectorTemp();\n\t\tvar code:string = \"\";\n\n\t\tmethodVO.fragmentConstantsIndex = decReg.index*4;\n\t\tmethodVO.texturesIndex = depthMapRegister.index;\n\n\t\tcode += \"tex \" + depthCol + \", \" + this._pDepthMapCoordReg + \", \" + depthMapRegister + \" <2d, nearest, clamp>\\n\" +\n\t\t\t\"dp4 \" + depthCol + \".z, \" + depthCol + \", \" + decReg + \"\\n\" +\n\t\t\t\"slt \" + targetReg + \".w, \" + this._pDepthMapCoordReg + \".z, \" + depthCol + \".z\\n\"; // 0 if in shadow\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pGetPointFragmentCode(methodVO:MethodVO, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar depthMapRegister:ShaderRegisterElement = regCache.getFreeTextureReg();\n\t\tvar decReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\t\tvar epsReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\t\tvar posReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\t\tvar depthSampleCol:ShaderRegisterElement = regCache.getFreeFragmentVectorTemp();\n\t\tregCache.addFragmentTempUsages(depthSampleCol, 1);\n\t\tvar lightDir:ShaderRegisterElement = regCache.getFreeFragmentVectorTemp();\n\t\tvar code:string = \"\";\n\n\t\tmethodVO.fragmentConstantsIndex = decReg.index*4;\n\t\tmethodVO.texturesIndex = depthMapRegister.index;\n\n\t\tcode += \"sub \" + lightDir + \", \" + sharedRegisters.globalPositionVarying + \", \" + posReg + \"\\n\" +\n\t\t\t\"dp3 \" + lightDir + \".w, \" + lightDir + \".xyz, \" + lightDir + \".xyz\\n\" +\n\t\t\t\"mul \" + lightDir + \".w, \" + lightDir + \".w, \" + posReg + \".w\\n\" +\n\t\t\t\"nrm \" + lightDir + \".xyz, \" + lightDir + \".xyz\\n\" +\n\n\t\t\t\"tex \" + depthSampleCol + \", \" + lightDir + \", \" + depthMapRegister + \" <cube, nearest, clamp>\\n\" +\n\t\t\t\"dp4 \" + depthSampleCol + \".z, \" + depthSampleCol + \", \" + decReg + \"\\n\" +\n\t\t\t\"add \" + targetReg + \".w, \" + lightDir + \".w, \" + epsReg + \".x\\n\" +    // offset by epsilon\n\n\t\t\t\"slt \" + targetReg + \".w, \" + targetReg + \".w, \" + depthSampleCol + \".z\\n\"; // 0 if in shadow\n\n\t\tregCache.removeFragmentTempUsage(depthSampleCol);\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGetCascadeFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, decodeRegister:ShaderRegisterElement, depthTexture:ShaderRegisterElement, depthProjection:ShaderRegisterElement, targetRegister:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\treturn \"tex \" + temp + \", \" + depthProjection + \", \" + depthTexture + \" <2d, nearest, clamp>\\n\" +\n\t\t\t\"dp4 \" + temp + \".z, \" + temp + \", \" + decodeRegister + \"\\n\" +\n\t\t\t\"slt \" + targetRegister + \".w, \" + depthProjection + \".z, \" + temp + \".z\\n\"; // 0 if in shadow\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivateForCascade(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t}\n}\n\nexport = ShadowHardMethod;","import AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport IAsset\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\n\nimport LightBase\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\nimport ShadowMapperBase\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/ShadowMapperBase\");\n\nimport ShadingMethodBase\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadingMethodBase\");\n\n/**\n * ShadowMapMethodBase provides an abstract base method for shadow map methods.\n */\nclass ShadowMapMethodBase extends ShadingMethodBase implements IAsset\n{\n\tpublic _pCastingLight:LightBase;\n\tpublic _pShadowMapper:ShadowMapperBase;\n\n\tpublic _pEpsilon:number = .02;\n\tpublic _pAlpha:number = 1;\n\n\t/**\n\t * Creates a new ShadowMapMethodBase object.\n\t * @param castingLight The light used to cast shadows.\n\t */\n\tconstructor(castingLight:LightBase)\n\t{\n\t\tsuper();\n\t\tthis._pCastingLight = castingLight;\n\t\tcastingLight.castsShadows = true;\n\t\tthis._pShadowMapper = castingLight.shadowMapper;\n\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.SHADOW_MAP_METHOD;\n\t}\n\n\t/**\n\t * The \"transparency\" of the shadows. This allows making shadows less strong.\n\t */\n\tpublic get alpha():number\n\t{\n\t\treturn this._pAlpha;\n\t}\n\n\tpublic set alpha(value:number)\n\t{\n\t\tthis._pAlpha = value;\n\t}\n\n\t/**\n\t * The light casting the shadows.\n\t */\n\tpublic get castingLight():LightBase\n\t{\n\t\treturn this._pCastingLight;\n\t}\n\n\t/**\n\t * A small value to counter floating point precision errors when comparing values in the shadow map with the\n\t * calculated depth value. Increase this if shadow banding occurs, decrease it if the shadow seems to be too detached.\n\t */\n\tpublic get epsilon():number\n\t{\n\t\treturn this._pEpsilon;\n\t}\n\n\tpublic set epsilon(value:number)\n\t{\n\t\tthis._pEpsilon = value;\n\t}\n}\n\nexport = ShadowMapMethodBase;","import Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\nimport CubeTextureBase\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\nimport Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport LightBase\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport DirectionalLight\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\nimport PointLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\nimport DirectionalShadowMapper\t\t= require(\"awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport ShaderLightingObject\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport ShadowMapMethodBase\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase\");\n\n/**\n * ShadowMethodBase provides an abstract method for simple (non-wrapping) shadow map methods.\n */\nclass ShadowMethodBase extends ShadowMapMethodBase\n{\n\tpublic _pDepthMapCoordReg:ShaderRegisterElement;\n\tpublic _pUsePoint:boolean;\n\n\t/**\n\t * Creates a new ShadowMethodBase object.\n\t * @param castingLight The light used to cast shadows.\n\t */\n\tconstructor(castingLight:LightBase)\n\t{\n\t\tthis._pUsePoint = (castingLight instanceof PointLight);\n\n\t\tsuper(castingLight);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderLightingObject, methodVO:MethodVO)\n\t{\n\t\tmethodVO.needsView = true;\n\t\tmethodVO.needsGlobalVertexPos = true;\n\t\tmethodVO.needsGlobalFragmentPos = this._pUsePoint;\n\t\tmethodVO.needsNormals = shaderObject.numLights > 0;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tvar fragmentData:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar vertexData:Array<number> = shaderObject.vertexConstantData;\n\t\tvar index:number /*int*/ = methodVO.fragmentConstantsIndex;\n\t\tfragmentData[index] = 1.0;\n\t\tfragmentData[index + 1] = 1/255.0;\n\t\tfragmentData[index + 2] = 1/65025.0;\n\t\tfragmentData[index + 3] = 1/16581375.0;\n\n\t\tfragmentData[index + 6] = 0;\n\t\tfragmentData[index + 7] = 1;\n\n\t\tif (this._pUsePoint) {\n\t\t\tfragmentData[index + 8] = 0;\n\t\t\tfragmentData[index + 9] = 0;\n\t\t\tfragmentData[index + 10] = 0;\n\t\t\tfragmentData[index + 11] = 1;\n\t\t}\n\n\t\tindex = methodVO.vertexConstantsIndex;\n\t\tif (index != -1) {\n\t\t\tvertexData[index] = .5;\n\t\t\tvertexData[index + 1] = .5;\n\t\t\tvertexData[index + 2] = 0.0;\n\t\t\tvertexData[index + 3] = 1.0;\n\t\t}\n\t}\n\n\t/**\n\t * Wrappers that override the vertex shader need to set this explicitly\n\t */\n\tpublic get _iDepthMapCoordReg():ShaderRegisterElement\n\t{\n\t\treturn this._pDepthMapCoordReg;\n\t}\n\n\tpublic set _iDepthMapCoordReg(value:ShaderRegisterElement)\n\t{\n\t\tthis._pDepthMapCoordReg = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iCleanCompilationData()\n\t{\n\t\tsuper.iCleanCompilationData();\n\n\t\tthis._pDepthMapCoordReg = null;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetVertexCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, regCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn this._pUsePoint? this._pGetPointVertexCode(methodVO, regCache, sharedRegisters):this.pGetPlanarVertexCode(methodVO, regCache, sharedRegisters);\n\t}\n\n\t/**\n\t * Gets the vertex code for shadow mapping with a point light.\n\t *\n\t * @param methodVO The MethodVO object linking this method with the pass currently being compiled.\n\t * @param regCache The register cache used during the compilation.\n\t */\n\tpublic _pGetPointVertexCode(methodVO:MethodVO, regCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tmethodVO.vertexConstantsIndex = -1;\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Gets the vertex code for shadow mapping with a planar shadow map (fe: directional lights).\n\t *\n\t * @param methodVO The MethodVO object linking this method with the pass currently being compiled.\n\t * @param regCache The register cache used during the compilation.\n\t */\n\tpublic pGetPlanarVertexCode(methodVO:MethodVO, regCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar temp:ShaderRegisterElement = regCache.getFreeVertexVectorTemp();\n\t\tvar dataReg:ShaderRegisterElement = regCache.getFreeVertexConstant();\n\t\tvar depthMapProj:ShaderRegisterElement = regCache.getFreeVertexConstant();\n\t\tregCache.getFreeVertexConstant();\n\t\tregCache.getFreeVertexConstant();\n\t\tregCache.getFreeVertexConstant();\n\t\tthis._pDepthMapCoordReg = regCache.getFreeVarying();\n\t\tmethodVO.vertexConstantsIndex = dataReg.index*4;\n\n\t\t// todo: can epsilon be applied here instead of fragment shader?\n\n\t\tcode += \"m44 \" + temp + \", \" + sharedRegisters.globalPositionVertex + \", \" + depthMapProj + \"\\n\" + \"div \" + temp + \", \" + temp + \", \" + temp + \".w\\n\" + \"mul \" + temp + \".xy, \" + temp + \".xy, \" + dataReg + \".xy\\n\" + \"add \" + this._pDepthMapCoordReg + \", \" + temp + \", \" + dataReg + \".xxwz\\n\";\n\t\t//\"sub \" + this._pDepthMapCoordReg + \".z, \" + this._pDepthMapCoordReg + \".z, \" + this._pDepthMapCoordReg + \".w\\n\";\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = this._pUsePoint? this._pGetPointFragmentCode(methodVO, targetReg, registerCache, sharedRegisters):this._pGetPlanarFragmentCode(methodVO, targetReg, registerCache, sharedRegisters);\n\t\tcode += \"add \" + targetReg + \".w, \" + targetReg + \".w, fc\" + (methodVO.fragmentConstantsIndex/4 + 1) + \".y\\n\" + \"sat \" + targetReg + \".w, \" + targetReg + \".w\\n\";\n\t\treturn code;\n\t}\n\n\t/**\n\t * Gets the fragment code for shadow mapping with a planar shadow map.\n\t * @param methodVO The MethodVO object linking this method with the pass currently being compiled.\n\t * @param regCache The register cache used during the compilation.\n\t * @param targetReg The register to contain the shadow coverage\n\t * @return\n\t */\n\tpublic _pGetPlanarFragmentCode(methodVO:MethodVO, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tthrow new AbstractMethodError();\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Gets the fragment code for shadow mapping with a point light.\n\t * @param methodVO The MethodVO object linking this method with the pass currently being compiled.\n\t * @param regCache The register cache used during the compilation.\n\t * @param targetReg The register to contain the shadow coverage\n\t * @return\n\t */\n\tpublic _pGetPointFragmentCode(methodVO:MethodVO, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tthrow new AbstractMethodError();\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iSetRenderState(shaderObject:ShaderObjectBase, methodVO:MethodVO, renderable:RenderableBase, stage:Stage, camera:Camera)\n\t{\n\t\tif (!this._pUsePoint)\n\t\t\t(<DirectionalShadowMapper> this._pShadowMapper).iDepthProjection.copyRawDataTo(shaderObject.vertexConstantData, methodVO.vertexConstantsIndex + 4, true);\n\t}\n\n\t/**\n\t * Gets the fragment code for combining this method with a cascaded shadow map method.\n\t * @param methodVO The MethodVO object linking this method with the pass currently being compiled.\n\t * @param regCache The register cache used during the compilation.\n\t * @param decodeRegister The register containing the data to decode the shadow map depth value.\n\t * @param depthTexture The texture containing the shadow map.\n\t * @param depthProjection The projection of the fragment relative to the light.\n\t * @param targetRegister The register to contain the shadow coverage\n\t * @return\n\t */\n\tpublic _iGetCascadeFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, decodeRegister:ShaderRegisterElement, depthTexture:ShaderRegisterElement, depthProjection:ShaderRegisterElement, targetRegister:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tthrow new Error(\"This shadow method is incompatible with cascade shadows\");\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tvar fragmentData:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number /*int*/ = methodVO.fragmentConstantsIndex;\n\n\t\tif (this._pUsePoint)\n\t\t\tfragmentData[index + 4] = -Math.pow(1/((<PointLight> this._pCastingLight).fallOff*this._pEpsilon), 2);\n\t\telse\n\t\t\tshaderObject.vertexConstantData[methodVO.vertexConstantsIndex + 3] = -1/((<DirectionalShadowMapper> this._pShadowMapper).depth*this._pEpsilon);\n\n\t\tfragmentData[index + 5] = 1 - this._pAlpha;\n\n\t\tif (this._pUsePoint) {\n\t\t\tvar pos:Vector3D = this._pCastingLight.scenePosition;\n\t\t\tfragmentData[index + 8] = pos.x;\n\t\t\tfragmentData[index + 9] = pos.y;\n\t\t\tfragmentData[index + 10] = pos.z;\n\t\t\t// used to decompress distance\n\t\t\tvar f:number = (<PointLight> this._pCastingLight).fallOff;\n\t\t\tfragmentData[index + 11] = 1/(2*f*f);\n\t\t}\n\n\t\tif (!this._pUsePoint)\n\t\t\tstage.activateRenderTexture(methodVO.texturesIndex, <Texture2DBase> this._pCastingLight.shadowMapper.depthMap);\n\t\t//else\n\t\t//\tstage.activateCubeRenderTexture(methodVO.texturesIndex, <CubeTextureBase> this._pCastingLight.shadowMapper.depthMap);\n\t}\n\n\t/**\n\t * Sets the method state for cascade shadow mapping.\n\t */\n\tpublic iActivateForCascade(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tthrow new Error(\"This shadow method is incompatible with cascade shadows\");\n\t}\n}\n\nexport = ShadowMethodBase;","import NearDirectionalShadowMapper\t\t= require(\"awayjs-display/lib/materials/shadowmappers/NearDirectionalShadowMapper\");\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport ShadingMethodEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/ShadingMethodEvent\");\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport ShadowMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMethodBase\");\n\n// TODO: shadow mappers references in materials should be an interface so that this class should NOT extend ShadowMapMethodBase just for some delegation work\n/**\n * ShadowNearMethod provides a shadow map method that restricts the shadowed area near the camera to optimize\n * shadow map usage. This method needs to be used in conjunction with a NearDirectionalShadowMapper.\n *\n * @see away.lights.NearDirectionalShadowMapper\n */\nclass ShadowNearMethod extends ShadowMethodBase\n{\n\tprivate _baseMethod:ShadowMethodBase;\n\n\tprivate _fadeRatio:number;\n\tprivate _nearShadowMapper:NearDirectionalShadowMapper;\n\n\tprivate _onShaderInvalidatedDelegate:Function;\n\n\t/**\n\t * Creates a new ShadowNearMethod object.\n\t * @param baseMethod The shadow map sampling method used to sample individual cascades (fe: ShadowHardMethod, ShadowSoftMethod)\n\t * @param fadeRatio The amount of shadow fading to the outer shadow area. A value of 1 would mean the shadows start fading from the camera's near plane.\n\t */\n\tconstructor(baseMethod:ShadowMethodBase, fadeRatio:number = .1)\n\t{\n\t\tsuper(baseMethod.castingLight);\n\n\t\tthis._onShaderInvalidatedDelegate = (event:ShadingMethodEvent) => this.onShaderInvalidated(event);\n\n\t\tthis._baseMethod = baseMethod;\n\t\tthis._fadeRatio = fadeRatio;\n\t\tthis._nearShadowMapper = <NearDirectionalShadowMapper> this._pCastingLight.shadowMapper;\n\t\tif (!this._nearShadowMapper)\n\t\t\tthrow new Error(\"ShadowNearMethod requires a light that has a NearDirectionalShadowMapper instance assigned to shadowMapper.\");\n\t\tthis._baseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, this._onShaderInvalidatedDelegate);\n\t}\n\n\t/**\n\t * The base shadow map method on which this method's shading is based.\n\t */\n\tpublic get baseMethod():ShadowMethodBase\n\t{\n\t\treturn this._baseMethod;\n\t}\n\n\tpublic set baseMethod(value:ShadowMethodBase)\n\t{\n\t\tif (this._baseMethod == value)\n\t\t\treturn;\n\n\t\tthis._baseMethod.removeEventListener(ShadingMethodEvent.SHADER_INVALIDATED, this._onShaderInvalidatedDelegate);\n\n\t\tthis._baseMethod = value;\n\n\t\tthis._baseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, this._onShaderInvalidatedDelegate);\n\n\t\tthis.iInvalidateShaderProgram();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tsuper.iInitConstants(shaderObject, methodVO);\n\t\tthis._baseMethod.iInitConstants(shaderObject, methodVO);\n\n\t\tvar fragmentData:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number /*int*/ = methodVO.secondaryFragmentConstantsIndex;\n\t\tfragmentData[index + 2] = 0;\n\t\tfragmentData[index + 3] = 1;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderLightingObject, methodVO:MethodVO)\n\t{\n\t\tthis._baseMethod.iInitVO(shaderObject, methodVO);\n\n\t\tmethodVO.needsProjection = true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._baseMethod.removeEventListener(ShadingMethodEvent.SHADER_INVALIDATED, this._onShaderInvalidatedDelegate);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get alpha():number\n\t{\n\t\treturn this._baseMethod.alpha;\n\t}\n\n\tpublic set alpha(value:number)\n\t{\n\t\tthis._baseMethod.alpha = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get epsilon():number\n\t{\n\t\treturn this._baseMethod.epsilon;\n\t}\n\n\tpublic set epsilon(value:number)\n\t{\n\t\tthis._baseMethod.epsilon = value;\n\t}\n\n\t/**\n\t * The amount of shadow fading to the outer shadow area. A value of 1 would mean the shadows start fading from the camera's near plane.\n\t */\n\tpublic get fadeRatio():number\n\t{\n\t\treturn this._fadeRatio;\n\t}\n\n\tpublic set fadeRatio(value:number)\n\t{\n\t\tthis._fadeRatio = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = this._baseMethod.iGetFragmentCode(shaderObject, methodVO, targetReg, registerCache, sharedRegisters);\n\n\t\tvar dataReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar temp:ShaderRegisterElement = registerCache.getFreeFragmentSingleTemp();\n\t\tmethodVO.secondaryFragmentConstantsIndex = dataReg.index*4;\n\n\t\tcode += \"abs \" + temp + \", \" + sharedRegisters.projectionFragment + \".w\\n\" +\n\t\t\t\"sub \" + temp + \", \" + temp + \", \" + dataReg + \".x\\n\" +\n\t\t\t\"mul \" + temp + \", \" + temp + \", \" + dataReg + \".y\\n\" +\n\t\t\t\"sat \" + temp + \", \" + temp + \"\\n\" +\n\t\t\t\"sub \" + temp + \", \" + dataReg + \".w,\" + temp + \"\\n\" +\n\t\t\t\"sub \" + targetReg + \".w, \" + dataReg + \".w,\" + targetReg + \".w\\n\" +\n\t\t\t\"mul \" + targetReg + \".w, \" + targetReg + \".w, \" + temp + \"\\n\" +\n\t\t\t\"sub \" + targetReg + \".w, \" + dataReg + \".w,\" + targetReg + \".w\\n\";\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tthis._baseMethod.iActivate(shaderObject, methodVO, stage);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iDeactivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tthis._baseMethod.iDeactivate(shaderObject, methodVO, stage);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iSetRenderState(shaderObject:ShaderObjectBase, methodVO:MethodVO, renderable:RenderableBase, stage:Stage, camera:Camera)\n\t{\n\t\t// todo: move this to activate (needs camera)\n\t\tvar near:number = camera.projection.near;\n\t\tvar d:number = camera.projection.far - near;\n\t\tvar maxDistance:number = this._nearShadowMapper.coverageRatio;\n\t\tvar minDistance:number = maxDistance*(1 - this._fadeRatio);\n\n\t\tmaxDistance = near + maxDistance*d;\n\t\tminDistance = near + minDistance*d;\n\n\t\tvar fragmentData:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number /*int*/ = methodVO.secondaryFragmentConstantsIndex;\n\t\tfragmentData[index] = minDistance;\n\t\tfragmentData[index + 1] = 1/(maxDistance - minDistance);\n\n\t\tthis._baseMethod.iSetRenderState(shaderObject, methodVO, renderable, stage, camera);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetVertexCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn this._baseMethod.iGetVertexCode(shaderObject, methodVO, registerCache, sharedRegisters);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iReset()\n\t{\n\t\tthis._baseMethod.iReset();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iCleanCompilationData()\n\t{\n\t\tsuper.iCleanCompilationData();\n\t\tthis._baseMethod.iCleanCompilationData();\n\t}\n\n\t/**\n\t * Called when the base method's shader code is invalidated.\n\t */\n\tprivate onShaderInvalidated(event:ShadingMethodEvent)\n\t{\n\t\tthis.iInvalidateShaderProgram();\n\t}\n}\n\nexport = ShadowNearMethod;","import PoissonLookup\t\t\t\t\t= require(\"awayjs-core/lib/geom/PoissonLookup\");\n\nimport DirectionalLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport ShadowMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMethodBase\");\n\n/**\n * ShadowSoftMethod provides a soft shadowing technique by randomly distributing sample points.\n */\nclass ShadowSoftMethod extends ShadowMethodBase\n{\n\tprivate _range:number = 1;\n\tprivate _numSamples:number /*int*/;\n\tprivate _offsets:Array<number>;\n\n\t/**\n\t * Creates a new DiffuseBasicMethod object.\n\t *\n\t * @param castingLight The light casting the shadows\n\t * @param numSamples The amount of samples to take for dithering. Minimum 1, maximum 32.\n\t */\n\tconstructor(castingLight:DirectionalLight, numSamples:number /*int*/ = 5, range:number = 1)\n\t{\n\t\tsuper(castingLight);\n\n\t\tthis.numSamples = numSamples;\n\t\tthis.range = range;\n\t}\n\n\t/**\n\t * The amount of samples to take for dithering. Minimum 1, maximum 32. The actual maximum may depend on the\n\t * complexity of the shader.\n\t */\n\tpublic get numSamples():number /*int*/\n\t{\n\t\treturn this._numSamples;\n\t}\n\n\tpublic set numSamples(value:number /*int*/)\n\t{\n\t\tthis._numSamples = value;\n\t\t\n\t\tif (this._numSamples < 1)\n\t\t\tthis._numSamples = 1;\n\t\telse if (this._numSamples > 32)\n\t\t\tthis._numSamples = 32;\n\n\t\tthis._offsets = PoissonLookup.getDistribution(this._numSamples);\n\t\t\n\t\tthis.iInvalidateShaderProgram();\n\t}\n\n\t/**\n\t * The range in the shadow map in which to distribute the samples.\n\t */\n\tpublic get range():number\n\t{\n\t\treturn this._range;\n\t}\n\n\tpublic set range(value:number)\n\t{\n\t\tthis._range = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tsuper.iInitConstants(shaderObject, methodVO);\n\n\t\tshaderObject.fragmentConstantData[methodVO.fragmentConstantsIndex + 8] = 1/this._numSamples;\n\t\tshaderObject.fragmentConstantData[methodVO.fragmentConstantsIndex + 9] = 0;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tsuper.iActivate(shaderObject, methodVO, stage);\n\n\t\tvar texRange:number = .5*this._range/this._pCastingLight.shadowMapper.depthMapSize;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number /*uint*/ = methodVO.fragmentConstantsIndex + 10;\n\t\tvar len:number /*uint*/ = this._numSamples << 1;\n\n\t\tfor (var i:number /*int*/ = 0; i < len; ++i)\n\t\t\tdata[index + i] = this._offsets[i]*texRange;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pGetPlanarFragmentCode(methodVO:MethodVO, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\t// todo: move some things to super\n\t\tvar depthMapRegister:ShaderRegisterElement = regCache.getFreeTextureReg();\n\t\tvar decReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\t\tvar dataReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\t\tvar customDataReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\n\t\tmethodVO.fragmentConstantsIndex = decReg.index*4;\n\t\tmethodVO.texturesIndex = depthMapRegister.index;\n\n\t\treturn this.getSampleCode(regCache, depthMapRegister, decReg, targetReg, customDataReg);\n\t}\n\n\t/**\n\t * Adds the code for another tap to the shader code.\n\t * @param uv The uv register for the tap.\n\t * @param texture The texture register containing the depth map.\n\t * @param decode The register containing the depth map decoding data.\n\t * @param target The target register to add the tap comparison result.\n\t * @param regCache The register cache managing the registers.\n\t * @return\n\t */\n\tprivate addSample(uv:ShaderRegisterElement, texture:ShaderRegisterElement, decode:ShaderRegisterElement, target:ShaderRegisterElement, regCache:ShaderRegisterCache):string\n\t{\n\t\tvar temp:ShaderRegisterElement = regCache.getFreeFragmentVectorTemp();\n\t\treturn \"tex \" + temp + \", \" + uv + \", \" + texture + \" <2d,nearest,clamp>\\n\" +\n\t\t\t\"dp4 \" + temp + \".z, \" + temp + \", \" + decode + \"\\n\" +\n\t\t\t\"slt \" + uv + \".w, \" + this._pDepthMapCoordReg + \".z, \" + temp + \".z\\n\" + // 0 if in shadow\n\t\t\t\"add \" + target + \".w, \" + target + \".w, \" + uv + \".w\\n\";\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivateForCascade(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tsuper.iActivate(shaderObject, methodVO, stage);\n\n\t\tvar texRange:number = this._range/this._pCastingLight.shadowMapper.depthMapSize;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tvar index:number /*uint*/ = methodVO.secondaryFragmentConstantsIndex;\n\t\tvar len:number /*uint*/ = this._numSamples << 1;\n\t\tdata[index] = 1/this._numSamples;\n\t\tdata[index + 1] = 0;\n\t\tindex += 2;\n\n\t\tfor (var i:number /*int*/ = 0; i < len; ++i)\n\t\t\tdata[index + i] = this._offsets[i]*texRange;\n\n\t\tif (len%4 == 0) {\n\t\t\tdata[index + len] = 0;\n\t\t\tdata[index + len + 1] = 0;\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGetCascadeFragmentCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, decodeRegister:ShaderRegisterElement, depthTexture:ShaderRegisterElement, depthProjection:ShaderRegisterElement, targetRegister:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tthis._pDepthMapCoordReg = depthProjection;\n\n\t\tvar dataReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tmethodVO.secondaryFragmentConstantsIndex = dataReg.index*4;\n\n\t\treturn this.getSampleCode(registerCache, depthTexture, decodeRegister, targetRegister, dataReg);\n\t}\n\n\t/**\n\t * Get the actual shader code for shadow mapping\n\t * @param regCache The register cache managing the registers.\n\t * @param depthTexture The texture register containing the depth map.\n\t * @param decodeRegister The register containing the depth map decoding data.\n\t * @param targetReg The target register to add the shadow coverage.\n\t * @param dataReg The register containing additional data.\n\t */\n\tprivate getSampleCode(regCache:ShaderRegisterCache, depthTexture:ShaderRegisterElement, decodeRegister:ShaderRegisterElement, targetRegister:ShaderRegisterElement, dataReg:ShaderRegisterElement):string\n\t{\n\t\tvar uvReg:ShaderRegisterElement;\n\t\tvar code:string;\n\t\tvar offsets:Array<string> = new Array<string>(dataReg + \".zw\");\n\t\tuvReg = regCache.getFreeFragmentVectorTemp();\n\t\tregCache.addFragmentTempUsages(uvReg, 1);\n\n\t\tvar temp:ShaderRegisterElement = regCache.getFreeFragmentVectorTemp();\n\n\t\tvar numRegs:number /*int*/ = this._numSamples >> 1;\n\t\tfor (var i:number /*int*/ = 0; i < numRegs; ++i) {\n\t\t\tvar reg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\t\t\toffsets.push(reg + \".xy\");\n\t\t\toffsets.push(reg + \".zw\");\n\t\t}\n\n\t\tfor (i = 0; i < this._numSamples; ++i) {\n\t\t\tif (i == 0) {\n\t\t\t\tcode = \"add \" + uvReg + \", \" + this._pDepthMapCoordReg + \", \" + dataReg + \".zwyy\\n\" +\n\t\t\t\t\t\"tex \" + temp + \", \" + uvReg + \", \" + depthTexture + \" <2d,nearest,clamp>\\n\" +\n\t\t\t\t\t\"dp4 \" + temp + \".z, \" + temp + \", \" + decodeRegister + \"\\n\" +\n\t\t\t\t\t\"slt \" + targetRegister + \".w, \" + this._pDepthMapCoordReg + \".z, \" + temp + \".z\\n\"; // 0 if in shadow;\n\t\t\t} else {\n\t\t\t\tcode += \"add \" + uvReg + \".xy, \" + this._pDepthMapCoordReg + \".xy, \" + offsets[i] + \"\\n\" +\n\t\t\t\t\tthis.addSample(uvReg, depthTexture, decodeRegister, targetRegister, regCache);\n\t\t\t}\n\t\t}\n\n\t\tregCache.removeFragmentTempUsage(uvReg);\n\n\t\tcode += \"mul \" + targetRegister + \".w, \" + targetRegister + \".w, \" + dataReg + \".x\\n\"; // average\n\n\t\treturn code;\n\t}\n}\n\nexport = ShadowSoftMethod;","import ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport SpecularBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularBasicMethod\");\n\n/**\n * SpecularAnisotropicMethod provides a specular method resulting in anisotropic highlights. These are typical for\n * surfaces with microfacet details such as tiny grooves. In particular, this uses the Heidrich-Seidel distrubution.\n * The tangent vectors are used as the surface groove directions.\n */\nclass SpecularAnisotropicMethod extends SpecularBasicMethod\n{\n\t/**\n\t * Creates a new SpecularAnisotropicMethod object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderLightingObject, methodVO:MethodVO)\n\t{\n\t\tmethodVO.needsTangents = true;\n\t\tmethodVO.needsView = true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCodePerLight(shaderObject:ShaderLightingObject, methodVO:MethodVO, lightDirReg:ShaderRegisterElement, lightColReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar t:ShaderRegisterElement;\n\n\t\tif (this._pIsFirstLight)\n\t\t\tt = this._pTotalLightColorReg;\n\t\telse {\n\t\t\tt = registerCache.getFreeFragmentVectorTemp();\n\t\t\tregisterCache.addFragmentTempUsages(t, 1);\n\t\t}\n\n\t\t// (sin(l,t) * sin(v,t) - cos(l,t)*cos(v,t)) ^ k\n\n\t\tcode += \"nrm \" + t + \".xyz, \" + sharedRegisters.tangentVarying + \".xyz\\n\" +\n\t\t\t\"dp3 \" + t + \".w, \" + t + \".xyz, \" + lightDirReg + \".xyz\\n\" +\n\t\t\t\"dp3 \" + t + \".z, \" + t + \".xyz, \" + sharedRegisters.viewDirFragment + \".xyz\\n\";\n\n\t\t// (sin(t.w) * sin(t.z) - cos(t.w)*cos(t.z)) ^ k\n\t\tcode += \"sin \" + t + \".x, \" + t + \".w\\n\" +\n\t\t\t\"sin \" + t + \".y, \" + t + \".z\\n\" +\n\t\t\t// (t.x * t.y - cos(t.w)*cos(t.z)) ^ k\n\t\t\t\"mul \" + t + \".x, \" + t + \".x, \" + t + \".y\\n\" +\n\t\t\t// (t.x - cos(t.w)*cos(t.z)) ^ k\n\t\t\t\"cos \" + t + \".z, \" + t + \".z\\n\" +\n\t\t\t\"cos \" + t + \".w, \" + t + \".w\\n\" +\n\t\t\t// (t.x - t.w*t.z) ^ k\n\t\t\t\"mul \" + t + \".w, \" + t + \".w, \" + t + \".z\\n\" +\n\t\t\t// (t.x - t.w) ^ k\n\t\t\t\"sub \" + t + \".w, \" + t + \".x, \" + t + \".w\\n\";\n\n\t\tif (this._pUseTexture) {\n\t\t\t// apply gloss modulation from texture\n\t\t\tcode += \"mul \" + this._pSpecularTexData + \".w, \" + this._pSpecularTexData + \".y, \" + this._pSpecularDataRegister + \".w\\n\" +\n\t\t\t\t\"pow \" + t + \".w, \" + t + \".w, \" + this._pSpecularTexData + \".w\\n\";\n\t\t} else\n\t\t\tcode += \"pow \" + t + \".w, \" + t + \".w, \" + this._pSpecularDataRegister + \".w\\n\";\n\n\t\t// attenuate\n\t\tcode += \"mul \" + t + \".w, \" + t + \".w, \" + lightDirReg + \".w\\n\";\n\n\t\tif (this._iModulateMethod != null)\n\t\t\tcode += this._iModulateMethod(shaderObject, methodVO, t, registerCache, sharedRegisters);\n\n\t\tcode += \"mul \" + t + \".xyz, \" + lightColReg + \".xyz, \" + t + \".w\\n\";\n\n\t\tif (!this._pIsFirstLight) {\n\t\t\tcode += \"add \" + this._pTotalLightColorReg + \".xyz, \" + this._pTotalLightColorReg + \".xyz, \" + t + \".xyz\\n\";\n\t\t\tregisterCache.removeFragmentTempUsage(t);\n\t\t}\n\n\t\tthis._pIsFirstLight = false;\n\n\t\treturn code;\n\t}\n}\n\nexport = SpecularAnisotropicMethod;","import Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderLightingObject\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\n\nimport MethodVO\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport LightingMethodBase\t\t\t= require(\"awayjs-methodmaterials/lib/methods/LightingMethodBase\");\nimport ShadingMethodBase\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadingMethodBase\");\n\n/**\n * SpecularBasicMethod provides the default shading method for Blinn-Phong specular highlights (an optimized but approximated\n * version of Phong specularity).\n */\nclass SpecularBasicMethod extends LightingMethodBase\n{\n\tpublic _pUseTexture:boolean;\n\tpublic _pTotalLightColorReg:ShaderRegisterElement;\n\tpublic _pSpecularTextureRegister:ShaderRegisterElement;\n\tpublic _pSpecularTexData:ShaderRegisterElement;\n\tpublic _pSpecularDataRegister:ShaderRegisterElement;\n\n\tprivate _texture:Texture2DBase;\n\n\tprivate _gloss:number = 50;\n\tprivate _specular:number = 1;\n\tprivate _specularColor:number = 0xffffff;\n\tpublic _iSpecularR:number = 1;\n\tpublic _iSpecularG:number = 1;\n\tpublic _iSpecularB:number = 1;\n\tpublic _pIsFirstLight:boolean;\n\n\t/**\n\t * Creates a new SpecularBasicMethod object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\tpublic iIsUsed(shaderObject:ShaderLightingObject):boolean\n\t{\n\t\tif (!shaderObject.numLights)\n\t\t\treturn false;\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderLightingObject, methodVO:MethodVO)\n\t{\n\t\tmethodVO.needsUV = this._pUseTexture;\n\t\tmethodVO.needsNormals = shaderObject.numLights > 0;\n\t\tmethodVO.needsView = shaderObject.numLights > 0;\n\t}\n\n\t/**\n\t * The sharpness of the specular highlight.\n\t */\n\tpublic get gloss():number\n\t{\n\t\treturn this._gloss;\n\t}\n\n\tpublic set gloss(value:number)\n\t{\n\t\tthis._gloss = value;\n\t}\n\n\t/**\n\t * The overall strength of the specular highlights.\n\t */\n\tpublic get specular():number\n\t{\n\t\treturn this._specular;\n\t}\n\n\tpublic set specular(value:number)\n\t{\n\t\tif (value == this._specular)\n\t\t\treturn;\n\n\t\tthis._specular = value;\n\t\tthis.updateSpecular();\n\t}\n\n\t/**\n\t * The colour of the specular reflection of the surface.\n\t */\n\tpublic get specularColor():number\n\t{\n\t\treturn this._specularColor;\n\t}\n\n\tpublic set specularColor(value:number)\n\t{\n\t\tif (this._specularColor == value)\n\t\t\treturn;\n\n\t\t// specular is now either enabled or disabled\n\t\tif (this._specularColor == 0 || value == 0)\n\t\t\tthis.iInvalidateShaderProgram();\n\n\t\tthis._specularColor = value;\n\t\tthis.updateSpecular();\n\t}\n\n\t/**\n\t * The bitmapData that encodes the specular highlight strength per texel in the red channel, and the sharpness\n\t * in the green channel. You can use SpecularBitmapTexture if you want to easily set specular and gloss maps\n\t * from grayscale images, but prepared images are preferred.\n\t */\n\tpublic get texture():Texture2DBase\n\t{\n\t\treturn this._texture;\n\t}\n\n\tpublic set texture(value:Texture2DBase)\n\t{\n\t\tvar b:boolean = ( value != null );\n\n\t\tif (b != this._pUseTexture || (value && this._texture && (value.format != this._texture.format)))\n\t\t\tthis.iInvalidateShaderProgram();\n\n\t\tthis._pUseTexture = b;\n\t\tthis._texture = value;\n\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic copyFrom(method:ShadingMethodBase)\n\t{\n\n\t\tvar m:any = method;\n\t\tvar bsm:SpecularBasicMethod = <SpecularBasicMethod> method;\n\n\t\tvar spec:SpecularBasicMethod = bsm;//SpecularBasicMethod(method);\n\t\tthis.texture = spec.texture;\n\t\tthis.specular = spec.specular;\n\t\tthis.specularColor = spec.specularColor;\n\t\tthis.gloss = spec.gloss;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iCleanCompilationData()\n\t{\n\t\tsuper.iCleanCompilationData();\n\t\tthis._pTotalLightColorReg = null;\n\t\tthis._pSpecularTextureRegister = null;\n\t\tthis._pSpecularTexData = null;\n\t\tthis._pSpecularDataRegister = null;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPreLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\n\t\tthis._pIsFirstLight = true;\n\n\t\tthis._pSpecularDataRegister = registerCache.getFreeFragmentConstant();\n\t\tmethodVO.fragmentConstantsIndex = this._pSpecularDataRegister.index*4;\n\n\t\tif (this._pUseTexture) {\n\n\t\t\tthis._pSpecularTexData = registerCache.getFreeFragmentVectorTemp();\n\t\t\tregisterCache.addFragmentTempUsages(this._pSpecularTexData, 1);\n\t\t\tthis._pSpecularTextureRegister = registerCache.getFreeTextureReg();\n\t\t\tmethodVO.texturesIndex = this._pSpecularTextureRegister.index;\n\t\t\tcode = ShaderCompilerHelper.getTex2DSampleCode(this._pSpecularTexData, sharedRegisters, this._pSpecularTextureRegister, this._texture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping);\n\n\t\t} else {\n\n\t\t\tthis._pSpecularTextureRegister = null;\n\t\t}\n\n\t\tthis._pTotalLightColorReg = registerCache.getFreeFragmentVectorTemp();\n\t\tregisterCache.addFragmentTempUsages(this._pTotalLightColorReg, 1);\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCodePerLight(shaderObject:ShaderLightingObject, methodVO:MethodVO, lightDirReg:ShaderRegisterElement, lightColReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar t:ShaderRegisterElement;\n\n\t\tif (this._pIsFirstLight) {\n\t\t\tt = this._pTotalLightColorReg;\n\t\t} else {\n\t\t\tt = registerCache.getFreeFragmentVectorTemp();\n\t\t\tregisterCache.addFragmentTempUsages(t, 1);\n\t\t}\n\n\t\tvar viewDirReg:ShaderRegisterElement = sharedRegisters.viewDirFragment;\n\t\tvar normalReg:ShaderRegisterElement = sharedRegisters.normalFragment;\n\n\t\t// blinn-phong half vector model\n\t\tcode += \"add \" + t + \", \" + lightDirReg + \", \" + viewDirReg + \"\\n\" +\n\t\t\t\t\"nrm \" + t + \".xyz, \" + t + \"\\n\" +\n\t\t\t\t\"dp3 \" + t + \".w, \" + normalReg + \", \" + t + \"\\n\" +\n\t\t\t\t\"sat \" + t + \".w, \" + t + \".w\\n\";\n\n\t\tif (this._pUseTexture) {\n\t\t\t// apply gloss modulation from texture\n\t\t\tcode += \"mul \" + this._pSpecularTexData + \".w, \" + this._pSpecularTexData + \".y, \" + this._pSpecularDataRegister + \".w\\n\" +\n\t\t\t\t\t\"pow \" + t + \".w, \" + t + \".w, \" + this._pSpecularTexData + \".w\\n\";\n\t\t} else {\n\t\t\tcode += \"pow \" + t + \".w, \" + t + \".w, \" + this._pSpecularDataRegister + \".w\\n\";\n\t\t}\n\n\t\t// attenuate\n\t\tif (shaderObject.usesLightFallOff)\n\t\t\tcode += \"mul \" + t + \".w, \" + t + \".w, \" + lightDirReg + \".w\\n\";\n\n\t\tif (this._iModulateMethod != null)\n\t\t\tcode += this._iModulateMethod(shaderObject, methodVO, t, registerCache, sharedRegisters);\n\n\t\tcode += \"mul \" + t + \".xyz, \" + lightColReg + \", \" + t + \".w\\n\";\n\n\t\tif (!this._pIsFirstLight) {\n\t\t\tcode += \"add \" + this._pTotalLightColorReg + \".xyz, \" + this._pTotalLightColorReg + \", \" + t + \"\\n\";\n\t\t\tregisterCache.removeFragmentTempUsage(t);\n\t\t}\n\n\t\tthis._pIsFirstLight = false;\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCodePerProbe(shaderObject:ShaderLightingObject, methodVO:MethodVO, cubeMapReg:ShaderRegisterElement, weightRegister:string, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar t:ShaderRegisterElement;\n\n\t\t// write in temporary if not first light, so we can add to total diffuse colour\n\t\tif (this._pIsFirstLight) {\n\t\t\tt = this._pTotalLightColorReg;\n\t\t} else {\n\t\t\tt = registerCache.getFreeFragmentVectorTemp();\n\t\t\tregisterCache.addFragmentTempUsages(t, 1);\n\t\t}\n\n\t\tvar normalReg:ShaderRegisterElement = sharedRegisters.normalFragment;\n\t\tvar viewDirReg:ShaderRegisterElement = sharedRegisters.viewDirFragment;\n\n\t\tcode += \"dp3 \" + t + \".w, \" + normalReg + \", \" + viewDirReg + \"\\n\" +\n\t\t\t\t\"add \" + t + \".w, \" + t + \".w, \" + t + \".w\\n\" +\n\t\t\t\t\"mul \" + t + \", \" + t + \".w, \" + normalReg + \"\\n\" +\n\t\t\t\t\"sub \" + t + \", \" + t + \", \" + viewDirReg + \"\\n\" +\n\t\t\t\t\"tex \" + t + \", \" + t + \", \" + cubeMapReg + \" <cube,\" + (shaderObject.useSmoothTextures? \"linear\":\"nearest\") + \",miplinear>\\n\" +\n\t\t\t\t\"mul \" + t + \".xyz, \" + t + \", \" + weightRegister + \"\\n\";\n\n\t\tif (this._iModulateMethod != null)\n\t\t\tcode += this._iModulateMethod(shaderObject, methodVO, t, registerCache, sharedRegisters);\n\n\t\tif (!this._pIsFirstLight) {\n\t\t\tcode += \"add \" + this._pTotalLightColorReg + \".xyz, \" + this._pTotalLightColorReg + \", \" + t + \"\\n\";\n\t\t\tregisterCache.removeFragmentTempUsage(t);\n\t\t}\n\n\t\tthis._pIsFirstLight = false;\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPostLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\n\t\tif (sharedRegisters.shadowTarget)\n\t\t\tcode += \"mul \" + this._pTotalLightColorReg + \".xyz, \" + this._pTotalLightColorReg + \", \" + sharedRegisters.shadowTarget + \".w\\n\";\n\n\t\tif (this._pUseTexture) {\n\t\t\t// apply strength modulation from texture\n\t\t\tcode += \"mul \" + this._pTotalLightColorReg + \".xyz, \" + this._pTotalLightColorReg + \", \" + this._pSpecularTexData + \".x\\n\";\n\t\t\tregisterCache.removeFragmentTempUsage(this._pSpecularTexData);\n\t\t}\n\n\t\t// apply material's specular reflection\n\t\tcode += \"mul \" + this._pTotalLightColorReg + \".xyz, \" + this._pTotalLightColorReg + \", \" + this._pSpecularDataRegister + \"\\n\" +\n\t\t\t\"add \" + targetReg + \".xyz, \" + targetReg + \", \" + this._pTotalLightColorReg + \"\\n\";\n\t\tregisterCache.removeFragmentTempUsage(this._pTotalLightColorReg);\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderLightingObject, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tif (methodVO.texturesIndex >= 0)\n\t\t\tstage.activateTexture(methodVO.texturesIndex, this._texture, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\n\t\tvar index:number = methodVO.fragmentConstantsIndex;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tdata[index] = this._iSpecularR;\n\t\tdata[index + 1] = this._iSpecularG;\n\t\tdata[index + 2] = this._iSpecularB;\n\t\tdata[index + 3] = this._gloss;\n\t}\n\n\t/**\n\t * Updates the specular color data used by the render state.\n\t */\n\tprivate updateSpecular()\n\t{\n\t\tthis._iSpecularR = (( this._specularColor >> 16) & 0xff)/0xff*this._specular;\n\t\tthis._iSpecularG = (( this._specularColor >> 8) & 0xff)/0xff*this._specular;\n\t\tthis._iSpecularB = ( this._specularColor & 0xff)/0xff*this._specular;\n\t}\n}\n\nexport = SpecularBasicMethod;","import Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport SpecularBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularBasicMethod\");\nimport SpecularCompositeMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularCompositeMethod\");\n\n/**\n * SpecularCelMethod provides a shading method to add specular cel (cartoon) shading.\n */\nclass SpecularCelMethod extends SpecularCompositeMethod\n{\n\tprivate _dataReg:ShaderRegisterElement;\n\tprivate _smoothness:number = .1;\n\tprivate _specularCutOff:number = .1;\n\n\t/**\n\t * Creates a new SpecularCelMethod object.\n\t * @param specularCutOff The threshold at which the specular highlight should be shown.\n\t * @param baseMethod An optional specular method on which the cartoon shading is based. If ommitted, SpecularBasicMethod is used.\n\t */\n\tconstructor(specularCutOff:number = .5, baseMethod:SpecularBasicMethod = null)\n\t{\n\t\tsuper(null, baseMethod);\n\n\t\tthis.baseMethod._iModulateMethod = (shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData) => this.clampSpecular(shaderObject, methodVO, targetReg, registerCache, sharedRegisters);\n\n\t\tthis._specularCutOff = specularCutOff;\n\t}\n\n\t/**\n\t * The smoothness of the highlight edge.\n\t */\n\tpublic get smoothness():number\n\t{\n\t\treturn this._smoothness;\n\t}\n\n\tpublic set smoothness(value:number)\n\t{\n\t\tthis._smoothness = value;\n\t}\n\n\t/**\n\t * The threshold at which the specular highlight should be shown.\n\t */\n\tpublic get specularCutOff():number\n\t{\n\t\treturn this._specularCutOff;\n\t}\n\n\tpublic set specularCutOff(value:number)\n\t{\n\t\tthis._specularCutOff = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderLightingObject, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tsuper.iActivate(shaderObject, methodVO, stage);\n\n\t\tvar index:number /*int*/ = methodVO.secondaryFragmentConstantsIndex;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tdata[index] = this._smoothness;\n\t\tdata[index + 1] = this._specularCutOff;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iCleanCompilationData()\n\t{\n\t\tsuper.iCleanCompilationData();\n\t\tthis._dataReg = null;\n\t}\n\n\t/**\n\t * Snaps the specular shading strength of the wrapped method to zero or one, depending on whether or not it exceeds the specularCutOff\n\t * @param vo The MethodVO used to compile the current shader.\n\t * @param t The register containing the specular strength in the \"w\" component, and either the half-vector or the reflection vector in \"xyz\".\n\t * @param regCache The register cache used for the shader compilation.\n\t * @param sharedRegisters The shared register data for this shader.\n\t * @return The AGAL fragment code for the method.\n\t */\n\tprivate clampSpecular(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"sub \" + targetReg + \".y, \" + targetReg + \".w, \" + this._dataReg + \".y\\n\" + // x - cutoff\n\t\t\t\"div \" + targetReg + \".y, \" + targetReg + \".y, \" + this._dataReg + \".x\\n\" + // (x - cutoff)/epsilon\n\t\t\t\"sat \" + targetReg + \".y, \" + targetReg + \".y\\n\" +\n\t\t\t\"sge \" + targetReg + \".w, \" + targetReg + \".w, \" + this._dataReg + \".y\\n\" +\n\t\t\t\"mul \" + targetReg + \".w, \" + targetReg + \".w, \" + targetReg + \".y\\n\";\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPreLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tthis._dataReg = registerCache.getFreeFragmentConstant();\n\t\tmethodVO.secondaryFragmentConstantsIndex = this._dataReg.index*4;\n\n\t\treturn super.iGetFragmentPreLightingCode(shaderObject, methodVO, registerCache, sharedRegisters);\n\t}\n}\n\nexport = SpecularCelMethod;","import Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport ShadingMethodEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/ShadingMethodEvent\");\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport SpecularBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularBasicMethod\");\n\n/**\n * SpecularCompositeMethod provides a base class for specular methods that wrap a specular method to alter the\n * calculated specular reflection strength.\n */\nclass SpecularCompositeMethod extends SpecularBasicMethod\n{\n\tprivate _baseMethod:SpecularBasicMethod;\n\n\tprivate _onShaderInvalidatedDelegate:Function;\n\n\t/**\n\t * Creates a new <code>SpecularCompositeMethod</code> object.\n\t *\n\t * @param modulateMethod The method which will add the code to alter the base method's strength. It needs to have the signature modSpecular(t:ShaderRegisterElement, regCache:ShaderRegisterCache):string, in which t.w will contain the specular strength and t.xyz will contain the half-vector or the reflection vector.\n\t * @param baseMethod The base specular method on which this method's shading is based.\n\t */\n\tconstructor(modulateMethod:(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData) => string, baseMethod:SpecularBasicMethod = null)\n\t{\n\t\tsuper();\n\n\t\tthis._onShaderInvalidatedDelegate = (event:ShadingMethodEvent) => this.onShaderInvalidated(event);\n\n\t\tthis._baseMethod = baseMethod || new SpecularBasicMethod();\n\t\tthis._baseMethod._iModulateMethod = modulateMethod;\n\t\tthis._baseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, this._onShaderInvalidatedDelegate);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitVO(shaderObject:ShaderLightingObject, methodVO:MethodVO)\n\t{\n\t\tthis._baseMethod.iInitVO(shaderObject, methodVO);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tthis._baseMethod.iInitConstants(shaderObject, methodVO);\n\t}\n\n\t/**\n\t * The base specular method on which this method's shading is based.\n\t */\n\tpublic get baseMethod():SpecularBasicMethod\n\t{\n\t\treturn this._baseMethod;\n\t}\n\n\tpublic set baseMethod(value:SpecularBasicMethod)\n\t{\n\t\tif (this._baseMethod == value)\n\t\t\treturn;\n\n\t\tthis._baseMethod.removeEventListener(ShadingMethodEvent.SHADER_INVALIDATED, this._onShaderInvalidatedDelegate);\n\n\t\tthis._baseMethod = value;\n\n\t\tthis._baseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, this._onShaderInvalidatedDelegate);\n\n\t\tthis.iInvalidateShaderProgram();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get gloss():number\n\t{\n\t\treturn this._baseMethod.gloss;\n\t}\n\n\tpublic set gloss(value:number)\n\t{\n\t\tthis._baseMethod.gloss = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get specular():number\n\t{\n\t\treturn this._baseMethod.specular;\n\t}\n\n\tpublic set specular(value:number)\n\t{\n\t\tthis._baseMethod.specular = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._baseMethod.removeEventListener(ShadingMethodEvent.SHADER_INVALIDATED, this._onShaderInvalidatedDelegate);\n\t\tthis._baseMethod.dispose();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get texture():Texture2DBase\n\t{\n\t\treturn this._baseMethod.texture;\n\t}\n\n\tpublic set texture(value:Texture2DBase)\n\t{\n\t\tthis._baseMethod.texture = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderLightingObject, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tthis._baseMethod.iActivate(shaderObject, methodVO, stage);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iSetRenderState(shaderObject:ShaderLightingObject, methodVO:MethodVO, renderable:RenderableBase, stage:Stage, camera:Camera)\n\t{\n\t\tthis._baseMethod.iSetRenderState(shaderObject, methodVO, renderable, stage, camera);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iDeactivate(shaderObject:ShaderObjectBase, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tthis._baseMethod.iDeactivate(shaderObject, methodVO, stage);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetVertexCode(shaderObject:ShaderObjectBase, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn this._baseMethod.iGetVertexCode(shaderObject, methodVO, registerCache, sharedRegisters);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPreLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn this._baseMethod.iGetFragmentPreLightingCode(shaderObject, methodVO, registerCache, sharedRegisters);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCodePerLight(shaderObject:ShaderLightingObject, methodVO:MethodVO, lightDirReg:ShaderRegisterElement, lightColReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn this._baseMethod.iGetFragmentCodePerLight(shaderObject, methodVO, lightDirReg, lightColReg, registerCache, sharedRegisters);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t * @return\n\t */\n\tpublic iGetFragmentCodePerProbe(shaderObject:ShaderLightingObject, methodVO:MethodVO, cubeMapReg:ShaderRegisterElement, weightRegister:string, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn this._baseMethod.iGetFragmentCodePerProbe(shaderObject, methodVO, cubeMapReg, weightRegister, registerCache, sharedRegisters);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPostLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn this._baseMethod.iGetFragmentPostLightingCode(shaderObject, methodVO, targetReg, registerCache, sharedRegisters);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iReset()\n\t{\n\t\tthis._baseMethod.iReset();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iCleanCompilationData()\n\t{\n\t\tsuper.iCleanCompilationData();\n\t\tthis._baseMethod.iCleanCompilationData();\n\t}\n\n\t/**\n\t * Called when the base method's shader code is invalidated.\n\t */\n\tprivate onShaderInvalidated(event:ShadingMethodEvent)\n\t{\n\t\tthis.iInvalidateShaderProgram();\n\t}\n}\n\nexport = SpecularCompositeMethod;","import Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport SpecularBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularBasicMethod\");\nimport SpecularCompositeMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularCompositeMethod\");\n\n/**\n * SpecularFresnelMethod provides a specular shading method that causes stronger highlights on grazing view angles.\n */\nclass SpecularFresnelMethod extends SpecularCompositeMethod\n{\n\tprivate _dataReg:ShaderRegisterElement;\n\tprivate _incidentLight:boolean;\n\tprivate _fresnelPower:number = 5;\n\tprivate _normalReflectance:number = .028; // default value for skin\n\n\t/**\n\t * Creates a new SpecularFresnelMethod object.\n\t * @param basedOnSurface Defines whether the fresnel effect should be based on the view angle on the surface (if true), or on the angle between the light and the view.\n\t * @param baseMethod The specular method to which the fresnel equation. Defaults to SpecularBasicMethod.\n\t */\n\tconstructor(basedOnSurface:boolean = true, baseMethod:SpecularBasicMethod = null)\n\t{\n\t\t// may want to offer diff speculars\n\t\tsuper(null, baseMethod);\n\n\t\tthis.baseMethod._iModulateMethod = (shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData) => this.modulateSpecular(shaderObject, methodVO, targetReg, registerCache, sharedRegisters);\n\n\t\tthis._incidentLight = !basedOnSurface;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iInitConstants(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\n\t\tvar index:number = methodVO.secondaryFragmentConstantsIndex;\n\t\tshaderObject.fragmentConstantData[index + 2] = 1;\n\t\tshaderObject.fragmentConstantData[index + 3] = 0;\n\t}\n\n\t/**\n\t * Defines whether the fresnel effect should be based on the view angle on the surface (if true), or on the angle between the light and the view.\n\t */\n\tpublic get basedOnSurface():boolean\n\t{\n\t\treturn !this._incidentLight;\n\t}\n\n\tpublic set basedOnSurface(value:boolean)\n\t{\n\t\tif (this._incidentLight != value)\n\t\t\treturn;\n\n\t\tthis._incidentLight = !value;\n\n\t\tthis.iInvalidateShaderProgram();\n\t}\n\n\t/**\n\t * The power used in the Fresnel equation. Higher values make the fresnel effect more pronounced. Defaults to 5.\n\t */\n\tpublic get fresnelPower():number\n\t{\n\t\treturn this._fresnelPower;\n\t}\n\n\tpublic set fresnelPower(value:number)\n\t{\n\t\tthis._fresnelPower = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iCleanCompilationData()\n\t{\n\t\tsuper.iCleanCompilationData();\n\t\tthis._dataReg = null;\n\t}\n\n\t/**\n\t * The minimum amount of reflectance, ie the reflectance when the view direction is normal to the surface or light direction.\n\t */\n\tpublic get normalReflectance():number\n\t{\n\t\treturn this._normalReflectance;\n\t}\n\n\tpublic set normalReflectance(value:number)\n\t{\n\t\tthis._normalReflectance = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iActivate(shaderObject:ShaderLightingObject, methodVO:MethodVO, stage:Stage)\n\t{\n\t\tsuper.iActivate(shaderObject, methodVO, stage);\n\n\t\tvar fragmentData:Array<number> = shaderObject.fragmentConstantData;\n\n\t\tvar index:number = methodVO.secondaryFragmentConstantsIndex;\n\t\tfragmentData[index] = this._normalReflectance;\n\t\tfragmentData[index + 1] = this._fresnelPower;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentPreLightingCode(shaderObject:ShaderLightingObject, methodVO:MethodVO, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tthis._dataReg = registerCache.getFreeFragmentConstant();\n\n\t\tmethodVO.secondaryFragmentConstantsIndex = this._dataReg.index*4;\n\n\t\treturn super.iGetFragmentPreLightingCode(shaderObject, methodVO, registerCache, sharedRegisters);\n\t}\n\n\t/**\n\t * Applies the fresnel effect to the specular strength.\n\t *\n\t * @param vo The MethodVO object containing the method data for the currently compiled material pass.\n\t * @param target The register containing the specular strength in the \"w\" component, and the half-vector/reflection vector in \"xyz\".\n\t * @param regCache The register cache used for the shader compilation.\n\t * @param sharedRegisters The shared registers created by the compiler.\n\t * @return The AGAL fragment code for the method.\n\t */\n\tprivate modulateSpecular(shaderObject:ShaderObjectBase, methodVO:MethodVO, targetReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string;\n\n\t\tcode = \"dp3 \" + targetReg + \".y, \" + sharedRegisters.viewDirFragment + \".xyz, \" + (this._incidentLight? targetReg : sharedRegisters.normalFragment) + \".xyz\\n\" +   // dot(V, H)\n\t\t\t\"sub \" + targetReg + \".y, \" + this._dataReg + \".z, \" + targetReg + \".y\\n\" +             // base = 1-dot(V, H)\n\t\t\t\"pow \" + targetReg + \".x, \" + targetReg + \".y, \" + this._dataReg + \".y\\n\" +             // exp = pow(base, 5)\n\t\t\t\"sub \" + targetReg + \".y, \" + this._dataReg + \".z, \" + targetReg + \".y\\n\" +             // 1 - exp\n\t\t\t\"mul \" + targetReg + \".y, \" + this._dataReg + \".x, \" + targetReg + \".y\\n\" +             // f0*(1 - exp)\n\t\t\t\"add \" + targetReg + \".y, \" + targetReg + \".x, \" + targetReg + \".y\\n\" +          // exp + f0*(1 - exp)\n\t\t\t\"mul \" + targetReg + \".w, \" + targetReg + \".w, \" + targetReg + \".y\\n\";\n\n\t\treturn code;\n\t}\n\n}\n\nexport = SpecularFresnelMethod;","import ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport SpecularBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularBasicMethod\");\n\n/**\n * SpecularPhongMethod provides a specular method that provides Phong highlights.\n */\nclass SpecularPhongMethod extends SpecularBasicMethod\n{\n\t/**\n\t * Creates a new SpecularPhongMethod object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic iGetFragmentCodePerLight(shaderObject:ShaderLightingObject, methodVO:MethodVO, lightDirReg:ShaderRegisterElement, lightColReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar t:ShaderRegisterElement;\n\n\t\tif (this._pIsFirstLight) {\n\t\t\tt = this._pTotalLightColorReg;\n\t\t} else {\n\t\t\tt = registerCache.getFreeFragmentVectorTemp();\n\t\t\tregisterCache.addFragmentTempUsages(t, 1);\n\t\t}\n\n\t\tvar viewDirReg:ShaderRegisterElement =sharedRegisters.viewDirFragment;\n\t\tvar normalReg:ShaderRegisterElement =sharedRegisters.normalFragment;\n\n\t\t// phong model\n\t\tcode += \"dp3 \" + t + \".w, \" + lightDirReg + \", \" + normalReg + \"\\n\" + // sca1 = light.normal\n\n\t\t\t//find the reflected light vector R\n\t\t\t\"add \" + t + \".w, \" + t + \".w, \" + t + \".w\\n\" + // sca1 = sca1*2\n\t\t\t\"mul \" + t + \".xyz, \" + normalReg + \", \" + t + \".w\\n\" + // vec1 = normal*sca1\n\t\t\t\"sub \" + t + \".xyz, \" + t + \", \" + lightDirReg + \"\\n\" + // vec1 = vec1 - light (light vector is negative)\n\n\t\t\t//smooth the edge as incidence angle approaches 90\n\t\t\t\"add \" + t + \".w, \" + t + \".w, \" +sharedRegisters.commons + \".w\\n\" + // sca1 = sca1 + smoothtep;\n\t\t\t\"sat \" + t + \".w, \" + t + \".w\\n\" + // sca1 range 0 - 1\n\t\t\t\"mul \" + t + \".xyz, \" + t + \", \" + t + \".w\\n\" + // vec1 = vec1*sca1\n\n\t\t\t//find the dot product between R and V\n\t\t\t\"dp3 \" + t + \".w, \" + t + \", \" + viewDirReg + \"\\n\" + // sca1 = vec1.view\n\t\t\t\"sat \" + t + \".w, \" + t + \".w\\n\";\n\n\t\tif (this._pUseTexture) {\n\t\t\t// apply gloss modulation from texture\n\t\t\tcode += \"mul \" + this._pSpecularTexData + \".w, \" + this._pSpecularTexData + \".y, \" + this._pSpecularDataRegister + \".w\\n\" + \"pow \" + t + \".w, \" + t + \".w, \" + this._pSpecularTexData + \".w\\n\";\n\t\t} else\n\t\t\tcode += \"pow \" + t + \".w, \" + t + \".w, \" + this._pSpecularDataRegister + \".w\\n\";\n\n\t\t// attenuate\n\t\tif (shaderObject.usesLightFallOff)\n\t\t\tcode += \"mul \" + t + \".w, \" + t + \".w, \" + lightDirReg + \".w\\n\";\n\n\t\tif (this._iModulateMethod != null)\n\t\t\tcode += this._iModulateMethod(shaderObject, methodVO, t, registerCache, sharedRegisters);\n\n\t\tcode += \"mul \" + t + \".xyz, \" + lightColReg + \".xyz, \" + t + \".w\\n\";\n\n\t\tif (!this._pIsFirstLight) {\n\t\t\tcode += \"add \" + this._pTotalLightColorReg + \".xyz, \" + this._pTotalLightColorReg + \".xyz, \" + t + \".xyz\\n\";\n\t\t\tregisterCache.removeFragmentTempUsage(t);\n\t\t}\n\n\t\tthis._pIsFirstLight = false;\n\n\t\treturn code;\n\t}\n}\n\nexport = SpecularPhongMethod;","class PassMode\n{\n\t/**\n\t *\n\t */\n\tpublic static EFFECTS:number = 0x01;\n\n\t/**\n\t *\n\t */\n\tpublic static LIGHTING:number = 0x02;\n\n\t/**\n\t *\n\t */\n\tpublic static SUPER_SHADER:number = 0x03;\n}\n\nexport = PassMode;","import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\nimport Matrix\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport AbstractMethodError\t\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\nimport Event\t\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\n\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport IRenderObjectOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport LightPickerBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\nimport LightSources\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/LightSources\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RendererBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\nimport ShaderLightingObject\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShadingMethodEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/ShadingMethodEvent\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport RenderPassBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\nimport IRenderLightingPass\t\t\t\t= require(\"awayjs-renderergl/lib/passes/IRenderLightingPass\");\nimport IRenderableClass\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\n\nimport MethodVO\t\t\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/data/MethodVO\");\nimport RenderMethodMaterialObject\t\t= require(\"awayjs-methodmaterials/lib/compilation/RenderMethodMaterialObject\");\nimport AmbientBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/AmbientBasicMethod\");\nimport DiffuseBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod\");\nimport EffectColorTransformMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod\");\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\nimport LightingMethodBase\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/LightingMethodBase\");\nimport NormalBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/NormalBasicMethod\");\nimport ShadowMapMethodBase\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase\");\nimport SpecularBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularBasicMethod\");\nimport MethodPassMode\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/passes/MethodPassMode\");\n\n/**\n * CompiledPass forms an abstract base class for the default compiled pass materials provided by Away3D,\n * using material methods to define their appearance.\n */\nclass MethodPass extends RenderPassBase implements IRenderLightingPass\n{\n\tprivate _maxLights:number = 3;\n\n\tprivate _mode:number = 0x03;\n\tprivate _material:MaterialBase;\n\tprivate _lightPicker:LightPickerBase;\n\n\tprivate _includeCasters:boolean = true;\n\n\tpublic _iColorTransformMethodVO:MethodVO;\n\tpublic _iNormalMethodVO:MethodVO;\n\tpublic _iAmbientMethodVO:MethodVO;\n\tpublic _iShadowMethodVO:MethodVO;\n\tpublic _iDiffuseMethodVO:MethodVO;\n\tpublic _iSpecularMethodVO:MethodVO;\n\tpublic _iMethodVOs:Array<MethodVO> = new Array<MethodVO>();\n\n\tpublic _numEffectDependencies:number = 0;\n\n\tprivate _onLightsChangeDelegate:(event:Event) => void;\n\tprivate _onMethodInvalidatedDelegate:(event:ShadingMethodEvent) => void;\n\n\tpublic numDirectionalLights:number = 0;\n\n\tpublic numPointLights:number = 0;\n\n\tpublic numLightProbes:number = 0;\n\n\tpublic pointLightsOffset:number = 0;\n\t\n\tpublic directionalLightsOffset:number= 0;\n\t\n\tpublic lightProbesOffset:number = 0;\n\t\n\t/**\n\t *\n\t */\n\tpublic get mode():number\n\t{\n\t\treturn this._mode;\n\t}\n\n\tpublic set mode(value:number)\n\t{\n\t\tif (this._mode == value)\n\t\t\treturn;\n\t\t\n\t\tthis._mode = value;\n\n\t\tthis._updateLights();\n\t}\n\n\t/**\n\t * Indicates whether or not shadow casting lights need to be included.\n\t */\n\tpublic get includeCasters():boolean\n\t{\n\t\treturn this._includeCasters;\n\t}\n\n\tpublic set includeCasters(value:boolean)\n\t{\n\t\tif (this._includeCasters == value)\n\t\t\treturn;\n\n\t\tthis._includeCasters = value;\n\n\t\tthis._updateLights();\n\t}\n\n\t/**\n\t * \n\t * @returns {LightPickerBase}\n\t */\n\tpublic get lightPicker():LightPickerBase\n\t{\n\t\treturn this._lightPicker;\n\t}\n\n\tpublic set lightPicker(value:LightPickerBase)\n\t{\n\t\t//if (this._lightPicker == value)\n\t\t//\treturn;\n\n\t\tif (this._lightPicker)\n\t\t\tthis._lightPicker.removeEventListener(Event.CHANGE, this._onLightsChangeDelegate);\n\n\t\tthis._lightPicker = value;\n\n\t\tif (this._lightPicker)\n\t\t\tthis._lightPicker.addEventListener(Event.CHANGE, this._onLightsChangeDelegate);\n\n\t\tthis._updateLights();\n\t}\n\t\n\t/**\n\t * Whether or not to use fallOff and radius properties for lights. This can be used to improve performance and\n\t * compatibility for constrained mode.\n\t */\n\tpublic get enableLightFallOff():boolean\n\t{\n\t\treturn this._material.enableLightFallOff;\n\t}\n\n\t/**\n\t * Define which light source types to use for diffuse reflections. This allows choosing between regular lights\n\t * and/or light probes for diffuse reflections.\n\t *\n\t * @see away3d.materials.LightSources\n\t */\n\tpublic get diffuseLightSources():number\n\t{\n\t\treturn this._material.diffuseLightSources;\n\t}\n\n\t/**\n\t * Define which light source types to use for specular reflections. This allows choosing between regular lights\n\t * and/or light probes for specular reflections.\n\t *\n\t * @see away3d.materials.LightSources\n\t */\n\tpublic get specularLightSources():number\n\t{\n\t\treturn this._material.specularLightSources;\n\t}\n\n\t/**\n\t * Creates a new CompiledPass object.\n\t *\n\t * @param material The material to which this pass belongs.\n\t */\n\tconstructor(mode:number, renderObject:RenderMethodMaterialObject, renderObjectOwner:MaterialBase, renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tsuper(renderObject, renderObjectOwner, renderableClass, stage);\n\n\t\tthis._mode = mode;\n\n\t\tthis._material = renderObjectOwner;\n\n\t\tthis._onLightsChangeDelegate = (event:Event) => this.onLightsChange(event);\n\t\t\n\t\tthis._onMethodInvalidatedDelegate = (event:ShadingMethodEvent) => this.onMethodInvalidated(event);\n\n\t\tthis.lightPicker = renderObjectOwner.lightPicker;\n\n\t\tif (this._shader == null)\n\t\t\tthis._updateShader();\n\t}\n\n\tprivate _updateShader()\n\t{\n\t\tif ((this.numDirectionalLights || this.numPointLights || this.numLightProbes) && !(this._shader instanceof ShaderLightingObject)) {\n\t\t\tif (this._shader != null)\n\t\t\t\tthis._shader.dispose();\n\n\t\t\tthis._shader = new ShaderLightingObject(this._renderableClass, this, this._stage);\n\t\t} else if (!(this._shader instanceof ShaderObjectBase)) {\n\t\t\tif (this._shader != null)\n\t\t\t\tthis._shader.dispose();\n\n\t\t\tthis._shader = new ShaderObjectBase(this._renderableClass, this, this._stage);\n\t\t}\n\t}\n\n\t/**\n\t * Initializes the unchanging constant data for this material.\n\t */\n\tpublic _iInitConstantData(shaderObject:ShaderObjectBase)\n\t{\n\t\tsuper._iInitConstantData(shaderObject);\n\n\t\t//Updates method constants if they have changed.\n\t\tvar len:number = this._iMethodVOs.length;\n\t\tfor (var i:number = 0; i < len; ++i)\n\t\t\tthis._iMethodVOs[i].method.iInitConstants(shaderObject, this._iMethodVOs[i]);\n\t}\n\n\t/**\n\t * The ColorTransform object to transform the colour of the material with. Defaults to null.\n\t */\n\tpublic get colorTransform():ColorTransform\n\t{\n\t\treturn this.colorTransformMethod? this.colorTransformMethod.colorTransform : null;\n\t}\n\n\tpublic set colorTransform(value:ColorTransform)\n\t{\n\t\tif (value) {\n\t\t\tif (this.colorTransformMethod == null)\n\t\t\t\tthis.colorTransformMethod = new EffectColorTransformMethod();\n\n\t\t\tthis.colorTransformMethod.colorTransform = value;\n\n\t\t} else if (!value) {\n\t\t\tif (this.colorTransformMethod)\n\t\t\t\tthis.colorTransformMethod = null;\n\t\t}\n\t}\n\n\t/**\n\t * The EffectColorTransformMethod object to transform the colour of the material with. Defaults to null.\n\t */\n\tpublic get colorTransformMethod():EffectColorTransformMethod\n\t{\n\t\treturn this._iColorTransformMethodVO? <EffectColorTransformMethod> this._iColorTransformMethodVO.method : null;\n\t}\n\n\tpublic set colorTransformMethod(value:EffectColorTransformMethod)\n\t{\n\t\tif (this._iColorTransformMethodVO && this._iColorTransformMethodVO.method == value)\n\t\t\treturn;\n\n\t\tif (this._iColorTransformMethodVO) {\n\t\t\tthis._removeDependency(this._iColorTransformMethodVO);\n\t\t\tthis._iColorTransformMethodVO = null;\n\t\t}\n\n\t\tif (value) {\n\t\t\tthis._iColorTransformMethodVO = new MethodVO(value);\n\t\t\tthis._addDependency(this._iColorTransformMethodVO);\n\t\t}\n\t}\n\n\tprivate _removeDependency(methodVO:MethodVO, effectsDependency:boolean = false)\n\t{\n\t\tvar index:number = this._iMethodVOs.indexOf(methodVO);\n\n\t\tif (!effectsDependency)\n\t\t\tthis._numEffectDependencies--;\n\n\t\tmethodVO.method.removeEventListener(ShadingMethodEvent.SHADER_INVALIDATED, this._onMethodInvalidatedDelegate);\n\t\tthis._iMethodVOs.splice(index, 1);\n\n\t\tthis.invalidatePass();\n\t}\n\n\tprivate _addDependency(methodVO:MethodVO, effectsDependency:boolean = false, index:number = -1)\n\t{\n\t\tmethodVO.method.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, this._onMethodInvalidatedDelegate);\n\n\t\tif (effectsDependency) {\n\t\t\tif (index != -1)\n\t\t\t\tthis._iMethodVOs.splice(index + this._iMethodVOs.length - this._numEffectDependencies, 0, methodVO);\n\t\t\telse\n\t\t\t\tthis._iMethodVOs.push(methodVO);\n\t\t\tthis._numEffectDependencies++;\n\t\t} else {\n\t\t\tthis._iMethodVOs.splice(this._iMethodVOs.length - this._numEffectDependencies, 0, methodVO);\n\t\t}\n\n\t\tthis.invalidatePass();\n\t}\n\n\t/**\n\t * Appends an \"effect\" shading method to the shader. Effect methods are those that do not influence the lighting\n\t * but modulate the shaded colour, used for fog, outlines, etc. The method will be applied to the result of the\n\t * methods added prior.\n\t */\n\tpublic addEffectMethod(method:EffectMethodBase)\n\t{\n\t\tthis._addDependency(new MethodVO(method), true);\n\t}\n\n\t/**\n\t * The number of \"effect\" methods added to the material.\n\t */\n\tpublic get numEffectMethods():number\n\t{\n\t\treturn this._numEffectDependencies;\n\t}\n\n\t/**\n\t * Queries whether a given effects method was added to the material.\n\t *\n\t * @param method The method to be queried.\n\t * @return true if the method was added to the material, false otherwise.\n\t */\n\tpublic hasEffectMethod(method:EffectMethodBase):boolean\n\t{\n\t\treturn this.getDependencyForMethod(method) != null;\n\t}\n\n\t/**\n\t * Returns the method added at the given index.\n\t * @param index The index of the method to retrieve.\n\t * @return The method at the given index.\n\t */\n\tpublic getEffectMethodAt(index:number):EffectMethodBase\n\t{\n\t\tif (index < 0 || index > this._numEffectDependencies - 1)\n\t\t\treturn null;\n\n\t\treturn <EffectMethodBase> this._iMethodVOs[index + this._iMethodVOs.length - this._numEffectDependencies].method;\n\t}\n\n\t/**\n\t * Adds an effect method at the specified index amongst the methods already added to the material. Effect\n\t * methods are those that do not influence the lighting but modulate the shaded colour, used for fog, outlines,\n\t * etc. The method will be applied to the result of the methods with a lower index.\n\t */\n\tpublic addEffectMethodAt(method:EffectMethodBase, index:number)\n\t{\n\t\tthis._addDependency(new MethodVO(method), true, index);\n\t}\n\n\t/**\n\t * Removes an effect method from the material.\n\t * @param method The method to be removed.\n\t */\n\tpublic removeEffectMethod(method:EffectMethodBase)\n\t{\n\t\tvar methodVO:MethodVO = this.getDependencyForMethod(method);\n\n\t\tif (methodVO != null)\n\t\t\tthis._removeDependency(methodVO, true);\n\t}\n\n\n\t/**\n\t * remove an effect method at the specified index from the material.\n\t */\n\tpublic removeEffectMethodAt(index:number)\n\t{\n\t\tif (index < 0 || index > this._numEffectDependencies - 1)\n\t\t\treturn;\n\n\t\tvar methodVO:MethodVO = this._iMethodVOs[index + this._iMethodVOs.length - this._numEffectDependencies];\n\n\t\tif (methodVO != null)\n\t\t\tthis._removeDependency(methodVO, true);\n\t}\n\n\n\tprivate getDependencyForMethod(method:EffectMethodBase):MethodVO\n\t{\n\t\tvar len:number = this._iMethodVOs.length;\n\t\tfor (var i:number = 0; i < len; ++i)\n\t\t\tif (this._iMethodVOs[i].method == method)\n\t\t\t\treturn this._iMethodVOs[i];\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * The method used to generate the per-pixel normals. Defaults to NormalBasicMethod.\n\t */\n\tpublic get normalMethod():NormalBasicMethod\n\t{\n\t\treturn this._iNormalMethodVO? <NormalBasicMethod> this._iNormalMethodVO.method : null;\n\t}\n\n\tpublic set normalMethod(value:NormalBasicMethod)\n\t{\n\t\tif (this._iNormalMethodVO && this._iNormalMethodVO.method == value)\n\t\t\treturn;\n\n\t\tif (this._iNormalMethodVO) {\n\t\t\tthis._removeDependency(this._iNormalMethodVO);\n\t\t\tthis._iNormalMethodVO = null;\n\t\t}\n\n\t\tif (value) {\n\t\t\tthis._iNormalMethodVO = new MethodVO(value);\n\t\t\tthis._addDependency(this._iNormalMethodVO);\n\t\t}\n\t}\n\n\t/**\n\t * The method that provides the ambient lighting contribution. Defaults to AmbientBasicMethod.\n\t */\n\tpublic get ambientMethod():AmbientBasicMethod\n\t{\n\t\treturn this._iAmbientMethodVO? <AmbientBasicMethod> this._iAmbientMethodVO.method : null;\n\t}\n\n\tpublic set ambientMethod(value:AmbientBasicMethod)\n\t{\n\t\tif (this._iAmbientMethodVO && this._iAmbientMethodVO.method == value)\n\t\t\treturn;\n\n\t\tif (this._iAmbientMethodVO) {\n\t\t\tthis._removeDependency(this._iAmbientMethodVO);\n\t\t\tthis._iAmbientMethodVO = null;\n\t\t}\n\n\t\tif (value) {\n\t\t\tthis._iAmbientMethodVO = new MethodVO(value);\n\t\t\tthis._addDependency(this._iAmbientMethodVO);\n\t\t}\n\t}\n\n\t/**\n\t * The method used to render shadows cast on this surface, or null if no shadows are to be rendered. Defaults to null.\n\t */\n\tpublic get shadowMethod():ShadowMapMethodBase\n\t{\n\t\treturn this._iShadowMethodVO? <ShadowMapMethodBase> this._iShadowMethodVO.method : null;\n\t}\n\n\tpublic set shadowMethod(value:ShadowMapMethodBase)\n\t{\n\t\tif (this._iShadowMethodVO && this._iShadowMethodVO.method == value)\n\t\t\treturn;\n\n\t\tif (this._iShadowMethodVO) {\n\t\t\tthis._removeDependency(this._iShadowMethodVO);\n\t\t\tthis._iShadowMethodVO = null;\n\t\t}\n\n\t\tif (value) {\n\t\t\tthis._iShadowMethodVO = new MethodVO(value);\n\t\t\tthis._addDependency(this._iShadowMethodVO);\n\t\t}\n\t}\n\n\t/**\n\t * The method that provides the diffuse lighting contribution. Defaults to DiffuseBasicMethod.\n\t */\n\tpublic get diffuseMethod():DiffuseBasicMethod\n\t{\n\t\treturn this._iDiffuseMethodVO? <DiffuseBasicMethod> this._iDiffuseMethodVO.method : null;\n\t}\n\n\tpublic set diffuseMethod(value:DiffuseBasicMethod)\n\t{\n\t\tif (this._iDiffuseMethodVO && this._iDiffuseMethodVO.method == value)\n\t\t\treturn;\n\n\t\tif (this._iDiffuseMethodVO) {\n\t\t\tthis._removeDependency(this._iDiffuseMethodVO);\n\t\t\tthis._iDiffuseMethodVO = null;\n\t\t}\n\n\t\tif (value) {\n\t\t\tthis._iDiffuseMethodVO = new MethodVO(value);\n\t\t\tthis._addDependency(this._iDiffuseMethodVO);\n\t\t}\n\t}\n\n\t/**\n\t * The method that provides the specular lighting contribution. Defaults to SpecularBasicMethod.\n\t */\n\tpublic get specularMethod():SpecularBasicMethod\n\t{\n\t\treturn this._iSpecularMethodVO? <SpecularBasicMethod> this._iSpecularMethodVO.method : null;\n\t}\n\n\tpublic set specularMethod(value:SpecularBasicMethod)\n\t{\n\t\tif (this._iSpecularMethodVO && this._iSpecularMethodVO.method == value)\n\t\t\treturn;\n\n\t\tif (this._iSpecularMethodVO) {\n\t\t\tthis._removeDependency(this._iSpecularMethodVO);\n\t\t\tthis._iSpecularMethodVO = null;\n\t\t}\n\n\t\tif (value) {\n\t\t\tthis._iSpecularMethodVO = new MethodVO(value);\n\t\t\tthis._addDependency(this._iSpecularMethodVO);\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\tsuper.dispose();\n\n\t\tif (this._lightPicker)\n\t\t\tthis._lightPicker.removeEventListener(Event.CHANGE, this._onLightsChangeDelegate);\n\t\t\n\t\twhile (this._iMethodVOs.length)\n\t\t\tthis._removeDependency(this._iMethodVOs[0]);\n\n\t\tthis._iMethodVOs = null;\n\t}\n\n\t/**\n\t * Called when any method's shader code is invalidated.\n\t */\n\tprivate onMethodInvalidated(event:ShadingMethodEvent)\n\t{\n\t\tthis.invalidatePass();\n\t}\n\n\t// RENDER LOOP\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iActivate(camera:Camera)\n\t{\n\t\tsuper._iActivate(camera);\n\n\t\tvar methodVO:MethodVO;\n\t\tvar len:number = this._iMethodVOs.length;\n\t\tfor (var i:number = 0; i < len; ++i) {\n\t\t\tmethodVO = this._iMethodVOs[i];\n\t\t\tif (methodVO.useMethod)\n\t\t\t\tmethodVO.method.iActivate(this._shader, methodVO, this._stage);\n\t\t}\n\t}\n\n\t/**\n\t *\n\t *\n\t * @param renderable\n\t * @param stage\n\t * @param camera\n\t */\n\tpublic _iRender(renderable:RenderableBase, camera:Camera, viewProjection:Matrix3D)\n\t{\n\t\tsuper._iRender(renderable, camera, viewProjection);\n\n\t\tvar methodVO:MethodVO;\n\t\tvar len:number = this._iMethodVOs.length;\n\t\tfor (var i:number = 0; i < len; ++i) {\n\t\t\tmethodVO = this._iMethodVOs[i];\n\t\t\tif (methodVO.useMethod)\n\t\t\t\tmethodVO.method.iSetRenderState(this._shader, methodVO, renderable, this._stage, camera);\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iDeactivate()\n\t{\n\t\tsuper._iDeactivate();\n\n\t\tvar methodVO:MethodVO;\n\t\tvar len:number = this._iMethodVOs.length;\n\t\tfor (var i:number = 0; i < len; ++i) {\n\t\t\tmethodVO = this._iMethodVOs[i];\n\t\t\tif (methodVO.useMethod)\n\t\t\t\tmethodVO.method.iDeactivate(this._shader, methodVO, this._stage);\n\t\t}\n\t}\n\n\tpublic _iIncludeDependencies(shaderObject:ShaderLightingObject)\n\t{\n\t\tsuper._iIncludeDependencies(shaderObject);\n\n\t\t//TODO: fragment animtion should be compatible with lighting pass\n\t\tshaderObject.usesFragmentAnimation = Boolean(this._mode == MethodPassMode.SUPER_SHADER);\n\n\t\tif (!shaderObject.usesTangentSpace && this.numPointLights > 0 && shaderObject.usesLights) {\n\t\t\tshaderObject.globalPosDependencies++;\n\n\t\t\tif (Boolean(this._mode & MethodPassMode.EFFECTS))\n\t\t\t\tshaderObject.usesGlobalPosFragment = true;\n\t\t}\n\n\t\tvar i:number;\n\t\tvar len:number = this._iMethodVOs.length;\n\t\tfor (i = 0; i < len; ++i)\n\t\t\tthis.setupAndCountDependencies(shaderObject, this._iMethodVOs[i]);\n\n\t\tfor (i = 0; i < len; ++i)\n\t\t\tthis._iMethodVOs[i].useMethod = this._iMethodVOs[i].method.iIsUsed(shaderObject);\n\t}\n\n\n\t/**\n\t * Counts the dependencies for a given method.\n\t * @param method The method to count the dependencies for.\n\t * @param methodVO The method's data for this material.\n\t */\n\tprivate setupAndCountDependencies(shaderObject:ShaderObjectBase, methodVO:MethodVO)\n\t{\n\t\tmethodVO.reset();\n\n\t\tmethodVO.method.iInitVO(shaderObject, methodVO);\n\n\t\tif (methodVO.needsProjection)\n\t\t\tshaderObject.projectionDependencies++;\n\n\t\tif (methodVO.needsGlobalVertexPos) {\n\n\t\t\tshaderObject.globalPosDependencies++;\n\n\t\t\tif (methodVO.needsGlobalFragmentPos)\n\t\t\t\tshaderObject.usesGlobalPosFragment = true;\n\n\t\t} else if (methodVO.needsGlobalFragmentPos) {\n\t\t\tshaderObject.globalPosDependencies++;\n\t\t\tshaderObject.usesGlobalPosFragment = true;\n\t\t}\n\n\t\tif (methodVO.needsNormals)\n\t\t\tshaderObject.normalDependencies++;\n\n\t\tif (methodVO.needsTangents)\n\t\t\tshaderObject.tangentDependencies++;\n\n\t\tif (methodVO.needsView)\n\t\t\tshaderObject.viewDirDependencies++;\n\n\t\tif (methodVO.needsUV)\n\t\t\tshaderObject.uvDependencies++;\n\n\t\tif (methodVO.needsSecondaryUV)\n\t\t\tshaderObject.secondaryUVDependencies++;\n\t}\n\n\tpublic _iGetPreLightingVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\n\t\tif (this._iAmbientMethodVO && this._iAmbientMethodVO.useMethod)\n\t\t\tcode += this._iAmbientMethodVO.method.iGetVertexCode(shaderObject, this._iAmbientMethodVO, registerCache, sharedRegisters);\n\n\t\tif (this._iDiffuseMethodVO && this._iDiffuseMethodVO.useMethod)\n\t\t\tcode += this._iDiffuseMethodVO.method.iGetVertexCode(shaderObject, this._iDiffuseMethodVO, registerCache, sharedRegisters);\n\n\t\tif (this._iSpecularMethodVO && this._iSpecularMethodVO.useMethod)\n\t\t\tcode += this._iSpecularMethodVO.method.iGetVertexCode(shaderObject, this._iSpecularMethodVO, registerCache, sharedRegisters);\n\n\t\treturn code;\n\t}\n\n\tpublic _iGetPreLightingFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\n\t\tif (this._iAmbientMethodVO && this._iAmbientMethodVO.useMethod) {\n\t\t\tcode += this._iAmbientMethodVO.method.iGetFragmentCode(shaderObject, this._iAmbientMethodVO, sharedRegisters.shadedTarget, registerCache, sharedRegisters);\n\n\t\t\tif (this._iAmbientMethodVO.needsNormals)\n\t\t\t\tregisterCache.removeFragmentTempUsage(sharedRegisters.normalFragment);\n\n\t\t\tif (this._iAmbientMethodVO.needsView)\n\t\t\t\tregisterCache.removeFragmentTempUsage(sharedRegisters.viewDirFragment);\n\t\t}\n\n\t\tif (this._iDiffuseMethodVO && this._iDiffuseMethodVO.useMethod)\n\t\t\tcode += (<LightingMethodBase> this._iDiffuseMethodVO.method).iGetFragmentPreLightingCode(<ShaderLightingObject> shaderObject, this._iDiffuseMethodVO, registerCache, sharedRegisters);\n\n\t\tif (this._iSpecularMethodVO && this._iSpecularMethodVO.useMethod)\n\t\t\tcode += (<LightingMethodBase> this._iSpecularMethodVO.method).iGetFragmentPreLightingCode(<ShaderLightingObject> shaderObject, this._iSpecularMethodVO, registerCache, sharedRegisters);\n\n\t\treturn code;\n\t}\n\n\tpublic _iGetPerLightDiffuseFragmentCode(shaderObject:ShaderLightingObject, lightDirReg:ShaderRegisterElement, diffuseColorReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn (<LightingMethodBase> this._iDiffuseMethodVO.method).iGetFragmentCodePerLight(shaderObject, this._iDiffuseMethodVO, lightDirReg, diffuseColorReg, registerCache, sharedRegisters);\n\t}\n\n\tpublic _iGetPerLightSpecularFragmentCode(shaderObject:ShaderLightingObject, lightDirReg:ShaderRegisterElement, specularColorReg:ShaderRegisterElement, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn (<LightingMethodBase> this._iSpecularMethodVO.method).iGetFragmentCodePerLight(shaderObject, this._iSpecularMethodVO, lightDirReg, specularColorReg, registerCache, sharedRegisters);\n\t}\n\n\tpublic _iGetPerProbeDiffuseFragmentCode(shaderObject:ShaderLightingObject, texReg:ShaderRegisterElement, weightReg:string, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn (<LightingMethodBase> this._iDiffuseMethodVO.method).iGetFragmentCodePerProbe(shaderObject, this._iDiffuseMethodVO, texReg, weightReg, registerCache, sharedRegisters);\n\t}\n\n\tpublic _iGetPerProbeSpecularFragmentCode(shaderObject:ShaderLightingObject, texReg:ShaderRegisterElement, weightReg:string, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn (<LightingMethodBase> this._iSpecularMethodVO.method).iGetFragmentCodePerProbe(shaderObject, this._iSpecularMethodVO, texReg, weightReg, registerCache, sharedRegisters);\n\t}\n\n\tpublic _iGetPostLightingVertexCode(shaderObject:ShaderLightingObject, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\n\t\tif (this._iShadowMethodVO)\n\t\t\tcode += this._iShadowMethodVO.method.iGetVertexCode(shaderObject, this._iShadowMethodVO, registerCache, sharedRegisters);\n\n\t\treturn code;\n\t}\n\n\tpublic _iGetPostLightingFragmentCode(shaderObject:ShaderLightingObject, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\n\t\tif (shaderObject.useAlphaPremultiplied && this._pEnableBlending) {\n\t\t\tcode += \"add \" + sharedRegisters.shadedTarget + \".w, \" + sharedRegisters.shadedTarget + \".w, \" + sharedRegisters.commons + \".z\\n\" +\n\t\t\t\"div \" + sharedRegisters.shadedTarget + \".xyz, \" + sharedRegisters.shadedTarget + \", \" + sharedRegisters.shadedTarget + \".w\\n\" +\n\t\t\t\"sub \" + sharedRegisters.shadedTarget + \".w, \" + sharedRegisters.shadedTarget + \".w, \" + sharedRegisters.commons + \".z\\n\" +\n\t\t\t\"sat \" + sharedRegisters.shadedTarget + \".xyz, \" + sharedRegisters.shadedTarget + \"\\n\";\n\t\t}\n\n\t\tif (this._iShadowMethodVO)\n\t\t\tcode += this._iShadowMethodVO.method.iGetFragmentCode(shaderObject, this._iShadowMethodVO, sharedRegisters.shadowTarget, registerCache, sharedRegisters);\n\n\t\tif (this._iDiffuseMethodVO && this._iDiffuseMethodVO.useMethod) {\n\t\t\tcode += (<LightingMethodBase> this._iDiffuseMethodVO.method).iGetFragmentPostLightingCode(shaderObject, this._iDiffuseMethodVO, sharedRegisters.shadedTarget, registerCache, sharedRegisters);\n\n\t\t\t// resolve other dependencies as well?\n\t\t\tif (this._iDiffuseMethodVO.needsNormals)\n\t\t\t\tregisterCache.removeFragmentTempUsage(sharedRegisters.normalFragment);\n\n\t\t\tif (this._iDiffuseMethodVO.needsView)\n\t\t\t\tregisterCache.removeFragmentTempUsage(sharedRegisters.viewDirFragment);\n\t\t}\n\n\t\tif (this._iSpecularMethodVO && this._iSpecularMethodVO.useMethod) {\n\t\t\tcode += (<LightingMethodBase> this._iSpecularMethodVO.method).iGetFragmentPostLightingCode(shaderObject, this._iSpecularMethodVO, sharedRegisters.shadedTarget, registerCache, sharedRegisters);\n\t\t\tif (this._iSpecularMethodVO.needsNormals)\n\t\t\t\tregisterCache.removeFragmentTempUsage(sharedRegisters.normalFragment);\n\t\t\tif (this._iSpecularMethodVO.needsView)\n\t\t\t\tregisterCache.removeFragmentTempUsage(sharedRegisters.viewDirFragment);\n\t\t}\n\n\t\tif (this._iShadowMethodVO)\n\t\t\tregisterCache.removeFragmentTempUsage(sharedRegisters.shadowTarget);\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * Indicates whether or not normals are allowed in tangent space. This is only the case if no object-space\n\t * dependencies exist.\n\t */\n\tpublic _pUsesTangentSpace(shaderObject:ShaderLightingObject):boolean\n\t{\n\t\tif (shaderObject.usesProbes)\n\t\t\treturn false;\n\n\t\tvar methodVO:MethodVO;\n\t\tvar len:number = this._iMethodVOs.length;\n\t\tfor (var i:number = 0; i < len; ++i) {\n\t\t\tmethodVO = this._iMethodVOs[i];\n\t\t\tif (methodVO.useMethod && !methodVO.method.iUsesTangentSpace())\n\t\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Indicates whether or not normals are output in tangent space.\n\t */\n\tpublic _pOutputsTangentNormals(shaderObject:ShaderObjectBase):boolean\n\t{\n\t\treturn (<NormalBasicMethod> this._iNormalMethodVO.method).iOutputsTangentNormals();\n\t}\n\n\t/**\n\t * Indicates whether or not normals are output by the pass.\n\t */\n\tpublic _pOutputsNormals(shaderObject:ShaderObjectBase):boolean\n\t{\n\t\treturn this._iNormalMethodVO && this._iNormalMethodVO.useMethod;\n\t}\n\n\n\tpublic _iGetNormalVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn this._iNormalMethodVO.method.iGetVertexCode(shaderObject, this._iNormalMethodVO, registerCache, sharedRegisters);\n\t}\n\n\tpublic _iGetNormalFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = this._iNormalMethodVO.method.iGetFragmentCode(shaderObject, this._iNormalMethodVO, sharedRegisters.normalFragment, registerCache, sharedRegisters);\n\n\t\tif (this._iNormalMethodVO.needsView)\n\t\t\tregisterCache.removeFragmentTempUsage(sharedRegisters.viewDirFragment);\n\n\t\tif (this._iNormalMethodVO.needsGlobalFragmentPos || this._iNormalMethodVO.needsGlobalVertexPos)\n\t\t\tregisterCache.removeVertexTempUsage(sharedRegisters.globalPositionVertex);\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGetVertexCode(shaderObject:ShaderObjectBase, regCache:ShaderRegisterCache, sharedReg:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar methodVO:MethodVO;\n\t\tvar len:number = this._iMethodVOs.length;\n\t\tfor (var i:number = len - this._numEffectDependencies; i < len; i++) {\n\t\t\tmethodVO = this._iMethodVOs[i];\n\t\t\tif (methodVO.useMethod) {\n\t\t\t\tcode += methodVO.method.iGetVertexCode(shaderObject, methodVO, regCache, sharedReg);\n\n\t\t\t\tif (methodVO.needsGlobalVertexPos || methodVO.needsGlobalFragmentPos)\n\t\t\t\t\tregCache.removeVertexTempUsage(sharedReg.globalPositionVertex);\n\t\t\t}\n\t\t}\n\n\t\tif (this._iColorTransformMethodVO && this._iColorTransformMethodVO.useMethod)\n\t\t\tcode += this._iColorTransformMethodVO.method.iGetVertexCode(shaderObject, this._iColorTransformMethodVO, regCache, sharedReg);\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGetFragmentCode(shaderObject:ShaderObjectBase, regCache:ShaderRegisterCache, sharedReg:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar alphaReg:ShaderRegisterElement;\n\n\t\tif (this.preserveAlpha && this._numEffectDependencies > 0) {\n\t\t\talphaReg = regCache.getFreeFragmentSingleTemp();\n\t\t\tregCache.addFragmentTempUsages(alphaReg, 1);\n\t\t\tcode += \"mov \" + alphaReg + \", \" + sharedReg.shadedTarget + \".w\\n\";\n\t\t}\n\n\t\tvar methodVO:MethodVO;\n\t\tvar len:number = this._iMethodVOs.length;\n\t\tfor (var i:number = len - this._numEffectDependencies; i < len; i++) {\n\t\t\tmethodVO = this._iMethodVOs[i];\n\t\t\tif (methodVO.useMethod) {\n\t\t\t\tcode += methodVO.method.iGetFragmentCode(shaderObject, methodVO, sharedReg.shadedTarget, regCache, sharedReg);\n\n\t\t\t\tif (methodVO.needsNormals)\n\t\t\t\t\tregCache.removeFragmentTempUsage(sharedReg.normalFragment);\n\n\t\t\t\tif (methodVO.needsView)\n\t\t\t\t\tregCache.removeFragmentTempUsage(sharedReg.viewDirFragment);\n\n\t\t\t}\n\t\t}\n\n\t\tif (this.preserveAlpha && this._numEffectDependencies > 0) {\n\t\t\tcode += \"mov \" + sharedReg.shadedTarget + \".w, \" + alphaReg + \"\\n\";\n\t\t\tregCache.removeFragmentTempUsage(alphaReg);\n\t\t}\n\n\t\tif (this._iColorTransformMethodVO && this._iColorTransformMethodVO.useMethod)\n\t\t\tcode += this._iColorTransformMethodVO.method.iGetFragmentCode(shaderObject, this._iColorTransformMethodVO, sharedReg.shadedTarget, regCache, sharedReg);\n\n\t\treturn code;\n\t}\n\t/**\n\t * Indicates whether the shader uses any shadows.\n\t */\n\tpublic _iUsesShadows(shaderObject:ShaderObjectBase):boolean\n\t{\n\t\treturn Boolean(this._iShadowMethodVO && (this._lightPicker.castingDirectionalLights.length > 0 || this._lightPicker.castingPointLights.length > 0));\n\t}\n\n\t/**\n\t * Indicates whether the shader uses any specular component.\n\t */\n\tpublic _iUsesSpecular(shaderObject:ShaderObjectBase):boolean\n\t{\n\t\treturn Boolean(this._iSpecularMethodVO);\n\t}\n\n\t/**\n\t * Indicates whether the shader uses any specular component.\n\t */\n\tpublic _iUsesDiffuse(shaderObject:ShaderObjectBase):boolean\n\t{\n\t\treturn Boolean(this._iDiffuseMethodVO);\n\t}\n\n\n\tprivate onLightsChange(event:Event)\n\t{\n\t\tthis._updateLights();\n\t}\n\n\tprivate _updateLights()\n\t{\n\t\tvar numDirectionalLightsOld:number = this.numDirectionalLights;\n\t\tvar numPointLightsOld:number = this.numPointLights;\n\t\tvar numLightProbesOld:number = this.numLightProbes;\n\n\t\tif (this._lightPicker && (this._mode & MethodPassMode.LIGHTING)) {\n\t\t\tthis.numDirectionalLights = this.calculateNumDirectionalLights(this._lightPicker.numDirectionalLights);\n\t\t\tthis.numPointLights = this.calculateNumPointLights(this._lightPicker.numPointLights);\n\t\t\tthis.numLightProbes = this.calculateNumProbes(this._lightPicker.numLightProbes);\n\n\t\t\tif (this._includeCasters) {\n\t\t\t\tthis.numDirectionalLights += this._lightPicker.numCastingDirectionalLights;\n\t\t\t\tthis.numPointLights += this._lightPicker.numCastingPointLights;\n\t\t\t}\n\n\t\t} else {\n\t\t\tthis.numDirectionalLights = 0;\n\t\t\tthis.numPointLights = 0;\n\t\t\tthis.numLightProbes = 0;\n\t\t}\n\n\t\tif (numDirectionalLightsOld != this.numDirectionalLights || numPointLightsOld != this.numPointLights || numLightProbesOld != this.numLightProbes) {\n\t\t\tthis._updateShader();\n\n\t\t\tthis.invalidatePass();\n\t\t}\n\t}\n\n\t/**\n\t * Calculates the amount of directional lights this material will support.\n\t * @param numDirectionalLights The maximum amount of directional lights to support.\n\t * @return The amount of directional lights this material will support, bounded by the amount necessary.\n\t */\n\tprivate calculateNumDirectionalLights(numDirectionalLights:number):number\n\t{\n\t\treturn Math.min(numDirectionalLights - this.directionalLightsOffset, this._maxLights);\n\t}\n\n\t/**\n\t * Calculates the amount of point lights this material will support.\n\t * @param numDirectionalLights The maximum amount of point lights to support.\n\t * @return The amount of point lights this material will support, bounded by the amount necessary.\n\t */\n\tprivate calculateNumPointLights(numPointLights:number):number\n\t{\n\t\tvar numFree:number = this._maxLights - this.numDirectionalLights;\n\t\treturn Math.min(numPointLights - this.pointLightsOffset, numFree);\n\t}\n\n\t/**\n\t * Calculates the amount of light probes this material will support.\n\t * @param numDirectionalLights The maximum amount of light probes to support.\n\t * @return The amount of light probes this material will support, bounded by the amount necessary.\n\t */\n\tprivate calculateNumProbes(numLightProbes:number):number\n\t{\n\t\tvar numChannels:number = 0;\n\n\t\tif ((this.specularLightSources & LightSources.PROBES) != 0)\n\t\t\t++numChannels;\n\n\t\tif ((this.diffuseLightSources & LightSources.PROBES) != 0)\n\t\t\t++numChannels;\n\n\t\t// 4 channels available\n\t\treturn Math.min(numLightProbes - this.lightProbesOffset, (4/numChannels) | 0);\n\t}\n}\n\nexport = MethodPass;","import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport RenderTexture\t\t\t\t\t= require(\"awayjs-core/lib/textures/RenderTexture\");\n\nimport LightBase\t\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport IRenderObjectOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\n\nimport ContextGLProgramType\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\nimport IContextGL\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RendererBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\nimport RenderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport IRenderableClass\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\nimport RenderPassBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\n\n/**\n * The SingleObjectDepthPass provides a material pass that renders a single object to a depth map from the point\n * of view from a light.\n */\nclass SingleObjectDepthPass extends RenderPassBase\n{\n\tprivate _textures:Object;\n\tprivate _projections:Object;\n\tprivate _textureSize:number /*uint*/ = 512;\n\tprivate _polyOffset:Array<number> = Array<number>(15, 0, 0, 0);\n\tprivate _enc:Array<number>;\n\tprivate _projectionTexturesInvalid:Boolean = true;\n\n\t/**\n\t * The size of the depth map texture to render to.\n\t */\n\tpublic get textureSize():number\n\t{\n\t\treturn this._textureSize;\n\t}\n\n\tpublic set textureSize(value:number)\n\t{\n\t\tthis._textureSize = value;\n\t}\n\n\t/**\n\t * The amount by which the rendered object will be inflated, to prevent depth map rounding errors.\n\t */\n\tpublic get polyOffset():number\n\t{\n\t\treturn this._polyOffset[0];\n\t}\n\n\tpublic set polyOffset(value:number)\n\t{\n\t\tthis._polyOffset[0] = value;\n\t}\n\n\t/**\n\t * Creates a new SingleObjectDepthPass object.\n\t */\n\tconstructor(renderObject:RenderObjectBase, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tsuper(renderObject, renderObjectOwner, renderableClass, stage);\n\n\t\t//this._pNumUsedStreams = 2;\n\t\t//this._pNumUsedVertexConstants = 7;\n\t\t//this._enc = Array<number>(1.0, 255.0, 65025.0, 16581375.0, 1.0/255.0, 1.0/255.0, 1.0/255.0, 0.0);\n\t\t//\n\t\t//this._pAnimatableAttributes = Array<string>(\"va0\", \"va1\");\n\t\t//this._pAnimationTargetRegisters = Array<string>(\"vt0\", \"vt1\");\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\tif (this._textures) {\n\t\t\tfor (var key in this._textures) {\n\t\t\t\tvar texture:RenderTexture = this._textures[key];\n\t\t\t\ttexture.dispose();\n\t\t\t}\n\t\t\tthis._textures = null;\n\t\t}\n\t}\n\n\t/**\n\t * Updates the projection textures used to contain the depth renders.\n\t */\n\tprivate updateProjectionTextures()\n\t{\n\t\tif (this._textures) {\n\t\t\tfor (var key in this._textures) {\n\t\t\t\tvar texture:RenderTexture = this._textures[key];\n\t\t\t\ttexture.dispose();\n\t\t\t}\n\t\t}\n\n\t\tthis._textures = new Object();\n\t\tthis._projections = new Object();\n\t\tthis._projectionTexturesInvalid = false;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGetVertexCode():string\n\t{\n\t\tvar code:string;\n\t\t// offset\n\t\tcode = \"mul vt7, vt1, vc4.x\t\\n\" +\n\t\t\t\t\"add vt7, vt7, vt0\\n\" +\n\t\t\t\t\"mov vt7.w, vt0.w\\n\";\n\t\t// project\n\t\tcode += \"m44 vt2, vt7, vc0\\n\" +\n\t\t\t\t\"mov op, vt2\\n\";\n\n\t\t// perspective divide\n\t\tcode += \"div v0, vt2, vt2.w\\n\";\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGetFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\n\t\t// encode float -> rgba\n\t\tcode += \"mul ft0, fc0, v0.z\\n\" +\n\t\t\t\t\"frc ft0, ft0\\n\" +\n\t\t\t\t\"mul ft1, ft0.yzww, fc1\\n\" +\n\t\t\t\t\"sub ft0, ft0, ft1\\n\" +\n\t\t\t\t\"mov oc, ft0\\n\";\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * Gets the depth maps rendered for this object from all lights.\n\t * @param renderable The renderable for which to retrieve the depth maps.\n\t * @param stage3DProxy The Stage3DProxy object currently used for rendering.\n\t * @return A list of depth map textures for all supported lights.\n\t */\n\tpublic _iGetDepthMap(renderable:RenderableBase):RenderTexture\n\t{\n\t\treturn this._textures[renderable.renderableOwner.id];\n\t}\n\n\t/**\n\t * Retrieves the depth map projection maps for all lights.\n\t * @param renderable The renderable for which to retrieve the projection maps.\n\t * @return A list of projection maps for all supported lights.\n\t */\n\tpublic _iGetProjection(renderable:RenderableBase):Matrix3D\n\t{\n\t\treturn this._projections[renderable.renderableOwner.id];\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iRender(renderable:RenderableBase, camera:Camera, viewProjection:Matrix3D)\n\t{\n\t\tvar matrix:Matrix3D;\n\t\tvar context:IContextGL = this._stage.context;\n\t\tvar len:number /*uint*/;\n\t\tvar light:LightBase;\n\t\tvar lights:Array<LightBase> = this._renderObjectOwner.lightPicker.allPickedLights;\n\t\tvar rId:number = renderable.renderableOwner.id;\n\n\t\tif (!this._textures[rId])\n\t\t\tthis._textures[rId] = new RenderTexture(this._textureSize, this._textureSize);\n\n\t\tif (!this._projections[rId])\n\t\t\tthis._projections[rId] = new Matrix3D();\n\n\t\tlen = lights.length;\n\n\t\t// local position = enough\n\t\tlight = lights[0];\n\n\t\tmatrix = light.iGetObjectProjectionMatrix(renderable.sourceEntity, camera, this._projections[rId]);\n\n\t\tthis._stage.setRenderTarget(this._textures[rId], true);\n\t\tcontext.clear(1.0, 1.0, 1.0);\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, matrix, true);\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, this._enc, 2);\n\n\t\tthis._stage.activateBuffer(0, renderable.getVertexData(TriangleSubGeometry.POSITION_DATA), renderable.getVertexOffset(TriangleSubGeometry.POSITION_DATA), TriangleSubGeometry.POSITION_FORMAT);\n\t\tthis._stage.activateBuffer(1, renderable.getVertexData(TriangleSubGeometry.NORMAL_DATA), renderable.getVertexOffset(TriangleSubGeometry.NORMAL_DATA), TriangleSubGeometry.NORMAL_FORMAT);\n\t\tcontext.drawTriangles(this._stage.getIndexBuffer(renderable.getIndexData()), 0, renderable.numTriangles);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iActivate(camera:Camera)\n\t{\n\t\tif (this._projectionTexturesInvalid)\n\t\t\tthis.updateProjectionTextures();\n\n\t\t// never scale\n\t\tsuper._iActivate(camera);\n\n\t\tthis._stage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 4, this._polyOffset, 1);\n\t}\n}\n\nexport = SingleObjectDepthPass;","import IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport IRenderablePool\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderablePool\");\nimport IRenderObject\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderObject\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\nimport SkyboxRenderObject\t\t\t= require(\"awayjs-renderergl/lib/compilation/SkyboxRenderObject\");\nimport DepthRenderObject\t\t\t= require(\"awayjs-renderergl/lib/compilation/DepthRenderObject\");\nimport DistanceRenderObject\t\t\t= require(\"awayjs-renderergl/lib/compilation/DistanceRenderObject\");\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport RenderMethodMaterialObject\t= require(\"awayjs-methodmaterials/lib/compilation/RenderMethodMaterialObject\");\n\n/**\n * @class away.pool.MethodRenderablePool\n */\nclass MethodRenderablePool extends RenderablePoolBase\n{\n\tprivate _methodMaterialRenderObjectPool:RenderObjectPool;\n\n\t/**\n\t * //TODO\n\t *\n\t * @param renderableClass\n\t */\n\tconstructor(renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tsuper(renderableClass, stage);\n\n\t\tthis._methodMaterialRenderObjectPool = new RenderObjectPool(RenderMethodMaterialObject, this._renderableClass, this._stage);\n\t}\n\n\t/**\n\t *\n\t * @param material\n\t * @param renderable\n\t */\n\tpublic getMethodRenderObject(renderObjectOwner:IRenderObjectOwner):RenderObjectBase\n\t{\n\t\treturn this._methodMaterialRenderObjectPool.getItem(renderObjectOwner);\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param renderableClass\n\t * @returns MethodRenderablePool\n\t */\n\tpublic static getPool(renderableClass:IRenderableClass, stage:Stage):MethodRenderablePool\n\t{\n\t\tvar pools:Object = (RenderablePoolBase._pools[stage.stageIndex] || (RenderablePoolBase._pools[stage.stageIndex] = new Object()));\n\n\t\treturn (pools[renderableClass.id] || (pools[renderableClass.id] = new MethodRenderablePool(renderableClass, stage)));\n\t}\n}\n\nexport = MethodRenderablePool;","import BillboardRenderable\t\t\t= require(\"awayjs-renderergl/lib/pool/BillboardRenderable\");\nimport LineSegmentRenderable\t\t= require(\"awayjs-renderergl/lib/pool/LineSegmentRenderable\");\nimport LineSubMeshRenderable\t\t= require(\"awayjs-renderergl/lib/pool/LineSubMeshRenderable\");\nimport TriangleSubMeshRenderable\t= require(\"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable\");\nimport RendererPoolBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RendererPoolBase\");\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\n\nimport MethodRenderablePool\t\t\t= require(\"awayjs-methodmaterials/lib/pool/MethodRenderablePool\");\n\n/**\n * MethodRendererPool forms an abstract base class for classes that are used in the rendering pipeline to render the\n * contents of a partition\n *\n * @class away.render.MethodRendererPool\n */\nclass MethodRendererPool extends RendererPoolBase\n{\n\t/**\n\t * Creates a new MethodRendererPool object.\n\t */\n\tconstructor(renderer:RendererBase)\n\t{\n\t\tsuper(renderer);\n\t}\n\n\tpublic _pUpdatePool()\n\t{\n\t\tthis._billboardRenderablePool = MethodRenderablePool.getPool(BillboardRenderable, this._pStage);\n\t\tthis._lineSegmentRenderablePool = MethodRenderablePool.getPool(LineSegmentRenderable, this._pStage);\n\t\tthis._triangleSubMeshRenderablePool = MethodRenderablePool.getPool(TriangleSubMeshRenderable, this._pStage);\n\t\tthis._lineSubMeshRenderablePool = MethodRenderablePool.getPool(LineSubMeshRenderable, this._pStage);\n\t}\n}\n\nexport = MethodRendererPool;","import BitmapData\t\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\r\nimport BlendMode\t\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\r\nimport ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport AssetType\t\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\nimport ProjectionBase\t\t\t\t\t= require(\"awayjs-core/lib/projections/ProjectionBase\");\r\nimport PerspectiveProjection\t\t\t= require(\"awayjs-core/lib/projections/PerspectiveProjection\");\r\nimport OrthographicProjection\t\t\t= require(\"awayjs-core/lib/projections/OrthographicProjection\");\r\nimport OrthographicOffCenterProjection\t= require(\"awayjs-core/lib/projections/OrthographicOffCenterProjection\");\r\nimport BitmapCubeTexture\t\t\t\t= require(\"awayjs-core/lib/textures/BitmapCubeTexture\");\r\nimport BitmapTexture\t\t\t\t\t= require(\"awayjs-core/lib/textures/BitmapTexture\");\r\nimport CubeTextureBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\r\nimport ImageCubeTexture\t\t\t\t\t= require(\"awayjs-core/lib/textures/ImageCubeTexture\");\r\nimport ImageTexture\t\t\t\t\t\t= require(\"awayjs-core/lib/textures/ImageTexture\");\r\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\nimport TextureProxyBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport LightBase\t\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport DirectionalLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\r\nimport PointLight\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport Skybox\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport LightPickerBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\r\nimport StaticLightPicker\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/StaticLightPicker\");\r\nimport CubeMapShadowMapper\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper\");\r\nimport DirectionalShadowMapper\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper\");\r\nimport ShadowMapperBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/ShadowMapperBase\");\r\nimport PrefabBase\t\t\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrefabBase\");\r\nimport PrimitiveCapsulePrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCapsulePrefab\");\r\nimport PrimitiveConePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveConePrefab\");\r\nimport PrimitiveCubePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCubePrefab\");\r\nimport PrimitiveCylinderPrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCylinderPrefab\");\r\nimport PrimitivePlanePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitivePlanePrefab\");\r\nimport PrimitiveSpherePrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveSpherePrefab\");\r\nimport PrimitiveTorusPrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveTorusPrefab\");\r\n\r\nimport AnimationSetBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport VertexAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimationSet\");\r\nimport VertexAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimator\");\r\nimport SkeletonAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimationSet\");\r\nimport SkeletonAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimator\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonJoint\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonJoint\");\r\nimport SkeletonClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode\");\r\nimport VertexClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/VertexClipNode\");\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-renderergl/lib/managers/DefaultMaterialManager\");\r\n\r\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\r\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\nimport AmbientEnvMapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod\");\r\nimport DiffuseDepthMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseDepthMethod\");\r\nimport DiffuseCelMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseCelMethod\");\r\nimport DiffuseGradientMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseGradientMethod\");\r\nimport DiffuseLightMapMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod\");\r\nimport DiffuseWrapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseWrapMethod\");\r\nimport EffectAlphaMaskMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod\");\r\nimport EffectColorMatrixMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod\");\r\nimport EffectColorTransformMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod\");\r\nimport EffectEnvMapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectEnvMapMethod\");\r\nimport EffectFogMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectFogMethod\");\r\nimport EffectFresnelEnvMapMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod\");\r\nimport EffectLightMapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectLightMapMethod\");\r\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\r\nimport EffectRimLightMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectRimLightMethod\");\r\nimport NormalSimpleWaterMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod\");\r\nimport ShadowDitheredMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowDitheredMethod\");\r\nimport ShadowFilteredMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowFilteredMethod\");\r\nimport ShadowMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMethodBase\");\r\nimport SpecularFresnelMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularFresnelMethod\");\r\nimport ShadowHardMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowHardMethod\");\r\nimport SpecularAnisotropicMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod\");\r\nimport SpecularCelMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularCelMethod\");\r\nimport SpecularPhongMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularPhongMethod\");\r\nimport ShadowNearMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowNearMethod\");\r\nimport ShadowSoftMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowSoftMethod\");\r\n\r\nimport TimelineSceneGraphFactory = require(\"awayjs-player/lib/fl/factories/TimelineSceneGraphFactory\");\r\nimport AS2SceneGraphFactory = require(\"awayjs-player/lib/fl/factories/AS2SceneGraphFactory\");\r\nimport MovieClip = require(\"awayjs-player/lib/fl/display/MovieClip\");\r\nimport TimelineKeyFrame = require(\"awayjs-player/lib/fl/timeline/TimelineKeyFrame\");\r\nimport AddChildCommand = require(\"awayjs-player/lib/fl/timeline/commands/AddChildCommand\");\r\nimport UpdatePropertyCommand = require(\"awayjs-player/lib/fl/timeline/commands/UpdatePropertyCommand\");\r\nimport RemoveChildCommand = require(\"awayjs-player/lib/fl/timeline/commands/RemoveChildCommand\");\r\n\r\n/**\r\n * AWDParser provides a parser for the AWD data type.\r\n */\r\nclass AWDParser extends ParserBase\r\n{\r\n\t//set to \"true\" to have some console.logs in the Console\r\n\tprivate _debug:boolean = false;\r\n\tprivate _byteData:ByteArray;\r\n\tprivate _startedParsing:boolean = false;\r\n\tprivate _cur_block_id:number;\r\n\tprivate _blocks:Array<AWDBlock>;\r\n\tprivate _newBlockBytes:ByteArray;\r\n\tprivate _version:Array<number>;\r\n\tprivate _compression:number;\r\n\tprivate _accuracyOnBlocks:boolean;\r\n\tprivate _accuracyMatrix:boolean;\r\n\tprivate _accuracyGeo:boolean;\r\n\tprivate _accuracyProps:boolean;\r\n\tprivate _matrixNrType:number;\r\n\tprivate _geoNrType:number;\r\n\tprivate _propsNrType:number;\r\n\tprivate _streaming:boolean;\r\n\tprivate _texture_users:Object = {};\r\n\tprivate _parsed_header:boolean = false;\r\n\tprivate _body:ByteArray;\r\n\tprivate _defaultTexture:BitmapTexture;     // HTML IMAGE TEXTURE >? !\r\n\tprivate _cubeTextures:Array<any>;\r\n\tprivate _defaultBitmapMaterial:MethodMaterial;\r\n\tprivate _defaultCubeTexture:BitmapCubeTexture;\r\n\r\n\tpublic static COMPRESSIONMODE_LZMA:string = \"lzma\";\r\n\tpublic static UNCOMPRESSED:number = 0;\r\n\tpublic static DEFLATE:number = 1;\r\n\tpublic static LZMA:number = 2;\r\n\tpublic static INT8:number = 1;\r\n\tpublic static INT16:number = 2;\r\n\tpublic static INT32:number = 3;\r\n\tpublic static UINT8:number = 4;\r\n\tpublic static UINT16:number = 5;\r\n\tpublic static UINT32:number = 6;\r\n\tpublic static FLOAT32:number = 7;\r\n\tpublic static FLOAT64:number = 8;\r\n\tpublic static BOOL:number = 21;\r\n\tpublic static COLOR:number = 22;\r\n\tpublic static BADDR:number = 23;\r\n\tpublic static AWDSTRING:number = 31;\r\n\tpublic static AWDBYTEARRAY:number = 32;\r\n\tpublic static VECTOR2x1:number = 41;\r\n\tpublic static VECTOR3x1:number = 42;\r\n\tpublic static VECTOR4x1:number = 43;\r\n\tpublic static MTX3x2:number = 44;\r\n\tpublic static MTX3x3:number = 45;\r\n\tpublic static MTX4x3:number = 46;\r\n\tpublic static MTX4x4:number = 47;\r\n\r\n\tprivate blendModeDic:Array<string>;\r\n\tprivate _depthSizeDic:Array<number>;\r\n\r\n\t/**\r\n\t * Creates a new AWDParser object.\r\n\t * @param uri The url or id of the data or file to be parsed.\r\n\t * @param extra The holder for extra contextual data that the parser might need.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.ARRAY_BUFFER);\r\n\r\n\t\tthis._blocks = new Array<AWDBlock>();\r\n\t\tthis._blocks[0] = new AWDBlock();\r\n\t\tthis._blocks[0].data = null; // Zero address means null in AWD\r\n\r\n        this.blendModeDic = new Array<string>(); // used to translate ints to blendMode-strings\r\n\t\tthis.blendModeDic.push(BlendMode.NORMAL);\r\n\t\tthis.blendModeDic.push(BlendMode.ADD);\r\n\t\tthis.blendModeDic.push(BlendMode.ALPHA);\r\n\t\tthis.blendModeDic.push(BlendMode.DARKEN);\r\n\t\tthis.blendModeDic.push(BlendMode.DIFFERENCE);\r\n\t\tthis.blendModeDic.push(BlendMode.ERASE);\r\n\t\tthis.blendModeDic.push(BlendMode.HARDLIGHT);\r\n\t\tthis.blendModeDic.push(BlendMode.INVERT);\r\n\t\tthis.blendModeDic.push(BlendMode.LAYER);\r\n\t\tthis.blendModeDic.push(BlendMode.LIGHTEN);\r\n\t\tthis.blendModeDic.push(BlendMode.MULTIPLY);\r\n\t\tthis.blendModeDic.push(BlendMode.NORMAL);\r\n\t\tthis.blendModeDic.push(BlendMode.OVERLAY);\r\n\t\tthis.blendModeDic.push(BlendMode.SCREEN);\r\n\t\tthis.blendModeDic.push(BlendMode.SHADER);\r\n\t\tthis.blendModeDic.push(BlendMode.OVERLAY);\r\n\r\n\t\tthis._depthSizeDic = new Array<number>(); // used to translate ints to depthSize-values\r\n\t\tthis._depthSizeDic.push(256);\r\n\t\tthis._depthSizeDic.push(512);\r\n\t\tthis._depthSizeDic.push(2048);\r\n\t\tthis._depthSizeDic.push(1024);\r\n\t\tthis._version = Array<number>(); // will contain 2 int (major-version, minor-version) for awd-version-check\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"awd\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\treturn (ParserUtils.toString(data, 3) == 'AWD');\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\t// this will be called when Dependency has finished loading.\r\n\t\t// the Assets waiting for this Bitmap, can be Texture or CubeTexture.\r\n\t\t// if the Bitmap is awaited by a CubeTexture, we need to check if its the last Bitmap of the CubeTexture,\r\n\t\t// so we know if we have to finalize the Asset (CubeTexture) or not.\r\n\t\tif (resourceDependency.assets.length == 1) {\r\n\t\t\tvar isCubeTextureArray:Array<string> = resourceDependency.id.split(\"#\");\r\n\t\t\tvar ressourceID:string = isCubeTextureArray[0];\r\n\t\t\tvar asset:TextureProxyBase;\r\n\t\t\tvar thisBitmapTexture:Texture2DBase;\r\n\t\t\tvar block:AWDBlock;\r\n\r\n\t\t\tif (isCubeTextureArray.length == 1) // Not a cube texture\r\n\t\t\t{\r\n\t\t\t\tasset = <Texture2DBase> resourceDependency.assets[0];\r\n\t\t\t\tif (asset) {\r\n\t\t\t\t\tvar mat:MethodMaterial;\r\n\t\t\t\t\tvar users:Array<string>;\r\n\r\n\t\t\t\t\tblock = this._blocks[ resourceDependency.id ];\r\n\t\t\t\t\tblock.data = asset; // Store finished asset\r\n\r\n\t\t\t\t\t// Reset name of texture to the one defined in the AWD file,\r\n\t\t\t\t\t// as opposed to whatever the image parser came up with.\r\n\t\t\t\t\tasset.resetAssetPath(block.name, null, true);\r\n\t\t\t\t\tblock.name = asset.name;\r\n\t\t\t\t\t// Finalize texture asset to dispatch texture event, which was\r\n\t\t\t\t\t// previously suppressed while the dependency was loaded.\r\n\t\t\t\t\tthis._pFinalizeAsset(<IAsset> asset);\r\n\r\n\t\t\t\t\tif (this._debug) {\r\n\t\t\t\t\t\tconsole.log(\"Successfully loaded Bitmap for texture\");\r\n\t\t\t\t\t\tconsole.log(\"Parsed texture: Name = \" + block.name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (isCubeTextureArray.length > 1) // Cube Texture\r\n\t\t\t{\r\n\t\t\t\tthisBitmapTexture = <BitmapTexture> resourceDependency.assets[0];\r\n\r\n\t\t\t\tvar tx:ImageTexture = <ImageTexture> thisBitmapTexture;\r\n\r\n\t\t\t\tthis._cubeTextures[ isCubeTextureArray[1] ] = tx.htmlImageElement; // ?\r\n\t\t\t\tthis._texture_users[ressourceID].push(1);\r\n\r\n\t\t\t\tif (this._debug) {\r\n\t\t\t\t\tconsole.log(\"Successfully loaded Bitmap \" + this._texture_users[ressourceID].length + \" / 6 for Cubetexture\");\r\n\t\t\t\t}\r\n\t\t\t\tif (this._texture_users[ressourceID].length == this._cubeTextures.length) {\r\n\r\n\t\t\t\t\tvar posX:any = this._cubeTextures[0];\r\n\t\t\t\t\tvar negX:any = this._cubeTextures[1];\r\n\t\t\t\t\tvar posY:any = this._cubeTextures[2];\r\n\t\t\t\t\tvar negY:any = this._cubeTextures[3];\r\n\t\t\t\t\tvar posZ:any = this._cubeTextures[4];\r\n\t\t\t\t\tvar negZ:any = this._cubeTextures[5];\r\n\r\n\t\t\t\t\tasset = <TextureProxyBase> new ImageCubeTexture(posX, negX, posY, negY, posZ, negZ);\r\n\t\t\t\t\tblock = this._blocks[ressourceID];\r\n\t\t\t\t\tblock.data = asset; // Store finished asset\r\n\r\n\t\t\t\t\t// Reset name of texture to the one defined in the AWD file,\r\n\t\t\t\t\t// as opposed to whatever the image parser came up with.\r\n\t\t\t\t\tasset.resetAssetPath(block.name, null, true);\r\n\t\t\t\t\tblock.name = asset.name;\r\n\t\t\t\t\t// Finalize texture asset to dispatch texture event, which was\r\n\t\t\t\t\t// previously suppressed while the dependency was loaded.\r\n\t\t\t\t\tthis._pFinalizeAsset(<IAsset> asset);\r\n\t\t\t\t\tif (this._debug) {\r\n\t\t\t\t\t\tconsole.log(\"Parsed CubeTexture: Name = \" + block.name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\t//not used - if a dependcy fails, the awaiting Texture or CubeTexture will never be finalized, and the default-bitmaps will be used.\r\n\t\t// this means, that if one Bitmap of a CubeTexture fails, the CubeTexture will have the DefaultTexture applied for all six Bitmaps.\r\n\t}\r\n\r\n\t/**\r\n\t * Resolve a dependency name\r\n\t *\r\n\t * @param resourceDependency The dependency to be resolved.\r\n\t */\r\n\tpublic _iResolveDependencyName(resourceDependency:ResourceDependency, asset:IAsset):string\r\n\t{\r\n\t\tvar oldName:string = asset.name;\r\n\r\n\t\tif (asset) {\r\n\t\t\tvar block:AWDBlock = this._blocks[parseInt(resourceDependency.id)];\r\n\t\t\t// Reset name of texture to the one defined in the AWD file,\r\n\t\t\t// as opposed to whatever the image parser came up with.\r\n\t\t\tasset.resetAssetPath(block.name, null, true);\r\n\t\t}\r\n\r\n\t\tvar newName:string = asset.name;\r\n\r\n\t\tasset.name = oldName;\r\n\r\n\t\treturn newName;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._byteData = this._pGetByteData();//getByteData();\r\n\t\t\tthis._startedParsing = true;\r\n\t\t}\r\n\r\n\t\tif (!this._parsed_header) {\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t//this._byteData.endian = Endian.LITTLE_ENDIAN;\r\n\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// Parse header and decompress body if needed\r\n\t\t\tthis.parseHeader();\r\n\r\n\t\t\tswitch (this._compression) {\r\n\r\n\t\t\t\tcase AWDParser.DEFLATE:\r\n\t\t\t\tcase AWDParser.LZMA:\r\n\t\t\t\t\tthis._pDieWithError('Compressed AWD formats not yet supported');\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase AWDParser.UNCOMPRESSED:\r\n\t\t\t\t\tthis._body = this._byteData;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t\t// Compressed AWD Formats not yet supported\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t\t\t/*\r\n\t\t\t\t case AWDParser.DEFLATE:\r\n\r\n\t\t\t\t this._body = new ByteArray();\r\n\t\t\t\t this._byteData.readBytes(this._body, 0, this._byteData.getBytesAvailable());\r\n\t\t\t\t this._body.uncompress();\r\n\r\n\t\t\t\t break;\r\n\t\t\t\t case AWDParser.LZMA:\r\n\r\n\t\t\t\t this._body = new ByteArray();\r\n\t\t\t\t this._byteData.readBytes(this._body, 0, this._byteData.getBytesAvailable());\r\n\t\t\t\t this._body.uncompress(COMPRESSIONMODE_LZMA);\r\n\r\n\t\t\t\t break;\r\n\t\t\t\t //*/\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis._parsed_header = true;\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t//this._body.endian = Endian.LITTLE_ENDIAN;// Should be default\r\n\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t}\r\n\r\n\t\tif (this._body) {\r\n\r\n\t\t\twhile (this._body.getBytesAvailable() > 0 && !this.parsingPaused) //&& this._pHasTime() )\r\n\t\t\t{\r\n\t\t\t\tthis.parseNextBlock();\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// Return complete status\r\n\t\t\tif (this._body.getBytesAvailable() == 0) {\r\n\t\t\t\tthis.dispose();\r\n\t\t\t\treturn  ParserBase.PARSING_DONE;\r\n\t\t\t} else {\r\n\t\t\t\treturn  ParserBase.MORE_TO_PARSE;\r\n\t\t\t}\r\n\t\t} else {\r\n\r\n\t\t\tswitch (this._compression) {\r\n\r\n\t\t\t\tcase AWDParser.DEFLATE:\r\n\t\t\t\tcase AWDParser.LZMA:\r\n\r\n\t\t\t\t\tif (this._debug) {\r\n\t\t\t\t\t\tconsole.log(\"(!) AWDParser Error: Compressed AWD formats not yet supported (!)\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\t\t\t// Error - most likely _body not set because we do not support compression.\r\n\t\t\treturn  ParserBase.PARSING_DONE;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\t}\r\n\r\n\tprivate dispose():void\r\n\t{\r\n\r\n\t\tfor (var c in this._blocks) {\r\n\r\n\t\t\tvar b:AWDBlock = <AWDBlock> this._blocks[ c ];\r\n\t\t\tb.dispose();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprivate parseNextBlock():void\r\n\t{\r\n\t\tvar block:AWDBlock;\r\n\t\tvar assetData:IAsset;\r\n\t\tvar isParsed:boolean = false;\r\n\t\tvar ns:number;\r\n\t\tvar type:number;\r\n\t\tvar flags:number;\r\n\t\tvar len:number;\r\n\r\n\t\tthis._cur_block_id = this._body.readUnsignedInt();\r\n\r\n\t\tns = this._body.readUnsignedByte();\r\n\t\ttype = this._body.readUnsignedByte();\r\n\t\tflags = this._body.readUnsignedByte();\r\n\t\tlen = this._body.readUnsignedInt();\r\n\r\n\t\tvar blockCompression:boolean = BitFlags.test(flags, BitFlags.FLAG4);\r\n\t\tvar blockCompressionLZMA:boolean = BitFlags.test(flags, BitFlags.FLAG5);\r\n\r\n\t\tif (this._accuracyOnBlocks) {\r\n\t\t\tthis._accuracyMatrix = BitFlags.test(flags, BitFlags.FLAG1);\r\n\t\t\tthis._accuracyGeo = BitFlags.test(flags, BitFlags.FLAG2);\r\n\t\t\tthis._accuracyProps = BitFlags.test(flags, BitFlags.FLAG3);\r\n\t\t\tthis._geoNrType = AWDParser.FLOAT32;\r\n\r\n\t\t\tif (this._accuracyGeo) {\r\n\t\t\t\tthis._geoNrType = AWDParser.FLOAT64;\r\n\t\t\t}\r\n\r\n\t\t\tthis._matrixNrType = AWDParser.FLOAT32;\r\n\r\n\t\t\tif (this._accuracyMatrix) {\r\n\t\t\t\tthis._matrixNrType = AWDParser.FLOAT64;\r\n\t\t\t}\r\n\r\n\t\t\tthis._propsNrType = AWDParser.FLOAT32;\r\n\r\n\t\t\tif (this._accuracyProps) {\r\n\t\t\t\tthis._propsNrType = AWDParser.FLOAT64;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar blockEndAll:number = this._body.position + len;\r\n\r\n\t\tif (len > this._body.getBytesAvailable()) {\r\n\t\t\tthis._pDieWithError('AWD2 block length is bigger than the bytes that are available!');\r\n\t\t\tthis._body.position += this._body.getBytesAvailable();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._newBlockBytes = new ByteArray();\r\n\r\n\r\n\t\tthis._body.readBytes(this._newBlockBytes, 0, len);\r\n\r\n\t\t//----------------------------------------------------------------------------\r\n\t\t// Compressed AWD Formats not yet supported\r\n\r\n\t\tif (blockCompression) {\r\n\t\t\tthis._pDieWithError('Compressed AWD formats not yet supported');\r\n\r\n\t\t\t/*\r\n\t\t\t if (blockCompressionLZMA)\r\n\t\t\t {\r\n\t\t\t this._newBlockBytes.uncompress(AWDParser.COMPRESSIONMODE_LZMA);\r\n\t\t\t }\r\n\t\t\t else\r\n\t\t\t {\r\n\t\t\t this._newBlockBytes.uncompress();\r\n\t\t\t }\r\n\t\t\t */\r\n\r\n\t\t}\r\n\r\n\t\t//----------------------------------------------------------------------------\r\n\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t//----------------------------------------------------------------------------\r\n\t\t//this._newBlockBytes.endian = Endian.LITTLE_ENDIAN;\r\n\t\t//----------------------------------------------------------------------------\r\n\r\n\t\tthis._newBlockBytes.position = 0;\r\n\t\tblock = new AWDBlock();\r\n\t\tblock.len = this._newBlockBytes.position + len;\r\n\t\tblock.id = this._cur_block_id;\r\n\r\n\t\tvar blockEndBlock:number = this._newBlockBytes.position + len;\r\n\r\n\t\tif (blockCompression) {\r\n\t\t\tthis._pDieWithError('Compressed AWD formats not yet supported');\r\n\t\t\t//blockEndBlock   = this._newBlockBytes.position + this._newBlockBytes.length;\r\n\t\t\t//block.len       = blockEndBlock;\r\n\t\t}\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"AWDBlock:  ID = \" + this._cur_block_id + \" | TypeID = \" + type + \" | Compression = \" + blockCompression + \" | Matrix-Precision = \" + this._accuracyMatrix + \" | Geometry-Precision = \" + this._accuracyGeo + \" | Properties-Precision = \" + this._accuracyProps);\r\n\t\t}\r\n\r\n\t\tthis._blocks[this._cur_block_id] = block;\r\n\r\n\t\tif ((this._version[0] == 3) && (this._version[1] == 0)) {\r\n            // probably should contain some info about the type of animation\r\n            var factory = new AS2SceneGraphFactory();\r\n\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 2:// just because i used blockID 2 in first exporter earlier\r\n\t\t\t\tcase 131:\r\n\t\t\t\t\tthis.parseShape2D(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:// just because i used blockID 3 in first exporter earlier\r\n\t\t\t\tcase 132:\r\n\t\t\t\t\tthis.parseShape2DFill(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 4:// just because i used blockID 4 in first exporter earlier\r\n\t\t\t\tcase 133:\r\n\t\t\t\t\tthis.parseTimeLine(this._cur_block_id, factory);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n        if ((this._version[0] > 2)||((this._version[0] >= 2) && (this._version[1] >= 1))) {\r\n\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 11:\r\n\t\t\t\t\tthis.parsePrimitves(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 31:\r\n\t\t\t\t\tthis.parseSkyboxInstance(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 41:\r\n\t\t\t\t\tthis.parseLight(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 42:\r\n\t\t\t\t\tthis.parseCamera(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t//  case 43:\r\n\t\t\t\t//      parseTextureProjector(_cur_block_id);\r\n\t\t\t\t//      isParsed = true;\r\n\t\t\t\t//      break;\r\n\r\n\t\t\t\tcase 51:\r\n\t\t\t\t\tthis.parseLightPicker(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 81:\r\n\t\t\t\t\tthis.parseMaterial_v1(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 83:\r\n\t\t\t\t\tthis.parseCubeTexture(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 91:\r\n\t\t\t\t\tthis.parseSharedMethodBlock(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 92:\r\n\t\t\t\t\tthis.parseShadowMethodBlock(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 111:\r\n\t\t\t\t\tthis.parseMeshPoseAnimation(this._cur_block_id, true);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 112:\r\n\t\t\t\t\tthis.parseMeshPoseAnimation(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 113:\r\n\t\t\t\t\tthis.parseVertexAnimationSet(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 122:\r\n\t\t\t\t\tthis.parseAnimatorSet(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 253:\r\n\t\t\t\t\tthis.parseCommand(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t//*/\r\n\t\t}\r\n\t\t//*\r\n\t\tif (isParsed == false) {\r\n\t\t\tswitch (type) {\r\n\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tthis.parseTriangleGeometrieBlock(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 22:\r\n\t\t\t\t\tthis.parseContainer(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 23:\r\n\t\t\t\t\tthis.parseMeshInstance(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 81:\r\n\t\t\t\t\tthis.parseMaterial(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 82:\r\n\t\t\t\t\tthis.parseTexture(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 101:\r\n\t\t\t\t\tthis.parseSkeleton(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 102:\r\n\t\t\t\t\tthis.parseSkeletonPose(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 103:\r\n\t\t\t\t\tthis.parseSkeletonAnimation(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 121:\r\n\t\t\t\t\t//this.parseUVAnimation(this._cur_block_id);\r\n\t\t\t\t\t//break;\r\n\t\t\t\tcase 254:\r\n\t\t\t\t\tthis.parseNameSpace(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 255:\r\n\t\t\t\t\tthis.parseMetaData(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif (this._debug) {\r\n\t\t\t\t\t\tconsole.log(\"AWDBlock:   Unknown BlockType  (BlockID = \" + this._cur_block_id + \") - Skip \" + len + \" bytes\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._newBlockBytes.position += len;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//*/\r\n\r\n\t\tvar msgCnt:number = 0;\r\n\t\tif (this._newBlockBytes.position == blockEndBlock) {\r\n\t\t\tif (this._debug) {\r\n\t\t\t\tif (block.errorMessages) {\r\n\t\t\t\t\twhile (msgCnt < block.errorMessages.length) {\r\n\t\t\t\t\t\tconsole.log(\"        (!) Error: \" + block.errorMessages[msgCnt] + \" (!)\");\r\n\t\t\t\t\t\tmsgCnt++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this._debug) {\r\n\t\t\t\tconsole.log(\"\\n\");\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this._debug) {\r\n\r\n\t\t\t\tconsole.log(\"  (!)(!)(!) Error while reading AWDBlock ID \" + this._cur_block_id + \" = skip to next block\");\r\n\r\n\t\t\t\tif (block.errorMessages) {\r\n\t\t\t\t\twhile (msgCnt < block.errorMessages.length) {\r\n\t\t\t\t\t\tconsole.log(\"        (!) Error: \" + block.errorMessages[msgCnt] + \" (!)\");\r\n\t\t\t\t\t\tmsgCnt++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._body.position = blockEndAll;\r\n\t\tthis._newBlockBytes = null;\r\n\r\n\t}\r\n\r\n\r\n\t//--Parser Blocks---------------------------------------------------------------------------\r\n\r\n\t//Block ID = 2\r\n\tprivate parseShape2D(blockID:number):void\r\n\t{\r\n\r\n\t\tvar geom:Geometry = new Geometry();\r\n\r\n\t\t// Read name and sub count\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar num_subs:number = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\t// Read optional properties\r\n\t\tvar props:AWDProperties = this.parseProperties({1:this._geoNrType, 2:this._geoNrType});\r\n\r\n\r\n\t\t// Loop through sub meshes\r\n\t\tvar subs_parsed:number = 0;\r\n\t\twhile (subs_parsed < num_subs) {\r\n\t\t\tvar i:number;\r\n\t\t\tvar sm_len:number, sm_end:number;\r\n\t\t\tvar sub_geom:TriangleSubGeometry;\r\n\t\t\tvar w_indices:Array<number>;\r\n\t\t\tvar weights:Array<number>;\r\n\r\n\t\t\tsm_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tsm_end = this._newBlockBytes.position + sm_len;\r\n\t\t\t//console.log(\"        (!) PARSE SUBMESH\");\r\n\r\n\t\t\t// Ignore for now (read uv for subshapes later)\"\r\n\t\t\tvar subProps:AWDProperties = this.parseProperties({1:this._geoNrType, 2:this._geoNrType});\r\n\t\t\t// Loop through data streams\r\n\t\t\tvar indices:Array<number> = new Array<number>();\r\n\t\t\tvar i_idx:number = 0;\r\n\t\t\twhile (this._newBlockBytes.position < sm_end) {\r\n\t\t\t\tvar idx:number = 0;\r\n\t\t\t\tvar uv_idx:number = 0;\r\n\t\t\t\tvar n_idx:number = 0;\r\n\t\t\t\tvar t_idx:number = 0;\r\n\t\t\t\tvar str_ftype:number, str_type:number, str_len:number, str_end:number;\r\n\r\n\t\t\t\t// Type, field type, length\r\n\t\t\t\tstr_type = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tstr_ftype = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tstr_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\tstr_end = this._newBlockBytes.position + str_len;\r\n\r\n\t\t\t\tvar x:number, y:number, z:number;\r\n\t\t\t\tvar type:number;\r\n\t\t\t\tvar r:number, g:number, b:number,a:number;\r\n\t\t\t\tvar u:number, v:number;\r\n\r\n\t\t\t\tif (str_type == 1) {\r\n\t\t\t\t\tvar verts:Array<number> = new Array<number>();\r\n\t\t\t\t\tvar uvs:Array<number> = new Array<number>();\r\n\t\t\t\t\tvar normals:Array<number> = new Array<number>();\r\n\t\t\t\t\tvar tangents:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\r\n\t\t\t\t\t\tx = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t\ty = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t\tz = -0.1 * subs_parsed;\r\n\t\t\t\t\t\t//z = subs_parsed;\r\n\t\t\t\t\t\t//z = (blockID*0.001) + subs_parsed\r\n\t\t\t\t\t\ttype = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t\tu = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t\tv = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t\tr = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t\tg = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t\tb = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t\ta = this.readNumber(this._accuracyGeo);\r\n\r\n\t\t\t\t\t\t// while this is true, be parse the vertex-data, so it can be rendered as \"normal\" 3d-geometry\r\n\t\t\t\t\t\tif (true) {\r\n\t\t\t\t\t\t\tuvs[idx] = 0.0;\r\n\t\t\t\t\t\t\tnormals[idx] = 0.0;\r\n\t\t\t\t\t\t\tverts[idx++] = x;\r\n\t\t\t\t\t\t\tuvs[idx] = 0.0;\r\n\t\t\t\t\t\t\tnormals[idx] = 0.0;\r\n\t\t\t\t\t\t\tverts[idx++] = y;\r\n\t\t\t\t\t\t\tnormals[idx] = 1.0;\r\n\t\t\t\t\t\t\tverts[idx++] = z;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t// parse and set-data, so the 3d-geometry contains all data (but is no longer valid for normal 3d-render)\r\n\t\t\t\t\t\t\t// away3d-vertexdata    |   awayJS-shape-data\r\n\t\t\t\t\t\t\t// -----------------------------------------------------------------------\r\n\t\t\t\t\t\t\t// pos.x                |   pos.x\r\n\t\t\t\t\t\t\t// pos.y                |   pos.y\r\n\t\t\t\t\t\t\t// pos.z                |   not used\r\n\t\t\t\t\t\t\t// normal.x             |   curve-type (0:notCurved, 1: convex, 2:concave)\r\n\t\t\t\t\t\t\t// normal.y             |   alpha\r\n\t\t\t\t\t\t\t// normal.z             |   not used\r\n\t\t\t\t\t\t\t// uv.u                 |   curve.u\r\n\t\t\t\t\t\t\t// uv.v                 |   curve.v\r\n\t\t\t\t\t\t\t// tangent.x            |   red\r\n\t\t\t\t\t\t\t// tangent.y            |   green\r\n\t\t\t\t\t\t\t// tangent.z            |   blue\r\n\t\t\t\t\t\t\tverts[idx++] = x;\r\n\t\t\t\t\t\t\t//uv2[idx] = x;\r\n\t\t\t\t\t\t\tverts[idx++] = y;\r\n\t\t\t\t\t\t\t//uv2[idx] = y;\r\n\t\t\t\t\t\t\tverts[idx++] = z;\r\n\t\t\t\t\t\t\tuvs[uv_idx++] = u;\r\n\t\t\t\t\t\t\tuvs[uv_idx++] = v;\r\n\t\t\t\t\t\t\tnormals[n_idx++] = type;\r\n\t\t\t\t\t\t\tnormals[n_idx++] = a;\r\n\t\t\t\t\t\t\tnormals[n_idx++] = 0;\r\n\t\t\t\t\t\t\t// trace(\"r=\" + r + \" g=\" + g + \" b=\" + b + \" a=\" + a);\r\n\t\t\t\t\t\t\ttangents[t_idx++] = r;\r\n\t\t\t\t\t\t\ttangents[t_idx++] = g;\r\n\t\t\t\t\t\t\ttangents[t_idx++] = b;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// in future we will only have one stream for all face-indicies\r\n\t\t\t\t// only keeping it split up for the moment,\r\n\t\t\t\t// so we can debug by choosing what kind of triangles are added to subGeo.\r\n\t\t\t\telse if (str_type == 2) {\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tvar thisVal:number= this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\tindices[i_idx++] = thisVal;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (str_type == 3) {\r\n\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tvar thisVal:number= this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\tindices[i_idx++] = thisVal;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}else if (str_type == 4) {\r\n\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tvar thisVal:number= this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\tindices[i_idx++] = thisVal;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}else if (str_type == 5) {\r\n\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tvar thisVal:number= this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\tindices[i_idx++] = thisVal;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._newBlockBytes.position = str_end;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.parseUserAttributes(); // Ignore sub-mesh attributes for now\r\n\r\n\t\t\tsub_geom = new TriangleSubGeometry(true);\r\n\t\t\tsub_geom.autoDeriveNormals = false;\r\n\t\t\t// when rendering as \"normal\" 3d-geometry, we need to autoDerive tangents\r\n\t\t\tif(true){\r\n\t\t\t\tsub_geom.autoDeriveTangents = true;\r\n\t\t\t}\r\n\t\t\t// if using a new Material,\r\n\t\t\telse{\r\n\t\t\t\tsub_geom.updateVertexTangents(tangents);\r\n\t\t\t}\r\n\t\t\tsub_geom.updateIndices(indices);\r\n\t\t\tsub_geom.updatePositions(verts);\r\n\t\t\tsub_geom.updateUVs(uvs);\r\n\t\t\tsub_geom.updateVertexNormals(normals);\r\n\r\n\t\t\tgeom.addSubGeometry(sub_geom);\r\n\r\n\t\t\tsubs_parsed++;\r\n\t\t}\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(<IAsset> geom, name);\r\n\t\tthis._blocks[blockID].data = geom;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a TriangleGeometry: Name = \" + name + \"| Id = \" + sub_geom.id);\r\n\r\n\r\n\t}\r\n\r\n\t//Block ID = 3\r\n\tprivate parseShape2DFill(blockID:number):void {\r\n\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar fill_type:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar fill_props:AWDProperties = this.parseProperties({1:AWDParser.UINT32});// { 1:UINT32, 6:AWDSTRING }  ); //; , 2:UINT32, 3:UINT32, 5:BOOL } );\r\n\r\n\t\t//console.log(\"Parsed a fill\");\r\n\t\tswitch (fill_type) {\r\n\t\t\t// to do, not all properties are set on all primitives\r\n\r\n\t\t\tcase 0:\r\n\t\t\t\t//console.log(\"Parsed a Solid FILL: Name = \" + name);\r\n\t\t\t\tvar material:MethodMaterial = new MethodMaterial(fill_props.get(1, 0xcccccc));\r\n\t\t\t\tmaterial.bothSides = true;\r\n\t\t\t\tthis._pFinalizeAsset(<IAsset> material, name);\r\n\t\t\t\tthis._blocks[blockID].data = material;\r\n\t\t\t\t//prefab = new away.prefabs.PrimitivePlanePrefab(props.get(101, 100), props.get(102, 100), props.get(301, 1), props.get(302, 1), props.get(701, true), props.get(702, false));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\tconsole.log(\"Parsed a bitmap FILL: Name = \" + name);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tconsole.log(\"Parsed a linear gradient FILL: Name = \" + name);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tconsole.log(\"Parsed a radial gradient FILL: Name = \" + name);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.log(\"Parsed a unknown fillstyle: Name = \" + name);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tthis.parseUserAttributes();\r\n\t}\r\n\r\n\t//Block ID = 4\r\n\tprivate parseTimeLine(blockID:number, factory:TimelineSceneGraphFactory):void {\r\n\r\n\t\tvar i:number;\r\n\t\tvar j:number;\r\n\t\tvar k:number;\r\n\t\tvar timeLineContainer = factory.createMovieClip();\r\n\t\tvar name = this.parseVarStr();\r\n\t\tvar isScene = !!this._newBlockBytes.readUnsignedByte();\r\n\t\tvar sceneID = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar numFrames = this._newBlockBytes.readUnsignedShort();\r\n        var objectIDMap : { [id:string]:number; } = {};\r\n\r\n\t\t// var previousTimeLine:TimeLineFrame;\r\n\t\t// var fill_props:AWDProperties = this.parseProperties({1:AWDParser.UINT32});// { 1:UINT32, 6:AWDSTRING }  ); //; , 2:UINT32, 3:UINT32, 5:BOOL } );\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a TIMELINE: Name = \" + name + \"| isScene = \" + isScene + \"| sceneID = \" + sceneID + \"| numFrames = \" + numFrames);\r\n\r\n\t\tvar totalDuration = 0;\r\n\t\tfor (i = 0; i < numFrames; i++) {\r\n\r\n\t\t\tvar frame = new TimelineKeyFrame();\r\n\t\t\tvar traceString = \"frame = \" + i;\r\n\r\n\t\t\tvar frameDuration = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tframe.setFrameTime(totalDuration, frameDuration);\r\n\t\t\ttotalDuration += frameDuration;\r\n\t\t\t//console.log(\"duration = \" + frameDuration);\r\n\r\n\t\t\tvar numLabels = this._newBlockBytes.readUnsignedShort();\r\n\t\t\tfor (j = 0; j < numLabels; j++) {\r\n\t\t\t\tvar labelType = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tvar label = this.parseVarStr();\r\n                // TODO: Handle labels differently\r\n                //timeLineContainer.addFrameLabel(new FrameLabel(label, labelType, frame));\r\n\t\t\t\ttraceString += \"\\n     label = \" + label + \" - labelType = \" + labelType;\r\n\t\t\t}\r\n\r\n\t\t\tvar numCommands = this._newBlockBytes.readUnsignedShort();\r\n\t\t\tvar commandString = \"\\n      Commands \" + numCommands;\r\n\t\t\tfor (j = 0; j < numCommands; j++) {\r\n\t\t\t\tvar objectID:number;\r\n\t\t\t\tvar resourceID:number;\r\n\t\t\t\tvar commandType = this._newBlockBytes.readUnsignedShort();\r\n\r\n                // 1 = UpdateObject (also used to input new object)\r\n                // 3 = remove object\r\n                // 4 = add / update sound\r\n\r\n\t\t\t\tswitch (commandType) {\r\n\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\tcase 2:\r\n\r\n\t\t\t\t\t\t// Place Object Command\r\n                        var properties: { [key: string]: any; } = {};\r\n\t\t\t\t\t\tvar hasResource = !!this._newBlockBytes.readByte();\r\n\t\t\t\t\t\tvar hasDisplayMatrix = !!this._newBlockBytes.readByte();\r\n\t\t\t\t\t\tvar hasColorMatrix = !!this._newBlockBytes.readByte();\r\n\t\t\t\t\t\tvar hasDepthChange = !!this._newBlockBytes.readByte();\r\n\t\t\t\t\t\tvar hasFilterChange = !!this._newBlockBytes.readByte();\r\n\t\t\t\t\t\tvar hasBlendModeChange = !!this._newBlockBytes.readByte();\r\n\t\t\t\t\t\tvar hasDepthClipChange = !!this._newBlockBytes.readByte();\r\n\t\t\t\t\t\tvar hasVisibilityChange = !!this._newBlockBytes.readByte();\r\n\r\n\t\t\t\t\t\tobjectID = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\t\t\t\tif (hasResource) {\r\n\t\t\t\t\t\t\tresourceID = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\t\tcommandString += \"\\n      - Add new Resource = \" + resourceID + \" as object_id = \" + objectID;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcommandString += \"\\n      - Update object_id = \" + objectID;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (hasDisplayMatrix) {\r\n\t\t\t\t\t\t\tvar transformArray:number[] = [];\r\n\t\t\t\t\t\t\tvar thisMatrix = new Matrix3D();\r\n\t\t\t\t\t\t\t// TODO: implement this in exporter (make transform optional 3d):\r\n\t\t\t\t\t\t\tvar is3d = false; // !!this._newBlockBytes.readByte();\r\n\t\t\t\t\t\t\tif (is3d) {\r\n\t\t\t\t\t\t\t\tthisMatrix = this.parseMatrix3D();\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tfor (k = 0; k < 6; k++) {\r\n\t\t\t\t\t\t\t\t\ttransformArray.push(this._newBlockBytes.readFloat());\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t// TODO: set rotation and scale\r\n\t\t\t\t\t\t\t\tthisMatrix.position = new Vector3D(transformArray[4], transformArray[5], 0);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tproperties[\"_iMatrix3D\"] = thisMatrix;\r\n\t\t\t\t\t\t\tcommandString += \"\\n                transformArray = \" + transformArray;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (hasColorMatrix) {\r\n\t\t\t\t\t\t\tvar colorMatrix:number[] = [];\r\n\t\t\t\t\t\t\tfor (k = 0; k < 20; k++) {\r\n\t\t\t\t\t\t\t\tcolorMatrix.push(this._newBlockBytes.readFloat());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// TODO: set ColorTransform on objectProps\r\n\t\t\t\t\t\t\tcommandString += \"\\n                colorMatrix = \" + colorMatrix;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (hasDepthChange) {\r\n\t\t\t\t\t\t\tvar newDepth = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\t\tcommandString += \"\\n                Depth = \" + newDepth;\r\n\t\t\t\t\t\t\t// TODO: set depth on objectProps\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (hasFilterChange) {\r\n\t\t\t\t\t\t\t// TODO: add filter\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (hasBlendModeChange) {\r\n\t\t\t\t\t\t\tvar newBlendMode = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\t\t\tcommandString += \"\\n                BlendMode = \" + newBlendMode;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (hasDepthClipChange) {\r\n\t\t\t\t\t\t\tvar newClipDepth = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\t\tcommandString += \"\\n                ClipDepth = \" + newClipDepth;\r\n\t\t\t\t\t\t\t// TODO: set depthClipChange on objectProps\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (hasVisibilityChange) {\r\n\t\t\t\t\t\t\tvar newVisibility = Boolean(this._newBlockBytes.readByte());\r\n\t\t\t\t\t\t\tcommandString += \"\\n                Visibitily = \" + newVisibility;\r\n                            properties[\"visible\"] = newVisibility;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar numFills = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\tcommandString += \"\\n                number of fills = \" + numFills;\r\n\t\t\t\t\t\tvar fillsIDs:number[] = [];\r\n\t\t\t\t\t\tfor (k = 0; k < numFills; k++) {\r\n\t\t\t\t\t\t\tfillsIDs.push(this._newBlockBytes.readUnsignedInt());\r\n\t\t\t\t\t\t\tcommandString += \"\\n                    id of fill = \" + fillsIDs[k];\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar instanceName = this.parseVarStr();\r\n\t\t\t\t\t\tif (instanceName.length) {\r\n                            properties[\"name\"] = instanceName;\r\n\t\t\t\t\t\t\tcommandString += \"\\n                instanceName = \" + instanceName;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// if this is a \"ADD NEW OBJECT\"-command,\r\n\t\t\t\t\t\t// we need to lookup the new object by AWD ID.\r\n\t\t\t\t\t\tif (hasResource) {\r\n                            var newChild;\r\n\t\t\t\t\t\t\t// sound is added to timeline with dedicated Command, as it is no display-object (has no matrix etc)\r\n\t\t\t\t\t\t\t// check if a Geometry can be found at the resourceID (AWD-ID)\r\n\t\t\t\t\t\t\tvar returnedArray:any[] = this.getAssetByID(resourceID, [ AssetType.GEOMETRY ]);\r\n\t\t\t\t\t\t\tif (returnedArray[0]) {\r\n\t\t\t\t\t\t\t\tvar geom = <Geometry>returnedArray[1];\r\n                                newChild = new Mesh(geom);\r\n\t\t\t\t\t\t\t\t// geometry found. create new Command, add the props and the materials to it\r\n\t\t\t\t\t\t\t\tfor (k = 0; k < numFills; k++) {\r\n\t\t\t\t\t\t\t\t\tvar returnedArray2:any[] = this.getAssetByID(fillsIDs[k], [ AssetType.MATERIAL ]);\r\n\t\t\t\t\t\t\t\t\tif (returnedArray2[0] && newChild.subMeshes.length > k)\r\n                                        newChild.subMeshes[k].material = returnedArray2[1];\r\n                                }\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// no geometry found, so we check for TIMELINE.\r\n\t\t\t\t\t\t\t\tvar returnedArray:any[] = this.getAssetByID(resourceID, [ AssetType.TIMELINE ]);\r\n\t\t\t\t\t\t\t\tif (returnedArray[0])\r\n                                    newChild = <MovieClip>returnedArray[1];\r\n\t\t\t\t\t\t\t}\r\n\r\n                            var instanceID = timeLineContainer.registerPotentialChild(newChild);\r\n                            objectIDMap[objectID] = instanceID;\r\n                            frame.addConstructCommand(new AddChildCommand(instanceID));\r\n\t\t\t\t\t\t}\r\n\r\n                        var instanceID = objectIDMap[objectID];\r\n\r\n                        for (var key in properties) {\r\n                            if (properties.hasOwnProperty(key)) {\r\n                                frame.addConstructCommand(new UpdatePropertyCommand(instanceID, key, properties[key]));\r\n                            }\r\n                        }\r\n\r\n                        break;\r\n\r\n\t\t\t\t\tcase 3:\r\n\r\n\t\t\t\t\t\t// Remove Object Command\r\n\t\t\t\t\t\tobjectID = this._newBlockBytes.readUnsignedInt();\r\n                        var instanceID = objectIDMap[objectID];\r\n\t\t\t\t\t\tframe.addConstructCommand(new RemoveChildCommand(instanceID));\r\n\t\t\t\t\t\tcommandString += \"\\n       - Remove object with ID: \" + objectID;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 4:\r\n\r\n\t\t\t\t\t\t// Add Sound Command\r\n\t\t\t\t\t\t// TODO: create CommandPropsSound and check which asset to use\r\n\t\t\t\t\t\tobjectID = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\tresourceID = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\t// TODO: implement sound in timeline\r\n\t\t\t\t\t\tcommandString += \"\\n      - Add new Sound AWD-ID = \" + resourceID.toString() + \" as object_id = \" + objectID.toString();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\tcommandString += \"\\n       - Unknown Command Type = \" + commandType;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar length_code = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tif (length_code > 0) {\r\n                // TODO: Script should probably not be attached to keyframes?\r\n\t\t\t\tvar frame_code = this._newBlockBytes.readUTFBytes(length_code);\r\n\t\t\t\t//frame.addToScript(frame_code);\r\n\t\t\t\ttraceString += \"\\nframe-code = \" + frame_code;\r\n\t\t\t}\r\n\t\t\ttraceString += commandString;\r\n\t\t\t//trace(\"length_code = \"+length_code+\" frame_code = \"+frame_code);\r\n\t\t\tthis._newBlockBytes.readUnsignedInt();// user attributes - skip for now\r\n\t\t\t//this.parseUserAttributes(); // Ignore sub-mesh attributes for now\r\n\t\t\t//console.log(traceString);\r\n\t\t\ttimeLineContainer.addFrame(frame);\r\n\r\n\t\t}\r\n\r\n\t\tthis._pFinalizeAsset(<IAsset>timeLineContainer, name);\r\n\t\tthis._blocks[blockID].data = timeLineContainer;\r\n\t\tthis.parseProperties(null);\r\n\t\tthis.parseUserAttributes();\r\n\t}\r\n\r\n\t//Block ID = 1\r\n    private parseTriangleGeometrieBlock(blockID:number):void\r\n    {\r\n\r\n        var geom:Geometry = new Geometry();\r\n\r\n        // Read name and sub count\r\n        var name:string = this.parseVarStr();\r\n        var num_subs:number = this._newBlockBytes.readUnsignedShort();\r\n\r\n        // Read optional properties\r\n        var props:AWDProperties = this.parseProperties({1:this._geoNrType, 2:this._geoNrType});\r\n        var geoScaleU:number = props.get(1, 1);\r\n        var geoScaleV:number = props.get(2, 1);\r\n\r\n        // Loop through sub meshes\r\n        var subs_parsed:number = 0;\r\n        while (subs_parsed < num_subs) {\r\n            var is_2d_geom:boolean=false;\r\n            var i:number;\r\n            var sm_len:number, sm_end:number;\r\n            var w_indices:Array<number>;\r\n            var weights:Array<number>;\r\n\r\n            sm_len = this._newBlockBytes.readUnsignedInt();\r\n            sm_end = this._newBlockBytes.position + sm_len;\r\n\r\n            var subProps:AWDProperties = this.parseProperties({1:this._geoNrType, 2:this._geoNrType});\r\n            // Loop through data streams\r\n            while (this._newBlockBytes.position < sm_end) {\r\n                var idx:number = 0;\r\n                var uv_idx:number = 0;\r\n                var n_idx:number = 0;\r\n                var t_idx:number = 0;\r\n                var str_ftype:number, str_type:number, str_len:number, str_end:number;\r\n\r\n                // Type, field type, length\r\n                str_type = this._newBlockBytes.readUnsignedByte();\r\n                str_ftype = this._newBlockBytes.readUnsignedByte();\r\n                str_len = this._newBlockBytes.readUnsignedInt();\r\n                str_end = this._newBlockBytes.position + str_len;\r\n\r\n                var x:number, y:number, z:number;\r\n\r\n                if (str_type == 1) {//vertex 3d positions\r\n                    var verts:Array<number> = new Array<number>();\r\n\r\n                    while (this._newBlockBytes.position < str_end) {\r\n\r\n                        x = this.readNumber(this._accuracyGeo);\r\n                        y = this.readNumber(this._accuracyGeo);\r\n                        z = this.readNumber(this._accuracyGeo);\r\n\r\n                        verts[idx++] = x;\r\n                        verts[idx++] = y;\r\n                        verts[idx++] = z;\r\n                    }\r\n                } else if (str_type == 2) {//face indicies positions\r\n                    var indices:Array<number> = new Array<number>();\r\n\r\n                    while (this._newBlockBytes.position < str_end) {\r\n                        indices[idx++] = this._newBlockBytes.readUnsignedShort();\r\n                    }\r\n\r\n                } else if (str_type == 3) {\r\n                    var uvs:Array<number> = new Array<number>();\r\n                    while (this._newBlockBytes.position < str_end) {\r\n                        uvs[idx++] = this.readNumber(this._accuracyGeo);\r\n\r\n                    }\r\n                } else if (str_type == 4) {\r\n\r\n                    var normals:Array<number> = new Array<number>();\r\n\r\n                    while (this._newBlockBytes.position < str_end) {\r\n                        normals[idx++] = this.readNumber(this._accuracyGeo);\r\n                    }\r\n\r\n                } else if (str_type == 6) {\r\n                    w_indices = Array<number>();\r\n\r\n                    while (this._newBlockBytes.position < str_end) {\r\n                        w_indices[idx++] = this._newBlockBytes.readUnsignedShort()*3;\r\n                    }\r\n\r\n                } else if (str_type == 7) {\r\n\r\n                    weights = new Array<number>();\r\n\r\n                    while (this._newBlockBytes.position < str_end) {\r\n                        weights[idx++] = this.readNumber(this._accuracyGeo);\r\n                    }\r\n                } else if (str_type == 8) {// 2d-positions - not used yet.\r\n                    this._newBlockBytes.position = str_end;\r\n                } else if (str_type == 9) {// combined vertex3D stream 13 x float32\r\n                    this._newBlockBytes.position = str_end;\r\n                } else if (str_type == 10) {// combined vertex2D stream 9 x float32\r\n\r\n                    var x:number, y:number, z:number;\r\n                    var type:number;\r\n                    var r:number, g:number, b:number,a:number;\r\n                    var u:number, v:number;\r\n\r\n                    var verts:Array<number> = new Array<number>();\r\n                    var uvs:Array<number> = new Array<number>();\r\n                    var normals:Array<number> = new Array<number>();\r\n                    var tangents:Array<number> = new Array<number>();\r\n\r\n                    while (this._newBlockBytes.position < str_end) {\r\n\r\n                        x = this.readNumber(this._accuracyGeo);\r\n                        y = this.readNumber(this._accuracyGeo);\r\n                        z = -0.1 * subs_parsed;\r\n                        //z = subs_parsed;\r\n                        //z = (blockID*0.001) + subs_parsed\r\n                        type = this.readNumber(this._accuracyGeo);\r\n                        u = this.readNumber(this._accuracyGeo);\r\n                        v = this.readNumber(this._accuracyGeo);\r\n                        /* r = this.readNumber(this._accuracyGeo);\r\n                         g = this.readNumber(this._accuracyGeo);\r\n                         b = this.readNumber(this._accuracyGeo);\r\n                         a = this.readNumber(this._accuracyGeo);*/\r\n\r\n                        // while this is true, be parse the vertex-data, so it can be rendered as \"normal\" 3d-geometry\r\n                        if (true) {\r\n                            uvs[idx] = 0.0;\r\n                            normals[idx] = 0.0;\r\n                            verts[idx++] = x;\r\n                            uvs[idx] = 0.0;\r\n                            normals[idx] = 0.0;\r\n                            verts[idx++] = y;\r\n                            normals[idx] = 1.0;\r\n                            verts[idx++] = z;\r\n                        }\r\n                        else{\r\n                            // parse and set-data, so the 3d-geometry contains all data (but is no longer valid for normal 3d-render)\r\n                            // away3d-vertexdata    |   awayJS-shape-data\r\n                            // -----------------------------------------------------------------------\r\n                            // pos.x                |   pos.x\r\n                            // pos.y                |   pos.y\r\n                            // pos.z                |   pos.z (for now we just use this as depth (set each subgeo to its own depth))\r\n                            // normal.x             |   curve-type (0:notCurved, 1: convex, 2:concave)\r\n                            // normal.y             |   alpha\r\n                            // normal.z             |   not used\r\n                            // uv.u                 |   curve.u\r\n                            // uv.v                 |   curve.v\r\n                            // tangent.x            |   red\r\n                            // tangent.y            |   green\r\n                            // tangent.z            |   blue\r\n                            verts[idx++] = x;\r\n                            //uv2[idx] = x;\r\n                            verts[idx++] = y;\r\n                            //uv2[idx] = y;\r\n                            verts[idx++] = z;\r\n                            uvs[uv_idx++] = u;\r\n                            uvs[uv_idx++] = v;\r\n                            normals[n_idx++] = type;\r\n                            normals[n_idx++] = a;\r\n                            normals[n_idx++] = 0;\r\n                            // trace(\"r=\" + r + \" g=\" + g + \" b=\" + b + \" a=\" + a);\r\n                            tangents[t_idx++] = r;\r\n                            tangents[t_idx++] = g;\r\n                            tangents[t_idx++] = b;\r\n                        }\r\n                    }\r\n                } else if (str_type == 11) {// combined vertex2D stream 5 x float32\r\n                    this._newBlockBytes.position = str_end;\r\n                }else {\r\n                    this._newBlockBytes.position = str_end;\r\n                }\r\n\r\n            }\r\n\r\n            this.parseUserAttributes(); // Ignore sub-mesh attributes for now\r\n            var sub_geom:TriangleSubGeometry;\r\n            sub_geom = new TriangleSubGeometry(true);\r\n            if (weights)\r\n                sub_geom.jointsPerVertex = weights.length/(verts.length/3);\r\n            if (normals)\r\n                sub_geom.autoDeriveNormals = false;\r\n            if (uvs)\r\n                sub_geom.autoDeriveUVs = false;\r\n            sub_geom.autoDeriveNormals = false;\r\n            // when rendering as \"normal\" 3d-geometry, we need to autoDerive tangents\r\n            if(true){\r\n                sub_geom.autoDeriveTangents = true;\r\n            }\r\n            sub_geom.updateIndices(indices);\r\n            sub_geom.updatePositions(verts);\r\n            sub_geom.updateVertexNormals(normals);\r\n            sub_geom.updateUVs(uvs);\r\n            sub_geom.updateVertexTangents(null);\r\n            sub_geom.updateJointWeights(weights);\r\n            sub_geom.updateJointIndices(w_indices);\r\n\r\n            var scaleU:number = subProps.get(1, 1);\r\n            var scaleV:number = subProps.get(2, 1);\r\n            var setSubUVs:boolean = false; //this should remain false atm, because in AwayBuilder the uv is only scaled by the geometry\r\n\r\n            if ((geoScaleU != scaleU) || (geoScaleV != scaleV)) {\r\n                setSubUVs = true;\r\n                scaleU = geoScaleU/scaleU;\r\n                scaleV = geoScaleV/scaleV;\r\n            }\r\n\r\n            if (setSubUVs)\r\n                sub_geom.scaleUV(scaleU, scaleV);\r\n\r\n            geom.addSubGeometry(sub_geom);\r\n\r\n            // TODO: Somehow map in-sub to out-sub indices to enable look-up\r\n            // when creating meshes (and their material assignments.)\r\n\r\n            subs_parsed++;\r\n        }\r\n        if ((geoScaleU != 1) || (geoScaleV != 1))\r\n            geom.scaleUV(geoScaleU, geoScaleV);\r\n        this.parseUserAttributes();\r\n        this._pFinalizeAsset(<IAsset> geom, name);\r\n        this._blocks[blockID].data = geom;\r\n\r\n        if (this._debug) {\r\n            console.log(\"Parsed a TriangleGeometry: Name = \" + name + \"| Id = \" + sub_geom.id);\r\n        }\r\n\r\n    }\r\n\r\n\t//Block ID = 11\r\n\tprivate parsePrimitves(blockID:number):void\r\n\t{\r\n\t\tvar name:string;\r\n\t\tvar prefab:PrefabBase;\r\n\t\tvar primType:number;\r\n\t\tvar subs_parsed:number;\r\n\t\tvar props:AWDProperties;\r\n\t\tvar bsm:Matrix3D;\r\n\r\n\t\t// Read name and sub count\r\n\t\tname = this.parseVarStr();\r\n\t\tprimType = this._newBlockBytes.readUnsignedByte();\r\n\t\tprops = this.parseProperties({101:this._geoNrType, 102:this._geoNrType, 103:this._geoNrType, 110:this._geoNrType, 111:this._geoNrType, 301:AWDParser.UINT16, 302:AWDParser.UINT16, 303:AWDParser.UINT16, 701:AWDParser.BOOL, 702:AWDParser.BOOL, 703:AWDParser.BOOL, 704:AWDParser.BOOL});\r\n\r\n\t\tvar primitiveTypes:Array<string> = [\"Unsupported Type-ID\", \"PrimitivePlanePrefab\", \"PrimitiveCubePrefab\", \"PrimitiveSpherePrefab\", \"PrimitiveCylinderPrefab\", \"PrimitivesConePrefab\", \"PrimitivesCapsulePrefab\", \"PrimitivesTorusPrefab\"]\r\n\r\n\t\tswitch (primType) {\r\n\t\t\t// to do, not all properties are set on all primitives\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\tprefab = new PrimitivePlanePrefab(props.get(101, 100), props.get(102, 100), props.get(301, 1), props.get(302, 1), props.get(701, true), props.get(702, false));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2:\r\n\t\t\t\tprefab = new PrimitiveCubePrefab(props.get(101, 100), props.get(102, 100), props.get(103, 100), props.get(301, 1), props.get(302, 1), props.get(303, 1), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 3:\r\n\t\t\t\tprefab = new PrimitiveSpherePrefab(props.get(101, 50), props.get(301, 16), props.get(302, 12), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 4:\r\n\t\t\t\tprefab = new PrimitiveCylinderPrefab(props.get(101, 50), props.get(102, 50), props.get(103, 100), props.get(301, 16), props.get(302, 1), true, true, true); // bool701, bool702, bool703, bool704);\r\n\t\t\t\tif (!props.get(701, true))\r\n\t\t\t\t\t(<PrimitiveCylinderPrefab>prefab).topClosed = false;\r\n\t\t\t\tif (!props.get(702, true))\r\n\t\t\t\t\t(<PrimitiveCylinderPrefab>prefab).bottomClosed = false;\r\n\t\t\t\tif (!props.get(703, true))\r\n\t\t\t\t\t(<PrimitiveCylinderPrefab>prefab).yUp = false;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 5:\r\n\t\t\t\tprefab = new PrimitiveConePrefab(props.get(101, 50), props.get(102, 100), props.get(301, 16), props.get(302, 1), props.get(701, true), props.get(702, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 6:\r\n\t\t\t\tprefab = new PrimitiveCapsulePrefab(props.get(101, 50), props.get(102, 100), props.get(301, 16), props.get(302, 15), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 7:\r\n\t\t\t\tprefab = new PrimitiveTorusPrefab(props.get(101, 50), props.get(102, 50), props.get(301, 16), props.get(302, 8), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tprefab = new PrefabBase();\r\n\t\t\t\tconsole.log(\"ERROR: UNSUPPORTED PREFAB_TYPE\");\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif ((props.get(110, 1) != 1) || (props.get(111, 1) != 1)) {\r\n\t\t\t//geom.subGeometries;\r\n\t\t\t//geom.scaleUV(props.get(110, 1), props.get(111, 1)); //TODO add back scaling to prefabs\r\n\t\t}\r\n\r\n\t\tthis.parseUserAttributes();\r\n\t\tprefab.name = name;\r\n\t\tthis._pFinalizeAsset(prefab, name);\r\n\t\tthis._blocks[blockID].data = prefab;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tif ((primType < 0) || (primType > 7)) {\r\n\t\t\t\tprimType = 0;\r\n\t\t\t}\r\n\t\t\tconsole.log(\"Parsed a Primivite: Name = \" + name + \"| type = \" + primitiveTypes[primType]);\r\n\t\t}\r\n\t}\r\n\r\n\t// Block ID = 22\r\n\tprivate parseContainer(blockID:number):void\r\n\t{\r\n\t\tvar name:string;\r\n\t\tvar par_id:number;\r\n\t\tvar mtx:Matrix3D;\r\n\t\tvar ctr:DisplayObjectContainer;\r\n\t\tvar parent:DisplayObjectContainer;\r\n\r\n\t\tpar_id = this._newBlockBytes.readUnsignedInt();\r\n\t\tmtx = this.parseMatrix3D();\r\n\t\tname = this.parseVarStr();\r\n\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tctr = new DisplayObjectContainer();\r\n\t\tctr.transform.matrix3D = mtx;\r\n\r\n\t\tvar returnedArray:Array<any> = this.getAssetByID(par_id, [AssetType.CONTAINER, AssetType.LIGHT, AssetType.MESH]);\r\n\r\n\t\tif (returnedArray[0]) {\r\n\t\t\tvar obj:DisplayObject = (<DisplayObjectContainer> returnedArray[1]).addChild(ctr);\r\n\t\t\tparentName = (<DisplayObjectContainer> returnedArray[1]).name;\r\n\t\t} else if (par_id > 0) {\r\n\t\t\tthis._blocks[ blockID ].addError(\"Could not find a parent for this ObjectContainer3D\");\r\n\t\t} else {\r\n\t\t\t//add to the content property\r\n\t\t\t(<DisplayObjectContainer> this._pContent).addChild(ctr);\r\n\t\t}\r\n\r\n\t\t// in AWD version 2.1 we read the Container properties\r\n\t\tif ((this._version[0] == 2) && (this._version[1] == 1)) {\r\n\t\t\tvar props:AWDProperties = this.parseProperties({1:this._matrixNrType, 2:this._matrixNrType, 3:this._matrixNrType, 4:AWDParser.UINT8});\r\n\t\t\tctr.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\t}\r\n\t\t// in other versions we do not read the Container properties\r\n\t\telse {\r\n\t\t\tthis.parseProperties(null);\r\n\t\t}\r\n\r\n\t\t// the extraProperties should only be set for AWD2.1-Files, but is read for both versions\r\n\t\tctr.extra = this.parseUserAttributes();\r\n\r\n\t\tthis._pFinalizeAsset(<IAsset> ctr, name);\r\n\t\tthis._blocks[blockID].data = ctr;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a Container: Name = '\" + name + \"' | Parent-Name = \" + parentName);\r\n\t\t}\r\n\t}\r\n\r\n\t// Block ID = 23\r\n\tprivate parseMeshInstance(blockID:number):void\r\n\t{\r\n\t\tvar num_materials:number;\r\n\t\tvar materials_parsed:number;\r\n\t\tvar parent:DisplayObjectContainer;\r\n\t\tvar par_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar mtx:Matrix3D = this.parseMatrix3D();\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tvar data_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar geom:Geometry;\r\n\t\tvar returnedArrayGeometry:Array<any> = this.getAssetByID(data_id, [AssetType.GEOMETRY])\r\n\r\n\t\tif (returnedArrayGeometry[0]) {\r\n\t\t\tgeom = <Geometry> returnedArrayGeometry[1];\r\n\t\t} else {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find a Geometry for this Mesh. A empty Geometry is created!\");\r\n\t\t\tgeom = new Geometry();\r\n\t\t}\r\n\r\n\t\tthis._blocks[blockID].geoID = data_id;\r\n\t\tvar materials:Array<MaterialBase> = new Array<MaterialBase>();\r\n\t\tnum_materials = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\tvar materialNames:Array<string> = new Array<string>();\r\n\t\tmaterials_parsed = 0;\r\n\r\n\t\tvar returnedArrayMaterial:Array<any>;\r\n\r\n\t\twhile (materials_parsed < num_materials) {\r\n\t\t\tvar mat_id:number;\r\n\t\t\tmat_id = this._newBlockBytes.readUnsignedInt();\r\n\t\t\treturnedArrayMaterial = this.getAssetByID(mat_id, [AssetType.MATERIAL])\r\n\t\t\tif ((!returnedArrayMaterial[0]) && (mat_id > 0)) {\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find Material Nr \" + materials_parsed + \" (ID = \" + mat_id + \" ) for this Mesh\");\r\n\t\t\t}\r\n\r\n\t\t\tvar m:MaterialBase = <MaterialBase> returnedArrayMaterial[1];\r\n\r\n\t\t\tmaterials.push(m);\r\n\t\t\tmaterialNames.push(m.name);\r\n\r\n\t\t\tmaterials_parsed++;\r\n\t\t}\r\n\r\n\t\tvar mesh:Mesh = new Mesh(geom, null);\r\n\t\tmesh.transform.matrix3D = mtx;\r\n\r\n\t\tvar returnedArrayParent:Array<any> = this.getAssetByID(par_id, [AssetType.CONTAINER, AssetType.LIGHT, AssetType.MESH])\r\n\r\n\t\tif (returnedArrayParent[0]) {\r\n\t\t\tvar objC:DisplayObjectContainer = <DisplayObjectContainer> returnedArrayParent[1];\r\n\t\t\tobjC.addChild(mesh);\r\n\t\t\tparentName = objC.name;\r\n\t\t} else if (par_id > 0) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find a parent for this Mesh\");\r\n\t\t} else {\r\n\t\t\t//add to the content property\r\n\t\t\t(<DisplayObjectContainer> this._pContent).addChild(mesh);\r\n\t\t}\r\n\r\n\t\tif (materials.length >= 1 && mesh.subMeshes.length == 1) {\r\n\t\t\tmesh.material = materials[0];\r\n\t\t} else if (materials.length > 1) {\r\n\t\t\tvar i:number;\r\n\r\n\t\t\t// Assign each sub-mesh in the mesh a material from the list. If more sub-meshes\r\n\t\t\t// than materials, repeat the last material for all remaining sub-meshes.\r\n\t\t\tfor (i = 0; i < mesh.subMeshes.length; i++) {\r\n\t\t\t\tmesh.subMeshes[i].material = materials[Math.min(materials.length - 1, i)];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ((this._version[0] == 2) && (this._version[1] == 1)) {\r\n\t\t\tvar props:AWDProperties = this.parseProperties({1:this._matrixNrType, 2:this._matrixNrType, 3:this._matrixNrType, 4:AWDParser.UINT8, 5:AWDParser.BOOL});\r\n\t\t\tmesh.pivot = new Vector3D(<number>props.get(1, 0), <number>props.get(2, 0), <number> props.get(3, 0));\r\n\t\t\tmesh.castsShadows = props.get(5, true);\r\n\t\t} else {\r\n\t\t\tthis.parseProperties(null);\r\n\t\t}\r\n\r\n\t\tmesh.extra = this.parseUserAttributes();\r\n\r\n\t\tthis._pFinalizeAsset(<IAsset> mesh, name);\r\n\t\tthis._blocks[blockID].data = mesh;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a Mesh: Name = '\" + name + \"' | Parent-Name = \" + parentName + \"| Geometry-Name = \" + geom.name + \" | SubMeshes = \" + mesh.subMeshes.length + \" | Mat-Names = \" + materialNames.toString());\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t//Block ID 31\r\n\tprivate parseSkyboxInstance(blockID:number):void\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar cubeTexAddr:number = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\tvar returnedArrayCubeTex:Array<any> = this.getAssetByID(cubeTexAddr, [AssetType.TEXTURE], \"CubeTexture\");\r\n\t\tif ((!returnedArrayCubeTex[0]) && (cubeTexAddr != 0))\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find the Cubetexture (ID = \" + cubeTexAddr + \" ) for this Skybox\");\r\n\t\tvar asset:Skybox = new Skybox(<ImageCubeTexture> returnedArrayCubeTex[1]);\r\n\r\n\t\tthis.parseProperties(null)\r\n\t\tasset.extra = this.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(asset, name);\r\n\t\tthis._blocks[blockID].data = asset;\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Skybox: Name = '\" + name + \"' | CubeTexture-Name = \" + (<ImageCubeTexture> returnedArrayCubeTex[1]).name);\r\n\r\n\t}\r\n\r\n\t//Block ID = 41\r\n\tprivate parseLight(blockID:number):void\r\n\t{\r\n\t\tvar light:LightBase;\r\n\t\tvar newShadowMapper:ShadowMapperBase;\r\n\r\n\t\tvar par_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar mtx:Matrix3D = this.parseMatrix3D();\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar lightType:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar props:AWDProperties = this.parseProperties({1:this._propsNrType, 2:this._propsNrType, 3:AWDParser.COLOR, 4:this._propsNrType, 5:this._propsNrType, 6:AWDParser.BOOL, 7:AWDParser.COLOR, 8:this._propsNrType, 9:AWDParser.UINT8, 10:AWDParser.UINT8, 11:this._propsNrType, 12:AWDParser.UINT16, 21:this._matrixNrType, 22:this._matrixNrType, 23:this._matrixNrType});\r\n\t\tvar shadowMapperType:number = props.get(9, 0);\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tvar lightTypes:Array<string> = [\"Unsupported LightType\", \"PointLight\", \"DirectionalLight\"];\r\n\t\tvar shadowMapperTypes:Array<string> = [\"No ShadowMapper\", \"DirectionalShadowMapper\", \"NearDirectionalShadowMapper\", \"CascadeShadowMapper\", \"CubeMapShadowMapper\"];\r\n\r\n\t\tif (lightType == 1) {\r\n\t\t\tlight = new PointLight();\r\n\r\n\t\t\t(<PointLight> light).radius = props.get(1, 90000);\r\n\t\t\t(<PointLight> light).fallOff = props.get(2, 100000);\r\n\r\n\t\t\tif (shadowMapperType > 0) {\r\n\t\t\t\tif (shadowMapperType == 4) {\r\n\t\t\t\t\tnewShadowMapper = new CubeMapShadowMapper();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlight.transform.matrix3D = mtx;\r\n\r\n\t\t}\r\n\r\n\t\tif (lightType == 2) {\r\n\r\n\t\t\tlight = new DirectionalLight(props.get(21, 0), props.get(22, -1), props.get(23, 1));\r\n\r\n\t\t\tif (shadowMapperType > 0) {\r\n\t\t\t\tif (shadowMapperType == 1) {\r\n\t\t\t\t\tnewShadowMapper = new DirectionalShadowMapper();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//if (shadowMapperType == 2)\r\n\t\t\t\t//  newShadowMapper = new NearDirectionalShadowMapper(props.get(11, 0.5));\r\n\t\t\t\t//if (shadowMapperType == 3)\r\n\t\t\t\t//   newShadowMapper = new CascadeShadowMapper(props.get(12, 3));\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tlight.color = props.get(3, 0xffffff);\r\n\t\tlight.specular = props.get(4, 1.0);\r\n\t\tlight.diffuse = props.get(5, 1.0);\r\n\t\tlight.ambientColor = props.get(7, 0xffffff);\r\n\t\tlight.ambient = props.get(8, 0.0);\r\n\r\n\t\t// if a shadowMapper has been created, adjust the depthMapSize if needed, assign to light and set castShadows to true\r\n\t\tif (newShadowMapper) {\r\n\t\t\tif (newShadowMapper instanceof CubeMapShadowMapper) {\r\n\t\t\t\tif (props.get(10, 1) != 1) {\r\n\t\t\t\t\tnewShadowMapper.depthMapSize = this._depthSizeDic[props.get(10, 1)];\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (props.get(10, 2) != 2) {\r\n\t\t\t\t\tnewShadowMapper.depthMapSize = this._depthSizeDic[props.get(10, 2)];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlight.shadowMapper = newShadowMapper;\r\n\t\t\tlight.castsShadows = true;\r\n\t\t}\r\n\r\n\t\tif (par_id != 0) {\r\n\r\n\t\t\tvar returnedArrayParent:Array<any> = this.getAssetByID(par_id, [AssetType.CONTAINER, AssetType.LIGHT, AssetType.MESH])\r\n\r\n\t\t\tif (returnedArrayParent[0]) {\r\n\t\t\t\t(<DisplayObjectContainer> returnedArrayParent[1]).addChild(light);\r\n\t\t\t\tparentName = (<DisplayObjectContainer> returnedArrayParent[1]).name;\r\n\t\t\t} else {\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find a parent for this Light\");\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//add to the content property\r\n\t\t\t(<DisplayObjectContainer> this._pContent).addChild(light);\r\n\t\t}\r\n\r\n\t\tthis.parseUserAttributes();\r\n\r\n\t\tthis._pFinalizeAsset(< IAsset> light, name);\r\n\r\n\t\tthis._blocks[blockID].data = light;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Light: Name = '\" + name + \"' | Type = \" + lightTypes[lightType] + \" | Parent-Name = \" + parentName + \" | ShadowMapper-Type = \" + shadowMapperTypes[shadowMapperType]);\r\n\r\n\t}\r\n\r\n\t//Block ID = 43\r\n\tprivate parseCamera(blockID:number):void\r\n\t{\r\n\r\n\t\tvar par_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar mtx:Matrix3D = this.parseMatrix3D();\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tvar projection:ProjectionBase;\r\n\r\n\t\tthis._newBlockBytes.readUnsignedByte(); //set as active camera\r\n\t\tthis._newBlockBytes.readShort(); //lengthof lenses - not used yet\r\n\r\n\t\tvar projectiontype:number = this._newBlockBytes.readShort();\r\n\t\tvar props:AWDProperties = this.parseProperties({101:this._propsNrType, 102:this._propsNrType, 103:this._propsNrType, 104:this._propsNrType});\r\n\r\n\t\tswitch (projectiontype) {\r\n\t\t\tcase 5001:\r\n\t\t\t\tprojection = new PerspectiveProjection(props.get(101, 60));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5002:\r\n\t\t\t\tprojection = new OrthographicProjection(props.get(101, 500));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5003:\r\n\t\t\t\tprojection = new OrthographicOffCenterProjection(props.get(101, -400), props.get(102, 400), props.get(103, -300), props.get(104, 300));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.log(\"unsupportedLenstype\");\r\n\t\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar camera:Camera = new Camera(projection);\r\n\t\tcamera.transform.matrix3D = mtx;\r\n\r\n\t\tvar returnedArrayParent:Array<any> = this.getAssetByID(par_id, [AssetType.CONTAINER, AssetType.LIGHT, AssetType.MESH])\r\n\r\n\t\tif (returnedArrayParent[0]) {\r\n\r\n\t\t\tvar objC:DisplayObjectContainer = <DisplayObjectContainer> returnedArrayParent[1];\r\n\t\t\tobjC.addChild(camera);\r\n\r\n\t\t\tparentName = objC.name;\r\n\r\n\t\t} else if (par_id > 0) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find a parent for this Camera\");\r\n\t\t} else {\r\n\t\t\t//add to the content property\r\n\t\t\t(<DisplayObjectContainer> this._pContent).addChild(camera);\r\n\t\t}\r\n\r\n\t\tcamera.name = name;\r\n\t\tprops = this.parseProperties({1:this._matrixNrType, 2:this._matrixNrType, 3:this._matrixNrType, 4:AWDParser.UINT8});\r\n\t\tcamera.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\tcamera.extra = this.parseUserAttributes();\r\n\r\n\t\tthis._pFinalizeAsset(camera, name);\r\n\r\n\t\tthis._blocks[blockID].data = camera\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a Camera: Name = '\" + name + \"' | Projectiontype = \" + projection + \" | Parent-Name = \" + parentName);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//Block ID = 51\r\n\tprivate parseLightPicker(blockID:number):void\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar numLights:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar lightsArray:Array<LightBase> = new Array<LightBase>();\r\n\t\tvar k:number = 0;\r\n\t\tvar lightID:number = 0;\r\n\r\n\t\tvar returnedArrayLight:Array<any>;\r\n\t\tvar lightsArrayNames:Array<string> = new Array<string>();\r\n\r\n\t\tfor (k = 0; k < numLights; k++) {\r\n\t\t\tlightID = this._newBlockBytes.readUnsignedInt();\r\n\t\t\treturnedArrayLight = this.getAssetByID(lightID, [AssetType.LIGHT])\r\n\r\n\t\t\tif (returnedArrayLight[0]) {\r\n\t\t\t\tlightsArray.push(<LightBase> returnedArrayLight[1]);\r\n\t\t\t\tlightsArrayNames.push(( <LightBase> returnedArrayLight[1]).name);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find a Light Nr \" + k + \" (ID = \" + lightID + \" ) for this LightPicker\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (lightsArray.length == 0) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not create this LightPicker, cause no Light was found.\");\r\n\t\t\tthis.parseUserAttributes();\r\n\t\t\treturn; //return without any more parsing for this block\r\n\t\t}\r\n\r\n\t\tvar lightPick:LightPickerBase = new StaticLightPicker(lightsArray);\r\n\t\tlightPick.name = name;\r\n\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(<IAsset> lightPick, name);\r\n\r\n\t\tthis._blocks[blockID].data = lightPick\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a StaticLightPicker: Name = '\" + name + \"' | Texture-Name = \" + lightsArrayNames.toString());\r\n\t\t}\r\n\t}\r\n\r\n\t//Block ID = 81\r\n\tprivate parseMaterial(blockID:number):void\r\n\t{\r\n\t\t// TODO: not used\r\n\t\t////blockLength = block.len;\r\n\t\tvar name:string;\r\n\t\tvar type:number;\r\n\t\tvar props:AWDProperties;\r\n\t\tvar mat:MethodMaterial;\r\n\t\tvar attributes:Object;\r\n\t\tvar finalize:boolean;\r\n\t\tvar num_methods:number;\r\n\t\tvar methods_parsed:number;\r\n\t\tvar returnedArray:Array<any>;\r\n\r\n\t\tname = this.parseVarStr();\r\n\t\ttype = this._newBlockBytes.readUnsignedByte();\r\n\t\tnum_methods = this._newBlockBytes.readUnsignedByte();\r\n\r\n\t\t// Read material numerical properties\r\n\t\t// (1=color, 2=bitmap url, 10=alpha, 11=alpha_blending, 12=alpha_threshold, 13=repeat)\r\n\t\tprops = this.parseProperties({ 1:AWDParser.INT32, 2:AWDParser.BADDR, 10:this._propsNrType, 11:AWDParser.BOOL, 12:this._propsNrType, 13:AWDParser.BOOL});\r\n\r\n\t\tmethods_parsed = 0;\r\n\t\twhile (methods_parsed < num_methods) {\r\n\t\t\tvar method_type:number;\r\n\r\n\t\t\tmethod_type = this._newBlockBytes.readUnsignedShort();\r\n\t\t\tthis.parseProperties(null);\r\n\t\t\tthis.parseUserAttributes();\r\n\t\t\tmethods_parsed += 1;\r\n\t\t}\r\n\t\tvar debugString:string = \"\";\r\n\t\tattributes = this.parseUserAttributes();\r\n\t\tif (type === 1) { // Color material\r\n\t\t\tdebugString += \"Parsed a ColorMaterial(SinglePass): Name = '\" + name + \"' | \";\r\n\t\t\tvar color:number;\r\n\t\t\tcolor = props.get(1, 0xffffff);\r\n\t\t\tif (this.materialMode < 2) {\r\n\t\t\t\tmat = new MethodMaterial(color, props.get(10, 1.0));\r\n\t\t\t} else {\r\n\t\t\t\tmat = new MethodMaterial(color);\r\n\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t}\r\n\t\t} else if (type === 2) {\r\n\t\t\tvar tex_addr:number = props.get(2, 0);\r\n\r\n\t\t\treturnedArray = this.getAssetByID(tex_addr, [AssetType.TEXTURE]);\r\n\r\n\t\t\tif ((!returnedArray[0]) && (tex_addr > 0))\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find the DiffsueTexture (ID = \" + tex_addr + \" ) for this Material\");\r\n\r\n\t\t\tmat = new MethodMaterial(<Texture2DBase> returnedArray[1]);\r\n\r\n\t\t\tif (this.materialMode < 2) {\r\n\t\t\t\tmat.alphaBlending = props.get(11, false);\r\n\t\t\t\tmat.alpha = props.get(10, 1.0);\r\n\t\t\t\tdebugString += \"Parsed a MethodMaterial(SinglePass): Name = '\" + name + \"' | Texture-Name = \" + mat.name;\r\n\t\t\t} else {\r\n\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t\tdebugString += \"Parsed a MethodMaterial(MultiPass): Name = '\" + name + \"' | Texture-Name = \" + mat.name;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tmat.extra = attributes;\r\n\t\tmat.alphaThreshold = props.get(12, 0.0);\r\n\t\tmat.repeat = props.get(13, false);\r\n\t\tthis._pFinalizeAsset(<IAsset> mat, name);\r\n\t\tthis._blocks[blockID].data = mat;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(debugString);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t// Block ID = 81 AWD2.1\r\n\tprivate parseMaterial_v1(blockID:number):void\r\n\t{\r\n\t\tvar mat:MethodMaterial;\r\n\t\tvar normalTexture:Texture2DBase;\r\n\t\tvar specTexture:Texture2DBase;\r\n\t\tvar returnedArray:Array<any>;\r\n\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar type:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar num_methods:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar props:AWDProperties = this.parseProperties({1:AWDParser.UINT32, 2:AWDParser.BADDR, 3:AWDParser.BADDR, 4:AWDParser.UINT8, 5:AWDParser.BOOL, 6:AWDParser.BOOL, 7:AWDParser.BOOL, 8:AWDParser.BOOL, 9:AWDParser.UINT8, 10:this._propsNrType, 11:AWDParser.BOOL, 12:this._propsNrType, 13:AWDParser.BOOL, 15:this._propsNrType, 16:AWDParser.UINT32, 17:AWDParser.BADDR, 18:this._propsNrType, 19:this._propsNrType, 20:AWDParser.UINT32, 21:AWDParser.BADDR, 22:AWDParser.BADDR});\r\n\t\tvar spezialType:number = props.get(4, 0);\r\n\t\tvar debugString:string = \"\";\r\n\r\n\t\tif (spezialType >= 2) {//this is no supported material\r\n\t\t\tthis._blocks[blockID].addError(\"Material-spezialType '\" + spezialType + \"' is not supported, can only be 0:singlePass, 1:MultiPass !\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.materialMode == 1)\r\n\t\t\tspezialType = 0;\r\n\t\telse if (this.materialMode == 2)\r\n\t\t\tspezialType = 1;\r\n\r\n\t\tif (spezialType < 2) {//this is SinglePass or MultiPass\r\n\r\n\t\t\tif (type == 1) {// Color material\r\n\t\t\t\tvar color:number = props.get(1, 0xcccccc);//TODO temporarily swapped so that diffuse color goes to ambient\r\n\r\n\t\t\t\tif (spezialType == 1) {//\tMultiPassMaterial\r\n\t\t\t\t\tmat = new MethodMaterial(color);\r\n\t\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t\t\tdebugString += \"Parsed a ColorMaterial(MultiPass): Name = '\" + name + \"' | \";\r\n\r\n\t\t\t\t} else { //\tSinglePassMaterial\r\n\t\t\t\t\tmat = new MethodMaterial(color, props.get(10, 1.0));\r\n\t\t\t\t\tmat.alphaBlending = props.get(11, false);\r\n\t\t\t\t\tdebugString += \"Parsed a ColorMaterial(SinglePass): Name = '\" + name + \"' | \";\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if (type == 2) {// texture material\r\n\t\t\t\tvar tex_addr:number = props.get(2, 0);//TODO temporarily swapped so that diffuse texture goes to ambient\r\n\t\t\t\treturnedArray = this.getAssetByID(tex_addr, [AssetType.TEXTURE]);\r\n\r\n\t\t\t\tif ((!returnedArray[0]) && (tex_addr > 0))\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the AmbientTexture (ID = \" + tex_addr + \" ) for this MethodMaterial\");\r\n\r\n\t\t\t\tvar texture:Texture2DBase = returnedArray[1];\r\n\r\n\t\t\t\tmat = new MethodMaterial(texture);\r\n\r\n\t\t\t\tif (spezialType == 1) {// MultiPassMaterial\r\n\t\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t\t\tdebugString += \"Parsed a MethodMaterial(MultiPass): Name = '\" + name + \"' | Texture-Name = \" + texture.name;\r\n\t\t\t\t} else {//\tSinglePassMaterial\r\n\t\t\t\t\tmat.alpha = props.get(10, 1.0);\r\n\t\t\t\t\tmat.alphaBlending = props.get(11, false);\r\n\r\n\t\t\t\t\tdebugString += \"Parsed a MethodMaterial(SinglePass): Name = '\" + name + \"' | Texture-Name = \" + texture.name;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar diffuseTexture:Texture2DBase;\r\n\t\t\tvar diffuseTex_addr:number = props.get(17, 0);\r\n\r\n\t\t\treturnedArray = this.getAssetByID(diffuseTex_addr, [AssetType.TEXTURE]);\r\n\r\n\t\t\tif ((!returnedArray[0]) && (diffuseTex_addr != 0)) {\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find the DiffuseTexture (ID = \" + diffuseTex_addr + \" ) for this MethodMaterial\");\r\n\t\t\t}\r\n\r\n\t\t\tif (returnedArray[0])\r\n\t\t\t\tdiffuseTexture = returnedArray[1];\r\n\r\n\t\t\tif (diffuseTexture) {\r\n\t\t\t\tmat.diffuseTexture = diffuseTexture;\r\n\t\t\t\tdebugString += \" | DiffuseTexture-Name = \" + diffuseTexture.name;\r\n\t\t\t}\r\n\r\n\t\t\tvar normalTex_addr:number = props.get(3, 0);\r\n\r\n\t\t\treturnedArray = this.getAssetByID(normalTex_addr, [AssetType.TEXTURE]);\r\n\r\n\t\t\tif ((!returnedArray[0]) && (normalTex_addr != 0)) {\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find the NormalTexture (ID = \" + normalTex_addr + \" ) for this MethodMaterial\");\r\n\t\t\t}\r\n\r\n\t\t\tif (returnedArray[0]) {\r\n\t\t\t\tnormalTexture = returnedArray[1];\r\n\t\t\t\tdebugString += \" | NormalTexture-Name = \" + normalTexture.name;\r\n\t\t\t}\r\n\r\n\t\t\tvar specTex_addr:number = props.get(21, 0);\r\n\t\t\treturnedArray = this.getAssetByID(specTex_addr, [AssetType.TEXTURE]);\r\n\r\n\t\t\tif ((!returnedArray[0]) && (specTex_addr != 0)) {\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find the SpecularTexture (ID = \" + specTex_addr + \" ) for this MethodMaterial\");\r\n\t\t\t}\r\n\t\t\tif (returnedArray[0]) {\r\n\t\t\t\tspecTexture = returnedArray[1];\r\n\t\t\t\tdebugString += \" | SpecularTexture-Name = \" + specTexture.name;\r\n\t\t\t}\r\n\r\n\t\t\tvar lightPickerAddr:number = props.get(22, 0);\r\n\t\t\treturnedArray = this.getAssetByID(lightPickerAddr, [AssetType.LIGHT_PICKER])\r\n\r\n\t\t\tif ((!returnedArray[0]) && (lightPickerAddr)) {\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find the LightPicker (ID = \" + lightPickerAddr + \" ) for this MethodMaterial\");\r\n\t\t\t} else {\r\n\t\t\t\tmat.lightPicker = <LightPickerBase> returnedArray[1];\r\n\t\t\t\t//debugString+=\" | Lightpicker-Name = \"+LightPickerBase(returnedArray[1]).name;\r\n\t\t\t}\r\n\r\n\t\t\tmat.smooth = props.get(5, true);\r\n\t\t\tmat.mipmap = props.get(6, true);\r\n\t\t\tmat.bothSides = props.get(7, false);\r\n\t\t\tmat.alphaPremultiplied = props.get(8, false);\r\n\t\t\tmat.blendMode = this.blendModeDic[props.get(9, 0)];\r\n\t\t\tmat.repeat = props.get(13, false);\r\n\r\n\t\t\tif (normalTexture)\r\n\t\t\t\tmat.normalMap = normalTexture;\r\n\r\n\t\t\tif (specTexture)\r\n\t\t\t\tmat.specularMap = specTexture;\r\n\r\n\t\t\tmat.alphaThreshold = props.get(12, 0.0);\r\n\t\t\tmat.ambient = props.get(15, 1.0);\r\n\t\t\tmat.diffuseColor = props.get(16, 0xffffff);\r\n\t\t\tmat.specular = props.get(18, 1.0);\r\n\t\t\tmat.gloss = props.get(19, 50);\r\n\t\t\tmat.specularColor = props.get(20, 0xffffff);\r\n\r\n\t\t\tvar methods_parsed:number = 0;\r\n\t\t\tvar targetID:number;\r\n\r\n\t\t\twhile (methods_parsed < num_methods) {\r\n\t\t\t\tvar method_type:number;\r\n\t\t\t\tmethod_type = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\t\t\tprops = this.parseProperties({1:AWDParser.BADDR, 2:AWDParser.BADDR, 3:AWDParser.BADDR, 101:this._propsNrType, 102:this._propsNrType, 103:this._propsNrType, 201:AWDParser.UINT32, 202:AWDParser.UINT32, 301:AWDParser.UINT16, 302:AWDParser.UINT16, 401:AWDParser.UINT8, 402:AWDParser.UINT8, 601:AWDParser.COLOR, 602:AWDParser.COLOR, 701:AWDParser.BOOL, 702:AWDParser.BOOL, 801:AWDParser.MTX4x4});\r\n\r\n\t\t\t\tswitch (method_type) {\r\n\t\t\t\t\tcase 999: //wrapper-Methods that will load a previous parsed EffektMethod returned\r\n\r\n\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\treturnedArray = this.getAssetByID(targetID, [AssetType.EFFECTS_METHOD]);\r\n\r\n\t\t\t\t\t\tif (!returnedArray[0]) {\r\n\t\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the EffectMethod (ID = \" + targetID + \" ) for this Material\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tmat.addEffectMethod(returnedArray[1]);\r\n\r\n\t\t\t\t\t\t\tdebugString += \" | EffectMethod-Name = \" + (<EffectMethodBase> returnedArray[1]).name;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 998: //wrapper-Methods that will load a previous parsed ShadowMapMethod\r\n\r\n\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\treturnedArray = this.getAssetByID(targetID, [AssetType.SHADOW_MAP_METHOD]);\r\n\r\n\t\t\t\t\t\tif (!returnedArray[0]) {\r\n\t\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the ShadowMethod (ID = \" + targetID + \" ) for this Material\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tmat.shadowMethod = returnedArray[1];\r\n\t\t\t\t\t\t\tdebugString += \" | ShadowMethod-Name = \" + (<ShadowMethodBase> returnedArray[1]).name;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 1: //EnvMapAmbientMethod\r\n\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\treturnedArray = this.getAssetByID(targetID, [AssetType.TEXTURE], \"CubeTexture\");\r\n\t\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this EnvMapAmbientMethodMaterial\");\r\n\t\t\t\t\t\tmat.ambientMethod = new AmbientEnvMapMethod(returnedArray[1]);\r\n\t\t\t\t\t\tdebugString += \" | AmbientEnvMapMethod | EnvMap-Name =\" + (<CubeTextureBase> returnedArray[1]).name;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 51: //DepthDiffuseMethod\r\n\t\t\t\t\t\tmat.diffuseMethod = new DiffuseDepthMethod();\r\n\t\t\t\t\t\tdebugString += \" | DiffuseDepthMethod\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 52: //GradientDiffuseMethod\r\n\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\treturnedArray = this.getAssetByID(targetID, [AssetType.TEXTURE]);\r\n\t\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the GradientDiffuseTexture (ID = \" + targetID + \" ) for this GradientDiffuseMethod\");\r\n\t\t\t\t\t\tmat.diffuseMethod = new DiffuseGradientMethod(returnedArray[1]);\r\n\t\t\t\t\t\tdebugString += \" | DiffuseGradientMethod | GradientDiffuseTexture-Name =\" + (<Texture2DBase> returnedArray[1]).name;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 53: //WrapDiffuseMethod\r\n\t\t\t\t\t\tmat.diffuseMethod = new DiffuseWrapMethod(props.get(101, 5));\r\n\t\t\t\t\t\tdebugString += \" | DiffuseWrapMethod\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 54: //LightMapDiffuseMethod\r\n\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\treturnedArray = this.getAssetByID(targetID, [AssetType.TEXTURE]);\r\n\t\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the LightMap (ID = \" + targetID + \" ) for this LightMapDiffuseMethod\");\r\n\t\t\t\t\t\tmat.diffuseMethod = new DiffuseLightMapMethod(returnedArray[1], this.blendModeDic[props.get(401, 10)], false, mat.diffuseMethod);\r\n\t\t\t\t\t\tdebugString += \" | DiffuseLightMapMethod | LightMapTexture-Name =\" + (<Texture2DBase> returnedArray[1]).name;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 55: //CelDiffuseMethod\r\n\t\t\t\t\t\tmat.diffuseMethod = new DiffuseCelMethod(props.get(401, 3), mat.diffuseMethod);\r\n\t\t\t\t\t\t(<DiffuseCelMethod> mat.diffuseMethod).smoothness = props.get(101, 0.1);\r\n\t\t\t\t\t\tdebugString += \" | DiffuseCelMethod\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 56: //SubSurfaceScatteringMethod\r\n//\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseSubSurfaceMethod(); //depthMapSize and depthMapOffset ?\r\n//\t\t\t\t\t\t\t(<DiffuseSubSurfaceMethod> mat.diffuseMethod).scattering = props.get(101, 0.2);\r\n//\t\t\t\t\t\t\t(<DiffuseSubSurfaceMethod> mat.diffuseMethod).translucency = props.get(102, 1);\r\n//\t\t\t\t\t\t\t(<DiffuseSubSurfaceMethod> mat.diffuseMethod).scatterColor = props.get(601, 0xffffff);\r\n//\t\t\t\t\t\t\tdebugString += \" | DiffuseSubSurfaceMethod\";\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 101: //AnisotropicSpecularMethod\r\n\t\t\t\t\t\tmat.specularMethod = new SpecularAnisotropicMethod();\r\n\t\t\t\t\t\tdebugString += \" | SpecularAnisotropicMethod\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 102: //SpecularPhongMethod\r\n\t\t\t\t\t\tmat.specularMethod = new SpecularPhongMethod();\r\n\t\t\t\t\t\tdebugString += \" | SpecularPhongMethod\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 103: //CellSpecularMethod\r\n\t\t\t\t\t\tmat.specularMethod = new SpecularCelMethod(props.get(101, 0.5), mat.specularMethod);\r\n\t\t\t\t\t\t(<SpecularCelMethod> mat.specularMethod).smoothness = props.get(102, 0.1);\r\n\t\t\t\t\t\tdebugString += \" | SpecularCelMethod\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 104: //SpecularFresnelMethod\r\n\t\t\t\t\t\tmat.specularMethod = new SpecularFresnelMethod(props.get(701, true), mat.specularMethod);\r\n\t\t\t\t\t\t(<SpecularFresnelMethod> mat.specularMethod).fresnelPower = props.get(101, 5);\r\n\t\t\t\t\t\t(<SpecularFresnelMethod> mat.specularMethod).normalReflectance = props.get(102, 0.1);\r\n\t\t\t\t\t\tdebugString += \" | SpecularFresnelMethod\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 151://HeightMapNormalMethod - thios is not implemented for now, but might appear later\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 152: //SimpleWaterNormalMethod\r\n\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\treturnedArray = this.getAssetByID(targetID, [AssetType.TEXTURE]);\r\n\t\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the SecoundNormalMap (ID = \" + targetID + \" ) for this SimpleWaterNormalMethod\");\r\n\t\t\t\t\t\tif (!mat.normalMap)\r\n\t\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find a normal Map on this Material to use with this SimpleWaterNormalMethod\");\r\n\r\n\t\t\t\t\t\tmat.normalMap = returnedArray[1];\r\n\t\t\t\t\t\tmat.normalMethod = new NormalSimpleWaterMethod(mat.normalMap, returnedArray[1]);\r\n\t\t\t\t\t\tdebugString += \" | NormalSimpleWaterMethod | Second-NormalTexture-Name = \" + (<Texture2DBase> returnedArray[1]).name;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis.parseUserAttributes();\r\n\t\t\t\tmethods_parsed += 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tmat.extra = this.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(<IAsset> mat, name);\r\n\r\n\t\tthis._blocks[blockID].data = mat;\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(debugString);\r\n\t\t}\r\n\t}\r\n\r\n\t//Block ID = 82\r\n\tprivate parseTexture(blockID:number):void\r\n\t{\r\n\r\n\t\tvar asset:Texture2DBase;\r\n\r\n\t\tthis._blocks[blockID].name = this.parseVarStr();\r\n\r\n\t\tvar type:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar data_len:number;\r\n\r\n\t\tthis._texture_users[this._cur_block_id.toString()] = [];\r\n\r\n\t\t// External\r\n\t\tif (type == 0) {\r\n\t\t\tdata_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tvar url:string;\r\n\t\t\turl = this._newBlockBytes.readUTFBytes(data_len);\r\n\t\t\tthis._pAddDependency(this._cur_block_id.toString(), new URLRequest(url), false, null, true);\r\n\r\n\t\t} else {\r\n\t\t\tdata_len = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\tvar data:ByteArray;\r\n\t\t\tdata = new ByteArray();\r\n\t\t\tthis._newBlockBytes.readBytes(data, 0, data_len);\r\n\r\n\t\t\t//\r\n\t\t\t// AWDParser - Fix for FireFox Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=715075 .\r\n\t\t\t//\r\n\t\t\t// Converting data to image here instead of parser - fix FireFox bug where image width / height is 0 when created from data\r\n\t\t\t// This gives the browser time to initialise image width / height.\r\n\r\n\t\t\tthis._pAddDependency(this._cur_block_id.toString(), null, false, ParserUtils.byteArrayToImage(data), true);\r\n\t\t\t//this._pAddDependency(this._cur_block_id.toString(), null, false, data, true);\r\n\r\n\t\t}\r\n\r\n\t\t// Ignore for now\r\n\t\tthis.parseProperties(null);\r\n\t\tthis._blocks[blockID].extras = this.parseUserAttributes();\r\n\t\tthis._pPauseAndRetrieveDependencies();\r\n\t\tthis._blocks[blockID].data = asset;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tvar textureStylesNames:Array<string> = [\"external\", \"embed\"]\r\n\t\t\tconsole.log(\"Start parsing a \" + textureStylesNames[type] + \" Bitmap for Texture\");\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//Block ID = 83\r\n\tprivate parseCubeTexture(blockID:number):void\r\n\t{\r\n\t\t//blockLength = block.len;\r\n\t\tvar data_len:number;\r\n\t\tvar asset:CubeTextureBase;\r\n\t\tvar i:number;\r\n\r\n\t\tthis._cubeTextures = new Array<any>();\r\n\t\tthis._texture_users[ this._cur_block_id.toString() ] = [];\r\n\r\n\t\tvar type:number = this._newBlockBytes.readUnsignedByte();\r\n\r\n\t\tthis._blocks[blockID].name = this.parseVarStr();\r\n\r\n\t\tfor (i = 0; i < 6; i++) {\r\n\t\t\tthis._texture_users[this._cur_block_id.toString()] = [];\r\n\t\t\tthis._cubeTextures.push(null);\r\n\r\n\t\t\t// External\r\n\t\t\tif (type == 0) {\r\n\t\t\t\tdata_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\tvar url:string;\r\n\t\t\t\turl = this._newBlockBytes.readUTFBytes(data_len);\r\n\r\n\t\t\t\tthis._pAddDependency(this._cur_block_id.toString() + \"#\" + i, new URLRequest(url), false, null, true);\r\n\t\t\t} else {\r\n\r\n\t\t\t\tdata_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\tvar data:ByteArray;\r\n\t\t\t\tdata = new ByteArray();\r\n\r\n\t\t\t\tthis._newBlockBytes.readBytes(data, 0, data_len);\r\n\r\n\t\t\t\tthis._pAddDependency(this._cur_block_id.toString() + \"#\" + i, null, false, ParserUtils.byteArrayToImage(data), true);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Ignore for now\r\n\t\tthis.parseProperties(null);\r\n\t\tthis._blocks[blockID].extras = this.parseUserAttributes();\r\n\t\tthis._pPauseAndRetrieveDependencies();\r\n\t\tthis._blocks[blockID].data = asset;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tvar textureStylesNames:Array<string> = [\"external\", \"embed\"]\r\n\t\t\tconsole.log(\"Start parsing 6 \" + textureStylesNames[type] + \" Bitmaps for CubeTexture\");\r\n\t\t}\r\n\t}\r\n\r\n\t//Block ID = 91\r\n\tprivate parseSharedMethodBlock(blockID:number):void\r\n\t{\r\n\t\tvar asset:EffectMethodBase;\r\n\r\n\t\tthis._blocks[blockID].name = this.parseVarStr();\r\n\t\tasset = this.parseSharedMethodList(blockID);\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._blocks[blockID].data = asset;\r\n\t\tthis._pFinalizeAsset(<IAsset> asset, this._blocks[blockID].name);\r\n\t\tthis._blocks[blockID].data = asset;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a EffectMethod: Name = \" + asset.name + \" Type = \" + asset);\r\n\t\t}\r\n\t}\r\n\r\n\t//Block ID = 92\r\n\tprivate parseShadowMethodBlock(blockID:number):void\r\n\t{\r\n\t\tvar type:number;\r\n\t\tvar data_len:number;\r\n\t\tvar asset:ShadowMethodBase;\r\n\t\tvar shadowLightID:number;\r\n\t\tthis._blocks[blockID].name = this.parseVarStr();\r\n\r\n\t\tshadowLightID = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar returnedArray:Array<any> = this.getAssetByID(shadowLightID, [AssetType.LIGHT]);\r\n\r\n\t\tif (!returnedArray[0]) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find the TargetLight (ID = \" + shadowLightID + \" ) for this ShadowMethod - ShadowMethod not created\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tasset = this.parseShadowMethodList(<LightBase> returnedArray[1], blockID);\r\n\r\n\t\tif (!asset)\r\n\t\t\treturn;\r\n\r\n\t\tthis.parseUserAttributes(); // Ignore for now\r\n\t\tthis._pFinalizeAsset(<IAsset> asset, this._blocks[blockID].name);\r\n\t\tthis._blocks[blockID].data = asset;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a ShadowMapMethodMethod: Name = \" + asset.name + \" | Type = \" + asset + \" | Light-Name = \", ( <LightBase> returnedArray[1] ).name);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t//Block ID = 253\r\n\tprivate parseCommand(blockID:number):void\r\n\t{\r\n\t\tvar hasBlocks:boolean = ( this._newBlockBytes.readUnsignedByte() == 1 );\r\n\t\tvar par_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar mtx:Matrix3D = this.parseMatrix3D();\r\n\t\tvar name:string = this.parseVarStr();\r\n\r\n\t\tvar parentObject:DisplayObjectContainer;\r\n\t\tvar targetObject:DisplayObjectContainer;\r\n\r\n\t\tvar returnedArray:Array<any> = this.getAssetByID(par_id, [AssetType.CONTAINER, AssetType.LIGHT, AssetType.MESH]);\r\n\r\n\t\tif (returnedArray[0]) {\r\n\t\t\tparentObject = <DisplayObjectContainer> returnedArray[1];\r\n\t\t}\r\n\r\n\t\tvar numCommands:number = this._newBlockBytes.readShort();\r\n\t\tvar typeCommand:number = this._newBlockBytes.readShort();\r\n\r\n\t\tvar props:AWDProperties = this.parseProperties({1:AWDParser.BADDR});\r\n\r\n\t\tswitch (typeCommand) {\r\n\t\t\tcase 1:\r\n\r\n\t\t\t\tvar targetID:number = props.get(1, 0);\r\n\t\t\t\tvar returnedArrayTarget:Array<any> = this.getAssetByID(targetID, [AssetType.LIGHT, AssetType.TEXTURE_PROJECTOR]); //for no only light is requested!!!!\r\n\r\n\t\t\t\tif ((!returnedArrayTarget[0]) && (targetID != 0)) {\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the light (ID = \" + targetID + \" ( for this CommandBock!\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttargetObject = returnedArrayTarget[1];\r\n\r\n\t\t\t\tif (parentObject) {\r\n\t\t\t\t\tparentObject.addChild(targetObject);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttargetObject.transform.matrix3D = mtx;\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (targetObject) {\r\n\t\t\tprops = this.parseProperties({1:this._matrixNrType, 2:this._matrixNrType, 3:this._matrixNrType, 4:AWDParser.UINT8});\r\n\r\n\t\t\ttargetObject.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\t\ttargetObject.extra = this.parseUserAttributes();\r\n\r\n\t\t}\r\n\t\tthis._blocks[blockID].data = targetObject\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a CommandBlock: Name = '\" + name);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//blockID 255\r\n\tprivate parseMetaData(blockID:number):void\r\n\t{\r\n\t\tvar props:AWDProperties = this.parseProperties({1:AWDParser.UINT32, 2:AWDParser.AWDSTRING, 3:AWDParser.AWDSTRING, 4:AWDParser.AWDSTRING, 5:AWDParser.AWDSTRING});\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a MetaDataBlock: TimeStamp         = \" + props.get(1, 0));\r\n\t\t\tconsole.log(\"                        EncoderName       = \" + props.get(2, \"unknown\"));\r\n\t\t\tconsole.log(\"                        EncoderVersion    = \" + props.get(3, \"unknown\"));\r\n\t\t\tconsole.log(\"                        GeneratorName     = \" + props.get(4, \"unknown\"));\r\n\t\t\tconsole.log(\"                        GeneratorVersion  = \" + props.get(5, \"unknown\"));\r\n\t\t}\r\n\t}\r\n\r\n\t//blockID 254\r\n\tprivate parseNameSpace(blockID:number):void\r\n\t{\r\n\t\tvar id:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar nameSpaceString:string = this.parseVarStr();\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a NameSpaceBlock: ID = \" + id + \" | String = \" + nameSpaceString);\r\n\t}\r\n\r\n\t//--Parser UTILS---------------------------------------------------------------------------\r\n\r\n\t// this functions reads and creates a ShadowMethodMethod\r\n\tprivate parseShadowMethodList(light:LightBase, blockID:number):ShadowMethodBase\r\n\t{\r\n\r\n\t\tvar methodType:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar shadowMethod:ShadowMethodBase;\r\n\t\tvar props:AWDProperties = this.parseProperties({1:AWDParser.BADDR, 2:AWDParser.BADDR, 3:AWDParser.BADDR, 101:this._propsNrType, 102:this._propsNrType, 103:this._propsNrType, 201:AWDParser.UINT32, 202:AWDParser.UINT32, 301:AWDParser.UINT16, 302:AWDParser.UINT16, 401:AWDParser.UINT8, 402:AWDParser.UINT8, 601:AWDParser.COLOR, 602:AWDParser.COLOR, 701:AWDParser.BOOL, 702:AWDParser.BOOL, 801:AWDParser.MTX4x4});\r\n\r\n\t\tvar targetID:number;\r\n\t\tvar returnedArray:Array<any>\r\n\t\tswitch (methodType) {\r\n\t\t\t//\t\t\t\tcase 1001: //CascadeShadowMapMethod\r\n\t\t\t//\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t//\t\t\t\t\treturnedArray = getAssetByID(targetID, [AssetType.SHADOW_MAP_METHOD]);\r\n\t\t\t//\t\t\t\t\tif (!returnedArray[0]) {\r\n\t\t\t//\t\t\t\t\t\t_blocks[blockID].addError(\"Could not find the ShadowBaseMethod (ID = \" + targetID + \" ) for this CascadeShadowMapMethod - ShadowMethod not created\");\r\n\t\t\t//\t\t\t\t\t\treturn shadowMethod;\r\n\t\t\t//\t\t\t\t\t}\r\n\t\t\t//\t\t\t\t\tshadowMethod = new CascadeShadowMapMethod(returnedArray[1]);\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\tcase 1002: //ShadowNearMethod\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\treturnedArray = this.getAssetByID(targetID, [AssetType.SHADOW_MAP_METHOD]);\r\n\t\t\t\tif (!returnedArray[0]) {\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the ShadowBaseMethod (ID = \" + targetID + \" ) for this ShadowNearMethod - ShadowMethod not created\");\r\n\t\t\t\t\treturn shadowMethod;\r\n\t\t\t\t}\r\n\t\t\t\tshadowMethod = new ShadowNearMethod(<ShadowMethodBase> returnedArray[1]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1101: //ShadowFilteredMethod\r\n\r\n\t\t\t\tshadowMethod = new ShadowFilteredMethod(<DirectionalLight> light);\r\n\t\t\t\t(<ShadowFilteredMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowFilteredMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 1102: //ShadowDitheredMethod\r\n\r\n\r\n\t\t\t\tshadowMethod = new ShadowDitheredMethod(<DirectionalLight> light, <number> props.get(201, 5));\r\n\t\t\t\t(<ShadowDitheredMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowDitheredMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\t(<ShadowDitheredMethod> shadowMethod).range = props.get(103, 1);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1103: //ShadowSoftMethod\r\n\r\n\t\t\t\tshadowMethod = new ShadowSoftMethod(<DirectionalLight> light, <number> props.get(201, 5));\r\n\t\t\t\t(<ShadowSoftMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowSoftMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\t(<ShadowSoftMethod> shadowMethod).range = props.get(103, 1);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1104: //ShadowHardMethod\r\n\t\t\t\tshadowMethod = new ShadowHardMethod(light);\r\n\t\t\t\t(<ShadowHardMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowHardMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\t\tthis.parseUserAttributes();\r\n\t\treturn shadowMethod;\r\n\t}\r\n\r\n\t//Block ID 101\r\n\tprivate parseSkeleton(blockID:number /*uint*/):void\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar num_joints:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar skeleton:Skeleton = new Skeleton();\r\n\t\tthis.parseProperties(null); // Discard properties for now\t\t\r\n\r\n\t\tvar joints_parsed:number /*uint*/ = 0;\r\n\t\twhile (joints_parsed < num_joints) {\r\n\t\t\tvar joint:SkeletonJoint;\r\n\t\t\tvar ibp:Matrix3D;\r\n\t\t\t// Ignore joint id\r\n\t\t\tthis._newBlockBytes.readUnsignedShort();\r\n\t\t\tjoint = new SkeletonJoint();\r\n\t\t\tjoint.parentIndex = this._newBlockBytes.readUnsignedShort() - 1; // 0=null in AWD\r\n\t\t\tjoint.name = this.parseVarStr();\r\n\r\n\t\t\tibp = this.parseMatrix3D();\r\n\t\t\tjoint.inverseBindPose = ibp.rawData;\r\n\t\t\t// Ignore joint props/attributes for now\r\n\t\t\tthis.parseProperties(null);\r\n\t\t\tthis.parseUserAttributes();\r\n\t\t\tskeleton.joints.push(joint);\r\n\t\t\tjoints_parsed++;\r\n\t\t}\r\n\r\n\t\t// Discard attributes for now\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(skeleton, name);\r\n\t\tthis._blocks[blockID].data = skeleton;\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Skeleton: Name = \" + skeleton.name + \" | Number of Joints = \" + joints_parsed);\r\n\t}\r\n\r\n\t//Block ID = 102\r\n\tprivate parseSkeletonPose(blockID:number /*uint*/):void\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar num_joints:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tthis.parseProperties(null); // Ignore properties for now\r\n\r\n\t\tvar pose:SkeletonPose = new SkeletonPose();\r\n\r\n\t\tvar joints_parsed:number /*uint*/ = 0;\r\n\t\twhile (joints_parsed < num_joints) {\r\n\t\t\tvar joint_pose:JointPose;\r\n\t\t\tvar has_transform:number /*uint*/;\r\n\t\t\tjoint_pose = new JointPose();\r\n\t\t\thas_transform = this._newBlockBytes.readUnsignedByte();\r\n\t\t\tif (has_transform == 1) {\r\n\t\t\t\tvar mtx_data:Array<number> = this.parseMatrix43RawData();\r\n\r\n\t\t\t\tvar mtx:Matrix3D = new Matrix3D(mtx_data);\r\n\t\t\t\tjoint_pose.orientation.fromMatrix(mtx);\r\n\t\t\t\tjoint_pose.translation.copyFrom(mtx.position);\r\n\r\n\t\t\t\tpose.jointPoses[joints_parsed] = joint_pose;\r\n\t\t\t}\r\n\t\t\tjoints_parsed++;\r\n\t\t}\r\n\t\t// Skip attributes for now\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(pose, name);\r\n\t\tthis._blocks[blockID].data = pose;\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a SkeletonPose: Name = \" + pose.name + \" | Number of Joints = \" + joints_parsed);\r\n\t}\r\n\r\n\t//blockID 103\r\n\tprivate parseSkeletonAnimation(blockID:number /*uint*/):void\r\n\t{\r\n\t\tvar frame_dur:number;\r\n\t\tvar pose_addr:number /*uint*/;\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar clip:SkeletonClipNode = new SkeletonClipNode();\r\n\t\tvar num_frames:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tthis.parseProperties(null); // Ignore properties for now\r\n\r\n\t\tvar frames_parsed:number /*uint*/ = 0;\r\n\t\tvar returnedArray:Array<any>;\r\n\t\twhile (frames_parsed < num_frames) {\r\n\t\t\tpose_addr = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tframe_dur = this._newBlockBytes.readUnsignedShort();\r\n\t\t\treturnedArray = this.getAssetByID(pose_addr, [AssetType.SKELETON_POSE]);\r\n\t\t\tif (!returnedArray[0])\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find the SkeletonPose Frame # \" + frames_parsed + \" (ID = \" + pose_addr + \" ) for this SkeletonClipNode\");\r\n\t\t\telse\r\n\t\t\t\tclip.addFrame(<SkeletonPose> this._blocks[pose_addr].data, frame_dur);\r\n\t\t\tframes_parsed++;\r\n\t\t}\r\n\t\tif (clip.frames.length == 0) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not this SkeletonClipNode, because no Frames where set.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// Ignore attributes for now\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(clip, name);\r\n\t\tthis._blocks[blockID].data = clip;\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a SkeletonClipNode: Name = \" + clip.name + \" | Number of Frames = \" + clip.frames.length);\r\n\t}\r\n\r\n\t//Block ID = 111 /  Block ID = 112\r\n\tprivate parseMeshPoseAnimation(blockID:number /*uint*/, poseOnly:boolean = false):void\r\n\t{\r\n\t\tvar num_frames:number /*uint*/ = 1;\r\n\t\tvar num_submeshes:number /*uint*/;\r\n\t\tvar frames_parsed:number /*uint*/;\r\n\t\tvar subMeshParsed:number /*uint*/;\r\n\t\tvar frame_dur:number;\r\n\t\tvar x:number;\r\n\t\tvar y:number;\r\n\t\tvar z:number;\r\n\t\tvar str_len:number;\r\n\t\tvar str_end:number;\r\n\t\tvar geometry:Geometry;\r\n\t\tvar subGeom:TriangleSubGeometry;\r\n\t\tvar idx:number /*int*/ = 0;\r\n\t\tvar clip:VertexClipNode = new VertexClipNode();\r\n\t\tvar indices:Array<number> /*uint*/;\r\n\t\tvar verts:Array<number>;\r\n\t\tvar num_Streams:number /*int*/ = 0;\r\n\t\tvar streamsParsed:number /*int*/ = 0;\r\n\t\tvar streamtypes:Array<number> /*int*/ = new Array<number>() /*int*/;\r\n\t\tvar props:AWDProperties;\r\n\t\tvar thisGeo:Geometry;\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar geoAdress:number /*int*/ = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar returnedArray:Array<any> = this.getAssetByID(geoAdress, [AssetType.GEOMETRY]);\r\n\t\tif (!returnedArray[0]) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find the target-Geometry-Object \" + geoAdress + \" ) for this VertexClipNode\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar uvs:Array<Array<number>> = this.getUVForVertexAnimation(geoAdress);\r\n\t\tif (!poseOnly)\r\n\t\t\tnum_frames = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\tnum_submeshes = this._newBlockBytes.readUnsignedShort();\r\n\t\tnum_Streams = this._newBlockBytes.readUnsignedShort();\r\n\t\tstreamsParsed = 0;\r\n\t\twhile (streamsParsed < num_Streams) {\r\n\t\t\tstreamtypes.push(this._newBlockBytes.readUnsignedShort());\r\n\t\t\tstreamsParsed++;\r\n\t\t}\r\n\t\tprops = this.parseProperties({1:AWDParser.BOOL, 2:AWDParser.BOOL});\r\n\r\n\t\tclip.looping = props.get(1, true);\r\n\t\tclip.stitchFinalFrame = props.get(2, false);\r\n\r\n\t\tframes_parsed = 0;\r\n\t\twhile (frames_parsed < num_frames) {\r\n\t\t\tframe_dur = this._newBlockBytes.readUnsignedShort();\r\n\t\t\tgeometry = new Geometry();\r\n\t\t\tsubMeshParsed = 0;\r\n\t\t\twhile (subMeshParsed < num_submeshes) {\r\n\t\t\t\tstreamsParsed = 0;\r\n\t\t\t\tstr_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\tstr_end = this._newBlockBytes.position + str_len;\r\n\t\t\t\twhile (streamsParsed < num_Streams) {\r\n\t\t\t\t\tif (streamtypes[streamsParsed] == 1) {\r\n\t\t\t\t\t\tindices = (<Geometry> returnedArray[1]).subGeometries[subMeshParsed].indices;\r\n\t\t\t\t\t\tverts = new Array<number>();\r\n\t\t\t\t\t\tidx = 0;\r\n\t\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\t\tx = this.readNumber(this._accuracyGeo)\r\n\t\t\t\t\t\t\ty = this.readNumber(this._accuracyGeo)\r\n\t\t\t\t\t\t\tz = this.readNumber(this._accuracyGeo)\r\n\t\t\t\t\t\t\tverts[idx++] = x;\r\n\t\t\t\t\t\t\tverts[idx++] = y;\r\n\t\t\t\t\t\t\tverts[idx++] = z;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsubGeom = new TriangleSubGeometry(true);\r\n\t\t\t\t\t\tsubGeom.updateIndices(indices);\r\n\t\t\t\t\t\tsubGeom.updatePositions(verts);\r\n\t\t\t\t\t\tsubGeom.updateUVs(uvs[subMeshParsed]);\r\n\t\t\t\t\t\tsubGeom.updateVertexNormals(null);\r\n\t\t\t\t\t\tsubGeom.updateVertexTangents(null);\r\n\t\t\t\t\t\tsubGeom.autoDeriveNormals = false;\r\n\t\t\t\t\t\tsubGeom.autoDeriveTangents = false;\r\n\t\t\t\t\t\tsubMeshParsed++;\r\n\t\t\t\t\t\tgeometry.addSubGeometry(subGeom)\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tthis._newBlockBytes.position = str_end;\r\n\t\t\t\t\tstreamsParsed++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tclip.addFrame(geometry, frame_dur);\r\n\t\t\tframes_parsed++;\r\n\t\t}\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(clip, name);\r\n\r\n\t\tthis._blocks[blockID].data = clip;\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a VertexClipNode: Name = \" + clip.name + \" | Target-Geometry-Name = \" + (<Geometry> returnedArray[1]).name + \" | Number of Frames = \" + clip.frames.length);\r\n\t}\r\n\r\n\t//BlockID 113\r\n\tprivate parseVertexAnimationSet(blockID:number /*uint*/):void\r\n\t{\r\n\t\tvar poseBlockAdress:number /*int*/\r\n\t\tvar outputString:string = \"\";\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar num_frames:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar props:AWDProperties = this.parseProperties({1:AWDParser.UINT16});\r\n\t\tvar frames_parsed:number /*uint*/ = 0;\r\n\t\tvar skeletonFrames:Array<SkeletonClipNode> = new Array<SkeletonClipNode>();\r\n\t\tvar vertexFrames:Array<VertexClipNode> = new Array<VertexClipNode>();\r\n\t\twhile (frames_parsed < num_frames) {\r\n\t\t\tposeBlockAdress = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tvar returnedArray:Array<any> = this.getAssetByID(poseBlockAdress, [AssetType.ANIMATION_NODE]);\r\n\t\t\tif (!returnedArray[0])\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find the AnimationClipNode Nr \" + frames_parsed + \" ( \" + poseBlockAdress + \" ) for this AnimationSet\");\r\n\t\t\telse {\r\n\t\t\t\tif (returnedArray[1] instanceof VertexClipNode)\r\n\t\t\t\tvertexFrames.push(returnedArray[1])\r\n\t\t\t\tif (returnedArray[1] instanceof SkeletonClipNode)\r\n\t\t\t\tskeletonFrames.push(returnedArray[1])\r\n\t\t\t}\r\n\t\t\tframes_parsed++;\r\n\t\t}\r\n\t\tif ((vertexFrames.length == 0) && (skeletonFrames.length == 0)) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not create this AnimationSet, because it contains no animations\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.parseUserAttributes();\r\n\t\tif (vertexFrames.length > 0) {\r\n\t\t\tvar newVertexAnimationSet:VertexAnimationSet = new VertexAnimationSet();\r\n\t\t\tfor (var i:number /*int*/ = 0; i < vertexFrames.length; i++)\r\n\t\t\t\tnewVertexAnimationSet.addAnimation(vertexFrames[i]);\r\n\t\t\tthis._pFinalizeAsset(newVertexAnimationSet, name);\r\n\t\t\tthis._blocks[blockID].data = newVertexAnimationSet;\r\n\t\t\tif (this._debug)\r\n\t\t\t\tconsole.log(\"Parsed a VertexAnimationSet: Name = \" + name + \" | Animations = \" + newVertexAnimationSet.animations.length + \" | Animation-Names = \" + newVertexAnimationSet.animationNames.toString());\r\n\r\n\t\t} else if (skeletonFrames.length > 0) {\r\n\t\t\treturnedArray = this.getAssetByID(poseBlockAdress, [AssetType.ANIMATION_NODE]);\r\n\t\t\tvar newSkeletonAnimationSet:SkeletonAnimationSet = new SkeletonAnimationSet(props.get(1, 4)); //props.get(1,4));\r\n\t\t\tfor (var i:number /*int*/ = 0; i < skeletonFrames.length; i++)\r\n\t\t\t\tnewSkeletonAnimationSet.addAnimation(skeletonFrames[i]);\r\n\t\t\tthis._pFinalizeAsset(newSkeletonAnimationSet, name);\r\n\t\t\tthis._blocks[blockID].data = newSkeletonAnimationSet;\r\n\t\t\tif (this._debug)\r\n\t\t\t\tconsole.log(\"Parsed a SkeletonAnimationSet: Name = \" + name + \" | Animations = \" + newSkeletonAnimationSet.animations.length + \" | Animation-Names = \" + newSkeletonAnimationSet.animationNames.toString());\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t//BlockID 122\r\n\tprivate parseAnimatorSet(blockID:number /*uint*/):void\r\n\t{\r\n\t\tvar targetMesh:Mesh;\r\n\t\tvar animSetBlockAdress:number /*int*/\r\n\t\tvar targetAnimationSet:AnimationSetBase;\r\n\t\tvar outputString:string = \"\";\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar type:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\tvar props:AWDProperties = this.parseProperties({1:AWDParser.BADDR});\r\n\r\n\t\tanimSetBlockAdress = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar targetMeshLength:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar meshAdresses:Array<number> /*uint*/ = new Array<number>() /*uint*/;\r\n\t\tfor (var i:number /*int*/ = 0; i < targetMeshLength; i++)\r\n\t\t\tmeshAdresses.push(this._newBlockBytes.readUnsignedInt());\r\n\r\n\t\tvar activeState:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar autoplay:boolean = ( this._newBlockBytes.readUnsignedByte() == 1 );\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis.parseUserAttributes();\r\n\r\n\t\tvar returnedArray:Array<any>;\r\n\t\tvar targetMeshes:Array<Mesh> = new Array<Mesh>();\r\n\r\n\t\tfor (i = 0; i < meshAdresses.length; i++) {\r\n\t\t\treturnedArray = this.getAssetByID(meshAdresses[i], [AssetType.MESH]);\r\n\t\t\tif (returnedArray[0])\r\n\t\t\t\ttargetMeshes.push(<Mesh> returnedArray[1]);\r\n\t\t}\r\n\t\treturnedArray = this.getAssetByID(animSetBlockAdress, [AssetType.ANIMATION_SET]);\r\n\t\tif (!returnedArray[0]) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find the AnimationSet ( \" + animSetBlockAdress + \" ) for this Animator\");;\r\n\t\t\treturn\r\n\t\t}\r\n\t\ttargetAnimationSet = <AnimationSetBase> returnedArray[1];\r\n\t\tvar thisAnimator:AnimatorBase;\r\n\t\tif (type == 1) {\r\n\r\n\t\t\treturnedArray = this.getAssetByID(props.get(1, 0), [AssetType.SKELETON]);\r\n\t\t\tif (!returnedArray[0]) {\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find the Skeleton ( \" + props.get(1, 0) + \" ) for this Animator\");\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tthisAnimator = new SkeletonAnimator(<SkeletonAnimationSet> targetAnimationSet, <Skeleton> returnedArray[1]);\r\n\r\n\t\t} else if (type == 2)\r\n\t\t\tthisAnimator = new VertexAnimator(<VertexAnimationSet> targetAnimationSet);\r\n\r\n\t\tthis._pFinalizeAsset(thisAnimator, name);\r\n\t\tthis._blocks[blockID].data = thisAnimator;\r\n\t\tfor (i = 0; i < targetMeshes.length; i++) {\r\n\t\t\tif (type == 1)\r\n\t\t\t\ttargetMeshes[i].animator = (<SkeletonAnimator> thisAnimator);\r\n\t\t\tif (type == 2)\r\n\t\t\t\ttargetMeshes[i].animator = (<VertexAnimator> thisAnimator);\r\n\r\n\t\t}\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Animator: Name = \" + name);\r\n\t}\r\n\t\r\n\t// this functions reads and creates a EffectMethod\r\n\tprivate parseSharedMethodList(blockID:number):EffectMethodBase\r\n\t{\r\n\r\n\t\tvar methodType:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar effectMethodReturn:EffectMethodBase;\r\n\r\n\t\tvar props:AWDProperties = this.parseProperties({1:AWDParser.BADDR, 2:AWDParser.BADDR, 3:AWDParser.BADDR, 101:this._propsNrType, 102:this._propsNrType, 103:this._propsNrType, 104:this._propsNrType, 105:this._propsNrType, 106:this._propsNrType, 107:this._propsNrType, 201:AWDParser.UINT32, 202:AWDParser.UINT32, 301:AWDParser.UINT16, 302:AWDParser.UINT16, 401:AWDParser.UINT8, 402:AWDParser.UINT8, 601:AWDParser.COLOR, 602:AWDParser.COLOR, 701:AWDParser.BOOL, 702:AWDParser.BOOL});\r\n\t\tvar targetID:number;\r\n\t\tvar returnedArray:Array<any>;\r\n\r\n\t\tswitch (methodType) {\r\n\t\t\t// Effect Methods\r\n\t\t\tcase 401: //ColorMatrix\r\n\t\t\t\teffectMethodReturn = new EffectColorMatrixMethod(props.get(101, new Array(0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 402: //ColorTransform\r\n\t\t\t\teffectMethodReturn = new EffectColorTransformMethod();\r\n\t\t\t\tvar offCol:number /*uint*/ = props.get(601, 0x00000000);\r\n\t\t\t\t(<EffectColorTransformMethod> effectMethodReturn).colorTransform = new ColorTransform(props.get(102, 1), props.get(103, 1), props.get(104, 1), props.get(101, 1), ((offCol >> 16) & 0xFF), ((offCol >> 8) & 0xFF), (offCol & 0xFF), ((offCol >> 24) & 0xFF));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 403: //EnvMap\r\n\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\tconsole.log('ENV MAP', targetID);\r\n\r\n\r\n\t\t\t\treturnedArray = this.getAssetByID(targetID, [ AssetType.TEXTURE ], \"CubeTexture\");\r\n\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this EnvMapMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectEnvMapMethod(<CubeTextureBase> returnedArray[1], <number> props.get(101, 1));\r\n\t\t\t\ttargetID = props.get(2, 0);\r\n\t\t\t\tif (targetID > 0) {\r\n\t\t\t\t\treturnedArray = this.getAssetByID(targetID, [AssetType.TEXTURE]);\r\n\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the Mask-texture (ID = \" + targetID + \" ) for this EnvMapMethod\");\r\n\r\n\t\t\t\t\t// Todo: test mask with EnvMapMethod\r\n\t\t\t\t\t//(<EnvMapMethod> effectMethodReturn).mask = <Texture2DBase> returnedArray[1];\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 404: //LightMapMethod\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\treturnedArray = this.getAssetByID(targetID, [AssetType.TEXTURE]);\r\n\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the LightMap (ID = \" + targetID + \" ) for this LightMapMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectLightMapMethod(returnedArray[1], this.blendModeDic[props.get(401, 10)]); //usesecondaryUV not set\r\n\t\t\t\tbreak;\r\n\t\t\t//\t\t\t\tcase 405: //ProjectiveTextureMethod\r\n\t\t\t//\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t//\t\t\t\t\treturnedArray = getAssetByID(targetID, [AssetType.TEXTURE_PROJECTOR]);\r\n\t\t\t//\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t//\t\t\t\t\t\t_blocks[blockID].addError(\"Could not find the TextureProjector (ID = \" + targetID + \" ) for this ProjectiveTextureMethod\");\r\n\t\t\t//\t\t\t\t\teffectMethodReturn = new ProjectiveTextureMethod(returnedArray[1], blendModeDic[props.get(401, 10)]);\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\tcase 406: //RimLightMethod\r\n\t\t\t\teffectMethodReturn = new EffectRimLightMethod(props.get(601, 0xffffff), props.get(101, 0.4), props.get(101, 2)); //blendMode\r\n\t\t\t\tbreak;\r\n\t\t\tcase 407: //AlphaMaskMethod\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\treturnedArray = this.getAssetByID(targetID, [AssetType.TEXTURE]);\r\n\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the Alpha-texture (ID = \" + targetID + \" ) for this AlphaMaskMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectAlphaMaskMethod(returnedArray[1], props.get(701, false));\r\n\t\t\t\tbreak;\r\n\t\t\t//\t\t\t\tcase 408: //RefractionEnvMapMethod\r\n\t\t\t//\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t//\t\t\t\t\treturnedArray = getAssetByID(targetID, [AssetType.TEXTURE], \"CubeTexture\");\r\n\t\t\t//\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t//\t\t\t\t\t\t_blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this RefractionEnvMapMethod\");\r\n\t\t\t//\t\t\t\t\teffectMethodReturn = new RefractionEnvMapMethod(returnedArray[1], props.get(101, 0.1), props.get(102, 0.01), props.get(103, 0.01), props.get(104, 0.01));\r\n\t\t\t//\t\t\t\t\tRefractionEnvMapMethod(effectMethodReturn).alpha = props.get(104, 1);\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\t//\t\t\t\tcase 409: //OutlineMethod\r\n\t\t\t//\t\t\t\t\teffectMethodReturn = new OutlineMethod(props.get(601, 0x00000000), props.get(101, 1), props.get(701, true), props.get(702, false));\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\tcase 410: //FresnelEnvMapMethod\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\treturnedArray = this.getAssetByID(targetID, [AssetType.TEXTURE], \"CubeTexture\");\r\n\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this FresnelEnvMapMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectFresnelEnvMapMethod(returnedArray[1], props.get(101, 1));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 411: //FogMethod\r\n\t\t\t\teffectMethodReturn = new EffectFogMethod(props.get(101, 0), props.get(102, 1000), props.get(601, 0x808080));\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\t\tthis.parseUserAttributes();\r\n\t\treturn effectMethodReturn;\r\n\r\n\t}\r\n\r\n\tprivate parseUserAttributes():Object\r\n\t{\r\n\t\tvar attributes:Object;\r\n\t\tvar list_len:number;\r\n\t\tvar attibuteCnt:number;\r\n\r\n\t\tlist_len = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\tif (list_len > 0) {\r\n\r\n\t\t\tvar list_end:number;\r\n\r\n\t\t\tattributes = {};\r\n\r\n\t\t\tlist_end = this._newBlockBytes.position + list_len;\r\n\r\n\t\t\twhile (this._newBlockBytes.position < list_end) {\r\n\t\t\t\tvar ns_id:number;\r\n\t\t\t\tvar attr_key:string;\r\n\t\t\t\tvar attr_type:number;\r\n\t\t\t\tvar attr_len:number;\r\n\t\t\t\tvar attr_val:any;\r\n\r\n\t\t\t\t// TODO: Properly tend to namespaces in attributes\r\n\t\t\t\tns_id = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tattr_key = this.parseVarStr();\r\n\t\t\t\tattr_type = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tattr_len = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\t\tif ((this._newBlockBytes.position + attr_len) > list_end) {\r\n\t\t\t\t\tconsole.log(\"           Error in reading attribute # \" + attibuteCnt + \" = skipped to end of attribute-list\");\r\n\t\t\t\t\tthis._newBlockBytes.position = list_end;\r\n\t\t\t\t\treturn attributes;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch (attr_type) {\r\n\t\t\t\t\tcase AWDParser.AWDSTRING:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUTFBytes(attr_len);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.INT8:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readByte();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.INT16:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readShort();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.INT32:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readInt();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.BOOL:\r\n\t\t\t\t\tcase AWDParser.UINT8:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.UINT16:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.UINT32:\r\n\t\t\t\t\tcase AWDParser.BADDR:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.FLOAT32:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readFloat();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.FLOAT64:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readDouble();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tattr_val = 'unimplemented attribute type ' + attr_type;\r\n\t\t\t\t\t\tthis._newBlockBytes.position += attr_len;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._debug) {\r\n\t\t\t\t\tconsole.log(\"attribute = name: \" + attr_key + \"  / value = \" + attr_val);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tattributes[attr_key] = attr_val;\r\n\t\t\t\tattibuteCnt += 1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn attributes;\r\n\t}\r\n\r\n\tprivate parseProperties(expected:Object):AWDProperties\r\n\t{\r\n\t\tvar list_end:number;\r\n\t\tvar list_len:number;\r\n\t\tvar propertyCnt:number = 0;\r\n\t\tvar props:AWDProperties = new AWDProperties();\r\n\r\n\t\tlist_len = this._newBlockBytes.readUnsignedInt();\r\n\t\tlist_end = this._newBlockBytes.position + list_len;\r\n\r\n\t\tif (expected) {\r\n\r\n\t\t\twhile (this._newBlockBytes.position < list_end) {\r\n\t\t\t\tvar len:number;\r\n\t\t\t\tvar key:number;\r\n\t\t\t\tvar type:number;\r\n\r\n\t\t\t\tkey = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\tlen = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\t\tif ((this._newBlockBytes.position + len) > list_end) {\r\n\t\t\t\t\tconsole.log(\"           Error in reading property # \" + propertyCnt + \" = skipped to end of propertie-list\");\r\n\t\t\t\t\tthis._newBlockBytes.position = list_end;\r\n\t\t\t\t\treturn props;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (expected.hasOwnProperty(key.toString())) {\r\n\t\t\t\t\ttype = expected[key];\r\n\t\t\t\t\tprops.set(key, this.parseAttrValue(type, len));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._newBlockBytes.position += len;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpropertyCnt += 1;\r\n\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._newBlockBytes.position = list_end;\r\n\t\t}\r\n\r\n\t\treturn props;\r\n\r\n\t}\r\n\r\n\tprivate parseAttrValue(type:number, len:number):any\r\n\t{\r\n\t\tvar elem_len:number;\r\n\t\tvar read_func:Function;\r\n\r\n\t\tswitch (type) {\r\n\r\n\t\t\tcase AWDParser.BOOL:\r\n\t\t\tcase AWDParser.INT8:\r\n\t\t\t\telem_len = 1;\r\n\t\t\t\tread_func = this._newBlockBytes.readByte;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.INT16:\r\n\t\t\t\telem_len = 2;\r\n\t\t\t\tread_func = this._newBlockBytes.readShort;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.INT32:\r\n\t\t\t\telem_len = 4;\r\n\t\t\t\tread_func = this._newBlockBytes.readInt;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.UINT8:\r\n\t\t\t\telem_len = 1;\r\n\t\t\t\tread_func = this._newBlockBytes.readUnsignedByte;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.UINT16:\r\n\t\t\t\telem_len = 2;\r\n\t\t\t\tread_func = this._newBlockBytes.readUnsignedShort;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.UINT32:\r\n\t\t\tcase AWDParser.COLOR:\r\n\t\t\tcase AWDParser.BADDR:\r\n\t\t\t\telem_len = 4;\r\n\t\t\t\tread_func = this._newBlockBytes.readUnsignedInt;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.FLOAT32:\r\n\t\t\t\telem_len = 4;\r\n\t\t\t\tread_func = this._newBlockBytes.readFloat;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.FLOAT64:\r\n\t\t\t\telem_len = 8;\r\n\t\t\t\tread_func = this._newBlockBytes.readDouble;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.AWDSTRING:\r\n\t\t\t\treturn this._newBlockBytes.readUTFBytes(len);\r\n\r\n\t\t\tcase AWDParser.VECTOR2x1:\r\n\t\t\tcase AWDParser.VECTOR3x1:\r\n\t\t\tcase AWDParser.VECTOR4x1:\r\n\t\t\tcase AWDParser.MTX3x2:\r\n\t\t\tcase AWDParser.MTX3x3:\r\n\t\t\tcase AWDParser.MTX4x3:\r\n\t\t\tcase AWDParser.MTX4x4:\r\n\t\t\t\telem_len = 8;\r\n\t\t\t\tread_func = this._newBlockBytes.readDouble;\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tif (elem_len < len) {\r\n\t\t\tvar list:Array<any> = [];\r\n\t\t\tvar num_read:number = 0;\r\n\t\t\tvar num_elems:number = len/elem_len;\r\n\r\n\t\t\twhile (num_read < num_elems) {\r\n\t\t\t\tlist.push(read_func.apply(this._newBlockBytes)); // list.push(read_func());\r\n\t\t\t\tnum_read++;\r\n\t\t\t}\r\n\r\n\t\t\treturn list;\r\n\t\t} else {\r\n\r\n\t\t\tvar val:any = read_func.apply(this._newBlockBytes);//read_func();\r\n\t\t\treturn val;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate parseHeader():void\r\n\t{\r\n\t\tvar flags:number;\r\n\t\tvar body_len:number;\r\n\r\n\t\tthis._byteData.position = 3; // Skip magic string and parse version\r\n\r\n\t\tthis._version[0] = this._byteData.readUnsignedByte();\r\n\t\tthis._version[1] = this._byteData.readUnsignedByte();\r\n\r\n\t\tflags = this._byteData.readUnsignedShort(); // Parse bit flags\r\n\r\n\t\tthis._streaming = BitFlags.test(flags, BitFlags.FLAG1);\r\n\r\n\t\tif ((this._version[0] == 2) && (this._version[1] == 1)) {\r\n\t\t\tthis._accuracyMatrix = BitFlags.test(flags, BitFlags.FLAG2);\r\n\t\t\tthis._accuracyGeo = BitFlags.test(flags, BitFlags.FLAG3);\r\n\t\t\tthis._accuracyProps = BitFlags.test(flags, BitFlags.FLAG4);\r\n\t\t}\r\n\r\n\t\t// if we set _accuracyOnBlocks, the precision-values are read from each block-header.\r\n\r\n\t\t// set storagePrecision types\r\n\t\tthis._geoNrType = AWDParser.FLOAT32;\r\n\r\n\t\tif (this._accuracyGeo) {\r\n\t\t\tthis._geoNrType = AWDParser.FLOAT64;\r\n\t\t}\r\n\r\n\t\tthis._matrixNrType = AWDParser.FLOAT32;\r\n\r\n\t\tif (this._accuracyMatrix) {\r\n\t\t\tthis._matrixNrType = AWDParser.FLOAT64;\r\n\t\t}\r\n\r\n\t\tthis._propsNrType = AWDParser.FLOAT32;\r\n\r\n\t\tif (this._accuracyProps) {\r\n\t\t\tthis._propsNrType = AWDParser.FLOAT64;\r\n\t\t}\r\n\r\n\t\tthis._compression = this._byteData.readUnsignedByte(); // compression\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Import AWDFile of version = \" + this._version[0] + \" - \" + this._version[1]);\r\n\t\t\tconsole.log(\"Global Settings = Compression = \" + this._compression + \" | Streaming = \" + this._streaming + \" | Matrix-Precision = \" + this._accuracyMatrix + \" | Geometry-Precision = \" + this._accuracyGeo + \" | Properties-Precision = \" + this._accuracyProps);\r\n\t\t}\r\n\r\n\t\t// Check file integrity\r\n\t\tbody_len = this._byteData.readUnsignedInt();\r\n\t\tif (!this._streaming && body_len != this._byteData.getBytesAvailable()) {\r\n\t\t\tthis._pDieWithError('AWD2 body length does not match header integrity field');\r\n\t\t}\r\n\r\n\t}\r\n\t// Helper - functions\r\n\tprivate getUVForVertexAnimation(meshID:number /*uint*/):Array<Array<number>>\r\n\t{\r\n\t\tif (this._blocks[meshID].data instanceof Mesh)\r\n\t\tmeshID = this._blocks[meshID].geoID;\r\n\t\tif (this._blocks[meshID].uvsForVertexAnimation)\r\n\t\t\treturn this._blocks[meshID].uvsForVertexAnimation;\r\n\t\tvar geometry:Geometry = (<Geometry> this._blocks[meshID].data);\r\n\t\tvar geoCnt:number /*int*/ = 0;\r\n\t\tvar ud:Array<number>;\r\n\t\tvar uStride:number /*uint*/;\r\n\t\tvar uOffs:number /*uint*/;\r\n\t\tvar numPoints:number /*uint*/;\r\n\t\tvar i:number /*int*/;\r\n\t\tvar newUvs:Array<number>;\r\n\t\tvar sub_geom:TriangleSubGeometry;\r\n\t\tthis._blocks[meshID].uvsForVertexAnimation = new Array<Array<number>>();\r\n\t\twhile (geoCnt < geometry.subGeometries.length) {\r\n\t\t\tnewUvs = new Array<number>();\r\n\t\t\tsub_geom = <TriangleSubGeometry> geometry.subGeometries[geoCnt];\r\n\t\t\tnumPoints = sub_geom.numVertices;\r\n\t\t\tud = sub_geom.uvs;\r\n\t\t\tuStride = sub_geom.getStride(TriangleSubGeometry.UV_DATA);\r\n\t\t\tuOffs = sub_geom.getOffset(TriangleSubGeometry.UV_DATA);\r\n\t\t\tfor (i = 0; i < numPoints; i++) {\r\n\t\t\t\tnewUvs.push(ud[uOffs + i*uStride + 0]);\r\n\t\t\t\tnewUvs.push(ud[uOffs + i*uStride + 1]);\r\n\t\t\t}\r\n\t\t\tthis._blocks[meshID].uvsForVertexAnimation.push(newUvs);\r\n\t\t\tgeoCnt++;\r\n\t\t}\r\n\t\treturn this._blocks[meshID].uvsForVertexAnimation;\r\n\t}\r\n\t\r\n\tprivate parseVarStr():string\r\n\t{\r\n\r\n\t\tvar len:number = this._newBlockBytes.readUnsignedShort();\r\n\t\treturn this._newBlockBytes.readUTFBytes(len);\r\n\t}\r\n\r\n\tprivate getAssetByID(assetID:number, assetTypesToGet:Array<string>, extraTypeInfo:string = \"SingleTexture\"):Array<any>\r\n\t{\r\n\t\tvar returnArray:Array<any> = new Array<any>();\r\n\t\tvar typeCnt:number = 0;\r\n\t\tif (assetID > 0) {\r\n\t\t\tif (this._blocks[assetID]) {\r\n\t\t\t\tif (this._blocks[assetID].data) {\r\n\t\t\t\t\twhile (typeCnt < assetTypesToGet.length) {\r\n\r\n\t\t\t\t\t\tvar iasset:IAsset = <IAsset> this._blocks[assetID].data;\r\n\r\n\t\t\t\t\t\tif (iasset.assetType == assetTypesToGet[typeCnt]) {\r\n\t\t\t\t\t\t\t//if the right assetType was found\r\n\t\t\t\t\t\t\tif ((assetTypesToGet[typeCnt] == AssetType.TEXTURE) && (extraTypeInfo == \"CubeTexture\")) {\r\n\t\t\t\t\t\t\t\tif (this._blocks[assetID].data instanceof ImageCubeTexture) {\r\n\t\t\t\t\t\t\t\t\treturnArray.push(true);\r\n\t\t\t\t\t\t\t\t\treturnArray.push(this._blocks[assetID].data);\r\n\t\t\t\t\t\t\t\t\treturn returnArray;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif ((assetTypesToGet[typeCnt] == AssetType.TEXTURE) && (extraTypeInfo == \"SingleTexture\")) {\r\n\t\t\t\t\t\t\t\tif (this._blocks[assetID].data instanceof ImageTexture) {\r\n\t\t\t\t\t\t\t\t\treturnArray.push(true);\r\n\t\t\t\t\t\t\t\t\treturnArray.push(this._blocks[assetID].data);\r\n\t\t\t\t\t\t\t\t\treturn returnArray;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\treturnArray.push(true);\r\n\t\t\t\t\t\t\t\treturnArray.push(this._blocks[assetID].data);\r\n\t\t\t\t\t\t\t\treturn returnArray;\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//if ((assetTypesToGet[typeCnt] == AssetType.GEOMETRY) && (IAsset(_blocks[assetID].data).assetType == AssetType.MESH)) {\r\n\t\t\t\t\t\tif ((assetTypesToGet[typeCnt] == AssetType.GEOMETRY) && (iasset.assetType == AssetType.MESH)) {\r\n\r\n\t\t\t\t\t\t\tvar mesh:Mesh = <Mesh> this._blocks[assetID].data\r\n\r\n\t\t\t\t\t\t\treturnArray.push(true);\r\n\t\t\t\t\t\t\treturnArray.push(mesh.geometry);\r\n\t\t\t\t\t\t\treturn returnArray;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttypeCnt++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// if the has not returned anything yet, the asset is not found, or the found asset is not the right type.\r\n\t\treturnArray.push(false);\r\n\t\treturnArray.push(this.getDefaultAsset(assetTypesToGet[0], extraTypeInfo));\r\n\t\treturn returnArray;\r\n\t}\r\n\r\n\tprivate getDefaultAsset(assetType:string, extraTypeInfo:string):IAsset\r\n\t{\r\n\t\tswitch (true) {\r\n\t\t\tcase (assetType == AssetType.TEXTURE):\r\n\t\t\t\tif (extraTypeInfo == \"CubeTexture\")\r\n\t\t\t\t\treturn this.getDefaultCubeTexture();\r\n\t\t\t\tif (extraTypeInfo == \"SingleTexture\")\r\n\t\t\t\t\treturn this.getDefaultTexture();\r\n\t\t\t\tbreak;\r\n\t\t\tcase (assetType == AssetType.MATERIAL):\r\n\t\t\t\treturn this.getDefaultMaterial()\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprivate getDefaultMaterial():IAsset\r\n\t{\r\n\t\tif (!this._defaultBitmapMaterial)\r\n\t\t\tthis._defaultBitmapMaterial = <MethodMaterial> DefaultMaterialManager.getDefaultMaterial();\r\n\r\n\t\treturn  <IAsset>  this._defaultBitmapMaterial;\r\n\t}\r\n\r\n\tprivate getDefaultTexture():IAsset\r\n\t{\r\n\t\tif (!this._defaultTexture)\r\n\t\t\tthis._defaultTexture = DefaultMaterialManager.getDefaultTexture();\r\n\r\n\t\treturn <IAsset> this._defaultTexture;\r\n\r\n\t}\r\n\r\n\tprivate getDefaultCubeTexture():IAsset\r\n\t{\r\n\t\tif (!this._defaultCubeTexture) {\r\n\t\t\tvar defaultBitmap:BitmapData = DefaultMaterialManager.createCheckeredBitmapData();\r\n\r\n\t\t\tthis._defaultCubeTexture = new BitmapCubeTexture(defaultBitmap, defaultBitmap, defaultBitmap, defaultBitmap, defaultBitmap, defaultBitmap);\r\n\t\t\tthis._defaultCubeTexture.name = \"defaultCubeTexture\";\r\n\t\t}\r\n\r\n\t\treturn <IAsset> this._defaultCubeTexture;\r\n\t}\r\n\r\n\tprivate readNumber(precision:boolean = false):number\r\n\t{\r\n\t\tif (precision)\r\n\t\t\treturn this._newBlockBytes.readDouble();\r\n\t\treturn this._newBlockBytes.readFloat();\r\n\r\n\t}\r\n\r\n\tprivate parseMatrix3D():Matrix3D\r\n\t{\r\n\t\treturn new Matrix3D(this.parseMatrix43RawData());\r\n\t}\r\n\r\n\tprivate parseMatrix32RawData():Array<number>\r\n\t{\r\n\t\tvar i:number;\r\n\t\tvar mtx_raw:Array<number> = new Array<number>(6);\r\n\t\tfor (i = 0; i < 6; i++) {\r\n\t\t\tmtx_raw[i] = this._newBlockBytes.readFloat();\r\n\t\t}\r\n\r\n\t\treturn mtx_raw;\r\n\t}\r\n\r\n\tprivate parseMatrix43RawData():Array<number>\r\n\t{\r\n\t\tvar mtx_raw:Array<number> = new Array<number>(16);\r\n\r\n\t\tmtx_raw[0] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[1] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[2] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[3] = 0.0;\r\n\t\tmtx_raw[4] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[5] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[6] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[7] = 0.0;\r\n\t\tmtx_raw[8] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[9] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[10] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[11] = 0.0;\r\n\t\tmtx_raw[12] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[13] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[14] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[15] = 1.0;\r\n\r\n\t\t//TODO: fix max exporter to remove NaN values in joint 0 inverse bind pose\r\n\r\n\t\tif (isNaN(mtx_raw[0])) {\r\n\t\t\tmtx_raw[0] = 1;\r\n\t\t\tmtx_raw[1] = 0;\r\n\t\t\tmtx_raw[2] = 0;\r\n\t\t\tmtx_raw[4] = 0;\r\n\t\t\tmtx_raw[5] = 1;\r\n\t\t\tmtx_raw[6] = 0;\r\n\t\t\tmtx_raw[8] = 0;\r\n\t\t\tmtx_raw[9] = 0;\r\n\t\t\tmtx_raw[10] = 1;\r\n\t\t\tmtx_raw[12] = 0;\r\n\t\t\tmtx_raw[13] = 0;\r\n\t\t\tmtx_raw[14] = 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn mtx_raw;\r\n\t}\r\n\r\n}\r\n\r\nexport = AWDParser;\r\n\r\nclass AWDBlock\r\n{\r\n\tpublic id:number;\r\n\tpublic name:string;\r\n\tpublic data:any;\r\n\tpublic len:any;\r\n\tpublic geoID:number;\r\n\tpublic extras:Object;\r\n\tpublic bytes:ByteArray;\r\n\tpublic errorMessages:Array<string>;\r\n\tpublic uvsForVertexAnimation:Array<Array<number>>;\r\n\r\n\tconstructor()\r\n\t{\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\r\n\t\tthis.id = null;\r\n\t\tthis.bytes = null;\r\n\t\tthis.errorMessages = null;\r\n\t\tthis.uvsForVertexAnimation = null;\r\n\r\n\t}\r\n\r\n\tpublic addError(errorMsg:string):void\r\n\t{\r\n\t\tif (!this.errorMessages)\r\n\t\t\tthis.errorMessages = new Array<string>();\r\n\r\n\t\tthis.errorMessages.push(errorMsg);\r\n\t}\r\n}\r\n\r\nclass AWDProperties\r\n{\r\n\tpublic set(key:number, value:any):void\r\n\t{\r\n\t\tthis[ key.toString() ] = value;\r\n\t}\r\n\r\n\tpublic get(key:number, fallback:any):any\r\n\t{\r\n\t\tif (this.hasOwnProperty(key.toString())) {\r\n\t\t\treturn this[key.toString()];\r\n\t\t} else {\r\n\t\t\treturn fallback;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass BitFlags\r\n{\r\n\tpublic static FLAG1:number = 1;\r\n\tpublic static FLAG2:number = 2;\r\n\tpublic static FLAG3:number = 4;\r\n\tpublic static FLAG4:number = 8;\r\n\tpublic static FLAG5:number = 16;\r\n\tpublic static FLAG6:number = 32;\r\n\tpublic static FLAG7:number = 64;\r\n\tpublic static FLAG8:number = 128;\r\n\tpublic static FLAG9:number = 256;\r\n\tpublic static FLAG10:number = 512;\r\n\tpublic static FLAG11:number = 1024;\r\n\tpublic static FLAG12:number = 2048;\r\n\tpublic static FLAG13:number = 4096;\r\n\tpublic static FLAG14:number = 8192;\r\n\tpublic static FLAG15:number = 16384;\r\n\tpublic static FLAG16:number = 32768;\r\n\r\n\tpublic static test(flags:number, testFlag:number):boolean\r\n\t{\r\n\t\treturn (flags & testFlag) == testFlag;\r\n\t}\r\n}\r\n","import BitmapData\t\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\nimport VertexClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/VertexClipNode\");\r\nimport VertexAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimationSet\");\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-renderergl/lib/managers/DefaultMaterialManager\");\r\n\r\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\r\n\r\n/**\r\n * MD2Parser provides a parser for the MD2 data type.\r\n */\r\nclass MD2Parser extends ParserBase\r\n{\r\n\tpublic static FPS:number /*int*/ = 6;\r\n\r\n\tprivate _clipNodes:Object = new Object();\r\n\tprivate _byteData:ByteArray;\r\n\tprivate _startedParsing:boolean;\r\n\tprivate _parsedHeader:boolean;\r\n\tprivate _parsedUV:boolean;\r\n\tprivate _parsedFaces:boolean;\r\n\tprivate _parsedFrames:boolean;\r\n\r\n\tprivate _ident:number /*uint*/;\r\n\tprivate _version:number /*uint*/;\r\n\tprivate _skinWidth:number /*uint*/;\r\n\tprivate _skinHeight:number /*uint*/;\r\n\t//private _frameSize : number /*uint*/;\r\n\tprivate _numSkins:number /*uint*/;\r\n\tprivate _numVertices:number /*uint*/;\r\n\tprivate _numST:number /*uint*/;\r\n\tprivate _numTris:number /*uint*/;\r\n\t//private _numGlCmds : number /*uint*/;\r\n\tprivate _numFrames:number /*uint*/;\r\n\tprivate _offsetSkins:number /*uint*/;\r\n\tprivate _offsetST:number /*uint*/;\r\n\tprivate _offsetTris:number /*uint*/;\r\n\tprivate _offsetFrames:number /*uint*/;\r\n\t//private _offsetGlCmds : number /*uint*/;\r\n\tprivate _offsetEnd:number /*uint*/;\r\n\r\n\tprivate _uvIndices:Array<number>;\r\n\tprivate _indices:Array<number> /*uint*/;\r\n\tprivate _vertIndices:Array<number>;\r\n\r\n\t// the current subgeom being built\r\n\tprivate _animationSet:VertexAnimationSet = new VertexAnimationSet();\r\n\tprivate _firstSubGeom:TriangleSubGeometry;\r\n\tprivate _uvs:Array<number>;\r\n\tprivate _finalUV:Array<number>;\r\n\r\n\tprivate _materialNames:Array<string>;\r\n\tprivate _textureType:string;\r\n\tprivate _ignoreTexturePath:boolean;\r\n\tprivate _mesh:Mesh;\r\n\tprivate _geometry:Geometry;\r\n\r\n\tprivate materialFinal:boolean = false;\r\n\tprivate geoCreated:boolean = false;\r\n\r\n\t/**\r\n\t * Creates a new MD2Parser object.\r\n\t * @param textureType The extension of the texture (e.g. jpg/png/...)\r\n\t * @param ignoreTexturePath If true, the path of the texture is ignored\r\n\t */\r\n\tconstructor(textureType:string = \"jpg\", ignoreTexturePath:boolean = true)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.ARRAY_BUFFER);\r\n\t\tthis._textureType = textureType;\r\n\t\tthis._ignoreTexturePath = ignoreTexturePath;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"md2\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\treturn (ParserUtils.toString(data, 4) == 'IDP2');\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\tif (resourceDependency.assets.length != 1)\r\n\t\t\treturn;\r\n\r\n\t\tvar asset:Texture2DBase = <Texture2DBase> resourceDependency.assets[0];\r\n\r\n\t\tif (asset) {\r\n\t\t\tvar material:MethodMaterial = new MethodMaterial(asset);\r\n\r\n\t\t\tif (this.materialMode >= 2)\r\n\t\t\t\tmaterial.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t//add to the content property\r\n\t\t\t(<DisplayObjectContainer> this._pContent).addChild(this._mesh);\r\n\r\n\t\t\tmaterial.name = this._mesh.material.name;\r\n\t\t\tthis._mesh.material = material;\r\n\t\t\tthis._pFinalizeAsset(material);\r\n\t\t\tthis._pFinalizeAsset(this._mesh.geometry);\r\n\t\t\tthis._pFinalizeAsset(this._mesh);\r\n\t\t}\r\n\t\tthis.materialFinal = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\t// apply system default\r\n\t\tif (this.materialMode < 2) {\r\n\t\t\tthis._mesh.material = DefaultMaterialManager.getDefaultMaterial();\r\n\t\t} else {\r\n\t\t\tthis._mesh.material = new MethodMaterial(DefaultMaterialManager.getDefaultTexture());\r\n\t\t\t(<MethodMaterial> this._mesh.material).mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t}\r\n\r\n\t\t//add to the content property\r\n\t\t(<DisplayObjectContainer> this._pContent).addChild(this._mesh);\r\n\r\n\t\tthis._pFinalizeAsset(this._mesh.geometry);\r\n\t\tthis._pFinalizeAsset(this._mesh);\r\n\t\tthis.materialFinal = true;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._byteData = this._pGetByteData();\r\n\t\t\tthis._startedParsing = true;\r\n\r\n\t\t\t// Reset bytearray read position (which may have been\r\n\t\t\t// moved forward by the supportsData() function.)\r\n\t\t\tthis._byteData.position = 0;\r\n\t\t}\r\n\r\n\t\twhile (this._pHasTime()) {\r\n\t\t\tif (!this._parsedHeader) {\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t\t//this._byteData.endian = Endian.LITTLE_ENDIAN;\r\n\r\n\t\t\t\t// TODO: Create a mesh only when encountered (if it makes sense\r\n\t\t\t\t// for this file format) and return it using this._pFinalizeAsset()\r\n\t\t\t\tthis._geometry = new Geometry();\r\n\t\t\t\tthis._mesh = new Mesh(this._geometry, null);\r\n\t\t\t\tif (this.materialMode < 2) {\r\n\t\t\t\t\tthis._mesh.material = DefaultMaterialManager.getDefaultMaterial();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._mesh.material = new MethodMaterial(DefaultMaterialManager.getDefaultTexture());\r\n\t\t\t\t\t(<MethodMaterial> this._mesh.material).mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//_geometry.animation = new VertexAnimation(2, VertexAnimationMode.ABSOLUTE);\r\n\t\t\t\t//_animator = new VertexAnimator(VertexAnimationState(_mesh.animationState));\r\n\r\n\t\t\t\t// Parse header and decompress body\r\n\t\t\t\tthis.parseHeader();\r\n\t\t\t\tthis.parseMaterialNames();\r\n\t\t\t} else if (!this._parsedUV) {\r\n\t\t\t\tthis.parseUV();\r\n\t\t\t} else if (!this._parsedFaces) {\r\n\t\t\t\tthis.parseFaces();\r\n\t\t\t} else if (!this._parsedFrames) {\r\n\t\t\t\tthis.parseFrames();\r\n\t\t\t} else if ((this.geoCreated) && (this.materialFinal)) {\r\n\t\t\t\treturn ParserBase.PARSING_DONE;\r\n\t\t\t} else if (!this.geoCreated) {\r\n\t\t\t\tthis.geoCreated = true;\r\n\t\t\t\t//create default subgeometry\r\n\t\t\t\tthis._geometry.addSubGeometry(this._firstSubGeom.clone());\r\n\t\t\t\t// Force name to be chosen by this._pFinalizeAsset()\r\n\t\t\t\tthis._mesh.name = \"\";\r\n\t\t\t\tif (this.materialFinal) {\r\n\t\t\t\t\t//add to the content property\r\n\t\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild(this._mesh);\r\n\r\n\t\t\t\t\tthis._pFinalizeAsset(this._mesh.geometry);\r\n\t\t\t\t\tthis._pFinalizeAsset(this._mesh);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._pPauseAndRetrieveDependencies();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\t}\r\n\r\n\t/**\r\n\t * Reads in all that MD2 Header data that is declared as private variables.\r\n\t * I know its a lot, and it looks ugly, but only way to do it in Flash\r\n\t */\r\n\tprivate parseHeader()\r\n\t{\r\n\t\tthis._ident = this._byteData.readInt();\r\n\t\tthis._version = this._byteData.readInt();\r\n\t\tthis._skinWidth = this._byteData.readInt();\r\n\t\tthis._skinHeight = this._byteData.readInt();\r\n\t\t//skip this._frameSize\r\n\t\tthis._byteData.readInt();\r\n\t\tthis._numSkins = this._byteData.readInt();\r\n\t\tthis._numVertices = this._byteData.readInt();\r\n\t\tthis._numST = this._byteData.readInt();\r\n\t\tthis._numTris = this._byteData.readInt();\r\n\t\t//skip this._numGlCmds\r\n\t\tthis._byteData.readInt();\r\n\t\tthis._numFrames = this._byteData.readInt();\r\n\t\tthis._offsetSkins = this._byteData.readInt();\r\n\t\tthis._offsetST = this._byteData.readInt();\r\n\t\tthis._offsetTris = this._byteData.readInt();\r\n\t\tthis._offsetFrames = this._byteData.readInt();\r\n\t\t//skip this._offsetGlCmds\r\n\t\tthis._byteData.readInt();\r\n\t\tthis._offsetEnd = this._byteData.readInt();\r\n\r\n\t\tthis._parsedHeader = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the file names for the materials.\r\n\t */\r\n\tprivate parseMaterialNames()\r\n\t{\r\n\t\tvar url:string;\r\n\t\tvar name:string;\r\n\t\tvar extIndex:number /*int*/;\r\n\t\tvar slashIndex:number /*int*/;\r\n\t\tthis._materialNames = new Array<string>();\r\n\t\tthis._byteData.position = this._offsetSkins;\r\n\r\n\t\tvar regExp:RegExp = new RegExp(\"[^a-zA-Z0-9\\\\_\\/.]\", \"g\");\r\n\t\tfor (var i:number /*uint*/ = 0; i < this._numSkins; ++i) {\r\n\t\t\tname = this._byteData.readUTFBytes(64);\r\n\t\t\tname = name.replace(regExp, \"\");\r\n\t\t\textIndex = name.lastIndexOf(\".\");\r\n\t\t\tif (this._ignoreTexturePath)\r\n\t\t\t\tslashIndex = name.lastIndexOf(\"/\");\r\n\t\t\tif (name.toLowerCase().indexOf(\".jpg\") == -1 && name.toLowerCase().indexOf(\".png\") == -1) {\r\n\t\t\t\tname = name.substring(slashIndex + 1, extIndex);\r\n\t\t\t\turl = name + \".\" + this._textureType;\r\n\t\t\t} else {\r\n\t\t\t\turl = name;\r\n\t\t\t}\r\n\r\n\t\t\tthis._materialNames[i] = name;\r\n\r\n\t\t\t// only support 1 skin TODO: really?\r\n\t\t\tif (this.dependencies.length == 0)\r\n\t\t\t\tthis._pAddDependency(name, new URLRequest(url));\r\n\t\t}\r\n\r\n\t\tif (this._materialNames.length > 0)\r\n\t\t\tthis._mesh.material.name = this._materialNames[0]; else\r\n\t\t\tthis.materialFinal = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the uv data for the mesh.\r\n\t */\r\n\tprivate parseUV()\r\n\t{\r\n\t\tvar j:number /*uint*/ = 0;\r\n\r\n\t\tthis._uvs = new Array<number>(this._numST*2);\r\n\t\tthis._byteData.position = this._offsetST;\r\n\t\tfor (var i:number /*uint*/ = 0; i < this._numST; i++) {\r\n\t\t\tthis._uvs[j++] = this._byteData.readShort()/this._skinWidth;\r\n\t\t\tthis._uvs[j++] = this._byteData.readShort()/this._skinHeight;\r\n\t\t}\r\n\r\n\t\tthis._parsedUV = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses unique indices for the faces.\r\n\t */\r\n\tprivate parseFaces()\r\n\t{\r\n\t\tvar a:number /*uint*/, b:number /*uint*/, c:number /*uint*/, ta:number /*uint*/, tb:number /*uint*/, tc:number /*uint*/;\r\n\t\tvar i:number /*uint*/;\r\n\r\n\t\tthis._vertIndices = new Array<number>();\r\n\t\tthis._uvIndices = new Array<number>();\r\n\t\tthis._indices = new Array<number>() /*uint*/;\r\n\r\n\t\tthis._byteData.position = this._offsetTris;\r\n\r\n\t\tfor (i = 0; i < this._numTris; i++) {\r\n\t\t\t//collect vertex indices\r\n\t\t\ta = this._byteData.readUnsignedShort();\r\n\t\t\tb = this._byteData.readUnsignedShort();\r\n\t\t\tc = this._byteData.readUnsignedShort();\r\n\r\n\t\t\t//collect uv indices\r\n\t\t\tta = this._byteData.readUnsignedShort();\r\n\t\t\ttb = this._byteData.readUnsignedShort();\r\n\t\t\ttc = this._byteData.readUnsignedShort();\r\n\r\n\t\t\tthis.addIndex(a, ta);\r\n\t\t\tthis.addIndex(b, tb);\r\n\t\t\tthis.addIndex(c, tc);\r\n\t\t}\r\n\r\n\t\tvar len:number /*uint*/ = this._uvIndices.length;\r\n\t\tthis._finalUV = new Array<number>(len*2);\r\n\r\n\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\tthis._finalUV[i << 1] = this._uvs[this._uvIndices[i] << 1];\r\n\t\t\tthis._finalUV[(i << 1) + 1] = this._uvs[(this._uvIndices[i] << 1) + 1];\r\n\t\t}\r\n\r\n\t\tthis._parsedFaces = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a face index to the list if it doesn't exist yet, based on vertexIndex and uvIndex, and adds the\r\n\t * corresponding vertex and uv data in the correct location.\r\n\t * @param vertexIndex The original index in the vertex list.\r\n\t * @param uvIndex The original index in the uv list.\r\n\t */\r\n\tprivate addIndex(vertexIndex:number /*uint*/, uvIndex:number /*uint*/)\r\n\t{\r\n\t\tvar index:number /*int*/ = this.findIndex(vertexIndex, uvIndex);\r\n\r\n\t\tif (index == -1) {\r\n\t\t\tthis._indices.push(this._vertIndices.length);\r\n\t\t\tthis._vertIndices.push(vertexIndex);\r\n\t\t\tthis._uvIndices.push(uvIndex);\r\n\t\t} else\r\n\t\t\tthis._indices.push(index);\r\n\t}\r\n\r\n\t/**\r\n\t * Finds the final index corresponding to the original MD2's vertex and uv indices. Returns -1 if it wasn't added yet.\r\n\t * @param vertexIndex The original index in the vertex list.\r\n\t * @param uvIndex The original index in the uv list.\r\n\t * @return The index of the final mesh corresponding to the original vertex and uv index. -1 if it doesn't exist yet.\r\n\t */\r\n\tprivate findIndex(vertexIndex:number /*uint*/, uvIndex:number /*uint*/):number /*int*/\r\n\t{\r\n\t\tvar len:number /*uint*/ = this._vertIndices.length;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\r\n\t\t\tif (this._vertIndices[i] == vertexIndex && this._uvIndices[i] == uvIndex)\r\n\t\t\t\treturn i;\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses all the frame geometries.\r\n\t */\r\n\tprivate parseFrames()\r\n\t{\r\n\t\tvar sx:number, sy:number, sz:number;\r\n\t\tvar tx:number, ty:number, tz:number;\r\n\t\tvar geometry:Geometry;\r\n\t\tvar subGeom:TriangleSubGeometry;\r\n\t\tvar vertLen:number /*uint*/ = this._vertIndices.length;\r\n\t\tvar fvertices:Array<number>;\r\n\t\tvar tvertices:Array<number>;\r\n\t\tvar i:number /*uint*/, j:number /*int*/, k:number /*uint*/;\r\n\t\t//var ch : number /*uint*/;\r\n\t\tvar name:string = \"\";\r\n\t\tvar prevClip:VertexClipNode = null;\r\n\r\n\t\tthis._byteData.position = this._offsetFrames;\r\n\r\n\t\tfor (i = 0; i < this._numFrames; i++) {\r\n\r\n\t\t\ttvertices = new Array<number>();\r\n\t\t\tfvertices = new Array<number>(vertLen*3);\r\n\r\n\t\t\tsx = this._byteData.readFloat();\r\n\t\t\tsy = this._byteData.readFloat();\r\n\t\t\tsz = this._byteData.readFloat();\r\n\r\n\t\t\ttx = this._byteData.readFloat();\r\n\t\t\tty = this._byteData.readFloat();\r\n\t\t\ttz = this._byteData.readFloat();\r\n\r\n\t\t\tname = this.readFrameName();\r\n\r\n\t\t\t// Note, the extra data.position++ in the for loop is there\r\n\t\t\t// to skip over a byte that holds the \"vertex normal index\"\r\n\t\t\tfor (j = 0; j < this._numVertices; j++, this._byteData.position++)\r\n\t\t\t\ttvertices.push(sx*this._byteData.readUnsignedByte() + tx, sy*this._byteData.readUnsignedByte() + ty, sz*this._byteData.readUnsignedByte() + tz);\r\n\r\n\t\t\tk = 0;\r\n\t\t\tfor (j = 0; j < vertLen; j++) {\r\n\t\t\t\tfvertices[k++] = tvertices[this._vertIndices[j]*3];\r\n\t\t\t\tfvertices[k++] = tvertices[this._vertIndices[j]*3 + 2];\r\n\t\t\t\tfvertices[k++] = tvertices[this._vertIndices[j]*3 + 1];\r\n\t\t\t}\r\n\r\n\t\t\tsubGeom = new TriangleSubGeometry(true);\r\n\r\n\t\t\tif (this._firstSubGeom == null)\r\n\t\t\t\tthis._firstSubGeom = subGeom;\r\n\r\n\t\t\tgeometry = new Geometry();\r\n\t\t\tgeometry.addSubGeometry(subGeom);\r\n\r\n\t\t\tsubGeom.updateIndices(this._indices);\r\n\t\t\tsubGeom.updatePositions(fvertices);\r\n\t\t\tsubGeom.updateUVs(this._finalUV);\r\n\t\t\tsubGeom.vertexNormals;\r\n\t\t\tsubGeom.vertexTangents;\r\n\t\t\tsubGeom.autoDeriveNormals = false;\r\n\t\t\tsubGeom.autoDeriveTangents = false;\r\n\r\n\t\t\tvar clip:VertexClipNode = this._clipNodes[name];\r\n\r\n\t\t\tif (!clip) {\r\n\t\t\t\t// If another sequence was parsed before this one, starting\r\n\t\t\t\t// a new state means the previous one is complete and can\r\n\t\t\t\t// hence be finalized.\r\n\t\t\t\tif (prevClip) {\r\n\t\t\t\t\tthis._pFinalizeAsset(prevClip);\r\n\t\t\t\t\tthis._animationSet.addAnimation(prevClip);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclip = new VertexClipNode();\r\n\t\t\t\tclip.name = name;\r\n\t\t\t\tclip.stitchFinalFrame = true;\r\n\r\n\t\t\t\tthis._clipNodes[name] = clip;\r\n\r\n\t\t\t\tprevClip = clip;\r\n\t\t\t}\r\n\t\t\tclip.addFrame(geometry, 1000/MD2Parser.FPS);\r\n\t\t}\r\n\r\n\t\t// Finalize the last state\r\n\t\tif (prevClip) {\r\n\t\t\tthis._pFinalizeAsset(prevClip);\r\n\t\t\tthis._animationSet.addAnimation(prevClip);\r\n\t\t}\r\n\r\n\t\t// Force this._pFinalizeAsset() to decide name\r\n\t\tthis._pFinalizeAsset(this._animationSet);\r\n\r\n\t\tthis._parsedFrames = true;\r\n\t}\r\n\r\n\tprivate readFrameName():string\r\n\t{\r\n\t\tvar name:string = \"\";\r\n\t\tvar k:number /*uint*/ = 0;\r\n\t\tfor (var j:number /*uint*/ = 0; j < 16; j++) {\r\n\t\t\tvar ch:number /*uint*/ = this._byteData.readUnsignedByte();\r\n\r\n\t\t\tif (Math.floor(ch) > 0x39 && Math.floor(ch) <= 0x7A && k == 0)\r\n\t\t\t\tname += String.fromCharCode(ch);\r\n\r\n\t\t\tif (Math.floor(ch) >= 0x30 && Math.floor(ch) <= 0x39)\r\n\t\t\t\tk++;\r\n\t\t}\r\n\t\treturn name;\r\n\t}\r\n}\r\n\r\nexport = MD2Parser;","import Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\n\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode\");\r\n\r\n/**\r\n * MD5AnimParser provides a parser for the md5anim data type, providing an animation sequence for the md5 format.\r\n *\r\n * todo: optimize\r\n */\r\nclass MD5AnimParser extends ParserBase\r\n{\r\n\tprivate _textData:string;\r\n\tprivate _startedParsing:boolean;\r\n\tpublic static VERSION_TOKEN:string = \"MD5Version\";\r\n\tpublic static COMMAND_LINE_TOKEN:string = \"commandline\";\r\n\tpublic static NUM_FRAMES_TOKEN:string = \"numFrames\";\r\n\tpublic static NUM_JOINTS_TOKEN:string = \"numJoints\";\r\n\tpublic static FRAME_RATE_TOKEN:string = \"frameRate\";\r\n\tpublic static NUM_ANIMATED_COMPONENTS_TOKEN:string = \"numAnimatedComponents\";\r\n\r\n\tpublic static HIERARCHY_TOKEN:string = \"hierarchy\";\r\n\tpublic static BOUNDS_TOKEN:string = \"bounds\";\r\n\tpublic static BASE_FRAME_TOKEN:string = \"baseframe\";\r\n\tpublic static FRAME_TOKEN:string = \"frame\";\r\n\r\n\tpublic static COMMENT_TOKEN:string = \"//\";\r\n\r\n\tprivate _parseIndex:number /*int*/ = 0;\r\n\tprivate _reachedEOF:boolean;\r\n\tprivate _line:number /*int*/ = 0;\r\n\tprivate _charLineIndex:number /*int*/ = 0;\r\n\tprivate _version:number /*int*/;\r\n\tprivate _frameRate:number /*int*/;\r\n\tprivate _numFrames:number /*int*/;\r\n\tprivate _numJoints:number /*int*/;\r\n\tprivate _numAnimatedComponents:number /*int*/;\r\n\r\n\tprivate _hierarchy:Array<HierarchyData>;\r\n\tprivate _bounds:Array<BoundsData>;\r\n\tprivate _frameData:Array<FrameData>;\r\n\tprivate _baseFrameData:Array<BaseFrameData>;\r\n\r\n\tprivate _rotationQuat:Quaternion;\r\n\tprivate _clip:SkeletonClipNode;\r\n\r\n\t/**\r\n\t * Creates a new MD5AnimParser object.\r\n\t * @param uri The url or id of the data or file to be parsed.\r\n\t * @param extra The holder for extra contextual data that the parser might need.\r\n\t */\r\n\tconstructor(additionalRotationAxis:Vector3D = null, additionalRotationRadians:number = 0)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.TEXT);\r\n\t\tthis._rotationQuat = new Quaternion();\r\n\t\tvar t1:Quaternion = new Quaternion();\r\n\t\tvar t2:Quaternion = new Quaternion();\r\n\r\n\t\tt1.fromAxisAngle(Vector3D.X_AXIS, -Math.PI*.5);\r\n\t\tt2.fromAxisAngle(Vector3D.Y_AXIS, -Math.PI*.5);\r\n\r\n\t\tthis._rotationQuat.multiply(t2, t1);\r\n\r\n\t\tif (additionalRotationAxis) {\r\n\t\t\tthis._rotationQuat.multiply(t2, t1);\r\n\t\t\tt1.fromAxisAngle(additionalRotationAxis, additionalRotationRadians);\r\n\t\t\tthis._rotationQuat.multiply(t1, this._rotationQuat);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"md5anim\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tvar token:string;\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._textData = this._pGetTextData();\r\n\t\t\tthis._startedParsing = true;\r\n\t\t}\r\n\r\n\t\twhile (this._pHasTime()) {\r\n\t\t\ttoken = this.getNextToken();\r\n\t\t\tswitch (token) {\r\n\t\t\t\tcase MD5AnimParser.COMMENT_TOKEN:\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"\":\r\n\t\t\t\t\t// can occur at the end of a file\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.VERSION_TOKEN:\r\n\t\t\t\t\tthis._version = this.getNextInt();\r\n\t\t\t\t\tif (this._version != 10)\r\n\t\t\t\t\t\tthrow new Error(\"Unknown version number encountered!\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.COMMAND_LINE_TOKEN:\r\n\t\t\t\t\tthis.parseCMD();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.NUM_FRAMES_TOKEN:\r\n\t\t\t\t\tthis._numFrames = this.getNextInt();\r\n\t\t\t\t\tthis._bounds = new Array<BoundsData>();\r\n\t\t\t\t\tthis._frameData = new Array<FrameData>();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.NUM_JOINTS_TOKEN:\r\n\t\t\t\t\tthis._numJoints = this.getNextInt();\r\n\t\t\t\t\tthis._hierarchy = new Array<HierarchyData>(this._numJoints);\r\n\t\t\t\t\tthis._baseFrameData = new Array<BaseFrameData>(this._numJoints);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.FRAME_RATE_TOKEN:\r\n\t\t\t\t\tthis._frameRate = this.getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.NUM_ANIMATED_COMPONENTS_TOKEN:\r\n\t\t\t\t\tthis._numAnimatedComponents = this.getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.HIERARCHY_TOKEN:\r\n\t\t\t\t\tthis.parseHierarchy();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.BOUNDS_TOKEN:\r\n\t\t\t\t\tthis.parseBounds();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.BASE_FRAME_TOKEN:\r\n\t\t\t\t\tthis.parseBaseFrame();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.FRAME_TOKEN:\r\n\t\t\t\t\tthis.parseFrame();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif (!this._reachedEOF)\r\n\t\t\t\t\t\tthis.sendUnknownKeywordError();\r\n\t\t\t}\r\n\r\n\t\t\tif (this._reachedEOF) {\r\n\t\t\t\tthis._clip = new SkeletonClipNode();\r\n\t\t\t\tthis.translateClip();\r\n\t\t\t\tthis._pFinalizeAsset(this._clip);\r\n\t\t\t\treturn ParserBase.PARSING_DONE;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts all key frame data to an SkinnedAnimationSequence.\r\n\t */\r\n\tprivate translateClip():void\r\n\t{\r\n\t\tfor (var i:number /*int*/ = 0; i < this._numFrames; ++i)\r\n\t\t\tthis._clip.addFrame(this.translatePose(this._frameData[i]), 1000/this._frameRate);\r\n\t}\r\n\r\n\t/**\r\n\t * Converts a single key frame data to a SkeletonPose.\r\n\t * @param frameData The actual frame data.\r\n\t * @return A SkeletonPose containing the frame data's pose.\r\n\t */\r\n\tprivate translatePose(frameData:FrameData):SkeletonPose\r\n\t{\r\n\t\tvar hierarchy:HierarchyData;\r\n\t\tvar pose:JointPose;\r\n\t\tvar base:BaseFrameData;\r\n\t\tvar flags:number /*int*/;\r\n\t\tvar j:number /*int*/;\r\n\t\tvar translate:Vector3D = new Vector3D();\r\n\t\tvar orientation:Quaternion = new Quaternion();\r\n\t\tvar components:Array<number> = frameData.components;\r\n\t\tvar skelPose:SkeletonPose = new SkeletonPose();\r\n\t\tvar jointPoses:Array<JointPose> = skelPose.jointPoses;\r\n\r\n\t\tfor (var i:number /*int*/ = 0; i < this._numJoints; ++i) {\r\n\t\t\tj = 0;\r\n\t\t\tpose = new JointPose();\r\n\t\t\thierarchy = this._hierarchy[i];\r\n\t\t\tbase = this._baseFrameData[i];\r\n\t\t\tflags = hierarchy.flags;\r\n\t\t\ttranslate.x = base.position.x;\r\n\t\t\ttranslate.y = base.position.y;\r\n\t\t\ttranslate.z = base.position.z;\r\n\t\t\torientation.x = base.orientation.x;\r\n\t\t\torientation.y = base.orientation.y;\r\n\t\t\torientation.z = base.orientation.z;\r\n\r\n\t\t\tif (flags & 1)\r\n\t\t\t\ttranslate.x = components[hierarchy.startIndex + (j++)];\r\n\t\t\tif (flags & 2)\r\n\t\t\t\ttranslate.y = components[hierarchy.startIndex + (j++)];\r\n\t\t\tif (flags & 4)\r\n\t\t\t\ttranslate.z = components[hierarchy.startIndex + (j++)];\r\n\t\t\tif (flags & 8)\r\n\t\t\t\torientation.x = components[hierarchy.startIndex + (j++)];\r\n\t\t\tif (flags & 16)\r\n\t\t\t\torientation.y = components[hierarchy.startIndex + (j++)];\r\n\t\t\tif (flags & 32)\r\n\t\t\t\torientation.z = components[hierarchy.startIndex + (j++)];\r\n\r\n\t\t\tvar w:number = 1 - orientation.x*orientation.x - orientation.y*orientation.y - orientation.z*orientation.z;\r\n\t\t\torientation.w = w < 0? 0 : -Math.sqrt(w);\r\n\r\n\t\t\tif (hierarchy.parentIndex < 0) {\r\n\t\t\t\tpose.orientation.multiply(this._rotationQuat, orientation);\r\n\t\t\t\tpose.translation = this._rotationQuat.rotatePoint(translate);\r\n\t\t\t} else {\r\n\t\t\t\tpose.orientation.copyFrom(orientation);\r\n\t\t\t\tpose.translation.x = translate.x;\r\n\t\t\t\tpose.translation.y = translate.y;\r\n\t\t\t\tpose.translation.z = translate.z;\r\n\t\t\t}\r\n\t\t\tpose.orientation.y = -pose.orientation.y;\r\n\t\t\tpose.orientation.z = -pose.orientation.z;\r\n\t\t\tpose.translation.x = -pose.translation.x;\r\n\r\n\t\t\tjointPoses[i] = pose;\r\n\t\t}\r\n\r\n\t\treturn skelPose;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the skeleton's hierarchy data.\r\n\t */\r\n\tprivate parseHierarchy():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar data:HierarchyData;\r\n\t\tvar token:string = this.getNextToken();\r\n\t\tvar i:number /*int*/ = 0;\r\n\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tdata = new HierarchyData();\r\n\t\t\tdata.name = this.parseLiteralstring();\r\n\t\t\tdata.parentIndex = this.getNextInt();\r\n\t\t\tdata.flags = this.getNextInt();\r\n\t\t\tdata.startIndex = this.getNextInt();\r\n\t\t\tthis._hierarchy[i++] = data;\r\n\r\n\t\t\tch = this.getNextChar();\r\n\r\n\t\t\tif (ch == \"/\") {\r\n\t\t\t\tthis.putBack();\r\n\t\t\t\tch = this.getNextToken();\r\n\t\t\t\tif (ch == MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\tch = this.getNextChar();\r\n\t\t\t}\r\n\r\n\t\t\tif (ch != \"}\")\r\n\t\t\t\tthis.putBack();\r\n\r\n\t\t} while (ch != \"}\");\r\n\t}\r\n\r\n\t/**\r\n\t * Parses frame bounds.\r\n\t */\r\n\tprivate parseBounds():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar data:BoundsData;\r\n\t\tvar token:string = this.getNextToken();\r\n\t\tvar i:number /*int*/ = 0;\r\n\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tdata = new BoundsData();\r\n\t\t\tdata.min = this.parseVector3D();\r\n\t\t\tdata.max = this.parseVector3D();\r\n\t\t\tthis._bounds[i++] = data;\r\n\r\n\t\t\tch = this.getNextChar();\r\n\r\n\t\t\tif (ch == \"/\") {\r\n\t\t\t\tthis.putBack();\r\n\t\t\t\tch = this.getNextToken();\r\n\t\t\t\tif (ch == MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\tch = this.getNextChar();\r\n\t\t\t}\r\n\r\n\t\t\tif (ch != \"}\")\r\n\t\t\t\tthis.putBack();\r\n\r\n\t\t} while (ch != \"}\");\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the base frame.\r\n\t */\r\n\tprivate parseBaseFrame():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar data:BaseFrameData;\r\n\t\tvar token:string = this.getNextToken();\r\n\t\tvar i:number /*int*/ = 0;\r\n\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tdata = new BaseFrameData();\r\n\t\t\tdata.position = this.parseVector3D();\r\n\t\t\tdata.orientation = this.parseQuaternion();\r\n\t\t\tthis._baseFrameData[i++] = data;\r\n\r\n\t\t\tch = this.getNextChar();\r\n\r\n\t\t\tif (ch == \"/\") {\r\n\t\t\t\tthis.putBack();\r\n\t\t\t\tch = this.getNextToken();\r\n\t\t\t\tif (ch == MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\tch = this.getNextChar();\r\n\t\t\t}\r\n\r\n\t\t\tif (ch != \"}\")\r\n\t\t\t\tthis.putBack();\r\n\r\n\t\t} while (ch != \"}\");\r\n\t}\r\n\r\n\t/**\r\n\t * Parses a single frame.\r\n\t */\r\n\tprivate parseFrame():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar data:FrameData;\r\n\t\tvar token:string;\r\n\t\tvar frameIndex:number /*int*/;\r\n\r\n\t\tframeIndex = this.getNextInt();\r\n\r\n\t\ttoken = this.getNextToken();\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tdata = new FrameData();\r\n\t\t\tdata.components = new Array<number>(this._numAnimatedComponents);\r\n\r\n\t\t\tfor (var i:number /*int*/ = 0; i < this._numAnimatedComponents; ++i)\r\n\t\t\t\tdata.components[i] = this.getNextNumber();\r\n\r\n\t\t\tthis._frameData[frameIndex] = data;\r\n\r\n\t\t\tch = this.getNextChar();\r\n\r\n\t\t\tif (ch == \"/\") {\r\n\t\t\t\tthis.putBack();\r\n\t\t\t\tch = this.getNextToken();\r\n\t\t\t\tif (ch == MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\tch = this.getNextChar();\r\n\t\t\t}\r\n\r\n\t\t\tif (ch != \"}\")\r\n\t\t\t\tthis.putBack();\r\n\r\n\t\t} while (ch != \"}\");\r\n\t}\r\n\r\n\t/**\r\n\t * Puts back the last read character into the data stream.\r\n\t */\r\n\tprivate putBack():void\r\n\t{\r\n\t\tthis._parseIndex--;\r\n\t\tthis._charLineIndex--;\r\n\t\tthis._reachedEOF = this._parseIndex >= this._textData.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the next token in the data stream.\r\n\t */\r\n\tprivate getNextToken():string\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar token:string = \"\";\r\n\r\n\t\twhile (!this._reachedEOF) {\r\n\t\t\tch = this.getNextChar();\r\n\t\t\tif (ch == \" \" || ch == \"\\r\" || ch == \"\\n\" || ch == \"\\t\") {\r\n\t\t\t\tif (token != MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.skipWhiteSpace();\r\n\t\t\t\tif (token != \"\")\r\n\t\t\t\t\treturn token;\r\n\t\t\t} else\r\n\t\t\t\ttoken += ch;\r\n\r\n\t\t\tif (token == MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\treturn token;\r\n\t\t}\r\n\r\n\t\treturn token;\r\n\t}\r\n\r\n\t/**\r\n\t * Skips all whitespace in the data stream.\r\n\t */\r\n\tprivate skipWhiteSpace():void\r\n\t{\r\n\t\tvar ch:string;\r\n\r\n\t\tdo\r\n\t\t\tch = this.getNextChar(); while (ch == \"\\n\" || ch == \" \" || ch == \"\\r\" || ch == \"\\t\");\r\n\r\n\t\tthis.putBack();\r\n\t}\r\n\r\n\t/**\r\n\t * Skips to the next line.\r\n\t */\r\n\tprivate ignoreLine():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\twhile (!this._reachedEOF && ch != \"\\n\")\r\n\t\t\tch = this.getNextChar();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next single character in the data stream.\r\n\t */\r\n\tprivate getNextChar():string\r\n\t{\r\n\t\tvar ch:string = this._textData.charAt(this._parseIndex++);\r\n\r\n\t\tif (ch == \"\\n\") {\r\n\t\t\t++this._line;\r\n\t\t\tthis._charLineIndex = 0;\r\n\t\t} else if (ch != \"\\r\")\r\n\t\t\t++this._charLineIndex;\r\n\r\n\t\tif (this._parseIndex == this._textData.length)\r\n\t\t\tthis._reachedEOF = true;\r\n\r\n\t\treturn ch;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next integer in the data stream.\r\n\t */\r\n\tprivate getNextInt():number /*int*/\r\n\t{\r\n\t\tvar i:number = parseInt(this.getNextToken());\r\n\t\tif (isNaN(i))\r\n\t\t\tthis.sendParseError(\"int type\");\r\n\t\treturn i;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next floating point number in the data stream.\r\n\t */\r\n\tprivate getNextNumber():number\r\n\t{\r\n\t\tvar f:number = parseFloat(this.getNextToken());\r\n\t\tif (isNaN(f))\r\n\t\t\tthis.sendParseError(\"float type\");\r\n\t\treturn f;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next 3d vector in the data stream.\r\n\t */\r\n\tprivate parseVector3D():Vector3D\r\n\t{\r\n\t\tvar vec:Vector3D = new Vector3D();\r\n\t\tvar ch:string = this.getNextToken();\r\n\r\n\t\tif (ch != \"(\")\r\n\t\t\tthis.sendParseError(\"(\");\r\n\t\tvec.x = this.getNextNumber();\r\n\t\tvec.y = this.getNextNumber();\r\n\t\tvec.z = this.getNextNumber();\r\n\r\n\t\tif (this.getNextToken() != \")\")\r\n\t\t\tthis.sendParseError(\")\");\r\n\r\n\t\treturn vec;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next quaternion in the data stream.\r\n\t */\r\n\tprivate parseQuaternion():Quaternion\r\n\t{\r\n\t\tvar quat:Quaternion = new Quaternion();\r\n\t\tvar ch:string = this.getNextToken();\r\n\r\n\t\tif (ch != \"(\")\r\n\t\t\tthis.sendParseError(\"(\");\r\n\t\tquat.x = this.getNextNumber();\r\n\t\tquat.y = this.getNextNumber();\r\n\t\tquat.z = this.getNextNumber();\r\n\r\n\t\t// quat supposed to be unit length\r\n\t\tvar t:number = 1 - (quat.x*quat.x) - (quat.y*quat.y) - (quat.z*quat.z);\r\n\t\tquat.w = t < 0? 0 : -Math.sqrt(t);\r\n\r\n\t\tif (this.getNextToken() != \")\")\r\n\t\t\tthis.sendParseError(\")\");\r\n\r\n\t\treturn quat;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the command line data.\r\n\t */\r\n\tprivate parseCMD():void\r\n\t{\r\n\t\t// just ignore the command line property\r\n\t\tthis.parseLiteralstring();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next literal string in the data stream. A literal string is a sequence of characters bounded\r\n\t * by double quotes.\r\n\t */\r\n\tprivate parseLiteralstring():string\r\n\t{\r\n\t\tthis.skipWhiteSpace();\r\n\r\n\t\tvar ch:string = this.getNextChar();\r\n\t\tvar str:string = \"\";\r\n\r\n\t\tif (ch != \"\\\"\")\r\n\t\t\tthis.sendParseError(\"\\\"\");\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tch = this.getNextChar();\r\n\t\t\tif (ch != \"\\\"\")\r\n\t\t\t\tstr += ch;\r\n\t\t} while (ch != \"\\\"\");\r\n\r\n\t\treturn str;\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an end-of-file error when a premature end of file was encountered.\r\n\t */\r\n\tprivate sendEOFError():void\r\n\t{\r\n\t\tthrow new Error(\"Unexpected end of file\");\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an error when an unexpected token was encountered.\r\n\t * @param expected The token type that was actually expected.\r\n\t */\r\n\tprivate sendParseError(expected:string):void\r\n\t{\r\n\t\tthrow new Error(\"Unexpected token at line \" + (this._line + 1) + \", character \" + this._charLineIndex + \". \" + expected + \" expected, but \" + this._textData.charAt(this._parseIndex - 1) + \" encountered\");\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an error when an unknown keyword was encountered.\r\n\t */\r\n\tprivate sendUnknownKeywordError():void\r\n\t{\r\n\t\tthrow new Error(\"Unknown keyword at line \" + (this._line + 1) + \", character \" + this._charLineIndex + \". \");\r\n\t}\r\n}\r\n\r\nexport = MD5AnimParser;\r\n\r\n\r\n/**\r\n *\r\n */\r\nclass BaseFrameData\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic position:Vector3D;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic orientation:Quaternion;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass BoundsData\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic min:Vector3D;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic max:Vector3D;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass FrameData\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic index:number /*int*/;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic components:Array<number>;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass HierarchyData\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic name:string;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic parentIndex:number /*int*/;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic flags:number /*int*/;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic startIndex:number /*int*/;\r\n}","import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\n\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\nimport SkeletonAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimationSet\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonJoint\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonJoint\");\r\n\r\n// todo: create animation system, parse skeleton\r\n\r\n/**\r\n * MD5MeshParser provides a parser for the md5mesh data type, providing the geometry of the md5 format.\r\n *\r\n * todo: optimize\r\n */\r\nclass MD5MeshParser extends ParserBase\r\n{\r\n\tprivate _textData:string;\r\n\tprivate _startedParsing:boolean;\r\n\tpublic static VERSION_TOKEN:string = \"MD5Version\";\r\n\tpublic static COMMAND_LINE_TOKEN:string = \"commandline\";\r\n\tpublic static NUM_JOINTS_TOKEN:string = \"numJoints\";\r\n\tpublic static NUM_MESHES_TOKEN:string = \"numMeshes\";\r\n\tpublic static COMMENT_TOKEN:string = \"//\";\r\n\tpublic static JOINTS_TOKEN:string = \"joints\";\r\n\tpublic static MESH_TOKEN:string = \"mesh\";\r\n\r\n\tpublic static MESH_SHADER_TOKEN:string = \"shader\";\r\n\tpublic static MESH_NUM_VERTS_TOKEN:string = \"numverts\";\r\n\tpublic static MESH_VERT_TOKEN:string = \"vert\";\r\n\tpublic static MESH_NUM_TRIS_TOKEN:string = \"numtris\";\r\n\tpublic static MESH_TRI_TOKEN:string = \"tri\";\r\n\tpublic static MESH_NUM_WEIGHTS_TOKEN:string = \"numweights\";\r\n\tpublic static MESH_WEIGHT_TOKEN:string = \"weight\";\r\n\r\n\tprivate _parseIndex:number /*int*/ = 0;\r\n\tprivate _reachedEOF:boolean;\r\n\tprivate _line:number /*int*/ = 0;\r\n\tprivate _charLineIndex:number /*int*/ = 0;\r\n\tprivate _version:number /*int*/;\r\n\tprivate _numJoints:number /*int*/;\r\n\tprivate _numMeshes:number /*int*/;\r\n\r\n\tprivate _mesh:Mesh;\r\n\tprivate _shaders:Array<string>;\r\n\r\n\tprivate _maxJointCount:number /*int*/;\r\n\tprivate _meshData:Array<MeshData>;\r\n\tprivate _bindPoses:Array<Matrix3D>;\r\n\tprivate _geometry:Geometry;\r\n\r\n\tprivate _skeleton:Skeleton;\r\n\tprivate _animationSet:SkeletonAnimationSet;\r\n\r\n\tprivate _rotationQuat:Quaternion;\r\n\r\n\t/**\r\n\t * Creates a new MD5MeshParser object.\r\n\t */\r\n\tconstructor(additionalRotationAxis:Vector3D = null, additionalRotationRadians:number = 0)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.TEXT);\r\n\t\tthis._rotationQuat = new Quaternion();\r\n\r\n\t\tthis._rotationQuat.fromAxisAngle(Vector3D.X_AXIS, -Math.PI*.5);\r\n\r\n\t\tif (additionalRotationAxis) {\r\n\t\t\tvar quat:Quaternion = new Quaternion();\r\n\t\t\tquat.fromAxisAngle(additionalRotationAxis, additionalRotationRadians);\r\n\t\t\tthis._rotationQuat.multiply(this._rotationQuat, quat);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"md5mesh\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tvar token:string;\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._textData = this._pGetTextData();\r\n\t\t\tthis._startedParsing = true;\r\n\t\t}\r\n\r\n\t\twhile (this._pHasTime()) {\r\n\t\t\ttoken = this.getNextToken();\r\n\t\t\tswitch (token) {\r\n\t\t\t\tcase MD5MeshParser.COMMENT_TOKEN:\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.VERSION_TOKEN:\r\n\t\t\t\t\tthis._version = this.getNextInt();\r\n\t\t\t\t\tif (this._version != 10)\r\n\t\t\t\t\t\tthrow new Error(\"Unknown version number encountered!\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.COMMAND_LINE_TOKEN:\r\n\t\t\t\t\tthis.parseCMD();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.NUM_JOINTS_TOKEN:\r\n\t\t\t\t\tthis._numJoints = this.getNextInt();\r\n\t\t\t\t\tthis._bindPoses = new Array<Matrix3D>(this._numJoints);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.NUM_MESHES_TOKEN:\r\n\t\t\t\t\tthis._numMeshes = this.getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.JOINTS_TOKEN:\r\n\t\t\t\t\tthis.parseJoints();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_TOKEN:\r\n\t\t\t\t\tthis.parseMesh();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif (!this._reachedEOF)\r\n\t\t\t\t\t\tthis.sendUnknownKeywordError();\r\n\t\t\t}\r\n\r\n\t\t\tif (this._reachedEOF) {\r\n\t\t\t\tthis.calculateMaxJointCount();\r\n\t\t\t\tthis._animationSet = new SkeletonAnimationSet(this._maxJointCount);\r\n\r\n\t\t\t\tthis._mesh = new Mesh(new Geometry(), null);\r\n\t\t\t\tthis._geometry = this._mesh.geometry;\r\n\r\n\t\t\t\tfor (var i:number /*int*/ = 0; i < this._meshData.length; ++i)\r\n\t\t\t\t\tthis._geometry.addSubGeometry(this.translateGeom(this._meshData[i].vertexData, this._meshData[i].weightData, this._meshData[i].indices));\r\n\r\n\t\t\t\t//_geometry.animation = _animation;\r\n\t\t\t\t//\t\t\t\t\t_mesh.animationController = _animationController;\r\n\r\n\t\t\t\t//add to the content property\r\n\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild(this._mesh);\r\n\r\n\t\t\t\tthis._pFinalizeAsset(this._geometry);\r\n\t\t\t\tthis._pFinalizeAsset(this._mesh);\r\n\t\t\t\tthis._pFinalizeAsset(this._skeleton);\r\n\t\t\t\tthis._pFinalizeAsset(this._animationSet);\r\n\t\t\t\treturn ParserBase.PARSING_DONE;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\t}\r\n\r\n\tprivate calculateMaxJointCount():void\r\n\t{\r\n\t\tthis._maxJointCount = 0;\r\n\r\n\t\tvar numMeshData:number /*int*/ = this._meshData.length;\r\n\t\tfor (var i:number /*int*/ = 0; i < numMeshData; ++i) {\r\n\t\t\tvar meshData:MeshData = this._meshData[i];\r\n\t\t\tvar vertexData:Array<VertexData> = meshData.vertexData;\r\n\t\t\tvar numVerts:number /*int*/ = vertexData.length;\r\n\r\n\t\t\tfor (var j:number /*int*/ = 0; j < numVerts; ++j) {\r\n\t\t\t\tvar zeroWeights:number /*int*/ = this.countZeroWeightJoints(vertexData[j], meshData.weightData);\r\n\t\t\t\tvar totalJoints:number /*int*/ = vertexData[j].countWeight - zeroWeights;\r\n\t\t\t\tif (totalJoints > this._maxJointCount)\r\n\t\t\t\t\tthis._maxJointCount = totalJoints;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate countZeroWeightJoints(vertex:VertexData, weights:Array<JointData>):number /*int*/\r\n\t{\r\n\t\tvar start:number /*int*/ = vertex.startWeight;\r\n\t\tvar end:number /*int*/ = vertex.startWeight + vertex.countWeight;\r\n\t\tvar count:number /*int*/ = 0;\r\n\t\tvar weight:number;\r\n\r\n\t\tfor (var i:number /*int*/ = start; i < end; ++i) {\r\n\t\t\tweight = weights[i].bias;\r\n\t\t\tif (weight == 0)\r\n\t\t\t\t++count;\r\n\t\t}\r\n\r\n\t\treturn count;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the skeleton's joints.\r\n\t */\r\n\tprivate parseJoints():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar joint:SkeletonJoint;\r\n\t\tvar pos:Vector3D;\r\n\t\tvar quat:Quaternion;\r\n\t\tvar i:number /*int*/ = 0;\r\n\t\tvar token:string = this.getNextToken();\r\n\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tthis._skeleton = new Skeleton();\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tjoint = new SkeletonJoint();\r\n\t\t\tjoint.name = this.parseLiteralstring();\r\n\t\t\tjoint.parentIndex = this.getNextInt();\r\n\t\t\tpos = this.parseVector3D();\r\n\t\t\tpos = this._rotationQuat.rotatePoint(pos);\r\n\t\t\tquat = this.parseQuaternion();\r\n\r\n\t\t\t// todo: check if this is correct, or maybe we want to actually store it as quats?\r\n\t\t\tthis._bindPoses[i] = quat.toMatrix3D();\r\n\t\t\tthis._bindPoses[i].appendTranslation(pos.x, pos.y, pos.z);\r\n\t\t\tvar inv:Matrix3D = this._bindPoses[i].clone();\r\n\t\t\tinv.invert();\r\n\t\t\tjoint.inverseBindPose = inv.rawData;\r\n\r\n\t\t\tthis._skeleton.joints[i++] = joint;\r\n\r\n\t\t\tch = this.getNextChar();\r\n\r\n\t\t\tif (ch == \"/\") {\r\n\t\t\t\tthis.putBack();\r\n\t\t\t\tch = this.getNextToken();\r\n\t\t\t\tif (ch == MD5MeshParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\tch = this.getNextChar();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (ch != \"}\")\r\n\t\t\t\tthis.putBack();\r\n\t\t} while (ch != \"}\");\r\n\t}\r\n\r\n\t/**\r\n\t * Puts back the last read character into the data stream.\r\n\t */\r\n\tprivate putBack():void\r\n\t{\r\n\t\tthis._parseIndex--;\r\n\t\tthis._charLineIndex--;\r\n\t\tthis._reachedEOF = this._parseIndex >= this._textData.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the mesh geometry.\r\n\t */\r\n\tprivate parseMesh():void\r\n\t{\r\n\t\tvar token:string = this.getNextToken();\r\n\t\tvar ch:string;\r\n\t\tvar vertexData:Array<VertexData>;\r\n\t\tvar weights:Array<JointData>;\r\n\t\tvar indices:Array<number> /*uint*/;\r\n\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tif (this._shaders == null)\r\n\t\t\tthis._shaders = new Array<string>();\r\n\r\n\t\twhile (ch != \"}\") {\r\n\t\t\tch = this.getNextToken();\r\n\t\t\tswitch (ch) {\r\n\t\t\t\tcase MD5MeshParser.COMMENT_TOKEN:\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_SHADER_TOKEN:\r\n\t\t\t\t\tthis._shaders.push(this.parseLiteralstring());\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_NUM_VERTS_TOKEN:\r\n\t\t\t\t\tvertexData = new Array<VertexData>(this.getNextInt());\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_NUM_TRIS_TOKEN:\r\n\t\t\t\t\tindices = new Array<number>(this.getNextInt()*3) /*uint*/;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_NUM_WEIGHTS_TOKEN:\r\n\t\t\t\t\tweights = new Array<JointData>(this.getNextInt());\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_VERT_TOKEN:\r\n\t\t\t\t\tthis.parseVertex(vertexData);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_TRI_TOKEN:\r\n\t\t\t\t\tthis.parseTri(indices);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_WEIGHT_TOKEN:\r\n\t\t\t\t\tthis.parseJoint(weights);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._meshData == null)\r\n\t\t\tthis._meshData = new Array<MeshData>();\r\n\r\n\t\tvar i:number /*uint*/ = this._meshData.length;\r\n\t\tthis._meshData[i] = new MeshData();\r\n\t\tthis._meshData[i].vertexData = vertexData;\r\n\t\tthis._meshData[i].weightData = weights;\r\n\t\tthis._meshData[i].indices = indices;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts the mesh data to a SkinnedSub instance.\r\n\t * @param vertexData The mesh's vertices.\r\n\t * @param weights The joint weights per vertex.\r\n\t * @param indices The indices for the faces.\r\n\t * @return A SubGeometry instance containing all geometrical data for the current mesh.\r\n\t */\r\n\tprivate translateGeom(vertexData:Array<VertexData>, weights:Array<JointData>, indices:Array<number> /*uint*/):TriangleSubGeometry\r\n\t{\r\n\t\tvar len:number /*int*/ = vertexData.length;\r\n\t\tvar v1:number /*int*/, v2:number /*int*/, v3:number /*int*/;\r\n\t\tvar vertex:VertexData;\r\n\t\tvar weight:JointData;\r\n\t\tvar bindPose:Matrix3D;\r\n\t\tvar pos:Vector3D;\r\n\t\tvar subGeom:TriangleSubGeometry = new TriangleSubGeometry(true);\r\n\t\tvar uvs:Array<number> = new Array<number>(len*2);\r\n\t\tvar vertices:Array<number> = new Array<number>(len*3);\r\n\t\tvar jointIndices:Array<number> = new Array<number>(len*this._maxJointCount);\r\n\t\tvar jointWeights:Array<number> = new Array<number>(len*this._maxJointCount);\r\n\t\tvar l:number /*int*/ = 0;\r\n\t\tvar nonZeroWeights:number /*int*/;\r\n\r\n\t\tfor (var i:number /*int*/ = 0; i < len; ++i) {\r\n\t\t\tvertex = vertexData[i];\r\n\t\t\tv1 = vertex.index*3;\r\n\t\t\tv2 = v1 + 1;\r\n\t\t\tv3 = v1 + 2;\r\n\t\t\tvertices[v1] = vertices[v2] = vertices[v3] = 0;\r\n\r\n\t\t\tnonZeroWeights = 0;\r\n\t\t\tfor (var j:number /*int*/ = 0; j < vertex.countWeight; ++j) {\r\n\t\t\t\tweight = weights[vertex.startWeight + j];\r\n\t\t\t\tif (weight.bias > 0) {\r\n\t\t\t\t\tbindPose = this._bindPoses[weight.joint];\r\n\t\t\t\t\tpos = bindPose.transformVector(weight.pos);\r\n\t\t\t\t\tvertices[v1] += pos.x*weight.bias;\r\n\t\t\t\t\tvertices[v2] += pos.y*weight.bias;\r\n\t\t\t\t\tvertices[v3] += pos.z*weight.bias;\r\n\r\n\t\t\t\t\t// indices need to be multiplied by 3 (amount of matrix registers)\r\n\t\t\t\t\tjointIndices[l] = weight.joint*3;\r\n\t\t\t\t\tjointWeights[l++] = weight.bias;\r\n\t\t\t\t\t++nonZeroWeights;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (j = nonZeroWeights; j < this._maxJointCount; ++j) {\r\n\t\t\t\tjointIndices[l] = 0;\r\n\t\t\t\tjointWeights[l++] = 0;\r\n\t\t\t}\r\n\r\n\t\t\tv1 = vertex.index << 1;\r\n\t\t\tuvs[v1++] = vertex.s;\r\n\t\t\tuvs[v1] = vertex.t;\r\n\t\t}\r\n\r\n\t\tsubGeom.jointsPerVertex = this._maxJointCount;\r\n\t\tsubGeom.updateIndices(indices);\r\n\t\tsubGeom.updatePositions(vertices);\r\n\t\tsubGeom.updateUVs(uvs);\r\n\t\tsubGeom.updateJointIndices(jointIndices);\r\n\t\tsubGeom.updateJointWeights(jointWeights);\r\n\t\t// cause explicit updates\r\n\t\tsubGeom.vertexNormals;\r\n\t\tsubGeom.vertexTangents;\r\n\t\t// turn auto updates off because they may be animated and set explicitly\r\n\t\tsubGeom.autoDeriveTangents = false;\r\n\t\tsubGeom.autoDeriveNormals = false;\r\n\r\n\t\treturn subGeom;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve the next triplet of vertex indices that form a face.\r\n\t * @param indices The index list in which to store the read data.\r\n\t */\r\n\tprivate parseTri(indices:Array<number> /*uint*/):void\r\n\t{\r\n\t\tvar index:number /*int*/ = this.getNextInt()*3;\r\n\t\tindices[index] = this.getNextInt();\r\n\t\tindices[index + 1] = this.getNextInt();\r\n\t\tindices[index + 2] = this.getNextInt();\r\n\t}\r\n\r\n\t/**\r\n\t * Reads a new joint data set for a single joint.\r\n\t * @param weights the target list to contain the weight data.\r\n\t */\r\n\tprivate parseJoint(weights:Array<JointData>):void\r\n\t{\r\n\t\tvar weight:JointData = new JointData();\r\n\t\tweight.index = this.getNextInt();\r\n\t\tweight.joint = this.getNextInt();\r\n\t\tweight.bias = this.getNextNumber();\r\n\t\tweight.pos = this.parseVector3D();\r\n\t\tweights[weight.index] = weight;\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the data for a single vertex.\r\n\t * @param vertexData The list to contain the vertex data.\r\n\t */\r\n\tprivate parseVertex(vertexData:Array<VertexData>):void\r\n\t{\r\n\t\tvar vertex:VertexData = new VertexData();\r\n\t\tvertex.index = this.getNextInt();\r\n\t\tthis.parseUV(vertex);\r\n\t\tvertex.startWeight = this.getNextInt();\r\n\t\tvertex.countWeight = this.getNextInt();\r\n\t\t//\t\t\tif (vertex.countWeight > _maxJointCount) _maxJointCount = vertex.countWeight;\r\n\t\tvertexData[vertex.index] = vertex;\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the next uv coordinate.\r\n\t * @param vertexData The vertexData to contain the UV coordinates.\r\n\t */\r\n\tprivate parseUV(vertexData:VertexData):void\r\n\t{\r\n\t\tvar ch:string = this.getNextToken();\r\n\t\tif (ch != \"(\")\r\n\t\t\tthis.sendParseError(\"(\");\r\n\t\tvertexData.s = this.getNextNumber();\r\n\t\tvertexData.t = this.getNextNumber();\r\n\r\n\t\tif (this.getNextToken() != \")\")\r\n\t\t\tthis.sendParseError(\")\");\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the next token in the data stream.\r\n\t */\r\n\tprivate getNextToken():string\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar token:string = \"\";\r\n\r\n\t\twhile (!this._reachedEOF) {\r\n\t\t\tch = this.getNextChar();\r\n\t\t\tif (ch == \" \" || ch == \"\\r\" || ch == \"\\n\" || ch == \"\\t\") {\r\n\t\t\t\tif (token != MD5MeshParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.skipWhiteSpace();\r\n\t\t\t\tif (token != \"\")\r\n\t\t\t\t\treturn token;\r\n\t\t\t} else\r\n\t\t\t\ttoken += ch;\r\n\r\n\t\t\tif (token == MD5MeshParser.COMMENT_TOKEN)\r\n\t\t\t\treturn token;\r\n\t\t}\r\n\r\n\t\treturn token;\r\n\t}\r\n\r\n\t/**\r\n\t * Skips all whitespace in the data stream.\r\n\t */\r\n\tprivate skipWhiteSpace():void\r\n\t{\r\n\t\tvar ch:string;\r\n\r\n\t\tdo\r\n\t\t\tch = this.getNextChar(); while (ch == \"\\n\" || ch == \" \" || ch == \"\\r\" || ch == \"\\t\");\r\n\r\n\t\tthis.putBack();\r\n\t}\r\n\r\n\t/**\r\n\t * Skips to the next line.\r\n\t */\r\n\tprivate ignoreLine():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\twhile (!this._reachedEOF && ch != \"\\n\")\r\n\t\t\tch = this.getNextChar();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next single character in the data stream.\r\n\t */\r\n\tprivate getNextChar():string\r\n\t{\r\n\t\tvar ch:string = this._textData.charAt(this._parseIndex++);\r\n\r\n\t\tif (ch == \"\\n\") {\r\n\t\t\t++this._line;\r\n\t\t\tthis._charLineIndex = 0;\r\n\t\t} else if (ch != \"\\r\")\r\n\t\t\t++this._charLineIndex;\r\n\r\n\t\tif (this._parseIndex >= this._textData.length)\r\n\t\t\tthis._reachedEOF = true;\r\n\r\n\t\treturn ch;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next integer in the data stream.\r\n\t */\r\n\tprivate getNextInt():number /*int*/\r\n\t{\r\n\t\tvar i:number = parseInt(this.getNextToken());\r\n\t\tif (isNaN(i))\r\n\t\t\tthis.sendParseError(\"int type\");\r\n\t\treturn i;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next floating point number in the data stream.\r\n\t */\r\n\tprivate getNextNumber():number\r\n\t{\r\n\t\tvar f:number = parseFloat(this.getNextToken());\r\n\t\tif (isNaN(f))\r\n\t\t\tthis.sendParseError(\"float type\");\r\n\t\treturn f;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next 3d vector in the data stream.\r\n\t */\r\n\tprivate parseVector3D():Vector3D\r\n\t{\r\n\t\tvar vec:Vector3D = new Vector3D();\r\n\t\tvar ch:string = this.getNextToken();\r\n\r\n\t\tif (ch != \"(\")\r\n\t\t\tthis.sendParseError(\"(\");\r\n\t\tvec.x = -this.getNextNumber();\r\n\t\tvec.y = this.getNextNumber();\r\n\t\tvec.z = this.getNextNumber();\r\n\r\n\t\tif (this.getNextToken() != \")\")\r\n\t\t\tthis.sendParseError(\")\");\r\n\r\n\t\treturn vec;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next quaternion in the data stream.\r\n\t */\r\n\tprivate parseQuaternion():Quaternion\r\n\t{\r\n\t\tvar quat:Quaternion = new Quaternion();\r\n\t\tvar ch:string = this.getNextToken();\r\n\r\n\t\tif (ch != \"(\")\r\n\t\t\tthis.sendParseError(\"(\");\r\n\t\tquat.x = this.getNextNumber();\r\n\t\tquat.y = -this.getNextNumber();\r\n\t\tquat.z = -this.getNextNumber();\r\n\r\n\t\t// quat supposed to be unit length\r\n\t\tvar t:number = 1 - quat.x*quat.x - quat.y*quat.y - quat.z*quat.z;\r\n\t\tquat.w = t < 0? 0 : -Math.sqrt(t);\r\n\r\n\t\tif (this.getNextToken() != \")\")\r\n\t\t\tthis.sendParseError(\")\");\r\n\r\n\t\tvar rotQuat:Quaternion = new Quaternion();\r\n\t\trotQuat.multiply(this._rotationQuat, quat);\r\n\t\treturn rotQuat;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the command line data.\r\n\t */\r\n\tprivate parseCMD():void\r\n\t{\r\n\t\t// just ignore the command line property\r\n\t\tthis.parseLiteralstring();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next literal string in the data stream. A literal string is a sequence of characters bounded\r\n\t * by double quotes.\r\n\t */\r\n\tprivate parseLiteralstring():string\r\n\t{\r\n\t\tthis.skipWhiteSpace();\r\n\r\n\t\tvar ch:string = this.getNextChar();\r\n\t\tvar str:string = \"\";\r\n\r\n\t\tif (ch != \"\\\"\")\r\n\t\t\tthis.sendParseError(\"\\\"\");\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tch = this.getNextChar();\r\n\t\t\tif (ch != \"\\\"\")\r\n\t\t\t\tstr += ch;\r\n\t\t} while (ch != \"\\\"\");\r\n\r\n\t\treturn str;\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an end-of-file error when a premature end of file was encountered.\r\n\t */\r\n\tprivate sendEOFError():void\r\n\t{\r\n\t\tthrow new Error(\"Unexpected end of file\");\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an error when an unexpected token was encountered.\r\n\t * @param expected The token type that was actually expected.\r\n\t */\r\n\tprivate sendParseError(expected:string):void\r\n\t{\r\n\t\tthrow new Error(\"Unexpected token at line \" + (this._line + 1) + \", character \" + this._charLineIndex + \". \" + expected + \" expected, but \" + this._textData.charAt(this._parseIndex - 1) + \" encountered\");\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an error when an unknown keyword was encountered.\r\n\t */\r\n\tprivate sendUnknownKeywordError():void\r\n\t{\r\n\t\tthrow new Error(\"Unknown keyword at line \" + (this._line + 1) + \", character \" + this._charLineIndex + \". \");\r\n\t}\r\n}\r\n\r\nexport = MD5MeshParser;\r\n\r\n\r\nclass VertexData\r\n{\r\n\tpublic index:number /*int*/;\r\n\tpublic s:number;\r\n\tpublic t:number;\r\n\tpublic startWeight:number /*int*/;\r\n\tpublic countWeight:number /*int*/;\r\n}\r\n\r\nclass JointData\r\n{\r\n\tpublic index:number /*int*/;\r\n\tpublic joint:number /*int*/;\r\n\tpublic bias:number;\r\n\tpublic pos:Vector3D;\r\n}\r\n\r\nclass MeshData\r\n{\r\n\tpublic vertexData:Array<VertexData>;\r\n\tpublic weightData:Array<JointData>;\r\n\tpublic indices:Array<number> /*uint*/;\r\n}","import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport AssetType\t\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\nimport TextureProxyBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-renderergl/lib/managers/DefaultMaterialManager\");\r\n\r\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\r\n\r\n/**\r\n * Max3DSParser provides a parser for the 3ds data type.\r\n */\r\nclass Max3DSParser extends ParserBase\r\n{\r\n\tprivate _byteData:ByteArray;\r\n\r\n\tprivate _textures:Object;\r\n\tprivate _materials:Object;\r\n\tprivate _unfinalized_objects:Object;\r\n\r\n\tprivate _cur_obj_end:number;\r\n\tprivate _cur_obj:ObjectVO;\r\n\r\n\tprivate _cur_mat_end:number;\r\n\tprivate _cur_mat:MaterialVO;\r\n\tprivate _useSmoothingGroups:boolean;\r\n\r\n\t/**\r\n\t * Creates a new <code>Max3DSParser</code> object.\r\n\t *\r\n\t * @param useSmoothingGroups Determines whether the parser looks for smoothing groups in the 3ds file or assumes uniform smoothing. Defaults to true.\r\n\t */\r\n\tconstructor(useSmoothingGroups:boolean = true)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.ARRAY_BUFFER);\r\n\r\n\t\tthis._useSmoothingGroups = useSmoothingGroups;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"3ds\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\tvar ba:ByteArray;\r\n\r\n\t\tba = ParserUtils.toByteArray(data);\r\n\t\tif (ba) {\r\n\t\t\tba.position = 0;\r\n\t\t\tif (ba.readShort() == 0x4d4d)\r\n\t\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency):void\r\n\t{\r\n\t\tif (resourceDependency.assets.length == 1) {\r\n\t\t\tvar asset:IAsset;\r\n\r\n\t\t\tasset = resourceDependency.assets[0];\r\n\t\t\tif (asset.assetType == AssetType.TEXTURE) {\r\n\t\t\t\tvar tex:TextureVO;\r\n\r\n\t\t\t\ttex = this._textures[resourceDependency.id];\r\n\t\t\t\ttex.texture = <Texture2DBase> asset;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency):void\r\n\t{\r\n\t\t// TODO: Implement\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tif (!this._byteData) {\r\n\t\t\tthis._byteData = this._pGetByteData();\r\n\t\t\tthis._byteData.position = 0;\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t//this._byteData.endian = Endian.LITTLE_ENDIAN;// Should be default\r\n\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t\tthis._textures = {};\r\n\t\t\tthis._materials = {};\r\n\t\t\tthis._unfinalized_objects = {};\r\n\t\t}\r\n\r\n\t\t// TODO: With this construct, the loop will run no-op for as long\r\n\t\t// as there is time once file has finished reading. Consider a nice\r\n\t\t// way to stop loop when byte array is empty, without putting it in\r\n\t\t// the while-conditional, which will prevent finalizations from\r\n\t\t// happening after the last chunk.\r\n\t\twhile (this._pHasTime()) {\r\n\r\n\t\t\t// If we are currently working on an object, and the most recent chunk was\r\n\t\t\t// the last one in that object, finalize the current object.\r\n\t\t\tif (this._cur_mat && this._byteData.position >= this._cur_mat_end)\r\n\t\t\t\tthis.finalizeCurrentMaterial();\r\n\t\t\telse if (this._cur_obj && this._byteData.position >= this._cur_obj_end) {\r\n\t\t\t\t// Can't finalize at this point, because we have to wait until the full\r\n\t\t\t\t// animation section has been parsed for any potential pivot definitions\r\n\t\t\t\tthis._unfinalized_objects[this._cur_obj.name] = this._cur_obj;\r\n\t\t\t\tthis._cur_obj_end = Number.MAX_VALUE /*uint*/;\r\n\t\t\t\tthis._cur_obj = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (this._byteData.getBytesAvailable() > 0) {\r\n\t\t\t\tvar cid:number /*uint*/;\r\n\t\t\t\tvar len:number /*uint*/;\r\n\t\t\t\tvar end:number /*uint*/;\r\n\r\n\t\t\t\tcid = this._byteData.readUnsignedShort();\r\n\t\t\t\tlen = this._byteData.readUnsignedInt();\r\n\t\t\t\tend = this._byteData.position + (len - 6);\r\n\r\n\t\t\t\tswitch (cid) {\r\n\t\t\t\t\tcase 0x4D4D: // MAIN3DS\r\n\t\t\t\t\tcase 0x3D3D: // EDIT3DS\r\n\t\t\t\t\tcase 0xB000: // KEYF3DS\r\n\t\t\t\t\t\t// This types are \"container chunks\" and contain only\r\n\t\t\t\t\t\t// sub-chunks (no data on their own.) This means that\r\n\t\t\t\t\t\t// there is nothing more to parse at this point, and\r\n\t\t\t\t\t\t// instead we should progress to the next chunk, which\r\n\t\t\t\t\t\t// will be the first sub-chunk of this one.\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0xAFFF: // MATERIAL\r\n\t\t\t\t\t\tthis._cur_mat_end = end;\r\n\t\t\t\t\t\tthis._cur_mat = this.parseMaterial();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4000: // EDIT_OBJECT\r\n\t\t\t\t\t\tthis._cur_obj_end = end;\r\n\t\t\t\t\t\tthis._cur_obj = new ObjectVO();\r\n\t\t\t\t\t\tthis._cur_obj.name = this.readNulTermstring();\r\n\t\t\t\t\t\tthis._cur_obj.materials = new Array<string>();\r\n\t\t\t\t\t\tthis._cur_obj.materialFaces = {};\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4100: // OBJ_TRIMESH\r\n\t\t\t\t\t\tthis._cur_obj.type = AssetType.MESH;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4110: // TRI_VERTEXL\r\n\t\t\t\t\t\tthis.parseVertexList();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4120: // TRI_FACELIST\r\n\t\t\t\t\t\tthis.parseFaceList();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4140: // TRI_MAPPINGCOORDS\r\n\t\t\t\t\t\tthis.parseUVList();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4130: // Face materials\r\n\t\t\t\t\t\tthis.parseFaceMaterialList();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4160: // Transform\r\n\t\t\t\t\t\tthis._cur_obj.transform = this.readTransform();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0xB002: // Object animation (including pivot)\r\n\t\t\t\t\t\tthis.parseObjectAnimation(end);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4150: // Smoothing groups\r\n\t\t\t\t\t\tthis.parseSmoothingGroups();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t// Skip this (unknown) chunk\r\n\t\t\t\t\t\tthis._byteData.position += (len - 6);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Pause parsing if there were any dependencies found during this\r\n\t\t\t\t// iteration (i.e. if there are any dependencies that need to be\r\n\t\t\t\t// retrieved at this time.)\r\n\t\t\t\tif (this.dependencies.length) {\r\n\t\t\t\t\tthis._pPauseAndRetrieveDependencies();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// More parsing is required if the entire byte array has not yet\r\n\t\t// been read, or if there is a currently non-finalized object in\r\n\t\t// the pipeline.\r\n\t\tif (this._byteData.getBytesAvailable() || this._cur_obj || this._cur_mat) {\r\n\t\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t\t} else {\r\n\t\t\tvar name:string;\r\n\r\n\t\t\t// Finalize any remaining objects before ending.\r\n\t\t\tfor (name in this._unfinalized_objects) {\r\n\t\t\t\tvar obj:DisplayObjectContainer;\r\n\t\t\t\tobj = this.constructObject(this._unfinalized_objects[name]);\r\n\t\t\t\tif (obj) {\r\n\t\t\t\t\t//add to the content property\r\n\t\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild(obj);\r\n\r\n\t\t\t\t\tthis._pFinalizeAsset(obj, name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn ParserBase.PARSING_DONE;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\t}\r\n\r\n\tprivate parseMaterial():MaterialVO\r\n\t{\r\n\t\tvar mat:MaterialVO;\r\n\r\n\t\tmat = new MaterialVO();\r\n\r\n\t\twhile (this._byteData.position < this._cur_mat_end) {\r\n\t\t\tvar cid:number /*uint*/;\r\n\t\t\tvar len:number /*uint*/;\r\n\t\t\tvar end:number /*uint*/;\r\n\r\n\t\t\tcid = this._byteData.readUnsignedShort();\r\n\t\t\tlen = this._byteData.readUnsignedInt();\r\n\t\t\tend = this._byteData.position + (len - 6);\r\n\r\n\t\t\tswitch (cid) {\r\n\t\t\t\tcase 0xA000: // Material name\r\n\t\t\t\t\tmat.name = this.readNulTermstring();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA010: // Ambient color\r\n\t\t\t\t\tmat.ambientColor = this.readColor();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA020: // Diffuse color\r\n\t\t\t\t\tmat.diffuseColor = this.readColor();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA030: // Specular color\r\n\t\t\t\t\tmat.specularColor = this.readColor();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA081: // Two-sided, existence indicates \"true\"\r\n\t\t\t\t\tmat.twoSided = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA200: // Main (color) texture\r\n\t\t\t\t\tmat.colorMap = this.parseTexture(end);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA204: // Specular map\r\n\t\t\t\t\tmat.specularMap = this.parseTexture(end);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis._byteData.position = end;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn mat;\r\n\t}\r\n\r\n\tprivate parseTexture(end:number /*uint*/):TextureVO\r\n\t{\r\n\t\tvar tex:TextureVO;\r\n\r\n\t\ttex = new TextureVO();\r\n\r\n\t\twhile (this._byteData.position < end) {\r\n\t\t\tvar cid:number /*uint*/;\r\n\t\t\tvar len:number /*uint*/;\r\n\r\n\t\t\tcid = this._byteData.readUnsignedShort();\r\n\t\t\tlen = this._byteData.readUnsignedInt();\r\n\r\n\t\t\tswitch (cid) {\r\n\t\t\t\tcase 0xA300:\r\n\t\t\t\t\ttex.url = this.readNulTermstring();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\t// Skip this unknown texture sub-chunk\r\n\t\t\t\t\tthis._byteData.position += (len - 6);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._textures[tex.url] = tex;\r\n\t\tthis._pAddDependency(tex.url, new URLRequest(tex.url));\r\n\r\n\t\treturn tex;\r\n\t}\r\n\r\n\tprivate parseVertexList():void\r\n\t{\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar len:number /*uint*/;\r\n\t\tvar count:number /*uint*/;\r\n\r\n\t\tcount = this._byteData.readUnsignedShort();\r\n\t\tthis._cur_obj.verts = new Array<number>(count*3);\r\n\r\n\t\ti = 0;\r\n\t\tlen = this._cur_obj.verts.length;\r\n\t\twhile (i < len) {\r\n\t\t\tvar x:number, y:number, z:number;\r\n\r\n\t\t\tx = this._byteData.readFloat();\r\n\t\t\ty = this._byteData.readFloat();\r\n\t\t\tz = this._byteData.readFloat();\r\n\r\n\t\t\tthis._cur_obj.verts[i++] = x;\r\n\t\t\tthis._cur_obj.verts[i++] = z;\r\n\t\t\tthis._cur_obj.verts[i++] = y;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate parseFaceList():void\r\n\t{\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar len:number /*uint*/;\r\n\t\tvar count:number /*uint*/;\r\n\r\n\t\tcount = this._byteData.readUnsignedShort();\r\n\t\tthis._cur_obj.indices = new Array<number>(count*3) /*uint*/;\r\n\r\n\t\ti = 0;\r\n\t\tlen = this._cur_obj.indices.length;\r\n\t\twhile (i < len) {\r\n\t\t\tvar i0:number /*uint*/, i1:number /*uint*/, i2:number /*uint*/;\r\n\r\n\t\t\ti0 = this._byteData.readUnsignedShort();\r\n\t\t\ti1 = this._byteData.readUnsignedShort();\r\n\t\t\ti2 = this._byteData.readUnsignedShort();\r\n\r\n\t\t\tthis._cur_obj.indices[i++] = i0;\r\n\t\t\tthis._cur_obj.indices[i++] = i2;\r\n\t\t\tthis._cur_obj.indices[i++] = i1;\r\n\r\n\t\t\t// Skip \"face info\", irrelevant in Away3D\r\n\t\t\tthis._byteData.position += 2;\r\n\t\t}\r\n\r\n\t\tthis._cur_obj.smoothingGroups = new Array<number>(count) /*uint*/;\r\n\t}\r\n\r\n\tprivate parseSmoothingGroups():void\r\n\t{\r\n\t\tvar len:number /*uint*/ = this._cur_obj.indices.length/3;\r\n\t\tvar i:number /*uint*/ = 0;\r\n\t\twhile (i < len) {\r\n\t\t\tthis._cur_obj.smoothingGroups[i] = this._byteData.readUnsignedInt();\r\n\t\t\ti++;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate parseUVList():void\r\n\t{\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar len:number /*uint*/;\r\n\t\tvar count:number /*uint*/;\r\n\r\n\t\tcount = this._byteData.readUnsignedShort();\r\n\t\tthis._cur_obj.uvs = new Array<number>(count*2);\r\n\r\n\t\ti = 0;\r\n\t\tlen = this._cur_obj.uvs.length;\r\n\t\twhile (i < len) {\r\n\t\t\tthis._cur_obj.uvs[i++] = this._byteData.readFloat();\r\n\t\t\tthis._cur_obj.uvs[i++] = 1.0 - this._byteData.readFloat();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate parseFaceMaterialList():void\r\n\t{\r\n\t\tvar mat:string;\r\n\t\tvar count:number /*uint*/;\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar faces:Array<number> /*uint*/;\r\n\r\n\t\tmat = this.readNulTermstring();\r\n\t\tcount = this._byteData.readUnsignedShort();\r\n\r\n\t\tfaces = new Array<number>(count) /*uint*/;\r\n\t\ti = 0;\r\n\t\twhile (i < faces.length)\r\n\t\t\tfaces[i++] = this._byteData.readUnsignedShort();\r\n\r\n\t\tthis._cur_obj.materials.push(mat);\r\n\t\tthis._cur_obj.materialFaces[mat] = faces;\r\n\t}\r\n\r\n\tprivate parseObjectAnimation(end:number):void\r\n\t{\r\n\t\tvar vo:ObjectVO;\r\n\t\tvar obj:DisplayObjectContainer;\r\n\t\tvar pivot:Vector3D;\r\n\t\tvar name:string;\r\n\t\tvar hier:number /*uint*/;\r\n\r\n\t\t// Pivot defaults to origin\r\n\t\tpivot = new Vector3D;\r\n\r\n\t\twhile (this._byteData.position < end) {\r\n\t\t\tvar cid:number /*uint*/;\r\n\t\t\tvar len:number /*uint*/;\r\n\r\n\t\t\tcid = this._byteData.readUnsignedShort();\r\n\t\t\tlen = this._byteData.readUnsignedInt();\r\n\r\n\t\t\tswitch (cid) {\r\n\t\t\t\tcase 0xb010: // Name/hierarchy\r\n\t\t\t\t\tname = this.readNulTermstring();\r\n\t\t\t\t\tthis._byteData.position += 4;\r\n\t\t\t\t\thier = this._byteData.readShort();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xb013: // Pivot\r\n\t\t\t\t\tpivot.x = this._byteData.readFloat();\r\n\t\t\t\t\tpivot.z = this._byteData.readFloat();\r\n\t\t\t\t\tpivot.y = this._byteData.readFloat();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis._byteData.position += (len - 6);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// If name is \"$$$DUMMY\" this is an empty object (e.g. a container)\r\n\t\t// and will be ignored in this version of the parser\r\n\t\t// TODO: Implement containers in 3DS parser.\r\n\t\tif (name != '$$$DUMMY' && this._unfinalized_objects.hasOwnProperty(name)) {\r\n\t\t\tvo = this._unfinalized_objects[name];\r\n\t\t\tobj = this.constructObject(vo, pivot);\r\n\r\n\t\t\tif (obj) {\r\n\t\t\t\t//add to the content property\r\n\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild(obj);\r\n\r\n\t\t\t\tthis._pFinalizeAsset(obj, vo.name);\r\n\t\t\t}\r\n\r\n\r\n\t\t\tdelete this._unfinalized_objects[name];\r\n\t\t}\r\n\t}\r\n\r\n\tprivate constructObject(obj:ObjectVO, pivot:Vector3D = null):DisplayObjectContainer\r\n\t{\r\n\t\tif (obj.type == AssetType.MESH) {\r\n\t\t\tvar i:number /*uint*/;\r\n\t\t\tvar sub:TriangleSubGeometry;\r\n\t\t\tvar geom:Geometry;\r\n\t\t\tvar mat:MaterialBase;\r\n\t\t\tvar mesh:Mesh;\r\n\t\t\tvar mtx:Matrix3D;\r\n\t\t\tvar vertices:Array<VertexVO>;\r\n\t\t\tvar faces:Array<FaceVO>;\r\n\r\n\t\t\tif (obj.materials.length > 1)\r\n\t\t\t\tconsole.log(\"The Away3D 3DS parser does not support multiple materials per mesh at this point.\");\r\n\r\n\t\t\t// Ignore empty objects\r\n\t\t\tif (!obj.indices || obj.indices.length == 0)\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tvertices = new Array<VertexVO>(obj.verts.length/3);\r\n\t\t\tfaces = new Array<FaceVO>(obj.indices.length/3);\r\n\r\n\t\t\tthis.prepareData(vertices, faces, obj);\r\n\r\n\t\t\tif (this._useSmoothingGroups)\r\n\t\t\t\tthis.applySmoothGroups(vertices, faces);\r\n\r\n\t\t\tobj.verts = new Array<number>(vertices.length*3);\r\n\t\t\tfor (i = 0; i < vertices.length; i++) {\r\n\t\t\t\tobj.verts[i*3] = vertices[i].x;\r\n\t\t\t\tobj.verts[i*3 + 1] = vertices[i].y;\r\n\t\t\t\tobj.verts[i*3 + 2] = vertices[i].z;\r\n\t\t\t}\r\n\t\t\tobj.indices = new Array<number>(faces.length*3) /*uint*/;\r\n\r\n\t\t\tfor (i = 0; i < faces.length; i++) {\r\n\t\t\t\tobj.indices[i*3] = faces[i].a;\r\n\t\t\t\tobj.indices[i*3 + 1] = faces[i].b;\r\n\t\t\t\tobj.indices[i*3 + 2] = faces[i].c;\r\n\t\t\t}\r\n\r\n\t\t\tif (obj.uvs) {\r\n\t\t\t\t// If the object had UVs to start with, use UVs generated by\r\n\t\t\t\t// smoothing group splitting algorithm. Otherwise those UVs\r\n\t\t\t\t// will be nonsense and should be skipped.\r\n\t\t\t\tobj.uvs = new Array<number>(vertices.length*2);\r\n\t\t\t\tfor (i = 0; i < vertices.length; i++) {\r\n\t\t\t\t\tobj.uvs[i*2] = vertices[i].u;\r\n\t\t\t\t\tobj.uvs[i*2 + 1] = vertices[i].v;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tgeom = new Geometry();\r\n\r\n\t\t\t// Construct sub-geometries (potentially splitting buffers)\r\n\t\t\t// and add them to geometry.\r\n\t\t\tsub = new TriangleSubGeometry(true);\r\n\t\t\tsub.updateIndices(obj.indices);\r\n\t\t\tsub.updatePositions(obj.verts);\r\n\t\t\tsub.updateUVs(obj.uvs);\r\n\r\n\t\t\tgeom.addSubGeometry(sub);\r\n\r\n\t\t\tif (obj.materials.length > 0) {\r\n\t\t\t\tvar mname:string;\r\n\t\t\t\tmname = obj.materials[0];\r\n\t\t\t\tmat = this._materials[mname].material;\r\n\t\t\t}\r\n\r\n\t\t\t// Apply pivot translation to geometry if a pivot was\r\n\t\t\t// found while parsing the keyframe chunk earlier.\r\n\t\t\tif (pivot) {\r\n\t\t\t\tif (obj.transform) {\r\n\t\t\t\t\t// If a transform was found while parsing the\r\n\t\t\t\t\t// object chunk, use it to find the local pivot vector\r\n\t\t\t\t\tvar dat:Array<number> = obj.transform.concat();\r\n\t\t\t\t\tdat[12] = 0;\r\n\t\t\t\t\tdat[13] = 0;\r\n\t\t\t\t\tdat[14] = 0;\r\n\t\t\t\t\tmtx = new Matrix3D(dat);\r\n\t\t\t\t\tpivot = mtx.transformVector(pivot);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpivot.scaleBy(-1);\r\n\r\n\t\t\t\tmtx = new Matrix3D();\r\n\t\t\t\tmtx.appendTranslation(pivot.x, pivot.y, pivot.z);\r\n\t\t\t\tgeom.applyTransformation(mtx);\r\n\t\t\t}\r\n\r\n\t\t\t// Apply transformation to geometry if a transformation\r\n\t\t\t// was found while parsing the object chunk earlier.\r\n\t\t\tif (obj.transform) {\r\n\t\t\t\tmtx = new Matrix3D(obj.transform);\r\n\t\t\t\tmtx.invert();\r\n\t\t\t\tgeom.applyTransformation(mtx);\r\n\t\t\t}\r\n\r\n\t\t\t// Final transform applied to geometry. Finalize the geometry,\r\n\t\t\t// which will no longer be modified after this point.\r\n\t\t\tthis._pFinalizeAsset(geom, obj.name.concat('_geom'));\r\n\r\n\t\t\t// Build mesh and return it\r\n\t\t\tmesh = new Mesh(geom, mat);\r\n\t\t\tmesh.transform.matrix3D = new Matrix3D(obj.transform);\r\n\t\t\treturn mesh;\r\n\t\t}\r\n\r\n\t\t// If reached, unknown\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprivate prepareData(vertices:Array<VertexVO>, faces:Array<FaceVO>, obj:ObjectVO):void\r\n\t{\r\n\t\t// convert raw ObjectVO's data to structured VertexVO and FaceVO\r\n\t\tvar i:number /*int*/;\r\n\t\tvar j:number /*int*/;\r\n\t\tvar k:number /*int*/;\r\n\t\tvar len:number /*int*/ = obj.verts.length;\r\n\t\tfor (i = 0, j = 0, k = 0; i < len;) {\r\n\t\t\tvar v:VertexVO = new VertexVO;\r\n\t\t\tv.x = obj.verts[i++];\r\n\t\t\tv.y = obj.verts[i++];\r\n\t\t\tv.z = obj.verts[i++];\r\n\t\t\tif (obj.uvs) {\r\n\t\t\t\tv.u = obj.uvs[j++];\r\n\t\t\t\tv.v = obj.uvs[j++];\r\n\t\t\t}\r\n\t\t\tvertices[k++] = v;\r\n\t\t}\r\n\t\tlen = obj.indices.length;\r\n\t\tfor (i = 0, k = 0; i < len;) {\r\n\t\t\tvar f:FaceVO = new FaceVO();\r\n\t\t\tf.a = obj.indices[i++];\r\n\t\t\tf.b = obj.indices[i++];\r\n\t\t\tf.c = obj.indices[i++];\r\n\t\t\tf.smoothGroup = obj.smoothingGroups[k] || 0;\r\n\t\t\tfaces[k++] = f;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate applySmoothGroups(vertices:Array<VertexVO>, faces:Array<FaceVO>):void\r\n\t{\r\n\t\t// clone vertices according to following rule:\r\n\t\t// clone if vertex's in faces from groups 1+2 and 3\r\n\t\t// don't clone if vertex's in faces from groups 1+2, 3 and 1+3\r\n\r\n\t\tvar i:number /*int*/;\r\n\t\tvar j:number /*int*/;\r\n\t\tvar k:number /*int*/;\r\n\t\tvar l:number /*int*/;\r\n\t\tvar len:number /*int*/;\r\n\t\tvar numVerts:number /*uint*/ = vertices.length;\r\n\t\tvar numFaces:number /*uint*/ = faces.length;\r\n\r\n\t\t// extract groups data for vertices\r\n\t\tvar vGroups:Array<Array<number>> /*uint*/ = new Array<Array<number>>(numVerts) /*uint*/;\r\n\t\tfor (i = 0; i < numVerts; i++)\r\n\t\t\tvGroups[i] = new Array<number>() /*uint*/;\r\n\t\tfor (i = 0; i < numFaces; i++) {\r\n\t\t\tvar face:FaceVO = faces[i];\r\n\t\t\tfor (j = 0; j < 3; j++) {\r\n\t\t\t\tvar groups:Array<number> /*uint*/ = vGroups[(j == 0)? face.a : ((j == 1)? face.b : face.c)];\r\n\t\t\t\tvar group:number /*uint*/ = face.smoothGroup;\r\n\t\t\t\tfor (k = groups.length - 1; k >= 0; k--) {\r\n\t\t\t\t\tif ((group & groups[k]) > 0) {\r\n\t\t\t\t\t\tgroup |= groups[k];\r\n\t\t\t\t\t\tgroups.splice(k, 1);\r\n\t\t\t\t\t\tk = groups.length - 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tgroups.push(group);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// clone vertices\r\n\t\tvar vClones:Array<Array<number>> /*uint*/ = new Array<Array<number>>(numVerts) /*uint*/;\r\n\t\tfor (i = 0; i < numVerts; i++) {\r\n\t\t\tif ((len = vGroups[i].length) < 1)\r\n\t\t\t\tcontinue;\r\n\t\t\tvar clones:Array<number> /*uint*/ = new Array<number>(len) /*uint*/;\r\n\t\t\tvClones[i] = clones;\r\n\t\t\tclones[0] = i;\r\n\t\t\tvar v0:VertexVO = vertices[i];\r\n\t\t\tfor (j = 1; j < len; j++) {\r\n\t\t\t\tvar v1:VertexVO = new VertexVO;\r\n\t\t\t\tv1.x = v0.x;\r\n\t\t\t\tv1.y = v0.y;\r\n\t\t\t\tv1.z = v0.z;\r\n\t\t\t\tv1.u = v0.u;\r\n\t\t\t\tv1.v = v0.v;\r\n\t\t\t\tclones[j] = vertices.length;\r\n\t\t\t\tvertices.push(v1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tnumVerts = vertices.length;\r\n\r\n\t\tfor (i = 0; i < numFaces; i++) {\r\n\t\t\tface = faces[i];\r\n\t\t\tgroup = face.smoothGroup;\r\n\t\t\tfor (j = 0; j < 3; j++) {\r\n\t\t\t\tk = (j == 0)? face.a : ((j == 1)? face.b : face.c);\r\n\t\t\t\tgroups = vGroups[k];\r\n\t\t\t\tlen = groups.length;\r\n\t\t\t\tclones = vClones[k];\r\n\t\t\t\tfor (l = 0; l < len; l++) {\r\n\t\t\t\t\tif (((group == 0) && (groups[l] == 0)) || ((group & groups[l]) > 0)) {\r\n\t\t\t\t\t\tvar index:number /*uint*/ = clones[l];\r\n\t\t\t\t\t\tif (group == 0) {\r\n\t\t\t\t\t\t\t// vertex is unique if no smoothGroup found\r\n\t\t\t\t\t\t\tgroups.splice(l, 1);\r\n\t\t\t\t\t\t\tclones.splice(l, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (j == 0)\r\n\t\t\t\t\t\t\tface.a = index; else if (j == 1)\r\n\t\t\t\t\t\t\tface.b = index; else\r\n\t\t\t\t\t\t\tface.c = index;\r\n\t\t\t\t\t\tl = len;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate finalizeCurrentMaterial():void\r\n\t{\r\n\t\tvar mat:MethodMaterial;\r\n\r\n\t\tif (this._cur_mat.colorMap)\r\n\t\t\tmat = new MethodMaterial(this._cur_mat.colorMap.texture || DefaultMaterialManager.getDefaultTexture());\r\n\t\telse\r\n\t\t\tmat = new MethodMaterial(this._cur_mat.ambientColor);\r\n\r\n\t\tmat.diffuseColor = this._cur_mat.diffuseColor;\r\n\t\tmat.specularColor = this._cur_mat.specularColor;\r\n\r\n\t\tif (this.materialMode >= 2)\r\n\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS\r\n\r\n\t\tmat.bothSides = this._cur_mat.twoSided;\r\n\r\n\t\tthis._pFinalizeAsset(mat, this._cur_mat.name);\r\n\r\n\t\tthis._materials[this._cur_mat.name] = this._cur_mat;\r\n\t\tthis._cur_mat.material = mat;\r\n\r\n\t\tthis._cur_mat = null;\r\n\t}\r\n\r\n\tprivate readNulTermstring():string\r\n\t{\r\n\t\tvar chr:number /*int*/;\r\n\t\tvar str:string = \"\";\r\n\r\n\t\twhile ((chr = this._byteData.readUnsignedByte()) > 0)\r\n\t\t\tstr += String.fromCharCode(chr);\r\n\r\n\t\treturn str;\r\n\t}\r\n\r\n\tprivate readTransform():Array<number>\r\n\t{\r\n\t\tvar data:Array<number>;\r\n\r\n\t\tdata = new Array<number>(16);\r\n\r\n\t\t// X axis\r\n\t\tdata[0] = this._byteData.readFloat(); // X\r\n\t\tdata[2] = this._byteData.readFloat(); // Z\r\n\t\tdata[1] = this._byteData.readFloat(); // Y\r\n\t\tdata[3] = 0;\r\n\r\n\t\t// Z axis\r\n\t\tdata[8] = this._byteData.readFloat(); // X\r\n\t\tdata[10] = this._byteData.readFloat(); // Z\r\n\t\tdata[9] = this._byteData.readFloat(); // Y\r\n\t\tdata[11] = 0;\r\n\r\n\t\t// Y Axis\r\n\t\tdata[4] = this._byteData.readFloat(); // X\r\n\t\tdata[6] = this._byteData.readFloat(); // Z\r\n\t\tdata[5] = this._byteData.readFloat(); // Y\r\n\t\tdata[7] = 0;\r\n\r\n\t\t// Translation\r\n\t\tdata[12] = this._byteData.readFloat(); // X\r\n\t\tdata[14] = this._byteData.readFloat(); // Z\r\n\t\tdata[13] = this._byteData.readFloat(); // Y\r\n\t\tdata[15] = 1;\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate readColor():number /*int*/\r\n\t{\r\n\t\tvar cid:number /*int*/;\r\n\t\tvar len:number /*int*/;\r\n\t\tvar r:number /*int*/, g:number /*int*/, b:number /*int*/;\r\n\r\n\t\tcid = this._byteData.readUnsignedShort();\r\n\t\tlen = this._byteData.readUnsignedInt();\r\n\r\n\t\tswitch (cid) {\r\n\t\t\tcase 0x0010: // Floats\r\n\t\t\t\tr = this._byteData.readFloat()*255;\r\n\t\t\t\tg = this._byteData.readFloat()*255;\r\n\t\t\t\tb = this._byteData.readFloat()*255;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 0x0011: // 24-bit color\r\n\t\t\t\tr = this._byteData.readUnsignedByte();\r\n\t\t\t\tg = this._byteData.readUnsignedByte();\r\n\t\t\t\tb = this._byteData.readUnsignedByte();\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthis._byteData.position += (len - 6);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn (r << 16) | (g << 8) | b;\r\n\t}\r\n}\r\n\r\nexport = Max3DSParser;\r\n\r\n/**\r\n *\r\n */\r\nclass FaceVO\r\n{\r\n\tpublic a:number /*int*/;\r\n\tpublic b:number /*int*/;\r\n\tpublic c:number /*int*/;\r\n\tpublic smoothGroup:number /*int*/;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass MaterialVO\r\n{\r\n\tpublic name:string;\r\n\tpublic ambientColor:number /*int*/;\r\n\tpublic diffuseColor:number /*int*/;\r\n\tpublic specularColor:number /*int*/;\r\n\tpublic twoSided:boolean;\r\n\tpublic colorMap:TextureVO;\r\n\tpublic specularMap:TextureVO;\r\n\tpublic material:MaterialBase;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass ObjectVO\r\n{\r\n\tpublic name:string;\r\n\tpublic type:string;\r\n\tpublic pivotX:number;\r\n\tpublic pivotY:number;\r\n\tpublic pivotZ:number;\r\n\tpublic transform:Array<number>;\r\n\tpublic verts:Array<number>;\r\n\tpublic indices:Array<number> /*int*/;\r\n\tpublic uvs:Array<number>;\r\n\tpublic materialFaces:Object;\r\n\tpublic materials:Array<string>;\r\n\tpublic smoothingGroups:Array<number> /*int*/;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass TextureVO\r\n{\r\n\tpublic url:string;\r\n\tpublic texture:Texture2DBase;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass VertexVO\r\n{\r\n\tpublic x:number;\r\n\tpublic y:number;\r\n\tpublic z:number;\r\n\tpublic u:number;\r\n\tpublic v:number;\r\n\tpublic normal:Vector3D;\r\n\tpublic tangent:Vector3D;\r\n}","import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport AssetType\t\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\n\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-renderergl/lib/managers/DefaultMaterialManager\");\r\n\r\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\r\nimport SpecularBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularBasicMethod\");\r\n\r\n/**\r\n * OBJParser provides a parser for the OBJ data type.\r\n */\r\nclass OBJParser extends ParserBase\r\n{\r\n\tprivate _textData:string;\r\n\tprivate _startedParsing:boolean;\r\n\tprivate _charIndex:number;\r\n\tprivate _oldIndex:number;\r\n\tprivate _stringLength:number;\r\n\tprivate _currentObject:ObjectGroup;\r\n\tprivate _currentGroup:Group;\r\n\tprivate _currentMaterialGroup:MaterialGroup;\r\n\tprivate _objects:Array<ObjectGroup>;\r\n\tprivate _materialIDs:string[];\r\n\tprivate _materialLoaded:Array<LoadedMaterial>;\r\n\tprivate _materialSpecularData:Array<SpecularData>;\r\n\tprivate _meshes:Array<Mesh>;\r\n\tprivate _lastMtlID:string;\r\n\tprivate _objectIndex:number;\r\n\tprivate _realIndices;\r\n\tprivate _vertexIndex:number;\r\n\tprivate _vertices:Array<Vertex>;\r\n\tprivate _vertexNormals:Array<Vertex>;\r\n\tprivate _uvs:Array<UV>;\r\n\tprivate _scale:number;\r\n\tprivate _mtlLib:boolean;\r\n\tprivate _mtlLibLoaded:boolean = true;\r\n\tprivate _activeMaterialID:string = \"\";\r\n\r\n\t/**\r\n\t * Creates a new OBJParser object.\r\n\t * @param uri The url or id of the data or file to be parsed.\r\n\t * @param extra The holder for extra contextual data that the parser might need.\r\n\t */\r\n\tconstructor(scale:number = 1)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.TEXT);\r\n\t\tthis._scale = scale;\r\n\t}\r\n\r\n\t/**\r\n\t * Scaling factor applied directly to vertices data\r\n\t * @param value The scaling factor.\r\n\t */\r\n\tpublic set scale(value:number)\r\n\t{\r\n\t\tthis._scale = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"obj\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\tvar content:string = ParserUtils.toString(data);\r\n\t\tvar hasV:boolean = false;\r\n\t\tvar hasF:boolean = false;\r\n\r\n\t\tif (content) {\r\n\t\t\thasV = content.indexOf(\"\\nv \") != -1;\r\n\t\t\thasF = content.indexOf(\"\\nf \") != -1;\r\n\t\t}\r\n\r\n\t\treturn hasV && hasF;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\tif (resourceDependency.id == 'mtl') {\r\n\t\t\tvar str:string = ParserUtils.toString(resourceDependency.data);\r\n\t\t\tthis.parseMtl(str);\r\n\r\n\t\t} else {\r\n\t\t\tvar asset:IAsset;\r\n\r\n\t\t\tif (resourceDependency.assets.length != 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tasset = resourceDependency.assets[0];\r\n\r\n\t\t\tif (asset.assetType == AssetType.TEXTURE) {\r\n\r\n\t\t\t\tvar lm:LoadedMaterial = new LoadedMaterial();\r\n\t\t\t\tlm.materialID = resourceDependency.id;\r\n\t\t\t\tlm.texture = <Texture2DBase> asset;\r\n\r\n\t\t\t\tthis._materialLoaded.push(lm);\r\n\r\n\t\t\t\tif (this._meshes.length > 0) {\r\n\t\t\t\t\tthis.applyMaterial(lm);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\tif (resourceDependency.id == \"mtl\") {\r\n\t\t\tthis._mtlLib = false;\r\n\t\t\tthis._mtlLibLoaded = false;\r\n\t\t} else {\r\n\t\t\tvar lm:LoadedMaterial = new LoadedMaterial();\r\n\t\t\tlm.materialID = resourceDependency.id;\r\n\t\t\tthis._materialLoaded.push(lm);\r\n\t\t}\r\n\r\n\t\tif (this._meshes.length > 0)\r\n\t\t\tthis.applyMaterial(lm);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tvar line:string;\r\n\t\tvar creturn:string = String.fromCharCode(10);\r\n\t\tvar trunk;\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._textData = this._pGetTextData();\r\n\t\t\t// Merge linebreaks that are immediately preceeded by\r\n\t\t\t// the \"escape\" backward slash into single lines.\r\n\t\t\tthis._textData = this._textData.replace(/\\\\[\\r\\n]+\\s*/gm, ' ');\r\n\t\t}\r\n\r\n\t\tif (this._textData.indexOf(creturn) == -1)\r\n\t\t\tcreturn = String.fromCharCode(13);\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._startedParsing = true;\r\n\t\t\tthis._vertices = new Array<Vertex>();\r\n\t\t\tthis._vertexNormals = new Array<Vertex>();\r\n\t\t\tthis._materialIDs = new Array<string>();\r\n\t\t\tthis._materialLoaded = new Array<LoadedMaterial>();\r\n\t\t\tthis._meshes = new Array<Mesh>();\r\n\t\t\tthis._uvs = new Array<UV>();\r\n\t\t\tthis._stringLength = this._textData.length;\r\n\t\t\tthis._charIndex = this._textData.indexOf(creturn, 0);\r\n\t\t\tthis._oldIndex = 0;\r\n\t\t\tthis._objects = new Array<ObjectGroup>();\r\n\t\t\tthis._objectIndex = 0;\r\n\t\t}\r\n\r\n\t\twhile (this._charIndex < this._stringLength && this._pHasTime()) {\r\n\t\t\tthis._charIndex = this._textData.indexOf(creturn, this._oldIndex);\r\n\r\n\t\t\tif (this._charIndex == -1)\r\n\t\t\t\tthis._charIndex = this._stringLength;\r\n\r\n\t\t\tline = this._textData.substring(this._oldIndex, this._charIndex);\r\n\t\t\tline = line.split('\\r').join(\"\");\r\n\t\t\tline = line.replace(\"  \", \" \");\r\n\t\t\ttrunk = line.split(\" \");\r\n\t\t\tthis._oldIndex = this._charIndex + 1;\r\n\t\t\tthis.parseLine(trunk);\r\n\r\n\t\t\t// If whatever was parsed on this line resulted in the\r\n\t\t\t// parsing being paused to retrieve dependencies, break\r\n\t\t\t// here and do not continue parsing until un-paused.\r\n\t\t\tif (this.parsingPaused) {\r\n\t\t\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (this._charIndex >= this._stringLength) {\r\n\r\n\t\t\tif (this._mtlLib && !this._mtlLibLoaded) {\r\n\t\t\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t\t\t}\r\n\r\n\t\t\tthis.translate();\r\n\t\t\tthis.applyMaterials();\r\n\r\n\t\t\treturn ParserBase.PARSING_DONE;\r\n\t\t}\r\n\r\n\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\t}\r\n\r\n\t/**\r\n\t * Parses a single line in the OBJ file.\r\n\t */\r\n\tprivate parseLine(trunk)\r\n\t{\r\n\t\tswitch (trunk[0]) {\r\n\r\n\t\t\tcase \"mtllib\":\r\n\r\n\t\t\t\tthis._mtlLib = true;\r\n\t\t\t\tthis._mtlLibLoaded = false;\r\n\t\t\t\tthis.loadMtl(trunk[1]);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"g\":\r\n\r\n\t\t\t\tthis.createGroup(trunk);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"o\":\r\n\r\n\t\t\t\tthis.createObject(trunk);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"usemtl\":\r\n\r\n\t\t\t\tif (this._mtlLib) {\r\n\r\n\t\t\t\t\tif (!trunk[1])\r\n\t\t\t\t\t\ttrunk[1] = \"def000\";\r\n\r\n\t\t\t\t\tthis._materialIDs.push(trunk[1]);\r\n\t\t\t\t\tthis._activeMaterialID = trunk[1];\r\n\r\n\t\t\t\t\tif (this._currentGroup)\r\n\t\t\t\t\t\tthis._currentGroup.materialID = this._activeMaterialID;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"v\":\r\n\r\n\t\t\t\tthis.parseVertex(trunk);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"vt\":\r\n\r\n\t\t\t\tthis.parseUV(trunk);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"vn\":\r\n\r\n\t\t\t\tthis.parseVertexNormal(trunk);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"f\":\r\n\r\n\t\t\t\tthis.parseFace(trunk);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Converts the parsed data into an Away3D scenegraph structure\r\n\t */\r\n\tprivate translate()\r\n\t{\r\n\t\tfor (var objIndex:number = 0; objIndex < this._objects.length; ++objIndex) {\r\n\t\t\tvar groups:Array<Group> = this._objects[objIndex].groups;\r\n\t\t\tvar numGroups:number = groups.length;\r\n\t\t\tvar materialGroups:Array<MaterialGroup>;\r\n\t\t\tvar numMaterialGroups:number;\r\n\t\t\tvar geometry:Geometry;\r\n\t\t\tvar mesh:Mesh;\r\n\r\n\t\t\tvar m:number;\r\n\t\t\tvar sm:number;\r\n\t\t\tvar bmMaterial:MethodMaterial;\r\n\r\n\t\t\tfor (var g:number = 0; g < numGroups; ++g) {\r\n\t\t\t\tgeometry = new Geometry();\r\n\t\t\t\tmaterialGroups = groups[g].materialGroups;\r\n\t\t\t\tnumMaterialGroups = materialGroups.length;\r\n\r\n\t\t\t\tfor (m = 0; m < numMaterialGroups; ++m)\r\n\t\t\t\t\tthis.translateMaterialGroup(materialGroups[m], geometry);\r\n\r\n\t\t\t\tif (geometry.subGeometries.length == 0)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t// Finalize and force type-based name\r\n\t\t\t\tthis._pFinalizeAsset(<IAsset> geometry);//, \"\");\r\n\r\n\t\t\t\tbmMaterial = new MethodMaterial(DefaultMaterialManager.getDefaultTexture());\r\n\r\n\t\t\t\t//check for multipass\r\n\t\t\t\tif (this.materialMode >= 2)\r\n\t\t\t\t\tbmMaterial.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t\tmesh = new Mesh(geometry, bmMaterial);\r\n\r\n\t\t\t\tif (this._objects[objIndex].name) {\r\n\t\t\t\t\t// this is a full independent object ('o' tag in OBJ file)\r\n\t\t\t\t\tmesh.name = this._objects[objIndex].name;\r\n\r\n\t\t\t\t} else if (groups[g].name) {\r\n\r\n\t\t\t\t\t// this is a group so the sub groups contain the actual mesh object names ('g' tag in OBJ file)\r\n\t\t\t\t\tmesh.name = groups[g].name;\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// No name stored. Use empty string which will force it\r\n\t\t\t\t\t// to be overridden by finalizeAsset() to type default.\r\n\t\t\t\t\tmesh.name = \"\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._meshes.push(mesh);\r\n\r\n\t\t\t\tif (groups[g].materialID != \"\")\r\n\t\t\t\t\tbmMaterial.name = groups[g].materialID + \"~\" + mesh.name; else\r\n\t\t\t\t\tbmMaterial.name = this._lastMtlID + \"~\" + mesh.name;\r\n\r\n\t\t\t\tif (mesh.subMeshes.length > 1) {\r\n\t\t\t\t\tfor (sm = 1; sm < mesh.subMeshes.length; ++sm)\r\n\t\t\t\t\t\tmesh.subMeshes[sm].material = bmMaterial;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//add to the content property\r\n\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild(mesh);\r\n\r\n\t\t\t\tthis._pFinalizeAsset(<IAsset> mesh);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Translates an obj's material group to a subgeometry.\r\n\t * @param materialGroup The material group data to convert.\r\n\t * @param geometry The Geometry to contain the converted SubGeometry.\r\n\t */\r\n\tprivate translateMaterialGroup(materialGroup:MaterialGroup, geometry:Geometry)\r\n\t{\r\n\t\tvar faces:Array<FaceData> = materialGroup.faces;\r\n\t\tvar face:FaceData;\r\n\t\tvar numFaces:number = faces.length;\r\n\t\tvar numVerts:number;\r\n\t\tvar sub:TriangleSubGeometry;\r\n\r\n\t\tvar vertices:Array<number> = new Array<number>();\r\n\t\tvar uvs:Array<number> = new Array<number>();\r\n\t\tvar normals:Array<number> = new Array<number>();\r\n\t\tvar indices:Array<number> /*uint*/ = new Array<number>();\r\n\r\n\t\tthis._realIndices = [];\r\n\t\tthis._vertexIndex = 0;\r\n\r\n\t\tvar j:number;\r\n\t\tfor (var i:number = 0; i < numFaces; ++i) {\r\n\r\n\t\t\tface = faces[i];\r\n\t\t\tnumVerts = face.indexIds.length - 1;\r\n\r\n\t\t\tfor (j = 1; j < numVerts; ++j) {\r\n\r\n\t\t\t\tthis.translateVertexData(face, j, vertices, uvs, indices, normals);\r\n\t\t\t\tthis.translateVertexData(face, 0, vertices, uvs, indices, normals);\r\n\t\t\t\tthis.translateVertexData(face, j + 1, vertices, uvs, indices, normals);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (vertices.length > 0) {\r\n\t\t\tsub = new TriangleSubGeometry(true);\r\n\t\t\tsub.autoDeriveNormals = normals.length? false : true;\r\n\t\t\tsub.updateIndices(indices);\r\n\t\t\tsub.updatePositions(vertices);\r\n\t\t\tsub.updateVertexNormals(normals);\r\n\t\t\tsub.updateUVs(uvs);\r\n\r\n\t\t\tgeometry.addSubGeometry(sub);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate translateVertexData(face:FaceData, vertexIndex:number, vertices:Array<number>, uvs:Array<number>, indices:Array<number> /*uint*/, normals:Array<number>)\r\n\t{\r\n\t\tvar index:number;\r\n\t\tvar vertex:Vertex;\r\n\t\tvar vertexNormal:Vertex;\r\n\t\tvar uv:UV;\r\n\r\n\t\tif (!this._realIndices[face.indexIds[vertexIndex]]) {\r\n\r\n\t\t\tindex = this._vertexIndex;\r\n\t\t\tthis._realIndices[face.indexIds[vertexIndex]] = ++this._vertexIndex;\r\n\t\t\tvertex = this._vertices[face.vertexIndices[vertexIndex] - 1];\r\n\t\t\tvertices.push(vertex.x*this._scale, vertex.y*this._scale, vertex.z*this._scale);\r\n\r\n\t\t\tif (face.normalIndices.length > 0) {\r\n\t\t\t\tvertexNormal = this._vertexNormals[face.normalIndices[vertexIndex] - 1];\r\n\t\t\t\tnormals.push(vertexNormal.x, vertexNormal.y, vertexNormal.z);\r\n\t\t\t}\r\n\r\n\t\t\tif (face.uvIndices.length > 0) {\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tuv = this._uvs[face.uvIndices[vertexIndex] - 1];\r\n\t\t\t\t\tuvs.push(uv.u, uv.v);\r\n\r\n\t\t\t\t} catch (e) {\r\n\r\n\t\t\t\t\tswitch (vertexIndex) {\r\n\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\tuvs.push(0, 1);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\tuvs.push(.5, 0);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\tuvs.push(1, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tindex = this._realIndices[face.indexIds[vertexIndex]] - 1;\r\n\t\t}\r\n\r\n\t\tindices.push(index);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new object group.\r\n\t * @param trunk The data block containing the object tag and its parameters\r\n\t */\r\n\tprivate createObject(trunk)\r\n\t{\r\n\t\tthis._currentGroup = null;\r\n\t\tthis._currentMaterialGroup = null;\r\n\t\tthis._objects.push(this._currentObject = new ObjectGroup());\r\n\r\n\t\tif (trunk)\r\n\t\t\tthis._currentObject.name = trunk[1];\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new group.\r\n\t * @param trunk The data block containing the group tag and its parameters\r\n\t */\r\n\tprivate createGroup(trunk)\r\n\t{\r\n\t\tif (!this._currentObject)\r\n\t\t\tthis.createObject(null);\r\n\t\tthis._currentGroup = new Group();\r\n\r\n\t\tthis._currentGroup.materialID = this._activeMaterialID;\r\n\r\n\t\tif (trunk)\r\n\t\t\tthis._currentGroup.name = trunk[1];\r\n\t\tthis._currentObject.groups.push(this._currentGroup);\r\n\r\n\t\tthis.createMaterialGroup(null);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new material group.\r\n\t * @param trunk The data block containing the material tag and its parameters\r\n\t */\r\n\tprivate createMaterialGroup(trunk)\r\n\t{\r\n\t\tthis._currentMaterialGroup = new MaterialGroup();\r\n\t\tif (trunk)\r\n\t\t\tthis._currentMaterialGroup.url = trunk[1];\r\n\t\tthis._currentGroup.materialGroups.push(this._currentMaterialGroup);\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the next vertex coordinates.\r\n\t * @param trunk The data block containing the vertex tag and its parameters\r\n\t */\r\n\tprivate parseVertex(trunk)\r\n\t{\r\n\t\t//for the very rare cases of other delimiters/charcodes seen in some obj files\r\n\r\n\t\tvar v1:number, v2:number , v3:number;\r\n\t\tif (trunk.length > 4) {\r\n\t\t\tvar nTrunk = [];\r\n\t\t\tvar val:number;\r\n\r\n\t\t\tfor (var i:number = 1; i < trunk.length; ++i) {\r\n\t\t\t\tval = parseFloat(trunk[i]);\r\n\t\t\t\tif (!isNaN(val))\r\n\t\t\t\t\tnTrunk.push(val);\r\n\t\t\t}\r\n\r\n\t\t\tv1 = <number> nTrunk[0];\r\n\t\t\tv2 = <number> nTrunk[1];\r\n\t\t\tv3 = <number> -nTrunk[2];\r\n\t\t\tthis._vertices.push(new Vertex(v1, v2, v3));\r\n\r\n\t\t} else {\r\n\t\t\tv1 = <number> parseFloat(trunk[1]);\r\n\t\t\tv2 = <number> parseFloat(trunk[2]);\r\n\t\t\tv3 = <number> -parseFloat(trunk[3]);\r\n\r\n\t\t\tthis._vertices.push(new Vertex(v1, v2, v3));\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the next uv coordinates.\r\n\t * @param trunk The data block containing the uv tag and its parameters\r\n\t */\r\n\tprivate parseUV(trunk)\r\n\t{\r\n\t\tif (trunk.length > 3) {\r\n\t\t\tvar nTrunk = [];\r\n\t\t\tvar val:number;\r\n\t\t\tfor (var i:number = 1; i < trunk.length; ++i) {\r\n\t\t\t\tval = parseFloat(trunk[i]);\r\n\t\t\t\tif (!isNaN(val))\r\n\t\t\t\t\tnTrunk.push(val);\r\n\t\t\t}\r\n\t\t\tthis._uvs.push(new UV(nTrunk[0], 1 - nTrunk[1]));\r\n\r\n\t\t} else {\r\n\t\t\tthis._uvs.push(new UV(parseFloat(trunk[1]), 1 - parseFloat(trunk[2])));\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the next vertex normal coordinates.\r\n\t * @param trunk The data block containing the vertex normal tag and its parameters\r\n\t */\r\n\tprivate parseVertexNormal(trunk)\r\n\t{\r\n\t\tif (trunk.length > 4) {\r\n\t\t\tvar nTrunk = [];\r\n\t\t\tvar val:number;\r\n\t\t\tfor (var i:number = 1; i < trunk.length; ++i) {\r\n\t\t\t\tval = parseFloat(trunk[i]);\r\n\t\t\t\tif (!isNaN(val))\r\n\t\t\t\t\tnTrunk.push(val);\r\n\t\t\t}\r\n\t\t\tthis._vertexNormals.push(new Vertex(nTrunk[0], nTrunk[1], -nTrunk[2]));\r\n\r\n\t\t} else {\r\n\t\t\tthis._vertexNormals.push(new Vertex(parseFloat(trunk[1]), parseFloat(trunk[2]), -parseFloat(trunk[3])));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the next face's indices.\r\n\t * @param trunk The data block containing the face tag and its parameters\r\n\t */\r\n\tprivate parseFace(trunk)\r\n\t{\r\n\t\tvar len:number = trunk.length;\r\n\t\tvar face:FaceData = new FaceData();\r\n\r\n\t\tif (!this._currentGroup) {\r\n\t\t\tthis.createGroup(null);\r\n\t\t}\r\n\r\n\t\tvar indices;\r\n\t\tfor (var i:number = 1; i < len; ++i) {\r\n\r\n\t\t\tif (trunk[i] == \"\") {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tindices = trunk[i].split(\"/\");\r\n\t\t\tface.vertexIndices.push(this.parseIndex(parseInt(indices[0]), this._vertices.length));\r\n\r\n\t\t\tif (indices[1] && String(indices[1]).length > 0)\r\n\t\t\t\tface.uvIndices.push(this.parseIndex(parseInt(indices[1]), this._uvs.length));\r\n\r\n\t\t\tif (indices[2] && String(indices[2]).length > 0)\r\n\t\t\t\tface.normalIndices.push(this.parseIndex(parseInt(indices[2]), this._vertexNormals.length));\r\n\r\n\t\t\tface.indexIds.push(trunk[i]);\r\n\t\t}\r\n\r\n\t\tthis._currentMaterialGroup.faces.push(face);\r\n\t}\r\n\r\n\t/**\r\n\t * This is a hack around negative face coords\r\n\t */\r\n\tprivate parseIndex(index:number, length:number):number\r\n\t{\r\n\t\tif (index < 0)\r\n\t\t\treturn index + length + 1; else\r\n\t\t\treturn index;\r\n\t}\r\n\r\n\tprivate parseMtl(data:string)\r\n\t{\r\n\t\tvar materialDefinitions = data.split('newmtl');\r\n\t\tvar lines;\r\n\t\tvar trunk;\r\n\t\tvar j:number;\r\n\r\n\t\tvar basicSpecularMethod:SpecularBasicMethod;\r\n\t\tvar useSpecular:boolean;\r\n\t\tvar useColor:boolean;\r\n\t\tvar diffuseColor:number;\r\n\t\tvar color:number;\r\n\t\tvar specularColor:number;\r\n\t\tvar specular:number;\r\n\t\tvar alpha:number;\r\n\t\tvar mapkd:string;\r\n\r\n\t\tfor (var i:number = 0; i < materialDefinitions.length; ++i) {\r\n\r\n\r\n\t\t\tlines = (materialDefinitions[i].split('\\r')).join(\"\").split('\\n');\r\n\t\t\t//lines = (materialDefinitions[i].split('\\r') as Array).join(\"\").split('\\n');\r\n\r\n\t\t\tif (lines.length == 1)\r\n\t\t\t\tlines = materialDefinitions[i].split(String.fromCharCode(13));\r\n\r\n\t\t\tdiffuseColor = color = specularColor = 0xFFFFFF;\r\n\t\t\tspecular = 0;\r\n\t\t\tuseSpecular = false;\r\n\t\t\tuseColor = false;\r\n\t\t\talpha = 1;\r\n\t\t\tmapkd = \"\";\r\n\r\n\t\t\tfor (j = 0; j < lines.length; ++j) {\r\n\r\n\t\t\t\tlines[j] = lines[j].replace(/\\s+$/, \"\");\r\n\r\n\t\t\t\tif (lines[j].substring(0, 1) != \"#\" && (j == 0 || lines[j] != \"\")) {\r\n\t\t\t\t\ttrunk = lines[j].split(\" \");\r\n\r\n\t\t\t\t\tif (String(trunk[0]).charCodeAt(0) == 9 || String(trunk[0]).charCodeAt(0) == 32)\r\n\t\t\t\t\t\ttrunk[0] = trunk[0].substring(1, trunk[0].length);\r\n\r\n\t\t\t\t\tif (j == 0) {\r\n\t\t\t\t\t\tthis._lastMtlID = trunk.join(\"\");\r\n\t\t\t\t\t\tthis._lastMtlID = (this._lastMtlID == \"\")? \"def000\" : this._lastMtlID;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tswitch (trunk[0]) {\r\n\r\n\t\t\t\t\t\t\tcase \"Ka\":\r\n\t\t\t\t\t\t\t\tif (trunk[1] && !isNaN(Number(trunk[1])) && trunk[2] && !isNaN(Number(trunk[2])) && trunk[3] && !isNaN(Number(trunk[3])))\r\n\t\t\t\t\t\t\t\t\tcolor = trunk[1]*255 << 16 | trunk[2]*255 << 8 | trunk[3]*255;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase \"Ks\":\r\n\t\t\t\t\t\t\t\tif (trunk[1] && !isNaN(Number(trunk[1])) && trunk[2] && !isNaN(Number(trunk[2])) && trunk[3] && !isNaN(Number(trunk[3]))) {\r\n\t\t\t\t\t\t\t\t\tspecularColor = trunk[1]*255 << 16 | trunk[2]*255 << 8 | trunk[3]*255;\r\n\t\t\t\t\t\t\t\t\tuseSpecular = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase \"Ns\":\r\n\t\t\t\t\t\t\t\tif (trunk[1] && !isNaN(Number(trunk[1])))\r\n\t\t\t\t\t\t\t\t\tspecular = Number(trunk[1])*0.001;\r\n\t\t\t\t\t\t\t\tif (specular == 0)\r\n\t\t\t\t\t\t\t\t\tuseSpecular = false;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase \"Kd\":\r\n\t\t\t\t\t\t\t\tif (trunk[1] && !isNaN(Number(trunk[1])) && trunk[2] && !isNaN(Number(trunk[2])) && trunk[3] && !isNaN(Number(trunk[3]))) {\r\n\t\t\t\t\t\t\t\t\tdiffuseColor = trunk[1]*255 << 16 | trunk[2]*255 << 8 | trunk[3]*255;\r\n\t\t\t\t\t\t\t\t\tuseColor = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase \"tr\":\r\n\t\t\t\t\t\t\tcase \"d\":\r\n\t\t\t\t\t\t\t\tif (trunk[1] && !isNaN(Number(trunk[1])))\r\n\t\t\t\t\t\t\t\t\talpha = Number(trunk[1]);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase \"map_Kd\":\r\n\t\t\t\t\t\t\t\tmapkd = this.parseMapKdString(trunk);\r\n\t\t\t\t\t\t\t\tmapkd = mapkd.replace(/\\\\/g, \"/\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (mapkd != \"\") {\r\n\r\n\t\t\t\tif (useSpecular) {\r\n\r\n\t\t\t\t\tbasicSpecularMethod = new SpecularBasicMethod();\r\n\t\t\t\t\tbasicSpecularMethod.specularColor = specularColor;\r\n\t\t\t\t\tbasicSpecularMethod.specular = specular;\r\n\r\n\t\t\t\t\tvar specularData:SpecularData = new SpecularData();\r\n\t\t\t\t\tspecularData.alpha = alpha;\r\n\t\t\t\t\tspecularData.basicSpecularMethod = basicSpecularMethod;\r\n\t\t\t\t\tspecularData.materialID = this._lastMtlID;\r\n\r\n\t\t\t\t\tif (!this._materialSpecularData)\r\n\t\t\t\t\t\tthis._materialSpecularData = new Array<SpecularData>();\r\n\r\n\t\t\t\t\tthis._materialSpecularData.push(specularData);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._pAddDependency(this._lastMtlID, new URLRequest(mapkd));\r\n\r\n\t\t\t} else if (useColor && !isNaN(color)) {\r\n\r\n\t\t\t\tvar lm:LoadedMaterial = new LoadedMaterial();\r\n\t\t\t\tlm.materialID = this._lastMtlID;\r\n\r\n\t\t\t\tif (alpha == 0)\r\n\t\t\t\t\tconsole.log(\"Warning: an alpha value of 0 was found in mtl color tag (Tr or d) ref:\" + this._lastMtlID + \", mesh(es) using it will be invisible!\");\r\n\r\n\t\t\t\tvar cm:MethodMaterial;\r\n\r\n\t\t\t\tif (this.materialMode < 2) {\r\n\t\t\t\t\tcm = new MethodMaterial(color);\r\n\r\n\t\t\t\t\tvar colorMat:MethodMaterial = <MethodMaterial> cm;\r\n\r\n\t\t\t\t\tcolorMat.alpha = alpha;\r\n\t\t\t\t\tcolorMat.diffuseColor = diffuseColor;\r\n\t\t\t\t\tcolorMat.repeat = true;\r\n\r\n\t\t\t\t\tif (useSpecular) {\r\n\t\t\t\t\t\tcolorMat.specularColor = specularColor;\r\n\t\t\t\t\t\tcolorMat.specular = specular;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcm = new MethodMaterial(color);\r\n\t\t\t\t\tcm.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t\t\tvar colorMultiMat:MethodMaterial = <MethodMaterial> cm;\r\n\r\n\r\n\t\t\t\t\tcolorMultiMat.diffuseColor = diffuseColor;\r\n\t\t\t\t\tcolorMultiMat.repeat = true;\r\n\r\n\t\t\t\t\tif (useSpecular) {\r\n\t\t\t\t\t\tcolorMultiMat.specularColor = specularColor;\r\n\t\t\t\t\t\tcolorMultiMat.specular = specular;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlm.cm = cm;\r\n\r\n\t\t\t\tthis._materialLoaded.push(lm);\r\n\r\n\t\t\t\tif (this._meshes.length > 0)\r\n\t\t\t\t\tthis.applyMaterial(lm);\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._mtlLibLoaded = true;\r\n\t}\r\n\r\n\tprivate parseMapKdString(trunk):string\r\n\t{\r\n\t\tvar url:string = \"\";\r\n\t\tvar i:number;\r\n\t\tvar breakflag:boolean;\r\n\r\n\t\tfor (i = 1; i < trunk.length;) {\r\n\t\t\tswitch (trunk[i]) {\r\n\t\t\t\tcase \"-blendu\":\r\n\t\t\t\tcase \"-blendv\":\r\n\t\t\t\tcase \"-cc\":\r\n\t\t\t\tcase \"-clamp\":\r\n\t\t\t\tcase \"-texres\":\r\n\t\t\t\t\ti += 2; //Skip ahead 1 attribute\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"-mm\":\r\n\t\t\t\t\ti += 3; //Skip ahead 2 attributes\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"-o\":\r\n\t\t\t\tcase \"-s\":\r\n\t\t\t\tcase \"-t\":\r\n\t\t\t\t\ti += 4; //Skip ahead 3 attributes\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreakflag = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (breakflag)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t//Reconstruct URL/filename\r\n\t\tfor (i; i < trunk.length; i++) {\r\n\t\t\turl += trunk[i];\r\n\t\t\turl += \" \";\r\n\t\t}\r\n\r\n\t\t//Remove the extraneous space and/or newline from the right side\r\n\t\turl = url.replace(/\\s+$/, \"\");\r\n\r\n\t\treturn url;\r\n\t}\r\n\r\n\tprivate loadMtl(mtlurl:string)\r\n\t{\r\n\t\t// Add raw-data dependency to queue and load dependencies now,\r\n\t\t// which will pause the parsing in the meantime.\r\n\t\tthis._pAddDependency('mtl', new URLRequest(mtlurl), true);\r\n\t\tthis._pPauseAndRetrieveDependencies();//\r\n\t}\r\n\r\n\tprivate applyMaterial(lm:LoadedMaterial)\r\n\t{\r\n\t\tvar decomposeID;\r\n\t\tvar mesh:Mesh;\r\n\t\tvar tm:MethodMaterial;\r\n\t\tvar j:number;\r\n\t\tvar specularData:SpecularData;\r\n\r\n\t\tfor (var i:number = 0; i < this._meshes.length; ++i) {\r\n\t\t\tmesh = this._meshes[i];\r\n\t\t\tdecomposeID = mesh.material.name.split(\"~\");\r\n\r\n\t\t\tif (decomposeID[0] == lm.materialID) {\r\n\r\n\t\t\t\tif (lm.cm) {\r\n\t\t\t\t\tif (mesh.material)\r\n\t\t\t\t\t\tmesh.material = null;\r\n\t\t\t\t\tmesh.material = lm.cm;\r\n\r\n\t\t\t\t} else if (lm.texture) {\r\n\t\t\t\t\tif (this.materialMode < 2) { // if materialMode is 0 or 1, we create a SinglePass\r\n\t\t\t\t\t\ttm = <MethodMaterial > mesh.material;\r\n\r\n\t\t\t\t\t\ttm.texture = lm.texture;\r\n\t\t\t\t\t\ttm.color = lm.color;\r\n\t\t\t\t\t\ttm.alpha = lm.alpha;\r\n\t\t\t\t\t\ttm.repeat = true;\r\n\r\n\t\t\t\t\t\tif (lm.specularMethod) {\r\n\r\n\t\t\t\t\t\t\t// By setting the specularMethod property to null before assigning\r\n\t\t\t\t\t\t\t// the actual method instance, we avoid having the properties of\r\n\t\t\t\t\t\t\t// the new method being overridden with the settings from the old\r\n\t\t\t\t\t\t\t// one, which is default behavior of the setter.\r\n\t\t\t\t\t\t\ttm.specularMethod = null;\r\n\t\t\t\t\t\t\ttm.specularMethod = lm.specularMethod;\r\n\r\n\t\t\t\t\t\t} else if (this._materialSpecularData) {\r\n\r\n\t\t\t\t\t\t\tfor (j = 0; j < this._materialSpecularData.length; ++j) {\r\n\t\t\t\t\t\t\t\tspecularData = this._materialSpecularData[j];\r\n\r\n\t\t\t\t\t\t\t\tif (specularData.materialID == lm.materialID) {\r\n\t\t\t\t\t\t\t\t\ttm.specularMethod = null; // Prevent property overwrite (see above)\r\n\t\t\t\t\t\t\t\t\ttm.specularMethod = specularData.basicSpecularMethod;\r\n\t\t\t\t\t\t\t\t\ttm.color = specularData.color;\r\n\t\t\t\t\t\t\t\t\ttm.alpha = specularData.alpha;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else { //if materialMode==2 this is a MultiPassTexture\r\n\t\t\t\t\t\ttm = <MethodMaterial> mesh.material;\r\n\t\t\t\t\t\ttm.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t\t\t\ttm.texture = lm.texture;\r\n\t\t\t\t\t\ttm.color = lm.color;\r\n\t\t\t\t\t\ttm.repeat = true;\r\n\r\n\t\t\t\t\t\tif (lm.specularMethod) {\r\n\t\t\t\t\t\t\t// By setting the specularMethod property to null before assigning\r\n\t\t\t\t\t\t\t// the actual method instance, we avoid having the properties of\r\n\t\t\t\t\t\t\t// the new method being overridden with the settings from the old\r\n\t\t\t\t\t\t\t// one, which is default behavior of the setter.\r\n\t\t\t\t\t\t\ttm.specularMethod = null;\r\n\t\t\t\t\t\t\ttm.specularMethod = lm.specularMethod;\r\n\t\t\t\t\t\t} else if (this._materialSpecularData) {\r\n\t\t\t\t\t\t\tfor (j = 0; j < this._materialSpecularData.length; ++j) {\r\n\t\t\t\t\t\t\t\tspecularData = this._materialSpecularData[j];\r\n\r\n\t\t\t\t\t\t\t\tif (specularData.materialID == lm.materialID) {\r\n\t\t\t\t\t\t\t\t\ttm.specularMethod = null; // Prevent property overwrite (see above)\r\n\t\t\t\t\t\t\t\t\ttm.specularMethod = specularData.basicSpecularMethod;\r\n\t\t\t\t\t\t\t\t\ttm.color = specularData.color;\r\n\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmesh.material.name = decomposeID[1]? decomposeID[1] : decomposeID[0];\r\n\t\t\t\tthis._meshes.splice(i, 1);\r\n\t\t\t\t--i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (lm.cm || tm)\r\n\t\t\tthis._pFinalizeAsset(lm.cm || tm);\r\n\t}\r\n\r\n\tprivate applyMaterials()\r\n\t{\r\n\t\tif (this._materialLoaded.length == 0)\r\n\t\t\treturn;\r\n\r\n\t\tfor (var i:number = 0; i < this._materialLoaded.length; ++i)\r\n\t\t\tthis.applyMaterial(this._materialLoaded[i]);\r\n\t}\r\n}\r\n\r\nexport = OBJParser;\r\n\r\nclass ObjectGroup\r\n{\r\n\tpublic name:string;\r\n\tpublic groups:Group[] = new Array<Group>();\r\n}\r\n\r\nclass Group\r\n{\r\n\tpublic name:string;\r\n\tpublic materialID:string;\r\n\tpublic materialGroups:MaterialGroup[] = new Array<MaterialGroup>();\r\n}\r\n\r\nclass MaterialGroup\r\n{\r\n\tpublic url:string;\r\n\tpublic faces:FaceData[] = new Array<FaceData>();\r\n}\r\n\r\nclass SpecularData\r\n{\r\n\tpublic materialID:string;\r\n\tpublic basicSpecularMethod:SpecularBasicMethod;\r\n\tpublic color:number = 0xFFFFFF;\r\n\tpublic alpha:number = 1;\r\n}\r\n\r\nclass LoadedMaterial\r\n{\r\n\tpublic materialID:string;\r\n\tpublic texture:Texture2DBase;\r\n\tpublic cm:MaterialBase;\r\n\tpublic specularMethod:SpecularBasicMethod;\r\n\tpublic color:number = 0xFFFFFF;\r\n\tpublic alpha:number = 1;\r\n}\r\n\r\nclass FaceData\r\n{\r\n\tpublic vertexIndices:Array<number> /*uint*/ = new Array<number>();\r\n\tpublic uvIndices:Array<number> /*uint*/ = new Array<number>();\r\n\tpublic normalIndices:Array<number> /*uint*/ = new Array<number>();\r\n\tpublic indexIds:string[] = new Array<string>(); // used for real index lookups\r\n}\r\n\r\n/**\r\n* Texture coordinates value object.\r\n*/\r\nclass UV\r\n{\r\n\tprivate _u:number;\r\n\tprivate _v:number;\r\n\r\n\t/**\r\n\t * Creates a new <code>UV</code> object.\r\n\t *\r\n\t * @param    u        [optional]    The horizontal coordinate of the texture value. Defaults to 0.\r\n\t * @param    v        [optional]    The vertical coordinate of the texture value. Defaults to 0.\r\n\t */\r\n\tconstructor(u:number = 0, v:number = 0)\r\n\t{\r\n\t\tthis._u = u;\r\n\t\tthis._v = v;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the vertical coordinate of the texture value.\r\n\t */\r\n\tpublic get v():number\r\n\t{\r\n\t\treturn this._v;\r\n\t}\r\n\r\n\tpublic set v(value:number)\r\n\t{\r\n\t\tthis._v = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the horizontal coordinate of the texture value.\r\n\t */\r\n\tpublic get u():number\r\n\t{\r\n\t\treturn this._u;\r\n\t}\r\n\r\n\tpublic set u(value:number)\r\n\t{\r\n\t\tthis._u = value;\r\n\t}\r\n\r\n\t/**\r\n\t * returns a new UV value Object\r\n\t */\r\n\tpublic clone():UV\r\n\t{\r\n\t\treturn new UV(this._u, this._v);\r\n\t}\r\n\r\n\t/**\r\n\t * returns the value object as a string for trace/debug purpose\r\n\t */\r\n\tpublic toString():string\r\n\t{\r\n\t\treturn this._u + \",\" + this._v;\r\n\t}\r\n}\r\n\r\nclass Vertex\r\n{\r\n\tprivate _x:number;\r\n\tprivate _y:number;\r\n\tprivate _z:number;\r\n\tprivate _index:number;\r\n\r\n\t/**\r\n\t * Creates a new <code>Vertex</code> value object.\r\n\t *\r\n\t * @param    x            [optional]    The x value. Defaults to 0.\r\n\t * @param    y            [optional]    The y value. Defaults to 0.\r\n\t * @param    z            [optional]    The z value. Defaults to 0.\r\n\t * @param    index        [optional]    The index value. Defaults is NaN.\r\n\t */\r\n\tconstructor(x:number = 0, y:number = 0, z:number = 0, index:number = 0)\r\n\t{\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\tthis._index = index;\r\n\t}\r\n\r\n\t/**\r\n\t * To define/store the index of value object\r\n\t * @param    ind        The index\r\n\t */\r\n\tpublic set index(ind:number)\r\n\t{\r\n\t\tthis._index = ind;\r\n\t}\r\n\r\n\tpublic get index():number\r\n\t{\r\n\t\treturn this._index;\r\n\t}\r\n\r\n\t/**\r\n\t * To define/store the x value of the value object\r\n\t * @param    value        The x value\r\n\t */\r\n\tpublic get x():number\r\n\t{\r\n\t\treturn this._x;\r\n\t}\r\n\r\n\tpublic set x(value:number)\r\n\t{\r\n\t\tthis._x = value;\r\n\t}\r\n\r\n\t/**\r\n\t * To define/store the y value of the value object\r\n\t * @param    value        The y value\r\n\t */\r\n\tpublic get y():number\r\n\t{\r\n\t\treturn this._y;\r\n\t}\r\n\r\n\tpublic set y(value:number)\r\n\t{\r\n\t\tthis._y = value;\r\n\t}\r\n\r\n\t/**\r\n\t * To define/store the z value of the value object\r\n\t * @param    value        The z value\r\n\t */\r\n\tpublic get z():number\r\n\t{\r\n\t\treturn this._z;\r\n\t}\r\n\r\n\tpublic set z(value:number)\r\n\t{\r\n\t\tthis._z = value;\r\n\t}\r\n\r\n\t/**\r\n\t * returns a new Vertex value Object\r\n\t */\r\n\tpublic clone():Vertex\r\n\t{\r\n\t\treturn new Vertex(this._x, this._y, this._z);\r\n\t}\r\n}","import AssetLoader\t\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetLoader\");\r\n\r\nimport AWDParser\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWDParser\");\r\nimport Max3DSParser\t\t\t\t\t\t= require(\"awayjs-parsers/lib/Max3DSParser\");\r\nimport MD2Parser\t\t\t\t\t\t= require(\"awayjs-parsers/lib/MD2Parser\");\r\nimport OBJParser\t\t\t\t\t\t= require(\"awayjs-parsers/lib/OBJParser\");\r\n\r\n/**\r\n *\r\n */\r\nclass Parsers\r\n{\r\n\t/**\r\n\t * A list of all parsers that come bundled with Away3D. Use this to quickly\r\n\t * enable support for all bundled parsers to the file format auto-detection\r\n\t * feature, using any of the enableParsers() methods on loaders, e.g.:\r\n\t *\r\n\t * <code>AssetLibrary.enableParsers(Parsers.ALL_BUNDLED);</code>\r\n\t *\r\n\t * Beware however that this requires all parser classes to be included in the\r\n\t * SWF file, which will add 50-100 kb to the file. When only a limited set of\r\n\t * file formats are used, SWF file size can be saved by adding the parsers\r\n\t * individually using AssetLibrary.enableParser()\r\n\t *\r\n\t * A third way is to specify a parser for each loaded file, thereby bypassing\r\n\t * the auto-detection mechanisms altogether, while at the same time allowing\r\n\t * any properties that are unique to that parser to be set for that load.\r\n\t *\r\n\t * The bundled parsers are:\r\n\t *\r\n\t * <ul>\r\n\t * <li>AC3D (.ac)</li>\r\n\t * <li>Away Data version 1 ASCII and version 2 binary (.awd). AWD1 BSP unsupported</li>\r\n\t * <li>3DMax (.3ds)</li>\r\n\t * <li>DXF (.dxf)</li>\r\n\t * <li>Quake 2 MD2 models (.md2)</li>\r\n\t * <li>Doom 3 MD5 animation clips (.md5anim)</li>\r\n\t * <li>Doom 3 MD5 meshes (.md5mesh)</li>\r\n\t * <li>Wavefront OBJ (.obj)</li>\r\n\t * <li>Collada (.dae)</li>\r\n\t * <li>Images (.jpg, .png)</li>\r\n\t * </ul>\r\n\t *\r\n\t * @see away.library.AssetLibrary.enableParser\r\n\t */\r\n\tpublic static ALL_BUNDLED:Array<Object> = Array<Object>(AWDParser, Max3DSParser, MD2Parser, OBJParser);\r\n\r\n\t/**\r\n\t * Short-hand function to enable all bundled parsers for auto-detection. In practice,\r\n\t * this is the same as invoking enableParsers(Parsers.ALL_BUNDLED) on any of the\r\n\t * loader classes SingleFileLoader, AssetLoader, AssetLibrary or Loader3D.\r\n\t *\r\n\t * See notes about file size in the documentation for the ALL_BUNDLED constant.\r\n\t *\r\n\t * @see away.parsers.Parsers.ALL_BUNDLED\r\n\t */\r\n\tpublic static enableAllBundled():void\r\n\t{\r\n\t\tAssetLoader.enableParsers(Parsers.ALL_BUNDLED);\r\n\t}\r\n}\r\n\r\nexport = Parsers;","var __extends = this.__extends || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    __.prototype = b.prototype;\n    d.prototype = new __();\n};\nvar AS2SymbolAdapter = require(\"awayjs-player/lib/fl/adapters/AS2SymbolAdapter\");\nvar AS2MovieClipAdapter = (function (_super) {\n    __extends(AS2MovieClipAdapter, _super);\n    // translate to scripts:\n    /*public onData: Function;\n    public onEnterFrame: Function;\n    public onLoad: Function;\n    public onMouseDown: Function;\n    public onMouseMove: Function;\n    public onMouseUp: Function;\n    public onUnload: Function;*/\n    function AS2MovieClipAdapter(adaptee) {\n        _super.call(this, adaptee);\n        this.currentFrameIndex = -1;\n    }\n    //get _totalFrames() : number\n    //{\n    //}\n    //attachAudio(id: Object) : void {\t}\n    //attachBitmap(bmp: BitmapData, depth: Number, pixelSnapping: String = null, smoothing: boolean = false) : void { }\n    //attachMovie(id: string, name: string, depth: number, initObject: Object = null) : MovieClip { return null; }\n    //beginBitmapFill(bmp: BitmapData, matrix: Matrix = null, repeat: boolean = false, smoothing: boolean = false) : void {}\n    //beginFill(rgb: Number, alpha: number = 1.0) : void {}\n    //beginGradientFill(fillType: string, colors: Array, alphas: Array, ratios: Array, matrix: Object, spreadMethod: string = null, interpolationMethod: string  = null, focalPointRatio: number  = null) : void {}\n    //clear() : void {}\n    //createEmptyMovieClip(name: string, depth: number) : MovieClip { return null; }\n    //createTextField(instanceName: String, depth: Number, x: Number, y: Number, width: Number, height: Number) : TextField {}\n    //curveTo(controlX: number, controlY: number, anchorX: number, anchorY: number) : void {}\n    //duplicateMovieClip(name: string, depth: number, initObject: Object) : MovieClip { return null; }\n    //endFill() : void {}\n    //getBounds(bounds: Object) : Object { return null; }\n    //getBytesLoaded() : number { return 0; }\n    //getBytesTotal() : number { return 0; }\n    //getInstanceAtDepth(depth: Number) : MovieClip { return null; }\n    //getNextHighestDepth() : number { return 0; }\n    //getRect(bounds: Object) : Object { return null; }\n    //getSWFVersion() : number { return 0; }\n    //getTextSnapshot() : TextSnapshot {}\n    //getURL(url: string, window: string, method: string) : void {}\n    //globalToLocal(pt: Object) : void {}\n    //gotoAndPlay(frame: Object) : void {}\n    //gotoAndStop(frame: Object) : void {}\n    //hitTest() : boolean { return false; }\n    //lineGradientStyle(fillType: string, colors: array, alphas: array, ratios: array, matrix: Object, spreadMethod: string = null, interpolationMethod: string, focalPointRatio: number) : void {}\n    //lineStyle(thickness: number, rgb: number, alpha: number, pixelHinting: boolean, noScale: string, capsStyle: string, jointStyle: string, miterLimit: number) : void {}\n    //lineTo(x: number, y: number) : void {}\n    //loadMovie(url: string, method: string = null) : void {}\n    //loadVariables(url: string, method: string = null) : void {}\n    //localToGlobal(pt: Object) : void {}\n    //moveTo(x: number, y: number) : void {}\n    //nextFrame() : void {}\n    //play() : void {}\n    //prevFrame() : void {}\n    //removeMovieClip() : void {}\n    //setMask(mc: Object) : void {}\n    //startDrag(lockCenter: boolean = false, left: number = 0, top: number = 0, right: number = 0, bottom: number = 0) : void {}\n    //stop() : void {}\n    //stopDrag() : void {}\n    //swapDepths(target: Object) : void {}\n    //unloadMovie() : void {}\n    AS2MovieClipAdapter.prototype.clone = function (newAdaptee) {\n        return new AS2MovieClipAdapter(newAdaptee);\n    };\n    return AS2MovieClipAdapter;\n})(AS2SymbolAdapter);\nmodule.exports = AS2MovieClipAdapter;\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1wbGF5ZXIvbGliL2FkYXB0ZXJzL0FTMk1vdmllQ2xpcEFkYXB0ZXIudHMiXSwibmFtZXMiOlsiQVMyTW92aWVDbGlwQWRhcHRlciIsIkFTMk1vdmllQ2xpcEFkYXB0ZXIuY29uc3RydWN0b3IiLCJBUzJNb3ZpZUNsaXBBZGFwdGVyLmNsb25lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFFQSxJQUFPLGdCQUFnQixXQUFXLGdEQUFnRCxDQUFDLENBQUM7QUFJcEYsSUFBTSxtQkFBbUI7SUFBU0EsVUFBNUJBLG1CQUFtQkEsVUFBeUJBO0lBd0JqREEsd0JBQXdCQTtJQUN4QkE7Ozs7OztnQ0FNNEJBO0lBRTVCQSxTQWpDS0EsbUJBQW1CQSxDQWlDWkEsT0FBZ0NBO1FBRTNDQyxrQkFBTUEsT0FBT0EsQ0FBQ0EsQ0FBQ0E7UUFDZkEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUM3QkEsQ0FBQ0E7SUFFREQsNkJBQTZCQTtJQUM3QkEsR0FBR0E7SUFDSEEsR0FBR0E7SUFFSEEsb0NBQW9DQTtJQUVwQ0EsbUhBQW1IQTtJQUVuSEEsOEdBQThHQTtJQUU5R0Esd0hBQXdIQTtJQUV4SEEsdURBQXVEQTtJQUV2REEsK01BQStNQTtJQUUvTUEsbUJBQW1CQTtJQUVuQkEsZ0ZBQWdGQTtJQUVoRkEsMEhBQTBIQTtJQUUxSEEseUZBQXlGQTtJQUV6RkEsa0dBQWtHQTtJQUVsR0EscUJBQXFCQTtJQUVyQkEscURBQXFEQTtJQUVyREEseUNBQXlDQTtJQUV6Q0Esd0NBQXdDQTtJQUV4Q0EsZ0VBQWdFQTtJQUVoRUEsOENBQThDQTtJQUU5Q0EsbURBQW1EQTtJQUVuREEsd0NBQXdDQTtJQUV4Q0EscUNBQXFDQTtJQUVyQ0EsK0RBQStEQTtJQUUvREEscUNBQXFDQTtJQUVyQ0Esc0NBQXNDQTtJQUV0Q0Esc0NBQXNDQTtJQUV0Q0EsdUNBQXVDQTtJQUV2Q0EsK0xBQStMQTtJQUUvTEEsdUtBQXVLQTtJQUV2S0Esd0NBQXdDQTtJQUV4Q0EseURBQXlEQTtJQUV6REEsNkRBQTZEQTtJQUU3REEscUNBQXFDQTtJQUVyQ0Esd0NBQXdDQTtJQUV4Q0EsdUJBQXVCQTtJQUV2QkEsa0JBQWtCQTtJQUVsQkEsdUJBQXVCQTtJQUV2QkEsNkJBQTZCQTtJQUU3QkEsK0JBQStCQTtJQUUvQkEsNEhBQTRIQTtJQUU1SEEsa0JBQWtCQTtJQUVsQkEsc0JBQXNCQTtJQUV0QkEsc0NBQXNDQTtJQUV0Q0EseUJBQXlCQTtJQUV0QkEsbUNBQUtBLEdBQUxBLFVBQU1BLFVBQWlDQTtRQUVuQ0UsTUFBTUEsQ0FBQ0EsSUFBSUEsbUJBQW1CQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtJQUMvQ0EsQ0FBQ0E7SUFDTEYsMEJBQUNBO0FBQURBLENBbklBLEFBbUlDQSxFQW5JaUMsZ0JBQWdCLEVBbUlqRDtBQUNELEFBQTZCLGlCQUFwQixtQkFBbUIsQ0FBQyIsImZpbGUiOiJmbC9hZGFwdGVycy9BUzJNb3ZpZUNsaXBBZGFwdGVyLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbbnVsbF19","var AS2SymbolAdapter = (function () {\n    function AS2SymbolAdapter(adaptee) {\n        this._adaptee = adaptee;\n    }\n    Object.defineProperty(AS2SymbolAdapter.prototype, \"adaptee\", {\n        get: function () {\n            return this._adaptee;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(AS2SymbolAdapter.prototype, \"_rotation\", {\n        get: function () {\n            return this._adaptee.rotationZ;\n        },\n        set: function (value) {\n            this._adaptee.rotationZ = value;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(AS2SymbolAdapter.prototype, \"_x\", {\n        get: function () {\n            return this._adaptee.x;\n        },\n        set: function (value) {\n            this._adaptee.x = value;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(AS2SymbolAdapter.prototype, \"_y\", {\n        get: function () {\n            return this._adaptee.y;\n        },\n        set: function (value) {\n            this._adaptee.y = value;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(AS2SymbolAdapter.prototype, \"_xscale\", {\n        get: function () {\n            return this._adaptee.scaleX;\n        },\n        set: function (value) {\n            this._adaptee.scaleX = value;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(AS2SymbolAdapter.prototype, \"_yscale\", {\n        get: function () {\n            return this._adaptee.scaleY;\n        },\n        set: function (value) {\n            this._adaptee.scaleY = value;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(AS2SymbolAdapter.prototype, \"_parent\", {\n        get: function () {\n            var parentMC = this._adaptee.parent;\n            return parentMC.adapter;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    AS2SymbolAdapter.prototype.getDepth = function () {\n        return this._adaptee.z;\n    };\n    return AS2SymbolAdapter;\n})();\nmodule.exports = AS2SymbolAdapter;\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1wbGF5ZXIvbGliL2FkYXB0ZXJzL0FTMlN5bWJvbEFkYXB0ZXIudHMiXSwibmFtZXMiOlsiQVMyU3ltYm9sQWRhcHRlciIsIkFTMlN5bWJvbEFkYXB0ZXIuY29uc3RydWN0b3IiLCJBUzJTeW1ib2xBZGFwdGVyLmFkYXB0ZWUiLCJBUzJTeW1ib2xBZGFwdGVyLl9yb3RhdGlvbiIsIkFTMlN5bWJvbEFkYXB0ZXIuX3giLCJBUzJTeW1ib2xBZGFwdGVyLl95IiwiQVMyU3ltYm9sQWRhcHRlci5feHNjYWxlIiwiQVMyU3ltYm9sQWRhcHRlci5feXNjYWxlIiwiQVMyU3ltYm9sQWRhcHRlci5fcGFyZW50IiwiQVMyU3ltYm9sQWRhcHRlci5nZXREZXB0aCJdLCJtYXBwaW5ncyI6IkFBT0EsSUFBTSxnQkFBZ0I7SUE4Q2xCQSxTQTlDRUEsZ0JBQWdCQSxDQThDTkEsT0FBZ0NBO1FBRXhDQyxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxPQUFPQSxDQUFDQTtJQUM1QkEsQ0FBQ0E7SUFFREQsc0JBQUlBLHFDQUFPQTthQUFYQTtZQUVJRSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQTtRQUN6QkEsQ0FBQ0E7OztPQUFBRjtJQUVEQSxzQkFBSUEsdUNBQVNBO2FBQWJBO1lBRUlHLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLFNBQVNBLENBQUNBO1FBQ25DQSxDQUFDQTthQUVESCxVQUFjQSxLQUFjQTtZQUV4QkcsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsU0FBU0EsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFDcENBLENBQUNBOzs7T0FMQUg7SUFPREEsc0JBQUlBLGdDQUFFQTthQUFOQTtZQUVJSSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0E7YUFFREosVUFBT0EsS0FBY0E7WUFFakJJLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBO1FBQzVCQSxDQUFDQTs7O09BTEFKO0lBT0RBLHNCQUFJQSxnQ0FBRUE7YUFBTkE7WUFFSUssTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0JBLENBQUNBO2FBRURMLFVBQU9BLEtBQWNBO1lBRWpCSyxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUM1QkEsQ0FBQ0E7OztPQUxBTDtJQU9EQSxzQkFBSUEscUNBQU9BO2FBQVhBO1lBRUlNLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLE1BQU1BLENBQUNBO1FBQ2hDQSxDQUFDQTthQUVETixVQUFZQSxLQUFjQTtZQUV0Qk0sSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFDakNBLENBQUNBOzs7T0FMQU47SUFPREEsc0JBQUlBLHFDQUFPQTthQUtYQTtZQUVJTyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUNoQ0EsQ0FBQ0E7YUFSRFAsVUFBWUEsS0FBY0E7WUFFdEJPLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLE1BQU1BLEdBQUdBLEtBQUtBLENBQUNBO1FBQ2pDQSxDQUFDQTs7O09BQUFQO0lBT0RBLHNCQUFJQSxxQ0FBT0E7YUFBWEE7WUFFSVEsSUFBSUEsUUFBUUEsR0FBY0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDL0NBLE1BQU1BLENBQXNCQSxRQUFRQSxDQUFDQSxPQUFPQSxDQUFDQTtRQUNqREEsQ0FBQ0E7OztPQUFBUjtJQUVEQSxtQ0FBUUEsR0FBUkE7UUFFSVMsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDM0JBLENBQUNBO0lBQ0xULHVCQUFDQTtBQUFEQSxDQXBIQSxBQW9IQ0EsSUFBQTtBQUVELEFBQTBCLGlCQUFqQixnQkFBZ0IsQ0FBQyIsImZpbGUiOiJmbC9hZGFwdGVycy9BUzJTeW1ib2xBZGFwdGVyLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbbnVsbF19","var SymbolAdapter = (function () {\n    function SymbolAdapter(adaptee) {\n        this.adaptee = adaptee;\n    }\n    Object.defineProperty(SymbolAdapter.prototype, \"_rotation\", {\n        get: function () {\n            return this.adaptee.rotationZ;\n        },\n        set: function (value) {\n            this.adaptee.rotationZ = value;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(SymbolAdapter.prototype, \"_x\", {\n        get: function () {\n            return this.adaptee.x;\n        },\n        set: function (value) {\n            this.adaptee.x = value;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(SymbolAdapter.prototype, \"_y\", {\n        get: function () {\n            return this.adaptee.y;\n        },\n        set: function (value) {\n            this.adaptee.y = value;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(SymbolAdapter.prototype, \"_xscale\", {\n        get: function () {\n            return this.adaptee.scaleX;\n        },\n        set: function (value) {\n            this.adaptee.scaleX = value;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(SymbolAdapter.prototype, \"_yscale\", {\n        get: function () {\n            return this.adaptee.scaleY;\n        },\n        set: function (value) {\n            this.adaptee.scaleY = value;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(SymbolAdapter.prototype, \"_parent\", {\n        get: function () {\n            var parentMC = this.adaptee.parent;\n            return parentMC.adapter;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    SymbolAdapter.prototype.getDepth = function () {\n        return this.adaptee.z;\n    };\n    return SymbolAdapter;\n})();\nmodule.exports = SymbolAdapter;\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1wbGF5ZXIvbGliL2FkYXB0ZXJzL1N5bWJvbEFkYXB0ZXIudHMiXSwibmFtZXMiOlsiU3ltYm9sQWRhcHRlciIsIlN5bWJvbEFkYXB0ZXIuY29uc3RydWN0b3IiLCJTeW1ib2xBZGFwdGVyLl9yb3RhdGlvbiIsIlN5bWJvbEFkYXB0ZXIuX3giLCJTeW1ib2xBZGFwdGVyLl95IiwiU3ltYm9sQWRhcHRlci5feHNjYWxlIiwiU3ltYm9sQWRhcHRlci5feXNjYWxlIiwiU3ltYm9sQWRhcHRlci5fcGFyZW50IiwiU3ltYm9sQWRhcHRlci5nZXREZXB0aCJdLCJtYXBwaW5ncyI6IkFBT0EsSUFBTSxhQUFhO0lBOENmQSxTQTlDRUEsYUFBYUEsQ0E4Q0hBLE9BQWdDQTtRQUV4Q0MsSUFBSUEsQ0FBQ0EsT0FBT0EsR0FBR0EsT0FBT0EsQ0FBQ0E7SUFDM0JBLENBQUNBO0lBRURELHNCQUFJQSxvQ0FBU0E7YUFBYkE7WUFFSUUsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsU0FBU0EsQ0FBQ0E7UUFDbENBLENBQUNBO2FBRURGLFVBQWNBLEtBQWNBO1lBRXhCRSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxTQUFTQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUNuQ0EsQ0FBQ0E7OztPQUxBRjtJQU9EQSxzQkFBSUEsNkJBQUVBO2FBQU5BO1lBRUlHLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBO1FBQzFCQSxDQUFDQTthQUVESCxVQUFPQSxLQUFjQTtZQUVqQkcsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFDM0JBLENBQUNBOzs7T0FMQUg7SUFPREEsc0JBQUlBLDZCQUFFQTthQUFOQTtZQUVJSSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMxQkEsQ0FBQ0E7YUFFREosVUFBT0EsS0FBY0E7WUFFakJJLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBO1FBQzNCQSxDQUFDQTs7O09BTEFKO0lBT0RBLHNCQUFJQSxrQ0FBT0E7YUFBWEE7WUFFSUssTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDL0JBLENBQUNBO2FBRURMLFVBQVlBLEtBQWNBO1lBRXRCSyxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxNQUFNQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUNoQ0EsQ0FBQ0E7OztPQUxBTDtJQU9EQSxzQkFBSUEsa0NBQU9BO2FBS1hBO1lBRUlNLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLE1BQU1BLENBQUNBO1FBQy9CQSxDQUFDQTthQVJETixVQUFZQSxLQUFjQTtZQUV0Qk0sSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFDaENBLENBQUNBOzs7T0FBQU47SUFPREEsc0JBQUlBLGtDQUFPQTthQUFYQTtZQUVJTyxJQUFJQSxRQUFRQSxHQUFjQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUM5Q0EsTUFBTUEsQ0FBbUJBLFFBQVFBLENBQUNBLE9BQU9BLENBQUNBO1FBQzlDQSxDQUFDQTs7O09BQUFQO0lBRURBLGdDQUFRQSxHQUFSQTtRQUVJUSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUMxQkEsQ0FBQ0E7SUFDTFIsb0JBQUNBO0FBQURBLENBL0dBLEFBK0dDQSxJQUFBO0FBRUQsQUFBdUIsaUJBQWQsYUFBYSxDQUFDIiwiZmlsZSI6ImZsL2FkYXB0ZXJzL1N5bWJvbEFkYXB0ZXIuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOltudWxsXX0=","var __extends = this.__extends || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    __.prototype = b.prototype;\n    d.prototype = new __();\n};\nvar ColorTransform = require(\"awayjs-core/lib/geom/ColorTransform\");\nvar AssetType = require(\"awayjs-core/lib/library/AssetType\");\nvar DisplayObjectContainer = require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\nvar MovieClip = (function (_super) {\n    __extends(MovieClip, _super);\n    function MovieClip() {\n        _super.call(this);\n        this._loop = true;\n        this._prototype = this;\n        this._keyFrames = new Array();\n        this._potentialChildren = new Array();\n        this._currentFrameIndex = -1;\n        this._isPlaying = true; // auto-play\n        this._fps = 25;\n        this._time = 0;\n        this._totalFrames = 0;\n    }\n    Object.defineProperty(MovieClip.prototype, \"adapter\", {\n        // adapter is used to provide MovieClip to scripts taken from different platforms\n        // TODO: Perhaps adapters should be created dynamically whenever needed, rather than storing them\n        get: function () {\n            return this._adapter;\n        },\n        // setter typically managed by factor\n        set: function (value) {\n            this._adapter = value;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(MovieClip.prototype, \"fps\", {\n        get: function () {\n            return this._fps;\n        },\n        set: function (newFps) {\n            this._fps = newFps;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(MovieClip.prototype, \"assetType\", {\n        get: function () {\n            return AssetType.TIMELINE;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Starts playback of animation from current position\n     */\n    MovieClip.prototype.play = function () {\n        this._isPlaying = true;\n    };\n    /**\n     * should be called right before the call to away3d-render.\n     */\n    MovieClip.prototype.update = function (timeDelta) {\n        // TODO: Implement proper elastic racetrack logic\n        var frameMarker = 1000 / this._fps;\n        // right now, just advance frame once time marker has been reached\n        this._time += timeDelta;\n        if (this._time > frameMarker) {\n            this._time = 0;\n            this.advanceFrame();\n        }\n    };\n    /**\n     * Add a new TimelineFrame.\n     */\n    MovieClip.prototype.addFrame = function (newFrame) {\n        var endFrame = (newFrame.startTime + newFrame.duration) / 1000 * this._fps;\n        if (this._totalFrames < endFrame)\n            this._totalFrames = endFrame;\n        this._keyFrames.push(newFrame);\n    };\n    /**\n     * Returns the child ID for this MovieClip\n     */\n    MovieClip.prototype.getPotentialChild = function (id) {\n        return this._potentialChildren[id];\n    };\n    /**\n     * Returns the child ID for this MovieClip\n     */\n    MovieClip.prototype.registerPotentialChild = function (prototype) {\n        var id = this._potentialChildren.length;\n        this._potentialChildren[id] = prototype.clone();\n        return id;\n    };\n    MovieClip.prototype.activateChild = function (id) {\n        this.addChild(this._potentialChildren[id]);\n    };\n    MovieClip.prototype.deactivateChild = function (id) {\n        this.removeChild(this._potentialChildren[id]);\n    };\n    /**\n     * This is called inside the TimelineFrame.execute() function.\n     */\n    MovieClip.prototype.executeFrameScript = function (frameScript) {\n    };\n    /**\n     * Stop playback of animation and hold current position\n     */\n    MovieClip.prototype.stop = function () {\n        this._isPlaying = false; // no need to call any other stuff\n    };\n    MovieClip.prototype.clone = function () {\n        var clone = new MovieClip();\n        if (this._adapter)\n            clone.adapter = this._adapter.clone(clone);\n        clone._prototype = this._prototype;\n        clone._keyFrames = this._keyFrames;\n        for (var i = 0; i < this._potentialChildren.length; ++i)\n            clone._potentialChildren[i] = this._potentialChildren[i].clone();\n        clone._fps = this._fps;\n        clone._loop = this._loop;\n        clone._totalFrames = this._totalFrames;\n        clone.name = this.name;\n        clone.transform.matrix = this.transform.matrix.clone();\n        clone.transform.matrix3D = this.transform.matrix3D;\n        var ct = this.transform.colorTransform;\n        if (ct)\n            clone.transform.colorTransform = new ColorTransform(ct.redMultiplier, ct.greenMultiplier, ct.blueMultiplier, ct.alphaMultiplier, ct.redOffset, ct.greenOffset, ct.blueOffset, ct.alphaOffset);\n        return clone;\n    };\n    MovieClip.prototype.resetPlayHead = function () {\n        this._time = 0;\n        this._currentFrameIndex = 0;\n        for (var i = this.numChildren - 1; i >= 0; --i)\n            this.removeChildAt(i);\n        for (var i = 0; i < this._keyFrames.length; ++i) {\n            var keyFrame = this._keyFrames[i];\n            // deactivate any currently active keyframes first\n            if (keyFrame.isActive)\n                keyFrame.deactivate(this);\n        }\n    };\n    MovieClip.prototype.advanceFrame = function (skipFrames) {\n        if (skipFrames === void 0) { skipFrames = false; }\n        var i;\n        var advance = this._isPlaying;\n        if (advance && this._currentFrameIndex == this._totalFrames - 1 && !this._loop) {\n            advance = false;\n        }\n        if (advance && this._currentFrameIndex <= 0 && this._totalFrames == 1) {\n            this._currentFrameIndex = 0;\n            advance = false;\n        }\n        if (advance) {\n            if (++this._currentFrameIndex == this._totalFrames)\n                this.resetPlayHead();\n        }\n        this.updateKeyFrames(skipFrames);\n        // advance children\n        if (!skipFrames) {\n            var len = this.numChildren;\n            for (i = 0; i < len; i++) {\n                var child = this.getChildAt(i);\n                if (child instanceof MovieClip)\n                    child.advanceFrame(skipFrames);\n            }\n        }\n    };\n    MovieClip.prototype.updateKeyFrames = function (skipFrames) {\n        // TODO: Switch to frames over time (so we can check with ==, instead of > and active)\n        var time = this._currentFrameIndex / this._fps * 1000;\n        for (var i = 0; i < this._keyFrames.length; ++i) {\n            var keyFrame = this._keyFrames[i];\n            if (time >= keyFrame.startTime && time <= keyFrame.endTime && !keyFrame.isActive)\n                keyFrame.activate(this);\n            if (time >= keyFrame.endTime && keyFrame.isActive)\n                keyFrame.deactivate(this);\n            if (!skipFrames && keyFrame.isActive)\n                keyFrame.update(this, this._time);\n        }\n    };\n    return MovieClip;\n})(DisplayObjectContainer);\nmodule.exports = MovieClip;\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1wbGF5ZXIvbGliL2Rpc3BsYXkvTW92aWVDbGlwLnRzIl0sIm5hbWVzIjpbIk1vdmllQ2xpcCIsIk1vdmllQ2xpcC5jb25zdHJ1Y3RvciIsIk1vdmllQ2xpcC5hZGFwdGVyIiwiTW92aWVDbGlwLmZwcyIsIk1vdmllQ2xpcC5hc3NldFR5cGUiLCJNb3ZpZUNsaXAucGxheSIsIk1vdmllQ2xpcC51cGRhdGUiLCJNb3ZpZUNsaXAuYWRkRnJhbWUiLCJNb3ZpZUNsaXAuZ2V0UG90ZW50aWFsQ2hpbGQiLCJNb3ZpZUNsaXAucmVnaXN0ZXJQb3RlbnRpYWxDaGlsZCIsIk1vdmllQ2xpcC5hY3RpdmF0ZUNoaWxkIiwiTW92aWVDbGlwLmRlYWN0aXZhdGVDaGlsZCIsIk1vdmllQ2xpcC5leGVjdXRlRnJhbWVTY3JpcHQiLCJNb3ZpZUNsaXAuc3RvcCIsIk1vdmllQ2xpcC5jbG9uZSIsIk1vdmllQ2xpcC5yZXNldFBsYXlIZWFkIiwiTW92aWVDbGlwLmFkdmFuY2VGcmFtZSIsIk1vdmllQ2xpcC51cGRhdGVLZXlGcmFtZXMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sY0FBYyxXQUFXLHFDQUFxQyxDQUFDLENBQUM7QUFFdkUsSUFBTyxTQUFTLFdBQVcsbUNBQW1DLENBQUMsQ0FBQztBQUNoRSxJQUFPLHNCQUFzQixXQUFXLHNEQUFzRCxDQUFDLENBQUM7QUFNaEcsSUFBTSxTQUFTO0lBQVNBLFVBQWxCQSxTQUFTQSxVQUErQkE7SUFnQjFDQSxTQWhCRUEsU0FBU0E7UUFrQlBDLGlCQUFPQSxDQUFDQTtRQVhKQSxVQUFLQSxHQUFXQSxJQUFJQSxDQUFDQTtRQVl6QkEsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDdkJBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLElBQUlBLEtBQUtBLEVBQW9CQSxDQUFDQTtRQUNoREEsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxHQUFHQSxJQUFJQSxLQUFLQSxFQUFpQkEsQ0FBQ0E7UUFDckRB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O1lBQ25EQSxLQUFLQSxDQUFDQSxrQkFBa0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7UUFFckVBLEtBQUtBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBO1FBQ3ZCQSxLQUFLQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUN6QkEsS0FBS0EsQ0FBQ0EsWUFBWUEsR0FBR0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7UUFDdkNBLEtBQUtBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBO1FBQ3ZCQSxLQUFLQSxDQUFDQSxTQUFTQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQTtRQUN2REEsS0FBS0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsUUFBUUEsQ0FBQ0E7UUFFbkRBLElBQUlBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLGNBQWNBLENBQUNBO1FBQ3ZDQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQTtZQUFDQSxLQUFLQSxDQUFDQSxTQUFTQSxDQUFDQSxjQUFjQSxHQUFHQSxJQUFJQSxjQUFjQSxDQUFDQSxFQUFFQSxDQUFDQSxhQUFhQSxFQUFFQSxFQUFFQSxDQUFDQSxlQUFlQSxFQUFFQSxFQUFFQSxDQUFDQSxjQUFjQSxFQUFFQSxFQUFFQSxDQUFDQSxlQUFlQSxFQUFFQSxFQUFFQSxDQUFDQSxTQUFTQSxFQUFFQSxFQUFFQSxDQUFDQSxXQUFXQSxFQUFFQSxFQUFFQSxDQUFDQSxVQUFVQSxFQUFFQSxFQUFFQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQTtRQUV0TUEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7SUFD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","var AS2MovieClipAdapter = require(\"awayjs-player/lib/fl/adapters/AS2MovieClipAdapter\");\nvar MovieClip = require(\"awayjs-player/lib/fl/display/MovieClip\");\nvar AS2SceneGraphFactory = (function () {\n    function AS2SceneGraphFactory() {\n    }\n    AS2SceneGraphFactory.prototype.createMovieClip = function () {\n        var mc = new MovieClip();\n        mc.adapter = new AS2MovieClipAdapter(mc);\n        return mc;\n    };\n    return AS2SceneGraphFactory;\n})();\nmodule.exports = AS2SceneGraphFactory;\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1wbGF5ZXIvbGliL2ZhY3Rvcmllcy9BUzJTY2VuZUdyYXBoRmFjdG9yeS50cyJdLCJuYW1lcyI6WyJBUzJTY2VuZUdyYXBoRmFjdG9yeSIsIkFTMlNjZW5lR3JhcGhGYWN0b3J5LmNvbnN0cnVjdG9yIiwiQVMyU2NlbmVHcmFwaEZhY3RvcnkuY3JlYXRlTW92aWVDbGlwIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFPLG1CQUFtQixXQUFXLG1EQUFtRCxDQUFDLENBQUM7QUFDMUYsSUFBTyxTQUFTLFdBQVcsd0NBQXdDLENBQUMsQ0FBQztBQUdyRSxJQUFNLG9CQUFvQjtJQUExQkEsU0FBTUEsb0JBQW9CQTtJQVExQkMsQ0FBQ0E7SUFOR0QsOENBQWVBLEdBQWZBO1FBRUlFLElBQUlBLEVBQUVBLEdBQUdBLElBQUlBLFNBQVNBLEVBQUVBLENBQUNBO1FBQ3pCQSxFQUFFQSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxtQkFBbUJBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1FBQ3pDQSxNQUFNQSxDQUFDQSxFQUFFQSxDQUFDQTtJQUNkQSxDQUFDQTtJQUNMRiwyQkFBQ0E7QUFBREEsQ0FSQSxBQVFDQSxJQUFBO0FBQ0QsQUFBOEIsaUJBQXJCLG9CQUFvQixDQUFDIiwiZmlsZSI6ImZsL2ZhY3Rvcmllcy9BUzJTY2VuZUdyYXBoRmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6W251bGxdfQ==","/**\n * TimeLineObject represents a unique object that is (or will be) used by a TimeLine.\n *  A TimeLineObject basically consists of an objID, and an IAsset.\n *  The FrameCommands hold references to these TimeLineObjects, so they can access and modify the IAssets\n\n */\nvar InterpolationObject = (function () {\n    function InterpolationObject(type, startValue, endValue, startTime, endTime) {\n        this._type = type;\n        this._startValue = startValue;\n        this._startTime = startTime;\n        this._endValue = endValue;\n        this._duration = endTime - startTime;\n    }\n    InterpolationObject.prototype.getState = function (time, speed) {\n        // todo: handle reverse playback\n        if (time < this._startTime * speed) {\n            return;\n        }\n        if (time > this._endTime * speed) {\n            return;\n        }\n        if (this._type == 0) {\n            //interpolate number\n            return (this._startValue + (((time - this._startTime) * (this._duration * speed)) * (this._endValue - this._startValue)));\n        }\n        if (this._type == 1) {\n        }\n        if (this._type == 2) {\n        }\n        if (this._type == 3) {\n        }\n        return;\n    };\n    return InterpolationObject;\n})();\nmodule.exports = InterpolationObject;\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1wbGF5ZXIvbGliL3RpbWVsaW5lL0ludGVycG9sYXRpb25PYmplY3QudHMiXSwibmFtZXMiOlsiSW50ZXJwb2xhdGlvbk9iamVjdCIsIkludGVycG9sYXRpb25PYmplY3QuY29uc3RydWN0b3IiLCJJbnRlcnBvbGF0aW9uT2JqZWN0LmdldFN0YXRlIl0sIm1hcHBpbmdzIjoiQUFBQSxBQU1BOzs7OztHQURHO0lBQ0csbUJBQW1CO0lBU3JCQSxTQVRFQSxtQkFBbUJBLENBU1RBLElBQVdBLEVBQUVBLFVBQVVBLEVBQUVBLFFBQVFBLEVBQUVBLFNBQWdCQSxFQUFDQSxPQUFjQTtRQUUxRUMsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBQ0EsSUFBSUEsQ0FBQ0E7UUFDaEJBLElBQUlBLENBQUNBLFdBQVdBLEdBQUNBLFVBQVVBLENBQUNBO1FBQzVCQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFDQSxTQUFTQSxDQUFDQTtRQUMxQkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBQ0EsUUFBUUEsQ0FBQ0E7UUFDeEJBLElBQUlBLENBQUNBLFNBQVNBLEdBQUNBLE9BQU9BLEdBQUNBLFNBQVNBLENBQUNBO0lBQ3JDQSxDQUFDQTtJQUVNRCxzQ0FBUUEsR0FBZkEsVUFBZ0JBLElBQVdBLEVBQUVBLEtBQVlBO1FBQ3JDRSxBQUNBQSxnQ0FEZ0NBO1FBQ2hDQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNqQ0EsTUFBTUEsQ0FBQ0E7UUFDWEEsQ0FBQ0E7UUFDREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDL0JBLE1BQU1BLENBQUNBO1FBQ1hBLENBQUNBO1FBQ0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ2xCQSxBQUNBQSxvQkFEb0JBO1lBQ3BCQSxNQUFNQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUM5SEEsQ0FBQ0E7UUFDREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQUEsQ0FBQ0E7UUFFckJBLENBQUNBO1FBQ0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBRXRCQSxDQUFDQTtRQUNEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUV0QkEsQ0FBQ0E7UUFDREEsTUFBTUEsQ0FBQ0E7SUFDWEEsQ0FBQ0E7SUFDTEYsMEJBQUNBO0FBQURBLENBekNBLEFBeUNDQSxJQUFBO0FBRUQsQUFBNkIsaUJBQXBCLG1CQUFtQixDQUFDIiwiZmlsZSI6ImZsL3RpbWVsaW5lL0ludGVycG9sYXRpb25PYmplY3QuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOltudWxsXX0=","/**\n * TimelineFrame holds 3 list of FrameCommands\n *  - list1 _frameCommands should be  executed when playing the timeline (previous Frame was played)\n *  - list2 _frameCommandsReverse should be executed when playing the timeline reversed (previous Frame was played)\n *  - list3 _frameCommandsInit should be executed when jumping to a frame, so we need to fully init the frame\n *\n *  Addionial TimelineFrame properties are:\n *  - script - can be executed, after the frameCommands have been executed\n *  - list of FrameLabels, and list of corresponding labelTypes\n *  - duration-value (1 frame is not necessary 1 frame long)\n *  - startTime and endTime are needed internally when deciding what frame to display\n */\nvar TimelineKeyFrame = (function () {\n    function TimelineKeyFrame() {\n        this._duration = 1; //use millisecs for duration ? or frames ?\n        this._frameCommands = new Array();\n        this._frameConstructCommands = new Array();\n        this._frameDestructCommands = new Array();\n        this._isActive = false;\n    }\n    TimelineKeyFrame.prototype.addCommand = function (command) {\n        // make the timeline available for the commands\n        this._frameCommands.push(command);\n    };\n    TimelineKeyFrame.prototype.addConstructCommand = function (command) {\n        // make the timeline available for the commands\n        this._frameConstructCommands.push(command);\n    };\n    TimelineKeyFrame.prototype.addDestructCommand = function (command) {\n        // make the timeline available for the commands\n        this._frameDestructCommands.push(command);\n    };\n    Object.defineProperty(TimelineKeyFrame.prototype, \"startTime\", {\n        get: function () {\n            return this._startTime;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TimelineKeyFrame.prototype, \"duration\", {\n        get: function () {\n            return this._duration;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TimelineKeyFrame.prototype, \"endTime\", {\n        get: function () {\n            return this._endTime;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TimelineKeyFrame.prototype, \"isActive\", {\n        get: function () {\n            return this._isActive;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    TimelineKeyFrame.prototype.setFrameTime = function (startTime, duration) {\n        this._startTime = startTime;\n        this._duration = duration;\n        this._endTime = startTime + duration;\n    };\n    TimelineKeyFrame.prototype.activate = function (sourceMovieClip) {\n        this._isActive = true;\n        var len = this._frameConstructCommands.length;\n        for (var i = 0; i < len; i++)\n            this._frameConstructCommands[i].execute(sourceMovieClip, this._startTime);\n    };\n    TimelineKeyFrame.prototype.deactivate = function (sourceMovieClip) {\n        this._isActive = false;\n        var len = this._frameDestructCommands.length;\n        var endTime = this._duration + this._startTime;\n        for (var i = 0; i < len; i++)\n            this._frameDestructCommands[i].execute(sourceMovieClip, endTime);\n    };\n    TimelineKeyFrame.prototype.update = function (sourceMovieClip, time) {\n        var len = this._frameCommands.length;\n        for (var i = 0; i < len; i++)\n            this._frameCommands[i].execute(sourceMovieClip, time);\n    };\n    return TimelineKeyFrame;\n})();\nmodule.exports = TimelineKeyFrame;\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1wbGF5ZXIvbGliL3RpbWVsaW5lL1RpbWVsaW5lS2V5RnJhbWUudHMiXSwibmFtZXMiOlsiVGltZWxpbmVLZXlGcmFtZSIsIlRpbWVsaW5lS2V5RnJhbWUuY29uc3RydWN0b3IiLCJUaW1lbGluZUtleUZyYW1lLmFkZENvbW1hbmQiLCJUaW1lbGluZUtleUZyYW1lLmFkZENvbnN0cnVjdENvbW1hbmQiLCJUaW1lbGluZUtleUZyYW1lLmFkZERlc3RydWN0Q29tbWFuZCIsIlRpbWVsaW5lS2V5RnJhbWUuc3RhcnRUaW1lIiwiVGltZWxpbmVLZXlGcmFtZS5kdXJhdGlvbiIsIlRpbWVsaW5lS2V5RnJhbWUuZW5kVGltZSIsIlRpbWVsaW5lS2V5RnJhbWUuaXNBY3RpdmUiLCJUaW1lbGluZUtleUZyYW1lLnNldEZyYW1lVGltZSIsIlRpbWVsaW5lS2V5RnJhbWUuYWN0aXZhdGUiLCJUaW1lbGluZUtleUZyYW1lLmRlYWN0aXZhdGUiLCJUaW1lbGluZUtleUZyYW1lLnVwZGF0ZSJdLCJtYXBwaW5ncyI6IkFBcUJBLEFBWUE7Ozs7Ozs7Ozs7O0dBREc7SUFDRyxnQkFBZ0I7SUFVbEJBLFNBVkVBLGdCQUFnQkE7UUFZZEMsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsQ0FBQ0EsRUFBQ0EsMENBQTBDQTtRQUM3REEsSUFBSUEsQ0FBQ0EsY0FBY0EsR0FBR0EsSUFBSUEsS0FBS0EsRUFBZ0JBLENBQUNBO1FBQ2hEQSxJQUFJQSxDQUFDQSx1QkFBdUJBLEdBQUdBLElBQUlBLEtBQUtBLEVBQWdCQSxDQUFDQTtRQUN6REEsSUFBSUEsQ0FBQ0Esc0JBQXNCQSxHQUFHQSxJQUFJQSxLQUFLQSxFQUFnQkEsQ0FBQ0E7UUFDeERBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLEtBQUtBLENBQUNBO0lBQzNCQSxDQUFDQTtJQUVNRCxxQ0FBVUEsR0FBakJBLFVBQWtCQSxPQUFvQkE7UUFFbENFLEFBQ0FBLCtDQUQrQ0E7UUFDL0NBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO0lBQ3RDQSxDQUFDQTtJQUVNRiw4Q0FBbUJBLEdBQTFCQSxVQUEyQkEsT0FBb0JBO1FBRTNDRyxBQUNBQSwrQ0FEK0NBO1FBQy9DQSxJQUFJQSxDQUFDQSx1QkFBdUJBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO0lBQy9DQSxDQUFDQTtJQUVNSCw2Q0FBa0JBLEdBQXpCQSxVQUEwQkEsT0FBb0JBO1FBRTFDSSxBQUNBQSwrQ0FEK0NBO1FBQy9DQSxJQUFJQSxDQUFDQSxzQkFBc0JBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO0lBQzlDQSxDQUFDQTtJQUVESixzQkFBV0EsdUNBQVNBO2FBQXBCQTtZQUVJSyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQTtRQUMzQkEsQ0FBQ0E7OztPQUFBTDtJQUVEQSxzQkFBV0Esc0NBQVFBO2FBQW5CQTtZQUVJTSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQTtRQUMxQkEsQ0FBQ0E7OztPQUFBTjtJQUVEQSxzQkFBV0EscUNBQU9BO2FBQWxCQTtZQUVJTyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQTtRQUN6QkEsQ0FBQ0E7OztPQUFBUDtJQUVEQSxzQkFBV0Esc0NBQVFBO2FBQW5CQTtZQUVJUSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQTtRQUMxQkEsQ0FBQ0E7OztPQUFBUjtJQUVNQSx1Q0FBWUEsR0FBbkJBLFVBQW9CQSxTQUFnQkEsRUFBRUEsUUFBZUE7UUFFakRTLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLFNBQVNBLENBQUNBO1FBQzVCQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxRQUFRQSxDQUFDQTtRQUMxQkEsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsU0FBU0EsR0FBR0EsUUFBUUEsQ0FBQ0E7SUFDekNBLENBQUNBO0lBRU1ULG1DQUFRQSxHQUFmQSxVQUFnQkEsZUFBeUJBO1FBRXJDVSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUN0QkEsSUFBSUEsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsdUJBQXVCQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUU5Q0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsQ0FBQ0EsRUFBRUE7WUFDeEJBLElBQUlBLENBQUNBLHVCQUF1QkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsZUFBZUEsRUFBRUEsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0E7SUFDbEZBLENBQUNBO0lBRU1WLHFDQUFVQSxHQUFqQkEsVUFBa0JBLGVBQXlCQTtRQUV2Q1csSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFDdkJBLElBQUlBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBLHNCQUFzQkEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDN0NBLElBQUlBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBO1FBRS9DQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxDQUFDQSxFQUFFQTtZQUN4QkEsSUFBSUEsQ0FBQ0Esc0JBQXNCQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxlQUFlQSxFQUFFQSxPQUFPQSxDQUFDQSxDQUFDQTtJQUN6RUEsQ0FBQ0E7SUFFTVgsaUNBQU1BLEdBQWJBLFVBQWNBLGVBQXlCQSxFQUFFQSxJQUFXQTtRQUVoRFksSUFBSUEsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFFckNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLENBQUNBLEVBQUVBO1lBQ3hCQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxlQUFlQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtJQUM5REEsQ0FBQ0E7SUFDTFosdUJBQUNBO0FBQURBLENBMUZBLEFBMEZDQSxJQUFBO0FBRUQsQUFBMEIsaUJBQWpCLGdCQUFnQixDQUFDIiwiZmlsZSI6ImZsL3RpbWVsaW5lL1RpbWVsaW5lS2V5RnJhbWUuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOltudWxsXX0=","var AddChildCommand = (function () {\n    function AddChildCommand(childID) {\n        this._childID = childID;\n    }\n    AddChildCommand.prototype.execute = function (sourceMovieClip, time) {\n        sourceMovieClip.activateChild(this._childID);\n    };\n    return AddChildCommand;\n})();\nmodule.exports = AddChildCommand;\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1wbGF5ZXIvbGliL3RpbWVsaW5lL2NvbW1hbmRzL0FkZENoaWxkQ29tbWFuZC50cyJdLCJuYW1lcyI6WyJBZGRDaGlsZENvbW1hbmQiLCJBZGRDaGlsZENvbW1hbmQuY29uc3RydWN0b3IiLCJBZGRDaGlsZENvbW1hbmQuZXhlY3V0ZSJdLCJtYXBwaW5ncyI6IkFBSUEsSUFBTSxlQUFlO0lBSWpCQSxTQUpFQSxlQUFlQSxDQUlMQSxPQUFjQTtRQUV0QkMsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsT0FBT0EsQ0FBQ0E7SUFDNUJBLENBQUNBO0lBRU1ELGlDQUFPQSxHQUFkQSxVQUFlQSxlQUEyQkEsRUFBRUEsSUFBV0E7UUFFbkRFLGVBQWVBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO0lBQ2pEQSxDQUFDQTtJQUNMRixzQkFBQ0E7QUFBREEsQ0FiQSxBQWFDQSxJQUFBO0FBQ0QsQUFBeUIsaUJBQWhCLGVBQWUsQ0FBQyIsImZpbGUiOiJmbC90aW1lbGluZS9jb21tYW5kcy9BZGRDaGlsZENvbW1hbmQuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOltudWxsXX0=","var RemoveChildCommand = (function () {\n    function RemoveChildCommand(childID) {\n        this._childID = childID;\n    }\n    RemoveChildCommand.prototype.execute = function (sourceMovieClip, time) {\n        sourceMovieClip.deactivateChild(this._childID);\n    };\n    return RemoveChildCommand;\n})();\nmodule.exports = RemoveChildCommand;\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1wbGF5ZXIvbGliL3RpbWVsaW5lL2NvbW1hbmRzL1JlbW92ZUNoaWxkQ29tbWFuZC50cyJdLCJuYW1lcyI6WyJSZW1vdmVDaGlsZENvbW1hbmQiLCJSZW1vdmVDaGlsZENvbW1hbmQuY29uc3RydWN0b3IiLCJSZW1vdmVDaGlsZENvbW1hbmQuZXhlY3V0ZSJdLCJtYXBwaW5ncyI6IkFBSUEsSUFBTSxrQkFBa0I7SUFJcEJBLFNBSkVBLGtCQUFrQkEsQ0FJUkEsT0FBY0E7UUFFdEJDLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLE9BQU9BLENBQUNBO0lBQzVCQSxDQUFDQTtJQUVNRCxvQ0FBT0EsR0FBZEEsVUFBZUEsZUFBMkJBLEVBQUVBLElBQVdBO1FBRW5ERSxlQUFlQSxDQUFDQSxlQUFlQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQTtJQUNuREEsQ0FBQ0E7SUFDTEYseUJBQUNBO0FBQURBLENBYkEsQUFhQ0EsSUFBQTtBQUNELEFBQTRCLGlCQUFuQixrQkFBa0IsQ0FBQyIsImZpbGUiOiJmbC90aW1lbGluZS9jb21tYW5kcy9SZW1vdmVDaGlsZENvbW1hbmQuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOltudWxsXX0=","var UpdatePropertyCommand = (function () {\n    // target can be MovieClip, its ColorTransform, and so on\n    function UpdatePropertyCommand(targetID, propertyName, value) {\n        this._targetID = targetID;\n        this._propertyName = propertyName;\n        this._value = value;\n    }\n    UpdatePropertyCommand.prototype.execute = function (sourceMovieClip, time) {\n        var target = sourceMovieClip.getPotentialChild(this._targetID);\n        target[this._propertyName] = this._value;\n    };\n    return UpdatePropertyCommand;\n})();\nmodule.exports = UpdatePropertyCommand;\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1wbGF5ZXIvbGliL3RpbWVsaW5lL2NvbW1hbmRzL1VwZGF0ZVByb3BlcnR5Q29tbWFuZC50cyJdLCJuYW1lcyI6WyJVcGRhdGVQcm9wZXJ0eUNvbW1hbmQiLCJVcGRhdGVQcm9wZXJ0eUNvbW1hbmQuY29uc3RydWN0b3IiLCJVcGRhdGVQcm9wZXJ0eUNvbW1hbmQuZXhlY3V0ZSJdLCJtYXBwaW5ncyI6IkFBS0EsSUFBTSxxQkFBcUI7SUFNdkJBLHlEQUF5REE7SUFDekRBLFNBUEVBLHFCQUFxQkEsQ0FPWEEsUUFBaUJBLEVBQUVBLFlBQW1CQSxFQUFFQSxLQUFTQTtRQUV6REMsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsUUFBUUEsQ0FBQ0E7UUFDMUJBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLFlBQVlBLENBQUNBO1FBQ2xDQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxLQUFLQSxDQUFDQTtJQUN4QkEsQ0FBQ0E7SUFFTUQsdUNBQU9BLEdBQWRBLFVBQWVBLGVBQTJCQSxFQUFFQSxJQUFXQTtRQUVuREUsSUFBSUEsTUFBTUEsR0FBR0EsZUFBZUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQTtRQUMvREEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7SUFDN0NBLENBQUNBO0lBQ0xGLDRCQUFDQTtBQUFEQSxDQW5CQSxBQW1CQ0EsSUFBQTtBQUNELEFBQStCLGlCQUF0QixxQkFBcUIsQ0FBQyIsImZpbGUiOiJmbC90aW1lbGluZS9jb21tYW5kcy9VcGRhdGVQcm9wZXJ0eUNvbW1hbmQuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOltudWxsXX0=","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport RenderTexture\t\t\t\t= require(\"awayjs-core/lib/textures/RenderTexture\");\nimport TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nimport LightBase\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/render/IRenderer\");\nimport EntityCollector\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport DirectionalLight\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\nimport PointLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport ShadowMapperBase\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/ShadowMapperBase\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\nimport ContextGLClearMask\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLClearMask\");\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\n\nimport DepthRenderer\t\t\t\t= require(\"awayjs-renderergl/lib/DepthRenderer\");\nimport DistanceRenderer\t\t\t\t= require(\"awayjs-renderergl/lib/DistanceRenderer\");\nimport Filter3DRenderer\t\t\t\t= require(\"awayjs-renderergl/lib/Filter3DRenderer\");\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\nimport Filter3DBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/filters/Filter3DBase\");\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport IRendererPoolClass\t\t\t= require(\"awayjs-renderergl/lib/pool/IRendererPoolClass\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\nimport SkyboxRenderable\t\t\t\t= require(\"awayjs-renderergl/lib/pool/SkyboxRenderable\");\nimport RTTBufferManager\t\t\t\t= require(\"awayjs-renderergl/lib/managers/RTTBufferManager\");\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\n\n/**\n * The DefaultRenderer class provides the default rendering method. It renders the scene graph objects using the\n * materials assigned to them.\n *\n * @class away.render.DefaultRenderer\n */\nclass DefaultRenderer extends RendererBase implements IRenderer\n{\n\tpublic _pRequireDepthRender:boolean;\n\tprivate _skyboxRenderablePool:RenderablePoolBase;\n\n\tprivate _pDistanceRenderer:DepthRenderer;\n\tprivate _pDepthRenderer:DepthRenderer;\n\tprivate _skyboxProjection:Matrix3D = new Matrix3D();\n\tpublic _pFilter3DRenderer:Filter3DRenderer;\n\n\tpublic _pDepthRender:TextureProxyBase;\n\n\tprivate _antiAlias:number;\n\n\tpublic get antiAlias():number\n\t{\n\t\treturn this._antiAlias;\n\t}\n\n\tpublic set antiAlias(value:number)\n\t{\n\t\tif (this._antiAlias == value)\n\t\t\treturn;\n\n\t\tthis._antiAlias = value;\n\n\t\tthis._pBackBufferInvalid = true;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get depthPrepass():boolean\n\t{\n\t\treturn this._depthPrepass;\n\t}\n\n\tpublic set depthPrepass(value:boolean)\n\t{\n\t\tthis._depthPrepass = value;\n\t}\n\n\t/**\n\t *\n\t * @returns {*}\n\t */\n\tpublic get filters3d():Array<Filter3DBase>\n\t{\n\t\treturn this._pFilter3DRenderer? this._pFilter3DRenderer.filters : null;\n\t}\n\tpublic set filters3d(value:Array<Filter3DBase>)\n\t{\n\t\tif (value && value.length == 0)\n\t\t\tvalue = null;\n\n\t\tif (this._pFilter3DRenderer && !value) {\n\t\t\tthis._pFilter3DRenderer.dispose();\n\t\t\tthis._pFilter3DRenderer = null;\n\t\t} else if (!this._pFilter3DRenderer && value) {\n\t\t\tthis._pFilter3DRenderer = new Filter3DRenderer(this._pStage);\n\t\t\tthis._pFilter3DRenderer.filters = value;\n\t\t}\n\n\t\tif (this._pFilter3DRenderer) {\n\t\t\tthis._pFilter3DRenderer.filters = value;\n\t\t\tthis._pRequireDepthRender = this._pFilter3DRenderer.requireDepthRender;\n\t\t} else {\n\t\t\tthis._pRequireDepthRender = false;\n\n\t\t\tif (this._pDepthRender) {\n\t\t\t\tthis._pDepthRender.dispose();\n\t\t\t\tthis._pDepthRender = null;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Creates a new DefaultRenderer object.\n\t *\n\t * @param antiAlias The amount of anti-aliasing to use.\n\t * @param renderMode The render mode to use.\n\t */\n\tconstructor(rendererPoolClass:IRendererPoolClass = null, stage:Stage = null)\n\t{\n\t\tsuper(rendererPoolClass, stage);\n\n\t\tif (this._width == 0)\n\t\t\tthis.width = window.innerWidth;\n\t\telse\n\t\t\tthis._pRttBufferManager.viewWidth = this._width;\n\n\t\tif (this._height == 0)\n\t\t\tthis.height = window.innerHeight;\n\t\telse\n\t\t\tthis._pRttBufferManager.viewHeight = this._height;\n\t}\n\n\tpublic render(entityCollector:CollectorBase)\n\t{\n\t\tsuper.render(entityCollector);\n\n\t\tif (!this._pStage.recoverFromDisposal()) {//if context has Disposed by the OS,don't render at this frame\n\t\t\tthis._pBackBufferInvalid = true;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._pBackBufferInvalid)// reset or update render settings\n\t\t\tthis.pUpdateBackBuffer();\n\n\t\tif (this._shareContext && this._pContext)\n\t\t\tthis._pContext.clear(0, 0, 0, 1, 1, 0, ContextGLClearMask.DEPTH);\n\n\t\tif (this._pFilter3DRenderer) {\n\t\t\tthis.textureRatioX = this._pRttBufferManager.textureRatioX;\n\t\t\tthis.textureRatioY = this._pRttBufferManager.textureRatioY;\n\t\t} else {\n\t\t\tthis.textureRatioX = 1;\n\t\t\tthis.textureRatioY = 1;\n\t\t}\n\n\t\tif (this._pRequireDepthRender)\n\t\t\tthis.pRenderSceneDepthToTexture(<EntityCollector> entityCollector);\n\n\t\tif (this._depthPrepass)\n\t\t\tthis.pRenderDepthPrepass(<EntityCollector> entityCollector);\n\n\t\tif (this._pFilter3DRenderer && this._pContext) { //TODO\n\t\t\t//this._iRender(entityCollector, this._pFilter3DRenderer.getMainInputTexture(this._pStage), this._pRttBufferManager.renderToTextureRect);\n\t\t\t//this._pFilter3DRenderer.render(this._pStage, entityCollector.camera, this._pDepthRender);\n\n\t\t} else {\n\n\t\t\tif (this._shareContext)\n\t\t\t\tthis._iRender(entityCollector, null, this._pScissorRect);\n\t\t\telse\n\t\t\t\tthis._iRender(entityCollector);\n\t\t}\n\n\t\tsuper.render(entityCollector);\n\n\t\tif (!this._shareContext && this._pContext)\n\t\t\tthis._pContext.present();\n\n\t\t// register that a view has been rendered\n\t\tthis._pStage.bufferClear = false;\n\t}\n\n\tpublic pExecuteRender(entityCollector:EntityCollector, target:TextureProxyBase = null, scissorRect:Rectangle = null, surfaceSelector:number = 0)\n\t{\n\t\tthis.updateLights(entityCollector);\n\n\t\tsuper.pExecuteRender(entityCollector, target, scissorRect, surfaceSelector);\n\t}\n\n\tprivate updateLights(entityCollector:EntityCollector)\n\t{\n\t\tvar dirLights:Array<DirectionalLight> = entityCollector.directionalLights;\n\t\tvar pointLights:Array<PointLight> = entityCollector.pointLights;\n\t\tvar len:number, i:number;\n\t\tvar light:LightBase;\n\t\tvar shadowMapper:ShadowMapperBase;\n\n\t\tlen = dirLights.length;\n\t\tfor (i = 0; i < len; ++i) {\n\t\t\tlight = dirLights[i];\n\n\t\t\tshadowMapper = light.shadowMapper;\n\n\t\t\tif (light.castsShadows && (shadowMapper.autoUpdateShadows || shadowMapper._iShadowsInvalid ))\n\t\t\t\tshadowMapper.iRenderDepthMap(entityCollector, this._pDepthRenderer);\n\t\t}\n\n\t\tlen = pointLights.length;\n\t\tfor (i = 0; i < len; ++i) {\n\t\t\tlight = pointLights[i];\n\n\t\t\tshadowMapper = light.shadowMapper;\n\n\t\t\tif (light.castsShadows && (shadowMapper.autoUpdateShadows || shadowMapper._iShadowsInvalid))\n\t\t\t\tshadowMapper.iRenderDepthMap(entityCollector, this._pDistanceRenderer);\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic pDraw(entityCollector:EntityCollector)\n\t{\n\t\tif (entityCollector.skyBox) {\n\t\t\tthis._pContext.setDepthTest(false, ContextGLCompareMode.ALWAYS);\n\n\t\t\tthis.drawSkybox(entityCollector);\n\t\t}\n\n\t\tsuper.pDraw(entityCollector);\n\t}\n\n\tpublic _pGetRenderObject(renderable:RenderableBase, renderObjectOwner:IRenderObjectOwner):RenderObjectBase\n\t{\n\t\treturn <RenderObjectBase> renderObjectOwner.getRenderObject(renderable._pool);\n\t}\n\n\t/**\n\t * Draw the skybox if present.\n\t *\n\t * @param entityCollector The EntityCollector containing all potentially visible information.\n\t */\n\tprivate drawSkybox(entityCollector:EntityCollector)\n\t{\n\t\tvar skyBox:SkyboxRenderable = <SkyboxRenderable> this._skyboxRenderablePool.getItem(entityCollector.skyBox);\n\n\t\tvar camera:Camera = entityCollector.camera;\n\n\t\tthis.updateSkyboxProjection(camera);\n\n\t\tvar renderObject:RenderObjectBase = skyBox.renderObject = this._pGetRenderObject(skyBox, skyBox.renderObjectOwner);\n\t\tvar pass:RenderPassBase = renderObject.passes[0];\n\n\t\tthis.activatePass(skyBox, pass, camera);\n\t\tskyBox._iRender(pass, camera, this._skyboxProjection);\n\t\tthis.deactivatePass(skyBox, pass);\n\t}\n\n\tprivate updateSkyboxProjection(camera:Camera)\n\t{\n\t\tvar near:Vector3D = new Vector3D();\n\n\t\tthis._skyboxProjection.copyFrom(this._pRttViewProjectionMatrix);\n\t\tthis._skyboxProjection.copyRowTo(2, near);\n\n\t\tvar camPos:Vector3D = camera.scenePosition;\n\n\t\tvar cx:number = near.x;\n\t\tvar cy:number = near.y;\n\t\tvar cz:number = near.z;\n\t\tvar cw:number = -(near.x*camPos.x + near.y*camPos.y + near.z*camPos.z + Math.sqrt(cx*cx + cy*cy + cz*cz));\n\n\t\tvar signX:number = cx >= 0? 1 : -1;\n\t\tvar signY:number = cy >= 0? 1 : -1;\n\n\t\tvar p:Vector3D = new Vector3D(signX, signY, 1, 1);\n\n\t\tvar inverse:Matrix3D = this._skyboxProjection.clone();\n\t\tinverse.invert();\n\n\t\tvar q:Vector3D = inverse.transformVector(p);\n\n\t\tthis._skyboxProjection.copyRowTo(3, p);\n\n\t\tvar a:number = (q.x*p.x + q.y*p.y + q.z*p.z + q.w*p.w)/(cx*q.x + cy*q.y + cz*q.z + cw*q.w);\n\n\t\tthis._skyboxProjection.copyRowFrom(2, new Vector3D(cx*a, cy*a, cz*a, cw*a));\n\t}\n\n\tpublic dispose()\n\t{\n\t\tif (!this._shareContext)\n\t\t\tthis._pStage.dispose();\n\n\t\tthis._skyboxRenderablePool.dispose();\n\t\tthis._skyboxRenderablePool = null;\n\n\t\tthis._pRttBufferManager.dispose();\n\t\tthis._pRttBufferManager = null;\n\n\t\tthis._pDepthRenderer.dispose();\n\t\tthis._pDistanceRenderer.dispose();\n\t\tthis._pDepthRenderer = null;\n\t\tthis._pDistanceRenderer = null;\n\n\t\tthis._pDepthRender = null;\n\n\t\tsuper.dispose();\n\t}\n\n\n\t/**\n\t *\n\t */\n\tpublic pRenderDepthPrepass(entityCollector:EntityCollector)\n\t{\n\t\tthis._pDepthRenderer.disableColor = true;\n\n\t\tif (this._pFilter3DRenderer) { //TODO\n//\t\t\t\tthis._pDepthRenderer.textureRatioX = this._pRttBufferManager.textureRatioX;\n//\t\t\t\tthis._pDepthRenderer.textureRatioY = this._pRttBufferManager.textureRatioY;\n//\t\t\t\tthis._pDepthRenderer._iRender(entityCollector, this._pFilter3DRenderer.getMainInputTexture(this._pStage), this._pRttBufferManager.renderToTextureRect);\n\t\t} else {\n\t\t\tthis._pDepthRenderer.textureRatioX = 1;\n\t\t\tthis._pDepthRenderer.textureRatioY = 1;\n\t\t\tthis._pDepthRenderer._iRender(entityCollector);\n\t\t}\n\n\t\tthis._pDepthRenderer.disableColor = false;\n\t}\n\n\n\t/**\n\t *\n\t */\n\tpublic pRenderSceneDepthToTexture(entityCollector:EntityCollector)\n\t{\n\t\tif (this._pDepthTextureInvalid || !this._pDepthRender)\n\t\t\tthis.initDepthTexture(<IContextGL> this._pStage.context);\n\n\t\tthis._pDepthRenderer.textureRatioX = this._pRttBufferManager.textureRatioX;\n\t\tthis._pDepthRenderer.textureRatioY = this._pRttBufferManager.textureRatioY;\n\t\tthis._pDepthRenderer._iRender(entityCollector, this._pDepthRender);\n\t}\n\n\n\t/**\n\t * Updates the backbuffer dimensions.\n\t */\n\tpublic pUpdateBackBuffer()\n\t{\n\t\t// No reason trying to configure back buffer if there is no context available.\n\t\t// Doing this anyway (and relying on _stage to cache width/height for\n\t\t// context does get available) means usesSoftwareRendering won't be reliable.\n\t\tif (this._pStage.context && !this._shareContext) {\n\t\t\tif (this._width && this._height) {\n\t\t\t\tthis._pStage.configureBackBuffer(this._width, this._height, this._antiAlias, true);\n\t\t\t\tthis._pBackBufferInvalid = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic iSetStage(value:Stage)\n\t{\n\t\tsuper.iSetStage(value);\n\n\t\tif (this._pStage) {\n\t\t\tthis._pRttBufferManager = RTTBufferManager.getInstance(this._pStage);\n\n\t\t\tthis._pDepthRenderer = new DepthRenderer(this._pRendererPoolClass, this._pStage);\n\t\t\tthis._pDistanceRenderer = new DistanceRenderer(this._pRendererPoolClass, this._pStage);\n\n\t\t\tthis._skyboxRenderablePool = RenderablePoolBase.getPool(SkyboxRenderable, this._pStage);\n\t\t}\n\t}\n\n\t/**\n\t *\n\t */\n\tprivate initDepthTexture(context:IContextGL):void\n\t{\n\t\tthis._pDepthTextureInvalid = false;\n\n\t\tif (this._pDepthRender)\n\t\t\tthis._pDepthRender.dispose();\n\n\t\tthis._pDepthRender = new RenderTexture(this._pRttBufferManager.textureWidth, this._pRttBufferManager.textureHeight);\n\t}\n}\n\nexport = DefaultRenderer;","import TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport EntityCollector\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\n\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport IRendererPoolClass\t\t\t= require(\"awayjs-renderergl/lib/pool/IRendererPoolClass\");\n\n\n/**\n * The DepthRenderer class renders 32-bit depth information encoded as RGBA\n *\n * @class away.render.DepthRenderer\n */\nclass DepthRenderer extends RendererBase\n{\n\t/**\n\t * Creates a new DepthRenderer object.\n\t * @param renderBlended Indicates whether semi-transparent objects should be rendered.\n\t * @param distanceBased Indicates whether the written depth value is distance-based or projected depth-based\n\t */\n\tconstructor(rendererPoolClass:IRendererPoolClass = null, stage:Stage = null)\n\t{\n\t\tsuper(rendererPoolClass, stage);\n\n\t\tthis._iBackgroundR = 1;\n\t\tthis._iBackgroundG = 1;\n\t\tthis._iBackgroundB = 1;\n\n\t}\n\n\tpublic _pGetRenderObject(renderable:RenderableBase, renderObjectOwner:IRenderObjectOwner):RenderObjectBase\n\t{\n\t\treturn renderable._pool.getDepthRenderObject(renderObjectOwner);\n\t}\n}\n\nexport = DepthRenderer;","import TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport EntityCollector\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\n\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport IRendererPoolClass\t\t\t= require(\"awayjs-renderergl/lib/pool/IRendererPoolClass\");\n\n\n/**\n * The DistanceRenderer class renders 32-bit depth information encoded as RGBA\n *\n * @class away.render.DistanceRenderer\n */\nclass DistanceRenderer extends RendererBase\n{\n\t/**\n\t * Creates a new DistanceRenderer object.\n\t * @param renderBlended Indicates whether semi-transparent objects should be rendered.\n\t * @param distanceBased Indicates whether the written depth value is distance-based or projected depth-based\n\t */\n\tconstructor(rendererPoolClass:IRendererPoolClass = null, stage:Stage = null)\n\t{\n\t\tsuper(rendererPoolClass, stage);\n\n\t\tthis._iBackgroundR = 1;\n\t\tthis._iBackgroundG = 1;\n\t\tthis._iBackgroundB = 1;\n\n\t}\n\n\tpublic _pGetRenderObject(renderable:RenderableBase, renderObjectOwner:IRenderObjectOwner):RenderObjectBase\n\t{\n\t\treturn renderable._pool.getDistanceRenderObject(renderObjectOwner);\n\t}\n}\n\nexport = DistanceRenderer;","import Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\nimport ContextGLVertexBufferFormat\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport IIndexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IIndexBuffer\");\nimport ITexture\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITexture\");\nimport IVertexBuffer\t\t\t\t= require(\"awayjs-stagegl/lib/base/IVertexBuffer\");\n\nimport RTTBufferManager\t\t\t\t= require(\"awayjs-renderergl/lib/managers/RTTBufferManager\");\nimport Filter3DBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/filters/Filter3DBase\");\nimport Filter3DTaskBase\t\t\t\t= require(\"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase\");\n\n/**\n * @class away.render.Filter3DRenderer\n */\nclass Filter3DRenderer\n{\n\tprivate _filters:Array<Filter3DBase>;\n\tprivate _tasks:Array<Filter3DTaskBase>;\n\tprivate _filterTasksInvalid:boolean;\n\tprivate _mainInputTexture:ITexture;\n\tprivate _requireDepthRender:boolean;\n\tprivate _rttManager:RTTBufferManager;\n\tprivate _stage:Stage;\n\tprivate _filterSizesInvalid:boolean = true;\n\tprivate _onRTTResizeDelegate:(event:Event) => void;\n\n\tconstructor(stage:Stage)\n\t{\n\t\tthis._onRTTResizeDelegate = (event:Event) => this.onRTTResize(event);\n\n\t\tthis._stage = stage;\n\t\tthis._rttManager = RTTBufferManager.getInstance(stage);\n\t\tthis._rttManager.addEventListener(Event.RESIZE, this._onRTTResizeDelegate);\n\n\t}\n\n\tprivate onRTTResize(event:Event)\n\t{\n\t\tthis._filterSizesInvalid = true;\n\t}\n\n\tpublic get requireDepthRender():boolean\n\t{\n\t\treturn this._requireDepthRender;\n\t}\n\n\tpublic getMainInputTexture(stage:Stage):ITexture\n\t{\n\t\tif (this._filterTasksInvalid) {\n\n\t\t\tthis.updateFilterTasks(stage);\n\n\t\t}\n\n\t\treturn this._mainInputTexture;\n\t}\n\n\tpublic get filters():Filter3DBase[]\n\t{\n\t\treturn this._filters;\n\t}\n\n\tpublic set filters(value:Filter3DBase[])\n\t{\n\t\tthis._filters = value;\n\n\t\tthis._filterTasksInvalid = true;\n\n\t\tthis._requireDepthRender = false;\n\n\t\tif (!this._filters) {\n\n\t\t\treturn;\n\n\t\t}\n\n\t\tfor (var i:number = 0; i < this._filters.length; ++i) {\n\n\t\t\t// TODO: check logic:\n\t\t\t// this._requireDepthRender ||=  Boolean ( this._filters[i].requireDepthRender )\n\n\t\t\tvar s:any = this._filters[i];\n\t\t\tvar b:boolean = <boolean> ( s.requireDepthRender == null )? false : s.requireDepthRender;\n\n\t\t\tthis._requireDepthRender = this._requireDepthRender || b;\n\n\t\t}\n\n\t\tthis._filterSizesInvalid = true;\n\n\t}\n\n\tprivate updateFilterTasks(stage:Stage)\n\t{\n\t\tvar len:number;\n\n\t\tif (this._filterSizesInvalid) {\n\n\t\t\tthis.updateFilterSizes();\n\n\t\t}\n\n\t\tif (!this._filters) {\n\t\t\tthis._tasks = null;\n\t\t\treturn;\n\t\t}\n\n\t\tthis._tasks = new Array<Filter3DTaskBase>();\n\n\t\tlen = this._filters.length - 1;\n\n\t\tvar filter:Filter3DBase;\n\n\t\tfor (var i:number = 0; i <= len; ++i) {\n\n\t\t\t// make sure all internal tasks are linked together\n\t\t\tfilter = this._filters[i];\n\n\t\t\t// TODO: check logic\n\t\t\t// filter.setRenderTargets(i == len? null : Filter3DBase(_filters[i + 1]).getMainInputTexture(stage), stage);\n\n\t\t\tfilter.setRenderTargets(i == len? null : this._filters[i + 1].getMainInputTexture(stage), stage);\n\n\t\t\tthis._tasks = this._tasks.concat(filter.tasks);\n\n\t\t}\n\n\t\tthis._mainInputTexture = this._filters[0].getMainInputTexture(stage);\n\n\t}\n\n\tpublic render(stage:Stage, camera:Camera, depthTexture:ITexture)\n\t{\n\t\tvar len:number;\n\t\tvar i:number;\n\t\tvar task:Filter3DTaskBase;\n\t\tvar context:IContextGL = <IContextGL> stage.context;\n\n\t\tvar indexBuffer:IIndexBuffer = this._rttManager.indexBuffer;\n\n\t\tvar vertexBuffer:IVertexBuffer = this._rttManager.renderToTextureVertexBuffer;\n\n\t\tif (!this._filters) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._filterSizesInvalid) {\n\t\t\tthis.updateFilterSizes();\n\t\t}\n\n\t\tif (this._filterTasksInvalid) {\n\t\t\tthis.updateFilterTasks(stage);\n\t\t}\n\n\t\tlen = this._filters.length;\n\n\t\tfor (i = 0; i < len; ++i) {\n\t\t\tthis._filters[i].update(stage, camera);\n\t\t}\n\n\t\tlen = this._tasks.length;\n\n\t\tif (len > 1) {\n\t\t\tcontext.setVertexBufferAt(0, vertexBuffer, 0, ContextGLVertexBufferFormat.FLOAT_2);\n\t\t\tcontext.setVertexBufferAt(1, vertexBuffer, 2, ContextGLVertexBufferFormat.FLOAT_2);\n\t\t}\n\n\t\tfor (i = 0; i < len; ++i) {\n\n\t\t\ttask = this._tasks[i];\n\n\t\t\t//stage.setRenderTarget(task.target); //TODO\n\n\t\t\tif (!task.target) {\n\n\t\t\t\tstage.scissorRect = null;\n\t\t\t\tvertexBuffer = this._rttManager.renderToScreenVertexBuffer;\n\t\t\t\tcontext.setVertexBufferAt(0, vertexBuffer, 0, ContextGLVertexBufferFormat.FLOAT_2);\n\t\t\t\tcontext.setVertexBufferAt(1, vertexBuffer, 2, ContextGLVertexBufferFormat.FLOAT_2);\n\n\t\t\t}\n\n\t\t\tcontext.setTextureAt(0, task.getMainInputTexture(stage));\n\t\t\tcontext.setProgram(task.getProgram(stage));\n\t\t\tcontext.clear(0.0, 0.0, 0.0, 0.0);\n\n\t\t\ttask.activate(stage, camera, depthTexture);\n\n\t\t\tcontext.setBlendFactors(ContextGLBlendFactor.ONE, ContextGLBlendFactor.ZERO);\n\t\t\tcontext.drawTriangles(indexBuffer, 0, 2);\n\n\t\t\ttask.deactivate(stage);\n\t\t}\n\n\t\tcontext.setTextureAt(0, null);\n\t\tcontext.setVertexBufferAt(0, null);\n\t\tcontext.setVertexBufferAt(1, null);\n\t}\n\n\tprivate updateFilterSizes()\n\t{\n\t\tfor (var i:number = 0; i < this._filters.length; ++i) {\n\t\t\tthis._filters[i].textureWidth = this._rttManager.textureWidth;\n\t\t\tthis._filters[i].textureHeight = this._rttManager.textureHeight;\n\t\t}\n\n\t\tthis._filterSizesInvalid = true;\n\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._rttManager.removeEventListener(Event.RESIZE, this._onRTTResizeDelegate);\n\t\tthis._rttManager = null;\n\t\tthis._stage = null;\n\t}\n}\n\nexport = Filter3DRenderer;","import AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport IAsset\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport NamedAssetBase\t\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nimport AnimationNodeBase\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport AnimationSetError\t\t\t= require(\"awayjs-renderergl/lib/errors/AnimationSetError\");\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\n/**\n * Provides an abstract base class for data set classes that hold animation data for use in animator classes.\n *\n * @see away.animators.AnimatorBase\n */\nclass AnimationSetBase extends NamedAssetBase implements IAsset\n{\n\tprivate _usesCPU:boolean;\n\tprivate _animations:Array<AnimationNodeBase> = new Array<AnimationNodeBase>();\n\tprivate _animationNames:Array<string> = new Array<string>();\n\tprivate _animationDictionary:Object = new Object();\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * Retrieves a temporary GPU register that's still free.\n\t *\n\t * @param exclude An array of non-free temporary registers.\n\t * @param excludeAnother An additional register that's not free.\n\t * @return A temporary register that can be used.\n\t */\n\tpublic _pFindTempReg(exclude:Array<string>, excludeAnother:string = null):string\n\t{\n\t\tvar i:number /*uint*/ = 0;\n\t\tvar reg:string;\n\n\t\twhile (true) {\n\t\t\treg = \"vt\" + i;\n\t\t\tif (exclude.indexOf(reg) == -1 && excludeAnother != reg)\n\t\t\t\treturn reg;\n\t\t\t++i;\n\t\t}\n\n\t\t// can't be reached\n\t\treturn null;\n\t}\n\n\t/**\n\t * Indicates whether the properties of the animation data contained within the set combined with\n\t * the vertex registers already in use on shading materials allows the animation data to utilise\n\t * GPU calls.\n\t */\n\tpublic get usesCPU():boolean\n\t{\n\t\treturn this._usesCPU;\n\t}\n\n\t/**\n\t * Called by the material to reset the GPU indicator before testing whether register space in the shader\n\t * is available for running GPU-based animation code.\n\t *\n\t * @private\n\t */\n\tpublic resetGPUCompatibility()\n\t{\n\t\tthis._usesCPU = false;\n\t}\n\n\tpublic cancelGPUCompatibility()\n\t{\n\t\tthis._usesCPU = true;\n\t}\n\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase):string\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic activate(shaderObject:ShaderObjectBase, stage:Stage)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic deactivate(shaderObject:ShaderObjectBase, stage:Stage)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALFragmentCode(shaderObject:ShaderObjectBase, shadedTarget:string):string\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALUVCode(shaderObject:ShaderObjectBase):string\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic doneAGALCode(shaderObject:ShaderObjectBase)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.ANIMATION_SET;\n\t}\n\n\t/**\n\t * Returns a vector of animation state objects that make up the contents of the animation data set.\n\t */\n\tpublic get animations():Array<AnimationNodeBase>\n\t{\n\t\treturn this._animations;\n\t}\n\n\t/**\n\t * Returns a vector of animation state objects that make up the contents of the animation data set.\n\t */\n\tpublic get animationNames():Array<string>\n\t{\n\t\treturn this._animationNames;\n\t}\n\n\t/**\n\t * Check to determine whether a state is registered in the animation set under the given name.\n\t *\n\t * @param stateName The name of the animation state object to be checked.\n\t */\n\tpublic hasAnimation(name:string):boolean\n\t{\n\t\treturn this._animationDictionary[name] != null;\n\t}\n\n\t/**\n\t * Retrieves the animation state object registered in the animation data set under the given name.\n\t *\n\t * @param stateName The name of the animation state object to be retrieved.\n\t */\n\tpublic getAnimation(name:string):AnimationNodeBase\n\t{\n\t\treturn this._animationDictionary[name];\n\t}\n\n\t/**\n\t * Adds an animation state object to the aniamtion data set under the given name.\n\t *\n\t * @param stateName The name under which the animation state object will be stored.\n\t * @param animationState The animation state object to be staored in the set.\n\t */\n\tpublic addAnimation(node:AnimationNodeBase)\n\t{\n\t\tif (this._animationDictionary[node.name])\n\t\t\tthrow new AnimationSetError(\"root node name '\" + node.name + \"' already exists in the set\");\n\n\t\tthis._animationDictionary[node.name] = node;\n\n\t\tthis._animations.push(node);\n\n\t\tthis._animationNames.push(node.name);\n\t}\n\n\t/**\n\t * Cleans up any resources used by the current object.\n\t */\n\tpublic dispose()\n\t{\n\t}\n}\n\nexport = AnimationSetBase;","import Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport NamedAssetBase\t\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\nimport RequestAnimationFrame\t\t= require(\"awayjs-core/lib/utils/RequestAnimationFrame\");\nimport getTimer\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/getTimer\");\n\nimport IAnimationSet\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimationSet\");\nimport IAnimator\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimator\");\nimport AnimationNodeBase\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport Mesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport IAnimationState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/IAnimationState\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport TriangleSubMeshRenderable\t= require(\"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable\");\nimport AnimatorEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/AnimatorEvent\");\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\n\n/**\n * Dispatched when playback of an animation inside the animator object starts.\n *\n * @eventType away3d.events.AnimatorEvent\n */\n//[Event(name=\"start\", type=\"away3d.events.AnimatorEvent\")]\n\n/**\n * Dispatched when playback of an animation inside the animator object stops.\n *\n * @eventType away3d.events.AnimatorEvent\n */\n//[Event(name=\"stop\", type=\"away3d.events.AnimatorEvent\")]\n\n/**\n * Dispatched when playback of an animation reaches the end of an animation.\n *\n * @eventType away3d.events.AnimatorEvent\n */\n//[Event(name=\"cycle_complete\", type=\"away3d.events.AnimatorEvent\")]\n\n/**\n * Provides an abstract base class for animator classes that control animation output from a data set subtype of <code>AnimationSetBase</code>.\n *\n * @see away.animators.AnimationSetBase\n */\nclass AnimatorBase extends NamedAssetBase implements IAnimator\n{\n\tprivate _broadcaster:RequestAnimationFrame;\n\tprivate _isPlaying:boolean;\n\tprivate _autoUpdate:boolean = true;\n\tprivate _startEvent:AnimatorEvent;\n\tprivate _stopEvent:AnimatorEvent;\n\tprivate _cycleEvent:AnimatorEvent;\n\tprivate _time:number /*int*/ = 0;\n\tprivate _playbackSpeed:number = 1;\n\n\tpublic _pAnimationSet:IAnimationSet;\n\tpublic _pOwners:Array<Mesh> = new Array<Mesh>();\n\tpublic _pActiveNode:AnimationNodeBase;\n\tpublic _pActiveState:IAnimationState;\n\tpublic _pActiveAnimationName:string;\n\tpublic _pAbsoluteTime:number = 0;\n\n\tprivate _animationStates:Object = new Object();\n\n\t/**\n\t * Enables translation of the animated mesh from data returned per frame via the positionDelta property of the active animation node. Defaults to true.\n\t *\n\t * @see away.animators.IAnimationState#positionDelta\n\t */\n\tpublic updatePosition:boolean = true;\n\n\tpublic getAnimationState(node:AnimationNodeBase):IAnimationState\n\t{\n\t\tvar className:any = node.stateClass;\n\t\tvar uID:number = node.id;\n\n\t\tif (this._animationStates[uID] == null)\n\t\t\tthis._animationStates[uID] = new className(this, node);\n\n\t\treturn this._animationStates[uID];\n\t}\n\n\tpublic getAnimationStateByName(name:string):IAnimationState\n\t{\n\t\treturn this.getAnimationState(this._pAnimationSet.getAnimation(name));\n\t}\n\n\t/**\n\t * Returns the internal absolute time of the animator, calculated by the current time and the playback speed.\n\t *\n\t * @see #time\n\t * @see #playbackSpeed\n\t */\n\tpublic get absoluteTime():number\n\t{\n\t\treturn this._pAbsoluteTime;\n\t}\n\n\t/**\n\t * Returns the animation data set in use by the animator.\n\t */\n\tpublic get animationSet():IAnimationSet\n\t{\n\t\treturn this._pAnimationSet;\n\t}\n\n\t/**\n\t * Returns the current active animation state.\n\t */\n\tpublic get activeState():IAnimationState\n\t{\n\t\treturn this._pActiveState;\n\t}\n\n\t/**\n\t * Returns the current active animation node.\n\t */\n\tpublic get activeAnimation():AnimationNodeBase\n\t{\n\t\treturn this._pAnimationSet.getAnimation(this._pActiveAnimationName);\n\t}\n\n\t/**\n\t * Returns the current active animation node.\n\t */\n\tpublic get activeAnimationName():string\n\t{\n\t\treturn this._pActiveAnimationName;\n\t}\n\n\t/**\n\t * Determines whether the animators internal update mechanisms are active. Used in cases\n\t * where manual updates are required either via the <code>time</code> property or <code>update()</code> method.\n\t * Defaults to true.\n\t *\n\t * @see #time\n\t * @see #update()\n\t */\n\tpublic get autoUpdate():boolean\n\t{\n\t\treturn this._autoUpdate;\n\t}\n\n\tpublic set autoUpdate(value:boolean)\n\t{\n\t\tif (this._autoUpdate == value)\n\t\t\treturn;\n\n\t\tthis._autoUpdate = value;\n\n\t\tif (this._autoUpdate)\n\t\t\tthis.start(); else\n\t\t\tthis.stop();\n\t}\n\n\t/**\n\t * Gets and sets the internal time clock of the animator.\n\t */\n\tpublic get time():number /*int*/\n\t{\n\t\treturn this._time;\n\t}\n\n\tpublic set time(value:number /*int*/)\n\t{\n\t\tif (this._time == value)\n\t\t\treturn;\n\n\t\tthis.update(value);\n\t}\n\n\t/**\n\t * Sets the animation phase of the current active state's animation clip(s).\n\t *\n\t * @param value The phase value to use. 0 represents the beginning of an animation clip, 1 represents the end.\n\t */\n\tpublic phase(value:number)\n\t{\n\t\tthis._pActiveState.phase(value);\n\t}\n\n\t/**\n\t * Creates a new <code>AnimatorBase</code> object.\n\t *\n\t * @param animationSet The animation data set to be used by the animator object.\n\t */\n\tconstructor(animationSet:IAnimationSet)\n\t{\n\t\tsuper();\n\n\t\tthis._pAnimationSet = animationSet;\n\n\t\tthis._broadcaster = new RequestAnimationFrame(this.onEnterFrame, this);\n\t}\n\n\t/**\n\t * The amount by which passed time should be scaled. Used to slow down or speed up animations. Defaults to 1.\n\t */\n\tpublic get playbackSpeed():number\n\t{\n\t\treturn this._playbackSpeed;\n\t}\n\n\tpublic set playbackSpeed(value:number)\n\t{\n\t\tthis._playbackSpeed = value;\n\t}\n\n\tpublic setRenderState(shaderObject:ShaderObjectBase, renderable:RenderableBase, stage:Stage, camera:Camera, vertexConstantOffset:number /*int*/, vertexStreamOffset:number /*int*/)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * Resumes the automatic playback clock controling the active state of the animator.\n\t */\n\tpublic start()\n\t{\n\t\tif (this._isPlaying || !this._autoUpdate)\n\t\t\treturn;\n\n\t\tthis._time = this._pAbsoluteTime = getTimer();\n\n\t\tthis._isPlaying = true;\n\n\t\tthis._broadcaster.start();\n\n\t\tif (!this.hasEventListener(AnimatorEvent.START))\n\t\t\treturn;\n\n\t\tif (this._startEvent == null)\n\t\t\tthis._startEvent = new AnimatorEvent(AnimatorEvent.START, this);\n\n\t\tthis.dispatchEvent(this._startEvent);\n\t}\n\n\t/**\n\t * Pauses the automatic playback clock of the animator, in case manual updates are required via the\n\t * <code>time</code> property or <code>update()</code> method.\n\t *\n\t * @see #time\n\t * @see #update()\n\t */\n\tpublic stop()\n\t{\n\t\tif (!this._isPlaying)\n\t\t\treturn;\n\n\t\tthis._isPlaying = false;\n\n\t\tthis._broadcaster.stop();\n\n\t\tif (!this.hasEventListener(AnimatorEvent.STOP))\n\t\t\treturn;\n\n\t\tif (this._stopEvent == null)\n\t\t\tthis._stopEvent = new AnimatorEvent(AnimatorEvent.STOP, this);\n\n\t\tthis.dispatchEvent(this._stopEvent);\n\t}\n\n\t/**\n\t * Provides a way to manually update the active state of the animator when automatic\n\t * updates are disabled.\n\t *\n\t * @see #stop()\n\t * @see #autoUpdate\n\t */\n\tpublic update(time:number /*int*/)\n\t{\n\t\tvar dt:number = (time - this._time)*this.playbackSpeed;\n\n\t\tthis._pUpdateDeltaTime(dt);\n\n\t\tthis._time = time;\n\t}\n\n\tpublic reset(name:string, offset:number = 0)\n\t{\n\t\tthis.getAnimationState(this._pAnimationSet.getAnimation(name)).offset(offset + this._pAbsoluteTime);\n\t}\n\n\t/**\n\t * Used by the mesh object to which the animator is applied, registers the owner for internal use.\n\t *\n\t * @private\n\t */\n\tpublic addOwner(mesh:Mesh)\n\t{\n\t\tthis._pOwners.push(mesh);\n\t}\n\n\t/**\n\t * Used by the mesh object from which the animator is removed, unregisters the owner for internal use.\n\t *\n\t * @private\n\t */\n\tpublic removeOwner(mesh:Mesh)\n\t{\n\t\tthis._pOwners.splice(this._pOwners.indexOf(mesh), 1);\n\t}\n\n\t/**\n\t * Internal abstract method called when the time delta property of the animator's contents requires updating.\n\t *\n\t * @private\n\t */\n\tpublic _pUpdateDeltaTime(dt:number)\n\t{\n\t\tthis._pAbsoluteTime += dt;\n\n\t\tthis._pActiveState.update(this._pAbsoluteTime);\n\n\t\tif (this.updatePosition)\n\t\t\tthis.applyPositionDelta();\n\t}\n\n\t/**\n\t * Enter frame event handler for automatically updating the active state of the animator.\n\t */\n\tprivate onEnterFrame(event:Event = null)\n\t{\n\t\tthis.update(getTimer());\n\t}\n\n\tprivate applyPositionDelta()\n\t{\n\t\tvar delta:Vector3D = this._pActiveState.positionDelta;\n\t\tvar dist:number = delta.length;\n\t\tvar len:number /*uint*/;\n\t\tif (dist > 0) {\n\t\t\tlen = this._pOwners.length;\n\t\t\tfor (var i:number /*uint*/ = 0; i < len; ++i)\n\t\t\t\tthis._pOwners[i].translateLocal(delta, dist);\n\t\t}\n\t}\n\n\t/**\n\t *  for internal use.\n\t *\n\t * @private\n\t */\n\tpublic dispatchCycleEvent()\n\t{\n\t\tif (this.hasEventListener(AnimatorEvent.CYCLE_COMPLETE)) {\n\t\t\tif (this._cycleEvent == null)\n\t\t\t\tthis._cycleEvent = new AnimatorEvent(AnimatorEvent.CYCLE_COMPLETE, this);\n\n\t\t\tthis.dispatchEvent(this._cycleEvent);\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic clone():AnimatorBase\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic testGPUCompatibility(shaderObject:ShaderObjectBase)\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.ANIMATOR;\n\t}\n\n\n\tpublic getRenderableSubGeometry(renderable:TriangleSubMeshRenderable, sourceSubGeometry:TriangleSubGeometry):TriangleSubGeometry\n\t{\n\t\t//nothing to do here\n\t\treturn sourceSubGeometry;\n\t}\n}\n\nexport = AnimatorBase;","import IAnimationSet\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimationSet\");\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\nimport ISubMesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/ISubMesh\");\nimport SubGeometryBase\t\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport AnimationSetBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticleAnimationData\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleAnimationData\");\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleData\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleData\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleTimeNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode\");\nimport ParticleGeometry\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/ParticleGeometry\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\n\n\n/**\n * The animation data set used by particle-based animators, containing particle animation data.\n *\n * @see away.animators.ParticleAnimator\n */\nclass ParticleAnimationSet extends AnimationSetBase implements IAnimationSet\n{\n\t/** @private */\n\tpublic _iAnimationRegisterCache:AnimationRegisterCache;\n\n\t//all other nodes dependent on it\n\tprivate _timeNode:ParticleTimeNode;\n\n\t/**\n\t * Property used by particle nodes that require compilation at the end of the shader\n\t */\n\tpublic static POST_PRIORITY:number /*int*/ = 9;\n\n\t/**\n\t * Property used by particle nodes that require color compilation\n\t */\n\tpublic static COLOR_PRIORITY:number /*int*/ = 18;\n\n\tprivate _animationSubGeometries:Object = new Object();\n\tprivate _particleNodes:Array<ParticleNodeBase> = new Array<ParticleNodeBase>();\n\tprivate _localDynamicNodes:Array<ParticleNodeBase> = new Array<ParticleNodeBase>();\n\tprivate _localStaticNodes:Array<ParticleNodeBase> = new Array<ParticleNodeBase>();\n\tprivate _totalLenOfOneVertex:number /*int*/ = 0;\n\n\t//set true if has an node which will change UV\n\tpublic hasUVNode:boolean;\n\t//set if the other nodes need to access the velocity\n\tpublic needVelocity:boolean;\n\t//set if has a billboard node.\n\tpublic hasBillboard:boolean;\n\t//set if has an node which will apply color multiple operation\n\tpublic hasColorMulNode:boolean;\n\t//set if has an node which will apply color add operation\n\tpublic hasColorAddNode:boolean;\n\n\t/**\n\t * Initialiser function for static particle properties. Needs to reference a with the following format\n\t *\n\t * <code>\n\t * initParticleFunc(prop:ParticleProperties)\n\t * {\n\t * \t\t//code for settings local properties\n\t * }\n\t * </code>\n\t *\n\t * Aside from setting any properties required in particle animation nodes using local static properties, the initParticleFunc function\n\t * is required to time node requirements as they may be needed. These properties on the ParticleProperties object can include\n\t * <code>startTime</code>, <code>duration</code> and <code>delay</code>. The use of these properties is determined by the setting\n\t * arguments passed in the constructor of the particle animation set. By default, only the <code>startTime</code> property is required.\n\t */\n\tpublic initParticleFunc:Function;\n\n\t/**\n\t * Initialiser function scope for static particle properties\n\t */\n\tpublic initParticleScope:Object;\n\n\t/**\n\t * Creates a new <code>ParticleAnimationSet</code>\n\t *\n\t * @param    [optional] usesDuration    Defines whether the animation set uses the <code>duration</code> data in its static properties to determine how long a particle is visible for. Defaults to false.\n\t * @param    [optional] usesLooping     Defines whether the animation set uses a looping timeframe for each particle determined by the <code>startTime</code>, <code>duration</code> and <code>delay</code> data in its static properties function. Defaults to false. Requires <code>usesDuration</code> to be true.\n\t * @param    [optional] usesDelay       Defines whether the animation set uses the <code>delay</code> data in its static properties to determine how long a particle is hidden for. Defaults to false. Requires <code>usesLooping</code> to be true.\n\t */\n\tconstructor(usesDuration:boolean = false, usesLooping:boolean = false, usesDelay:boolean = false)\n\t{\n\t\tsuper();\n\n\t\t//automatically add a particle time node to the set\n\t\tthis.addAnimation(this._timeNode = new ParticleTimeNode(usesDuration, usesLooping, usesDelay));\n\t}\n\n\t/**\n\t * Returns a vector of the particle animation nodes contained within the set.\n\t */\n\tpublic get particleNodes():Array<ParticleNodeBase>\n\t{\n\t\treturn this._particleNodes;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic addAnimation(node:AnimationNodeBase)\n\t{\n\t\tvar i:number /*int*/;\n\t\tvar n:ParticleNodeBase = <ParticleNodeBase> node;\n\t\tn._iProcessAnimationSetting(this);\n\t\tif (n.mode == ParticlePropertiesMode.LOCAL_STATIC) {\n\t\t\tn._iDataOffset = this._totalLenOfOneVertex;\n\t\t\tthis._totalLenOfOneVertex += n.dataLength;\n\t\t\tthis._localStaticNodes.push(n);\n\t\t} else if (n.mode == ParticlePropertiesMode.LOCAL_DYNAMIC)\n\t\t\tthis._localDynamicNodes.push(n);\n\n\t\tfor (i = this._particleNodes.length - 1; i >= 0; i--) {\n\t\t\tif (this._particleNodes[i].priority <= n.priority)\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis._particleNodes.splice(i + 1, 0, n);\n\n\t\tsuper.addAnimation(node);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic activate(shaderObject:ShaderObjectBase, stage:Stage)\n\t{\n//\t\t\tthis._iAnimationRegisterCache = pass.animationRegisterCache;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic deactivate(shaderObject:ShaderObjectBase, stage:Stage)\n\t{\n//\t\t\tvar context:IContextGL = <IContextGL> stage.context;\n//\t\t\tvar offset:number /*int*/ = this._iAnimationRegisterCache.vertexAttributesOffset;\n//\t\t\tvar used:number /*int*/ = this._iAnimationRegisterCache.numUsedStreams;\n//\t\t\tfor (var i:number /*int*/ = offset; i < used; i++)\n//\t\t\t\tcontext.setVertexBufferAt(i, null);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase):string\n\t{\n\t\t//grab animationRegisterCache from the materialpassbase or create a new one if the first time\n\t\tthis._iAnimationRegisterCache = shaderObject.animationRegisterCache;\n\n\t\tif (this._iAnimationRegisterCache == null)\n\t\t\tthis._iAnimationRegisterCache = shaderObject.animationRegisterCache = new AnimationRegisterCache(shaderObject.profile);\n\n\t\t//reset animationRegisterCache\n\t\tthis._iAnimationRegisterCache.vertexConstantOffset = shaderObject.numUsedVertexConstants;\n\t\tthis._iAnimationRegisterCache.vertexAttributesOffset = shaderObject.numUsedStreams;\n\t\tthis._iAnimationRegisterCache.varyingsOffset = shaderObject.numUsedVaryings;\n\t\tthis._iAnimationRegisterCache.fragmentConstantOffset = shaderObject.numUsedFragmentConstants;\n\t\tthis._iAnimationRegisterCache.hasUVNode = this.hasUVNode;\n\t\tthis._iAnimationRegisterCache.needVelocity = this.needVelocity;\n\t\tthis._iAnimationRegisterCache.hasBillboard = this.hasBillboard;\n\t\tthis._iAnimationRegisterCache.sourceRegisters = shaderObject.animatableAttributes;\n\t\tthis._iAnimationRegisterCache.targetRegisters = shaderObject.animationTargetRegisters;\n\t\tthis._iAnimationRegisterCache.needFragmentAnimation = shaderObject.usesFragmentAnimation;\n\t\tthis._iAnimationRegisterCache.needUVAnimation = !shaderObject.usesUVTransform;\n\t\tthis._iAnimationRegisterCache.hasColorAddNode = this.hasColorAddNode;\n\t\tthis._iAnimationRegisterCache.hasColorMulNode = this.hasColorMulNode;\n\t\tthis._iAnimationRegisterCache.reset();\n\n\t\tvar code:string = \"\";\n\n\t\tcode += this._iAnimationRegisterCache.getInitCode();\n\n\t\tvar node:ParticleNodeBase;\n\t\tvar i:number /*int*/;\n\n\t\tfor (i = 0; i < this._particleNodes.length; i++) {\n\t\t\tnode = this._particleNodes[i];\n\t\t\tif (node.priority < ParticleAnimationSet.POST_PRIORITY)\n\t\t\t\tcode += node.getAGALVertexCode(shaderObject, this._iAnimationRegisterCache);\n\t\t}\n\n\t\tcode += this._iAnimationRegisterCache.getCombinationCode();\n\n\t\tfor (i = 0; i < this._particleNodes.length; i++) {\n\t\t\tnode = this._particleNodes[i];\n\t\t\tif (node.priority >= ParticleAnimationSet.POST_PRIORITY && node.priority < ParticleAnimationSet.COLOR_PRIORITY)\n\t\t\t\tcode += node.getAGALVertexCode(shaderObject, this._iAnimationRegisterCache);\n\t\t}\n\n\t\tcode += this._iAnimationRegisterCache.initColorRegisters();\n\n\t\tfor (i = 0; i < this._particleNodes.length; i++) {\n\t\t\tnode = this._particleNodes[i];\n\t\t\tif (node.priority >= ParticleAnimationSet.COLOR_PRIORITY)\n\t\t\t\tcode += node.getAGALVertexCode(shaderObject, this._iAnimationRegisterCache);\n\t\t}\n\t\tcode += this._iAnimationRegisterCache.getColorPassCode();\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALUVCode(shaderObject:ShaderObjectBase):string\n\t{\n\t\tvar code:string = \"\";\n\t\tif (this.hasUVNode) {\n\t\t\tthis._iAnimationRegisterCache.setUVSourceAndTarget(shaderObject.uvSource, shaderObject.uvTarget);\n\t\t\tcode += \"mov \" + this._iAnimationRegisterCache.uvTarget + \".xy,\" + this._iAnimationRegisterCache.uvAttribute.toString() + \"\\n\";\n\t\t\tvar node:ParticleNodeBase;\n\t\t\tfor (var i:number /*uint*/ = 0; i < this._particleNodes.length; i++)\n\t\t\t\tnode = this._particleNodes[i];\n\t\t\t\tcode += node.getAGALUVCode(shaderObject, this._iAnimationRegisterCache);\n\t\t\tcode += \"mov \" + this._iAnimationRegisterCache.uvVar.toString() + \",\" + this._iAnimationRegisterCache.uvTarget + \".xy\\n\";\n\t\t} else\n\t\t\tcode += \"mov \" + shaderObject.uvTarget + \",\" + shaderObject.uvSource + \"\\n\";\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALFragmentCode(shaderObject:ShaderObjectBase, shadedTarget:string):string\n\t{\n\t\treturn this._iAnimationRegisterCache.getColorCombinationCode(shadedTarget);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic doneAGALCode(shaderObject:ShaderObjectBase)\n\t{\n\t\tthis._iAnimationRegisterCache.setDataLength();\n\n\t\t//set vertexZeroConst,vertexOneConst,vertexTwoConst\n\t\tthis._iAnimationRegisterCache.setVertexConst(this._iAnimationRegisterCache.vertexZeroConst.index, 0, 1, 2, 0);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get usesCPU():boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic cancelGPUCompatibility()\n\t{\n\n\t}\n\n\tpublic dispose()\n\t{\n\t\tfor (var key in this._animationSubGeometries)\n\t\t\t(<AnimationSubGeometry> this._animationSubGeometries[key]).dispose();\n\n\t\tsuper.dispose();\n\t}\n\n\tpublic getAnimationSubGeometry(subMesh:ISubMesh)\n\t{\n\t\tvar mesh:Mesh = subMesh.parentMesh;\n\t\tvar animationSubGeometry:AnimationSubGeometry = (mesh.shareAnimationGeometry)? this._animationSubGeometries[subMesh.subGeometry.id] : this._animationSubGeometries[subMesh.id];\n\n\t\tif (animationSubGeometry)\n\t\t\treturn animationSubGeometry;\n\n\t\tthis._iGenerateAnimationSubGeometries(mesh);\n\n\t\treturn (mesh.shareAnimationGeometry)? this._animationSubGeometries[subMesh.subGeometry.id] : this._animationSubGeometries[subMesh.id];\n\t}\n\n\n\t/** @private */\n\tpublic _iGenerateAnimationSubGeometries(mesh:Mesh)\n\t{\n\t\tif (this.initParticleFunc == null)\n\t\t\tthrow(new Error(\"no initParticleFunc set\"));\n\n\t\tvar geometry:ParticleGeometry = <ParticleGeometry> mesh.geometry;\n\n\t\tif (!geometry)\n\t\t\tthrow(new Error(\"Particle animation can only be performed on a ParticleGeometry object\"));\n\n\t\tvar i:number /*int*/, j:number /*int*/, k:number /*int*/;\n\t\tvar animationSubGeometry:AnimationSubGeometry;\n\t\tvar newAnimationSubGeometry:boolean = false;\n\t\tvar subGeometry:SubGeometryBase;\n\t\tvar subMesh:ISubMesh;\n\t\tvar localNode:ParticleNodeBase;\n\n\t\tfor (i = 0; i < mesh.subMeshes.length; i++) {\n\t\t\tsubMesh = mesh.subMeshes[i];\n\t\t\tsubGeometry = subMesh.subGeometry;\n\t\t\tif (mesh.shareAnimationGeometry) {\n\t\t\t\tanimationSubGeometry = this._animationSubGeometries[subGeometry.id];\n\n\t\t\t\tif (animationSubGeometry)\n\t\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tanimationSubGeometry = new AnimationSubGeometry();\n\n\t\t\tif (mesh.shareAnimationGeometry)\n\t\t\t\tthis._animationSubGeometries[subGeometry.id] = animationSubGeometry;\n\t\t\telse\n\t\t\t\tthis._animationSubGeometries[subMesh.id] = animationSubGeometry;\n\n\t\t\tnewAnimationSubGeometry = true;\n\n\t\t\t//create the vertexData vector that will be used for local node data\n\t\t\tanimationSubGeometry.createVertexData(subGeometry.numVertices, this._totalLenOfOneVertex);\n\t\t}\n\n\t\tif (!newAnimationSubGeometry)\n\t\t\treturn;\n\n\t\tvar particles:Array<ParticleData> = geometry.particles;\n\t\tvar particlesLength:number /*uint*/ = particles.length;\n\t\tvar numParticles:number /*uint*/ = geometry.numParticles;\n\t\tvar particleProperties:ParticleProperties = new ParticleProperties();\n\t\tvar particle:ParticleData;\n\n\t\tvar oneDataLen:number /*int*/;\n\t\tvar oneDataOffset:number /*int*/;\n\t\tvar counterForVertex:number /*int*/;\n\t\tvar counterForOneData:number /*int*/;\n\t\tvar oneData:Array<number>;\n\t\tvar numVertices:number /*uint*/;\n\t\tvar vertexData:Array<number>;\n\t\tvar vertexLength:number /*uint*/;\n\t\tvar startingOffset:number /*uint*/;\n\t\tvar vertexOffset:number /*uint*/;\n\n\t\t//default values for particle param\n\t\tparticleProperties.total = numParticles;\n\t\tparticleProperties.startTime = 0;\n\t\tparticleProperties.duration = 1000;\n\t\tparticleProperties.delay = 0.1;\n\n\t\ti = 0;\n\t\tj = 0;\n\t\twhile (i < numParticles) {\n\t\t\tparticleProperties.index = i;\n\n\t\t\t//call the init on the particle parameters\n\t\t\tthis.initParticleFunc.call(this.initParticleScope, particleProperties);\n\n\t\t\t//create the next set of node properties for the particle\n\t\t\tfor (k = 0; k < this._localStaticNodes.length; k++)\n\t\t\t\tthis._localStaticNodes[k]._iGeneratePropertyOfOneParticle(particleProperties);\n\n\t\t\t//loop through all particle data for the curent particle\n\t\t\twhile (j < particlesLength && (particle = particles[j]).particleIndex == i) {\n\t\t\t\t//find the target animationSubGeometry\n\t\t\t\tfor (k = 0; k < mesh.subMeshes.length; k++) {\n\t\t\t\t\tsubMesh = mesh.subMeshes[k];\n\t\t\t\t\tif (subMesh.subGeometry == particle.subGeometry) {\n\t\t\t\t\t\tanimationSubGeometry = (mesh.shareAnimationGeometry)? this._animationSubGeometries[subMesh.subGeometry.id] : this._animationSubGeometries[subMesh.id];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tnumVertices = particle.numVertices;\n\t\t\t\tvertexData = animationSubGeometry.vertexData;\n\t\t\t\tvertexLength = numVertices*this._totalLenOfOneVertex;\n\t\t\t\tstartingOffset = animationSubGeometry.numProcessedVertices*this._totalLenOfOneVertex;\n\n\t\t\t\t//loop through each static local node in the animation set\n\t\t\t\tfor (k = 0; k < this._localStaticNodes.length; k++) {\n\t\t\t\t\tlocalNode = this._localStaticNodes[k];\n\t\t\t\t\toneData = localNode.oneData;\n\t\t\t\t\toneDataLen = localNode.dataLength;\n\t\t\t\t\toneDataOffset = startingOffset + localNode._iDataOffset;\n\n\t\t\t\t\t//loop through each vertex set in the vertex data\n\t\t\t\t\tfor (counterForVertex = 0; counterForVertex < vertexLength; counterForVertex += this._totalLenOfOneVertex) {\n\t\t\t\t\t\tvertexOffset = oneDataOffset + counterForVertex;\n\n\t\t\t\t\t\t//add the data for the local node to the vertex data\n\t\t\t\t\t\tfor (counterForOneData = 0; counterForOneData < oneDataLen; counterForOneData++)\n\t\t\t\t\t\t\tvertexData[vertexOffset + counterForOneData] = oneData[counterForOneData];\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t//store particle properties if they need to be retreived for dynamic local nodes\n\t\t\t\tif (this._localDynamicNodes.length)\n\t\t\t\t\tanimationSubGeometry.animationParticles.push(new ParticleAnimationData(i, particleProperties.startTime, particleProperties.duration, particleProperties.delay, particle));\n\n\t\t\t\tanimationSubGeometry.numProcessedVertices += numVertices;\n\n\t\t\t\t//next index\n\t\t\t\tj++;\n\t\t\t}\n\n\t\t\t//next particle\n\t\t\ti++;\n\t\t}\n\t}\n}\n\nexport = ParticleAnimationSet;","import ISubMesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/ISubMesh\");\nimport SubGeometryBase\t\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport ContextGLProgramType\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticleAnimationData\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleAnimationData\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport TriangleSubMeshRenderable\t\t= require(\"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable\");\n\n/**\n * Provides an interface for assigning paricle-based animation data sets to mesh-based entity objects\n * and controlling the various available states of animation through an interative playhead that can be\n * automatically updated or manually triggered.\n *\n * Requires that the containing geometry of the parent mesh is particle geometry\n *\n * @see away.base.ParticleGeometry\n */\nclass ParticleAnimator extends AnimatorBase\n{\n\n\tprivate _particleAnimationSet:ParticleAnimationSet;\n\tprivate _animationParticleStates:Array<ParticleStateBase> = new Array<ParticleStateBase>();\n\tprivate _animatorParticleStates:Array<ParticleStateBase> = new Array<ParticleStateBase>();\n\tprivate _timeParticleStates:Array<ParticleStateBase> = new Array<ParticleStateBase>();\n\tprivate _totalLenOfOneVertex:number /*uint*/ = 0;\n\tprivate _animatorSubGeometries:Object = new Object();\n\n\t/**\n\t * Creates a new <code>ParticleAnimator</code> object.\n\t *\n\t * @param particleAnimationSet The animation data set containing the particle animations used by the animator.\n\t */\n\tconstructor(particleAnimationSet:ParticleAnimationSet)\n\t{\n\t\tsuper(particleAnimationSet);\n\t\tthis._particleAnimationSet = particleAnimationSet;\n\n\t\tvar state:ParticleStateBase;\n\t\tvar node:ParticleNodeBase;\n\n\t\tfor (var i:number = 0; i < this._particleAnimationSet.particleNodes.length; i++) {\n\t\t\tnode = this._particleAnimationSet.particleNodes[i];\n\t\t\tstate = <ParticleStateBase> this.getAnimationState(node);\n\t\t\tif (node.mode == ParticlePropertiesMode.LOCAL_DYNAMIC) {\n\t\t\t\tthis._animatorParticleStates.push(state);\n\t\t\t\tnode._iDataOffset = this._totalLenOfOneVertex;\n\t\t\t\tthis._totalLenOfOneVertex += node.dataLength;\n\t\t\t} else {\n\t\t\t\tthis._animationParticleStates.push(state);\n\t\t\t}\n\t\t\tif (state.needUpdateTime)\n\t\t\t\tthis._timeParticleStates.push(state);\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic clone():AnimatorBase\n\t{\n\t\treturn new ParticleAnimator(this._particleAnimationSet);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic setRenderState(shaderObject:ShaderObjectBase, renderable:RenderableBase, stage:Stage, camera:Camera, vertexConstantOffset:number /*int*/, vertexStreamOffset:number /*int*/)\n\t{\n\t\tvar animationRegisterCache:AnimationRegisterCache = this._particleAnimationSet._iAnimationRegisterCache;\n\n\t\tvar subMesh:ISubMesh = (<TriangleSubMeshRenderable> renderable).subMesh;\n\t\tvar state:ParticleStateBase;\n\t\tvar i:number;\n\n\t\tif (!subMesh)\n\t\t\tthrow(new Error(\"Must be subMesh\"));\n\n\t\t//process animation sub geometries\n\t\tvar animationSubGeometry:AnimationSubGeometry = this._particleAnimationSet.getAnimationSubGeometry(subMesh);\n\n\t\tfor (i = 0; i < this._animationParticleStates.length; i++)\n\t\t\tthis._animationParticleStates[i].setRenderState(stage, renderable, animationSubGeometry, animationRegisterCache, camera);\n\n\t\t//process animator subgeometries\n\t\tvar animatorSubGeometry:AnimationSubGeometry = this.getAnimatorSubGeometry(subMesh);\n\n\t\tfor (i = 0; i < this._animatorParticleStates.length; i++)\n\t\t\tthis._animatorParticleStates[i].setRenderState(stage, renderable, animatorSubGeometry, animationRegisterCache, camera);\n\n\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, animationRegisterCache.vertexConstantOffset, animationRegisterCache.vertexConstantData, animationRegisterCache.numVertexConstant);\n\n\t\tif (animationRegisterCache.numFragmentConstant > 0)\n\t\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, animationRegisterCache.fragmentConstantOffset, animationRegisterCache.fragmentConstantData, animationRegisterCache.numFragmentConstant);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic testGPUCompatibility(shaderObject:ShaderObjectBase)\n\t{\n\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic start()\n\t{\n\t\tsuper.start();\n\n\t\tfor (var i:number = 0; i < this._timeParticleStates.length; i++)\n\t\t\tthis._timeParticleStates[i].offset(this._pAbsoluteTime);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdateDeltaTime(dt:number)\n\t{\n\t\tthis._pAbsoluteTime += dt;\n\n\t\tfor (var i:number = 0; i < this._timeParticleStates.length; i++)\n\t\t\tthis._timeParticleStates[i].update(this._pAbsoluteTime);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic resetTime(offset:number /*int*/ = 0)\n\t{\n\t\tfor (var i:number = 0; i < this._timeParticleStates.length; i++)\n\t\t\tthis._timeParticleStates[i].offset(this._pAbsoluteTime + offset);\n\t\tthis.update(this.time);\n\t}\n\n\tpublic dispose()\n\t{\n\t\tfor (var key in this._animatorSubGeometries)\n\t\t\t(<AnimationSubGeometry> this._animatorSubGeometries[key]).dispose();\n\t}\n\n\tprivate getAnimatorSubGeometry(subMesh:ISubMesh):AnimationSubGeometry\n\t{\n\t\tif (!this._animatorParticleStates.length)\n\t\t\treturn;\n\n\t\tvar subGeometry:SubGeometryBase = subMesh.subGeometry;\n\t\tvar animatorSubGeometry:AnimationSubGeometry = this._animatorSubGeometries[subGeometry.id] = new AnimationSubGeometry();\n\n\t\t//create the vertexData vector that will be used for local state data\n\t\tanimatorSubGeometry.createVertexData(subGeometry.numVertices, this._totalLenOfOneVertex);\n\n\t\t//pass the particles data to the animator subGeometry\n\t\tanimatorSubGeometry.animationParticles = this._particleAnimationSet.getAnimationSubGeometry(subMesh).animationParticles;\n\t}\n}\n\nexport = ParticleAnimator;","import IAnimationSet\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimationSet\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport AnimationSetBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\n\n/**\n * The animation data set used by skeleton-based animators, containing skeleton animation data.\n *\n * @see away.animators.SkeletonAnimator\n */\nclass SkeletonAnimationSet extends AnimationSetBase implements IAnimationSet\n{\n\tprivate _jointsPerVertex:number /*uint*/;\n\n\t/**\n\t * Returns the amount of skeleton joints that can be linked to a single vertex via skinned weight values. For GPU-base animation, the\n\t * maximum allowed value is 4.\n\t */\n\tpublic get jointsPerVertex():number /*uint*/\n\t{\n\t\treturn this._jointsPerVertex;\n\t}\n\n\t/**\n\t * Creates a new <code>SkeletonAnimationSet</code> object.\n\t *\n\t * @param jointsPerVertex Sets the amount of skeleton joints that can be linked to a single vertex via skinned weight values. For GPU-base animation, the maximum allowed value is 4. Defaults to 4.\n\t */\n\tconstructor(jointsPerVertex:number /*uint*/ = 4)\n\t{\n\t\tsuper();\n\n\t\tthis._jointsPerVertex = jointsPerVertex;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase):string\n\t{\n\t\tvar len:number /*uint*/ = shaderObject.animatableAttributes.length;\n\n\t\tvar indexOffset0:number /*uint*/ = shaderObject.numUsedVertexConstants;\n\t\tvar indexOffset1:number /*uint*/ = indexOffset0 + 1;\n\t\tvar indexOffset2:number /*uint*/ = indexOffset0 + 2;\n\t\tvar indexStream:string = \"va\" + shaderObject.numUsedStreams;\n\t\tvar weightStream:string = \"va\" + (shaderObject.numUsedStreams + 1);\n\t\tvar indices:Array<string> = [ indexStream + \".x\", indexStream + \".y\", indexStream + \".z\", indexStream + \".w\" ];\n\t\tvar weights:Array<string> = [ weightStream + \".x\", weightStream + \".y\", weightStream + \".z\", weightStream + \".w\" ];\n\t\tvar temp1:string = this._pFindTempReg(shaderObject.animationTargetRegisters);\n\t\tvar temp2:string = this._pFindTempReg(shaderObject.animationTargetRegisters, temp1);\n\t\tvar dot:string = \"dp4\";\n\t\tvar code:string = \"\";\n\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\n\n\t\t\tvar src:string = shaderObject.animatableAttributes[i];\n\n\t\t\tfor (var j:number /*uint*/ = 0; j < this._jointsPerVertex; ++j) {\n\t\t\t\tcode += dot + \" \" + temp1 + \".x, \" + src + \", vc[\" + indices[j] + \"+\" + indexOffset0 + \"]\\n\" +\n\t\t\t\t\tdot + \" \" + temp1 + \".y, \" + src + \", vc[\" + indices[j] + \"+\" + indexOffset1 + \"]\\n\" +\n\t\t\t\t\tdot + \" \" + temp1 + \".z, \" + src + \", vc[\" + indices[j] + \"+\" + indexOffset2 + \"]\\n\" +\n\t\t\t\t\t\"mov \" + temp1 + \".w, \" + src + \".w\\n\" +\n\t\t\t\t\t\"mul \" + temp1 + \", \" + temp1 + \", \" + weights[j] + \"\\n\"; // apply weight\n\n\t\t\t\t// add or mov to target. Need to write to a temp reg first, because an output can be a target\n\t\t\t\tif (j == 0)\n\t\t\t\t\tcode += \"mov \" + temp2 + \", \" + temp1 + \"\\n\"; else\n\t\t\t\t\tcode += \"add \" + temp2 + \", \" + temp2 + \", \" + temp1 + \"\\n\";\n\t\t\t}\n\t\t\t// switch to dp3 once positions have been transformed, from now on, it should only be vectors instead of points\n\t\t\tdot = \"dp3\";\n\t\t\tcode += \"mov \" + shaderObject.animationTargetRegisters[i] + \", \" + temp2 + \"\\n\";\n\t\t}\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic activate(shaderObject:ShaderObjectBase, stage:Stage)\n\t{\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic deactivate(shaderObject:ShaderObjectBase, stage:Stage)\n\t{\n//\t\t\tvar streamOffset:number /*uint*/ = pass.numUsedStreams;\n//\t\t\tvar context:IContextGL = <IContextGL> stage.context;\n//\t\t\tcontext.setVertexBufferAt(streamOffset, null);\n//\t\t\tcontext.setVertexBufferAt(streamOffset + 1, null);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALFragmentCode(shaderObject:ShaderObjectBase, shadedTarget:string):string\n\t{\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALUVCode(shaderObject:ShaderObjectBase):string\n\t{\n\t\treturn \"mov \" + shaderObject.uvTarget + \",\" + shaderObject.uvSource + \"\\n\";\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic doneAGALCode(shaderObject:ShaderObjectBase)\n\t{\n\n\t}\n}\n\nexport = SkeletonAnimationSet;","import Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport ISubMesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/ISubMesh\");\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport TriangleSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport SubGeometryEvent\t\t\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\n\nimport ContextGLProgramType\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport SkeletonAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimationSet\");\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\nimport SkeletonJoint\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonJoint\");\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\nimport IAnimationTransition\t\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/IAnimationTransition\");\nimport AnimationStateEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/AnimationStateEvent\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport TriangleSubMeshRenderable\t\t= require(\"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable\");\n\n/**\n * Provides an interface for assigning skeleton-based animation data sets to mesh-based entity objects\n * and controlling the various available states of animation through an interative playhead that can be\n * automatically updated or manually triggered.\n */\nclass SkeletonAnimator extends AnimatorBase\n{\n\tprivate _globalMatrices:Array<number>;\n\tprivate _globalPose:SkeletonPose = new SkeletonPose();\n\tprivate _globalPropertiesDirty:boolean;\n\tprivate _numJoints:number /*uint*/;\n\tprivate _morphedSubGeometry:Object = new Object();\n\tprivate _morphedSubGeometryDirty:Object = new Object();\n\tprivate _condensedMatrices:Array<number>;\n\n\tprivate _skeleton:Skeleton;\n\tprivate _forceCPU:boolean;\n\tprivate _useCondensedIndices:boolean;\n\tprivate _jointsPerVertex:number /*uint*/;\n\tprivate _activeSkeletonState:ISkeletonAnimationState;\n\tprivate _onTransitionCompleteDelegate:(event:AnimationStateEvent) => void;\n\n\tprivate _onIndicesUpdateDelegate:(event:SubGeometryEvent) => void;\n\tprivate _onVerticesUpdateDelegate:(event:SubGeometryEvent) => void;\n\n\t/**\n\t * returns the calculated global matrices of the current skeleton pose.\n\t *\n\t * @see #globalPose\n\t */\n\tpublic get globalMatrices():Array<number>\n\t{\n\t\tif (this._globalPropertiesDirty)\n\t\t\tthis.updateGlobalProperties();\n\n\t\treturn this._globalMatrices;\n\t}\n\n\t/**\n\t * returns the current skeleton pose output from the animator.\n\t *\n\t * @see away.animators.data.SkeletonPose\n\t */\n\tpublic get globalPose():SkeletonPose\n\t{\n\t\tif (this._globalPropertiesDirty)\n\t\t\tthis.updateGlobalProperties();\n\n\t\treturn this._globalPose;\n\t}\n\n\t/**\n\t * Returns the skeleton object in use by the animator - this defines the number and heirarchy of joints used by the\n\t * skinned geoemtry to which skeleon animator is applied.\n\t */\n\tpublic get skeleton():Skeleton\n\t{\n\t\treturn this._skeleton;\n\t}\n\n\t/**\n\t * Indicates whether the skeleton animator is disabled by default for GPU rendering, something that allows the animator to perform calculation on the GPU.\n\t * Defaults to false.\n\t */\n\tpublic get forceCPU():boolean\n\t{\n\t\treturn this._forceCPU;\n\t}\n\n\t/**\n\t * Offers the option of enabling GPU accelerated animation on skeletons larger than 32 joints\n\t * by condensing the number of joint index values required per mesh. Only applicable to\n\t * skeleton animations that utilise more than one mesh object. Defaults to false.\n\t */\n\tpublic get useCondensedIndices():boolean\n\t{\n\t\treturn this._useCondensedIndices;\n\t}\n\n\tpublic set useCondensedIndices(value:boolean)\n\t{\n\t\tthis._useCondensedIndices = value;\n\t}\n\n\t/**\n\t * Creates a new <code>SkeletonAnimator</code> object.\n\t *\n\t * @param skeletonAnimationSet The animation data set containing the skeleton animations used by the animator.\n\t * @param skeleton The skeleton object used for calculating the resulting global matrices for transforming skinned mesh data.\n\t * @param forceCPU Optional value that only allows the animator to perform calculation on the CPU. Defaults to false.\n\t */\n\tconstructor(animationSet:SkeletonAnimationSet, skeleton:Skeleton, forceCPU:boolean = false)\n\t{\n\t\tsuper(animationSet);\n\n\t\tthis._skeleton = skeleton;\n\t\tthis._forceCPU = forceCPU;\n\t\tthis._jointsPerVertex = animationSet.jointsPerVertex;\n\n\t\tthis._numJoints = this._skeleton.numJoints;\n\t\tthis._globalMatrices = new Array<number>(this._numJoints*12);\n\n\t\tvar j:number /*int*/ = 0;\n\t\tfor (var i:number /*uint*/ = 0; i < this._numJoints; ++i) {\n\t\t\tthis._globalMatrices[j++] = 1;\n\t\t\tthis._globalMatrices[j++] = 0;\n\t\t\tthis._globalMatrices[j++] = 0;\n\t\t\tthis._globalMatrices[j++] = 0;\n\t\t\tthis._globalMatrices[j++] = 0;\n\t\t\tthis._globalMatrices[j++] = 1;\n\t\t\tthis._globalMatrices[j++] = 0;\n\t\t\tthis._globalMatrices[j++] = 0;\n\t\t\tthis._globalMatrices[j++] = 0;\n\t\t\tthis._globalMatrices[j++] = 0;\n\t\t\tthis._globalMatrices[j++] = 1;\n\t\t\tthis._globalMatrices[j++] = 0;\n\t\t}\n\n\t\tthis._onTransitionCompleteDelegate = (event:AnimationStateEvent) => this.onTransitionComplete(event);\n\t\tthis._onIndicesUpdateDelegate = (event:SubGeometryEvent) => this.onIndicesUpdate(event);\n\t\tthis._onVerticesUpdateDelegate = (event:SubGeometryEvent) => this.onVerticesUpdate(event);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic clone():AnimatorBase\n\t{\n\t\t/* The cast to SkeletonAnimationSet should never fail, as _animationSet can only be set\n\t\t through the constructor, which will only accept a SkeletonAnimationSet. */\n\t\treturn new SkeletonAnimator(<SkeletonAnimationSet> this._pAnimationSet, this._skeleton, this._forceCPU);\n\t}\n\n\t/**\n\t * Plays an animation state registered with the given name in the animation data set.\n\t *\n\t * @param name The data set name of the animation state to be played.\n\t * @param transition An optional transition object that determines how the animator will transition from the currently active animation state.\n\t * @param offset An option offset time (in milliseconds) that resets the state's internal clock to the absolute time of the animator plus the offset value. Required for non-looping animation states.\n\t */\n\tpublic play(name:string, transition:IAnimationTransition = null, offset:number = NaN)\n\t{\n\t\tif (this._pActiveAnimationName == name)\n\t\t\treturn;\n\n\t\tthis._pActiveAnimationName = name;\n\n\t\tif (!this._pAnimationSet.hasAnimation(name))\n\t\t\tthrow new Error(\"Animation root node \" + name + \" not found!\");\n\n\t\tif (transition && this._pActiveNode) {\n\t\t\t//setup the transition\n\t\t\tthis._pActiveNode = transition.getAnimationNode(this, this._pActiveNode, this._pAnimationSet.getAnimation(name), this._pAbsoluteTime);\n\t\t\tthis._pActiveNode.addEventListener(AnimationStateEvent.TRANSITION_COMPLETE, this._onTransitionCompleteDelegate);\n\t\t} else\n\t\t\tthis._pActiveNode = this._pAnimationSet.getAnimation(name);\n\n\t\tthis._pActiveState = this.getAnimationState(this._pActiveNode);\n\n\t\tif (this.updatePosition) {\n\t\t\t//update straight away to reset position deltas\n\t\t\tthis._pActiveState.update(this._pAbsoluteTime);\n\t\t\tthis._pActiveState.positionDelta;\n\t\t}\n\n\t\tthis._activeSkeletonState = <ISkeletonAnimationState> this._pActiveState;\n\n\t\tthis.start();\n\n\t\t//apply a time offset if specified\n\t\tif (!isNaN(offset))\n\t\t\tthis.reset(name, offset);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic setRenderState(shaderObject:ShaderObjectBase, renderable:RenderableBase, stage:Stage, camera:Camera, vertexConstantOffset:number /*int*/, vertexStreamOffset:number /*int*/)\n\t{\n\t\t// do on request of globalProperties\n\t\tif (this._globalPropertiesDirty)\n\t\t\tthis.updateGlobalProperties();\n\n\t\tvar subGeometry:TriangleSubGeometry = <TriangleSubGeometry> (<TriangleSubMesh> (<TriangleSubMeshRenderable> renderable).subMesh).subGeometry;\n\n\t\tsubGeometry.useCondensedIndices = this._useCondensedIndices;\n\n\t\tif (this._useCondensedIndices) {\n\t\t\t// using a condensed data set\n\t\t\tthis.updateCondensedMatrices(subGeometry.condensedIndexLookUp, subGeometry.numCondensedJoints);\n\t\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, vertexConstantOffset, this._condensedMatrices, subGeometry.numCondensedJoints*3);\n\t\t} else {\n\t\t\tif (this._pAnimationSet.usesCPU) {\n\t\t\t\tif (this._morphedSubGeometryDirty[subGeometry.id])\n\t\t\t\t\tthis.morphSubGeometry(<TriangleSubMeshRenderable> renderable, subGeometry);\n\n\t\t\t\treturn\n\t\t\t}\n\t\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, vertexConstantOffset, this._globalMatrices, this._numJoints*3);\n\t\t}\n\n\t\tstage.activateBuffer(vertexStreamOffset, renderable.getVertexData(TriangleSubGeometry.JOINT_INDEX_DATA), renderable.getVertexOffset(TriangleSubGeometry.JOINT_INDEX_DATA), renderable.JOINT_INDEX_FORMAT);\n\t\tstage.activateBuffer(vertexStreamOffset + 1, renderable.getVertexData(TriangleSubGeometry.JOINT_WEIGHT_DATA), renderable.getVertexOffset(TriangleSubGeometry.JOINT_WEIGHT_DATA), renderable.JOINT_WEIGHT_FORMAT);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic testGPUCompatibility(shaderObject:ShaderObjectBase)\n\t{\n\t\tif (!this._useCondensedIndices && (this._forceCPU || this._jointsPerVertex > 4 || shaderObject.numUsedVertexConstants + this._numJoints*3 > 128))\n\t\t\tthis._pAnimationSet.cancelGPUCompatibility();\n\t}\n\n\t/**\n\t * Applies the calculated time delta to the active animation state node or state transition object.\n\t */\n\tpublic _pUpdateDeltaTime(dt:number)\n\t{\n\t\tsuper._pUpdateDeltaTime(dt);\n\n\t\t//invalidate pose matrices\n\t\tthis._globalPropertiesDirty = true;\n\n\t\t//trigger geometry invalidation if using CPU animation\n\t\tif (this._pAnimationSet.usesCPU)\n\t\t\tfor (var key in this._morphedSubGeometryDirty)\n\t\t\t\tthis._morphedSubGeometryDirty[key] = true;\n\t}\n\n\tprivate updateCondensedMatrices(condensedIndexLookUp:Array<number> /*uint*/, numJoints:number /*uint*/)\n\t{\n\t\tvar i:number /*uint*/ = 0, j:number /*uint*/ = 0;\n\t\tvar len:number /*uint*/;\n\t\tvar srcIndex:number /*uint*/;\n\n\t\tthis._condensedMatrices = new Array<number>();\n\n\t\tdo {\n\t\t\tsrcIndex = condensedIndexLookUp[i]*4;\n\t\t\tlen = srcIndex + 12;\n\t\t\t// copy into condensed\n\t\t\twhile (srcIndex < len)\n\t\t\t\tthis._condensedMatrices[j++] = this._globalMatrices[srcIndex++];\n\t\t} while (++i < numJoints);\n\t}\n\n\tprivate updateGlobalProperties()\n\t{\n\t\tthis._globalPropertiesDirty = false;\n\n\t\t//get global pose\n\t\tthis.localToGlobalPose(this._activeSkeletonState.getSkeletonPose(this._skeleton), this._globalPose, this._skeleton);\n\n\t\t// convert pose to matrix\n\t\tvar mtxOffset:number /*uint*/ = 0;\n\t\tvar globalPoses:Array<JointPose> = this._globalPose.jointPoses;\n\t\tvar raw:Array<number>;\n\t\tvar ox:number, oy:number, oz:number, ow:number;\n\t\tvar xy2:number, xz2:number, xw2:number;\n\t\tvar yz2:number, yw2:number, zw2:number;\n\t\tvar n11:number, n12:number, n13:number;\n\t\tvar n21:number, n22:number, n23:number;\n\t\tvar n31:number, n32:number, n33:number;\n\t\tvar m11:number, m12:number, m13:number, m14:number;\n\t\tvar m21:number, m22:number, m23:number, m24:number;\n\t\tvar m31:number, m32:number, m33:number, m34:number;\n\t\tvar joints:Array<SkeletonJoint> = this._skeleton.joints;\n\t\tvar pose:JointPose;\n\t\tvar quat:Quaternion;\n\t\tvar vec:Vector3D;\n\t\tvar t:number;\n\n\t\tfor (var i:number /*uint*/ = 0; i < this._numJoints; ++i) {\n\t\t\tpose = globalPoses[i];\n\t\t\tquat = pose.orientation;\n\t\t\tvec = pose.translation;\n\t\t\tox = quat.x;\n\t\t\toy = quat.y;\n\t\t\toz = quat.z;\n\t\t\tow = quat.w;\n\n\t\t\txy2 = (t = 2.0*ox)*oy;\n\t\t\txz2 = t*oz;\n\t\t\txw2 = t*ow;\n\t\t\tyz2 = (t = 2.0*oy)*oz;\n\t\t\tyw2 = t*ow;\n\t\t\tzw2 = 2.0*oz*ow;\n\n\t\t\tyz2 = 2.0*oy*oz;\n\t\t\tyw2 = 2.0*oy*ow;\n\t\t\tzw2 = 2.0*oz*ow;\n\t\t\tox *= ox;\n\t\t\toy *= oy;\n\t\t\toz *= oz;\n\t\t\tow *= ow;\n\n\t\t\tn11 = (t = ox - oy) - oz + ow;\n\t\t\tn12 = xy2 - zw2;\n\t\t\tn13 = xz2 + yw2;\n\t\t\tn21 = xy2 + zw2;\n\t\t\tn22 = -t - oz + ow;\n\t\t\tn23 = yz2 - xw2;\n\t\t\tn31 = xz2 - yw2;\n\t\t\tn32 = yz2 + xw2;\n\t\t\tn33 = -ox - oy + oz + ow;\n\n\t\t\t// prepend inverse bind pose\n\t\t\traw = joints[i].inverseBindPose;\n\t\t\tm11 = raw[0];\n\t\t\tm12 = raw[4];\n\t\t\tm13 = raw[8];\n\t\t\tm14 = raw[12];\n\t\t\tm21 = raw[1];\n\t\t\tm22 = raw[5];\n\t\t\tm23 = raw[9];\n\t\t\tm24 = raw[13];\n\t\t\tm31 = raw[2];\n\t\t\tm32 = raw[6];\n\t\t\tm33 = raw[10];\n\t\t\tm34 = raw[14];\n\n\t\t\tthis._globalMatrices[mtxOffset] = n11*m11 + n12*m21 + n13*m31;\n\t\t\tthis._globalMatrices[mtxOffset + 1] = n11*m12 + n12*m22 + n13*m32;\n\t\t\tthis._globalMatrices[mtxOffset + 2] = n11*m13 + n12*m23 + n13*m33;\n\t\t\tthis._globalMatrices[mtxOffset + 3] = n11*m14 + n12*m24 + n13*m34 + vec.x;\n\t\t\tthis._globalMatrices[mtxOffset + 4] = n21*m11 + n22*m21 + n23*m31;\n\t\t\tthis._globalMatrices[mtxOffset + 5] = n21*m12 + n22*m22 + n23*m32;\n\t\t\tthis._globalMatrices[mtxOffset + 6] = n21*m13 + n22*m23 + n23*m33;\n\t\t\tthis._globalMatrices[mtxOffset + 7] = n21*m14 + n22*m24 + n23*m34 + vec.y;\n\t\t\tthis._globalMatrices[mtxOffset + 8] = n31*m11 + n32*m21 + n33*m31;\n\t\t\tthis._globalMatrices[mtxOffset + 9] = n31*m12 + n32*m22 + n33*m32;\n\t\t\tthis._globalMatrices[mtxOffset + 10] = n31*m13 + n32*m23 + n33*m33;\n\t\t\tthis._globalMatrices[mtxOffset + 11] = n31*m14 + n32*m24 + n33*m34 + vec.z;\n\n\t\t\tmtxOffset = mtxOffset + 12;\n\t\t}\n\t}\n\n\n\tpublic getRenderableSubGeometry(renderable:TriangleSubMeshRenderable, sourceSubGeometry:TriangleSubGeometry):TriangleSubGeometry\n\t{\n\t\tthis._morphedSubGeometryDirty[sourceSubGeometry.id] = true;\n\n\t\t//early out for GPU animations\n\t\tif (!this._pAnimationSet.usesCPU)\n\t\t\treturn sourceSubGeometry;\n\n\t\tvar targetSubGeometry:TriangleSubGeometry;\n\n\t\tif (!(targetSubGeometry = this._morphedSubGeometry[sourceSubGeometry.id])) {\n\t\t\t//not yet stored\n\t\t\ttargetSubGeometry = this._morphedSubGeometry[sourceSubGeometry.id] = sourceSubGeometry.clone();\n\t\t\t//turn off auto calculations on the morphed geometry\n\t\t\ttargetSubGeometry.autoDeriveNormals = false;\n\t\t\ttargetSubGeometry.autoDeriveTangents = false;\n\t\t\ttargetSubGeometry.autoDeriveUVs = false;\n\t\t\t//add event listeners for any changes in UV values on the source geometry\n\t\t\tsourceSubGeometry.addEventListener(SubGeometryEvent.INDICES_UPDATED, this._onIndicesUpdateDelegate);\n\t\t\tsourceSubGeometry.addEventListener(SubGeometryEvent.VERTICES_UPDATED, this._onVerticesUpdateDelegate);\n\t\t}\n\n\t\treturn targetSubGeometry;\n\t}\n\n\t/**\n\t * If the animation can't be performed on GPU, transform vertices manually\n\t * @param subGeom The subgeometry containing the weights and joint index data per vertex.\n\t * @param pass The material pass for which we need to transform the vertices\n\t */\n\tpublic morphSubGeometry(renderable:TriangleSubMeshRenderable, sourceSubGeometry:TriangleSubGeometry)\n\t{\n\t\tthis._morphedSubGeometryDirty[sourceSubGeometry.id] = false;\n\n\t\tvar sourcePositions:Array<number> = sourceSubGeometry.positions;\n\t\tvar sourceNormals:Array<number> = sourceSubGeometry.vertexNormals;\n\t\tvar sourceTangents:Array<number> = sourceSubGeometry.vertexTangents;\n\n\t\tvar jointIndices:Array<number> = sourceSubGeometry.jointIndices;\n\t\tvar jointWeights:Array<number> = sourceSubGeometry.jointWeights;\n\n\t\tvar targetSubGeometry = this._morphedSubGeometry[sourceSubGeometry.id];\n\n\t\tvar targetPositions:Array<number> = targetSubGeometry.positions;\n\t\tvar targetNormals:Array<number> = targetSubGeometry.vertexNormals;\n\t\tvar targetTangents:Array<number> = targetSubGeometry.vertexTangents;\n\n\t\tvar index:number /*uint*/ = 0;\n\t\tvar j:number /*uint*/ = 0;\n\t\tvar k:number /*uint*/;\n\t\tvar vx:number, vy:number, vz:number;\n\t\tvar nx:number, ny:number, nz:number;\n\t\tvar tx:number, ty:number, tz:number;\n\t\tvar len:number /*int*/ = sourcePositions.length;\n\t\tvar weight:number;\n\t\tvar vertX:number, vertY:number, vertZ:number;\n\t\tvar normX:number, normY:number, normZ:number;\n\t\tvar tangX:number, tangY:number, tangZ:number;\n\t\tvar m11:number, m12:number, m13:number, m14:number;\n\t\tvar m21:number, m22:number, m23:number, m24:number;\n\t\tvar m31:number, m32:number, m33:number, m34:number;\n\n\t\twhile (index < len) {\n\t\t\tvertX = sourcePositions[index];\n\t\t\tvertY = sourcePositions[index + 1];\n\t\t\tvertZ = sourcePositions[index + 2];\n\t\t\tnormX = sourceNormals[index];\n\t\t\tnormY = sourceNormals[index + 1];\n\t\t\tnormZ = sourceNormals[index + 2];\n\t\t\ttangX = sourceTangents[index];\n\t\t\ttangY = sourceTangents[index + 1];\n\t\t\ttangZ = sourceTangents[index + 2];\n\t\t\tvx = 0;\n\t\t\tvy = 0;\n\t\t\tvz = 0;\n\t\t\tnx = 0;\n\t\t\tny = 0;\n\t\t\tnz = 0;\n\t\t\ttx = 0;\n\t\t\tty = 0;\n\t\t\ttz = 0;\n\t\t\tk = 0;\n\t\t\twhile (k < this._jointsPerVertex) {\n\t\t\t\tweight = jointWeights[j];\n\t\t\t\tif (weight > 0) {\n\t\t\t\t\t// implicit /3*12 (/3 because indices are multiplied by 3 for gpu matrix access, *12 because it's the matrix size)\n\t\t\t\t\tvar mtxOffset:number /*uint*/ = jointIndices[j++] << 2;\n\t\t\t\t\tm11 = this._globalMatrices[mtxOffset];\n\t\t\t\t\tm12 = this._globalMatrices[mtxOffset + 1];\n\t\t\t\t\tm13 = this._globalMatrices[mtxOffset + 2];\n\t\t\t\t\tm14 = this._globalMatrices[mtxOffset + 3];\n\t\t\t\t\tm21 = this._globalMatrices[mtxOffset + 4];\n\t\t\t\t\tm22 = this._globalMatrices[mtxOffset + 5];\n\t\t\t\t\tm23 = this._globalMatrices[mtxOffset + 6];\n\t\t\t\t\tm24 = this._globalMatrices[mtxOffset + 7];\n\t\t\t\t\tm31 = this._globalMatrices[mtxOffset + 8];\n\t\t\t\t\tm32 = this._globalMatrices[mtxOffset + 9];\n\t\t\t\t\tm33 = this._globalMatrices[mtxOffset + 10];\n\t\t\t\t\tm34 = this._globalMatrices[mtxOffset + 11];\n\t\t\t\t\tvx += weight*(m11*vertX + m12*vertY + m13*vertZ + m14);\n\t\t\t\t\tvy += weight*(m21*vertX + m22*vertY + m23*vertZ + m24);\n\t\t\t\t\tvz += weight*(m31*vertX + m32*vertY + m33*vertZ + m34);\n\t\t\t\t\tnx += weight*(m11*normX + m12*normY + m13*normZ);\n\t\t\t\t\tny += weight*(m21*normX + m22*normY + m23*normZ);\n\t\t\t\t\tnz += weight*(m31*normX + m32*normY + m33*normZ);\n\t\t\t\t\ttx += weight*(m11*tangX + m12*tangY + m13*tangZ);\n\t\t\t\t\tty += weight*(m21*tangX + m22*tangY + m23*tangZ);\n\t\t\t\t\ttz += weight*(m31*tangX + m32*tangY + m33*tangZ);\n\t\t\t\t\t++k;\n\t\t\t\t} else {\n\t\t\t\t\tj += (this._jointsPerVertex - k);\n\t\t\t\t\tk = this._jointsPerVertex;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttargetPositions[index] = vx;\n\t\t\ttargetPositions[index + 1] = vy;\n\t\t\ttargetPositions[index + 2] = vz;\n\t\t\ttargetNormals[index] = nx;\n\t\t\ttargetNormals[index + 1] = ny;\n\t\t\ttargetNormals[index + 2] = nz;\n\t\t\ttargetTangents[index] = tx;\n\t\t\ttargetTangents[index + 1] = ty;\n\t\t\ttargetTangents[index + 2] = tz;\n\n\t\t\tindex += 3;\n\t\t}\n\n\t\ttargetSubGeometry.updatePositions(targetPositions);\n\t\ttargetSubGeometry.updateVertexNormals(targetNormals);\n\t\ttargetSubGeometry.updateVertexTangents(targetTangents);\n\t}\n\n\t/**\n\t * Converts a local hierarchical skeleton pose to a global pose\n\t * @param targetPose The SkeletonPose object that will contain the global pose.\n\t * @param skeleton The skeleton containing the joints, and as such, the hierarchical data to transform to global poses.\n\t */\n\tprivate localToGlobalPose(sourcePose:SkeletonPose, targetPose:SkeletonPose, skeleton:Skeleton)\n\t{\n\t\tvar globalPoses:Array<JointPose> = targetPose.jointPoses;\n\t\tvar globalJointPose:JointPose;\n\t\tvar joints:Array<SkeletonJoint> = skeleton.joints;\n\t\tvar len:number /*uint*/ = sourcePose.numJointPoses;\n\t\tvar jointPoses:Array<JointPose> = sourcePose.jointPoses;\n\t\tvar parentIndex:number /*int*/;\n\t\tvar joint:SkeletonJoint;\n\t\tvar parentPose:JointPose;\n\t\tvar pose:JointPose;\n\t\tvar or:Quaternion;\n\t\tvar tr:Vector3D;\n\t\tvar t:Vector3D;\n\t\tvar q:Quaternion;\n\n\t\tvar x1:number, y1:number, z1:number, w1:number;\n\t\tvar x2:number, y2:number, z2:number, w2:number;\n\t\tvar x3:number, y3:number, z3:number;\n\n\t\t// :s\n\t\tif (globalPoses.length != len)\n\t\t\tglobalPoses.length = len;\n\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\n\t\t\tglobalJointPose = globalPoses[i];\n\n\t\t\tif (globalJointPose == null)\n\t\t\t\tglobalJointPose = globalPoses[i] = new JointPose();\n\n\t\t\tjoint = joints[i];\n\t\t\tparentIndex = joint.parentIndex;\n\t\t\tpose = jointPoses[i];\n\n\t\t\tq = globalJointPose.orientation;\n\t\t\tt = globalJointPose.translation;\n\n\t\t\tif (parentIndex < 0) {\n\t\t\t\ttr = pose.translation;\n\t\t\t\tor = pose.orientation;\n\t\t\t\tq.x = or.x;\n\t\t\t\tq.y = or.y;\n\t\t\t\tq.z = or.z;\n\t\t\t\tq.w = or.w;\n\t\t\t\tt.x = tr.x;\n\t\t\t\tt.y = tr.y;\n\t\t\t\tt.z = tr.z;\n\t\t\t} else {\n\t\t\t\t// append parent pose\n\t\t\t\tparentPose = globalPoses[parentIndex];\n\n\t\t\t\t// rotate point\n\t\t\t\tor = parentPose.orientation;\n\t\t\t\ttr = pose.translation;\n\t\t\t\tx2 = or.x;\n\t\t\t\ty2 = or.y;\n\t\t\t\tz2 = or.z;\n\t\t\t\tw2 = or.w;\n\t\t\t\tx3 = tr.x;\n\t\t\t\ty3 = tr.y;\n\t\t\t\tz3 = tr.z;\n\n\t\t\t\tw1 = -x2*x3 - y2*y3 - z2*z3;\n\t\t\t\tx1 = w2*x3 + y2*z3 - z2*y3;\n\t\t\t\ty1 = w2*y3 - x2*z3 + z2*x3;\n\t\t\t\tz1 = w2*z3 + x2*y3 - y2*x3;\n\n\t\t\t\t// append parent translation\n\t\t\t\ttr = parentPose.translation;\n\t\t\t\tt.x = -w1*x2 + x1*w2 - y1*z2 + z1*y2 + tr.x;\n\t\t\t\tt.y = -w1*y2 + x1*z2 + y1*w2 - z1*x2 + tr.y;\n\t\t\t\tt.z = -w1*z2 - x1*y2 + y1*x2 + z1*w2 + tr.z;\n\n\t\t\t\t// append parent orientation\n\t\t\t\tx1 = or.x;\n\t\t\t\ty1 = or.y;\n\t\t\t\tz1 = or.z;\n\t\t\t\tw1 = or.w;\n\t\t\t\tor = pose.orientation;\n\t\t\t\tx2 = or.x;\n\t\t\t\ty2 = or.y;\n\t\t\t\tz2 = or.z;\n\t\t\t\tw2 = or.w;\n\n\t\t\t\tq.w = w1*w2 - x1*x2 - y1*y2 - z1*z2;\n\t\t\t\tq.x = w1*x2 + x1*w2 + y1*z2 - z1*y2;\n\t\t\t\tq.y = w1*y2 - x1*z2 + y1*w2 + z1*x2;\n\t\t\t\tq.z = w1*z2 + x1*y2 - y1*x2 + z1*w2;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onTransitionComplete(event:AnimationStateEvent)\n\t{\n\t\tif (event.type == AnimationStateEvent.TRANSITION_COMPLETE) {\n\t\t\tevent.animationNode.removeEventListener(AnimationStateEvent.TRANSITION_COMPLETE, this._onTransitionCompleteDelegate);\n\t\t\t//if this is the current active state transition, revert control to the active node\n\t\t\tif (this._pActiveState == event.animationState) {\n\t\t\t\tthis._pActiveNode = this._pAnimationSet.getAnimation(this._pActiveAnimationName);\n\t\t\t\tthis._pActiveState = this.getAnimationState(this._pActiveNode);\n\t\t\t\tthis._activeSkeletonState = <ISkeletonAnimationState> this._pActiveState;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onIndicesUpdate(event:SubGeometryEvent)\n\t{\n\t\tvar subGeometry:TriangleSubGeometry = <TriangleSubGeometry> event.target;\n\n\t\t(<TriangleSubGeometry> this._morphedSubGeometry[subGeometry.id]).updateIndices(subGeometry.indices);\n\t}\n\n\tprivate onVerticesUpdate(event:SubGeometryEvent)\n\t{\n\t\tvar subGeometry:TriangleSubGeometry = <TriangleSubGeometry> event.target;\n\t\tvar morphGeometry:TriangleSubGeometry = <TriangleSubGeometry> this._morphedSubGeometry[subGeometry.id];\n\n\t\tswitch(event.dataType) {\n\t\t\tcase TriangleSubGeometry.UV_DATA:\n\t\t\t\tmorphGeometry.updateUVs(subGeometry.uvs);\n\t\t\tcase TriangleSubGeometry.SECONDARY_UV_DATA:\n\t\t\t\tmorphGeometry.updateUVs(subGeometry.secondaryUVs);\n\t\t}\n\t}\n}\n\nexport = SkeletonAnimator;","import IAnimationSet\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimationSet\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport AnimationSetBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\nimport VertexAnimationMode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/VertexAnimationMode\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\n\n/**\n * The animation data set used by vertex-based animators, containing vertex animation state data.\n *\n * @see VertexAnimator\n */\nclass VertexAnimationSet extends AnimationSetBase implements IAnimationSet\n{\n\tprivate _numPoses:number /*uint*/;\n\tprivate _blendMode:string;\n\n\t/**\n\t * Returns the number of poses made available at once to the GPU animation code.\n\t */\n\tpublic get numPoses():number /*uint*/\n\t{\n\t\treturn this._numPoses;\n\t}\n\n\t/**\n\t * Returns the active blend mode of the vertex animator object.\n\t */\n\tpublic get blendMode():string\n\t{\n\t\treturn this._blendMode;\n\t}\n\n\t/**\n\t * Returns whether or not normal data is used in last set GPU pass of the vertex shader.\n\t */\n//\t\tpublic get useNormals():boolean\n//\t\t{\n//\t\t\treturn this._uploadNormals;\n//\t\t}\n\n\t/**\n\t * Creates a new <code>VertexAnimationSet</code> object.\n\t *\n\t * @param numPoses The number of poses made available at once to the GPU animation code.\n\t * @param blendMode Optional value for setting the animation mode of the vertex animator object.\n\t *\n\t * @see away3d.animators.data.VertexAnimationMode\n\t */\n\tconstructor(numPoses:number /*uint*/ = 2, blendMode:string = \"absolute\")\n\t{\n\t\tsuper();\n\t\tthis._numPoses = numPoses;\n\t\tthis._blendMode = blendMode;\n\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase):string\n\t{\n\t\tif (this._blendMode == VertexAnimationMode.ABSOLUTE)\n\t\t\treturn this.getAbsoluteAGALCode(shaderObject);\n\t\telse\n\t\t\treturn this.getAdditiveAGALCode(shaderObject);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic activate(shaderObject:ShaderObjectBase, stage:Stage)\n\t{\n//\t\t\tvar uID:number = pass._iUniqueId;\n//\t\t\tthis._uploadNormals = <boolean> this._useNormals[uID];\n//\t\t\tthis._uploadTangents = <boolean> this._useTangents[uID];\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic deactivate(shaderObject:ShaderObjectBase, stage:Stage)\n\t{\n//\t\t\tvar uID:number = pass._iUniqueId;\n//\t\t\tvar index:number /*uint*/ = this._streamIndices[uID];\n//\t\t\tvar context:IContextGL = <IContextGL> stage.context;\n//\t\t\tcontext.setVertexBufferAt(index, null);\n//\t\t\tif (this._uploadNormals)\n//\t\t\t\tcontext.setVertexBufferAt(index + 1, null);\n//\t\t\tif (this._uploadTangents)\n//\t\t\t\tcontext.setVertexBufferAt(index + 2, null);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALFragmentCode(shaderObject:ShaderObjectBase, shadedTarget:string):string\n\t{\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALUVCode(shaderObject:ShaderObjectBase):string\n\t{\n\t\treturn \"mov \" + shaderObject.uvTarget + \",\" + shaderObject.uvSource + \"\\n\";\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic doneAGALCode(shaderObject:ShaderObjectBase)\n\t{\n\n\t}\n\n\t/**\n\t * Generates the vertex AGAL code for absolute blending.\n\t */\n\tprivate getAbsoluteAGALCode(shaderObject:ShaderObjectBase):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar temp1:string = this._pFindTempReg(shaderObject.animationTargetRegisters);\n\t\tvar temp2:string = this._pFindTempReg(shaderObject.animationTargetRegisters, temp1);\n\t\tvar regs:Array<string> = new Array<string>(\"x\", \"y\", \"z\", \"w\");\n\t\tvar len:number /*uint*/ = shaderObject.animatableAttributes.length;\n\t\tvar constantReg:string = \"vc\" + shaderObject.numUsedVertexConstants;\n\n\t\tif (len > 2)\n\t\t\tlen = 2;\n\t\tvar streamIndex:number /*uint*/ = shaderObject.numUsedStreams;\n\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\n\t\t\tcode += \"mul \" + temp1 + \", \" + shaderObject.animatableAttributes[i] + \", \" + constantReg + \".\" + regs[0] + \"\\n\";\n\n\t\t\tfor (var j:number /*uint*/ = 1; j < this._numPoses; ++j) {\n\t\t\t\tcode += \"mul \" + temp2 + \", va\" + streamIndex + \", \" + constantReg + \".\" + regs[j] + \"\\n\";\n\n\t\t\t\tif (j < this._numPoses - 1)\n\t\t\t\t\tcode += \"add \" + temp1 + \", \" + temp1 + \", \" + temp2 + \"\\n\";\n\n\t\t\t\t++streamIndex;\n\t\t\t}\n\n\t\t\tcode += \"add \" + shaderObject.animationTargetRegisters[i] + \", \" + temp1 + \", \" + temp2 + \"\\n\";\n\t\t}\n\n\t\t// add code for bitangents if tangents are used\n\t\tif (shaderObject.tangentDependencies > 0 || shaderObject.outputsNormals) {\n\t\t\tcode += \"dp3 \" + temp1 + \".x, \" + shaderObject.animatableAttributes[2] + \", \" + shaderObject.animationTargetRegisters[1] + \"\\n\" +\n\t\t\t\t\"mul \" + temp1 + \", \" + shaderObject.animationTargetRegisters[1] + \", \" + temp1 + \".x\\n\" +\n\t\t\t\t\"sub \" + shaderObject.animationTargetRegisters[2] + \", \" + shaderObject.animationTargetRegisters[2] + \", \" + temp1 + \"\\n\";\n\t\t}\n\t\treturn code;\n\t}\n\n\t/**\n\t * Generates the vertex AGAL code for additive blending.\n\t */\n\tprivate getAdditiveAGALCode(shaderObject:ShaderObjectBase):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar len:number /*uint*/ = shaderObject.animatableAttributes.length;\n\t\tvar regs:Array<string> = [\"x\", \"y\", \"z\", \"w\"];\n\t\tvar temp1:string = this._pFindTempReg(shaderObject.animationTargetRegisters);\n\t\tvar k:number /*uint*/;\n\n\t\tvar streamIndex:number /*uint*/ = shaderObject.numUsedStreams;\n\n\t\tif (len > 2)\n\t\t\tlen = 2;\n\n\t\tcode += \"mov  \" + shaderObject.animationTargetRegisters[0] + \", \" + shaderObject.animatableAttributes[0] + \"\\n\";\n\t\tif (shaderObject.normalDependencies > 0)\n\t\t\tcode += \"mov \" + shaderObject.animationTargetRegisters[1] + \", \" + shaderObject.animatableAttributes[1] + \"\\n\";\n\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\n\t\t\tfor (var j:number /*uint*/ = 0; j < this._numPoses; ++j) {\n\t\t\t\tcode += \"mul \" + temp1 + \", va\" + (streamIndex + k) + \", vc\" + shaderObject.numUsedVertexConstants + \".\" + regs[j] + \"\\n\" +\n\t\t\t\t\t\"add \" + shaderObject.animationTargetRegisters[i] + \", \" + shaderObject.animationTargetRegisters[i] + \", \" + temp1 + \"\\n\";\n\t\t\t\tk++;\n\t\t\t}\n\t\t}\n\n\t\tif (shaderObject.tangentDependencies > 0 || shaderObject.outputsNormals) {\n\t\t\tcode += \"dp3 \" + temp1 + \".x, \" + shaderObject.animatableAttributes[2] + \", \" + shaderObject.animationTargetRegisters[1] + \"\\n\" +\n\t\t\t\t\"mul \" + temp1 + \", \" + shaderObject.animationTargetRegisters[1] + \", \" + temp1 + \".x\\n\" +\n\t\t\t\t\"sub \" + shaderObject.animationTargetRegisters[2] + \", \" + shaderObject.animatableAttributes[2] + \", \" + temp1 + \"\\n\";\n\t\t}\n\n\t\treturn code;\n\t}\n}\n\nexport = VertexAnimationSet;","import Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\nimport SubGeometryBase\t\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport TriangleSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLProgramType\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\nimport VertexDataPool\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/VertexDataPool\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport VertexAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimationSet\");\nimport VertexAnimationMode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/VertexAnimationMode\");\nimport IVertexAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/IVertexAnimationState\");\nimport IAnimationTransition\t\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/IAnimationTransition\");\nimport TriangleSubMeshRenderable\t\t= require(\"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\n\n/**\n * Provides an interface for assigning vertex-based animation data sets to mesh-based entity objects\n * and controlling the various available states of animation through an interative playhead that can be\n * automatically updated or manually triggered.\n */\nclass VertexAnimator extends AnimatorBase\n{\n\tprivate _vertexAnimationSet:VertexAnimationSet;\n\tprivate _poses:Array<Geometry> = new Array<Geometry>();\n\tprivate _weights:Array<number> = Array<number>(1, 0, 0, 0);\n\tprivate _numPoses:number /*uint*/;\n\tprivate _blendMode:string;\n\tprivate _activeVertexState:IVertexAnimationState;\n\n\t/**\n\t * Creates a new <code>VertexAnimator</code> object.\n\t *\n\t * @param vertexAnimationSet The animation data set containing the vertex animations used by the animator.\n\t */\n\tconstructor(vertexAnimationSet:VertexAnimationSet)\n\t{\n\t\tsuper(vertexAnimationSet);\n\n\t\tthis._vertexAnimationSet = vertexAnimationSet;\n\t\tthis._numPoses = vertexAnimationSet.numPoses;\n\t\tthis._blendMode = vertexAnimationSet.blendMode;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic clone():AnimatorBase\n\t{\n\t\treturn new VertexAnimator(this._vertexAnimationSet);\n\t}\n\n\t/**\n\t * Plays a sequence with a given name. If the sequence is not found, it may not be loaded yet, and it will retry every frame.\n\t * @param sequenceName The name of the clip to be played.\n\t */\n\tpublic play(name:string, transition:IAnimationTransition = null, offset:number = NaN)\n\t{\n\t\tif (this._pActiveAnimationName == name)\n\t\t\treturn;\n\n\t\tthis._pActiveAnimationName = name;\n\n\t\t//TODO: implement transitions in vertex animator\n\n\t\tif (!this._pAnimationSet.hasAnimation(name))\n\t\t\tthrow new Error(\"Animation root node \" + name + \" not found!\");\n\n\t\tthis._pActiveNode = this._pAnimationSet.getAnimation(name);\n\n\t\tthis._pActiveState = this.getAnimationState(this._pActiveNode);\n\n\t\tif (this.updatePosition) {\n\t\t\t//update straight away to reset position deltas\n\t\t\tthis._pActiveState.update(this._pAbsoluteTime);\n\t\t\tthis._pActiveState.positionDelta;\n\t\t}\n\n\t\tthis._activeVertexState = <IVertexAnimationState> this._pActiveState;\n\n\t\tthis.start();\n\n\t\t//apply a time offset if specified\n\t\tif (!isNaN(offset))\n\t\t\tthis.reset(name, offset);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdateDeltaTime(dt:number)\n\t{\n\t\tsuper._pUpdateDeltaTime(dt);\n\n\t\tvar geometryFlag:boolean = false;\n\n\t\tif (this._poses[0] != this._activeVertexState.currentGeometry) {\n\t\t\tthis._poses[0] = this._activeVertexState.currentGeometry;\n\t\t\tgeometryFlag = true;\n\t\t}\n\n\t\tif (this._poses[1] != this._activeVertexState.nextGeometry) {\n\t\t\tthis._poses[1] = this._activeVertexState.nextGeometry;\n\t\t\tgeometryFlag = true;\n\t\t}\n\n\t\tthis._weights[0] = 1 - (this._weights[1] = this._activeVertexState.blendWeight);\n\n\t\tif (geometryFlag) {\n\t\t\t//invalidate meshes\n\t\t\tvar mesh:Mesh;\n\t\t\tvar len:number = this._pOwners.length;\n\t\t\tfor (var i:number = 0; i < len; i++) {\n\t\t\t\tmesh = this._pOwners[i];\n\t\t\t\tmesh._iInvalidateRenderableGeometries();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic setRenderState(shaderObject:ShaderObjectBase, renderable:RenderableBase, stage:Stage, camera:Camera, vertexConstantOffset:number /*int*/, vertexStreamOffset:number /*int*/)\n\t{\n\t\t// todo: add code for when running on cpu\n\n\t\t// if no poses defined, set temp data\n\t\tif (!this._poses.length) {\n\t\t\tthis.setNullPose(shaderObject, renderable, stage, vertexConstantOffset, vertexStreamOffset);\n\t\t\treturn;\n\t\t}\n\n\t\t// this type of animation can only be SubMesh\n\t\tvar subMesh:TriangleSubMesh = <TriangleSubMesh> (<TriangleSubMeshRenderable> renderable).subMesh;\n\t\tvar subGeom:SubGeometryBase;\n\t\tvar i:number /*uint*/;\n\t\tvar len:number /*uint*/ = this._numPoses;\n\n\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, vertexConstantOffset, this._weights, 1);\n\n\t\tif (this._blendMode == VertexAnimationMode.ABSOLUTE)\n\t\t\ti = 1;\n\t\telse\n\t\t\ti = 0;\n\n\t\tfor (; i < len; ++i) {\n\t\t\tsubGeom = this._poses[i].subGeometries[subMesh._iIndex] || subMesh.subGeometry;\n\n\t\t\tstage.activateBuffer(vertexStreamOffset++, VertexDataPool.getItem(subGeom, renderable.getIndexData(), TriangleSubGeometry.POSITION_DATA), subGeom.getOffset(TriangleSubGeometry.POSITION_DATA), TriangleSubGeometry.POSITION_FORMAT);\n\n\t\t\tif (shaderObject.normalDependencies > 0)\n\t\t\t\tstage.activateBuffer(vertexStreamOffset++, VertexDataPool.getItem(subGeom, renderable.getIndexData(), TriangleSubGeometry.NORMAL_DATA), subGeom.getOffset(TriangleSubGeometry.NORMAL_DATA), TriangleSubGeometry.NORMAL_FORMAT);\n\t\t}\n\t}\n\n\tprivate setNullPose(shaderObject:ShaderObjectBase, renderable:RenderableBase, stage:Stage, vertexConstantOffset:number /*int*/, vertexStreamOffset:number /*int*/)\n\t{\n\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, vertexConstantOffset, this._weights, 1);\n\n\t\tif (this._blendMode == VertexAnimationMode.ABSOLUTE) {\n\t\t\tvar len:number /*uint*/ = this._numPoses;\n\t\t\tfor (var i:number /*uint*/ = 1; i < len; ++i) {\n\t\t\t\tstage.activateBuffer(vertexStreamOffset++, renderable.getVertexData(TriangleSubGeometry.POSITION_DATA), renderable.getVertexOffset(TriangleSubGeometry.POSITION_DATA), TriangleSubGeometry.POSITION_FORMAT);\n\n\t\t\t\tif (shaderObject.normalDependencies > 0)\n\t\t\t\t\tstage.activateBuffer(vertexStreamOffset++, renderable.getVertexData(TriangleSubGeometry.NORMAL_DATA), renderable.getVertexOffset(TriangleSubGeometry.NORMAL_DATA), TriangleSubGeometry.NORMAL_FORMAT);\n\t\t\t}\n\t\t}\n\t\t// todo: set temp data for additive?\n\t}\n\n\t/**\n\t * Verifies if the animation will be used on cpu. Needs to be true for all passes for a material to be able to use it on gpu.\n\t * Needs to be called if gpu code is potentially required.\n\t */\n\tpublic testGPUCompatibility(shaderObject:ShaderObjectBase)\n\t{\n\t}\n\n\tpublic getRenderableSubGeometry(renderable:TriangleSubMeshRenderable, sourceSubGeometry:TriangleSubGeometry):TriangleSubGeometry\n\t{\n\t\tif (this._blendMode == VertexAnimationMode.ABSOLUTE && this._poses.length)\n\t\t\treturn <TriangleSubGeometry> this._poses[0].subGeometries[renderable.subMesh._iIndex] || sourceSubGeometry;\n\n\t\t//nothing to do here\n\t\treturn sourceSubGeometry;\n\t}\n}\n\nexport = VertexAnimator;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\n\nimport AnimationNodeBase\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\n\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\n\n/**\n * ...\n */\nclass AnimationRegisterCache extends ShaderRegisterCache\n{\n\t//vertex\n\tpublic positionAttribute:ShaderRegisterElement;\n\tpublic uvAttribute:ShaderRegisterElement;\n\tpublic positionTarget:ShaderRegisterElement;\n\tpublic scaleAndRotateTarget:ShaderRegisterElement;\n\tpublic velocityTarget:ShaderRegisterElement;\n\tpublic vertexTime:ShaderRegisterElement;\n\tpublic vertexLife:ShaderRegisterElement;\n\tpublic vertexZeroConst:ShaderRegisterElement;\n\tpublic vertexOneConst:ShaderRegisterElement;\n\tpublic vertexTwoConst:ShaderRegisterElement;\n\tpublic uvTarget:ShaderRegisterElement;\n\tpublic colorAddTarget:ShaderRegisterElement;\n\tpublic colorMulTarget:ShaderRegisterElement;\n\t//vary\n\tpublic colorAddVary:ShaderRegisterElement;\n\tpublic colorMulVary:ShaderRegisterElement;\n\n\t//fragment\n\n\tpublic uvVar:ShaderRegisterElement;\n\n\t//these are targets only need to rotate ( normal and tangent )\n\tpublic rotationRegisters:Array<ShaderRegisterElement>;\n\n\tpublic needFragmentAnimation:boolean;\n\tpublic needUVAnimation:boolean;\n\n\tpublic sourceRegisters:Array<string>;\n\tpublic targetRegisters:Array<string>;\n\n\tprivate indexDictionary:Object = new Object();\n\n\t//set true if has an node which will change UV\n\tpublic hasUVNode:boolean;\n\t//set if the other nodes need to access the velocity\n\tpublic needVelocity:boolean;\n\t//set if has a billboard node.\n\tpublic hasBillboard:boolean;\n\t//set if has an node which will apply color multiple operation\n\tpublic hasColorMulNode:boolean;\n\t//set if has an node which will apply color add operation\n\tpublic hasColorAddNode:boolean;\n\n\tconstructor(profile:string)\n\t{\n\t\tsuper(profile);\n\t}\n\n\tpublic reset()\n\t{\n\t\tsuper.reset();\n\n\t\tthis.rotationRegisters = new Array<ShaderRegisterElement>();\n\t\tthis.positionAttribute = this.getRegisterFromString(this.sourceRegisters[0]);\n\t\tthis.scaleAndRotateTarget = this.getRegisterFromString(this.targetRegisters[0]);\n\t\tthis.addVertexTempUsages(this.scaleAndRotateTarget, 1);\n\n\t\tfor (var i:number /*int*/ = 1; i < this.targetRegisters.length; i++) {\n\t\t\tthis.rotationRegisters.push(this.getRegisterFromString(this.targetRegisters[i]));\n\t\t\tthis.addVertexTempUsages(this.rotationRegisters[i - 1], 1);\n\t\t}\n\n\t\tthis.scaleAndRotateTarget = new ShaderRegisterElement(this.scaleAndRotateTarget.regName, this.scaleAndRotateTarget.index); //only use xyz, w is used as vertexLife\n\n\t\t//allot const register\n\n\t\tthis.vertexZeroConst = this.getFreeVertexConstant();\n\t\tthis.vertexZeroConst = new ShaderRegisterElement(this.vertexZeroConst.regName, this.vertexZeroConst.index, 0);\n\t\tthis.vertexOneConst = new ShaderRegisterElement(this.vertexZeroConst.regName, this.vertexZeroConst.index, 1);\n\t\tthis.vertexTwoConst = new ShaderRegisterElement(this.vertexZeroConst.regName, this.vertexZeroConst.index, 2);\n\n\t\t//allot temp register\n\t\tthis.positionTarget = this.getFreeVertexVectorTemp();\n\t\tthis.addVertexTempUsages(this.positionTarget, 1);\n\t\tthis.positionTarget = new ShaderRegisterElement(this.positionTarget.regName, this.positionTarget.index);\n\n\t\tif (this.needVelocity) {\n\t\t\tthis.velocityTarget = this.getFreeVertexVectorTemp();\n\t\t\tthis.addVertexTempUsages(this.velocityTarget, 1);\n\t\t\tthis.velocityTarget = new ShaderRegisterElement(this.velocityTarget.regName, this.velocityTarget.index);\n\t\t\tthis.vertexTime = new ShaderRegisterElement(this.velocityTarget.regName, this.velocityTarget.index, 3);\n\t\t\tthis.vertexLife = new ShaderRegisterElement(this.positionTarget.regName, this.positionTarget.index, 3);\n\t\t} else {\n\t\t\tvar tempTime:ShaderRegisterElement = this.getFreeVertexVectorTemp();\n\t\t\tthis.addVertexTempUsages(tempTime, 1);\n\t\t\tthis.vertexTime = new ShaderRegisterElement(tempTime.regName, tempTime.index, 0);\n\t\t\tthis.vertexLife = new ShaderRegisterElement(tempTime.regName, tempTime.index, 1);\n\t\t}\n\n\t}\n\n\tpublic setUVSourceAndTarget(UVAttribute:string, UVVaring:string)\n\t{\n\t\tthis.uvVar = this.getRegisterFromString(UVVaring);\n\t\tthis.uvAttribute = this.getRegisterFromString(UVAttribute);\n\t\t//uv action is processed after normal actions,so use offsetTarget as uvTarget\n\t\tthis.uvTarget = new ShaderRegisterElement(this.positionTarget.regName, this.positionTarget.index);\n\t}\n\n\tpublic setRegisterIndex(node:AnimationNodeBase, parameterIndex:number /*int*/, registerIndex:number /*int*/)\n\t{\n\t\t//8 should be enough for any node.\n\t\tvar t:Array<number> /*int*/ = this.indexDictionary[node.id];\n\n\t\tif (t == null)\n\t\t\tt = this.indexDictionary[node.id] = new Array<number>(8) /*int*/;\n\n\t\tt[parameterIndex] = registerIndex;\n\t}\n\n\tpublic getRegisterIndex(node:AnimationNodeBase, parameterIndex:number /*int*/):number /*int*/\n\t{\n\t\treturn (<Array<number>> this.indexDictionary[node.id])[parameterIndex];\n\t}\n\n\tpublic getInitCode():string\n\t{\n\t\tvar len:number /*int*/ = this.sourceRegisters.length;\n\t\tvar code:string = \"\";\n\t\tfor (var i:number /*int*/ = 0; i < len; i++)\n\t\t\tcode += \"mov \" + this.targetRegisters[i] + \",\" + this.sourceRegisters[i] + \"\\n\";\n\n\t\tcode += \"mov \" + this.positionTarget + \".xyz,\" + this.vertexZeroConst.toString() + \"\\n\";\n\n\t\tif (this.needVelocity)\n\t\t\tcode += \"mov \" + this.velocityTarget + \".xyz,\" + this.vertexZeroConst.toString() + \"\\n\";\n\n\t\treturn code;\n\t}\n\n\tpublic getCombinationCode():string\n\t{\n\t\treturn \"add \" + this.scaleAndRotateTarget + \".xyz,\" + this.scaleAndRotateTarget + \".xyz,\" + this.positionTarget + \".xyz\\n\";\n\t}\n\n\tpublic initColorRegisters():string\n\t{\n\t\tvar code:string = \"\";\n\t\tif (this.hasColorMulNode) {\n\t\t\tthis.colorMulTarget = this.getFreeVertexVectorTemp();\n\t\t\tthis.addVertexTempUsages(this.colorMulTarget, 1);\n\t\t\tthis.colorMulVary = this.getFreeVarying();\n\t\t\tcode += \"mov \" + this.colorMulTarget + \",\" + this.vertexOneConst + \"\\n\";\n\t\t}\n\t\tif (this.hasColorAddNode) {\n\t\t\tthis.colorAddTarget = this.getFreeVertexVectorTemp();\n\t\t\tthis.addVertexTempUsages(this.colorAddTarget, 1);\n\t\t\tthis.colorAddVary = this.getFreeVarying();\n\t\t\tcode += \"mov \" + this.colorAddTarget + \",\" + this.vertexZeroConst + \"\\n\";\n\t\t}\n\t\treturn code;\n\t}\n\n\tpublic getColorPassCode():string\n\t{\n\t\tvar code:string = \"\";\n\t\tif (this.needFragmentAnimation && (this.hasColorAddNode || this.hasColorMulNode)) {\n\t\t\tif (this.hasColorMulNode)\n\t\t\t\tcode += \"mov \" + this.colorMulVary + \",\" + this.colorMulTarget + \"\\n\";\n\t\t\tif (this.hasColorAddNode)\n\t\t\t\tcode += \"mov \" + this.colorAddVary + \",\" + this.colorAddTarget + \"\\n\";\n\t\t}\n\t\treturn code;\n\t}\n\n\tpublic getColorCombinationCode(shadedTarget:string):string\n\t{\n\t\tvar code:string = \"\";\n\t\tif (this.needFragmentAnimation && (this.hasColorAddNode || this.hasColorMulNode)) {\n\t\t\tvar colorTarget:ShaderRegisterElement = this.getRegisterFromString(shadedTarget);\n\t\t\tthis.addFragmentTempUsages(colorTarget, 1);\n\t\t\tif (this.hasColorMulNode)\n\t\t\t\tcode += \"mul \" + colorTarget + \",\" + colorTarget + \",\" + this.colorMulVary + \"\\n\";\n\t\t\tif (this.hasColorAddNode)\n\t\t\t\tcode += \"add \" + colorTarget + \",\" + colorTarget + \",\" + this.colorAddVary + \"\\n\";\n\t\t}\n\t\treturn code;\n\t}\n\n\tprivate getRegisterFromString(code:string):ShaderRegisterElement\n\t{\n\t\tvar temp:Array<string> = code.split(/(\\d+)/);\n\t\treturn new ShaderRegisterElement(temp[0], parseInt(temp[1]));\n\t}\n\n\tpublic vertexConstantData:Array<number> = new Array<number>();\n\tpublic fragmentConstantData:Array<number> = new Array<number>();\n\n\tprivate _numVertexConstant:number /*int*/;\n\tprivate _numFragmentConstant:number /*int*/;\n\n\tpublic get numVertexConstant():number /*int*/\n\t{\n\t\treturn this._numVertexConstant;\n\t}\n\n\tpublic get numFragmentConstant():number /*int*/\n\t{\n\t\treturn this._numFragmentConstant;\n\t}\n\n\tpublic setDataLength()\n\t{\n\t\tthis._numVertexConstant = this.numUsedVertexConstants - this.vertexConstantOffset;\n\t\tthis._numFragmentConstant = this.numUsedFragmentConstants - this.fragmentConstantOffset;\n\t\tthis.vertexConstantData.length = this._numVertexConstant*4;\n\t\tthis.fragmentConstantData.length = this._numFragmentConstant*4;\n\t}\n\n\tpublic setVertexConst(index:number /*int*/, x:number = 0, y:number = 0, z:number = 0, w:number = 0)\n\t{\n\t\tvar _index:number /*int*/ = (index - this.vertexConstantOffset)*4;\n\t\tthis.vertexConstantData[_index++] = x;\n\t\tthis.vertexConstantData[_index++] = y;\n\t\tthis.vertexConstantData[_index++] = z;\n\t\tthis.vertexConstantData[_index] = w;\n\t}\n\n\tpublic setVertexConstFromArray(index:number /*int*/, data:Array<number>)\n\t{\n\t\tvar _index:number /*int*/ = (index - this.vertexConstantOffset)*4;\n\t\tfor (var i:number /*int*/ = 0; i < data.length; i++)\n\t\t\tthis.vertexConstantData[_index++] = data[i];\n\t}\n\n\tpublic setVertexConstFromMatrix(index:number /*int*/, matrix:Matrix3D)\n\t{\n\t\tvar rawData:Array<number> = matrix.rawData;\n\t\tvar _index:number /*int*/ = (index - this.vertexConstantOffset)*4;\n\t\tthis.vertexConstantData[_index++] = rawData[0];\n\t\tthis.vertexConstantData[_index++] = rawData[4];\n\t\tthis.vertexConstantData[_index++] = rawData[8];\n\t\tthis.vertexConstantData[_index++] = rawData[12];\n\t\tthis.vertexConstantData[_index++] = rawData[1];\n\t\tthis.vertexConstantData[_index++] = rawData[5];\n\t\tthis.vertexConstantData[_index++] = rawData[9];\n\t\tthis.vertexConstantData[_index++] = rawData[13];\n\t\tthis.vertexConstantData[_index++] = rawData[2];\n\t\tthis.vertexConstantData[_index++] = rawData[6];\n\t\tthis.vertexConstantData[_index++] = rawData[10];\n\t\tthis.vertexConstantData[_index++] = rawData[14];\n\t\tthis.vertexConstantData[_index++] = rawData[3];\n\t\tthis.vertexConstantData[_index++] = rawData[7];\n\t\tthis.vertexConstantData[_index++] = rawData[11];\n\t\tthis.vertexConstantData[_index] = rawData[15];\n\n\t}\n\n\tpublic setFragmentConst(index:number /*int*/, x:number = 0, y:number = 0, z:number = 0, w:number = 0)\n\t{\n\t\tvar _index:number /*int*/ = (index - this.fragmentConstantOffset)*4;\n\t\tthis.fragmentConstantData[_index++] = x;\n\t\tthis.fragmentConstantData[_index++] = y;\n\t\tthis.fragmentConstantData[_index++] = z;\n\t\tthis.fragmentConstantData[_index] = w;\n\t}\n}\n\nexport = AnimationRegisterCache;","import Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport IContextGL\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport IVertexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IVertexBuffer\");\n\nimport ParticleAnimationData\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleAnimationData\");\n\n/**\n * ...\n */\nclass AnimationSubGeometry\n{\n\tpublic static SUBGEOM_ID_COUNT:number = 0;\n\n\tpublic _pVertexData:Array<number>;\n\n\tpublic _pVertexBuffer:Array<IVertexBuffer> = new Array<IVertexBuffer>(8);\n\tpublic _pBufferContext:Array<IContextGL> = new Array<IContextGL>(8);\n\tpublic _pBufferDirty:Array<boolean> = new Array<boolean>(8);\n\n\tprivate _numVertices:number /*uint*/;\n\n\tprivate _totalLenOfOneVertex:number /*uint*/;\n\n\tpublic numProcessedVertices:number /*int*/ = 0;\n\n\tpublic previousTime:number = Number.NEGATIVE_INFINITY;\n\n\tpublic animationParticles:Array<ParticleAnimationData> = new Array<ParticleAnimationData>();\n\n\t/**\n\t * An id for this animation subgeometry, used to identify animation subgeometries when using animation sets.\n\t *\n\t * @private\n\t */\n\tpublic _iUniqueId:number;//Arcane\n\n\tconstructor()\n\t{\n\t\tfor (var i:number /*int*/ = 0; i < 8; i++)\n\t\t\tthis._pBufferDirty[i] = true;\n\n\t\tthis._iUniqueId = AnimationSubGeometry.SUBGEOM_ID_COUNT++;\n\t}\n\n\tpublic createVertexData(numVertices:number /*uint*/, totalLenOfOneVertex:number /*uint*/)\n\t{\n\t\tthis._numVertices = numVertices;\n\t\tthis._totalLenOfOneVertex = totalLenOfOneVertex;\n\t\tthis._pVertexData = new Array<number>(numVertices*totalLenOfOneVertex);\n\t}\n\n\tpublic activateVertexBuffer(index:number /*int*/, bufferOffset:number /*int*/, stage:Stage, format:string)\n\t{\n\t\tvar contextIndex:number /*int*/ = stage.stageIndex;\n\t\tvar context:IContextGL = <IContextGL> stage.context;\n\n\t\tvar buffer:IVertexBuffer = this._pVertexBuffer[contextIndex];\n\t\tif (!buffer || this._pBufferContext[contextIndex] != context) {\n\t\t\tbuffer = this._pVertexBuffer[contextIndex] = context.createVertexBuffer(this._numVertices, this._totalLenOfOneVertex);\n\t\t\tthis._pBufferContext[contextIndex] = context;\n\t\t\tthis._pBufferDirty[contextIndex] = true;\n\t\t}\n\t\tif (this._pBufferDirty[contextIndex]) {\n\t\t\tbuffer.uploadFromArray(this._pVertexData, 0, this._numVertices);\n\t\t\tthis._pBufferDirty[contextIndex] = false;\n\t\t}\n\t\tcontext.setVertexBufferAt(index, buffer, bufferOffset, format);\n\t}\n\n\tpublic dispose()\n\t{\n\t\twhile (this._pVertexBuffer.length) {\n\t\t\tvar vertexBuffer:IVertexBuffer = this._pVertexBuffer.pop()\n\n\t\t\tif (vertexBuffer)\n\t\t\t\tvertexBuffer.dispose();\n\t\t}\n\t}\n\n\tpublic invalidateBuffer()\n\t{\n\t\tfor (var i:number /*int*/ = 0; i < 8; i++)\n\t\t\tthis._pBufferDirty[i] = true;\n\t}\n\n\tpublic get vertexData():Array<number>\n\t{\n\t\treturn this._pVertexData;\n\t}\n\n\tpublic get numVertices():number /*uint*/\n\t{\n\t\treturn this._numVertices;\n\t}\n\n\tpublic get totalLenOfOneVertex():number /*uint*/\n\t{\n\t\treturn this._totalLenOfOneVertex;\n\t}\n}\n\nexport = AnimationSubGeometry;","import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\n\nclass ColorSegmentPoint\n{\n\tprivate _color:ColorTransform;\n\tprivate _life:number;\n\n\tconstructor(life:number, color:ColorTransform)\n\t{\n\t\t//0<life<1\n\t\tif (life <= 0 || life >= 1)\n\t\t\tthrow(new Error(\"life exceeds range (0,1)\"));\n\t\tthis._life = life;\n\t\tthis._color = color;\n\t}\n\n\tpublic get color():ColorTransform\n\t{\n\t\treturn this._color;\n\t}\n\n\tpublic get life():number\n\t{\n\t\treturn this._life;\n\t}\n\n}\n\nexport = ColorSegmentPoint;","import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\n/**\n * Contains transformation data for a skeleton joint, used for skeleton animation.\n *\n * @see away.animation.Skeleton\n * @see away.animation.SkeletonJoint\n *\n * todo: support (uniform) scale\n */\nclass JointPose\n{\n\t/**\n\t * The name of the joint to which the pose is associated\n\t */\n\tpublic name:string; // intention is that this should be used only at load time, not in the main loop\n\n\t/**\n\t * The rotation of the pose stored as a quaternion\n\t */\n\tpublic orientation:Quaternion = new Quaternion();\n\n\t/**\n\t * The translation of the pose\n\t */\n\tpublic translation:Vector3D = new Vector3D();\n\n\tconstructor()\n\t{\n\n\t}\n\n\t/**\n\t * Converts the transformation to a Matrix3D representation.\n\t *\n\t * @param target An optional target matrix to store the transformation. If not provided, it will create a new instance.\n\t * @return The transformation matrix of the pose.\n\t */\n\tpublic toMatrix3D(target:Matrix3D = null):Matrix3D\n\t{\n\t\tif (target == null)\n\t\t\ttarget = new Matrix3D();\n\n\t\tthis.orientation.toMatrix3D(target);\n\t\ttarget.appendTranslation(this.translation.x, this.translation.y, this.translation.z);\n\t\treturn target;\n\t}\n\n\t/**\n\t * Copies the transformation data from a source pose object into the existing pose object.\n\t *\n\t * @param pose The source pose to copy from.\n\t */\n\tpublic copyFrom(pose:JointPose)\n\t{\n\t\tvar or:Quaternion = pose.orientation;\n\t\tvar tr:Vector3D = pose.translation;\n\t\tthis.orientation.x = or.x;\n\t\tthis.orientation.y = or.y;\n\t\tthis.orientation.z = or.z;\n\t\tthis.orientation.w = or.w;\n\t\tthis.translation.x = tr.x;\n\t\tthis.translation.y = tr.y;\n\t\tthis.translation.z = tr.z;\n\t}\n}\n\nexport = JointPose;","import ParticleData\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleData\");\n\n/**\n * ...\n */\nclass ParticleAnimationData\n{\n\tpublic index:number /*uint*/;\n\tpublic startTime:number;\n\tpublic totalTime:number;\n\tpublic duration:number;\n\tpublic delay:number;\n\tpublic startVertexIndex:number /*uint*/;\n\tpublic numVertices:number /*uint*/;\n\n\tconstructor(index:number /*uint*/, startTime:number, duration:number, delay:number, particle:ParticleData)\n\t{\n\t\tthis.index = index;\n\t\tthis.startTime = startTime;\n\t\tthis.totalTime = duration + delay;\n\t\tthis.duration = duration;\n\t\tthis.delay = delay;\n\t\tthis.startVertexIndex = particle.startVertexIndex;\n\t\tthis.numVertices = particle.numVertices;\n\t}\n}\n\nexport = ParticleAnimationData;","import TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\n\nclass ParticleData\n{\n\tpublic particleIndex:number /*uint*/;\n\tpublic numVertices:number /*uint*/;\n\tpublic startVertexIndex:number /*uint*/;\n\tpublic subGeometry:TriangleSubGeometry;\n}\n\nexport = ParticleData","/**\n * Options for setting the properties mode of a particle animation node.\n */\nclass ParticlePropertiesMode\n{\n\t/**\n\t * Mode that defines the particle node as acting on global properties (ie. the properties set in the node constructor or the corresponding animation state).\n\t */\n\tpublic static GLOBAL:number /*uint*/ = 0;\n\n\t/**\n\t * Mode that defines the particle node as acting on local static properties (ie. the properties of particles set in the initialising on the animation set).\n\t */\n\tpublic static LOCAL_STATIC:number /*uint*/ = 1;\n\n\t/**\n\t * Mode that defines the particle node as acting on local dynamic properties (ie. the properties of the particles set in the corresponding animation state).\n\t */\n\tpublic static LOCAL_DYNAMIC:number /*uint*/ = 2;\n}\n\nexport = ParticlePropertiesMode;","/**\n * Dynamic class for holding the local properties of a particle, used for processing the static properties\n * of particles in the particle animation set before beginning upload to the GPU.\n */\nclass ParticleProperties\n{\n\t/**\n\t * The index of the current particle being set.\n\t */\n\tpublic index:number /*uint*/;\n\n\t/**\n\t * The total number of particles being processed by the particle animation set.\n\t */\n\tpublic total:number /*uint*/;\n\n\t/**\n\t * The start time of the particle.\n\t */\n\tpublic startTime:number;\n\n\t/**\n\t * The duration of the particle, an optional value used when the particle aniamtion set settings for <code>useDuration</code> are enabled in the constructor.\n\t *\n\t * @see away.animators.ParticleAnimationSet\n\t */\n\tpublic duration:number;\n\n\t/**\n\t * The delay between cycles of the particle, an optional value used when the particle aniamtion set settings for <code>useLooping</code> and  <code>useDelay</code> are enabled in the constructor.\n\t *\n\t * @see away.animators.ParticleAnimationSet\n\t */\n\tpublic delay:number;\n}\n\nexport = ParticleProperties;","/**\n * A value obect representing a single joint in a skeleton object.\n *\n * @see away.animators.Skeleton\n */\nclass SkeletonJoint\n{\n\t/**\n\t * The index of the parent joint in the skeleton's joints vector.\n\t *\n\t * @see away.animators.Skeleton#joints\n\t */\n\tpublic parentIndex:number /*int*/ = -1;\n\n\t/**\n\t * The name of the joint\n\t */\n\tpublic name:string; // intention is that this should be used only at load time, not in the main loop\n\n\t/**\n\t * The inverse bind pose matrix, as raw data, used to transform vertices to bind joint space in preparation for transformation using the joint matrix.\n\t */\n\tpublic inverseBindPose:Array<number>;\n\n\t/**\n\t * Creates a new <code>SkeletonJoint</code> object\n\t */\n\tconstructor()\n\t{\n\t}\n}\n\nexport = SkeletonJoint;","import AssetType\t\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport NamedAssetBase\t\t\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\n\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\n\n\n/**\n * A collection of pose objects, determining the pose for an entire skeleton.\n * The <code>jointPoses</code> vector object corresponds to a skeleton's <code>joints</code> vector object, however, there is no\n * reference to a skeleton's instance, since several skeletons can be influenced by the same pose (eg: animation\n * clips are added to any animator with a valid skeleton)\n *\n * @see away.animators.Skeleton\n * @see away.animators.JointPose\n */\nclass SkeletonPose extends NamedAssetBase implements IAsset\n{\n\t/**\n\t * A flat list of pose objects that comprise the skeleton pose. The pose indices correspond to the target skeleton's joint indices.\n\t *\n\t * @see away.animators.Skeleton#joints\n\t */\n\tpublic jointPoses:Array<JointPose>;\n\n\t/**\n\t * The total number of joint poses in the skeleton pose.\n\t */\n\tpublic get numJointPoses():number /*uint*/\n\t{\n\t\treturn this.jointPoses.length;\n\t}\n\n\t/**\n\t * Creates a new <code>SkeletonPose</code> object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.jointPoses = new Array<JointPose>();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.SKELETON_POSE;\n\t}\n\n\t/**\n\t * Returns the joint pose object with the given joint name, otherwise returns a null object.\n\t *\n\t * @param jointName The name of the joint object whose pose is to be found.\n\t * @return The pose object with the given joint name.\n\t */\n\tpublic jointPoseFromName(jointName:string):JointPose\n\t{\n\t\tvar jointPoseIndex:number /*int*/ = this.jointPoseIndexFromName(jointName);\n\t\tif (jointPoseIndex != -1)\n\t\t\treturn this.jointPoses[jointPoseIndex]; else\n\t\t\treturn null;\n\t}\n\n\t/**\n\t * Returns the pose index, given the joint name. -1 is returned if the joint name is not found in the pose.\n\t *\n\t * @param The name of the joint object whose pose is to be found.\n\t * @return The index of the pose object in the jointPoses Array\n\t *\n\t * @see #jointPoses\n\t */\n\tpublic jointPoseIndexFromName(jointName:string):number /*int*/\n\t{\n\t\t// this is implemented as a linear search, rather than a possibly\n\t\t// more optimal method (Dictionary lookup, for example) because:\n\t\t// a) it is assumed that it will be called once for each joint\n\t\t// b) it is assumed that it will be called only during load, and not during main loop\n\t\t// c) maintaining a dictionary (for safety) would dictate an interface to access JointPoses,\n\t\t//    rather than direct array access.  this would be sub-optimal.\n\t\tvar jointPoseIndex:number /*int*/;\n\t\tvar jointPose:JointPose;\n\t\tfor (var i:number /*uint*/; i < this.jointPoses.length; i++) {\n\t\t\tjointPose = this.jointPoses[i];\n\t\t\tif (jointPose.name == jointName)\n\t\t\t\treturn jointPoseIndex;\n\t\t\tjointPoseIndex++;\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\t/**\n\t * Creates a copy of the <code>SkeletonPose</code> object, with a dulpicate of its component joint poses.\n\t *\n\t * @return SkeletonPose\n\t */\n\tpublic clone():SkeletonPose\n\t{\n\t\tvar clone:SkeletonPose = new SkeletonPose();\n\t\tvar numJointPoses:number /*uint*/ = this.jointPoses.length;\n\t\tfor (var i:number /*uint*/ = 0; i < numJointPoses; i++) {\n\t\t\tvar cloneJointPose:JointPose = new JointPose();\n\t\t\tvar thisJointPose:JointPose = this.jointPoses[i];\n\t\t\tcloneJointPose.name = thisJointPose.name;\n\t\t\tcloneJointPose.copyFrom(thisJointPose);\n\t\t\tclone.jointPoses[i] = cloneJointPose;\n\t\t}\n\t\treturn clone;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\tthis.jointPoses.length = 0;\n\t}\n}\n\nexport = SkeletonPose;","import SkeletonJoint\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonJoint\");\n\nimport AssetType\t\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\nimport NamedAssetBase\t\t\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\n\n/**\n * A Skeleton object is a hierarchical grouping of joint objects that can be used for skeletal animation.\n *\n * @see away.animators.SkeletonJoint\n */\nclass Skeleton extends NamedAssetBase implements IAsset\n{\n\t/**\n\t * A flat list of joint objects that comprise the skeleton. Every joint except for the root has a parentIndex\n\t * property that is an index into this list.\n\t * A child joint should always have a higher index than its parent.\n\t */\n\tpublic joints:Array<SkeletonJoint>;\n\n\t/**\n\t * The total number of joints in the skeleton.\n\t */\n\tpublic get numJoints():number /*uint*/\n\t{\n\t\treturn this.joints.length;\n\t}\n\n\t/**\n\t * Creates a new <code>Skeleton</code> object\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\t// in the long run, it might be a better idea to not store Joint objects, but keep all data in Vectors, that we can upload easily?\n\t\tthis.joints = new Array<SkeletonJoint>();\n\t}\n\n\t/**\n\t * Returns the joint object in the skeleton with the given name, otherwise returns a null object.\n\t *\n\t * @param jointName The name of the joint object to be found.\n\t * @return The joint object with the given name.\n\t *\n\t * @see #joints\n\t */\n\tpublic jointFromName(jointName:string):SkeletonJoint\n\t{\n\t\tvar jointIndex:number /*int*/ = this.jointIndexFromName(jointName);\n\t\tif (jointIndex != -1)\n\t\t\treturn this.joints[jointIndex]; else\n\t\t\treturn null;\n\t}\n\n\t/**\n\t * Returns the joint index, given the joint name. -1 is returned if the joint name is not found.\n\t *\n\t * @param jointName The name of the joint object to be found.\n\t * @return The index of the joint object in the joints Array\n\t *\n\t * @see #joints\n\t */\n\tpublic jointIndexFromName(jointName:string):number /*int*/\n\t{\n\t\t// this is implemented as a linear search, rather than a possibly\n\t\t// more optimal method (Dictionary lookup, for example) because:\n\t\t// a) it is assumed that it will be called once for each joint\n\t\t// b) it is assumed that it will be called only during load, and not during main loop\n\t\t// c) maintaining a dictionary (for safety) would dictate an interface to access SkeletonJoints,\n\t\t//    rather than direct array access.  this would be sub-optimal.\n\t\tvar jointIndex:number /*int*/;\n\t\tvar joint:SkeletonJoint;\n\t\tfor (var i:number /*int*/; i < this.joints.length; i++) {\n\t\t\tjoint = this.joints[i];\n\t\t\tif (joint.name == jointName)\n\t\t\t\treturn jointIndex;\n\t\t\tjointIndex++;\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic dispose()\n\t{\n\t\tthis.joints.length = 0;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get assetType():string\n\t{\n\t\treturn AssetType.SKELETON;\n\t}\n}\n\nexport = Skeleton;","/**\n * Options for setting the animation mode of a vertex animator object.\n *\n * @see away.animators.VertexAnimator\n */\nclass VertexAnimationMode\n{\n\t/**\n\t * Animation mode that adds all outputs from active vertex animation state to form the current vertex animation pose.\n\t */\n\tpublic static ADDITIVE:string = \"additive\";\n\n\t/**\n\t * Animation mode that picks the output from a single vertex animation state to form the current vertex animation pose.\n\t */\n\tpublic static ABSOLUTE:string = \"absolute\";\n}\n\nexport = VertexAnimationMode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\n\n/**\n * Provides an abstract base class for nodes with time-based animation data in an animation blend tree.\n */\nclass AnimationClipNodeBase extends AnimationNodeBase\n{\n\tpublic _pLooping:boolean = true;\n\tpublic _pTotalDuration:number /*uint*/ = 0;\n\tpublic _pLastFrame:number /*uint*/;\n\n\tpublic _pStitchDirty:boolean = true;\n\tpublic _pStitchFinalFrame:boolean = false;\n\tpublic _pNumFrames:number /*uint*/ = 0;\n\n\tpublic _pDurations:Array<number> = new Array<number>();\n\t/*uint*/\n\tpublic _pTotalDelta:Vector3D = new Vector3D();\n\n\tpublic fixedFrameRate:boolean = true;\n\n\t/**\n\t * Determines whether the contents of the animation node have looping characteristics enabled.\n\t */\n\tpublic get looping():boolean\n\t{\n\t\treturn this._pLooping;\n\t}\n\n\tpublic set looping(value:boolean)\n\t{\n\t\tif (this._pLooping == value)\n\t\t\treturn;\n\n\t\tthis._pLooping = value;\n\n\t\tthis._pStitchDirty = true;\n\t}\n\n\t/**\n\t * Defines if looping content blends the final frame of animation data with the first (true) or works on the\n\t * assumption that both first and last frames are identical (false). Defaults to false.\n\t */\n\tpublic get stitchFinalFrame():boolean\n\t{\n\t\treturn this._pStitchFinalFrame;\n\t}\n\n\tpublic set stitchFinalFrame(value:boolean)\n\t{\n\t\tif (this._pStitchFinalFrame == value)\n\t\t\treturn;\n\n\t\tthis._pStitchFinalFrame = value;\n\n\t\tthis._pStitchDirty = true;\n\t}\n\n\tpublic get totalDuration():number /*uint*/\n\t{\n\t\tif (this._pStitchDirty)\n\t\t\tthis._pUpdateStitch();\n\n\t\treturn this._pTotalDuration;\n\t}\n\n\tpublic get totalDelta():Vector3D\n\t{\n\t\tif (this._pStitchDirty)\n\t\t\tthis._pUpdateStitch();\n\n\t\treturn this._pTotalDelta;\n\t}\n\n\tpublic get lastFrame():number /*uint*/\n\t{\n\t\tif (this._pStitchDirty)\n\t\t\tthis._pUpdateStitch();\n\n\t\treturn this._pLastFrame;\n\t}\n\n\t/**\n\t * Returns a vector of time values representing the duration (in milliseconds) of each animation frame in the clip.\n\t */\n\tpublic get durations():Array<number> /*uint*/\n\t{\n\t\treturn this._pDurations;\n\t}\n\n\t/**\n\t * Creates a new <code>AnimationClipNodeBase</code> object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * Updates the node's final frame stitch state.\n\t *\n\t * @see #stitchFinalFrame\n\t */\n\tpublic _pUpdateStitch()\n\t{\n\t\tthis._pStitchDirty = false;\n\n\t\tthis._pLastFrame = (this._pStitchFinalFrame)? this._pNumFrames : this._pNumFrames - 1;\n\n\t\tthis._pTotalDuration = 0;\n\t\tthis._pTotalDelta.x = 0;\n\t\tthis._pTotalDelta.y = 0;\n\t\tthis._pTotalDelta.z = 0;\n\t}\n}\n\nexport = AnimationClipNodeBase;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleAccelerationState\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleAccelerationState\");\n\n/**\n * A particle animation node used to apply a constant acceleration vector to the motion of a particle.\n */\nclass ParticleAccelerationNode extends ParticleNodeBase\n{\n\t/** @private */\n\tpublic _acceleration:Vector3D;\n\n\t/**\n\t * Reference for acceleration node properties on a single particle (when in local property mode).\n\t * Expects a <code>Vector3D</code> object representing the direction of acceleration on the particle.\n\t */\n\tpublic static ACCELERATION_VECTOR3D:string = \"AccelerationVector3D\";\n\n\t/**\n\t * Creates a new <code>ParticleAccelerationNode</code>\n\t *\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\n\t * @param    [optional] acceleration    Defines the default acceleration vector of the node, used when in global mode.\n\t */\n\tconstructor(mode:number /*uint*/, acceleration:Vector3D = null)\n\t{\n\t\tsuper(\"ParticleAcceleration\", mode, 3);\n\n\t\tthis._pStateClass = ParticleAccelerationState;\n\n\t\tthis._acceleration = acceleration || new Vector3D();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic pGetAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar accelerationValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleAccelerationState.ACCELERATION_INDEX, accelerationValue.index);\n\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\n\n\t\tvar code:string = \"mul \" + temp + \",\" + animationRegisterCache.vertexTime + \",\" + accelerationValue + \"\\n\";\n\n\t\tif (animationRegisterCache.needVelocity) {\n\t\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tcode += \"mul \" + temp2 + \",\" + temp + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + temp2 + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\n\t\t}\n\t\tanimationRegisterCache.removeVertexTempUsage(temp);\n\n\t\tcode += \"mul \" + temp + \",\" + temp + \",\" + animationRegisterCache.vertexTime + \"\\n\";\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + temp + \",\" + animationRegisterCache.positionTarget + \".xyz\\n\";\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticleAccelerationState\n\t{\n\t\treturn <ParticleAccelerationState> animator.getAnimationState(this);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\n\t{\n\t\tvar tempAcceleration:Vector3D = param[ParticleAccelerationNode.ACCELERATION_VECTOR3D];\n\t\tif (!tempAcceleration)\n\t\t\tthrow new Error(\"there is no \" + ParticleAccelerationNode.ACCELERATION_VECTOR3D + \" in param!\");\n\n\t\tthis._pOneData[0] = tempAcceleration.x/2;\n\t\tthis._pOneData[1] = tempAcceleration.y/2;\n\t\tthis._pOneData[2] = tempAcceleration.z/2;\n\t}\n}\n\nexport = ParticleAccelerationNode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleBezierCurveState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleBezierCurveState\");\n\n/**\n * A particle animation node used to control the position of a particle over time along a bezier curve.\n */\nclass ParticleBezierCurveNode extends ParticleNodeBase\n{\n\t/** @private */\n\tpublic _iControlPoint:Vector3D;\n\t/** @private */\n\tpublic _iEndPoint:Vector3D;\n\n\t/**\n\t * Reference for bezier curve node properties on a single particle (when in local property mode).\n\t * Expects a <code>Vector3D</code> object representing the control point position (0, 1, 2) of the curve.\n\t */\n\tpublic static BEZIER_CONTROL_VECTOR3D:string = \"BezierControlVector3D\";\n\n\t/**\n\t * Reference for bezier curve node properties on a single particle (when in local property mode).\n\t * Expects a <code>Vector3D</code> object representing the end point position (0, 1, 2) of the curve.\n\t */\n\tpublic static BEZIER_END_VECTOR3D:string = \"BezierEndVector3D\";\n\n\t/**\n\t * Creates a new <code>ParticleBezierCurveNode</code>\n\t *\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\n\t * @param    [optional] controlPoint    Defines the default control point of the node, used when in global mode.\n\t * @param    [optional] endPoint        Defines the default end point of the node, used when in global mode.\n\t */\n\tconstructor(mode:number /*uint*/, controlPoint:Vector3D = null, endPoint:Vector3D = null)\n\t{\n\t\tsuper(\"ParticleBezierCurve\", mode, 6);\n\n\t\tthis._pStateClass = ParticleBezierCurveState;\n\n\t\tthis._iControlPoint = controlPoint || new Vector3D();\n\t\tthis._iEndPoint = endPoint || new Vector3D();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar controlValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleBezierCurveState.BEZIER_CONTROL_INDEX, controlValue.index);\n\n\t\tvar endValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleBezierCurveState.BEZIER_END_INDEX, endValue.index);\n\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\tvar rev_time:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 0);\n\t\tvar time_2:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 1);\n\t\tvar time_temp:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 2);\n\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\n\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\tvar distance:ShaderRegisterElement = new ShaderRegisterElement(temp2.regName, temp2.index);\n\t\tanimationRegisterCache.removeVertexTempUsage(temp);\n\n\t\tvar code:string = \"\";\n\t\tcode += \"sub \" + rev_time + \",\" + animationRegisterCache.vertexOneConst + \",\" + animationRegisterCache.vertexLife + \"\\n\";\n\t\tcode += \"mul \" + time_2 + \",\" + animationRegisterCache.vertexLife + \",\" + animationRegisterCache.vertexLife + \"\\n\";\n\n\t\tcode += \"mul \" + time_temp + \",\" + animationRegisterCache.vertexLife + \",\" + rev_time + \"\\n\";\n\t\tcode += \"mul \" + time_temp + \",\" + time_temp + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\n\t\tcode += \"mul \" + distance + \".xyz,\" + time_temp + \",\" + controlValue + \"\\n\";\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\n\t\tcode += \"mul \" + distance + \".xyz,\" + time_2 + \",\" + endValue + \"\\n\";\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\n\n\t\tif (animationRegisterCache.needVelocity) {\n\t\t\tcode += \"mul \" + time_2 + \",\" + animationRegisterCache.vertexLife + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\n\t\t\tcode += \"sub \" + time_temp + \",\" + animationRegisterCache.vertexOneConst + \",\" + time_2 + \"\\n\";\n\t\t\tcode += \"mul \" + time_temp + \",\" + animationRegisterCache.vertexTwoConst + \",\" + time_temp + \"\\n\";\n\t\t\tcode += \"mul \" + distance + \".xyz,\" + controlValue + \",\" + time_temp + \"\\n\";\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\n\t\t\tcode += \"mul \" + distance + \".xyz,\" + endValue + \",\" + time_2 + \"\\n\";\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\n\t\t}\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticleBezierCurveState\n\t{\n\t\treturn <ParticleBezierCurveState> animator.getAnimationState(this);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\n\t{\n\t\tvar bezierControl:Vector3D = param[ParticleBezierCurveNode.BEZIER_CONTROL_VECTOR3D];\n\t\tif (!bezierControl)\n\t\t\tthrow new Error(\"there is no \" + ParticleBezierCurveNode.BEZIER_CONTROL_VECTOR3D + \" in param!\");\n\n\t\tvar bezierEnd:Vector3D = param[ParticleBezierCurveNode.BEZIER_END_VECTOR3D];\n\t\tif (!bezierEnd)\n\t\t\tthrow new Error(\"there is no \" + ParticleBezierCurveNode.BEZIER_END_VECTOR3D + \" in param!\");\n\n\t\tthis._pOneData[0] = bezierControl.x;\n\t\tthis._pOneData[1] = bezierControl.y;\n\t\tthis._pOneData[2] = bezierControl.z;\n\t\tthis._pOneData[3] = bezierEnd.x;\n\t\tthis._pOneData[4] = bezierEnd.y;\n\t\tthis._pOneData[5] = bezierEnd.z;\n\t}\n}\n\nexport = ParticleBezierCurveNode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleBillboardState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleBillboardState\");\n\n/**\n * A particle animation node that controls the rotation of a particle to always face the camera.\n */\nclass ParticleBillboardNode extends ParticleNodeBase\n{\n\t/** @private */\n\tpublic _iBillboardAxis:Vector3D;\n\n\t/**\n\t * Creates a new <code>ParticleBillboardNode</code>\n\t */\n\tconstructor(billboardAxis:Vector3D = null)\n\t{\n\t\tsuper(\"ParticleBillboard\", ParticlePropertiesMode.GLOBAL, 0, 4);\n\n\t\tthis._pStateClass = ParticleBillboardState;\n\n\t\tthis._iBillboardAxis = billboardAxis;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar rotationMatrixRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleBillboardState.MATRIX_INDEX, rotationMatrixRegister.index);\n\t\tanimationRegisterCache.getFreeVertexConstant();\n\t\tanimationRegisterCache.getFreeVertexConstant();\n\t\tanimationRegisterCache.getFreeVertexConstant();\n\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\n\t\tvar code:string = \"m33 \" + temp + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \",\" + rotationMatrixRegister + \"\\n\" +\n\t\t\t\t\t\t  \"mov \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp + \"\\n\";\n\n\t\tvar shaderRegisterElement:ShaderRegisterElement;\n\t\tfor (var i:number /*uint*/ = 0; i < animationRegisterCache.rotationRegisters.length; i++) {\n\t\t\tshaderRegisterElement = animationRegisterCache.rotationRegisters[i];\n\t\t\tcode += \"m33 \" + temp + \".xyz,\" + shaderRegisterElement + \",\" + rotationMatrixRegister + \"\\n\" +\n\t\t\t\t\t\"mov \" + shaderRegisterElement + \".xyz,\" + shaderRegisterElement + \"\\n\";\n\t\t}\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticleBillboardState\n\t{\n\t\treturn <ParticleBillboardState> animator.getAnimationState(this);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\n\t{\n\t\tparticleAnimationSet.hasBillboard = true;\n\t}\n}\n\nexport = ParticleBillboardNode;","import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleColorState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleColorState\");\n\n/**\n * A particle animation node used to control the color variation of a particle over time.\n */\nclass ParticleColorNode extends ParticleNodeBase\n{\n\t//default values used when creating states\n\t/** @private */\n\tpublic _iUsesMultiplier:boolean;\n\t/** @private */\n\tpublic _iUsesOffset:boolean;\n\t/** @private */\n\tpublic _iUsesCycle:boolean;\n\t/** @private */\n\tpublic _iUsesPhase:boolean;\n\t/** @private */\n\tpublic _iStartColor:ColorTransform;\n\t/** @private */\n\tpublic _iEndColor:ColorTransform;\n\t/** @private */\n\tpublic _iCycleDuration:number;\n\t/** @private */\n\tpublic _iCyclePhase:number;\n\n\t/**\n\t * Reference for color node properties on a single particle (when in local property mode).\n\t * Expects a <code>ColorTransform</code> object representing the start color transform applied to the particle.\n\t */\n\tpublic static COLOR_START_COLORTRANSFORM:string = \"ColorStartColorTransform\";\n\n\t/**\n\t * Reference for color node properties on a single particle (when in local property mode).\n\t * Expects a <code>ColorTransform</code> object representing the end color transform applied to the particle.\n\t */\n\tpublic static COLOR_END_COLORTRANSFORM:string = \"ColorEndColorTransform\";\n\n\t/**\n\t * Creates a new <code>ParticleColorNode</code>\n\t *\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\n\t * @param    [optional] usesMultiplier  Defines whether the node uses multiplier data in the shader for its color transformations. Defaults to true.\n\t * @param    [optional] usesOffset      Defines whether the node uses offset data in the shader for its color transformations. Defaults to true.\n\t * @param    [optional] usesCycle       Defines whether the node uses the <code>cycleDuration</code> property in the shader to calculate the period of the animation independent of particle duration. Defaults to false.\n\t * @param    [optional] usesPhase       Defines whether the node uses the <code>cyclePhase</code> property in the shader to calculate a starting offset to the cycle rotation of the particle. Defaults to false.\n\t * @param    [optional] startColor      Defines the default start color transform of the node, when in global mode.\n\t * @param    [optional] endColor        Defines the default end color transform of the node, when in global mode.\n\t * @param    [optional] cycleDuration   Defines the duration of the animation in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\n\t * @param    [optional] cyclePhase      Defines the phase of the cycle in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\n\t */\n\tconstructor(mode:number /*uint*/, usesMultiplier:boolean = true, usesOffset:boolean = true, usesCycle:boolean = false, usesPhase:boolean = false, startColor:ColorTransform = null, endColor:ColorTransform = null, cycleDuration:number = 1, cyclePhase:number = 0)\n\t{\n\t\tsuper(\"ParticleColor\", mode, (usesMultiplier && usesOffset)? 16 : 8, ParticleAnimationSet.COLOR_PRIORITY);\n\n\t\tthis._pStateClass = ParticleColorState;\n\n\t\tthis._iUsesMultiplier = usesMultiplier;\n\t\tthis._iUsesOffset = usesOffset;\n\t\tthis._iUsesCycle = usesCycle;\n\t\tthis._iUsesPhase = usesPhase;\n\n\t\tthis._iStartColor = startColor || new ColorTransform();\n\t\tthis._iEndColor = endColor || new ColorTransform();\n\t\tthis._iCycleDuration = cycleDuration;\n\t\tthis._iCyclePhase = cyclePhase;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar code:string = \"\";\n\t\tif (animationRegisterCache.needFragmentAnimation) {\n\t\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\n\t\t\tif (this._iUsesCycle) {\n\t\t\t\tvar cycleConst:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleColorState.CYCLE_INDEX, cycleConst.index);\n\n\t\t\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\n\t\t\t\tvar sin:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\n\t\t\t\tanimationRegisterCache.removeVertexTempUsage(temp);\n\n\t\t\t\tcode += \"mul \" + sin + \",\" + animationRegisterCache.vertexTime + \",\" + cycleConst + \".x\\n\";\n\n\t\t\t\tif (this._iUsesPhase)\n\t\t\t\t\tcode += \"add \" + sin + \",\" + sin + \",\" + cycleConst + \".y\\n\";\n\n\t\t\t\tcode += \"sin \" + sin + \",\" + sin + \"\\n\";\n\t\t\t}\n\n\t\t\tif (this._iUsesMultiplier) {\n\t\t\t\tvar startMultiplierValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\n\t\t\t\tvar deltaMultiplierValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\n\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleColorState.START_MULTIPLIER_INDEX, startMultiplierValue.index);\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleColorState.DELTA_MULTIPLIER_INDEX, deltaMultiplierValue.index);\n\n\t\t\t\tcode += \"mul \" + temp + \",\" + deltaMultiplierValue + \",\" + (this._iUsesCycle? sin : animationRegisterCache.vertexLife) + \"\\n\";\n\t\t\t\tcode += \"add \" + temp + \",\" + temp + \",\" + startMultiplierValue + \"\\n\";\n\t\t\t\tcode += \"mul \" + animationRegisterCache.colorMulTarget + \",\" + temp + \",\" + animationRegisterCache.colorMulTarget + \"\\n\";\n\t\t\t}\n\n\t\t\tif (this._iUsesOffset) {\n\t\t\t\tvar startOffsetValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.LOCAL_STATIC)? animationRegisterCache.getFreeVertexAttribute() : animationRegisterCache.getFreeVertexConstant();\n\t\t\t\tvar deltaOffsetValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.LOCAL_STATIC)? animationRegisterCache.getFreeVertexAttribute() : animationRegisterCache.getFreeVertexConstant();\n\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleColorState.START_OFFSET_INDEX, startOffsetValue.index);\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleColorState.DELTA_OFFSET_INDEX, deltaOffsetValue.index);\n\n\t\t\t\tcode += \"mul \" + temp + \",\" + deltaOffsetValue + \",\" + (this._iUsesCycle? sin : animationRegisterCache.vertexLife) + \"\\n\";\n\t\t\t\tcode += \"add \" + temp + \",\" + temp + \",\" + startOffsetValue + \"\\n\";\n\t\t\t\tcode += \"add \" + animationRegisterCache.colorAddTarget + \",\" + temp + \",\" + animationRegisterCache.colorAddTarget + \"\\n\";\n\t\t\t}\n\t\t}\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticleColorState\n\t{\n\t\treturn <ParticleColorState> animator.getAnimationState(this);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\n\t{\n\t\tif (this._iUsesMultiplier)\n\t\t\tparticleAnimationSet.hasColorMulNode = true;\n\t\tif (this._iUsesOffset)\n\t\t\tparticleAnimationSet.hasColorAddNode = true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\n\t{\n\t\tvar startColor:ColorTransform = param[ParticleColorNode.COLOR_START_COLORTRANSFORM];\n\t\tif (!startColor)\n\t\t\tthrow(new Error(\"there is no \" + ParticleColorNode.COLOR_START_COLORTRANSFORM + \" in param!\"));\n\n\t\tvar endColor:ColorTransform = param[ParticleColorNode.COLOR_END_COLORTRANSFORM];\n\t\tif (!endColor)\n\t\t\tthrow(new Error(\"there is no \" + ParticleColorNode.COLOR_END_COLORTRANSFORM + \" in param!\"));\n\n\t\tvar i:number /*uint*/ = 0;\n\n\t\tif (!this._iUsesCycle) {\n\t\t\t//multiplier\n\t\t\tif (this._iUsesMultiplier) {\n\t\t\t\tthis._pOneData[i++] = startColor.redMultiplier;\n\t\t\t\tthis._pOneData[i++] = startColor.greenMultiplier;\n\t\t\t\tthis._pOneData[i++] = startColor.blueMultiplier;\n\t\t\t\tthis._pOneData[i++] = startColor.alphaMultiplier;\n\t\t\t\tthis._pOneData[i++] = endColor.redMultiplier - startColor.redMultiplier;\n\t\t\t\tthis._pOneData[i++] = endColor.greenMultiplier - startColor.greenMultiplier;\n\t\t\t\tthis._pOneData[i++] = endColor.blueMultiplier - startColor.blueMultiplier;\n\t\t\t\tthis._pOneData[i++] = endColor.alphaMultiplier - startColor.alphaMultiplier;\n\t\t\t}\n\n\t\t\t//offset\n\t\t\tif (this._iUsesOffset) {\n\t\t\t\tthis._pOneData[i++] = startColor.redOffset/255;\n\t\t\t\tthis._pOneData[i++] = startColor.greenOffset/255;\n\t\t\t\tthis._pOneData[i++] = startColor.blueOffset/255;\n\t\t\t\tthis._pOneData[i++] = startColor.alphaOffset/255;\n\t\t\t\tthis._pOneData[i++] = (endColor.redOffset - startColor.redOffset)/255;\n\t\t\t\tthis._pOneData[i++] = (endColor.greenOffset - startColor.greenOffset)/255;\n\t\t\t\tthis._pOneData[i++] = (endColor.blueOffset - startColor.blueOffset)/255;\n\t\t\t\tthis._pOneData[i++] = (endColor.alphaOffset - startColor.alphaOffset)/255;\n\t\t\t}\n\t\t} else {\n\t\t\t//multiplier\n\t\t\tif (this._iUsesMultiplier) {\n\t\t\t\tthis._pOneData[i++] = (startColor.redMultiplier + endColor.redMultiplier)/2;\n\t\t\t\tthis._pOneData[i++] = (startColor.greenMultiplier + endColor.greenMultiplier)/2;\n\t\t\t\tthis._pOneData[i++] = (startColor.blueMultiplier + endColor.blueMultiplier)/2;\n\t\t\t\tthis._pOneData[i++] = (startColor.alphaMultiplier + endColor.alphaMultiplier)/2;\n\t\t\t\tthis._pOneData[i++] = (startColor.redMultiplier - endColor.redMultiplier)/2;\n\t\t\t\tthis._pOneData[i++] = (startColor.greenMultiplier - endColor.greenMultiplier)/2;\n\t\t\t\tthis._pOneData[i++] = (startColor.blueMultiplier - endColor.blueMultiplier)/2;\n\t\t\t\tthis._pOneData[i++] = (startColor.alphaMultiplier - endColor.alphaMultiplier)/2;\n\t\t\t}\n\n\t\t\t//offset\n\t\t\tif (this._iUsesOffset) {\n\t\t\t\tthis._pOneData[i++] = (startColor.redOffset + endColor.redOffset)/(255*2);\n\t\t\t\tthis._pOneData[i++] = (startColor.greenOffset + endColor.greenOffset)/(255*2);\n\t\t\t\tthis._pOneData[i++] = (startColor.blueOffset + endColor.blueOffset)/(255*2);\n\t\t\t\tthis._pOneData[i++] = (startColor.alphaOffset + endColor.alphaOffset)/(255*2);\n\t\t\t\tthis._pOneData[i++] = (startColor.redOffset - endColor.redOffset)/(255*2);\n\t\t\t\tthis._pOneData[i++] = (startColor.greenOffset - endColor.greenOffset)/(255*2);\n\t\t\t\tthis._pOneData[i++] = (startColor.blueOffset - endColor.blueOffset)/(255*2);\n\t\t\t\tthis._pOneData[i++] = (startColor.alphaOffset - endColor.alphaOffset)/(255*2);\n\t\t\t}\n\t\t}\n\n\t}\n}\n\nexport = ParticleColorNode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleFollowState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleFollowState\");\n\n/**\n * A particle animation node used to create a follow behaviour on a particle system.\n */\nclass ParticleFollowNode extends ParticleNodeBase\n{\n\t/** @private */\n\tpublic _iUsesPosition:boolean;\n\n\t/** @private */\n\tpublic _iUsesRotation:boolean;\n\n\t/** @private */\n\tpublic _iSmooth:boolean;\n\n\t/**\n\t * Creates a new <code>ParticleFollowNode</code>\n\t *\n\t * @param    [optional] usesPosition     Defines wehether the individual particle reacts to the position of the target.\n\t * @param    [optional] usesRotation     Defines wehether the individual particle reacts to the rotation of the target.\n\t * @param    [optional] smooth     Defines wehether the state calculate the interpolated value.\n\t */\n\tconstructor(usesPosition:boolean = true, usesRotation:boolean = true, smooth:boolean = false)\n\t{\n\t\tsuper(\"ParticleFollow\", ParticlePropertiesMode.LOCAL_DYNAMIC, (usesPosition && usesRotation)? 6 : 3, ParticleAnimationSet.POST_PRIORITY);\n\n\t\tthis._pStateClass = ParticleFollowState;\n\n\t\tthis._iUsesPosition = usesPosition;\n\t\tthis._iUsesRotation = usesRotation;\n\t\tthis._iSmooth = smooth;\n\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\t//TODO: use Quaternion to implement this function\n\t\tvar code:string = \"\";\n\t\tif (this._iUsesRotation) {\n\t\t\tvar rotationAttribute:ShaderRegisterElement = animationRegisterCache.getFreeVertexAttribute();\n\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleFollowState.FOLLOW_ROTATION_INDEX, rotationAttribute.index);\n\n\t\t\tvar temp1:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp1, 1);\n\t\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp2, 1);\n\t\t\tvar temp3:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\n\t\t\tvar temp4:ShaderRegisterElement;\n\t\t\tif (animationRegisterCache.hasBillboard) {\n\t\t\t\tanimationRegisterCache.addVertexTempUsages(temp3, 1);\n\t\t\t\ttemp4 = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\t}\n\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp1);\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp2);\n\t\t\tif (animationRegisterCache.hasBillboard)\n\t\t\t\tanimationRegisterCache.removeVertexTempUsage(temp3);\n\n\t\t\tvar len:number /*int*/ = animationRegisterCache.rotationRegisters.length;\n\t\t\tvar i:number /*int*/;\n\n\t\t\t//x axis\n\t\t\tcode += \"mov \" + temp1 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"mov \" + temp1 + \".x,\" + animationRegisterCache.vertexOneConst + \"\\n\";\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"sin \" + temp3 + \".y,\" + rotationAttribute + \".x\\n\";\n\t\t\tcode += \"cos \" + temp3 + \".z,\" + rotationAttribute + \".x\\n\";\n\t\t\tcode += \"mov \" + temp2 + \".x,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"mov \" + temp2 + \".y,\" + temp3 + \".z\\n\";\n\t\t\tcode += \"neg \" + temp2 + \".z,\" + temp3 + \".y\\n\";\n\n\t\t\tif (animationRegisterCache.hasBillboard)\n\t\t\t\tcode += \"m33 \" + temp4 + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz,\" + temp1 + \"\\n\";\n\t\t\telse {\n\t\t\t\tcode += \"m33 \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp1 + \"\\n\";\n\t\t\t\tfor (i = 0; i < len; i++)\n\t\t\t\t\tcode += \"m33 \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \",\" + temp1 + \"\\n\";\n\t\t\t}\n\n\t\t\t//y axis\n\t\t\tcode += \"mov \" + temp1 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"cos \" + temp1 + \".x,\" + rotationAttribute + \".y\\n\";\n\t\t\tcode += \"sin \" + temp1 + \".z,\" + rotationAttribute + \".y\\n\";\n\t\t\tcode += \"mov \" + temp2 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"mov \" + temp2 + \".y,\" + animationRegisterCache.vertexOneConst + \"\\n\";\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"neg \" + temp3 + \".x,\" + temp1 + \".z\\n\";\n\t\t\tcode += \"mov \" + temp3 + \".z,\" + temp1 + \".x\\n\";\n\n\t\t\tif (animationRegisterCache.hasBillboard)\n\t\t\t\tcode += \"m33 \" + temp4 + \".xyz,\" + temp4 + \".xyz,\" + temp1 + \"\\n\";\n\t\t\telse {\n\t\t\t\tcode += \"m33 \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp1 + \"\\n\";\n\t\t\t\tfor (i = 0; i < len; i++)\n\t\t\t\t\tcode += \"m33 \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \",\" + temp1 + \"\\n\";\n\t\t\t}\n\n\t\t\t//z axis\n\t\t\tcode += \"mov \" + temp2 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"sin \" + temp2 + \".x,\" + rotationAttribute + \".z\\n\";\n\t\t\tcode += \"cos \" + temp2 + \".y,\" + rotationAttribute + \".z\\n\";\n\t\t\tcode += \"mov \" + temp1 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"mov \" + temp1 + \".x,\" + temp2 + \".y\\n\";\n\t\t\tcode += \"neg \" + temp1 + \".y,\" + temp2 + \".x\\n\";\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"mov \" + temp3 + \".z,\" + animationRegisterCache.vertexOneConst + \"\\n\";\n\n\t\t\tif (animationRegisterCache.hasBillboard) {\n\t\t\t\tcode += \"m33 \" + temp4 + \".xyz,\" + temp4 + \".xyz,\" + temp1 + \"\\n\";\n\t\t\t\tcode += \"sub \" + temp4 + \".xyz,\" + temp4 + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\n\t\t\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp4 + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\n\t\t\t} else {\n\t\t\t\tcode += \"m33 \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp1 + \"\\n\";\n\t\t\t\tfor (i = 0; i < len; i++)\n\t\t\t\t\tcode += \"m33 \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \",\" + temp1 + \"\\n\";\n\t\t\t}\n\n\t\t}\n\n\t\tif (this._iUsesPosition) {\n\t\t\tvar positionAttribute:ShaderRegisterElement = animationRegisterCache.getFreeVertexAttribute();\n\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleFollowState.FOLLOW_POSITION_INDEX, positionAttribute.index);\n\t\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + positionAttribute + \",\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\n\t\t}\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticleFollowState\n\t{\n\t\treturn <ParticleFollowState> animator.getAnimationState(this);\n\t}\n}\n\nexport = ParticleFollowNode;","import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleInitialColorState\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleInitialColorState\");\n\n/**\n *\n */\nclass ParticleInitialColorNode extends ParticleNodeBase\n{\n\t//default values used when creating states\n\t/** @private */\n\tpublic _iUsesMultiplier:boolean;\n\t/** @private */\n\tpublic _iUsesOffset:boolean;\n\t/** @private */\n\tpublic _iInitialColor:ColorTransform;\n\n\t/**\n\t * Reference for color node properties on a single particle (when in local property mode).\n\t * Expects a <code>ColorTransform</code> object representing the color transform applied to the particle.\n\t */\n\tpublic static COLOR_INITIAL_COLORTRANSFORM:string = \"ColorInitialColorTransform\";\n\n\tconstructor(mode:number /*uint*/, usesMultiplier:boolean = true, usesOffset:boolean = false, initialColor:ColorTransform = null)\n\t{\n\t\tsuper(\"ParticleInitialColor\", mode, (usesMultiplier && usesOffset)? 8 : 4, ParticleAnimationSet.COLOR_PRIORITY);\n\n\t\tthis._pStateClass = ParticleInitialColorState;\n\n\t\tthis._iUsesMultiplier = usesMultiplier;\n\t\tthis._iUsesOffset = usesOffset;\n\t\tthis._iInitialColor = initialColor || new ColorTransform();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar code:string = \"\";\n\t\tif (animationRegisterCache.needFragmentAnimation) {\n\n\t\t\tif (this._iUsesMultiplier) {\n\t\t\t\tvar multiplierValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleInitialColorState.MULTIPLIER_INDEX, multiplierValue.index);\n\n\t\t\t\tcode += \"mul \" + animationRegisterCache.colorMulTarget + \",\" + multiplierValue + \",\" + animationRegisterCache.colorMulTarget + \"\\n\";\n\t\t\t}\n\n\t\t\tif (this._iUsesOffset) {\n\t\t\t\tvar offsetValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.LOCAL_STATIC)? animationRegisterCache.getFreeVertexAttribute() : animationRegisterCache.getFreeVertexConstant();\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleInitialColorState.OFFSET_INDEX, offsetValue.index);\n\n\t\t\t\tcode += \"add \" + animationRegisterCache.colorAddTarget + \",\" + offsetValue + \",\" + animationRegisterCache.colorAddTarget + \"\\n\";\n\t\t\t}\n\t\t}\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\n\t{\n\t\tif (this._iUsesMultiplier)\n\t\t\tparticleAnimationSet.hasColorMulNode = true;\n\t\tif (this._iUsesOffset)\n\t\t\tparticleAnimationSet.hasColorAddNode = true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\n\t{\n\t\tvar initialColor:ColorTransform = param[ParticleInitialColorNode.COLOR_INITIAL_COLORTRANSFORM];\n\t\tif (!initialColor)\n\t\t\tthrow(new Error(\"there is no \" + ParticleInitialColorNode.COLOR_INITIAL_COLORTRANSFORM + \" in param!\"));\n\n\t\tvar i:number /*uint*/ = 0;\n\n\t\t//multiplier\n\t\tif (this._iUsesMultiplier) {\n\t\t\tthis._pOneData[i++] = initialColor.redMultiplier;\n\t\t\tthis._pOneData[i++] = initialColor.greenMultiplier;\n\t\t\tthis._pOneData[i++] = initialColor.blueMultiplier;\n\t\t\tthis._pOneData[i++] = initialColor.alphaMultiplier;\n\t\t}\n\t\t//offset\n\t\tif (this._iUsesOffset) {\n\t\t\tthis._pOneData[i++] = initialColor.redOffset/255;\n\t\t\tthis._pOneData[i++] = initialColor.greenOffset/255;\n\t\t\tthis._pOneData[i++] = initialColor.blueOffset/255;\n\t\t\tthis._pOneData[i++] = initialColor.alphaOffset/255;\n\t\t}\n\n\t}\n\n}\n\nexport = ParticleInitialColorNode;","import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\n\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\n\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\n\n/**\n * Provides an abstract base class for particle animation nodes.\n */\nclass ParticleNodeBase extends AnimationNodeBase\n{\n\tprivate _priority:number /*int*/;\n\n\tpublic _pMode:number /*uint*/;\n\tpublic _pDataLength:number /*uint*/ = 3;\n\tpublic _pOneData:Array<number>;\n\n\tpublic _iDataOffset:number /*uint*/;\n\n\t//modes alias\n\tprivate static GLOBAL:string = 'Global';\n\tprivate static LOCAL_STATIC:string = 'LocalStatic';\n\tprivate static LOCAL_DYNAMIC:string = 'LocalDynamic';\n\n\t//modes list\n\tprivate static MODES:Object =\n\t{\n\t\t0:ParticleNodeBase.GLOBAL,\n\t\t1:ParticleNodeBase.LOCAL_STATIC,\n\t\t2:ParticleNodeBase.LOCAL_DYNAMIC\n\t};\n\n\t/**\n\t * Returns the property mode of the particle animation node. Typically set in the node constructor\n\t *\n\t * @see away.animators.ParticlePropertiesMode\n\t */\n\tpublic get mode():number /*uint*/\n\t{\n\t\treturn this._pMode;\n\t}\n\n\t/**\n\t * Returns the priority of the particle animation node, used to order the agal generated in a particle animation set. Set automatically on instantiation.\n\t *\n\t * @see away.animators.ParticleAnimationSet\n\t * @see #getAGALVertexCode\n\t */\n\tpublic get priority():number /*int*/\n\t{\n\t\treturn this._priority;\n\t}\n\n\t/**\n\t * Returns the length of the data used by the node when in <code>LOCAL_STATIC</code> mode. Used to generate the local static data of the particle animation set.\n\t *\n\t * @see away.animators.ParticleAnimationSet\n\t * @see #getAGALVertexCode\n\t */\n\tpublic get dataLength():number /*int*/\n\t{\n\t\treturn this._pDataLength;\n\t}\n\n\t/**\n\t * Returns the generated data vector of the node after one particle pass during the generation of all local static data of the particle animation set.\n\t *\n\t * @see away.animators.ParticleAnimationSet\n\t * @see #generatePropertyOfOneParticle\n\t */\n\tpublic get oneData():Array<number>\n\t{\n\t\treturn this._pOneData;\n\t}\n\n\t/**\n\t * Creates a new <code>ParticleNodeBase</code> object.\n\t *\n\t * @param               name            Defines the generic name of the particle animation node.\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\n\t * @param               dataLength      Defines the length of the data used by the node when in <code>LOCAL_STATIC</code> mode.\n\t * @param    [optional] priority        the priority of the particle animation node, used to order the agal generated in a particle animation set. Defaults to 1.\n\t */\n\tconstructor(name:string, mode:number /*uint*/, dataLength:number /*uint*/, priority:number /*int*/ = 1)\n\t{\n\t\tsuper();\n\n\t\tname = name + ParticleNodeBase.MODES[mode];\n\n\t\tthis.name = name;\n\t\tthis._pMode = mode;\n\t\tthis._priority = priority;\n\t\tthis._pDataLength = dataLength;\n\n\t\tthis._pOneData = new Array<number>(this._pDataLength);\n\t}\n\n\t/**\n\t * Returns the AGAL code of the particle animation node for use in the vertex shader.\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Returns the AGAL code of the particle animation node for use in the fragment shader.\n\t */\n\tpublic getAGALFragmentCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Returns the AGAL code of the particle animation node for use in the fragment shader when UV coordinates are required.\n\t */\n\tpublic getAGALUVCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Called internally by the particle animation set when assigning the set of static properties originally defined by the initParticleFunc of the set.\n\t *\n\t * @see away.animators.ParticleAnimationSet#initParticleFunc\n\t */\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\n\t{\n\n\t}\n\n\t/**\n\t * Called internally by the particle animation set when determining the requirements of the particle animation node AGAL.\n\t */\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\n\t{\n\n\t}\n}\n\nexport = ParticleNodeBase;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleOrbitState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleOrbitState\");\n\n/**\n * A particle animation node used to control the position of a particle over time around a circular orbit.\n */\nclass ParticleOrbitNode extends ParticleNodeBase\n{\n\t/** @private */\n\tpublic _iUsesEulers:boolean;\n\n\t/** @private */\n\tpublic _iUsesCycle:boolean;\n\n\t/** @private */\n\tpublic _iUsesPhase:boolean;\n\n\t/** @private */\n\tpublic _iRadius:number;\n\t/** @private */\n\tpublic _iCycleDuration:number;\n\t/** @private */\n\tpublic _iCyclePhase:number;\n\t/** @private */\n\tpublic _iEulers:Vector3D;\n\n\t/**\n\t * Reference for orbit node properties on a single particle (when in local property mode).\n\t * Expects a <code>Vector3D</code> object representing the radius (x), cycle speed (y) and cycle phase (z) of the motion on the particle.\n\t */\n\tpublic static ORBIT_VECTOR3D:string = \"OrbitVector3D\";\n\n\t/**\n\t * Creates a new <code>ParticleOrbitNode</code> object.\n\t *\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\n\t * @param    [optional] usesEulers      Defines whether the node uses the <code>eulers</code> property in the shader to calculate a rotation on the orbit. Defaults to true.\n\t * @param    [optional] usesCycle       Defines whether the node uses the <code>cycleDuration</code> property in the shader to calculate the period of the orbit independent of particle duration. Defaults to false.\n\t * @param    [optional] usesPhase       Defines whether the node uses the <code>cyclePhase</code> property in the shader to calculate a starting offset to the cycle rotation of the particle. Defaults to false.\n\t * @param    [optional] radius          Defines the radius of the orbit when in global mode. Defaults to 100.\n\t * @param    [optional] cycleDuration   Defines the duration of the orbit in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\n\t * @param    [optional] cyclePhase      Defines the phase of the orbit in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\n\t * @param    [optional] eulers          Defines the euler rotation in degrees, applied to the orientation of the orbit when in global mode.\n\t */\n\tconstructor(mode:number /*uint*/, usesEulers:boolean = true, usesCycle:boolean = false, usesPhase:boolean = false, radius:number = 100, cycleDuration:number = 1, cyclePhase:number = 0, eulers:Vector3D = null)\n\t{\n\t\tvar len:number /*int*/ = 3;\n\t\tif (usesPhase)\n\t\t\tlen++;\n\t\tsuper(\"ParticleOrbit\", mode, len);\n\n\t\tthis._pStateClass = ParticleOrbitState;\n\n\t\tthis._iUsesEulers = usesEulers;\n\t\tthis._iUsesCycle = usesCycle;\n\t\tthis._iUsesPhase = usesPhase;\n\n\t\tthis._iRadius = radius;\n\t\tthis._iCycleDuration = cycleDuration;\n\t\tthis._iCyclePhase = cyclePhase;\n\t\tthis._iEulers = eulers || new Vector3D();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar orbitRegister:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleOrbitState.ORBIT_INDEX, orbitRegister.index);\n\n\t\tvar eulersMatrixRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleOrbitState.EULERS_INDEX, eulersMatrixRegister.index);\n\t\tanimationRegisterCache.getFreeVertexConstant();\n\t\tanimationRegisterCache.getFreeVertexConstant();\n\t\tanimationRegisterCache.getFreeVertexConstant();\n\n\t\tvar temp1:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\tanimationRegisterCache.addVertexTempUsages(temp1, 1);\n\t\tvar distance:ShaderRegisterElement = new ShaderRegisterElement(temp1.regName, temp1.index);\n\n\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\tvar cos:ShaderRegisterElement = new ShaderRegisterElement(temp2.regName, temp2.index, 0);\n\t\tvar sin:ShaderRegisterElement = new ShaderRegisterElement(temp2.regName, temp2.index, 1);\n\t\tvar degree:ShaderRegisterElement = new ShaderRegisterElement(temp2.regName, temp2.index, 2);\n\t\tanimationRegisterCache.removeVertexTempUsage(temp1);\n\n\t\tvar code:string = \"\";\n\n\t\tif (this._iUsesCycle) {\n\t\t\tcode += \"mul \" + degree + \",\" + animationRegisterCache.vertexTime + \",\" + orbitRegister + \".y\\n\";\n\n\t\t\tif (this._iUsesPhase)\n\t\t\t\tcode += \"add \" + degree + \",\" + degree + \",\" + orbitRegister + \".w\\n\";\n\t\t} else\n\t\t\tcode += \"mul \" + degree + \",\" + animationRegisterCache.vertexLife + \",\" + orbitRegister + \".y\\n\";\n\n\t\tcode += \"cos \" + cos + \",\" + degree + \"\\n\";\n\t\tcode += \"sin \" + sin + \",\" + degree + \"\\n\";\n\t\tcode += \"mul \" + distance + \".x,\" + cos + \",\" + orbitRegister + \".x\\n\";\n\t\tcode += \"mul \" + distance + \".y,\" + sin + \",\" + orbitRegister + \".x\\n\";\n\t\tcode += \"mov \" + distance + \".wz\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\tif (this._iUsesEulers)\n\t\t\tcode += \"m44 \" + distance + \",\" + distance + \",\" + eulersMatrixRegister + \"\\n\";\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\n\n\t\tif (animationRegisterCache.needVelocity) {\n\t\t\tcode += \"neg \" + distance + \".x,\" + sin + \"\\n\";\n\t\t\tcode += \"mov \" + distance + \".y,\" + cos + \"\\n\";\n\t\t\tcode += \"mov \" + distance + \".zw,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tif (this._iUsesEulers)\n\t\t\t\tcode += \"m44 \" + distance + \",\" + distance + \",\" + eulersMatrixRegister + \"\\n\";\n\t\t\tcode += \"mul \" + distance + \",\" + distance + \",\" + orbitRegister + \".z\\n\";\n\t\t\tcode += \"div \" + distance + \",\" + distance + \",\" + orbitRegister + \".y\\n\";\n\t\t\tif (!this._iUsesCycle)\n\t\t\t\tcode += \"div \" + distance + \",\" + distance + \",\" + animationRegisterCache.vertexLife + \"\\n\";\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz,\" + distance + \".xyz\\n\";\n\t\t}\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticleOrbitState\n\t{\n\t\treturn <ParticleOrbitState> animator.getAnimationState(this);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\n\t{\n\t\t//Vector3D.x is radius, Vector3D.y is cycle duration, Vector3D.z is phase\n\t\tvar orbit:Vector3D = param[ParticleOrbitNode.ORBIT_VECTOR3D];\n\t\tif (!orbit)\n\t\t\tthrow new Error(\"there is no \" + ParticleOrbitNode.ORBIT_VECTOR3D + \" in param!\");\n\n\t\tthis._pOneData[0] = orbit.x;\n\t\tif (this._iUsesCycle && orbit.y <= 0)\n\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\n\t\tthis._pOneData[1] = Math.PI*2/(!this._iUsesCycle? 1 : orbit.y);\n\t\tthis._pOneData[2] = orbit.x*Math.PI*2;\n\t\tif (this._iUsesPhase)\n\t\t\tthis._pOneData[3] = orbit.z*Math.PI/180;\n\t}\n}\n\nexport = ParticleOrbitNode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleOscillatorState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleOscillatorState\");\n\n/**\n * A particle animation node used to control the position of a particle over time using simple harmonic motion.\n */\nclass ParticleOscillatorNode extends ParticleNodeBase\n{\n\t/** @private */\n\tpublic _iOscillator:Vector3D;\n\n\t/**\n\t * Reference for ocsillator node properties on a single particle (when in local property mode).\n\t * Expects a <code>Vector3D</code> object representing the axis (x,y,z) and cycle speed (w) of the motion on the particle.\n\t */\n\tpublic static OSCILLATOR_VECTOR3D:string = \"OscillatorVector3D\";\n\n\t/**\n\t * Creates a new <code>ParticleOscillatorNode</code>\n\t *\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\n\t * @param    [optional] oscillator      Defines the default oscillator axis (x, y, z) and cycleDuration (w) of the node, used when in global mode.\n\t */\n\tconstructor(mode:number /*uint*/, oscillator:Vector3D = null)\n\t{\n\t\tsuper(\"ParticleOscillator\", mode, 4);\n\n\t\tthis._pStateClass = ParticleOscillatorState;\n\n\t\tthis._iOscillator = oscillator || new Vector3D();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar oscillatorRegister:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleOscillatorState.OSCILLATOR_INDEX, oscillatorRegister.index);\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\tvar dgree:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 0);\n\t\tvar sin:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 1);\n\t\tvar cos:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 2);\n\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\n\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\tvar distance:ShaderRegisterElement = new ShaderRegisterElement(temp2.regName, temp2.index);\n\t\tanimationRegisterCache.removeVertexTempUsage(temp);\n\n\t\tvar code:string = \"\";\n\t\tcode += \"mul \" + dgree + \",\" + animationRegisterCache.vertexTime + \",\" + oscillatorRegister + \".w\\n\";\n\t\tcode += \"sin \" + sin + \",\" + dgree + \"\\n\";\n\t\tcode += \"mul \" + distance + \".xyz,\" + sin + \",\" + oscillatorRegister + \".xyz\\n\";\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\n\n\t\tif (animationRegisterCache.needVelocity) {\n\t\t\tcode += \"cos \" + cos + \",\" + dgree + \"\\n\";\n\t\t\tcode += \"mul \" + distance + \".xyz,\" + cos + \",\" + oscillatorRegister + \".xyz\\n\";\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\n\t\t}\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticleOscillatorState\n\t{\n\t\treturn <ParticleOscillatorState> animator.getAnimationState(this);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\n\t{\n\t\t//(Vector3D.x,Vector3D.y,Vector3D.z) is oscillator axis, Vector3D.w is oscillator cycle duration\n\t\tvar drift:Vector3D = param[ParticleOscillatorNode.OSCILLATOR_VECTOR3D];\n\t\tif (!drift)\n\t\t\tthrow(new Error(\"there is no \" + ParticleOscillatorNode.OSCILLATOR_VECTOR3D + \" in param!\"));\n\n\t\tthis._pOneData[0] = drift.x;\n\t\tthis._pOneData[1] = drift.y;\n\t\tthis._pOneData[2] = drift.z;\n\t\tif (drift.w <= 0)\n\t\t\tthrow(new Error(\"the cycle duration must greater than zero\"));\n\t\tthis._pOneData[3] = Math.PI*2/drift.w;\n\t}\n}\n\nexport = ParticleOscillatorNode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticlePositionState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticlePositionState\");\n\n/**\n * A particle animation node used to set the starting position of a particle.\n */\nclass ParticlePositionNode extends ParticleNodeBase\n{\n\t/** @private */\n\tpublic _iPosition:Vector3D;\n\n\t/**\n\t * Reference for position node properties on a single particle (when in local property mode).\n\t * Expects a <code>Vector3D</code> object representing position of the particle.\n\t */\n\tpublic static POSITION_VECTOR3D:string = \"PositionVector3D\";\n\n\t/**\n\t * Creates a new <code>ParticlePositionNode</code>\n\t *\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\n\t * @param    [optional] position        Defines the default position of the particle when in global mode. Defaults to 0,0,0.\n\t */\n\tconstructor(mode:number /*uint*/, position:Vector3D = null)\n\t{\n\t\tsuper(\"ParticlePosition\", mode, 3);\n\n\t\tthis._pStateClass = ParticlePositionState;\n\n\t\tthis._iPosition = position || new Vector3D();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar positionAttribute:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticlePositionState.POSITION_INDEX, positionAttribute.index);\n\n\t\treturn \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + positionAttribute + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticlePositionState\n\t{\n\t\treturn <ParticlePositionState> animator.getAnimationState(this);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\n\t{\n\t\tvar offset:Vector3D = param[ParticlePositionNode.POSITION_VECTOR3D];\n\t\tif (!offset)\n\t\t\tthrow(new Error(\"there is no \" + ParticlePositionNode.POSITION_VECTOR3D + \" in param!\"));\n\n\t\tthis._pOneData[0] = offset.x;\n\t\tthis._pOneData[1] = offset.y;\n\t\tthis._pOneData[2] = offset.z;\n\t}\n}\n\nexport = ParticlePositionNode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleRotateToHeadingState\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState\");\n\n/**\n * A particle animation node used to control the rotation of a particle to match its heading vector.\n */\nclass ParticleRotateToHeadingNode extends ParticleNodeBase\n{\n\t/**\n\t * Creates a new <code>ParticleBillboardNode</code>\n\t */\n\tconstructor()\n\t{\n\t\tsuper(\"ParticleRotateToHeading\", ParticlePropertiesMode.GLOBAL, 0, 3);\n\n\t\tthis._pStateClass = ParticleRotateToHeadingState;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar len:number /*int*/ = animationRegisterCache.rotationRegisters.length;\n\t\tvar i:number /*int*/;\n\t\tif (animationRegisterCache.hasBillboard) {\n\t\t\tvar temp1:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp1, 1);\n\t\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp2, 1);\n\t\t\tvar temp3:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\n\t\t\tvar rotationMatrixRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\n\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleRotateToHeadingState.MATRIX_INDEX, rotationMatrixRegister.index);\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\n\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp1);\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp2);\n\n\t\t\t//process the velocity\n\t\t\tcode += \"m33 \" + temp1 + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz,\" + rotationMatrixRegister + \"\\n\";\n\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"mov \" + temp3 + \".xy,\" + temp1 + \".xy\\n\";\n\t\t\tcode += \"nrm \" + temp3 + \".xyz,\" + temp3 + \".xyz\\n\";\n\n\t\t\t//temp3.x=cos,temp3.y=sin\n\t\t\t//only process z axis\n\t\t\tcode += \"mov \" + temp2 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"mov \" + temp2 + \".x,\" + temp3 + \".y\\n\";\n\t\t\tcode += \"mov \" + temp2 + \".y,\" + temp3 + \".x\\n\";\n\t\t\tcode += \"mov \" + temp1 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"mov \" + temp1 + \".x,\" + temp3 + \".x\\n\";\n\t\t\tcode += \"neg \" + temp1 + \".y,\" + temp3 + \".y\\n\";\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"mov \" + temp3 + \".z,\" + animationRegisterCache.vertexOneConst + \"\\n\";\n\t\t\tcode += \"m33 \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp1 + \"\\n\";\n\t\t\tfor (i = 0; i < len; i++)\n\t\t\t\tcode += \"m33 \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \",\" + temp1 + \"\\n\";\n\t\t} else {\n\t\t\tvar nrmVel:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tanimationRegisterCache.addVertexTempUsages(nrmVel, 1);\n\n\t\t\tvar xAxis:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tanimationRegisterCache.addVertexTempUsages(xAxis, 1);\n\n\t\t\tvar R:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tanimationRegisterCache.addVertexTempUsages(R, 1);\n\t\t\tvar R_rev:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tvar cos:ShaderRegisterElement = new ShaderRegisterElement(R.regName, R.index, 3);\n\t\t\tvar sin:ShaderRegisterElement = new ShaderRegisterElement(R_rev.regName, R_rev.index, 3);\n\t\t\tvar cos2:ShaderRegisterElement = new ShaderRegisterElement(nrmVel.regName, nrmVel.index, 3);\n\t\t\tvar tempSingle:ShaderRegisterElement = sin;\n\n\t\t\tanimationRegisterCache.removeVertexTempUsage(nrmVel);\n\t\t\tanimationRegisterCache.removeVertexTempUsage(xAxis);\n\t\t\tanimationRegisterCache.removeVertexTempUsage(R);\n\n\t\t\tcode += \"mov \" + xAxis + \".x,\" + animationRegisterCache.vertexOneConst + \"\\n\";\n\t\t\tcode += \"mov \" + xAxis + \".yz,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\n\t\t\tcode += \"nrm \" + nrmVel + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\n\t\t\tcode += \"dp3 \" + cos2 + \",\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\n\t\t\tcode += \"crs \" + nrmVel + \".xyz,\" + xAxis + \".xyz,\" + nrmVel + \".xyz\\n\";\n\t\t\tcode += \"nrm \" + nrmVel + \".xyz,\" + nrmVel + \".xyz\\n\";\n\t\t\t//use R as temp to judge if nrm is (0,0,0).\n\t\t\t//if nrm is (0,0,0) ,change it to (0,0,1).\n\t\t\tcode += \"dp3 \" + R + \".x,\" + nrmVel + \".xyz,\" + nrmVel + \".xyz\\n\";\n\t\t\tcode += \"sge \" + R + \".x,\" + animationRegisterCache.vertexZeroConst + \",\" + R + \".x\\n\";\n\t\t\tcode += \"add \" + nrmVel + \".z,\" + R + \".x,\" + nrmVel + \".z\\n\";\n\n\t\t\tcode += \"add \" + tempSingle + \",\" + cos2 + \",\" + animationRegisterCache.vertexOneConst + \"\\n\";\n\t\t\tcode += \"div \" + tempSingle + \",\" + tempSingle + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\n\t\t\tcode += \"sqt \" + cos + \",\" + tempSingle + \"\\n\";\n\n\t\t\tcode += \"sub \" + tempSingle + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos2 + \"\\n\";\n\t\t\tcode += \"div \" + tempSingle + \",\" + tempSingle + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\n\t\t\tcode += \"sqt \" + sin + \",\" + tempSingle + \"\\n\";\n\n\t\t\tcode += \"mul \" + R + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\n\n\t\t\t//use cos as R.w\n\n\t\t\tcode += \"mul \" + R_rev + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\n\t\t\tcode += \"neg \" + R_rev + \".xyz,\" + R_rev + \".xyz\\n\";\n\n\t\t\t//use cos as R_rev.w\n\n\t\t\t//nrmVel and xAxis are used as temp register\n\t\t\tcode += \"crs \" + nrmVel + \".xyz,\" + R + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\n\n\t\t\t//use cos as R.w\n\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\n\t\t\tcode += \"add \" + nrmVel + \".xyz,\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\n\t\t\tcode += \"dp3 \" + xAxis + \".w,\" + R + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\n\t\t\tcode += \"neg \" + nrmVel + \".w,\" + xAxis + \".w\\n\";\n\n\t\t\tcode += \"crs \" + R + \".xyz,\" + nrmVel + \".xyz,\" + R_rev + \".xyz\\n\";\n\t\t\t//code += \"mul \" + xAxis + \".xyzw,\" + nrmVel + \".xyzw,\" +R_rev + \".w\\n\";\n\t\t\tcode += \"mul \" + xAxis + \".xyzw,\" + nrmVel + \".xyzw,\" + cos + \"\\n\";\n\t\t\tcode += \"add \" + R + \".xyz,\" + R + \".xyz,\" + xAxis + \".xyz\\n\";\n\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + nrmVel + \".w,\" + R_rev + \".xyz\\n\";\n\n\t\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + R + \".xyz,\" + xAxis + \".xyz\\n\";\n\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t//just repeat the calculate above\n\t\t\t\t//because of the limited registers, no need to optimise\n\t\t\t\tcode += \"mov \" + xAxis + \".x,\" + animationRegisterCache.vertexOneConst + \"\\n\";\n\t\t\t\tcode += \"mov \" + xAxis + \".yz,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\t\tcode += \"nrm \" + nrmVel + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\n\t\t\t\tcode += \"dp3 \" + cos2 + \",\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\n\t\t\t\tcode += \"crs \" + nrmVel + \".xyz,\" + xAxis + \".xyz,\" + nrmVel + \".xyz\\n\";\n\t\t\t\tcode += \"nrm \" + nrmVel + \".xyz,\" + nrmVel + \".xyz\\n\";\n\t\t\t\tcode += \"dp3 \" + R + \".x,\" + nrmVel + \".xyz,\" + nrmVel + \".xyz\\n\";\n\t\t\t\tcode += \"sge \" + R + \".x,\" + animationRegisterCache.vertexZeroConst + \",\" + R + \".x\\n\";\n\t\t\t\tcode += \"add \" + nrmVel + \".z,\" + R + \".x,\" + nrmVel + \".z\\n\";\n\t\t\t\tcode += \"add \" + tempSingle + \",\" + cos2 + \",\" + animationRegisterCache.vertexOneConst + \"\\n\";\n\t\t\t\tcode += \"div \" + tempSingle + \",\" + tempSingle + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\n\t\t\t\tcode += \"sqt \" + cos + \",\" + tempSingle + \"\\n\";\n\t\t\t\tcode += \"sub \" + tempSingle + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos2 + \"\\n\";\n\t\t\t\tcode += \"div \" + tempSingle + \",\" + tempSingle + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\n\t\t\t\tcode += \"sqt \" + sin + \",\" + tempSingle + \"\\n\";\n\t\t\t\tcode += \"mul \" + R + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\n\t\t\t\tcode += \"mul \" + R_rev + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\n\t\t\t\tcode += \"neg \" + R_rev + \".xyz,\" + R_rev + \".xyz\\n\";\n\t\t\t\tcode += \"crs \" + nrmVel + \".xyz,\" + R + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \".xyz\\n\";\n\t\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \".xyz\\n\";\n\t\t\t\tcode += \"add \" + nrmVel + \".xyz,\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\n\t\t\t\tcode += \"dp3 \" + xAxis + \".w,\" + R + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \".xyz\\n\";\n\t\t\t\tcode += \"neg \" + nrmVel + \".w,\" + xAxis + \".w\\n\";\n\t\t\t\tcode += \"crs \" + R + \".xyz,\" + nrmVel + \".xyz,\" + R_rev + \".xyz\\n\";\n\t\t\t\tcode += \"mul \" + xAxis + \".xyzw,\" + nrmVel + \".xyzw,\" + cos + \"\\n\";\n\t\t\t\tcode += \"add \" + R + \".xyz,\" + R + \".xyz,\" + xAxis + \".xyz\\n\";\n\t\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + nrmVel + \".w,\" + R_rev + \".xyz\\n\";\n\t\t\t\tcode += \"add \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + R + \".xyz,\" + xAxis + \".xyz\\n\";\n\t\t\t}\n\n\t\t}\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticleRotateToHeadingState\n\t{\n\t\treturn <ParticleRotateToHeadingState> animator.getAnimationState(this);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\n\t{\n\t\tparticleAnimationSet.needVelocity = true;\n\t}\n}\n\nexport = ParticleRotateToHeadingNode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleRotateToPositionState\t= require(\"awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState\");\n\n/**\n * A particle animation node used to control the rotation of a particle to face to a position\n */\nclass ParticleRotateToPositionNode extends ParticleNodeBase\n{\n\t/** @private */\n\tpublic _iPosition:Vector3D;\n\n\t/**\n\t * Reference for the position the particle will rotate to face for a single particle (when in local property mode).\n\t * Expects a <code>Vector3D</code> object representing the position that the particle must face.\n\t */\n\tpublic static POSITION_VECTOR3D:string = \"RotateToPositionVector3D\";\n\n\t/**\n\t * Creates a new <code>ParticleRotateToPositionNode</code>\n\t */\n\tconstructor(mode:number /*uint*/, position:Vector3D = null)\n\t{\n\t\tsuper(\"ParticleRotateToPosition\", mode, 3, 3);\n\n\t\tthis._pStateClass = ParticleRotateToPositionState;\n\n\t\tthis._iPosition = position || new Vector3D();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar positionAttribute:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleRotateToPositionState.POSITION_INDEX, positionAttribute.index);\n\n\t\tvar code:string = \"\";\n\t\tvar len:number /*int*/ = animationRegisterCache.rotationRegisters.length;\n\t\tvar i:number /*int*/;\n\t\tif (animationRegisterCache.hasBillboard) {\n\t\t\tvar temp1:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp1, 1);\n\t\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp2, 1);\n\t\t\tvar temp3:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\n\t\t\tvar rotationMatrixRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\n\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleRotateToPositionState.MATRIX_INDEX, rotationMatrixRegister.index);\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\n\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp1);\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp2);\n\n\t\t\t//process the position\n\t\t\tcode += \"sub \" + temp1 + \".xyz,\" + positionAttribute + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\n\t\t\tcode += \"m33 \" + temp1 + \".xyz,\" + temp1 + \".xyz,\" + rotationMatrixRegister + \"\\n\";\n\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"mov \" + temp3 + \".xy,\" + temp1 + \".xy\\n\";\n\t\t\tcode += \"nrm \" + temp3 + \".xyz,\" + temp3 + \".xyz\\n\";\n\n\t\t\t//temp3.x=cos,temp3.y=sin\n\t\t\t//only process z axis\n\t\t\tcode += \"mov \" + temp2 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"mov \" + temp2 + \".x,\" + temp3 + \".y\\n\";\n\t\t\tcode += \"mov \" + temp2 + \".y,\" + temp3 + \".x\\n\";\n\t\t\tcode += \"mov \" + temp1 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"mov \" + temp1 + \".x,\" + temp3 + \".x\\n\";\n\t\t\tcode += \"neg \" + temp1 + \".y,\" + temp3 + \".y\\n\";\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"mov \" + temp3 + \".z,\" + animationRegisterCache.vertexOneConst + \"\\n\";\n\t\t\tcode += \"m33 \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp1 + \"\\n\";\n\t\t\tfor (i = 0; i < len; i++)\n\t\t\t\tcode += \"m33 \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \",\" + temp1 + \"\\n\";\n\t\t} else {\n\t\t\tvar nrmDirection:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tanimationRegisterCache.addVertexTempUsages(nrmDirection, 1);\n\n\t\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\n\t\t\tvar cos:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 0);\n\t\t\tvar sin:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 1);\n\t\t\tvar o_temp:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 2);\n\t\t\tvar tempSingle:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 3);\n\n\t\t\tvar R:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tanimationRegisterCache.addVertexTempUsages(R, 1);\n\n\t\t\tanimationRegisterCache.removeVertexTempUsage(nrmDirection);\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp);\n\t\t\tanimationRegisterCache.removeVertexTempUsage(R);\n\n\t\t\tcode += \"sub \" + nrmDirection + \".xyz,\" + positionAttribute + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\n\t\t\tcode += \"nrm \" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\n\n\t\t\tcode += \"mov \" + sin + \",\" + nrmDirection + \".y\\n\";\n\t\t\tcode += \"mul \" + cos + \",\" + sin + \",\" + sin + \"\\n\";\n\t\t\tcode += \"sub \" + cos + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos + \"\\n\";\n\t\t\tcode += \"sqt \" + cos + \",\" + cos + \"\\n\";\n\n\t\t\tcode += \"mul \" + R + \".x,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".y\\n\";\n\t\t\tcode += \"mul \" + R + \".y,\" + sin + \",\" + animationRegisterCache.scaleAndRotateTarget + \".z\\n\";\n\t\t\tcode += \"mul \" + R + \".z,\" + sin + \",\" + animationRegisterCache.scaleAndRotateTarget + \".y\\n\";\n\t\t\tcode += \"mul \" + R + \".w,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".z\\n\";\n\n\t\t\tcode += \"sub \" + animationRegisterCache.scaleAndRotateTarget + \".y,\" + R + \".x,\" + R + \".y\\n\";\n\t\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".z,\" + R + \".z,\" + R + \".w\\n\";\n\n\t\t\tcode += \"abs \" + R + \".y,\" + nrmDirection + \".y\\n\";\n\t\t\tcode += \"sge \" + R + \".z,\" + R + \".y,\" + animationRegisterCache.vertexOneConst + \"\\n\";\n\t\t\tcode += \"mul \" + R + \".x,\" + R + \".y,\" + nrmDirection + \".y\\n\";\n\n\t\t\t//judgu if nrmDirection=(0,1,0);\n\t\t\tcode += \"mov \" + nrmDirection + \".y,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"dp3 \" + sin + \",\" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\n\t\t\tcode += \"sge \" + tempSingle + \",\" + animationRegisterCache.vertexZeroConst + \",\" + sin + \"\\n\";\n\n\t\t\tcode += \"mov \" + nrmDirection + \".y,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"nrm \" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\n\n\t\t\tcode += \"sub \" + sin + \",\" + animationRegisterCache.vertexOneConst + \",\" + tempSingle + \"\\n\";\n\t\t\tcode += \"mul \" + sin + \",\" + sin + \",\" + nrmDirection + \".x\\n\";\n\n\t\t\tcode += \"mov \" + cos + \",\" + nrmDirection + \".z\\n\";\n\t\t\tcode += \"neg \" + cos + \",\" + cos + \"\\n\";\n\t\t\tcode += \"sub \" + o_temp + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos + \"\\n\";\n\t\t\tcode += \"mul \" + o_temp + \",\" + R + \".x,\" + tempSingle + \"\\n\";\n\t\t\tcode += \"add \" + cos + \",\" + cos + \",\" + o_temp + \"\\n\";\n\n\t\t\tcode += \"mul \" + R + \".x,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".x\\n\";\n\t\t\tcode += \"mul \" + R + \".y,\" + sin + \",\" + animationRegisterCache.scaleAndRotateTarget + \".z\\n\";\n\t\t\tcode += \"mul \" + R + \".z,\" + sin + \",\" + animationRegisterCache.scaleAndRotateTarget + \".x\\n\";\n\t\t\tcode += \"mul \" + R + \".w,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".z\\n\";\n\n\t\t\tcode += \"sub \" + animationRegisterCache.scaleAndRotateTarget + \".x,\" + R + \".x,\" + R + \".y\\n\";\n\t\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".z,\" + R + \".z,\" + R + \".w\\n\";\n\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t//just repeat the calculate above\n\t\t\t\t//because of the limited registers, no need to optimise\n\t\t\t\tcode += \"sub \" + nrmDirection + \".xyz,\" + positionAttribute + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\n\t\t\t\tcode += \"nrm \" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\n\t\t\t\tcode += \"mov \" + sin + \",\" + nrmDirection + \".y\\n\";\n\t\t\t\tcode += \"mul \" + cos + \",\" + sin + \",\" + sin + \"\\n\";\n\t\t\t\tcode += \"sub \" + cos + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos + \"\\n\";\n\t\t\t\tcode += \"sqt \" + cos + \",\" + cos + \"\\n\";\n\t\t\t\tcode += \"mul \" + R + \".x,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \".y\\n\";\n\t\t\t\tcode += \"mul \" + R + \".y,\" + sin + \",\" + animationRegisterCache.rotationRegisters[i] + \".z\\n\";\n\t\t\t\tcode += \"mul \" + R + \".z,\" + sin + \",\" + animationRegisterCache.rotationRegisters[i] + \".y\\n\";\n\t\t\t\tcode += \"mul \" + R + \".w,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \".z\\n\";\n\t\t\t\tcode += \"sub \" + animationRegisterCache.rotationRegisters[i] + \".y,\" + R + \".x,\" + R + \".y\\n\";\n\t\t\t\tcode += \"add \" + animationRegisterCache.rotationRegisters[i] + \".z,\" + R + \".z,\" + R + \".w\\n\";\n\t\t\t\tcode += \"abs \" + R + \".y,\" + nrmDirection + \".y\\n\";\n\t\t\t\tcode += \"sge \" + R + \".z,\" + R + \".y,\" + animationRegisterCache.vertexOneConst + \"\\n\";\n\t\t\t\tcode += \"mul \" + R + \".x,\" + R + \".y,\" + nrmDirection + \".y\\n\";\n\t\t\t\tcode += \"mov \" + nrmDirection + \".y,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\t\tcode += \"dp3 \" + sin + \",\" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\n\t\t\t\tcode += \"sge \" + tempSingle + \",\" + animationRegisterCache.vertexZeroConst + \",\" + sin + \"\\n\";\n\t\t\t\tcode += \"mov \" + nrmDirection + \".y,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\t\tcode += \"nrm \" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\n\t\t\t\tcode += \"sub \" + sin + \",\" + animationRegisterCache.vertexOneConst + \",\" + tempSingle + \"\\n\";\n\t\t\t\tcode += \"mul \" + sin + \",\" + sin + \",\" + nrmDirection + \".x\\n\";\n\t\t\t\tcode += \"mov \" + cos + \",\" + nrmDirection + \".z\\n\";\n\t\t\t\tcode += \"neg \" + cos + \",\" + cos + \"\\n\";\n\t\t\t\tcode += \"sub \" + o_temp + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos + \"\\n\";\n\t\t\t\tcode += \"mul \" + o_temp + \",\" + R + \".x,\" + tempSingle + \"\\n\";\n\t\t\t\tcode += \"add \" + cos + \",\" + cos + \",\" + o_temp + \"\\n\";\n\t\t\t\tcode += \"mul \" + R + \".x,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \".x\\n\";\n\t\t\t\tcode += \"mul \" + R + \".y,\" + sin + \",\" + animationRegisterCache.rotationRegisters[i] + \".z\\n\";\n\t\t\t\tcode += \"mul \" + R + \".z,\" + sin + \",\" + animationRegisterCache.rotationRegisters[i] + \".x\\n\";\n\t\t\t\tcode += \"mul \" + R + \".w,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \".z\\n\";\n\t\t\t\tcode += \"sub \" + animationRegisterCache.rotationRegisters[i] + \".x,\" + R + \".x,\" + R + \".y\\n\";\n\t\t\t\tcode += \"add \" + animationRegisterCache.rotationRegisters[i] + \".z,\" + R + \".z,\" + R + \".w\\n\";\n\t\t\t}\n\t\t}\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticleRotateToPositionState\n\t{\n\t\treturn <ParticleRotateToPositionState> animator.getAnimationState(this);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\n\t{\n\t\tvar offset:Vector3D = param[ParticleRotateToPositionNode.POSITION_VECTOR3D];\n\t\tif (!offset)\n\t\t\tthrow(new Error(\"there is no \" + ParticleRotateToPositionNode.POSITION_VECTOR3D + \" in param!\"));\n\n\t\tthis._pOneData[0] = offset.x;\n\t\tthis._pOneData[1] = offset.y;\n\t\tthis._pOneData[2] = offset.z;\n\t}\n}\n\nexport = ParticleRotateToPositionNode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleRotationalVelocityState\t= require(\"awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState\");\n\n/**\n * A particle animation node used to set the starting rotational velocity of a particle.\n */\nclass ParticleRotationalVelocityNode extends ParticleNodeBase\n{\n\t/** @private */\n\tpublic _iRotationalVelocity:Vector3D;\n\n\t/**\n\t * Reference for rotational velocity node properties on a single particle (when in local property mode).\n\t * Expects a <code>Vector3D</code> object representing the rotational velocity around an axis of the particle.\n\t */\n\tpublic static ROTATIONALVELOCITY_VECTOR3D:string = \"RotationalVelocityVector3D\";\n\n\t/**\n\t * Creates a new <code>ParticleRotationalVelocityNode</code>\n\t *\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\n\t */\n\tconstructor(mode:number /*uint*/, rotationalVelocity:Vector3D = null)\n\t{\n\t\tsuper(\"ParticleRotationalVelocity\", mode, 4);\n\n\t\tthis._pStateClass = ParticleRotationalVelocityState;\n\n\t\tthis._iRotationalVelocity = rotationalVelocity || new Vector3D();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar rotationRegister:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleRotationalVelocityState.ROTATIONALVELOCITY_INDEX, rotationRegister.index);\n\n\t\tvar nrmVel:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\tanimationRegisterCache.addVertexTempUsages(nrmVel, 1);\n\n\t\tvar xAxis:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\tanimationRegisterCache.addVertexTempUsages(xAxis, 1);\n\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\n\t\tvar Rtemp:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index);\n\t\tvar R_rev:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\tR_rev = new ShaderRegisterElement(R_rev.regName, R_rev.index);\n\n\t\tvar cos:ShaderRegisterElement = new ShaderRegisterElement(Rtemp.regName, Rtemp.index, 3);\n\t\tvar sin:ShaderRegisterElement = new ShaderRegisterElement(R_rev.regName, R_rev.index, 3);\n\n\t\tanimationRegisterCache.removeVertexTempUsage(nrmVel);\n\t\tanimationRegisterCache.removeVertexTempUsage(xAxis);\n\t\tanimationRegisterCache.removeVertexTempUsage(temp);\n\n\t\tvar code:string = \"\";\n\t\tcode += \"mov \" + nrmVel + \".xyz,\" + rotationRegister + \".xyz\\n\";\n\t\tcode += \"mov \" + nrmVel + \".w,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\n\t\tcode += \"mul \" + cos + \",\" + animationRegisterCache.vertexTime + \",\" + rotationRegister + \".w\\n\";\n\n\t\tcode += \"sin \" + sin + \",\" + cos + \"\\n\";\n\t\tcode += \"cos \" + cos + \",\" + cos + \"\\n\";\n\n\t\tcode += \"mul \" + Rtemp + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\n\n\t\tcode += \"mul \" + R_rev + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\n\t\tcode += \"neg \" + R_rev + \".xyz,\" + R_rev + \".xyz\\n\";\n\n\t\t//nrmVel and xAxis are used as temp register\n\t\tcode += \"crs \" + nrmVel + \".xyz,\" + Rtemp + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\n\n\t\tcode += \"mul \" + xAxis + \".xyz,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\n\t\tcode += \"add \" + nrmVel + \".xyz,\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\n\t\tcode += \"dp3 \" + xAxis + \".w,\" + Rtemp + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\n\t\tcode += \"neg \" + nrmVel + \".w,\" + xAxis + \".w\\n\";\n\n\t\tcode += \"crs \" + Rtemp + \".xyz,\" + nrmVel + \".xyz,\" + R_rev + \".xyz\\n\";\n\n\t\t//use cos as R_rev.w\n\t\tcode += \"mul \" + xAxis + \".xyzw,\" + nrmVel + \".xyzw,\" + cos + \"\\n\";\n\t\tcode += \"add \" + Rtemp + \".xyz,\" + Rtemp + \".xyz,\" + xAxis + \".xyz\\n\";\n\t\tcode += \"mul \" + xAxis + \".xyz,\" + nrmVel + \".w,\" + R_rev + \".xyz\\n\";\n\n\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + Rtemp + \".xyz,\" + xAxis + \".xyz\\n\";\n\n\t\tvar len:number /*int*/ = animationRegisterCache.rotationRegisters.length;\n\t\tfor (var i:number /*int*/ = 0; i < len; i++) {\n\t\t\tcode += \"mov \" + nrmVel + \".xyz,\" + rotationRegister + \".xyz\\n\";\n\t\t\tcode += \"mov \" + nrmVel + \".w,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\tcode += \"mul \" + cos + \",\" + animationRegisterCache.vertexTime + \",\" + rotationRegister + \".w\\n\";\n\t\t\tcode += \"sin \" + sin + \",\" + cos + \"\\n\";\n\t\t\tcode += \"cos \" + cos + \",\" + cos + \"\\n\";\n\t\t\tcode += \"mul \" + Rtemp + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\n\t\t\tcode += \"mul \" + R_rev + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\n\t\t\tcode += \"neg \" + R_rev + \".xyz,\" + R_rev + \".xyz\\n\";\n\t\t\tcode += \"crs \" + nrmVel + \".xyz,\" + Rtemp + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \".xyz\\n\";\n\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \"\\n\";\n\t\t\tcode += \"add \" + nrmVel + \".xyz,\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\n\t\t\tcode += \"dp3 \" + xAxis + \".w,\" + Rtemp + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \"\\n\";\n\t\t\tcode += \"neg \" + nrmVel + \".w,\" + xAxis + \".w\\n\";\n\t\t\tcode += \"crs \" + Rtemp + \".xyz,\" + nrmVel + \".xyz,\" + R_rev + \".xyz\\n\";\n\t\t\tcode += \"mul \" + xAxis + \".xyzw,\" + nrmVel + \".xyzw,\" + cos + \"\\n\";\n\t\t\tcode += \"add \" + Rtemp + \".xyz,\" + Rtemp + \".xyz,\" + xAxis + \".xyz\\n\";\n\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + nrmVel + \".w,\" + R_rev + \".xyz\\n\";\n\t\t\tcode += \"add \" + animationRegisterCache.rotationRegisters[i] + \",\" + Rtemp + \".xyz,\" + xAxis + \".xyz\\n\";\n\t\t}\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticleRotationalVelocityState\n\t{\n\t\treturn <ParticleRotationalVelocityState> animator.getAnimationState(this);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\n\t{\n\t\t//(Vector3d.x,Vector3d.y,Vector3d.z) is rotation axis,Vector3d.w is cycle duration\n\t\tvar rotate:Vector3D = param[ParticleRotationalVelocityNode.ROTATIONALVELOCITY_VECTOR3D];\n\t\tif (!rotate)\n\t\t\tthrow(new Error(\"there is no \" + ParticleRotationalVelocityNode.ROTATIONALVELOCITY_VECTOR3D + \" in param!\"));\n\n\t\tif (rotate.length <= 0)\n\t\t\trotate.z = 1; //set the default direction\n\t\telse\n\t\t\trotate.normalize();\n\n\t\tthis._pOneData[0] = rotate.x;\n\t\tthis._pOneData[1] = rotate.y;\n\t\tthis._pOneData[2] = rotate.z;\n\t\tif (rotate.w <= 0)\n\t\t\tthrow(new Error(\"the cycle duration must greater than zero\"));\n\t\t// it's used as angle/2 in agal\n\t\tthis._pOneData[3] = Math.PI/rotate.w;\n\t}\n}\n\nexport = ParticleRotationalVelocityNode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleScaleState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleScaleState\");\n\n/**\n * A particle animation node used to control the scale variation of a particle over time.\n */\nclass ParticleScaleNode extends ParticleNodeBase\n{\n\t/** @private */\n\tpublic _iUsesCycle:boolean;\n\n\t/** @private */\n\tpublic _iUsesPhase:boolean;\n\n\t/** @private */\n\tpublic _iMinScale:number;\n\t/** @private */\n\tpublic _iMaxScale:number;\n\t/** @private */\n\tpublic _iCycleDuration:number;\n\t/** @private */\n\tpublic _iCyclePhase:number;\n\n\t/**\n\t * Reference for scale node properties on a single particle (when in local property mode).\n\t * Expects a <code>Vector3D</code> representing the min scale (x), max scale(y), optional cycle speed (z) and phase offset (w) applied to the particle.\n\t */\n\tpublic static SCALE_VECTOR3D:string = \"ScaleVector3D\";\n\n\t/**\n\t * Creates a new <code>ParticleScaleNode</code>\n\t *\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\n\t * @param    [optional] usesCycle       Defines whether the node uses the <code>cycleDuration</code> property in the shader to calculate the period of animation independent of particle duration. Defaults to false.\n\t * @param    [optional] usesPhase       Defines whether the node uses the <code>cyclePhase</code> property in the shader to calculate a starting offset to the animation cycle. Defaults to false.\n\t * @param    [optional] minScale        Defines the default min scale transform of the node, when in global mode. Defaults to 1.\n\t * @param    [optional] maxScale        Defines the default max color transform of the node, when in global mode. Defaults to 1.\n\t * @param    [optional] cycleDuration   Defines the default duration of the animation in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\n\t * @param    [optional] cyclePhase      Defines the default phase of the cycle in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\n\t */\n\tconstructor(mode:number /*uint*/, usesCycle:boolean, usesPhase:boolean, minScale:number = 1, maxScale:number = 1, cycleDuration:number = 1, cyclePhase:number = 0)\n\t{\n\t\tsuper(\"ParticleScale\", mode, (usesCycle && usesPhase)? 4 : ((usesCycle || usesPhase)? 3 : 2), 3);\n\n\t\tthis._pStateClass = ParticleScaleState;\n\n\t\tthis._iUsesCycle = usesCycle;\n\t\tthis._iUsesPhase = usesPhase;\n\n\t\tthis._iMinScale = minScale;\n\t\tthis._iMaxScale = maxScale;\n\t\tthis._iCycleDuration = cycleDuration;\n\t\tthis._iCyclePhase = cyclePhase;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\n\n\t\tvar scaleRegister:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleScaleState.SCALE_INDEX, scaleRegister.index);\n\n\t\tif (this._iUsesCycle) {\n\t\t\tcode += \"mul \" + temp + \",\" + animationRegisterCache.vertexTime + \",\" + scaleRegister + \".z\\n\";\n\n\t\t\tif (this._iUsesPhase)\n\t\t\t\tcode += \"add \" + temp + \",\" + temp + \",\" + scaleRegister + \".w\\n\";\n\n\t\t\tcode += \"sin \" + temp + \",\" + temp + \"\\n\";\n\t\t}\n\n\t\tcode += \"mul \" + temp + \",\" + scaleRegister + \".y,\" + ((this._iUsesCycle)? temp : animationRegisterCache.vertexLife) + \"\\n\";\n\t\tcode += \"add \" + temp + \",\" + scaleRegister + \".x,\" + temp + \"\\n\";\n\t\tcode += \"mul \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp + \"\\n\";\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticleScaleState\n\t{\n\t\treturn <ParticleScaleState> animator.getAnimationState(this);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\n\t{\n\t\tvar scale:Vector3D = param[ParticleScaleNode.SCALE_VECTOR3D];\n\t\tif (!scale)\n\t\t\tthrow(new Error(\"there is no \" + ParticleScaleNode.SCALE_VECTOR3D + \" in param!\"));\n\n\t\tif (this._iUsesCycle) {\n\t\t\tthis._pOneData[0] = (scale.x + scale.y)/2;\n\t\t\tthis._pOneData[1] = Math.abs(scale.x - scale.y)/2;\n\t\t\tif (scale.z <= 0)\n\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\n\t\t\tthis._pOneData[2] = Math.PI*2/scale.z;\n\t\t\tif (this._iUsesPhase)\n\t\t\t\tthis._pOneData[3] = scale.w*Math.PI/180;\n\t\t} else {\n\t\t\tthis._pOneData[0] = scale.x;\n\t\t\tthis._pOneData[1] = scale.y - scale.x;\n\t\t}\n\t}\n}\n\nexport = ParticleScaleNode;","import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\nimport ColorSegmentPoint\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ColorSegmentPoint\");\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleSegmentedColorState\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState\");\n\n/**\n *\n */\nclass ParticleSegmentedColorNode extends ParticleNodeBase\n{\n\t/** @private */\n\tpublic _iUsesMultiplier:boolean;\n\t/** @private */\n\tpublic _iUsesOffset:boolean;\n\t/** @private */\n\tpublic _iStartColor:ColorTransform;\n\t/** @private */\n\tpublic _iEndColor:ColorTransform;\n\t/** @private */\n\tpublic _iNumSegmentPoint:number /*int*/;\n\t/** @private */\n\tpublic _iSegmentPoints:Array<ColorSegmentPoint>;\n\n\tconstructor(usesMultiplier:boolean, usesOffset:boolean, numSegmentPoint:number /*int*/, startColor:ColorTransform, endColor:ColorTransform, segmentPoints:Array<ColorSegmentPoint>)\n\t{\n\t\t//because of the stage3d register limitation, it only support the global mode\n\t\tsuper(\"ParticleSegmentedColor\", ParticlePropertiesMode.GLOBAL, 0, ParticleAnimationSet.COLOR_PRIORITY);\n\n\t\tthis._pStateClass = ParticleSegmentedColorState;\n\n\t\tif (numSegmentPoint > 4)\n\t\t\tthrow(new Error(\"the numSegmentPoint must be less or equal 4\"));\n\t\tthis._iUsesMultiplier = usesMultiplier;\n\t\tthis._iUsesOffset = usesOffset;\n\t\tthis._iNumSegmentPoint = numSegmentPoint;\n\t\tthis._iStartColor = startColor;\n\t\tthis._iEndColor = endColor;\n\t\tthis._iSegmentPoints = segmentPoints;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\n\t{\n\t\tif (this._iUsesMultiplier)\n\t\t\tparticleAnimationSet.hasColorMulNode = true;\n\t\tif (this._iUsesOffset)\n\t\t\tparticleAnimationSet.hasColorAddNode = true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar code:string = \"\";\n\t\tif (animationRegisterCache.needFragmentAnimation) {\n\t\t\tvar accMultiplierColor:ShaderRegisterElement;\n\t\t\t//var accOffsetColor:ShaderRegisterElement;\n\t\t\tif (this._iUsesMultiplier) {\n\t\t\t\taccMultiplierColor = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\t\tanimationRegisterCache.addVertexTempUsages(accMultiplierColor, 1);\n\t\t\t}\n\n\t\t\tvar tempColor:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tanimationRegisterCache.addVertexTempUsages(tempColor, 1);\n\n\t\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\t\tvar accTime:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 0);\n\t\t\tvar tempTime:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 1);\n\n\t\t\tif (this._iUsesMultiplier)\n\t\t\t\tanimationRegisterCache.removeVertexTempUsage(accMultiplierColor);\n\n\t\t\tanimationRegisterCache.removeVertexTempUsage(tempColor);\n\n\t\t\t//for saving all the life values (at most 4)\n\t\t\tvar lifeTimeRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\n\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleSegmentedColorState.TIME_DATA_INDEX, lifeTimeRegister.index);\n\n\t\t\tvar i:number /*int*/;\n\n\t\t\tvar startMulValue:ShaderRegisterElement;\n\t\t\tvar deltaMulValues:Array<ShaderRegisterElement>;\n\t\t\tif (this._iUsesMultiplier) {\n\t\t\t\tstartMulValue = animationRegisterCache.getFreeVertexConstant();\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleSegmentedColorState.START_MULTIPLIER_INDEX, startMulValue.index);\n\t\t\t\tdeltaMulValues = new Array<ShaderRegisterElement>();\n\t\t\t\tfor (i = 0; i < this._iNumSegmentPoint + 1; i++)\n\t\t\t\t\tdeltaMulValues.push(animationRegisterCache.getFreeVertexConstant());\n\t\t\t}\n\n\t\t\tvar startOffsetValue:ShaderRegisterElement;\n\t\t\tvar deltaOffsetValues:Array<ShaderRegisterElement>;\n\t\t\tif (this._iUsesOffset) {\n\t\t\t\tstartOffsetValue = animationRegisterCache.getFreeVertexConstant();\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleSegmentedColorState.START_OFFSET_INDEX, startOffsetValue.index);\n\t\t\t\tdeltaOffsetValues = new Array<ShaderRegisterElement>();\n\t\t\t\tfor (i = 0; i < this._iNumSegmentPoint + 1; i++)\n\t\t\t\t\tdeltaOffsetValues.push(animationRegisterCache.getFreeVertexConstant());\n\t\t\t}\n\n\t\t\tif (this._iUsesMultiplier)\n\t\t\t\tcode += \"mov \" + accMultiplierColor + \",\" + startMulValue + \"\\n\";\n\t\t\tif (this._iUsesOffset)\n\t\t\t\tcode += \"add \" + animationRegisterCache.colorAddTarget + \",\" + animationRegisterCache.colorAddTarget + \",\" + startOffsetValue + \"\\n\";\n\n\t\t\tfor (i = 0; i < this._iNumSegmentPoint; i++) {\n\t\t\t\tswitch (i) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tcode += \"min \" + tempTime + \",\" + animationRegisterCache.vertexLife + \",\" + lifeTimeRegister + \".x\\n\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + animationRegisterCache.vertexLife + \",\" + lifeTimeRegister + \".x\\n\";\n\t\t\t\t\t\tcode += \"max \" + tempTime + \",\" + accTime + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\t\t\t\tcode += \"min \" + tempTime + \",\" + tempTime + \",\" + lifeTimeRegister + \".y\\n\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + accTime + \",\" + lifeTimeRegister + \".y\\n\";\n\t\t\t\t\t\tcode += \"max \" + tempTime + \",\" + accTime + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\t\t\t\tcode += \"min \" + tempTime + \",\" + tempTime + \",\" + lifeTimeRegister + \".z\\n\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + accTime + \",\" + lifeTimeRegister + \".z\\n\";\n\t\t\t\t\t\tcode += \"max \" + tempTime + \",\" + accTime + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\t\t\t\tcode += \"min \" + tempTime + \",\" + tempTime + \",\" + lifeTimeRegister + \".w\\n\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (this._iUsesMultiplier) {\n\t\t\t\t\tcode += \"mul \" + tempColor + \",\" + tempTime + \",\" + deltaMulValues[i] + \"\\n\";\n\t\t\t\t\tcode += \"add \" + accMultiplierColor + \",\" + accMultiplierColor + \",\" + tempColor + \"\\n\";\n\t\t\t\t}\n\t\t\t\tif (this._iUsesOffset) {\n\t\t\t\t\tcode += \"mul \" + tempColor + \",\" + tempTime + \",\" + deltaOffsetValues[i] + \"\\n\";\n\t\t\t\t\tcode += \"add \" + animationRegisterCache.colorAddTarget + \",\" + animationRegisterCache.colorAddTarget + \",\" + tempColor + \"\\n\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//for the last segment:\n\t\t\tif (this._iNumSegmentPoint == 0)\n\t\t\t\ttempTime = animationRegisterCache.vertexLife;\n\t\t\telse {\n\t\t\t\tswitch (this._iNumSegmentPoint) {\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + animationRegisterCache.vertexLife + \",\" + lifeTimeRegister + \".x\\n\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + accTime + \",\" + lifeTimeRegister + \".y\\n\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + accTime + \",\" + lifeTimeRegister + \".z\\n\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 4:\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + accTime + \",\" + lifeTimeRegister + \".w\\n\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcode += \"max \" + tempTime + \",\" + accTime + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\t\t}\n\t\t\tif (this._iUsesMultiplier) {\n\t\t\t\tcode += \"mul \" + tempColor + \",\" + tempTime + \",\" + deltaMulValues[this._iNumSegmentPoint] + \"\\n\";\n\t\t\t\tcode += \"add \" + accMultiplierColor + \",\" + accMultiplierColor + \",\" + tempColor + \"\\n\";\n\t\t\t\tcode += \"mul \" + animationRegisterCache.colorMulTarget + \",\" + animationRegisterCache.colorMulTarget + \",\" + accMultiplierColor + \"\\n\";\n\t\t\t}\n\t\t\tif (this._iUsesOffset) {\n\t\t\t\tcode += \"mul \" + tempColor + \",\" + tempTime + \",\" + deltaOffsetValues[this._iNumSegmentPoint] + \"\\n\";\n\t\t\t\tcode += \"add \" + animationRegisterCache.colorAddTarget + \",\" + animationRegisterCache.colorAddTarget + \",\" + tempColor + \"\\n\";\n\t\t\t}\n\n\t\t}\n\t\treturn code;\n\t}\n\n}\n\nexport = ParticleSegmentedColorNode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleSpriteSheetState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState\");\n\n/**\n * A particle animation node used when a spritesheet texture is required to animate the particle.\n * NB: to enable use of this node, the <code>repeat</code> property on the material has to be set to true.\n */\nclass ParticleSpriteSheetNode extends ParticleNodeBase\n{\n\t/** @private */\n\tpublic _iUsesCycle:boolean;\n\n\t/** @private */\n\tpublic _iUsesPhase:boolean;\n\n\t/** @private */\n\tpublic _iTotalFrames:number /*int*/;\n\t/** @private */\n\tpublic _iNumColumns:number /*int*/;\n\t/** @private */\n\tpublic _iNumRows:number /*int*/;\n\t/** @private */\n\tpublic _iCycleDuration:number;\n\t/** @private */\n\tpublic _iCyclePhase:number;\n\n\t/**\n\t * Reference for spritesheet node properties on a single particle (when in local property mode).\n\t * Expects a <code>Vector3D</code> representing the cycleDuration (x), optional phaseTime (y).\n\t */\n\tpublic static UV_VECTOR3D:string = \"UVVector3D\";\n\n\t/**\n\t * Defines the number of columns in the spritesheet, when in global mode. Defaults to 1. Read only.\n\t */\n\tpublic get numColumns():number\n\t{\n\t\treturn this._iNumColumns;\n\t}\n\n\t/**\n\t * Defines the number of rows in the spritesheet, when in global mode. Defaults to 1. Read only.\n\t */\n\tpublic get numRows():number\n\t{\n\t\treturn this._iNumRows;\n\t}\n\n\t/**\n\t * Defines the total number of frames used by the spritesheet, when in global mode. Defaults to the number defined by numColumns and numRows. Read only.\n\t */\n\tpublic get totalFrames():number\n\t{\n\t\treturn this._iTotalFrames;\n\t}\n\n\t/**\n\t * Creates a new <code>ParticleSpriteSheetNode</code>\n\t *\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\n\t * @param    [optional] numColumns      Defines the number of columns in the spritesheet, when in global mode. Defaults to 1.\n\t * @param    [optional] numRows         Defines the number of rows in the spritesheet, when in global mode. Defaults to 1.\n\t * @param    [optional] cycleDuration   Defines the default cycle duration in seconds, when in global mode. Defaults to 1.\n\t * @param    [optional] cyclePhase      Defines the default cycle phase, when in global mode. Defaults to 0.\n\t * @param    [optional] totalFrames     Defines the total number of frames used by the spritesheet, when in global mode. Defaults to the number defined by numColumns and numRows.\n\t * @param    [optional] looping         Defines whether the spritesheet animation is set to loop indefinitely. Defaults to true.\n\t */\n\tconstructor(mode:number /*uint*/, usesCycle:boolean, usesPhase:boolean, numColumns:number /*int*/ = 1, numRows:number /*uint*/ = 1, cycleDuration:number = 1, cyclePhase:number = 0, totalFrames:number /*uint*/ = Number.MAX_VALUE)\n\t{\n\t\tsuper(\"ParticleSpriteSheet\", mode, usesCycle? (usesPhase? 3 : 2) : 1, ParticleAnimationSet.POST_PRIORITY + 1);\n\n\t\tthis._pStateClass = ParticleSpriteSheetState;\n\n\t\tthis._iUsesCycle = usesCycle;\n\t\tthis._iUsesPhase = usesPhase;\n\n\t\tthis._iNumColumns = numColumns;\n\t\tthis._iNumRows = numRows;\n\t\tthis._iCyclePhase = cyclePhase;\n\t\tthis._iCycleDuration = cycleDuration;\n\t\tthis._iTotalFrames = Math.min(totalFrames, numColumns*numRows);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALUVCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\t//get 2 vc\n\t\tvar uvParamConst1:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\n\t\tvar uvParamConst2:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleSpriteSheetState.UV_INDEX_0, uvParamConst1.index);\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleSpriteSheetState.UV_INDEX_1, uvParamConst2.index);\n\n\t\tvar uTotal:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst1.regName, uvParamConst1.index, 0);\n\t\tvar uStep:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst1.regName, uvParamConst1.index, 1);\n\t\tvar vStep:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst1.regName, uvParamConst1.index, 2);\n\n\t\tvar uSpeed:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst2.regName, uvParamConst2.index, 0);\n\t\tvar cycle:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst2.regName, uvParamConst2.index, 1);\n\t\tvar phaseTime:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst2.regName, uvParamConst2.index, 2);\n\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\tvar time:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 0);\n\t\tvar vOffset:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 1);\n\t\ttemp = new ShaderRegisterElement(temp.regName, temp.index, 2);\n\t\tvar temp2:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 3);\n\n\t\tvar u:ShaderRegisterElement = new ShaderRegisterElement(animationRegisterCache.uvTarget.regName, animationRegisterCache.uvTarget.index, 0);\n\t\tvar v:ShaderRegisterElement = new ShaderRegisterElement(animationRegisterCache.uvTarget.regName, animationRegisterCache.uvTarget.index, 1);\n\n\t\tvar code:string = \"\";\n\t\t//scale uv\n\t\tcode += \"mul \" + u + \",\" + u + \",\" + uStep + \"\\n\";\n\t\tif (this._iNumRows > 1)\n\t\t\tcode += \"mul \" + v + \",\" + v + \",\" + vStep + \"\\n\";\n\n\t\tif (this._iUsesCycle) {\n\t\t\tif (this._iUsesPhase)\n\t\t\t\tcode += \"add \" + time + \",\" + animationRegisterCache.vertexTime + \",\" + phaseTime + \"\\n\";\n\t\t\telse\n\t\t\t\tcode += \"mov \" + time + \",\" + animationRegisterCache.vertexTime + \"\\n\";\n\t\t\tcode += \"div \" + time + \",\" + time + \",\" + cycle + \"\\n\";\n\t\t\tcode += \"frc \" + time + \",\" + time + \"\\n\";\n\t\t\tcode += \"mul \" + time + \",\" + time + \",\" + cycle + \"\\n\";\n\t\t\tcode += \"mul \" + temp + \",\" + time + \",\" + uSpeed + \"\\n\";\n\t\t} else\n\t\t\tcode += \"mul \" + temp.toString() + \",\" + animationRegisterCache.vertexLife + \",\" + uTotal + \"\\n\";\n\n\t\tif (this._iNumRows > 1) {\n\t\t\tcode += \"frc \" + temp2 + \",\" + temp + \"\\n\";\n\t\t\tcode += \"sub \" + vOffset + \",\" + temp + \",\" + temp2 + \"\\n\";\n\t\t\tcode += \"mul \" + vOffset + \",\" + vOffset + \",\" + vStep + \"\\n\";\n\t\t\tcode += \"add \" + v + \",\" + v + \",\" + vOffset + \"\\n\";\n\t\t}\n\n\t\tcode += \"div \" + temp2 + \",\" + temp + \",\" + uStep + \"\\n\";\n\t\tcode += \"frc \" + temp + \",\" + temp2 + \"\\n\";\n\t\tcode += \"sub \" + temp2 + \",\" + temp2 + \",\" + temp + \"\\n\";\n\t\tcode += \"mul \" + temp + \",\" + temp2 + \",\" + uStep + \"\\n\";\n\n\t\tif (this._iNumRows > 1)\n\t\t\tcode += \"frc \" + temp + \",\" + temp + \"\\n\";\n\t\tcode += \"add \" + u + \",\" + u + \",\" + temp + \"\\n\";\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticleSpriteSheetState\n\t{\n\t\treturn <ParticleSpriteSheetState> animator.getAnimationState(this);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\n\t{\n\t\tparticleAnimationSet.hasUVNode = true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\n\t{\n\t\tif (this._iUsesCycle) {\n\t\t\tvar uvCycle:Vector3D = param[ParticleSpriteSheetNode.UV_VECTOR3D];\n\t\t\tif (!uvCycle)\n\t\t\t\tthrow(new Error(\"there is no \" + ParticleSpriteSheetNode.UV_VECTOR3D + \" in param!\"));\n\t\t\tif (uvCycle.x <= 0)\n\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\n\t\t\tvar uTotal:number = this._iTotalFrames/this._iNumColumns;\n\t\t\tthis._pOneData[0] = uTotal/uvCycle.x;\n\t\t\tthis._pOneData[1] = uvCycle.x;\n\t\t\tif (this._iUsesPhase)\n\t\t\t\tthis._pOneData[2] = uvCycle.y;\n\t\t}\n\t}\n}\n\nexport = ParticleSpriteSheetNode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleTimeState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleTimeState\");\n\n/**\n * A particle animation node used as the base node for timekeeping inside a particle. Automatically added to a particle animation set on instatiation.\n */\nclass ParticleTimeNode extends ParticleNodeBase\n{\n\t/** @private */\n\tpublic _iUsesDuration:boolean;\n\t/** @private */\n\tpublic _iUsesDelay:boolean;\n\t/** @private */\n\tpublic _iUsesLooping:boolean;\n\n\t/**\n\t * Creates a new <code>ParticleTimeNode</code>\n\t *\n\t * @param    [optional] usesDuration    Defines whether the node uses the <code>duration</code> data in the static properties to determine how long a particle is visible for. Defaults to false.\n\t * @param    [optional] usesDelay       Defines whether the node uses the <code>delay</code> data in the static properties to determine how long a particle is hidden for. Defaults to false. Requires <code>usesDuration</code> to be true.\n\t * @param    [optional] usesLooping     Defines whether the node creates a looping timeframe for each particle determined by the <code>startTime</code>, <code>duration</code> and <code>delay</code> data in the static properties function. Defaults to false. Requires <code>usesLooping</code> to be true.\n\t */\n\tconstructor(usesDuration:boolean = false, usesLooping:boolean = false, usesDelay:boolean = false)\n\t{\n\t\tthis._pStateClass = ParticleTimeState;\n\n\t\tthis._iUsesDuration = usesDuration;\n\t\tthis._iUsesLooping = usesLooping;\n\t\tthis._iUsesDelay = usesDelay;\n\n\t\tsuper(\"ParticleTime\", ParticlePropertiesMode.LOCAL_STATIC, 4, 0);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar timeStreamRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexAttribute(); //timeStreamRegister.x is starttimeStreamRegister.y is during time\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleTimeState.TIME_STREAM_INDEX, timeStreamRegister.index);\n\t\tvar timeConst:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleTimeState.TIME_CONSTANT_INDEX, timeConst.index);\n\n\t\tvar code:string = \"\";\n\t\tcode += \"sub \" + animationRegisterCache.vertexTime + \",\" + timeConst + \",\" + timeStreamRegister + \".x\\n\";\n\t\t//if time=0,set the position to zero.\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\n\t\tcode += \"sge \" + temp + \",\" + animationRegisterCache.vertexTime + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\n\t\tcode += \"mul \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp + \"\\n\";\n\t\tif (this._iUsesDuration) {\n\t\t\tif (this._iUsesLooping) {\n\t\t\t\tvar div:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\n\t\t\t\tif (this._iUsesDelay) {\n\t\t\t\t\tcode += \"div \" + div + \",\" + animationRegisterCache.vertexTime + \",\" + timeStreamRegister + \".z\\n\";\n\t\t\t\t\tcode += \"frc \" + div + \",\" + div + \"\\n\";\n\t\t\t\t\tcode += \"mul \" + animationRegisterCache.vertexTime + \",\" + div + \",\" + timeStreamRegister + \".z\\n\";\n\t\t\t\t\tcode += \"slt \" + div + \",\" + animationRegisterCache.vertexTime + \",\" + timeStreamRegister + \".y\\n\";\n\t\t\t\t\tcode += \"mul \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + div + \"\\n\";\n\t\t\t\t} else {\n\t\t\t\t\tcode += \"mul \" + div + \",\" + animationRegisterCache.vertexTime + \",\" + timeStreamRegister + \".w\\n\";\n\t\t\t\t\tcode += \"frc \" + div + \",\" + div + \"\\n\";\n\t\t\t\t\tcode += \"mul \" + animationRegisterCache.vertexTime + \",\" + div + \",\" + timeStreamRegister + \".y\\n\";\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar sge:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\n\t\t\t\tcode += \"sge \" + sge + \",\" + timeStreamRegister + \".y,\" + animationRegisterCache.vertexTime + \"\\n\";\n\t\t\t\tcode += \"mul \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + sge + \"\\n\";\n\t\t\t}\n\t\t}\n\t\tcode += \"mul \" + animationRegisterCache.vertexLife + \",\" + animationRegisterCache.vertexTime + \",\" + timeStreamRegister + \".w\\n\";\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticleTimeState\n\t{\n\t\treturn <ParticleTimeState> animator.getAnimationState(this);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\n\t{\n\t\tthis._pOneData[0] = param.startTime;\n\t\tthis._pOneData[1] = param.duration;\n\t\tthis._pOneData[2] = param.delay + param.duration;\n\t\tthis._pOneData[3] = 1/param.duration;\n\n\t}\n}\n\nexport = ParticleTimeNode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleUVState\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleUVState\");\n\n/**\n * A particle animation node used to control the UV offset and scale of a particle over time.\n */\nclass ParticleUVNode extends ParticleNodeBase\n{\n\t/** @private */\n\tpublic _iUvData:Vector3D;\n\n\t/**\n\t *\n\t */\n\tpublic static U_AXIS:string = \"x\";\n\n\t/**\n\t *\n\t */\n\tpublic static V_AXIS:string = \"y\";\n\n\tprivate _cycle:number;\n\tprivate _scale:number;\n\tprivate _axis:string;\n\n\t/**\n\t * Creates a new <code>ParticleTimeNode</code>\n\t *\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\n\t * @param    [optional] cycle           Defines whether the time track is in loop mode. Defaults to false.\n\t * @param    [optional] scale           Defines whether the time track is in loop mode. Defaults to false.\n\t * @param    [optional] axis            Defines whether the time track is in loop mode. Defaults to false.\n\t */\n\tconstructor(mode:number /*uint*/, cycle:number = 1, scale:number = 1, axis:string = \"x\")\n\t{\n\t\t//because of the stage3d register limitation, it only support the global mode\n\t\tsuper(\"ParticleUV\", ParticlePropertiesMode.GLOBAL, 4, ParticleAnimationSet.POST_PRIORITY + 1);\n\n\t\tthis._pStateClass = ParticleUVState;\n\n\t\tthis._cycle = cycle;\n\t\tthis._scale = scale;\n\t\tthis._axis = axis;\n\n\t\tthis.updateUVData();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get cycle():number\n\t{\n\t\treturn this._cycle;\n\t}\n\n\tpublic set cycle(value:number)\n\t{\n\t\tthis._cycle = value;\n\n\t\tthis.updateUVData();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get scale():number\n\t{\n\t\treturn this._scale;\n\t}\n\n\tpublic set scale(value:number)\n\t{\n\t\tthis._scale = value;\n\n\t\tthis.updateUVData();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get axis():string\n\t{\n\t\treturn this._axis;\n\t}\n\n\tpublic set axis(value:string)\n\t{\n\t\tthis._axis = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALUVCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar code:string = \"\";\n\n\t\tvar uvConst:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleUVState.UV_INDEX, uvConst.index);\n\n\t\tvar axisIndex:number = this._axis == \"x\"? 0 : (this._axis == \"y\"? 1 : 2);\n\n\t\tvar target:ShaderRegisterElement = new ShaderRegisterElement(animationRegisterCache.uvTarget.regName, animationRegisterCache.uvTarget.index, axisIndex);\n\n\t\tvar sin:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\n\n\t\tif (this._scale != 1)\n\t\t\tcode += \"mul \" + target + \",\" + target + \",\" + uvConst + \".y\\n\";\n\n\t\tcode += \"mul \" + sin + \",\" + animationRegisterCache.vertexTime + \",\" + uvConst + \".x\\n\";\n\t\tcode += \"sin \" + sin + \",\" + sin + \"\\n\";\n\t\tcode += \"add \" + target + \",\" + target + \",\" + sin + \"\\n\";\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticleUVState\n\t{\n\t\treturn <ParticleUVState> animator.getAnimationState(this);\n\t}\n\n\tprivate updateUVData()\n\t{\n\t\tthis._iUvData = new Vector3D(Math.PI*2/this._cycle, this._scale, 0, 0);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\n\t{\n\t\tparticleAnimationSet.hasUVNode = true;\n\t}\n}\n\nexport = ParticleUVNode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleVelocityState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleVelocityState\");\n\n/**\n * A particle animation node used to set the starting velocity of a particle.\n */\nclass ParticleVelocityNode extends ParticleNodeBase\n{\n\t/** @private */\n\tpublic _iVelocity:Vector3D;\n\n\t/**\n\t * Reference for velocity node properties on a single particle (when in local property mode).\n\t * Expects a <code>Vector3D</code> object representing the direction of movement on the particle.\n\t */\n\tpublic static VELOCITY_VECTOR3D:string = \"VelocityVector3D\";\n\n\t/**\n\t * Creates a new <code>ParticleVelocityNode</code>\n\t *\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\n\t * @param    [optional] velocity        Defines the default velocity vector of the node, used when in global mode.\n\t */\n\tconstructor(mode:number /*uint*/, velocity:Vector3D = null)\n\t{\n\t\tsuper(\"ParticleVelocity\", mode, 3);\n\n\t\tthis._pStateClass = ParticleVelocityState;\n\n\t\tthis._iVelocity = velocity || new Vector3D();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\n\t{\n\t\tvar velocityValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleVelocityState.VELOCITY_INDEX, velocityValue.index);\n\n\t\tvar distance:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\n\t\tvar code:string = \"\";\n\t\tcode += \"mul \" + distance + \",\" + animationRegisterCache.vertexTime + \",\" + velocityValue + \"\\n\";\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + distance + \",\" + animationRegisterCache.positionTarget + \".xyz\\n\";\n\n\t\tif (animationRegisterCache.needVelocity)\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + velocityValue + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):ParticleVelocityState\n\t{\n\t\treturn <ParticleVelocityState> animator.getAnimationState(this);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\n\t{\n\t\tvar _tempVelocity:Vector3D = param[ParticleVelocityNode.VELOCITY_VECTOR3D];\n\t\tif (!_tempVelocity)\n\t\t\tthrow new Error(\"there is no \" + ParticleVelocityNode.VELOCITY_VECTOR3D + \" in param!\");\n\n\t\tthis._pOneData[0] = _tempVelocity.x;\n\t\tthis._pOneData[1] = _tempVelocity.y;\n\t\tthis._pOneData[2] = _tempVelocity.z;\n\t}\n}\n\nexport = ParticleVelocityNode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\n\nimport SkeletonBinaryLERPState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState\");\n\n/**\n * A skeleton animation node that uses two animation node inputs to blend a lineraly interpolated output of a skeleton pose.\n */\nclass SkeletonBinaryLERPNode extends AnimationNodeBase\n{\n\t/**\n\t * Defines input node A to use for the blended output.\n\t */\n\tpublic inputA:AnimationNodeBase;\n\n\t/**\n\t * Defines input node B to use for the blended output.\n\t */\n\tpublic inputB:AnimationNodeBase;\n\n\t/**\n\t * Creates a new <code>SkeletonBinaryLERPNode</code> object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._pStateClass = SkeletonBinaryLERPState;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):SkeletonBinaryLERPState\n\t{\n\t\treturn <SkeletonBinaryLERPState> animator.getAnimationState(this);\n\t}\n}\n\nexport = SkeletonBinaryLERPNode;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\n\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\nimport AnimationClipNodeBase\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase\");\nimport SkeletonClipState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonClipState\");\n\n/**\n * A skeleton animation node containing time-based animation data as individual skeleton poses.\n */\nclass SkeletonClipNode extends AnimationClipNodeBase\n{\n\tprivate _frames:Array<SkeletonPose> = new Array<SkeletonPose>();\n\n\t/**\n\t * Determines whether to use SLERP equations (true) or LERP equations (false) in the calculation\n\t * of the output skeleton pose. Defaults to false.\n\t */\n\tpublic highQuality:boolean = false;\n\n\t/**\n\t * Returns a vector of skeleton poses representing the pose of each animation frame in the clip.\n\t */\n\tpublic get frames():Array<SkeletonPose>\n\t{\n\t\treturn this._frames;\n\t}\n\n\t/**\n\t * Creates a new <code>SkeletonClipNode</code> object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._pStateClass = SkeletonClipState;\n\t}\n\n\t/**\n\t * Adds a skeleton pose frame to the internal timeline of the animation node.\n\t *\n\t * @param skeletonPose The skeleton pose object to add to the timeline of the node.\n\t * @param duration The specified duration of the frame in milliseconds.\n\t */\n\tpublic addFrame(skeletonPose:SkeletonPose, duration:number /*number /*uint*/)\n\t{\n\t\tthis._frames.push(skeletonPose);\n\t\tthis._pDurations.push(duration);\n\n\t\tthis._pNumFrames = this._pDurations.length;\n\n\t\tthis._pStitchDirty = true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):SkeletonClipState\n\t{\n\t\treturn <SkeletonClipState> animator.getAnimationState(this);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdateStitch()\n\t{\n\t\tsuper._pUpdateStitch();\n\n\t\tvar i:number /*uint*/ = this._pNumFrames - 1;\n\t\tvar p1:Vector3D, p2:Vector3D, delta:Vector3D;\n\t\twhile (i--) {\n\t\t\tthis._pTotalDuration += this._pDurations[i];\n\t\t\tp1 = this._frames[i].jointPoses[0].translation;\n\t\t\tp2 = this._frames[i + 1].jointPoses[0].translation;\n\t\t\tdelta = p2.subtract(p1);\n\t\t\tthis._pTotalDelta.x += delta.x;\n\t\t\tthis._pTotalDelta.y += delta.y;\n\t\t\tthis._pTotalDelta.z += delta.z;\n\t\t}\n\n\t\tif (this._pStitchFinalFrame || !this._pLooping) {\n\t\t\tthis._pTotalDuration += this._pDurations[this._pNumFrames - 1];\n\t\t\tp1 = this._frames[0].jointPoses[0].translation;\n\t\t\tp2 = this._frames[1].jointPoses[0].translation;\n\t\t\tdelta = p2.subtract(p1);\n\t\t\tthis._pTotalDelta.x += delta.x;\n\t\t\tthis._pTotalDelta.y += delta.y;\n\t\t\tthis._pTotalDelta.z += delta.z;\n\t\t}\n\t}\n}\n\nexport = SkeletonClipNode;","import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\n\nimport SkeletonDifferenceState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonDifferenceState\");\n\n/**\n * A skeleton animation node that uses a difference input pose with a base input pose to blend a linearly interpolated output of a skeleton pose.\n */\nclass SkeletonDifferenceNode extends AnimationNodeBase\n{\n\t/**\n\t * Defines a base input node to use for the blended output.\n\t */\n\tpublic baseInput:AnimationNodeBase;\n\n\t/**\n\t * Defines a difference input node to use for the blended output.\n\t */\n\tpublic differenceInput:AnimationNodeBase;\n\n\t/**\n\t * Creates a new <code>SkeletonAdditiveNode</code> object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._pStateClass = SkeletonDifferenceState;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):SkeletonDifferenceState\n\t{\n\t\treturn <SkeletonDifferenceState> animator.getAnimationState(this);\n\t}\n}\n\nexport = SkeletonDifferenceNode","import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\n\nimport SkeletonDirectionalState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonDirectionalState\");\n\n/**\n * A skeleton animation node that uses four directional input poses with an input direction to blend a linearly interpolated output of a skeleton pose.\n */\nclass SkeletonDirectionalNode extends AnimationNodeBase\n{\n\t/**\n\t * Defines the forward configured input node to use for the blended output.\n\t */\n\tpublic forward:AnimationNodeBase;\n\n\t/**\n\t * Defines the backwards configured input node to use for the blended output.\n\t */\n\tpublic backward:AnimationNodeBase;\n\n\t/**\n\t * Defines the left configured input node to use for the blended output.\n\t */\n\tpublic left:AnimationNodeBase;\n\n\t/**\n\t * Defines the right configured input node to use for the blended output.\n\t */\n\tpublic right:AnimationNodeBase;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._pStateClass = SkeletonDirectionalState;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):SkeletonDirectionalState\n\t{\n\t\treturn <SkeletonDirectionalState> animator.getAnimationState(this);\n\t}\n\n}\n\nexport = SkeletonDirectionalNode;","import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\n\nimport SkeletonNaryLERPState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState\");\n\n/**\n * A skeleton animation node that uses an n-dimensional array of animation node inputs to blend a lineraly interpolated output of a skeleton pose.\n */\nclass SkeletonNaryLERPNode extends AnimationNodeBase\n{\n\tpublic _iInputs:Array<AnimationNodeBase> = new Array<AnimationNodeBase>();\n\n\tprivate _numInputs:number /*uint*/;\n\n\tpublic get numInputs():number /*uint*/\n\t{\n\t\treturn this._numInputs;\n\t}\n\n\t/**\n\t * Creates a new <code>SkeletonNaryLERPNode</code> object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._pStateClass = SkeletonNaryLERPState;\n\t}\n\n\t/**\n\t * Returns an integer representing the input index of the given skeleton animation node.\n\t *\n\t * @param input The skeleton animation node for with the input index is requested.\n\t */\n\tpublic getInputIndex(input:AnimationNodeBase):number /*int*/\n\t{\n\t\treturn this._iInputs.indexOf(input);\n\t}\n\n\t/**\n\t * Returns the skeleton animation node object that resides at the given input index.\n\t *\n\t * @param index The input index for which the skeleton animation node is requested.\n\t */\n\tpublic getInputAt(index:number /*uint*/):AnimationNodeBase\n\t{\n\t\treturn this._iInputs[index];\n\t}\n\n\t/**\n\t * Adds a new skeleton animation node input to the animation node.\n\t */\n\tpublic addInput(input:AnimationNodeBase)\n\t{\n\t\tthis._iInputs[this._numInputs++] = input;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getAnimationState(animator:AnimatorBase):SkeletonNaryLERPState\n\t{\n\t\treturn <SkeletonNaryLERPState> animator.getAnimationState(this);\n\t}\n}\n\nexport = SkeletonNaryLERPNode","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\n\nimport AnimationClipNodeBase\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase\");\nimport VertexClipState\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/VertexClipState\");\n\n/**\n * A vertex animation node containing time-based animation data as individual geometry obejcts.\n */\nclass VertexClipNode extends AnimationClipNodeBase\n{\n\tprivate _frames:Array<Geometry> = new Array<Geometry>();\n\tprivate _translations:Array<Vector3D> = new Array<Vector3D>();\n\n\t/**\n\t * Returns a vector of geometry frames representing the vertex values of each animation frame in the clip.\n\t */\n\tpublic get frames():Array<Geometry>\n\t{\n\t\treturn this._frames;\n\t}\n\n\t/**\n\t * Creates a new <code>VertexClipNode</code> object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._pStateClass = VertexClipState;\n\t}\n\n\t/**\n\t * Adds a geometry object to the internal timeline of the animation node.\n\t *\n\t * @param geometry The geometry object to add to the timeline of the node.\n\t * @param duration The specified duration of the frame in milliseconds.\n\t * @param translation The absolute translation of the frame, used in root delta calculations for mesh movement.\n\t */\n\tpublic addFrame(geometry:Geometry, duration:number /*uint*/, translation:Vector3D = null)\n\t{\n\t\tthis._frames.push(geometry);\n\t\tthis._pDurations.push(duration);\n\t\tthis._translations.push(translation || new Vector3D());\n\n\t\tthis._pNumFrames = this._pDurations.length;\n\n\t\tthis._pStitchDirty = true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdateStitch()\n\t{\n\t\tsuper._pUpdateStitch();\n\n\t\tvar i:number /*uint*/ = this._pNumFrames - 1;\n\t\tvar p1:Vector3D, p2:Vector3D, delta:Vector3D;\n\t\twhile (i--) {\n\t\t\tthis._pTotalDuration += this._pDurations[i];\n\t\t\tp1 = this._translations[i];\n\t\t\tp2 = this._translations[i + 1];\n\t\t\tdelta = p2.subtract(p1);\n\t\t\tthis._pTotalDelta.x += delta.x;\n\t\t\tthis._pTotalDelta.y += delta.y;\n\t\t\tthis._pTotalDelta.z += delta.z;\n\t\t}\n\n\t\tif (this._pNumFrames > 1 && (this._pStitchFinalFrame || !this._pLooping)) {\n\t\t\tthis._pTotalDuration += this._pDurations[this._pNumFrames - 1];\n\t\t\tp1 = this._translations[0];\n\t\t\tp2 = this._translations[1];\n\t\t\tdelta = p2.subtract(p1);\n\t\t\tthis._pTotalDelta.x += delta.x;\n\t\t\tthis._pTotalDelta.y += delta.y;\n\t\t\tthis._pTotalDelta.z += delta.z;\n\t\t}\n\t}\n}\n\nexport = VertexClipNode;","import AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\n\nimport AnimationClipNodeBase\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase\");\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\nimport AnimationStateEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/AnimationStateEvent\");\n\n/**\n *\n */\nclass AnimationClipState extends AnimationStateBase\n{\n\tprivate _animationClipNode:AnimationClipNodeBase;\n\tprivate _animationStatePlaybackComplete:AnimationStateEvent;\n\tpublic _pBlendWeight:number;\n\tpublic _pCurrentFrame:number /*uint*/;\n\tpublic _pNextFrame:number /*uint*/;\n\n\tpublic _pOldFrame:number /*uint*/;\n\tpublic _pTimeDir:number /*int*/;\n\tpublic _pFramesDirty:boolean = true;\n\n\t/**\n\t * Returns a fractional value between 0 and 1 representing the blending ratio of the current playhead position\n\t * between the current frame (0) and next frame (1) of the animation.\n\t *\n\t * @see #currentFrame\n\t * @see #nextFrame\n\t */\n\tpublic get blendWeight():number\n\t{\n\t\tif (this._pFramesDirty)\n\t\t\tthis._pUpdateFrames();\n\n\t\treturn this._pBlendWeight;\n\t}\n\n\t/**\n\t * Returns the current frame of animation in the clip based on the internal playhead position.\n\t */\n\tpublic get currentFrame():number /*uint*/\n\t{\n\t\tif (this._pFramesDirty)\n\t\t\tthis._pUpdateFrames();\n\n\t\treturn this._pCurrentFrame;\n\t}\n\n\t/**\n\t * Returns the next frame of animation in the clip based on the internal playhead position.\n\t */\n\tpublic get nextFrame():number /*uint*/\n\t{\n\t\tif (this._pFramesDirty)\n\t\t\tthis._pUpdateFrames();\n\n\t\treturn this._pNextFrame;\n\t}\n\n\tconstructor(animator:AnimatorBase, animationClipNode:AnimationClipNodeBase)\n\t{\n\t\tsuper(animator, animationClipNode);\n\n\t\tthis._animationClipNode = animationClipNode;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic update(time:number /*int*/)\n\t{\n\t\tif (!this._animationClipNode.looping) {\n\t\t\tif (time > this._pStartTime + this._animationClipNode.totalDuration)\n\t\t\t\ttime = this._pStartTime + this._animationClipNode.totalDuration; else if (time < this._pStartTime)\n\t\t\t\ttime = this._pStartTime;\n\t\t}\n\n\t\tif (this._pTime == time - this._pStartTime)\n\t\t\treturn;\n\n\t\tthis._pUpdateTime(time);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic phase(value:number)\n\t{\n\t\tvar time:number /*int*/ = value*this._animationClipNode.totalDuration + this._pStartTime;\n\n\t\tif (this._pTime == time - this._pStartTime)\n\t\t\treturn;\n\n\t\tthis._pUpdateTime(time);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdateTime(time:number /*int*/)\n\t{\n\t\tthis._pFramesDirty = true;\n\n\t\tthis._pTimeDir = (time - this._pStartTime > this._pTime)? 1 : -1;\n\n\t\tsuper._pUpdateTime(time);\n\t}\n\n\t/**\n\t * Updates the nodes internal playhead to determine the current and next animation frame, and the blendWeight between the two.\n\t *\n\t * @see #currentFrame\n\t * @see #nextFrame\n\t * @see #blendWeight\n\t */\n\tpublic _pUpdateFrames()\n\t{\n\t\tthis._pFramesDirty = false;\n\n\t\tvar looping:boolean = this._animationClipNode.looping;\n\t\tvar totalDuration:number /*uint*/ = this._animationClipNode.totalDuration;\n\t\tvar lastFrame:number /*uint*/ = this._animationClipNode.lastFrame;\n\t\tvar time:number /*int*/ = this._pTime;\n\n\t\t//trace(\"time\", time, totalDuration)\n\t\tif (looping && (time >= totalDuration || time < 0)) {\n\t\t\ttime %= totalDuration;\n\t\t\tif (time < 0)\n\t\t\t\ttime += totalDuration;\n\t\t}\n\n\t\tif (!looping && time >= totalDuration) {\n\t\t\tthis.notifyPlaybackComplete();\n\t\t\tthis._pCurrentFrame = lastFrame;\n\t\t\tthis._pNextFrame = lastFrame;\n\t\t\tthis._pBlendWeight = 0;\n\t\t} else if (!looping && time <= 0) {\n\t\t\tthis._pCurrentFrame = 0;\n\t\t\tthis._pNextFrame = 0;\n\t\t\tthis._pBlendWeight = 0;\n\t\t} else if (this._animationClipNode.fixedFrameRate) {\n\t\t\tvar t:number = time/totalDuration*lastFrame;\n\t\t\tthis._pCurrentFrame = Math.floor(t);\n\t\t\tthis._pBlendWeight = t - this._pCurrentFrame;\n\t\t\tthis._pNextFrame = this._pCurrentFrame + 1;\n\t\t} else {\n\t\t\tthis._pCurrentFrame = 0;\n\t\t\tthis._pNextFrame = 0;\n\n\t\t\tvar dur:number /*uint*/ = 0, frameTime:number /*uint*/;\n\t\t\tvar durations:Array<number> /*uint*/ = this._animationClipNode.durations;\n\n\t\t\tdo {\n\t\t\t\tframeTime = dur;\n\t\t\t\tdur += durations[this._pNextFrame];\n\t\t\t\tthis._pCurrentFrame = this._pNextFrame++;\n\t\t\t} while (time > dur);\n\n\t\t\tif (this._pCurrentFrame == lastFrame) {\n\t\t\t\tthis._pCurrentFrame = 0;\n\t\t\t\tthis._pNextFrame = 1;\n\t\t\t}\n\n\t\t\tthis._pBlendWeight = (time - frameTime)/durations[this._pCurrentFrame];\n\t\t}\n\t}\n\n\tprivate notifyPlaybackComplete()\n\t{\n\t\tif (this._animationStatePlaybackComplete == null)\n\t\t\tthis._animationStatePlaybackComplete = new AnimationStateEvent(AnimationStateEvent.PLAYBACK_COMPLETE, this._pAnimator, this, this._animationClipNode);\n\n\t\tthis._animationClipNode.dispatchEvent(this._animationStatePlaybackComplete);\n\t}\n}\n\nexport = AnimationClipState;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport IAnimationState\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/IAnimationState\");\n\nimport AnimationStateEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/AnimationStateEvent\");\n\n/**\n *\n */\nclass AnimationStateBase implements IAnimationState\n{\n\tpublic _pAnimationNode:AnimationNodeBase;\n\tpublic _pRootDelta:Vector3D = new Vector3D();\n\tpublic _pPositionDeltaDirty:boolean = true;\n\n\tpublic _pTime:number;\n\tpublic _pStartTime:number = 0;\n\tpublic _pAnimator:AnimatorBase;\n\n\t/**\n\t * Returns a 3d vector representing the translation delta of the animating entity for the current timestep of animation\n\t */\n\tpublic get positionDelta():Vector3D\n\t{\n\t\tif (this._pPositionDeltaDirty) {\n\n\t\t\tthis._pUpdatePositionDelta();\n\t\t}\n\n\t\treturn this._pRootDelta;\n\n\t}\n\n\tconstructor(animator:AnimatorBase, animationNode:AnimationNodeBase)\n\t{\n\t\tthis._pAnimator = animator;\n\t\tthis._pAnimationNode = animationNode;\n\t}\n\n\t/**\n\t * Resets the start time of the node to a  new value.\n\t *\n\t * @param startTime The absolute start time (in milliseconds) of the node's starting time.\n\t */\n\tpublic offset(startTime:number)\n\t{\n\t\tthis._pStartTime = startTime;\n\n\t\tthis._pPositionDeltaDirty = true;\n\t}\n\n\t/**\n\t * Updates the configuration of the node to its current state.\n\t *\n\t * @param time The absolute time (in milliseconds) of the animator's play head position.\n\t *\n\t * @see AnimatorBase#update()\n\t */\n\tpublic update(time:number)\n\t{\n\t\tif (this._pTime == time - this._pStartTime) {\n\n\t\t\treturn;\n\n\t\t}\n\n\t\tthis._pUpdateTime(time);\n\n\t}\n\n\t/**\n\t * Sets the animation phase of the node.\n\t *\n\t * @param value The phase value to use. 0 represents the beginning of an animation clip, 1 represents the end.\n\t */\n\tpublic phase(value:number)\n\t{\n\n\t}\n\n\t/**\n\t * Updates the node's internal playhead position.\n\t *\n\t * @param time The local time (in milliseconds) of the node's playhead position.\n\t */\n\tpublic _pUpdateTime(time:number)\n\t{\n\t\tthis._pTime = time - this._pStartTime;\n\n\t\tthis._pPositionDeltaDirty = true;\n\t}\n\n\t/**\n\t * Updates the node's root delta position\n\t */\n\tpublic _pUpdatePositionDelta()\n\t{\n\t}\n}\n\nexport = AnimationStateBase;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleAccelerationNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleAccelerationNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n */\nclass ParticleAccelerationState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static ACCELERATION_INDEX:number /*int*/ = 0;\n\n\tprivate _particleAccelerationNode:ParticleAccelerationNode;\n\tprivate _acceleration:Vector3D;\n\tprivate _halfAcceleration:Vector3D;\n\t\n\t/**\n\t * Defines the acceleration vector of the state, used when in global mode.\n\t */\n\tpublic get acceleration():Vector3D\n\t{\n\t\treturn this._acceleration;\n\t}\n\t\n\tpublic set acceleration(value:Vector3D)\n\t{\n\t\tthis._acceleration.x = value.x;\n\t\tthis._acceleration.y = value.y;\n\t\tthis._acceleration.z = value.z;\n\n\t\tthis.updateAccelerationData();\n\t}\n\t\n\tconstructor(animator:ParticleAnimator, particleAccelerationNode:ParticleAccelerationNode)\n\t{\n\t\tsuper(animator, particleAccelerationNode);\n\n\t\tthis._particleAccelerationNode = particleAccelerationNode;\n\t\tthis._acceleration = this._particleAccelerationNode._acceleration;\n\n\t\tthis.updateAccelerationData();\n\t}\n\t\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleAccelerationState.ACCELERATION_INDEX);\n\t\t\n\t\tif (this._particleAccelerationNode.mode == ParticlePropertiesMode.LOCAL_STATIC)\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleAccelerationNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\n\t\telse\n\t\t\tanimationRegisterCache.setVertexConst(index, this._halfAcceleration.x, this._halfAcceleration.y, this._halfAcceleration.z);\n\t}\n\t\n\tprivate updateAccelerationData()\n\t{\n\t\tif (this._particleAccelerationNode.mode == ParticlePropertiesMode.GLOBAL)\n\t\t\tthis._halfAcceleration = new Vector3D(this._acceleration.x/2, this._acceleration.y/2, this._acceleration.z/2);\n\t}\n}\n\nexport = ParticleAccelerationState;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleBezierCurveNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleBezierCurveNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n/**\n * ...\n */\nclass ParticleBezierCurveState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static BEZIER_CONTROL_INDEX:number /*int*/ = 0;\n\n\t/** @private */\n\tpublic static BEZIER_END_INDEX:number /*int*/ = 1;\n\n\tprivate _particleBezierCurveNode:ParticleBezierCurveNode;\n\tprivate _controlPoint:Vector3D;\n\tprivate _endPoint:Vector3D;\n\n\t/**\n\t * Defines the default control point of the node, used when in global mode.\n\t */\n\tpublic get controlPoint():Vector3D\n\t{\n\t\treturn this._controlPoint;\n\t}\n\n\tpublic set controlPoint(value:Vector3D)\n\t{\n\t\tthis._controlPoint = value;\n\t}\n\n\t/**\n\t * Defines the default end point of the node, used when in global mode.\n\t */\n\tpublic get endPoint():Vector3D\n\t{\n\t\treturn this._endPoint;\n\t}\n\n\tpublic set endPoint(value:Vector3D)\n\t{\n\t\tthis._endPoint = value;\n\t}\n\n\tconstructor(animator:ParticleAnimator, particleBezierCurveNode:ParticleBezierCurveNode)\n\t{\n\t\tsuper(animator, particleBezierCurveNode);\n\n\t\tthis._particleBezierCurveNode = particleBezierCurveNode;\n\t\tthis._controlPoint = this._particleBezierCurveNode._iControlPoint;\n\t\tthis._endPoint = this._particleBezierCurveNode._iEndPoint;\n\t}\n\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tvar controlIndex:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleBezierCurveState.BEZIER_CONTROL_INDEX);\n\t\tvar endIndex:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleBezierCurveState.BEZIER_END_INDEX);\n\n\t\tif (this._particleBezierCurveNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\n\t\t\tanimationSubGeometry.activateVertexBuffer(controlIndex, this._particleBezierCurveNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\n\t\t\tanimationSubGeometry.activateVertexBuffer(endIndex, this._particleBezierCurveNode._iDataOffset + 3, stage, ContextGLVertexBufferFormat.FLOAT_3);\n\t\t} else {\n\t\t\tanimationRegisterCache.setVertexConst(controlIndex, this._controlPoint.x, this._controlPoint.y, this._controlPoint.z);\n\t\t\tanimationRegisterCache.setVertexConst(endIndex, this._endPoint.x, this._endPoint.y, this._endPoint.z);\n\t\t}\n\t}\n}\n\nexport = ParticleBezierCurveState;","import MathConsts\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/MathConsts\");\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport Orientation3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Orientation3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticleBillboardNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleBillboardNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n */\nclass ParticleBillboardState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static MATRIX_INDEX:number /*int*/ = 0;\n\n\tprivate _matrix:Matrix3D = new Matrix3D;\n\n\tprivate _billboardAxis:Vector3D;\n\n\t/**\n\t *\n\t */\n\tconstructor(animator:ParticleAnimator, particleNode:ParticleBillboardNode)\n\t{\n\t\tsuper(animator, particleNode);\n\n\t\tthis._billboardAxis = particleNode._iBillboardAxis;\n\t}\n\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tvar comps:Array<Vector3D>;\n\t\tif (this._billboardAxis) {\n\t\t\tvar pos:Vector3D = renderable.sourceEntity.sceneTransform.position;\n\t\t\tvar look:Vector3D = camera.sceneTransform.position.subtract(pos);\n\t\t\tvar right:Vector3D = look.crossProduct(this._billboardAxis);\n\t\t\tright.normalize();\n\t\t\tlook = this.billboardAxis.crossProduct(right);\n\t\t\tlook.normalize();\n\n\t\t\t//create a quick inverse projection matrix\n\t\t\tthis._matrix.copyFrom(renderable.sourceEntity.sceneTransform);\n\t\t\tcomps = this._matrix.decompose(Orientation3D.AXIS_ANGLE);\n\t\t\tthis._matrix.copyColumnFrom(0, right);\n\t\t\tthis._matrix.copyColumnFrom(1, this.billboardAxis);\n\t\t\tthis._matrix.copyColumnFrom(2, look);\n\t\t\tthis._matrix.copyColumnFrom(3, pos);\n\t\t\tthis._matrix.appendRotation(-comps[1].w*MathConsts.RADIANS_TO_DEGREES, comps[1]);\n\t\t} else {\n\t\t\t//create a quick inverse projection matrix\n\t\t\tthis._matrix.copyFrom(renderable.sourceEntity.sceneTransform);\n\t\t\tthis._matrix.append(camera.inverseSceneTransform);\n\n\t\t\t//decompose using axis angle rotations\n\t\t\tcomps = this._matrix.decompose(Orientation3D.AXIS_ANGLE);\n\n\t\t\t//recreate the matrix with just the rotation data\n\t\t\tthis._matrix.identity();\n\t\t\tthis._matrix.appendRotation(-comps[1].w*MathConsts.RADIANS_TO_DEGREES, comps[1]);\n\t\t}\n\n\t\t//set a new matrix transform constant\n\t\tanimationRegisterCache.setVertexConstFromMatrix(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleBillboardState.MATRIX_INDEX), this._matrix);\n\t}\n\n\t/**\n\t * Defines the billboard axis.\n\t */\n\tpublic get billboardAxis():Vector3D\n\t{\n\t\treturn this.billboardAxis;\n\t}\n\n\tpublic set billboardAxis(value:Vector3D)\n\t{\n\t\tthis.billboardAxis = value? value.clone() : null;\n\t\tif (this.billboardAxis)\n\t\t\tthis.billboardAxis.normalize();\n\t}\n\n}\n\nexport = ParticleBillboardState;","import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleColorNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleColorNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n * @author ...\n */\nclass ParticleColorState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static START_MULTIPLIER_INDEX:number /*uint*/ = 0;\n\n\t/** @private */\n\tpublic static DELTA_MULTIPLIER_INDEX:number /*uint*/ = 1;\n\n\t/** @private */\n\tpublic static START_OFFSET_INDEX:number /*uint*/ = 2;\n\n\t/** @private */\n\tpublic static DELTA_OFFSET_INDEX:number /*uint*/ = 3;\n\n\t/** @private */\n\tpublic static CYCLE_INDEX:number /*uint*/ = 4;\n\n\tprivate _particleColorNode:ParticleColorNode;\n\tprivate _usesMultiplier:boolean;\n\tprivate _usesOffset:boolean;\n\tprivate _usesCycle:boolean;\n\tprivate _usesPhase:boolean;\n\tprivate _startColor:ColorTransform;\n\tprivate _endColor:ColorTransform;\n\tprivate _cycleDuration:number;\n\tprivate _cyclePhase:number;\n\tprivate _cycleData:Vector3D;\n\tprivate _startMultiplierData:Vector3D;\n\tprivate _deltaMultiplierData:Vector3D;\n\tprivate _startOffsetData:Vector3D;\n\tprivate _deltaOffsetData:Vector3D;\n\n\t/**\n\t * Defines the start color transform of the state, when in global mode.\n\t */\n\tpublic get startColor():ColorTransform\n\t{\n\t\treturn this._startColor;\n\t}\n\n\tpublic set startColor(value:ColorTransform)\n\t{\n\t\tthis._startColor = value;\n\n\t\tthis.updateColorData();\n\t}\n\n\t/**\n\t * Defines the end color transform of the state, when in global mode.\n\t */\n\tpublic get endColor():ColorTransform\n\t{\n\t\treturn this._endColor;\n\t}\n\n\tpublic set endColor(value:ColorTransform)\n\t{\n\t\tthis._endColor = value;\n\n\t\tthis.updateColorData();\n\t}\n\n\t/**\n\t * Defines the duration of the animation in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\n\t */\n\tpublic get cycleDuration():number\n\t{\n\t\treturn this._cycleDuration;\n\t}\n\n\tpublic set cycleDuration(value:number)\n\t{\n\t\tthis._cycleDuration = value;\n\n\t\tthis.updateColorData();\n\t}\n\n\t/**\n\t * Defines the phase of the cycle in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\n\t */\n\tpublic get cyclePhase():number\n\t{\n\t\treturn this._cyclePhase;\n\t}\n\n\tpublic set cyclePhase(value:number)\n\t{\n\t\tthis._cyclePhase = value;\n\n\t\tthis.updateColorData();\n\t}\n\n\tconstructor(animator:ParticleAnimator, particleColorNode:ParticleColorNode)\n\t{\n\t\tsuper(animator, particleColorNode);\n\n\t\tthis._particleColorNode = particleColorNode;\n\t\tthis._usesMultiplier = this._particleColorNode._iUsesMultiplier;\n\t\tthis._usesOffset = this._particleColorNode._iUsesOffset;\n\t\tthis._usesCycle = this._particleColorNode._iUsesCycle;\n\t\tthis._usesPhase = this._particleColorNode._iUsesPhase;\n\t\tthis._startColor = this._particleColorNode._iStartColor;\n\t\tthis._endColor = this._particleColorNode._iEndColor;\n\t\tthis._cycleDuration = this._particleColorNode._iCycleDuration;\n\t\tthis._cyclePhase = this._particleColorNode._iCyclePhase;\n\n\t\tthis.updateColorData();\n\t}\n\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tif (animationRegisterCache.needFragmentAnimation) {\n\t\t\tvar dataOffset:number /*uint*/ = this._particleColorNode._iDataOffset;\n\t\t\tif (this._usesCycle)\n\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.CYCLE_INDEX), this._cycleData.x, this._cycleData.y, this._cycleData.z, this._cycleData.w);\n\n\t\t\tif (this._usesMultiplier) {\n\t\t\t\tif (this._particleColorNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.START_MULTIPLIER_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\n\t\t\t\t\tdataOffset += 4;\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.DELTA_MULTIPLIER_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\n\t\t\t\t\tdataOffset += 4;\n\t\t\t\t} else {\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.START_MULTIPLIER_INDEX), this._startMultiplierData.x, this._startMultiplierData.y, this._startMultiplierData.z, this._startMultiplierData.w);\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.DELTA_MULTIPLIER_INDEX), this._deltaMultiplierData.x, this._deltaMultiplierData.y, this._deltaMultiplierData.z, this._deltaMultiplierData.w);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this._usesOffset) {\n\t\t\t\tif (this._particleColorNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.START_OFFSET_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\n\t\t\t\t\tdataOffset += 4;\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.DELTA_OFFSET_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\n\t\t\t\t\tdataOffset += 4;\n\t\t\t\t} else {\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.START_OFFSET_INDEX), this._startOffsetData.x, this._startOffsetData.y, this._startOffsetData.z, this._startOffsetData.w);\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.DELTA_OFFSET_INDEX), this._deltaOffsetData.x, this._deltaOffsetData.y, this._deltaOffsetData.z, this._deltaOffsetData.w);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate updateColorData()\n\t{\n\t\tif (this._usesCycle) {\n\t\t\tif (this._cycleDuration <= 0)\n\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\n\t\t\tthis._cycleData = new Vector3D(Math.PI*2/this._cycleDuration, this._cyclePhase*Math.PI/180, 0, 0);\n\t\t}\n\t\tif (this._particleColorNode.mode == ParticlePropertiesMode.GLOBAL) {\n\t\t\tif (this._usesCycle) {\n\t\t\t\tif (this._usesMultiplier) {\n\t\t\t\t\tthis._startMultiplierData = new Vector3D((this._startColor.redMultiplier + this._endColor.redMultiplier)/2, (this._startColor.greenMultiplier + this._endColor.greenMultiplier)/2, (this._startColor.blueMultiplier + this._endColor.blueMultiplier)/2, (this._startColor.alphaMultiplier + this._endColor.alphaMultiplier)/2);\n\t\t\t\t\tthis._deltaMultiplierData = new Vector3D((this._endColor.redMultiplier - this._startColor.redMultiplier)/2, (this._endColor.greenMultiplier - this._startColor.greenMultiplier)/2, (this._endColor.blueMultiplier - this._startColor.blueMultiplier)/2, (this._endColor.alphaMultiplier - this._startColor.alphaMultiplier)/2);\n\t\t\t\t}\n\n\t\t\t\tif (this._usesOffset) {\n\t\t\t\t\tthis._startOffsetData = new Vector3D((this._startColor.redOffset + this._endColor.redOffset)/(255*2), (this._startColor.greenOffset + this._endColor.greenOffset)/(255*2), (this._startColor.blueOffset + this._endColor.blueOffset)/(255*2), (this._startColor.alphaOffset + this._endColor.alphaOffset)/(255*2));\n\t\t\t\t\tthis._deltaOffsetData = new Vector3D((this._endColor.redOffset - this._startColor.redOffset)/(255*2), (this._endColor.greenOffset - this._startColor.greenOffset)/(255*2), (this._endColor.blueOffset - this._startColor.blueOffset)/(255*2), (this._endColor.alphaOffset - this._startColor.alphaOffset)/(255*2));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this._usesMultiplier) {\n\t\t\t\t\tthis._startMultiplierData = new Vector3D(this._startColor.redMultiplier, this._startColor.greenMultiplier, this._startColor.blueMultiplier, this._startColor.alphaMultiplier);\n\t\t\t\t\tthis._deltaMultiplierData = new Vector3D((this._endColor.redMultiplier - this._startColor.redMultiplier), (this._endColor.greenMultiplier - this._startColor.greenMultiplier), (this._endColor.blueMultiplier - this._startColor.blueMultiplier), (this._endColor.alphaMultiplier - this._startColor.alphaMultiplier));\n\t\t\t\t}\n\n\t\t\t\tif (this._usesOffset) {\n\t\t\t\t\tthis._startOffsetData = new Vector3D(this._startColor.redOffset/255, this._startColor.greenOffset/255, this._startColor.blueOffset/255, this._startColor.alphaOffset/255);\n\t\t\t\t\tthis._deltaOffsetData = new Vector3D((this._endColor.redOffset - this._startColor.redOffset)/255, (this._endColor.greenOffset - this._startColor.greenOffset)/255, (this._endColor.blueOffset - this._startColor.blueOffset )/255, (this._endColor.alphaOffset - this._startColor.alphaOffset)/255);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport = ParticleColorState;","import MathConsts\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/MathConsts\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticleAnimationData\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleAnimationData\");\nimport ParticleFollowNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleFollowNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n */\nclass ParticleFollowState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static FOLLOW_POSITION_INDEX:number /*uint*/ = 0;\n\n\t/** @private */\n\tpublic static FOLLOW_ROTATION_INDEX:number /*uint*/ = 1;\n\n\tprivate _particleFollowNode:ParticleFollowNode;\n\tprivate _followTarget:DisplayObject;\n\n\tprivate _targetPos:Vector3D = new Vector3D();\n\tprivate _targetEuler:Vector3D = new Vector3D();\n\tprivate _prePos:Vector3D;\n\tprivate _preEuler:Vector3D;\n\tprivate _smooth:boolean;\n\n\t//temporary vector3D for calculation\n\tprivate _temp:Vector3D = new Vector3D();\n\n\tconstructor(animator:ParticleAnimator, particleFollowNode:ParticleFollowNode)\n\t{\n\t\tsuper(animator, particleFollowNode, true);\n\n\t\tthis._particleFollowNode = particleFollowNode;\n\t\tthis._smooth = particleFollowNode._iSmooth;\n\t}\n\n\tpublic get followTarget():DisplayObject\n\t{\n\t\treturn this._followTarget;\n\t}\n\n\tpublic set followTarget(value:DisplayObject)\n\t{\n\t\tthis._followTarget = value;\n\t}\n\n\tpublic get smooth():boolean\n\t{\n\t\treturn this._smooth;\n\t}\n\n\tpublic set smooth(value:boolean)\n\t{\n\t\tthis._smooth = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tif (this._followTarget) {\n\t\t\tif (this._particleFollowNode._iUsesPosition) {\n\t\t\t\tthis._targetPos.x = this._followTarget.transform.position.x/renderable.sourceEntity.scaleX;\n\t\t\t\tthis._targetPos.y = this._followTarget.transform.position.y/renderable.sourceEntity.scaleY;\n\t\t\t\tthis._targetPos.z = this._followTarget.transform.position.z/renderable.sourceEntity.scaleZ;\n\t\t\t}\n\t\t\tif (this._particleFollowNode._iUsesRotation) {\n\t\t\t\tthis._targetEuler.x = this._followTarget.rotationX;\n\t\t\t\tthis._targetEuler.y = this._followTarget.rotationY;\n\t\t\t\tthis._targetEuler.z = this._followTarget.rotationZ;\n\t\t\t\tthis._targetEuler.scaleBy(MathConsts.DEGREES_TO_RADIANS);\n\t\t\t}\n\t\t}\n\t\t//initialization\n\t\tif (!this._prePos)\n\t\t\tthis._prePos = this._targetPos.clone();\n\t\tif (!this._preEuler)\n\t\t\tthis._preEuler = this._targetEuler.clone();\n\n\t\tvar currentTime:number = this._pTime/1000;\n\t\tvar previousTime:number = animationSubGeometry.previousTime;\n\t\tvar deltaTime:number = currentTime - previousTime;\n\n\t\tvar needProcess:boolean = previousTime != currentTime;\n\n\t\tif (this._particleFollowNode._iUsesPosition && this._particleFollowNode._iUsesRotation) {\n\t\t\tif (needProcess)\n\t\t\t\tthis.processPositionAndRotation(currentTime, deltaTime, animationSubGeometry);\n\n\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_POSITION_INDEX), this._particleFollowNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\n\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_ROTATION_INDEX), this._particleFollowNode._iDataOffset + 3, stage, ContextGLVertexBufferFormat.FLOAT_3);\n\t\t} else if (this._particleFollowNode._iUsesPosition) {\n\t\t\tif (needProcess)\n\t\t\t\tthis.processPosition(currentTime, deltaTime, animationSubGeometry);\n\n\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_POSITION_INDEX), this._particleFollowNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\n\t\t} else if (this._particleFollowNode._iUsesRotation) {\n\t\t\tif (needProcess)\n\t\t\t\tthis.precessRotation(currentTime, deltaTime, animationSubGeometry);\n\n\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_ROTATION_INDEX), this._particleFollowNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\n\t\t}\n\n\t\tthis._prePos.copyFrom(this._targetPos);\n\t\tthis._targetEuler.copyFrom(this._targetEuler);\n\t\tanimationSubGeometry.previousTime = currentTime;\n\t}\n\n\tprivate processPosition(currentTime:number, deltaTime:number, animationSubGeometry:AnimationSubGeometry)\n\t{\n\t\tvar data:Array<ParticleAnimationData> = animationSubGeometry.animationParticles;\n\t\tvar vertexData:Array<number> = animationSubGeometry.vertexData;\n\n\t\tvar changed:boolean = false;\n\t\tvar len:number /*uint*/ = data.length;\n\t\tvar interpolatedPos:Vector3D;\n\t\tvar posVelocity:Vector3D;\n\t\tif (this._smooth) {\n\t\t\tposVelocity = this._prePos.subtract(this._targetPos);\n\t\t\tposVelocity.scaleBy(1/deltaTime);\n\t\t} else\n\t\t\tinterpolatedPos = this._targetPos;\n\t\tfor (var i:number /*uint*/ = 0; i < len; i++) {\n\t\t\tvar k:number = (currentTime - data[i].startTime)/data[i].totalTime;\n\t\t\tvar t:number = (k - Math.floor(k))*data[i].totalTime;\n\t\t\tif (t - deltaTime <= 0) {\n\t\t\t\tvar inc:number /*int*/ = data[i].startVertexIndex*animationSubGeometry.totalLenOfOneVertex + this._particleFollowNode._iDataOffset;\n\n\t\t\t\tif (this._smooth) {\n\t\t\t\t\tthis._temp.copyFrom(posVelocity);\n\t\t\t\t\tthis._temp.scaleBy(t);\n\t\t\t\t\tinterpolatedPos = this._targetPos.add(this._temp);\n\t\t\t\t}\n\n\t\t\t\tif (vertexData[inc] != interpolatedPos.x || vertexData[inc + 1] != interpolatedPos.y || vertexData[inc + 2] != interpolatedPos.z) {\n\t\t\t\t\tchanged = true;\n\t\t\t\t\tfor (var j:number /*uint*/ = 0; j < data[i].numVertices; j++) {\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.x;\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.y;\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.z;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (changed)\n\t\t\tanimationSubGeometry.invalidateBuffer();\n\n\t}\n\n\tprivate precessRotation(currentTime:number, deltaTime:number, animationSubGeometry:AnimationSubGeometry)\n\t{\n\t\tvar data:Array<ParticleAnimationData> = animationSubGeometry.animationParticles;\n\t\tvar vertexData:Array<number> = animationSubGeometry.vertexData;\n\n\t\tvar changed:boolean = false;\n\t\tvar len:number /*uint*/ = data.length;\n\n\t\tvar interpolatedRotation:Vector3D;\n\t\tvar rotationVelocity:Vector3D;\n\n\t\tif (this._smooth) {\n\t\t\trotationVelocity = this._preEuler.subtract(this._targetEuler);\n\t\t\trotationVelocity.scaleBy(1/deltaTime);\n\t\t} else\n\t\t\tinterpolatedRotation = this._targetEuler;\n\n\t\tfor (var i:number /*uint*/ = 0; i < len; i++) {\n\t\t\tvar k:number = (currentTime - data[i].startTime)/data[i].totalTime;\n\t\t\tvar t:number = (k - Math.floor(k))*data[i].totalTime;\n\t\t\tif (t - deltaTime <= 0) {\n\t\t\t\tvar inc:number /*int*/ = data[i].startVertexIndex*animationSubGeometry.totalLenOfOneVertex + this._particleFollowNode._iDataOffset;\n\n\t\t\t\tif (this._smooth) {\n\t\t\t\t\tthis._temp.copyFrom(rotationVelocity);\n\t\t\t\t\tthis._temp.scaleBy(t);\n\t\t\t\t\tinterpolatedRotation = this._targetEuler.add(this._temp);\n\t\t\t\t}\n\n\t\t\t\tif (vertexData[inc] != interpolatedRotation.x || vertexData[inc + 1] != interpolatedRotation.y || vertexData[inc + 2] != interpolatedRotation.z) {\n\t\t\t\t\tchanged = true;\n\t\t\t\t\tfor (var j:number /*uint*/ = 0; j < data[i].numVertices; j++) {\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.x;\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.y;\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.z;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (changed)\n\t\t\tanimationSubGeometry.invalidateBuffer();\n\n\t}\n\n\tprivate processPositionAndRotation(currentTime:number, deltaTime:number, animationSubGeometry:AnimationSubGeometry)\n\t{\n\t\tvar data:Array<ParticleAnimationData> = animationSubGeometry.animationParticles;\n\t\tvar vertexData:Array<number> = animationSubGeometry.vertexData;\n\n\t\tvar changed:boolean = false;\n\t\tvar len:number /*uint*/ = data.length;\n\n\t\tvar interpolatedPos:Vector3D;\n\t\tvar interpolatedRotation:Vector3D;\n\n\t\tvar posVelocity:Vector3D;\n\t\tvar rotationVelocity:Vector3D;\n\t\tif (this._smooth) {\n\t\t\tposVelocity = this._prePos.subtract(this._targetPos);\n\t\t\tposVelocity.scaleBy(1/deltaTime);\n\t\t\trotationVelocity = this._preEuler.subtract(this._targetEuler);\n\t\t\trotationVelocity.scaleBy(1/deltaTime);\n\t\t} else {\n\t\t\tinterpolatedPos = this._targetPos;\n\t\t\tinterpolatedRotation = this._targetEuler;\n\t\t}\n\n\t\tfor (var i:number /*uint*/ = 0; i < len; i++) {\n\t\t\tvar k:number = (currentTime - data[i].startTime)/data[i].totalTime;\n\t\t\tvar t:number = (k - Math.floor(k))*data[i].totalTime;\n\t\t\tif (t - deltaTime <= 0) {\n\t\t\t\tvar inc:number /*int*/ = data[i].startVertexIndex*animationSubGeometry.totalLenOfOneVertex + this._particleFollowNode._iDataOffset;\n\t\t\t\tif (this._smooth) {\n\t\t\t\t\tthis._temp.copyFrom(posVelocity);\n\t\t\t\t\tthis._temp.scaleBy(t);\n\t\t\t\t\tinterpolatedPos = this._targetPos.add(this._temp);\n\n\t\t\t\t\tthis._temp.copyFrom(rotationVelocity);\n\t\t\t\t\tthis._temp.scaleBy(t);\n\t\t\t\t\tinterpolatedRotation = this._targetEuler.add(this._temp);\n\t\t\t\t}\n\n\t\t\t\tif (vertexData[inc] != interpolatedPos.x || vertexData[inc + 1] != interpolatedPos.y || vertexData[inc + 2] != interpolatedPos.z || vertexData[inc + 3] != interpolatedRotation.x || vertexData[inc + 4] != interpolatedRotation.y || vertexData[inc + 5] != interpolatedRotation.z) {\n\t\t\t\t\tchanged = true;\n\t\t\t\t\tfor (var j:number /*uint*/ = 0; j < data[i].numVertices; j++) {\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.x;\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.y;\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.z;\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.x;\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.y;\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.z;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (changed)\n\t\t\tanimationSubGeometry.invalidateBuffer();\n\t}\n\n}\n\nexport = ParticleFollowState;","import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleInitialColorNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleInitialColorNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n*\n*/\nclass ParticleInitialColorState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static MULTIPLIER_INDEX:number /*uint*/ = 0;\n\t/** @private */\n\tpublic static OFFSET_INDEX:number /*uint*/ = 1;\n\n\tprivate _particleInitialColorNode:ParticleInitialColorNode;\n\tprivate _usesMultiplier:boolean;\n\tprivate _usesOffset:boolean;\n\tprivate _initialColor:ColorTransform;\n\tprivate _multiplierData:Vector3D;\n\tprivate _offsetData:Vector3D;\n\n\tconstructor(animator:ParticleAnimator, particleInitialColorNode:ParticleInitialColorNode)\n\t{\n\t\tsuper(animator, particleInitialColorNode);\n\n\t\tthis._particleInitialColorNode = particleInitialColorNode;\n\t\tthis._usesMultiplier = particleInitialColorNode._iUsesMultiplier;\n\t\tthis._usesOffset = particleInitialColorNode._iUsesOffset;\n\t\tthis._initialColor = particleInitialColorNode._iInitialColor;\n\n\t\tthis.updateColorData();\n\t}\n\n\t/**\n\t * Defines the initial color transform of the state, when in global mode.\n\t */\n\tpublic get initialColor():ColorTransform\n\t{\n\t\treturn this._initialColor;\n\t}\n\n\tpublic set initialColor(value:ColorTransform)\n\t{\n\t\tthis._initialColor = value;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\t// TODO: not used\n\t\trenderable = renderable;\n\t\tcamera = camera;\n\n\t\tif (animationRegisterCache.needFragmentAnimation) {\n\t\t\tif (this._particleInitialColorNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\n\t\t\t\tvar dataOffset:number /*uint*/ = this._particleInitialColorNode._iDataOffset;\n\t\t\t\tif (this._usesMultiplier) {\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.MULTIPLIER_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\n\t\t\t\t\tdataOffset += 4;\n\t\t\t\t}\n\t\t\t\tif (this._usesOffset)\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.OFFSET_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\n\t\t\t} else {\n\t\t\t\tif (this._usesMultiplier)\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.MULTIPLIER_INDEX), this._multiplierData.x, this._multiplierData.y, this._multiplierData.z, this._multiplierData.w);\n\t\t\t\tif (this._usesOffset)\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.OFFSET_INDEX), this._offsetData.x, this._offsetData.y, this._offsetData.z, this._offsetData.w);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate updateColorData()\n\t{\n\t\tif (this._particleInitialColorNode.mode == ParticlePropertiesMode.GLOBAL) {\n\t\t\tif (this._usesMultiplier)\n\t\t\t\tthis._multiplierData = new Vector3D(this._initialColor.redMultiplier, this._initialColor.greenMultiplier, this._initialColor.blueMultiplier, this._initialColor.alphaMultiplier);\n\t\t\tif (this._usesOffset)\n\t\t\t\tthis._offsetData = new Vector3D(this._initialColor.redOffset/255, this._initialColor.greenOffset/255, this._initialColor.blueOffset/255, this._initialColor.alphaOffset/255);\n\t\t}\n\t}\n\n}\n\nexport = ParticleInitialColorState;","import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleOrbitNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleOrbitNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n */\nclass ParticleOrbitState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static ORBIT_INDEX:number /*uint*/ = 0;\n\n\t/** @private */\n\tpublic static EULERS_INDEX:number /*uint*/ = 1;\n\n\tprivate _particleOrbitNode:ParticleOrbitNode;\n\tprivate _usesEulers:boolean;\n\tprivate _usesCycle:boolean;\n\tprivate _usesPhase:boolean;\n\tprivate _radius:number;\n\tprivate _cycleDuration:number;\n\tprivate _cyclePhase:number;\n\tprivate _eulers:Vector3D;\n\tprivate _orbitData:Vector3D;\n\tprivate _eulersMatrix:Matrix3D;\n\n\t/**\n\t * Defines the radius of the orbit when in global mode. Defaults to 100.\n\t */\n\tpublic get radius():number\n\t{\n\t\treturn this._radius;\n\t}\n\n\tpublic set radius(value:number)\n\t{\n\t\tthis._radius = value;\n\n\t\tthis.updateOrbitData();\n\t}\n\n\t/**\n\t * Defines the duration of the orbit in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\n\t */\n\tpublic get cycleDuration():number\n\t{\n\t\treturn this._cycleDuration;\n\t}\n\n\tpublic set cycleDuration(value:number)\n\t{\n\t\tthis._cycleDuration = value;\n\n\t\tthis.updateOrbitData();\n\t}\n\n\t/**\n\t * Defines the phase of the orbit in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\n\t */\n\tpublic get cyclePhase():number\n\t{\n\t\treturn this._cyclePhase;\n\t}\n\n\tpublic set cyclePhase(value:number)\n\t{\n\t\tthis._cyclePhase = value;\n\n\t\tthis.updateOrbitData();\n\t}\n\n\t/**\n\t * Defines the euler rotation in degrees, applied to the orientation of the orbit when in global mode.\n\t */\n\tpublic get eulers():Vector3D\n\t{\n\t\treturn this._eulers;\n\t}\n\n\tpublic set eulers(value:Vector3D)\n\t{\n\t\tthis._eulers = value;\n\n\t\tthis.updateOrbitData();\n\n\t}\n\n\tconstructor(animator:ParticleAnimator, particleOrbitNode:ParticleOrbitNode)\n\t{\n\t\tsuper(animator, particleOrbitNode);\n\n\t\tthis._particleOrbitNode = particleOrbitNode;\n\t\tthis._usesEulers = this._particleOrbitNode._iUsesEulers;\n\t\tthis._usesCycle = this._particleOrbitNode._iUsesCycle;\n\t\tthis._usesPhase = this._particleOrbitNode._iUsesPhase;\n\t\tthis._eulers = this._particleOrbitNode._iEulers;\n\t\tthis._radius = this._particleOrbitNode._iRadius;\n\t\tthis._cycleDuration = this._particleOrbitNode._iCycleDuration;\n\t\tthis._cyclePhase = this._particleOrbitNode._iCyclePhase;\n\t\tthis.updateOrbitData();\n\t}\n\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleOrbitState.ORBIT_INDEX);\n\n\t\tif (this._particleOrbitNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\n\t\t\tif (this._usesPhase)\n\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleOrbitNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\n\t\t\telse\n\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleOrbitNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\n\t\t} else\n\t\t\tanimationRegisterCache.setVertexConst(index, this._orbitData.x, this._orbitData.y, this._orbitData.z, this._orbitData.w);\n\n\t\tif (this._usesEulers)\n\t\t\tanimationRegisterCache.setVertexConstFromMatrix(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleOrbitState.EULERS_INDEX), this._eulersMatrix);\n\t}\n\n\tprivate updateOrbitData()\n\t{\n\t\tif (this._usesEulers) {\n\t\t\tthis._eulersMatrix = new Matrix3D();\n\t\t\tthis._eulersMatrix.appendRotation(this._eulers.x, Vector3D.X_AXIS);\n\t\t\tthis._eulersMatrix.appendRotation(this._eulers.y, Vector3D.Y_AXIS);\n\t\t\tthis._eulersMatrix.appendRotation(this._eulers.z, Vector3D.Z_AXIS);\n\t\t}\n\t\tif (this._particleOrbitNode.mode == ParticlePropertiesMode.GLOBAL) {\n\t\t\tthis._orbitData = new Vector3D(this._radius, 0, this._radius*Math.PI*2, this._cyclePhase*Math.PI/180);\n\t\t\tif (this._usesCycle) {\n\t\t\t\tif (this._cycleDuration <= 0)\n\t\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\n\t\t\t\tthis._orbitData.y = Math.PI*2/this._cycleDuration;\n\t\t\t} else\n\t\t\t\tthis._orbitData.y = Math.PI*2;\n\t\t}\n\t}\n}\n\nexport = ParticleOrbitState;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleOscillatorNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleOscillatorNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n */\nclass ParticleOscillatorState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static OSCILLATOR_INDEX:number /*uint*/ = 0;\n\n\tprivate _particleOscillatorNode:ParticleOscillatorNode;\n\tprivate _oscillator:Vector3D;\n\tprivate _oscillatorData:Vector3D;\n\n\t/**\n\t * Defines the default oscillator axis (x, y, z) and cycleDuration (w) of the state, used when in global mode.\n\t */\n\tpublic get oscillator():Vector3D\n\t{\n\t\treturn this._oscillator;\n\t}\n\n\tpublic set oscillator(value:Vector3D)\n\t{\n\t\tthis._oscillator = value;\n\n\t\tthis.updateOscillatorData();\n\t}\n\n\tconstructor(animator:ParticleAnimator, particleOscillatorNode:ParticleOscillatorNode)\n\t{\n\t\tsuper(animator, particleOscillatorNode);\n\n\t\tthis._particleOscillatorNode = particleOscillatorNode;\n\t\tthis._oscillator = this._particleOscillatorNode._iOscillator;\n\n\t\tthis.updateOscillatorData();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleOscillatorState.OSCILLATOR_INDEX);\n\n\t\tif (this._particleOscillatorNode.mode == ParticlePropertiesMode.LOCAL_STATIC)\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleOscillatorNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\n\t\telse\n\t\t\tanimationRegisterCache.setVertexConst(index, this._oscillatorData.x, this._oscillatorData.y, this._oscillatorData.z, this._oscillatorData.w);\n\t}\n\n\tprivate updateOscillatorData()\n\t{\n\t\tif (this._particleOscillatorNode.mode == ParticlePropertiesMode.GLOBAL) {\n\t\t\tif (this._oscillator.w <= 0)\n\t\t\t\tthrow(new Error(\"the cycle duration must greater than zero\"));\n\n\t\t\tif (this._oscillatorData == null)\n\t\t\t\tthis._oscillatorData = new Vector3D();\n\n\t\t\tthis._oscillatorData.x = this._oscillator.x;\n\t\t\tthis._oscillatorData.y = this._oscillator.y;\n\t\t\tthis._oscillatorData.z = this._oscillator.z;\n\t\t\tthis._oscillatorData.w = Math.PI*2/this._oscillator.w;\n\t\t}\n\t}\n}\n\nexport = ParticleOscillatorState;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticlePositionNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticlePositionNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n * @author ...\n */\nclass ParticlePositionState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static POSITION_INDEX:number /*uint*/ = 0;\n\n\tprivate _particlePositionNode:ParticlePositionNode;\n\tprivate _position:Vector3D;\n\n\t/**\n\t * Defines the position of the particle when in global mode. Defaults to 0,0,0.\n\t */\n\tpublic get position():Vector3D\n\t{\n\t\treturn this._position;\n\t}\n\n\tpublic set position(value:Vector3D)\n\t{\n\t\tthis._position = value;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic getPositions():Array<Vector3D>\n\t{\n\t\treturn this._pDynamicProperties;\n\t}\n\n\tpublic setPositions(value:Array<Vector3D>)\n\t{\n\t\tthis._pDynamicProperties = value;\n\n\t\tthis._pDynamicPropertiesDirty = new Object();\n\t}\n\n\tconstructor(animator:ParticleAnimator, particlePositionNode:ParticlePositionNode)\n\t{\n\t\tsuper(animator, particlePositionNode);\n\n\t\tthis._particlePositionNode = particlePositionNode;\n\t\tthis._position = this._particlePositionNode._iPosition;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tif (this._particlePositionNode.mode == ParticlePropertiesMode.LOCAL_DYNAMIC && !this._pDynamicPropertiesDirty[animationSubGeometry._iUniqueId])\n\t\t\tthis._pUpdateDynamicProperties(animationSubGeometry);\n\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticlePositionState.POSITION_INDEX);\n\n\t\tif (this._particlePositionNode.mode == ParticlePropertiesMode.GLOBAL)\n\t\t\tanimationRegisterCache.setVertexConst(index, this._position.x, this._position.y, this._position.z);\n\t\telse\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particlePositionNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\n\t}\n}\n\nexport = ParticlePositionState;","import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport ParticleRotateToHeadingNode\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleRotateToHeadingNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n */\nclass ParticleRotateToHeadingState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static MATRIX_INDEX:number /*int*/ = 0;\n\n\tprivate _matrix:Matrix3D = new Matrix3D();\n\n\tconstructor(animator:ParticleAnimator, particleNode:ParticleNodeBase)\n\t{\n\t\tsuper(animator, particleNode);\n\t}\n\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tif (animationRegisterCache.hasBillboard) {\n\t\t\tthis._matrix.copyFrom(renderable.sourceEntity.sceneTransform);\n\t\t\tthis._matrix.append(camera.inverseSceneTransform);\n\t\t\tanimationRegisterCache.setVertexConstFromMatrix(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleRotateToHeadingState.MATRIX_INDEX), this._matrix);\n\t\t}\n\t}\n\n}\n\nexport = ParticleRotateToHeadingState;","import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleRotateToPositionNode\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleRotateToPositionNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n */\nclass ParticleRotateToPositionState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static MATRIX_INDEX:number /*int*/ = 0;\n\t/** @private */\n\tpublic static POSITION_INDEX:number /*int*/ = 1;\n\n\tprivate _particleRotateToPositionNode:ParticleRotateToPositionNode;\n\tprivate _position:Vector3D;\n\tprivate _matrix:Matrix3D = new Matrix3D();\n\tprivate _offset:Vector3D;\n\n\t/**\n\t * Defines the position of the point the particle will rotate to face when in global mode. Defaults to 0,0,0.\n\t */\n\tpublic get position():Vector3D\n\t{\n\t\treturn this._position;\n\t}\n\n\tpublic set position(value:Vector3D)\n\t{\n\t\tthis._position = value;\n\t}\n\n\tconstructor(animator:ParticleAnimator, particleRotateToPositionNode:ParticleRotateToPositionNode)\n\t{\n\t\tsuper(animator, particleRotateToPositionNode);\n\n\t\tthis._particleRotateToPositionNode = particleRotateToPositionNode;\n\t\tthis._position = this._particleRotateToPositionNode._iPosition;\n\t}\n\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleRotateToPositionState.POSITION_INDEX);\n\n\t\tif (animationRegisterCache.hasBillboard) {\n\t\t\tthis._matrix.copyFrom(renderable.sourceEntity.sceneTransform);\n\t\t\tthis._matrix.append(camera.inverseSceneTransform);\n\t\t\tanimationRegisterCache.setVertexConstFromMatrix(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleRotateToPositionState.MATRIX_INDEX), this._matrix);\n\t\t}\n\n\t\tif (this._particleRotateToPositionNode.mode == ParticlePropertiesMode.GLOBAL) {\n\t\t\tthis._offset = renderable.sourceEntity.inverseSceneTransform.transformVector(this._position);\n\t\t\tanimationRegisterCache.setVertexConst(index, this._offset.x, this._offset.y, this._offset.z);\n\t\t} else\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleRotateToPositionNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\n\n\t}\n\n}\n\nexport = ParticleRotateToPositionState;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleRotationalVelocityNode\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleRotationalVelocityNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n */\nclass ParticleRotationalVelocityState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static ROTATIONALVELOCITY_INDEX:number /*uint*/ = 0;\n\n\tprivate _particleRotationalVelocityNode:ParticleRotationalVelocityNode;\n\tprivate _rotationalVelocityData:Vector3D;\n\tprivate _rotationalVelocity:Vector3D;\n\n\t/**\n\t * Defines the default rotationalVelocity of the state, used when in global mode.\n\t */\n\tpublic get rotationalVelocity():Vector3D\n\t{\n\t\treturn this._rotationalVelocity;\n\t}\n\n\tpublic set rotationalVelocity(value:Vector3D)\n\t{\n\t\tthis._rotationalVelocity = value;\n\n\t\tthis.updateRotationalVelocityData();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic getRotationalVelocities():Array<Vector3D>\n\t{\n\t\treturn this._pDynamicProperties;\n\t}\n\n\tpublic setRotationalVelocities(value:Array<Vector3D>)\n\t{\n\t\tthis._pDynamicProperties = value;\n\n\t\tthis._pDynamicPropertiesDirty = new Object();\n\t}\n\n\tconstructor(animator:ParticleAnimator, particleRotationNode:ParticleRotationalVelocityNode)\n\t{\n\t\tsuper(animator, particleRotationNode);\n\n\t\tthis._particleRotationalVelocityNode = particleRotationNode;\n\t\tthis._rotationalVelocity = this._particleRotationalVelocityNode._iRotationalVelocity;\n\n\t\tthis.updateRotationalVelocityData();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tif (this._particleRotationalVelocityNode.mode == ParticlePropertiesMode.LOCAL_DYNAMIC && !this._pDynamicPropertiesDirty[animationSubGeometry._iUniqueId])\n\t\t\tthis._pUpdateDynamicProperties(animationSubGeometry);\n\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleRotationalVelocityState.ROTATIONALVELOCITY_INDEX);\n\n\t\tif (this._particleRotationalVelocityNode.mode == ParticlePropertiesMode.GLOBAL)\n\t\t\tanimationRegisterCache.setVertexConst(index, this._rotationalVelocityData.x, this._rotationalVelocityData.y, this._rotationalVelocityData.z, this._rotationalVelocityData.w);\n\t\telse\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleRotationalVelocityNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\n\t}\n\n\tprivate updateRotationalVelocityData()\n\t{\n\t\tif (this._particleRotationalVelocityNode.mode == ParticlePropertiesMode.GLOBAL) {\n\t\t\tif (this._rotationalVelocity.w <= 0)\n\t\t\t\tthrow(new Error(\"the cycle duration must greater than zero\"));\n\t\t\tvar rotation:Vector3D = this._rotationalVelocity.clone();\n\n\t\t\tif (rotation.length <= 0)\n\t\t\t\trotation.z = 1; //set the default direction\n\t\t\telse\n\t\t\t\trotation.normalize();\n\t\t\t// w is used as angle/2 in agal\n\t\t\tthis._rotationalVelocityData = new Vector3D(rotation.x, rotation.y, rotation.z, Math.PI/rotation.w);\n\t\t}\n\t}\n}\n\nexport = ParticleRotationalVelocityState;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleScaleNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleScaleNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n */\nclass ParticleScaleState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static SCALE_INDEX:number /*uint*/ = 0;\n\n\tprivate _particleScaleNode:ParticleScaleNode;\n\tprivate _usesCycle:boolean;\n\tprivate _usesPhase:boolean;\n\tprivate _minScale:number;\n\tprivate _maxScale:number;\n\tprivate _cycleDuration:number;\n\tprivate _cyclePhase:number;\n\tprivate _scaleData:Vector3D;\n\n\t/**\n\t * Defines the end scale of the state, when in global mode. Defaults to 1.\n\t */\n\tpublic get minScale():number\n\t{\n\t\treturn this._minScale;\n\t}\n\n\tpublic set minScale(value:number)\n\t{\n\t\tthis._minScale = value;\n\n\t\tthis.updateScaleData();\n\t}\n\n\t/**\n\t * Defines the end scale of the state, when in global mode. Defaults to 1.\n\t */\n\tpublic get maxScale():number\n\t{\n\t\treturn this._maxScale;\n\t}\n\n\tpublic set maxScale(value:number)\n\t{\n\t\tthis._maxScale = value;\n\n\t\tthis.updateScaleData();\n\t}\n\n\t/**\n\t * Defines the duration of the animation in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\n\t */\n\tpublic get cycleDuration():number\n\t{\n\t\treturn this._cycleDuration;\n\t}\n\n\tpublic set cycleDuration(value:number)\n\t{\n\t\tthis._cycleDuration = value;\n\n\t\tthis.updateScaleData();\n\t}\n\n\t/**\n\t * Defines the phase of the cycle in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\n\t */\n\tpublic get cyclePhase():number\n\t{\n\t\treturn this._cyclePhase;\n\t}\n\n\tpublic set cyclePhase(value:number)\n\t{\n\t\tthis._cyclePhase = value;\n\n\t\tthis.updateScaleData();\n\t}\n\n\tconstructor(animator:ParticleAnimator, particleScaleNode:ParticleScaleNode)\n\t{\n\t\tsuper(animator, particleScaleNode);\n\n\t\tthis._particleScaleNode = particleScaleNode;\n\t\tthis._usesCycle = this._particleScaleNode._iUsesCycle;\n\t\tthis._usesPhase = this._particleScaleNode._iUsesPhase;\n\t\tthis._minScale = this._particleScaleNode._iMinScale;\n\t\tthis._maxScale = this._particleScaleNode._iMaxScale;\n\t\tthis._cycleDuration = this._particleScaleNode._iCycleDuration;\n\t\tthis._cyclePhase = this._particleScaleNode._iCyclePhase;\n\n\t\tthis.updateScaleData();\n\t}\n\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleScaleState.SCALE_INDEX);\n\n\t\tif (this._particleScaleNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\n\t\t\tif (this._usesCycle) {\n\t\t\t\tif (this._usesPhase)\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleScaleNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\n\t\t\t\telse\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleScaleNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\n\t\t\t} else\n\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleScaleNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_2);\n\t\t} else\n\t\t\tanimationRegisterCache.setVertexConst(index, this._scaleData.x, this._scaleData.y, this._scaleData.z, this._scaleData.w);\n\t}\n\n\tprivate updateScaleData()\n\t{\n\t\tif (this._particleScaleNode.mode == ParticlePropertiesMode.GLOBAL) {\n\t\t\tif (this._usesCycle) {\n\t\t\t\tif (this._cycleDuration <= 0)\n\t\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\n\t\t\t\tthis._scaleData = new Vector3D((this._minScale + this._maxScale)/2, Math.abs(this._minScale - this._maxScale)/2, Math.PI*2/this._cycleDuration, this._cyclePhase*Math.PI/180);\n\t\t\t} else\n\t\t\t\tthis._scaleData = new Vector3D(this._minScale, this._maxScale - this._minScale, 0, 0);\n\t\t}\n\t}\n}\n\nexport = ParticleScaleState;","import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ColorSegmentPoint\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ColorSegmentPoint\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleSegmentedColorNode\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleSegmentedColorNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n *\n */\nclass ParticleSegmentedColorState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static START_MULTIPLIER_INDEX:number /*uint*/ = 0;\n\n\t/** @private */\n\tpublic static START_OFFSET_INDEX:number /*uint*/ = 1;\n\n\t/** @private */\n\tpublic static TIME_DATA_INDEX:number /*uint*/ = 2;\n\n\tprivate _usesMultiplier:boolean;\n\tprivate _usesOffset:boolean;\n\tprivate _startColor:ColorTransform;\n\tprivate _endColor:ColorTransform;\n\tprivate _segmentPoints:Array<ColorSegmentPoint>;\n\tprivate _numSegmentPoint:number /*int*/;\n\n\tprivate _timeLifeData:Array<number>;\n\tprivate _multiplierData:Array<number>;\n\tprivate _offsetData:Array<number>;\n\n\t/**\n\t * Defines the start color transform of the state, when in global mode.\n\t */\n\tpublic get startColor():ColorTransform\n\t{\n\t\treturn this._startColor;\n\t}\n\n\tpublic set startColor(value:ColorTransform)\n\t{\n\t\tthis._startColor = value;\n\n\t\tthis.updateColorData();\n\t}\n\n\t/**\n\t * Defines the end color transform of the state, when in global mode.\n\t */\n\tpublic get endColor():ColorTransform\n\t{\n\t\treturn this._endColor;\n\t}\n\n\tpublic set endColor(value:ColorTransform)\n\t{\n\t\tthis._endColor = value;\n\t\tthis.updateColorData();\n\t}\n\n\t/**\n\t * Defines the number of segments.\n\t */\n\tpublic get numSegmentPoint():number /*int*/\n\t{\n\t\treturn this._numSegmentPoint;\n\t}\n\n\t/**\n\t * Defines the key points of color\n\t */\n\tpublic get segmentPoints():Array<ColorSegmentPoint>\n\t{\n\t\treturn this._segmentPoints;\n\t}\n\n\tpublic set segmentPoints(value:Array<ColorSegmentPoint>)\n\t{\n\t\tthis._segmentPoints = value;\n\t\tthis.updateColorData();\n\t}\n\n\tpublic get usesMultiplier():boolean\n\t{\n\t\treturn this._usesMultiplier;\n\t}\n\n\tpublic get usesOffset():boolean\n\t{\n\t\treturn this._usesOffset;\n\t}\n\n\tconstructor(animator:ParticleAnimator, particleSegmentedColorNode:ParticleSegmentedColorNode)\n\t{\n\t\tsuper(animator, particleSegmentedColorNode);\n\n\t\tthis._usesMultiplier = particleSegmentedColorNode._iUsesMultiplier;\n\t\tthis._usesOffset = particleSegmentedColorNode._iUsesOffset;\n\t\tthis._startColor = particleSegmentedColorNode._iStartColor;\n\t\tthis._endColor = particleSegmentedColorNode._iEndColor;\n\t\tthis._segmentPoints = particleSegmentedColorNode._iSegmentPoints;\n\t\tthis._numSegmentPoint = particleSegmentedColorNode._iNumSegmentPoint;\n\t\tthis.updateColorData();\n\t}\n\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tif (animationRegisterCache.needFragmentAnimation) {\n\t\t\tif (this._numSegmentPoint > 0)\n\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleSegmentedColorState.TIME_DATA_INDEX), this._timeLifeData[0], this._timeLifeData[1], this._timeLifeData[2], this._timeLifeData[3]);\n\t\t\tif (this._usesMultiplier)\n\t\t\t\tanimationRegisterCache.setVertexConstFromArray(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleSegmentedColorState.START_MULTIPLIER_INDEX), this._multiplierData);\n\t\t\tif (this._usesOffset)\n\t\t\t\tanimationRegisterCache.setVertexConstFromArray(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleSegmentedColorState.START_OFFSET_INDEX), this._offsetData);\n\t\t}\n\t}\n\n\tprivate updateColorData()\n\t{\n\t\tthis._timeLifeData = new Array<number>();\n\t\tthis._multiplierData = new Array<number>();\n\t\tthis._offsetData = new Array<number>();\n\t\tvar i:number /*int*/;\n\t\tfor (i = 0; i < this._numSegmentPoint; i++) {\n\t\t\tif (i == 0)\n\t\t\t\tthis._timeLifeData.push(this._segmentPoints[i].life);\n\t\t\telse\n\t\t\t\tthis._timeLifeData.push(this._segmentPoints[i].life - this._segmentPoints[i - 1].life);\n\t\t}\n\t\tif (this._numSegmentPoint == 0)\n\t\t\tthis._timeLifeData.push(1);\n\t\telse\n\t\t\tthis._timeLifeData.push(1 - this._segmentPoints[i - 1].life);\n\n\t\tif (this._usesMultiplier) {\n\t\t\tthis._multiplierData.push(this._startColor.redMultiplier, this._startColor.greenMultiplier, this._startColor.blueMultiplier, this._startColor.alphaMultiplier);\n\t\t\tfor (i = 0; i < this._numSegmentPoint; i++) {\n\t\t\t\tif (i == 0)\n\t\t\t\t\tthis._multiplierData.push((this._segmentPoints[i].color.redMultiplier - this._startColor.redMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.greenMultiplier - this._startColor.greenMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.blueMultiplier - this._startColor.blueMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.alphaMultiplier - this._startColor.alphaMultiplier)/this._timeLifeData[i]);\n\t\t\t\telse\n\t\t\t\t\tthis._multiplierData.push((this._segmentPoints[i].color.redMultiplier - this._segmentPoints[i - 1].color.redMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.greenMultiplier - this._segmentPoints[i - 1].color.greenMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.blueMultiplier - this._segmentPoints[i - 1].color.blueMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.alphaMultiplier - this._segmentPoints[i - 1].color.alphaMultiplier)/this._timeLifeData[i]);\n\t\t\t}\n\t\t\tif (this._numSegmentPoint == 0)\n\t\t\t\tthis._multiplierData.push(this._endColor.redMultiplier - this._startColor.redMultiplier, this._endColor.greenMultiplier - this._startColor.greenMultiplier, this._endColor.blueMultiplier - this._startColor.blueMultiplier, this._endColor.alphaMultiplier - this._startColor.alphaMultiplier);\n\t\t\telse\n\t\t\t\tthis._multiplierData.push((this._endColor.redMultiplier - this._segmentPoints[i - 1].color.redMultiplier)/this._timeLifeData[i], (this._endColor.greenMultiplier - this._segmentPoints[i - 1].color.greenMultiplier)/this._timeLifeData[i], (this._endColor.blueMultiplier - this._segmentPoints[i - 1].color.blueMultiplier)/this._timeLifeData[i], (this._endColor.alphaMultiplier - this._segmentPoints[i - 1].color.alphaMultiplier)/this._timeLifeData[i]);\n\t\t}\n\n\t\tif (this._usesOffset) {\n\t\t\tthis._offsetData.push(this._startColor.redOffset/255, this._startColor.greenOffset/255, this._startColor.blueOffset/255, this._startColor.alphaOffset/255);\n\t\t\tfor (i = 0; i < this._numSegmentPoint; i++) {\n\t\t\t\tif (i == 0)\n\t\t\t\t\tthis._offsetData.push((this._segmentPoints[i].color.redOffset - this._startColor.redOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.greenOffset - this._startColor.greenOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.blueOffset - this._startColor.blueOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.alphaOffset - this._startColor.alphaOffset)/this._timeLifeData[i]/255);\n\t\t\t\telse\n\t\t\t\t\tthis._offsetData.push((this._segmentPoints[i].color.redOffset - this._segmentPoints[i - 1].color.redOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.greenOffset - this._segmentPoints[i - 1].color.greenOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.blueOffset - this._segmentPoints[i - 1].color.blueOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.alphaOffset - this._segmentPoints[i - 1].color.alphaOffset)/this._timeLifeData[i]/255);\n\t\t\t}\n\t\t\tif (this._numSegmentPoint == 0)\n\t\t\t\tthis._offsetData.push((this._endColor.redOffset - this._startColor.redOffset)/255, (this._endColor.greenOffset - this._startColor.greenOffset)/255, (this._endColor.blueOffset - this._startColor.blueOffset)/255, (this._endColor.alphaOffset - this._startColor.alphaOffset)/255);\n\t\t\telse\n\t\t\t\tthis._offsetData.push((this._endColor.redOffset - this._segmentPoints[i - 1].color.redOffset)/this._timeLifeData[i]/255, (this._endColor.greenOffset - this._segmentPoints[i - 1].color.greenOffset)/this._timeLifeData[i]/255, (this._endColor.blueOffset - this._segmentPoints[i - 1].color.blueOffset)/this._timeLifeData[i]/255, (this._endColor.alphaOffset - this._segmentPoints[i - 1].color.alphaOffset)/this._timeLifeData[i]/255);\n\t\t}\n\t\t//cut off the data\n\t\tthis._timeLifeData.length = 4;\n\t}\n}\n\nexport = ParticleSegmentedColorState;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleSpriteSheetNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleSpriteSheetNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n */\nclass ParticleSpriteSheetState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static UV_INDEX_0:number /*uint*/ = 0;\n\n\t/** @private */\n\tpublic static UV_INDEX_1:number /*uint*/ = 1;\n\n\tprivate _particleSpriteSheetNode:ParticleSpriteSheetNode;\n\tprivate _usesCycle:boolean;\n\tprivate _usesPhase:boolean;\n\tprivate _totalFrames:number /*int*/;\n\tprivate _numColumns:number /*int*/;\n\tprivate _numRows:number /*int*/;\n\tprivate _cycleDuration:number;\n\tprivate _cyclePhase:number;\n\tprivate _spriteSheetData:Array<number>;\n\n\t/**\n\t * Defines the cycle phase, when in global mode. Defaults to zero.\n\t */\n\tpublic get cyclePhase():number\n\t{\n\t\treturn this._cyclePhase;\n\t}\n\n\tpublic set cyclePhase(value:number)\n\t{\n\t\tthis._cyclePhase = value;\n\n\t\tthis.updateSpriteSheetData();\n\t}\n\n\t/**\n\t * Defines the cycle duration in seconds, when in global mode. Defaults to 1.\n\t */\n\tpublic get cycleDuration():number\n\t{\n\t\treturn this._cycleDuration;\n\t}\n\n\tpublic set cycleDuration(value:number)\n\t{\n\t\tthis._cycleDuration = value;\n\n\t\tthis.updateSpriteSheetData();\n\t}\n\n\tconstructor(animator:ParticleAnimator, particleSpriteSheetNode:ParticleSpriteSheetNode)\n\t{\n\t\tsuper(animator, particleSpriteSheetNode);\n\n\t\tthis._particleSpriteSheetNode = particleSpriteSheetNode;\n\n\t\tthis._usesCycle = this._particleSpriteSheetNode._iUsesCycle;\n\t\tthis._usesPhase = this._particleSpriteSheetNode._iUsesCycle;\n\t\tthis._totalFrames = this._particleSpriteSheetNode._iTotalFrames;\n\t\tthis._numColumns = this._particleSpriteSheetNode._iNumColumns;\n\t\tthis._numRows = this._particleSpriteSheetNode._iNumRows;\n\t\tthis._cycleDuration = this._particleSpriteSheetNode._iCycleDuration;\n\t\tthis._cyclePhase = this._particleSpriteSheetNode._iCyclePhase;\n\n\t\tthis.updateSpriteSheetData();\n\t}\n\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tif (animationRegisterCache.needUVAnimation) {\n\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleSpriteSheetState.UV_INDEX_0), this._spriteSheetData[0], this._spriteSheetData[1], this._spriteSheetData[2], this._spriteSheetData[3]);\n\t\t\tif (this._usesCycle) {\n\t\t\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleSpriteSheetState.UV_INDEX_1);\n\t\t\t\tif (this._particleSpriteSheetNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\n\t\t\t\t\tif (this._usesPhase)\n\t\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleSpriteSheetNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\n\t\t\t\t\telse\n\t\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleSpriteSheetNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_2);\n\t\t\t\t} else\n\t\t\t\t\tanimationRegisterCache.setVertexConst(index, this._spriteSheetData[4], this._spriteSheetData[5]);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate updateSpriteSheetData()\n\t{\n\t\tthis._spriteSheetData = new Array<number>(8);\n\n\t\tvar uTotal:number = this._totalFrames/this._numColumns;\n\n\t\tthis._spriteSheetData[0] = uTotal;\n\t\tthis._spriteSheetData[1] = 1/this._numColumns;\n\t\tthis._spriteSheetData[2] = 1/this._numRows;\n\n\t\tif (this._usesCycle) {\n\t\t\tif (this._cycleDuration <= 0)\n\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\n\t\t\tthis._spriteSheetData[4] = uTotal/this._cycleDuration;\n\t\t\tthis._spriteSheetData[5] = this._cycleDuration;\n\t\t\tif (this._usesPhase)\n\t\t\t\tthis._spriteSheetData[6] = this._cyclePhase;\n\t\t}\n\t}\n}\n\nexport = ParticleSpriteSheetState;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticleAnimationData\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleAnimationData\");\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n */\nclass ParticleStateBase extends AnimationStateBase\n{\n\tprivate _particleNode:ParticleNodeBase;\n\n\tpublic _pDynamicProperties:Array<Vector3D> = new Array<Vector3D>();\n\tpublic _pDynamicPropertiesDirty:Object = new Object();\n\n\tpublic _pNeedUpdateTime:boolean;\n\n\tconstructor(animator:ParticleAnimator, particleNode:ParticleNodeBase, needUpdateTime:boolean = false)\n\t{\n\t\tsuper(animator, particleNode);\n\n\t\tthis._particleNode = particleNode;\n\t\tthis._pNeedUpdateTime = needUpdateTime;\n\t}\n\n\tpublic get needUpdateTime():boolean\n\t{\n\t\treturn this._pNeedUpdateTime;\n\t}\n\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\n\t}\n\n\tpublic _pUpdateDynamicProperties(animationSubGeometry:AnimationSubGeometry)\n\t{\n\t\tthis._pDynamicPropertiesDirty[animationSubGeometry._iUniqueId] = true;\n\n\t\tvar animationParticles:Array<ParticleAnimationData> = animationSubGeometry.animationParticles;\n\t\tvar vertexData:Array<number> = animationSubGeometry.vertexData;\n\t\tvar totalLenOfOneVertex:number /*uint*/ = animationSubGeometry.totalLenOfOneVertex;\n\t\tvar dataLength:number /*uint*/ = this._particleNode.dataLength;\n\t\tvar dataOffset:number /*uint*/ = this._particleNode._iDataOffset;\n\t\tvar vertexLength:number /*uint*/;\n\t\t//\t\t\tvar particleOffset:number /*uint*/;\n\t\tvar startingOffset:number /*uint*/;\n\t\tvar vertexOffset:number /*uint*/;\n\t\tvar data:Vector3D;\n\t\tvar animationParticle:ParticleAnimationData;\n\n\t\t//\t\t\tvar numParticles:number /*uint*/ = _positions.length/dataLength;\n\t\tvar numParticles:number /*uint*/ = this._pDynamicProperties.length;\n\t\tvar i:number /*uint*/ = 0;\n\t\tvar j:number /*uint*/ = 0;\n\t\tvar k:number /*uint*/ = 0;\n\n\t\t//loop through all particles\n\t\twhile (i < numParticles) {\n\t\t\t//loop through each particle data for the current particle\n\t\t\twhile (j < numParticles && (animationParticle = animationParticles[j]).index == i) {\n\t\t\t\tdata = this._pDynamicProperties[i];\n\t\t\t\tvertexLength = animationParticle.numVertices*totalLenOfOneVertex;\n\t\t\t\tstartingOffset = animationParticle.startVertexIndex*totalLenOfOneVertex + dataOffset;\n\t\t\t\t//loop through each vertex in the particle data\n\t\t\t\tfor (k = 0; k < vertexLength; k += totalLenOfOneVertex) {\n\t\t\t\t\tvertexOffset = startingOffset + k;\n\t\t\t\t\t//\t\t\t\t\t\tparticleOffset = i * dataLength;\n\t\t\t\t\t//loop through all vertex data for the current particle data\n\t\t\t\t\tfor (k = 0; k < vertexLength; k += totalLenOfOneVertex) {\n\t\t\t\t\t\tvertexOffset = startingOffset + k;\n\t\t\t\t\t\tvertexData[vertexOffset++] = data.x;\n\t\t\t\t\t\tvertexData[vertexOffset++] = data.y;\n\t\t\t\t\t\tvertexData[vertexOffset++] = data.z;\n\n\t\t\t\t\t\tif (dataLength == 4)\n\t\t\t\t\t\t\tvertexData[vertexOffset++] = data.w;\n\t\t\t\t\t}\n\t\t\t\t\t\t//loop through each value in the particle vertex\n\t\t\t\t\t\t//\t\t\t\t\t\tswitch(dataLength) {\n\t\t\t\t\t\t//\t\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t//\t\t\t\t\t\t\t\tvertexData[vertexOffset++] = _positions[particleOffset++];\n\t\t\t\t\t\t//\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t//\t\t\t\t\t\t\t\tvertexData[vertexOffset++] = _positions[particleOffset++];\n\t\t\t\t\t\t//\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t//\t\t\t\t\t\t\t\tvertexData[vertexOffset++] = _positions[particleOffset++];\n\t\t\t\t\t\t//\t\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t//\t\t\t\t\t\t\t\tvertexData[vertexOffset++] = _positions[particleOffset++];\n\t\t\t\t\t\t//\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tj++;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\n\t\tanimationSubGeometry.invalidateBuffer();\n\t}\n\n}\n\nexport = ParticleStateBase;","import Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleTimeNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n */\nclass ParticleTimeState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static TIME_STREAM_INDEX:number /*uint*/ = 0;\n\n\t/** @private */\n\tpublic static TIME_CONSTANT_INDEX:number /*uint*/ = 1;\n\n\tprivate _particleTimeNode:ParticleTimeNode;\n\n\tconstructor(animator:ParticleAnimator, particleTimeNode:ParticleTimeNode)\n\t{\n\t\tsuper(animator, particleTimeNode, true);\n\n\t\tthis._particleTimeNode = particleTimeNode;\n\t}\n\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleTimeState.TIME_STREAM_INDEX), this._particleTimeNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\n\n\t\tvar particleTime:number = this._pTime/1000;\n\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleTimeState.TIME_CONSTANT_INDEX), particleTime, particleTime, particleTime, particleTime);\n\t}\n\n}\n\nexport = ParticleTimeState;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticleUVNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleUVNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n */\nclass ParticleUVState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static UV_INDEX:number /*uint*/ = 0;\n\n\tprivate _particleUVNode:ParticleUVNode;\n\n\tconstructor(animator:ParticleAnimator, particleUVNode:ParticleUVNode)\n\t{\n\t\tsuper(animator, particleUVNode);\n\n\t\tthis._particleUVNode = particleUVNode;\n\t}\n\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tif (animationRegisterCache.needUVAnimation) {\n\t\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleUVState.UV_INDEX);\n\t\t\tvar data:Vector3D = this._particleUVNode._iUvData;\n\t\t\tanimationRegisterCache.setVertexConst(index, data.x, data.y);\n\t\t}\n\t}\n\n}\n\nexport = ParticleUVState;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\n\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\nimport ParticleVelocityNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleVelocityNode\");\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * ...\n */\nclass ParticleVelocityState extends ParticleStateBase\n{\n\t/** @private */\n\tpublic static VELOCITY_INDEX:number /*int*/ = 0;\n\n\tprivate _particleVelocityNode:ParticleVelocityNode;\n\tprivate _velocity:Vector3D;\n\n\t/**\n\t * Defines the default velocity vector of the state, used when in global mode.\n\t */\n\tpublic get velocity():Vector3D\n\t{\n\t\treturn this._velocity;\n\t}\n\n\tpublic set velocity(value:Vector3D)\n\t{\n\t\tthis._velocity = value;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic getVelocities():Array<Vector3D>\n\t{\n\t\treturn this._pDynamicProperties;\n\t}\n\n\tpublic setVelocities(value:Array<Vector3D>)\n\t{\n\t\tthis._pDynamicProperties = value;\n\n\t\tthis._pDynamicPropertiesDirty = new Object();\n\t}\n\n\tconstructor(animator:ParticleAnimator, particleVelocityNode:ParticleVelocityNode)\n\t{\n\t\tsuper(animator, particleVelocityNode);\n\n\t\tthis._particleVelocityNode = particleVelocityNode;\n\t\tthis._velocity = this._particleVelocityNode._iVelocity;\n\t}\n\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\n\t{\n\t\tif (this._particleVelocityNode.mode == ParticlePropertiesMode.LOCAL_DYNAMIC && !this._pDynamicPropertiesDirty[animationSubGeometry._iUniqueId])\n\t\t\tthis._pUpdateDynamicProperties(animationSubGeometry);\n\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleVelocityState.VELOCITY_INDEX);\n\n\t\tif (this._particleVelocityNode.mode == ParticlePropertiesMode.GLOBAL)\n\t\t\tanimationRegisterCache.setVertexConst(index, this._velocity.x, this._velocity.y, this._velocity.z);\n\t\telse\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleVelocityNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\n\t}\n}\n\nexport = ParticleVelocityState;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\nimport SkeletonBinaryLERPNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode\");\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\n\n/**\n *\n */\nclass SkeletonBinaryLERPState extends AnimationStateBase implements ISkeletonAnimationState\n{\n\tprivate _blendWeight:number = 0;\n\tprivate _skeletonAnimationNode:SkeletonBinaryLERPNode;\n\tprivate _skeletonPose:SkeletonPose = new SkeletonPose();\n\tprivate _skeletonPoseDirty:boolean = true;\n\tprivate _inputA:ISkeletonAnimationState;\n\tprivate _inputB:ISkeletonAnimationState;\n\n\t/**\n\t * Defines a fractional value between 0 and 1 representing the blending ratio between inputA (0) and inputB (1),\n\t * used to produce the skeleton pose output.\n\t *\n\t * @see inputA\n\t * @see inputB\n\t */\n\tpublic get blendWeight():number\n\t{\n\t\treturn this._blendWeight;\n\t}\n\n\tpublic set blendWeight(value:number)\n\t{\n\t\tthis._blendWeight = value;\n\n\t\tthis._pPositionDeltaDirty = true;\n\t\tthis._skeletonPoseDirty = true;\n\t}\n\n\tconstructor(animator:AnimatorBase, skeletonAnimationNode:SkeletonBinaryLERPNode)\n\t{\n\t\tsuper(animator, skeletonAnimationNode);\n\n\t\tthis._skeletonAnimationNode = skeletonAnimationNode;\n\n\t\tthis._inputA = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.inputA);\n\t\tthis._inputB = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.inputB);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic phase(value:number)\n\t{\n\t\tthis._skeletonPoseDirty = true;\n\n\t\tthis._pPositionDeltaDirty = true;\n\n\t\tthis._inputA.phase(value);\n\t\tthis._inputB.phase(value);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdateTime(time:number /*int*/)\n\t{\n\t\tthis._skeletonPoseDirty = true;\n\n\t\tthis._inputA.update(time);\n\t\tthis._inputB.update(time);\n\n\t\tsuper._pUpdateTime(time);\n\t}\n\n\t/**\n\t * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.\n\t */\n\tpublic getSkeletonPose(skeleton:Skeleton):SkeletonPose\n\t{\n\t\tif (this._skeletonPoseDirty)\n\t\t\tthis.updateSkeletonPose(skeleton);\n\n\t\treturn this._skeletonPose;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdatePositionDelta()\n\t{\n\t\tthis._pPositionDeltaDirty = false;\n\n\t\tvar deltA:Vector3D = this._inputA.positionDelta;\n\t\tvar deltB:Vector3D = this._inputB.positionDelta;\n\n\t\tthis._pRootDelta.x = deltA.x + this._blendWeight*(deltB.x - deltA.x);\n\t\tthis._pRootDelta.y = deltA.y + this._blendWeight*(deltB.y - deltA.y);\n\t\tthis._pRootDelta.z = deltA.z + this._blendWeight*(deltB.z - deltA.z);\n\t}\n\n\t/**\n\t * Updates the output skeleton pose of the node based on the blendWeight value between input nodes.\n\t *\n\t * @param skeleton The skeleton used by the animator requesting the ouput pose.\n\t */\n\tprivate updateSkeletonPose(skeleton:Skeleton)\n\t{\n\t\tthis._skeletonPoseDirty = false;\n\n\t\tvar endPose:JointPose;\n\t\tvar endPoses:Array<JointPose> = this._skeletonPose.jointPoses;\n\t\tvar poses1:Array<JointPose> = this._inputA.getSkeletonPose(skeleton).jointPoses;\n\t\tvar poses2:Array<JointPose> = this._inputB.getSkeletonPose(skeleton).jointPoses;\n\t\tvar pose1:JointPose, pose2:JointPose;\n\t\tvar p1:Vector3D, p2:Vector3D;\n\t\tvar tr:Vector3D;\n\t\tvar numJoints:number /*uint*/ = skeleton.numJoints;\n\n\t\t// :s\n\t\tif (endPoses.length != numJoints)\n\t\t\tendPoses.length = numJoints;\n\n\t\tfor (var i:number /*uint*/ = 0; i < numJoints; ++i) {\n\t\t\tendPose = endPoses[i];\n\n\t\t\tif (endPose == null)\n\t\t\t\tendPose = endPoses[i] = new JointPose();\n\n\t\t\tpose1 = poses1[i];\n\t\t\tpose2 = poses2[i];\n\t\t\tp1 = pose1.translation;\n\t\t\tp2 = pose2.translation;\n\n\t\t\tendPose.orientation.lerp(pose1.orientation, pose2.orientation, this._blendWeight);\n\n\t\t\ttr = endPose.translation;\n\t\t\ttr.x = p1.x + this._blendWeight*(p2.x - p1.x);\n\t\t\ttr.y = p1.y + this._blendWeight*(p2.y - p1.y);\n\t\t\ttr.z = p1.z + this._blendWeight*(p2.z - p1.z);\n\t\t}\n\t}\n}\n\nexport = SkeletonBinaryLERPState;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport SkeletonAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimator\");\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\nimport SkeletonClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode\");\nimport AnimationClipState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationClipState\");\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\n\n/**\n *\n */\nclass SkeletonClipState extends AnimationClipState implements ISkeletonAnimationState\n{\n\tprivate _rootPos:Vector3D = new Vector3D();\n\tprivate _frames:Array<SkeletonPose>;\n\tprivate _skeletonClipNode:SkeletonClipNode;\n\tprivate _skeletonPose:SkeletonPose = new SkeletonPose();\n\tprivate _skeletonPoseDirty:boolean = true;\n\tprivate _currentPose:SkeletonPose;\n\tprivate _nextPose:SkeletonPose;\n\n\t/**\n\t * Returns the current skeleton pose frame of animation in the clip based on the internal playhead position.\n\t */\n\tpublic get currentPose():SkeletonPose\n\t{\n\t\tif (this._pFramesDirty)\n\t\t\tthis._pUpdateFrames();\n\n\t\treturn this._currentPose;\n\t}\n\n\t/**\n\t * Returns the next skeleton pose frame of animation in the clip based on the internal playhead position.\n\t */\n\tpublic get nextPose():SkeletonPose\n\t{\n\t\tif (this._pFramesDirty)\n\t\t\tthis._pUpdateFrames();\n\n\t\treturn this._nextPose;\n\t}\n\n\tconstructor(animator:AnimatorBase, skeletonClipNode:SkeletonClipNode)\n\t{\n\t\tsuper(animator, skeletonClipNode);\n\n\t\tthis._skeletonClipNode = skeletonClipNode;\n\t\tthis._frames = this._skeletonClipNode.frames;\n\t}\n\n\t/**\n\t * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.\n\t */\n\tpublic getSkeletonPose(skeleton:Skeleton):SkeletonPose\n\t{\n\t\tif (this._skeletonPoseDirty)\n\t\t\tthis.updateSkeletonPose(skeleton);\n\n\t\treturn this._skeletonPose;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdateTime(time:number /*int*/)\n\t{\n\t\tthis._skeletonPoseDirty = true;\n\n\t\tsuper._pUpdateTime(time);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdateFrames()\n\t{\n\t\tsuper._pUpdateFrames();\n\n\t\tthis._currentPose = this._frames[this._pCurrentFrame];\n\n\t\tif (this._skeletonClipNode.looping && this._pNextFrame >= this._skeletonClipNode.lastFrame) {\n\t\t\tthis._nextPose = this._frames[0];\n\t\t\t(<SkeletonAnimator> this._pAnimator).dispatchCycleEvent();\n\t\t} else\n\t\t\tthis._nextPose = this._frames[this._pNextFrame];\n\t}\n\n\t/**\n\t * Updates the output skeleton pose of the node based on the internal playhead position.\n\t *\n\t * @param skeleton The skeleton used by the animator requesting the ouput pose.\n\t */\n\tprivate updateSkeletonPose(skeleton:Skeleton)\n\t{\n\t\tthis._skeletonPoseDirty = false;\n\n\t\tif (!this._skeletonClipNode.totalDuration)\n\t\t\treturn;\n\n\t\tif (this._pFramesDirty)\n\t\t\tthis._pUpdateFrames();\n\n\t\tvar currentPose:Array<JointPose> = this._currentPose.jointPoses;\n\t\tvar nextPose:Array<JointPose> = this._nextPose.jointPoses;\n\t\tvar numJoints:number /*uint*/ = skeleton.numJoints;\n\t\tvar p1:Vector3D, p2:Vector3D;\n\t\tvar pose1:JointPose, pose2:JointPose;\n\t\tvar endPoses:Array<JointPose> = this._skeletonPose.jointPoses;\n\t\tvar endPose:JointPose;\n\t\tvar tr:Vector3D;\n\n\t\t// :s\n\t\tif (endPoses.length != numJoints)\n\t\t\tendPoses.length = numJoints;\n\n\t\tif ((numJoints != currentPose.length) || (numJoints != nextPose.length))\n\t\t\tthrow new Error(\"joint counts don't match!\");\n\n\t\tfor (var i:number /*uint*/ = 0; i < numJoints; ++i) {\n\t\t\tendPose = endPoses[i];\n\n\t\t\tif (endPose == null)\n\t\t\t\tendPose = endPoses[i] = new JointPose();\n\n\t\t\tpose1 = currentPose[i];\n\t\t\tpose2 = nextPose[i];\n\t\t\tp1 = pose1.translation;\n\t\t\tp2 = pose2.translation;\n\n\t\t\tif (this._skeletonClipNode.highQuality)\n\t\t\t\tendPose.orientation.slerp(pose1.orientation, pose2.orientation, this._pBlendWeight); else\n\t\t\t\tendPose.orientation.lerp(pose1.orientation, pose2.orientation, this._pBlendWeight);\n\n\t\t\tif (i > 0) {\n\t\t\t\ttr = endPose.translation;\n\t\t\t\ttr.x = p1.x + this._pBlendWeight*(p2.x - p1.x);\n\t\t\t\ttr.y = p1.y + this._pBlendWeight*(p2.y - p1.y);\n\t\t\t\ttr.z = p1.z + this._pBlendWeight*(p2.z - p1.z);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdatePositionDelta()\n\t{\n\t\tthis._pPositionDeltaDirty = false;\n\n\t\tif (this._pFramesDirty)\n\t\t\tthis._pUpdateFrames();\n\n\t\tvar p1:Vector3D, p2:Vector3D, p3:Vector3D;\n\t\tvar totalDelta:Vector3D = this._skeletonClipNode.totalDelta;\n\n\t\t// jumping back, need to reset position\n\t\tif ((this._pTimeDir > 0 && this._pNextFrame < this._pOldFrame) || (this._pTimeDir < 0 && this._pNextFrame > this._pOldFrame)) {\n\t\t\tthis._rootPos.x -= totalDelta.x*this._pTimeDir;\n\t\t\tthis._rootPos.y -= totalDelta.y*this._pTimeDir;\n\t\t\tthis._rootPos.z -= totalDelta.z*this._pTimeDir;\n\t\t}\n\n\t\tvar dx:number = this._rootPos.x;\n\t\tvar dy:number = this._rootPos.y;\n\t\tvar dz:number = this._rootPos.z;\n\n\t\tif (this._skeletonClipNode.stitchFinalFrame && this._pNextFrame == this._skeletonClipNode.lastFrame) {\n\t\t\tp1 = this._frames[0].jointPoses[0].translation;\n\t\t\tp2 = this._frames[1].jointPoses[0].translation;\n\t\t\tp3 = this._currentPose.jointPoses[0].translation;\n\n\t\t\tthis._rootPos.x = p3.x + p1.x + this._pBlendWeight*(p2.x - p1.x);\n\t\t\tthis._rootPos.y = p3.y + p1.y + this._pBlendWeight*(p2.y - p1.y);\n\t\t\tthis._rootPos.z = p3.z + p1.z + this._pBlendWeight*(p2.z - p1.z);\n\t\t} else {\n\t\t\tp1 = this._currentPose.jointPoses[0].translation;\n\t\t\tp2 = this._frames[this._pNextFrame].jointPoses[0].translation; //cover the instances where we wrap the pose but still want the final frame translation values\n\t\t\tthis._rootPos.x = p1.x + this._pBlendWeight*(p2.x - p1.x);\n\t\t\tthis._rootPos.y = p1.y + this._pBlendWeight*(p2.y - p1.y);\n\t\t\tthis._rootPos.z = p1.z + this._pBlendWeight*(p2.z - p1.z);\n\t\t}\n\n\t\tthis._pRootDelta.x = this._rootPos.x - dx;\n\t\tthis._pRootDelta.y = this._rootPos.y - dy;\n\t\tthis._pRootDelta.z = this._rootPos.z - dz;\n\n\t\tthis._pOldFrame = this._pNextFrame;\n\t}\n}\n\nexport = SkeletonClipState;","import Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\nimport SkeletonDifferenceNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonDifferenceNode\");\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\n\n/**\n *\n */\nclass SkeletonDifferenceState extends AnimationStateBase implements ISkeletonAnimationState\n{\n\tprivate _blendWeight:number = 0;\n\tprivate static _tempQuat:Quaternion = new Quaternion();\n\tprivate _skeletonAnimationNode:SkeletonDifferenceNode;\n\tprivate _skeletonPose:SkeletonPose = new SkeletonPose();\n\tprivate _skeletonPoseDirty:boolean = true;\n\tprivate _baseInput:ISkeletonAnimationState;\n\tprivate _differenceInput:ISkeletonAnimationState;\n\n\t/**\n\t * Defines a fractional value between 0 and 1 representing the blending ratio between the base input (0) and difference input (1),\n\t * used to produce the skeleton pose output.\n\t *\n\t * @see #baseInput\n\t * @see #differenceInput\n\t */\n\tpublic get blendWeight():number\n\t{\n\t\treturn this._blendWeight;\n\t}\n\n\tpublic set blendWeight(value:number)\n\t{\n\t\tthis._blendWeight = value;\n\n\t\tthis._pPositionDeltaDirty = true;\n\t\tthis._skeletonPoseDirty = true;\n\t}\n\n\tconstructor(animator:AnimatorBase, skeletonAnimationNode:SkeletonDifferenceNode)\n\t{\n\t\tsuper(animator, skeletonAnimationNode);\n\n\t\tthis._skeletonAnimationNode = skeletonAnimationNode;\n\n\t\tthis._baseInput = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.baseInput);\n\t\tthis._differenceInput = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.differenceInput);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic phase(value:number)\n\t{\n\t\tthis._skeletonPoseDirty = true;\n\n\t\tthis._pPositionDeltaDirty = true;\n\n\t\tthis._baseInput.phase(value);\n\t\tthis._baseInput.phase(value);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdateTime(time:number /*int*/)\n\t{\n\t\tthis._skeletonPoseDirty = true;\n\n\t\tthis._baseInput.update(time);\n\t\tthis._differenceInput.update(time);\n\n\t\tsuper._pUpdateTime(time);\n\t}\n\n\t/**\n\t * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.\n\t */\n\tpublic getSkeletonPose(skeleton:Skeleton):SkeletonPose\n\t{\n\t\tif (this._skeletonPoseDirty)\n\t\t\tthis.updateSkeletonPose(skeleton);\n\n\t\treturn this._skeletonPose;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdatePositionDelta()\n\t{\n\t\tthis._pPositionDeltaDirty = false;\n\n\t\tvar deltA:Vector3D = this._baseInput.positionDelta;\n\t\tvar deltB:Vector3D = this._differenceInput.positionDelta;\n\n\t\tthis.positionDelta.x = deltA.x + this._blendWeight*deltB.x;\n\t\tthis.positionDelta.y = deltA.y + this._blendWeight*deltB.y;\n\t\tthis.positionDelta.z = deltA.z + this._blendWeight*deltB.z;\n\t}\n\n\t/**\n\t * Updates the output skeleton pose of the node based on the blendWeight value between base input and difference input nodes.\n\t *\n\t * @param skeleton The skeleton used by the animator requesting the ouput pose.\n\t */\n\tprivate updateSkeletonPose(skeleton:Skeleton)\n\t{\n\t\tthis._skeletonPoseDirty = false;\n\n\t\tvar endPose:JointPose;\n\t\tvar endPoses:Array<JointPose> = this._skeletonPose.jointPoses;\n\t\tvar basePoses:Array<JointPose> = this._baseInput.getSkeletonPose(skeleton).jointPoses;\n\t\tvar diffPoses:Array<JointPose> = this._differenceInput.getSkeletonPose(skeleton).jointPoses;\n\t\tvar base:JointPose, diff:JointPose;\n\t\tvar basePos:Vector3D, diffPos:Vector3D;\n\t\tvar tr:Vector3D;\n\t\tvar numJoints:number /*uint*/ = skeleton.numJoints;\n\n\t\t// :s\n\t\tif (endPoses.length != numJoints)\n\t\t\tendPoses.length = numJoints;\n\n\t\tfor (var i:number /*uint*/ = 0; i < numJoints; ++i) {\n\t\t\tendPose = endPoses[i];\n\n\t\t\tif (endPose == null)\n\t\t\t\tendPose = endPoses[i] = new JointPose();\n\n\t\t\tbase = basePoses[i];\n\t\t\tdiff = diffPoses[i];\n\t\t\tbasePos = base.translation;\n\t\t\tdiffPos = diff.translation;\n\n\t\t\tSkeletonDifferenceState._tempQuat.multiply(diff.orientation, base.orientation);\n\t\t\tendPose.orientation.lerp(base.orientation, SkeletonDifferenceState._tempQuat, this._blendWeight);\n\n\t\t\ttr = endPose.translation;\n\t\t\ttr.x = basePos.x + this._blendWeight*diffPos.x;\n\t\t\ttr.y = basePos.y + this._blendWeight*diffPos.y;\n\t\t\ttr.z = basePos.z + this._blendWeight*diffPos.z;\n\t\t}\n\t}\n}\n\nexport = SkeletonDifferenceState;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\nimport SkeletonDirectionalNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonDirectionalNode\");\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\n\n/**\n *\n */\nclass SkeletonDirectionalState extends AnimationStateBase implements ISkeletonAnimationState\n{\n\tprivate _skeletonAnimationNode:SkeletonDirectionalNode;\n\tprivate _skeletonPose:SkeletonPose = new SkeletonPose();\n\tprivate _skeletonPoseDirty:boolean = true;\n\tprivate _inputA:ISkeletonAnimationState;\n\tprivate _inputB:ISkeletonAnimationState;\n\tprivate _blendWeight:number = 0;\n\tprivate _direction:number = 0;\n\tprivate _blendDirty:boolean = true;\n\tprivate _forward:ISkeletonAnimationState;\n\tprivate _backward:ISkeletonAnimationState;\n\tprivate _left:ISkeletonAnimationState;\n\tprivate _right:ISkeletonAnimationState;\n\n\t/**\n\t * Defines the direction in degrees of the aniamtion between the forwards (0), right(90) backwards (180) and left(270) input nodes,\n\t * used to produce the skeleton pose output.\n\t */\n\tpublic set direction(value:number)\n\t{\n\t\tif (this._direction == value)\n\t\t\treturn;\n\n\t\tthis._direction = value;\n\n\t\tthis._blendDirty = true;\n\n\t\tthis._skeletonPoseDirty = true;\n\t\tthis._pPositionDeltaDirty = true;\n\t}\n\n\tpublic get direction():number\n\t{\n\t\treturn this._direction;\n\t}\n\n\tconstructor(animator:AnimatorBase, skeletonAnimationNode:SkeletonDirectionalNode)\n\t{\n\t\tsuper(animator, skeletonAnimationNode);\n\n\t\tthis._skeletonAnimationNode = skeletonAnimationNode;\n\n\t\tthis._forward = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.forward);\n\t\tthis._backward = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.backward);\n\t\tthis._left = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.left);\n\t\tthis._right = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.right);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic phase(value:number)\n\t{\n\t\tif (this._blendDirty)\n\t\t\tthis.updateBlend();\n\n\t\tthis._skeletonPoseDirty = true;\n\n\t\tthis._pPositionDeltaDirty = true;\n\n\t\tthis._inputA.phase(value);\n\t\tthis._inputB.phase(value);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUdateTime(time:number /*int*/)\n\t{\n\t\tif (this._blendDirty)\n\t\t\tthis.updateBlend();\n\n\t\tthis._skeletonPoseDirty = true;\n\n\t\tthis._inputA.update(time);\n\t\tthis._inputB.update(time);\n\n\t\tsuper._pUpdateTime(time);\n\t}\n\n\t/**\n\t * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.\n\t */\n\tpublic getSkeletonPose(skeleton:Skeleton):SkeletonPose\n\t{\n\t\tif (this._skeletonPoseDirty)\n\t\t\tthis.updateSkeletonPose(skeleton);\n\n\t\treturn this._skeletonPose;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdatePositionDelta()\n\t{\n\t\tthis._pPositionDeltaDirty = false;\n\n\t\tif (this._blendDirty)\n\t\t\tthis.updateBlend();\n\n\t\tvar deltA:Vector3D = this._inputA.positionDelta;\n\t\tvar deltB:Vector3D = this._inputB.positionDelta;\n\n\t\tthis.positionDelta.x = deltA.x + this._blendWeight*(deltB.x - deltA.x);\n\t\tthis.positionDelta.y = deltA.y + this._blendWeight*(deltB.y - deltA.y);\n\t\tthis.positionDelta.z = deltA.z + this._blendWeight*(deltB.z - deltA.z);\n\t}\n\n\t/**\n\t * Updates the output skeleton pose of the node based on the direction value between forward, backwards, left and right input nodes.\n\t *\n\t * @param skeleton The skeleton used by the animator requesting the ouput pose.\n\t */\n\tprivate updateSkeletonPose(skeleton:Skeleton)\n\t{\n\t\tthis._skeletonPoseDirty = false;\n\n\t\tif (this._blendDirty)\n\t\t\tthis.updateBlend();\n\n\t\tvar endPose:JointPose;\n\t\tvar endPoses:Array<JointPose> = this._skeletonPose.jointPoses;\n\t\tvar poses1:Array<JointPose> = this._inputA.getSkeletonPose(skeleton).jointPoses;\n\t\tvar poses2:Array<JointPose> = this._inputB.getSkeletonPose(skeleton).jointPoses;\n\t\tvar pose1:JointPose, pose2:JointPose;\n\t\tvar p1:Vector3D, p2:Vector3D;\n\t\tvar tr:Vector3D;\n\t\tvar numJoints:number /*uint*/ = skeleton.numJoints;\n\n\t\t// :s\n\t\tif (endPoses.length != numJoints)\n\t\t\tendPoses.length = numJoints;\n\n\t\tfor (var i:number /*uint*/ = 0; i < numJoints; ++i) {\n\t\t\tendPose = endPoses[i];\n\n\t\t\tif (endPose == null)\n\t\t\t\tendPose = endPoses[i] = new JointPose();\n\n\t\t\tpose1 = poses1[i];\n\t\t\tpose2 = poses2[i];\n\t\t\tp1 = pose1.translation;\n\t\t\tp2 = pose2.translation;\n\n\t\t\tendPose.orientation.lerp(pose1.orientation, pose2.orientation, this._blendWeight);\n\n\t\t\ttr = endPose.translation;\n\t\t\ttr.x = p1.x + this._blendWeight*(p2.x - p1.x);\n\t\t\ttr.y = p1.y + this._blendWeight*(p2.y - p1.y);\n\t\t\ttr.z = p1.z + this._blendWeight*(p2.z - p1.z);\n\t\t}\n\t}\n\n\t/**\n\t * Updates the blend value for the animation output based on the direction value between forward, backwards, left and right input nodes.\n\t *\n\t * @private\n\t */\n\tprivate updateBlend()\n\t{\n\t\tthis._blendDirty = false;\n\n\t\tif (this._direction < 0 || this._direction > 360) {\n\t\t\tthis._direction %= 360;\n\t\t\tif (this._direction < 0)\n\t\t\t\tthis._direction += 360;\n\t\t}\n\n\t\tif (this._direction < 90) {\n\t\t\tthis._inputA = this._forward;\n\t\t\tthis._inputB = this._right;\n\t\t\tthis._blendWeight = this._direction/90;\n\t\t} else if (this._direction < 180) {\n\t\t\tthis._inputA = this._right;\n\t\t\tthis._inputB = this._backward;\n\t\t\tthis._blendWeight = (this._direction - 90)/90;\n\t\t} else if (this._direction < 270) {\n\t\t\tthis._inputA = this._backward;\n\t\t\tthis._inputB = this._left;\n\t\t\tthis._blendWeight = (this._direction - 180)/90;\n\t\t} else {\n\t\t\tthis._inputA = this._left;\n\t\t\tthis._inputB = this._forward;\n\t\t\tthis._blendWeight = (this._direction - 270)/90;\n\t\t}\n\t}\n}\n\nexport = SkeletonDirectionalState;","import Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\nimport SkeletonNaryLERPNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonNaryLERPNode\");\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\n\n/**\n *\n */\nclass SkeletonNaryLERPState extends AnimationStateBase implements ISkeletonAnimationState\n{\n\tprivate _skeletonAnimationNode:SkeletonNaryLERPNode;\n\tprivate _skeletonPose:SkeletonPose = new SkeletonPose();\n\tprivate _skeletonPoseDirty:boolean = true;\n\tprivate _blendWeights:Array<number> = new Array<number>();\n\tprivate _inputs:Array<ISkeletonAnimationState> = new Array<ISkeletonAnimationState>();\n\n\tconstructor(animator:AnimatorBase, skeletonAnimationNode:SkeletonNaryLERPNode)\n\t{\n\t\tsuper(animator, skeletonAnimationNode);\n\n\t\tthis._skeletonAnimationNode = skeletonAnimationNode;\n\n\t\tvar i:number /*uint*/ = this._skeletonAnimationNode.numInputs;\n\n\t\twhile (i--)\n\t\t\tthis._inputs[i] = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode._iInputs[i]);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic phase(value:number)\n\t{\n\t\tthis._skeletonPoseDirty = true;\n\n\t\tthis._pPositionDeltaDirty = true;\n\n\t\tfor (var j:number /*uint*/ = 0; j < this._skeletonAnimationNode.numInputs; ++j) {\n\t\t\tif (this._blendWeights[j])\n\t\t\t\tthis._inputs[j].update(value);\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUdateTime(time:number /*int*/)\n\t{\n\t\tfor (var j:number /*uint*/ = 0; j < this._skeletonAnimationNode.numInputs; ++j) {\n\t\t\tif (this._blendWeights[j])\n\t\t\t\tthis._inputs[j].update(time);\n\t\t}\n\n\t\tsuper._pUpdateTime(time);\n\t}\n\n\t/**\n\t * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.\n\t */\n\tpublic getSkeletonPose(skeleton:Skeleton):SkeletonPose\n\t{\n\t\tif (this._skeletonPoseDirty)\n\t\t\tthis.updateSkeletonPose(skeleton);\n\n\t\treturn this._skeletonPose;\n\t}\n\n\t/**\n\t * Returns the blend weight of the skeleton aniamtion node that resides at the given input index.\n\t *\n\t * @param index The input index for which the skeleton animation node blend weight is requested.\n\t */\n\tpublic getBlendWeightAt(index:number /*uint*/):number\n\t{\n\t\treturn this._blendWeights[index];\n\t}\n\n\t/**\n\t * Sets the blend weight of the skeleton aniamtion node that resides at the given input index.\n\t *\n\t * @param index The input index on which the skeleton animation node blend weight is to be set.\n\t * @param blendWeight The blend weight value to use for the given skeleton animation node index.\n\t */\n\tpublic setBlendWeightAt(index:number /*uint*/, blendWeight:number)\n\t{\n\t\tthis._blendWeights[index] = blendWeight;\n\n\t\tthis._pPositionDeltaDirty = true;\n\t\tthis._skeletonPoseDirty = true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdatePositionDelta()\n\t{\n\t\tthis._pPositionDeltaDirty = false;\n\n\t\tvar delta:Vector3D;\n\t\tvar weight:number;\n\n\t\tthis.positionDelta.x = 0;\n\t\tthis.positionDelta.y = 0;\n\t\tthis.positionDelta.z = 0;\n\n\t\tfor (var j:number /*uint*/ = 0; j < this._skeletonAnimationNode.numInputs; ++j) {\n\t\t\tweight = this._blendWeights[j];\n\n\t\t\tif (weight) {\n\t\t\t\tdelta = this._inputs[j].positionDelta;\n\t\t\t\tthis.positionDelta.x += weight*delta.x;\n\t\t\t\tthis.positionDelta.y += weight*delta.y;\n\t\t\t\tthis.positionDelta.z += weight*delta.z;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Updates the output skeleton pose of the node based on the blend weight values given to the input nodes.\n\t *\n\t * @param skeleton The skeleton used by the animator requesting the ouput pose.\n\t */\n\tprivate updateSkeletonPose(skeleton:Skeleton)\n\t{\n\t\tthis._skeletonPoseDirty = false;\n\n\t\tvar weight:number;\n\t\tvar endPoses:Array<JointPose> = this._skeletonPose.jointPoses;\n\t\tvar poses:Array<JointPose>;\n\t\tvar endPose:JointPose, pose:JointPose;\n\t\tvar endTr:Vector3D, tr:Vector3D;\n\t\tvar endQuat:Quaternion, q:Quaternion;\n\t\tvar firstPose:Array<JointPose>;\n\t\tvar i:number /*uint*/;\n\t\tvar w0:number, x0:number, y0:number, z0:number;\n\t\tvar w1:number, x1:number, y1:number, z1:number;\n\t\tvar numJoints:number /*uint*/ = skeleton.numJoints;\n\n\t\t// :s\n\t\tif (endPoses.length != numJoints)\n\t\t\tendPoses.length = numJoints;\n\n\t\tfor (var j:number /*uint*/ = 0; j < this._skeletonAnimationNode.numInputs; ++j) {\n\t\t\tweight = this._blendWeights[j];\n\n\t\t\tif (!weight)\n\t\t\t\tcontinue;\n\n\t\t\tposes = this._inputs[j].getSkeletonPose(skeleton).jointPoses;\n\n\t\t\tif (!firstPose) {\n\t\t\t\tfirstPose = poses;\n\t\t\t\tfor (i = 0; i < numJoints; ++i) {\n\t\t\t\t\tendPose = endPoses[i];\n\n\t\t\t\t\tif (endPose == null)\n\t\t\t\t\t\tendPose = endPoses[i] = new JointPose();\n\n\t\t\t\t\tpose = poses[i];\n\t\t\t\t\tq = pose.orientation;\n\t\t\t\t\ttr = pose.translation;\n\n\t\t\t\t\tendQuat = endPose.orientation;\n\n\t\t\t\t\tendQuat.x = weight*q.x;\n\t\t\t\t\tendQuat.y = weight*q.y;\n\t\t\t\t\tendQuat.z = weight*q.z;\n\t\t\t\t\tendQuat.w = weight*q.w;\n\n\t\t\t\t\tendTr = endPose.translation;\n\t\t\t\t\tendTr.x = weight*tr.x;\n\t\t\t\t\tendTr.y = weight*tr.y;\n\t\t\t\t\tendTr.z = weight*tr.z;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (i = 0; i < skeleton.numJoints; ++i) {\n\t\t\t\t\tendPose = endPoses[i];\n\t\t\t\t\tpose = poses[i];\n\n\t\t\t\t\tq = firstPose[i].orientation;\n\t\t\t\t\tx0 = q.x;\n\t\t\t\t\ty0 = q.y;\n\t\t\t\t\tz0 = q.z;\n\t\t\t\t\tw0 = q.w;\n\n\t\t\t\t\tq = pose.orientation;\n\t\t\t\t\ttr = pose.translation;\n\n\t\t\t\t\tx1 = q.x;\n\t\t\t\t\ty1 = q.y;\n\t\t\t\t\tz1 = q.z;\n\t\t\t\t\tw1 = q.w;\n\t\t\t\t\t// find shortest direction\n\t\t\t\t\tif (x0*x1 + y0*y1 + z0*z1 + w0*w1 < 0) {\n\t\t\t\t\t\tx1 = -x1;\n\t\t\t\t\t\ty1 = -y1;\n\t\t\t\t\t\tz1 = -z1;\n\t\t\t\t\t\tw1 = -w1;\n\t\t\t\t\t}\n\t\t\t\t\tendQuat = endPose.orientation;\n\t\t\t\t\tendQuat.x += weight*x1;\n\t\t\t\t\tendQuat.y += weight*y1;\n\t\t\t\t\tendQuat.z += weight*z1;\n\t\t\t\t\tendQuat.w += weight*w1;\n\n\t\t\t\t\tendTr = endPose.translation;\n\t\t\t\t\tendTr.x += weight*tr.x;\n\t\t\t\t\tendTr.y += weight*tr.y;\n\t\t\t\t\tendTr.z += weight*tr.z;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0; i < skeleton.numJoints; ++i)\n\t\t\tendPoses[i].orientation.normalize();\n\t}\n}\n\nexport = SkeletonNaryLERPState;","import Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport VertexAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimator\");\nimport VertexClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/VertexClipNode\");\nimport AnimationClipState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationClipState\");\nimport IVertexAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/IVertexAnimationState\");\n\n/**\n *\n */\nclass VertexClipState extends AnimationClipState implements IVertexAnimationState\n{\n\tprivate _frames:Array<Geometry>;\n\tprivate _vertexClipNode:VertexClipNode;\n\tprivate _currentGeometry:Geometry;\n\tprivate _nextGeometry:Geometry;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get currentGeometry():Geometry\n\t{\n\t\tif (this._pFramesDirty)\n\t\t\tthis._pUpdateFrames();\n\n\t\treturn this._currentGeometry;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get nextGeometry():Geometry\n\t{\n\t\tif (this._pFramesDirty)\n\t\t\tthis._pUpdateFrames();\n\n\t\treturn this._nextGeometry;\n\t}\n\n\tconstructor(animator:AnimatorBase, vertexClipNode:VertexClipNode)\n\t{\n\t\tsuper(animator, vertexClipNode);\n\n\t\tthis._vertexClipNode = vertexClipNode;\n\t\tthis._frames = this._vertexClipNode.frames;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdateFrames()\n\t{\n\t\tsuper._pUpdateFrames();\n\n\t\tthis._currentGeometry = this._frames[this._pCurrentFrame];\n\n\t\tif (this._vertexClipNode.looping && this._pNextFrame >= this._vertexClipNode.lastFrame) {\n\t\t\tthis._nextGeometry = this._frames[0];\n\t\t\t(<VertexAnimator> this._pAnimator).dispatchCycleEvent();\n\t\t} else\n\t\t\tthis._nextGeometry = this._frames[this._pNextFrame];\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdatePositionDelta()\n\t{\n\t\t//TODO:implement positiondelta functionality for vertex animations\n\t}\n}\n\nexport = VertexClipState;","import SkeletonBinaryLERPNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode\");\nimport CrossfadeTransitionState\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState\");\n\n/**\n * A skeleton animation node that uses two animation node inputs to blend a lineraly interpolated output of a skeleton pose.\n */\nclass CrossfadeTransitionNode extends SkeletonBinaryLERPNode\n{\n\tpublic blendSpeed:number;\n\n\tpublic startBlend:number /*int*/;\n\n\t/**\n\t * Creates a new <code>CrossfadeTransitionNode</code> object.\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._pStateClass = CrossfadeTransitionState;\n\t}\n}\n\nexport = CrossfadeTransitionNode;","import AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport SkeletonBinaryLERPNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode\");\nimport SkeletonBinaryLERPState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState\");\nimport CrossfadeTransitionNode\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode\");\nimport AnimationStateEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/AnimationStateEvent\");\n\n/**\n *\n */\nclass CrossfadeTransitionState extends SkeletonBinaryLERPState\n{\n\tprivate _crossfadeTransitionNode:CrossfadeTransitionNode;\n\tprivate _animationStateTransitionComplete:AnimationStateEvent;\n\n\tconstructor(animator:AnimatorBase, skeletonAnimationNode:CrossfadeTransitionNode)\n\t{\n\t\tsuper(animator, <SkeletonBinaryLERPNode> skeletonAnimationNode);\n\n\t\tthis._crossfadeTransitionNode = skeletonAnimationNode;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdateTime(time:number /*int*/)\n\t{\n\t\tthis.blendWeight = Math.abs(time - this._crossfadeTransitionNode.startBlend)/(1000*this._crossfadeTransitionNode.blendSpeed);\n\n\t\tif (this.blendWeight >= 1) {\n\t\t\tthis.blendWeight = 1;\n\n\t\t\tif (this._animationStateTransitionComplete == null)\n\t\t\t\tthis._animationStateTransitionComplete = new AnimationStateEvent(AnimationStateEvent.TRANSITION_COMPLETE, this._pAnimator, this, this._crossfadeTransitionNode);\n\n\t\t\tthis._crossfadeTransitionNode.dispatchEvent(this._animationStateTransitionComplete);\n\t\t}\n\n\t\tsuper._pUpdateTime(time);\n\t}\n}\n\nexport = CrossfadeTransitionState;","import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport CrossfadeTransitionNode\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode\");\nimport IAnimationTransition\t\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/IAnimationTransition\");\n\n/**\n *\n */\nclass CrossfadeTransition implements IAnimationTransition\n{\n\tpublic blendSpeed:number = 0.5;\n\n\tconstructor(blendSpeed:number)\n\t{\n\t\tthis.blendSpeed = blendSpeed;\n\t}\n\n\tpublic getAnimationNode(animator:AnimatorBase, startNode:AnimationNodeBase, endNode:AnimationNodeBase, startBlend:number /*int*/):AnimationNodeBase\n\t{\n\t\tvar crossFadeTransitionNode:CrossfadeTransitionNode = new CrossfadeTransitionNode();\n\t\tcrossFadeTransitionNode.inputA = startNode;\n\t\tcrossFadeTransitionNode.inputB = endNode;\n\t\tcrossFadeTransitionNode.blendSpeed = this.blendSpeed;\n\t\tcrossFadeTransitionNode.startBlend = startBlend;\n\n\t\treturn <AnimationNodeBase> crossFadeTransitionNode;\n\t}\n}\n\nexport = CrossfadeTransition;","import Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\n\nimport ParticleData\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleData\");\n\n/**\n * @class away.base.ParticleGeometry\n */\nclass ParticleGeometry extends Geometry\n{\n\tpublic particles:Array<ParticleData>;\n\n\tpublic numParticles:number /*uint*/;\n\n}\n\nexport = ParticleGeometry;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Plane3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Plane3D\");\nimport Point\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\nimport TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\nimport ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport LineSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/LineSubMesh\");\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport TriangleSubMesh\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\nimport EntityListItem\t\t\t\t= require(\"awayjs-display/lib/pool/EntityListItem\");\nimport IEntitySorter\t\t\t\t= require(\"awayjs-display/lib/sort/IEntitySorter\");\nimport RenderableMergeSort\t\t\t= require(\"awayjs-display/lib/sort/RenderableMergeSort\");\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/render/IRenderer\");\nimport Billboard\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\nimport RendererEvent\t\t\t\t= require(\"awayjs-display/lib/events/RendererEvent\");\nimport StageEvent\t\t\t\t\t= require(\"awayjs-display/lib/events/StageEvent\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport EntityCollector\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\nimport ShadowCasterCollector\t\t= require(\"awayjs-display/lib/traverse/ShadowCasterCollector\");\nimport DefaultMaterialManager\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\n\nimport AGALMiniAssembler\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler\");\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport StageManager\t\t\t\t\t= require(\"awayjs-stagegl/lib/managers/StageManager\");\nimport ProgramData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/ProgramData\");\n\nimport AnimationSetBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\nimport AnimatorBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport IRendererPoolClass\t\t\t= require(\"awayjs-renderergl/lib/pool/IRendererPoolClass\");\nimport RTTBufferManager\t\t\t\t= require(\"awayjs-renderergl/lib/managers/RTTBufferManager\");\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\nimport RendererPoolBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RendererPoolBase\");\n\n\n/**\n * RendererBase forms an abstract base class for classes that are used in the rendering pipeline to render the\n * contents of a partition\n *\n * @class away.render.RendererBase\n */\nclass RendererBase extends EventDispatcher\n{\n\tprivate _numUsedStreams:number = 0;\n\tprivate _numUsedTextures:number = 0;\n\n\tprivate _rendererPool:RendererPoolBase;\n\n\tpublic _pRendererPoolClass:IRendererPoolClass;\n\tpublic _pContext:IContextGL;\n\tpublic _pStage:Stage;\n\n\tpublic _pCamera:Camera;\n\tpublic _iEntryPoint:Vector3D;\n\tpublic _pCameraForward:Vector3D;\n\n\tpublic _pRttBufferManager:RTTBufferManager;\n\tprivate _viewPort:Rectangle = new Rectangle();\n\tprivate _viewportDirty:boolean;\n\tprivate _scissorDirty:boolean;\n\n\tpublic _pBackBufferInvalid:boolean = true;\n\tpublic _pDepthTextureInvalid:boolean = true;\n\tpublic _depthPrepass:boolean = false;\n\tprivate _backgroundR:number = 0;\n\tprivate _backgroundG:number = 0;\n\tprivate _backgroundB:number = 0;\n\tprivate _backgroundAlpha:number = 1;\n\tpublic _shareContext:boolean = false;\n\n\t// only used by renderers that need to render geometry to textures\n\tpublic _width:number;\n\tpublic _height:number;\n\n\tpublic textureRatioX:number = 1;\n\tpublic textureRatioY:number = 1;\n\n\tprivate _snapshotBitmapData:BitmapData;\n\tprivate _snapshotRequired:boolean;\n\n\tpublic _pRttViewProjectionMatrix:Matrix3D = new Matrix3D();\n\n\tprivate _localPos:Point = new Point();\n\tprivate _globalPos:Point = new Point();\n\tpublic _pScissorRect:Rectangle = new Rectangle();\n\n\tprivate _scissorUpdated:RendererEvent;\n\tprivate _viewPortUpdated:RendererEvent;\n\n\tprivate _onContextUpdateDelegate:Function;\n\tprivate _onViewportUpdatedDelegate;\n\n\tpublic _pNumTriangles:number = 0;\n\n\tpublic _pOpaqueRenderableHead:RenderableBase;\n\tpublic _pBlendedRenderableHead:RenderableBase;\n\tpublic _disableColor:boolean = false;\n\tpublic _renderBlended:boolean = true;\n\n\n\tpublic get renderBlended():boolean\n\t{\n\t\treturn this._renderBlended;\n\t}\n\n\tpublic set renderBlended(value:boolean)\n\t{\n\t\tthis._renderBlended = value;\n\t}\n\n\n\tpublic get disableColor():boolean\n\t{\n\t\treturn this._disableColor;\n\t}\n\n\tpublic set disableColor(value:boolean)\n\t{\n\t\tthis._disableColor = value;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get numTriangles():number\n\t{\n\t\treturn this._pNumTriangles;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic renderableSorter:IEntitySorter;\n\n\n\t/**\n\t * A viewPort rectangle equivalent of the Stage size and position.\n\t */\n\tpublic get viewPort():Rectangle\n\t{\n\t\treturn this._viewPort;\n\t}\n\n\t/**\n\t * A scissor rectangle equivalent of the view size and position.\n\t */\n\tpublic get scissorRect():Rectangle\n\t{\n\t\treturn this._pScissorRect;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get x():number\n\t{\n\t\treturn this._localPos.x;\n\t}\n\n\tpublic set x(value:number)\n\t{\n\t\tif (this.x == value)\n\t\t\treturn;\n\n\t\tthis._globalPos.x = this._localPos.x = value;\n\n\t\tthis.updateGlobalPos();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get y():number\n\t{\n\t\treturn this._localPos.y;\n\t}\n\n\tpublic set y(value:number)\n\t{\n\t\tif (this.y == value)\n\t\t\treturn;\n\n\t\tthis._globalPos.y = this._localPos.y = value;\n\n\t\tthis.updateGlobalPos();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get width():number\n\t{\n\t\treturn this._width;\n\t}\n\n\tpublic set width(value:number)\n\t{\n\t\tif (this._width == value)\n\t\t\treturn;\n\n\t\tthis._width = value;\n\t\tthis._pScissorRect.width = value;\n\n\t\tif (this._pRttBufferManager)\n\t\t\tthis._pRttBufferManager.viewWidth = value;\n\n\t\tthis._pBackBufferInvalid = true;\n\t\tthis._pDepthTextureInvalid = true;\n\n\t\tthis.notifyScissorUpdate();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get height():number\n\t{\n\t\treturn this._height;\n\t}\n\n\tpublic set height(value:number)\n\t{\n\t\tif (this._height == value)\n\t\t\treturn;\n\n\t\tthis._height = value;\n\t\tthis._pScissorRect.height = value;\n\n\t\tif (this._pRttBufferManager)\n\t\t\tthis._pRttBufferManager.viewHeight = value;\n\n\t\tthis._pBackBufferInvalid = true;\n\t\tthis._pDepthTextureInvalid = true;\n\n\t\tthis.notifyScissorUpdate();\n\t}\n\n\t/**\n\t * Creates a new RendererBase object.\n\t */\n\tconstructor(rendererPoolClass:IRendererPoolClass = null, stage:Stage = null)\n\t{\n\t\tsuper();\n\n\t\tthis._pRendererPoolClass = rendererPoolClass;\n\n\t\tthis._onViewportUpdatedDelegate = (event:StageEvent) => this.onViewportUpdated(event)\n\t\tthis._onContextUpdateDelegate = (event:Event) => this.onContextUpdate(event);\n\n\t\t//default sorting algorithm\n\t\tthis.renderableSorter = new RenderableMergeSort();\n\n\t\tthis._rendererPool = (rendererPoolClass)? new this._pRendererPoolClass(this) : new RendererPoolBase(this);\n\n\t\tthis.stage = stage || StageManager.getInstance().getFreeStage();\n\t}\n\n\tpublic activatePass(renderable:RenderableBase, pass:RenderPassBase, camera:Camera)\n\t{\n\t\t//clear unused vertex streams\n\t\tfor (var i = pass.shader.numUsedStreams; i < this._numUsedStreams; i++)\n\t\t\tthis._pContext.setVertexBufferAt(i, null);\n\n\t\t//clear unused texture streams\n\t\tfor (var i = pass.shader.numUsedTextures; i < this._numUsedTextures; i++)\n\t\t\tthis._pContext.setTextureAt(i, null);\n\n\t\t//check program data is uploaded\n\t\tvar programData:ProgramData = pass.shader.programData;\n\n\t\tif (!programData.program) {\n\t\t\tprogramData.program = this._pContext.createProgram();\n\t\t\tvar vertexByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part vertex 1\\n\" + programData.vertexString + \"endpart\"))['vertex'].data;\n\t\t\tvar fragmentByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part fragment 1\\n\" + programData.fragmentString + \"endpart\"))['fragment'].data;\n\t\t\tprogramData.program.upload(vertexByteCode, fragmentByteCode);\n\t\t}\n\n\t\t//set program data\n\t\tthis._pContext.setProgram(programData.program);\n\n\t\t//activate shader object through renderable\n\t\trenderable._iActivate(pass, camera);\n\t}\n\n\tpublic deactivatePass(renderable:RenderableBase, pass:RenderPassBase)\n\t{\n\t\t//deactivate shader object\n\t\trenderable._iDeactivate(pass);\n\n\t\tthis._numUsedStreams = pass.shader.numUsedStreams;\n\t\tthis._numUsedTextures = pass.shader.numUsedTextures;\n\t}\n\n\tpublic _iCreateEntityCollector():CollectorBase\n\t{\n\t\treturn new EntityCollector();\n\t}\n\n\t/**\n\t * The background color's red component, used when clearing.\n\t *\n\t * @private\n\t */\n\tpublic get _iBackgroundR():number\n\t{\n\t\treturn this._backgroundR;\n\t}\n\n\tpublic set _iBackgroundR(value:number)\n\t{\n\t\tif (this._backgroundR == value)\n\t\t\treturn;\n\n\t\tthis._backgroundR = value;\n\n\t\tthis._pBackBufferInvalid = true;\n\t}\n\n\t/**\n\t * The background color's green component, used when clearing.\n\t *\n\t * @private\n\t */\n\tpublic get _iBackgroundG():number\n\t{\n\t\treturn this._backgroundG;\n\t}\n\n\tpublic set _iBackgroundG(value:number)\n\t{\n\t\tif (this._backgroundG == value)\n\t\t\treturn;\n\n\t\tthis._backgroundG = value;\n\n\t\tthis._pBackBufferInvalid = true;\n\t}\n\n\t/**\n\t * The background color's blue component, used when clearing.\n\t *\n\t * @private\n\t */\n\tpublic get _iBackgroundB():number\n\t{\n\t\treturn this._backgroundB;\n\t}\n\n\tpublic set _iBackgroundB(value:number)\n\t{\n\t\tif (this._backgroundB == value)\n\t\t\treturn;\n\n\t\tthis._backgroundB = value;\n\n\t\tthis._pBackBufferInvalid = true;\n\t}\n\n\tpublic get context():IContextGL\n\t{\n\t\treturn this._pContext;\n\t}\n\n\t/**\n\t * The Stage that will provide the ContextGL used for rendering.\n\t */\n\tpublic get stage():Stage\n\t{\n\t\treturn this._pStage;\n\t}\n\n\tpublic set stage(value:Stage)\n\t{\n\t\tif (this._pStage == value)\n\t\t\treturn;\n\n\t\tthis.iSetStage(value);\n\t}\n\n\tpublic iSetStage(value:Stage)\n\t{\n\t\tif (this._pStage)\n\t\t\tthis.dispose();\n\n\t\tif (value) {\n\t\t\tthis._pStage = value;\n\n\t\t\tthis._rendererPool.stage = this._pStage;\n\n\t\t\tthis._pStage.addEventListener(StageEvent.CONTEXT_CREATED, this._onContextUpdateDelegate);\n\t\t\tthis._pStage.addEventListener(StageEvent.CONTEXT_RECREATED, this._onContextUpdateDelegate);\n\t\t\tthis._pStage.addEventListener(StageEvent.VIEWPORT_UPDATED, this._onViewportUpdatedDelegate);\n\n\t\t\t/*\n\t\t\t if (_backgroundImageRenderer)\n\t\t\t _backgroundImageRenderer.stage = value;\n\t\t\t */\n\t\t\tif (this._pStage.context)\n\t\t\t\tthis._pContext = <IContextGL> this._pStage.context;\n\t\t}\n\n\t\tthis._pBackBufferInvalid = true;\n\n\t\tthis.updateGlobalPos();\n\t}\n\n\t/**\n\t * Defers control of ContextGL clear() and present() calls to Stage, enabling multiple Stage frameworks\n\t * to share the same ContextGL object.\n\t */\n\tpublic get shareContext():boolean\n\t{\n\t\treturn this._shareContext;\n\t}\n\n\tpublic set shareContext(value:boolean)\n\t{\n\t\tif (this._shareContext == value)\n\t\t\treturn;\n\n\t\tthis._shareContext = value;\n\n\t\tthis.updateGlobalPos();\n\t}\n\n\t/**\n\t * Disposes the resources used by the RendererBase.\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._rendererPool.dispose();\n\n\t\tthis._pStage.removeEventListener(StageEvent.CONTEXT_CREATED, this._onContextUpdateDelegate);\n\t\tthis._pStage.removeEventListener(StageEvent.CONTEXT_RECREATED, this._onContextUpdateDelegate);\n\t\tthis._pStage.removeEventListener(StageEvent.VIEWPORT_UPDATED, this._onViewportUpdatedDelegate);\n\n\t\tthis._pStage = null;\n\t\tthis._pContext = null;\n\t\t/*\n\t\t if (_backgroundImageRenderer) {\n\t\t _backgroundImageRenderer.dispose();\n\t\t _backgroundImageRenderer = null;\n\t\t }\n\t\t */\n\t}\n\n\tpublic render(entityCollector:CollectorBase)\n\t{\n\t\tthis._viewportDirty = false;\n\t\tthis._scissorDirty = false;\n\t}\n\n\t/**\n\t * Renders the potentially visible geometry to the back buffer or texture.\n\t * @param entityCollector The EntityCollector object containing the potentially visible geometry.\n\t * @param target An option target texture to render to.\n\t * @param surfaceSelector The index of a CubeTexture's face to render to.\n\t * @param additionalClearMask Additional clear mask information, in case extra clear channels are to be omitted.\n\t */\n\tpublic _iRender(entityCollector:CollectorBase, target:TextureProxyBase = null, scissorRect:Rectangle = null, surfaceSelector:number = 0)\n\t{\n\t\t//TODO refactor setTarget so that rendertextures are created before this check\n\t\tif (!this._pStage || !this._pContext)\n\t\t\treturn;\n\n\t\tthis._pRttViewProjectionMatrix.copyFrom(entityCollector.camera.viewProjection);\n\t\tthis._pRttViewProjectionMatrix.appendScale(this.textureRatioX, this.textureRatioY, 1);\n\n\t\tthis.pExecuteRender(entityCollector, target, scissorRect, surfaceSelector);\n\n\t\t// generate mip maps on target (if target exists) //TODO\n\t\t//if (target)\n\t\t//\t(<Texture>target).generateMipmaps();\n\n\t\t// clear buffers\n\t\tfor (var i:number = 0; i < 8; ++i) {\n\t\t\tthis._pContext.setVertexBufferAt(i, null);\n\t\t\tthis._pContext.setTextureAt(i, null);\n\t\t}\n\t}\n\n\tpublic _iRenderCascades(entityCollector:ShadowCasterCollector, target:TextureProxyBase, numCascades:number, scissorRects:Array<Rectangle>, cameras:Array<Camera>)\n\t{\n\t\tthis.pCollectRenderables(entityCollector);\n\n\t\tthis._pStage.setRenderTarget(target, true, 0);\n\t\tthis._pContext.clear(1, 1, 1, 1, 1, 0);\n\n\t\tthis._pContext.setBlendFactors(ContextGLBlendFactor.ONE, ContextGLBlendFactor.ZERO);\n\t\tthis._pContext.setDepthTest(true, ContextGLCompareMode.LESS);\n\n\t\tvar head:RenderableBase = this._pOpaqueRenderableHead;\n\n\t\tvar first:boolean = true;\n\n\t\t//TODO cascades must have separate collectors, rather than separate draw commands\n\t\tfor (var i:number = numCascades - 1; i >= 0; --i) {\n\t\t\tthis._pStage.scissorRect = scissorRects[i];\n\t\t\t//this.drawCascadeRenderables(head, cameras[i], first? null : cameras[i].frustumPlanes);\n\t\t\tfirst = false;\n\t\t}\n\n\t\t//line required for correct rendering when using away3d with starling. DO NOT REMOVE UNLESS STARLING INTEGRATION IS RETESTED!\n\t\tthis._pContext.setDepthTest(false, ContextGLCompareMode.LESS_EQUAL);\n\n\t\tthis._pStage.scissorRect = null;\n\t}\n\n\tpublic pCollectRenderables(entityCollector:CollectorBase)\n\t{\n\t\t//reset head values\n\t\tthis._pBlendedRenderableHead = null;\n\t\tthis._pOpaqueRenderableHead = null;\n\t\tthis._pNumTriangles = 0;\n\n\t\t//grab entity head\n\t\tvar item:EntityListItem = entityCollector.entityHead;\n\n\t\t//set temp values for entry point and camera forward vector\n\t\tthis._pCamera = entityCollector.camera;\n\t\tthis._iEntryPoint = this._pCamera.scenePosition;\n\t\tthis._pCameraForward = this._pCamera.transform.forwardVector;\n\n\t\t//iterate through all entities\n\t\twhile (item) {\n\t\t\titem.entity._iCollectRenderables(this._rendererPool);\n\t\t\titem = item.next;\n\t\t}\n\n\t\t//sort the resulting renderables\n\t\tthis._pOpaqueRenderableHead = <RenderableBase> this.renderableSorter.sortOpaqueRenderables(this._pOpaqueRenderableHead);\n\t\tthis._pBlendedRenderableHead = <RenderableBase> this.renderableSorter.sortBlendedRenderables(this._pBlendedRenderableHead);\n\t}\n\n\t/**\n\t * Renders the potentially visible geometry to the back buffer or texture. Only executed if everything is set up.\n\t *\n\t * @param entityCollector The EntityCollector object containing the potentially visible geometry.\n\t * @param target An option target texture to render to.\n\t * @param surfaceSelector The index of a CubeTexture's face to render to.\n\t * @param additionalClearMask Additional clear mask information, in case extra clear channels are to be omitted.\n\t */\n\tpublic pExecuteRender(entityCollector:CollectorBase, target:TextureProxyBase = null, scissorRect:Rectangle = null, surfaceSelector:number = 0)\n\t{\n\t\tthis._pStage.setRenderTarget(target, true, surfaceSelector);\n\n\t\tif ((target || !this._shareContext) && !this._depthPrepass)\n\t\t\tthis._pContext.clear(this._backgroundR, this._backgroundG, this._backgroundB, this._backgroundAlpha, 1, 0);\n\n\t\tthis._pStage.scissorRect = scissorRect;\n\n\t\t/*\n\t\t if (_backgroundImageRenderer)\n\t\t _backgroundImageRenderer.render();\n\t\t */\n\t\tthis.pCollectRenderables(entityCollector);\n\n\t\tthis._pContext.setBlendFactors(ContextGLBlendFactor.ONE, ContextGLBlendFactor.ZERO);\n\n\t\tthis.pDraw(entityCollector);\n\n\t\t//line required for correct rendering when using away3d with starling. DO NOT REMOVE UNLESS STARLING INTEGRATION IS RETESTED!\n\t\t//this._pContext.setDepthTest(false, ContextGLCompareMode.LESS_EQUAL); //oopsie\n\n\t\tif (!this._shareContext) {\n\t\t\tif (this._snapshotRequired && this._snapshotBitmapData) {\n\t\t\t\tthis._pContext.drawToBitmapData(this._snapshotBitmapData);\n\t\t\t\tthis._snapshotRequired = false;\n\t\t\t}\n\t\t}\n\n\t\tthis._pStage.scissorRect = null;\n\t}\n\n\t/*\n\t * Will draw the renderer's output on next render to the provided bitmap data.\n\t * */\n\tpublic queueSnapshot(bmd:BitmapData)\n\t{\n\t\tthis._snapshotRequired = true;\n\t\tthis._snapshotBitmapData = bmd;\n\t}\n\n\t/**\n\t * Performs the actual drawing of geometry to the target.\n\t * @param entityCollector The EntityCollector object containing the potentially visible geometry.\n\t */\n\tpublic pDraw(entityCollector:CollectorBase)\n\t{\n\t\tthis._pContext.setDepthTest(true, ContextGLCompareMode.LESS_EQUAL);\n\n\t\tif (this._disableColor)\n\t\t\tthis._pContext.setColorMask(false, false, false, false);\n\n\t\tthis.drawRenderables(this._pOpaqueRenderableHead, entityCollector);\n\n\t\tif (this._renderBlended)\n\t\t\tthis.drawRenderables(this._pBlendedRenderableHead, entityCollector);\n\n\t\tif (this._disableColor)\n\t\t\tthis._pContext.setColorMask(true, true, true, true);\n\t}\n\n\t//private drawCascadeRenderables(renderable:RenderableBase, camera:Camera, cullPlanes:Array<Plane3D>)\n\t//{\n\t//\tvar renderable2:RenderableBase;\n\t//\tvar renderObject:RenderObjectBase;\n\t//\tvar pass:RenderPassBase;\n\t//\n\t//\twhile (renderable) {\n\t//\t\trenderable2 = renderable;\n\t//\t\trenderObject = renderable.renderObject;\n\t//\t\tpass = renderObject.passes[0] //assuming only one pass per material\n\t//\n\t//\t\tthis.activatePass(renderable, pass, camera);\n\t//\n\t//\t\tdo {\n\t//\t\t\t// if completely in front, it will fall in a different cascade\n\t//\t\t\t// do not use near and far planes\n\t//\t\t\tif (!cullPlanes || renderable2.sourceEntity.worldBounds.isInFrustum(cullPlanes, 4)) {\n\t//\t\t\t\trenderable2._iRender(pass, camera, this._pRttViewProjectionMatrix);\n\t//\t\t\t} else {\n\t//\t\t\t\trenderable2.cascaded = true;\n\t//\t\t\t}\n\t//\n\t//\t\t\trenderable2 = renderable2.next;\n\t//\n\t//\t\t} while (renderable2 && renderable2.renderObject == renderObject && !renderable2.cascaded);\n\t//\n\t//\t\tthis.deactivatePass(renderable, pass);\n\t//\n\t//\t\trenderable = renderable2;\n\t//\t}\n\t//}\n\n\t/**\n\t * Draw a list of renderables.\n\t *\n\t * @param renderables The renderables to draw.\n\t * @param entityCollector The EntityCollector containing all potentially visible information.\n\t */\n\tpublic drawRenderables(renderable:RenderableBase, entityCollector:CollectorBase)\n\t{\n\t\tvar i:number;\n\t\tvar len:number;\n\t\tvar renderable2:RenderableBase;\n\t\tvar renderObject:RenderObjectBase;\n\t\tvar passes:Array<RenderPassBase>;\n\t\tvar pass:RenderPassBase;\n\t\tvar camera:Camera = entityCollector.camera;\n\n\n\t\twhile (renderable) {\n\t\t\trenderObject = renderable.renderObject;\n\t\t\tpasses = renderObject.passes;\n\n\t\t\t// otherwise this would result in depth rendered anyway because fragment shader kil is ignored\n\t\t\tif (this._disableColor && renderObject._renderObjectOwner.alphaThreshold != 0) {\n\t\t\t\trenderable2 = renderable;\n\t\t\t\t// fast forward\n\t\t\t\tdo {\n\t\t\t\t\trenderable2 = renderable2.next;\n\n\t\t\t\t} while (renderable2 && renderable2.renderObject == renderObject);\n\t\t\t} else {\n\t\t\t\t//iterate through each shader object\n\t\t\t\tlen = passes.length;\n\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\trenderable2 = renderable;\n\t\t\t\t\tpass = passes[i];\n\n\t\t\t\t\tthis.activatePass(renderable, pass, camera);\n\n\t\t\t\t\tdo {\n\t\t\t\t\t\trenderable2._iRender(pass, camera, this._pRttViewProjectionMatrix);\n\n\t\t\t\t\t\trenderable2 = renderable2.next;\n\n\t\t\t\t\t} while (renderable2 && renderable2.renderObject == renderObject);\n\n\t\t\t\t\tthis.deactivatePass(renderable, pass);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trenderable = renderable2;\n\t\t}\n\t}\n\n\t/**\n\t * Assign the context once retrieved\n\t */\n\tprivate onContextUpdate(event:Event)\n\t{\n\t\tthis._pContext = <IContextGL> this._pStage.context;\n\t}\n\n\tpublic get _iBackgroundAlpha():number\n\t{\n\t\treturn this._backgroundAlpha;\n\t}\n\n\tpublic set _iBackgroundAlpha(value:number)\n\t{\n\t\tif (this._backgroundAlpha == value)\n\t\t\treturn;\n\n\t\tthis._backgroundAlpha = value;\n\n\t\tthis._pBackBufferInvalid = true;\n\t}\n\n\t/*\n\t public get iBackground():Texture2DBase\n\t {\n\t return this._background;\n\t }\n\t */\n\n\t/*\n\t public set iBackground(value:Texture2DBase)\n\t {\n\t if (this._backgroundImageRenderer && !value) {\n\t this._backgroundImageRenderer.dispose();\n\t this._backgroundImageRenderer = null;\n\t }\n\n\t if (!this._backgroundImageRenderer && value)\n\t {\n\n\t this._backgroundImageRenderer = new BackgroundImageRenderer(this._pStage);\n\n\t }\n\n\n\t this._background = value;\n\n\t if (this._backgroundImageRenderer)\n\t this._backgroundImageRenderer.texture = value;\n\t }\n\t */\n\t/*\n\t public get backgroundImageRenderer():BackgroundImageRenderer\n\t {\n\t return _backgroundImageRenderer;\n\t }\n\t */\n\n\n\t/**\n\t * @private\n\t */\n\tprivate notifyScissorUpdate()\n\t{\n\t\tif (this._scissorDirty)\n\t\t\treturn;\n\n\t\tthis._scissorDirty = true;\n\n\t\tif (!this._scissorUpdated)\n\t\t\tthis._scissorUpdated = new RendererEvent(RendererEvent.SCISSOR_UPDATED);\n\n\t\tthis.dispatchEvent(this._scissorUpdated);\n\t}\n\n\n\t/**\n\t * @private\n\t */\n\tprivate notifyViewportUpdate()\n\t{\n\t\tif (this._viewportDirty)\n\t\t\treturn;\n\n\t\tthis._viewportDirty = true;\n\n\t\tif (!this._viewPortUpdated)\n\t\t\tthis._viewPortUpdated = new RendererEvent(RendererEvent.VIEWPORT_UPDATED);\n\n\t\tthis.dispatchEvent(this._viewPortUpdated);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic onViewportUpdated(event:StageEvent)\n\t{\n\t\tthis._viewPort = this._pStage.viewPort;\n\t\t//TODO stop firing viewport updated for every stagegl viewport change\n\n\t\tif (this._shareContext) {\n\t\t\tthis._pScissorRect.x = this._globalPos.x - this._pStage.x;\n\t\t\tthis._pScissorRect.y = this._globalPos.y - this._pStage.y;\n\t\t\tthis.notifyScissorUpdate();\n\t\t}\n\n\t\tthis.notifyViewportUpdate();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic updateGlobalPos()\n\t{\n\t\tif (this._shareContext) {\n\t\t\tthis._pScissorRect.x = this._globalPos.x - this._viewPort.x;\n\t\t\tthis._pScissorRect.y = this._globalPos.y - this._viewPort.y;\n\t\t} else {\n\t\t\tthis._pScissorRect.x = 0;\n\t\t\tthis._pScissorRect.y = 0;\n\t\t\tthis._viewPort.x = this._globalPos.x;\n\t\t\tthis._viewPort.y = this._globalPos.y;\n\t\t}\n\n\t\tthis.notifyScissorUpdate();\n\t}\n\n\t/**\n\t *\n\t * @param renderable\n\t * @protected\n\t */\n\tpublic applyRenderable(renderable:RenderableBase)\n\t{\n\t\t//set local vars for faster referencing\n\t\tvar renderObject:RenderObjectBase = this._pGetRenderObject(renderable, renderable.renderObjectOwner || DefaultMaterialManager.getDefaultMaterial(renderable.renderableOwner));\n\n\t\trenderable.renderObject = renderObject;\n\t\trenderable.renderObjectId = renderObject.renderObjectId;\n\t\trenderable.renderOrderId = renderObject.renderOrderId;\n\n\t\trenderable.cascaded = false;\n\n\t\tvar entity:IEntity = renderable.sourceEntity;\n\t\tvar position:Vector3D = entity.scenePosition;\n\n\t\t// project onto camera's z-axis\n\t\tposition = this._iEntryPoint.subtract(position);\n\t\trenderable.zIndex = entity.zOffset + position.dotProduct(this._pCameraForward);\n\n\t\t//store reference to scene transform\n\t\trenderable.renderSceneTransform = renderable.sourceEntity.getRenderSceneTransform(this._pCamera);\n\n\t\tif (renderObject.requiresBlending) {\n\t\t\trenderable.next = this._pBlendedRenderableHead;\n\t\t\tthis._pBlendedRenderableHead = renderable;\n\t\t} else {\n\t\t\trenderable.next = this._pOpaqueRenderableHead;\n\t\t\tthis._pOpaqueRenderableHead = renderable;\n\t\t}\n\n\t\tthis._pNumTriangles += renderable.numTriangles;\n\n\t\t//handle any overflow for renderables with data that exceeds GPU limitations\n\t\tif (renderable.overflow)\n\t\t\tthis.applyRenderable(renderable.overflow);\n\t}\n\n\tpublic _pGetRenderObject(renderable:RenderableBase, renderObjectOwner:IRenderObjectOwner):RenderObjectBase\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n}\n\nexport = RendererBase;","import IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\nimport DepthPass\t\t\t\t\t= require(\"awayjs-renderergl/lib/passes/DepthPass\");\n\n/**\n * DepthRenderObject forms an abstract base class for the default shaded materials provided by Stage,\n * using material methods to define their appearance.\n */\nclass DepthRenderObject extends RenderObjectBase\n{\n\t/**\n\t *\n\t */\n\tpublic static id:string = \"depth\";\n\n\tconstructor(pool:RenderObjectPool, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tsuper(pool, renderObjectOwner, renderableClass, stage);\n\n\t\tthis._pAddScreenPass(new DepthPass(this, renderObjectOwner, renderableClass, this._stage));\n\t}\n}\n\nexport = DepthRenderObject;","import IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\nimport DistancePass\t\t\t\t\t= require(\"awayjs-renderergl/lib/passes/DistancePass\");\n\n/**\n * DistanceRenderObject is a pass that writes distance values to a depth map as a 32-bit value exploded over the 4 texture channels.\n * This is used to render omnidirectional shadow maps.\n */\nclass DistanceRenderObject extends RenderObjectBase\n{\n\t/**\n\t *\n\t */\n\tpublic static id:string = \"distance\";\n\n\t/**\n\t * Creates a new DistanceRenderObject object.\n\t *\n\t * @param material The material to which this pass belongs.\n\t */\n\tconstructor(pool:RenderObjectPool, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tsuper(pool, renderObjectOwner, renderableClass, stage);\n\n\t\tthis._pAddScreenPass(new DistancePass(this, renderObjectOwner, renderableClass, this._stage));\n\t}\n}\n\nexport = DistanceRenderObject;","import ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\n/**\n * RegisterPool is used by the shader compilation process to keep track of which registers of a certain type are\n * currently used and should not be allowed to be written to. Either entire registers can be requested and locked,\n * or single components (x, y, z, w) of a single register.\n * It is used by ShaderRegisterCache to track usages of individual register types.\n *\n * @see away.materials.ShaderRegisterCache\n */\nclass RegisterPool\n{\n\tprivate static _regPool:Object = new Object();\n\tprivate static _regCompsPool:Object = new Object();\n\n\tprivate _vectorRegisters:Array<ShaderRegisterElement>;\n\tprivate _registerComponents;\n\n\tprivate _regName:string;\n\tprivate _usedSingleCount:Array<Array<number>>;\n\tprivate _usedVectorCount:Array<number> /*uint*/;\n\tprivate _regCount:number;\n\n\tprivate _persistent:boolean;\n\n\t/**\n\t * Creates a new RegisterPool object.\n\t * @param regName The base name of the register type (\"ft\" for fragment temporaries, \"vc\" for vertex constants, etc)\n\t * @param regCount The amount of available registers of this type.\n\t * @param persistent Whether or not registers, once reserved, can be freed again. For example, temporaries are not persistent, but constants are.\n\t */\n\tconstructor(regName:string, regCount:number, persistent:boolean = true)\n\t{\n\t\tthis._regName = regName;\n\t\tthis._regCount = regCount;\n\t\tthis._persistent = persistent;\n\t\tthis.initRegisters(regName, regCount);\n\t}\n\n\t/**\n\t * Retrieve an entire vector register that's still available.\n\t */\n\tpublic requestFreeVectorReg():ShaderRegisterElement\n\t{\n\t\tfor (var i:number = 0; i < this._regCount; ++i) {\n\t\t\tif (!this.isRegisterUsed(i)) {\n\t\t\t\tif (this._persistent)\n\t\t\t\t\tthis._usedVectorCount[i]++;\n\n\t\t\t\treturn this._vectorRegisters[i];\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error(\"Register overflow!\");\n\t}\n\n\t/**\n\t * Retrieve a single vector component that's still available.\n\t */\n\tpublic requestFreeRegComponent():ShaderRegisterElement\n\t{\n\t\tfor (var i:number = 0; i < this._regCount; ++i) {\n\t\t\tif (this._usedVectorCount[i] > 0)\n\t\t\t\tcontinue;\n\n\t\t\tfor (var j:number = 0; j < 4; ++j) {\n\t\t\t\tif (this._usedSingleCount[j][i] == 0) {\n\t\t\t\t\tif (this._persistent)\n\t\t\t\t\t\tthis._usedSingleCount[j][i]++;\n\n\t\t\t\t\treturn this._registerComponents[j][i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error(\"Register overflow!\");\n\t}\n\n\t/**\n\t * Marks a register as used, so it cannot be retrieved. The register won't be able to be used until removeUsage\n\t * has been called usageCount times again.\n\t * @param register The register to mark as used.\n\t * @param usageCount The amount of usages to add.\n\t */\n\tpublic addUsage(register:ShaderRegisterElement, usageCount:number)\n\t{\n\t\tif (register._component > -1)\n\t\t\tthis._usedSingleCount[register._component][register.index] += usageCount;\n\t\telse\n\t\t\tthis._usedVectorCount[register.index] += usageCount;\n\t}\n\n\t/**\n\t * Removes a usage from a register. When usages reach 0, the register is freed again.\n\t * @param register The register for which to remove a usage.\n\t */\n\tpublic removeUsage(register:ShaderRegisterElement)\n\t{\n\t\tif (register._component > -1) {\n\t\t\tif (--this._usedSingleCount[register._component][register.index] < 0)\n\t\t\t\tthrow new Error(\"More usages removed than exist!\");\n\t\t} else {\n\t\t\tif (--this._usedVectorCount[register.index] < 0)\n\t\t\t\tthrow new Error(\"More usages removed than exist!\");\n\t\t}\n\t}\n\n\t/**\n\t * Disposes any resources used by the current RegisterPool object.\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._vectorRegisters = null;\n\t\tthis._registerComponents = null;\n\t\tthis._usedSingleCount = null;\n\t\tthis._usedVectorCount = null;\n\t}\n\n\t/**\n\t * Indicates whether or not any registers are in use.\n\t */\n\tpublic hasRegisteredRegs():boolean\n\t{\n\t\tfor (var i:number = 0; i < this._regCount; ++i)\n\t\t\tif (this.isRegisterUsed(i))\n\t\t\t\treturn true;\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Initializes all registers.\n\t */\n\tprivate initRegisters(regName:string, regCount:number)\n\t{\n\t\tvar hash:string = RegisterPool._initPool(regName, regCount);\n\n\t\tthis._vectorRegisters = RegisterPool._regPool[hash];\n\t\tthis._registerComponents = RegisterPool._regCompsPool[hash];\n\n\t\tthis._usedVectorCount = this._initArray(Array<number>(regCount), 0);\n\n\t\tthis._usedSingleCount = new Array<Array<number>>(4);\n\t\tthis._usedSingleCount[0] = this._initArray(new Array<number>(regCount), 0);\n\t\tthis._usedSingleCount[1] = this._initArray(new Array<number>(regCount), 0);\n\t\tthis._usedSingleCount[2] = this._initArray(new Array<number>(regCount), 0);\n\t\tthis._usedSingleCount[3] = this._initArray(new Array<number>(regCount), 0);\n\t}\n\n\tprivate static _initPool(regName:string, regCount:number):string\n\t{\n\t\tvar hash:string = regName + regCount;\n\n\t\tif (RegisterPool._regPool[hash] != undefined)\n\t\t\treturn hash;\n\n\t\tvar vectorRegisters:Array<ShaderRegisterElement> = new Array<ShaderRegisterElement>(regCount);\n\t\tRegisterPool._regPool[hash] = vectorRegisters;\n\n\t\tvar registerComponents = [\n\t\t\t[],\n\t\t\t[],\n\t\t\t[],\n\t\t\t[]\n\t\t];\n\t\tRegisterPool._regCompsPool[hash] = registerComponents;\n\n\t\tfor (var i:number = 0; i < regCount; ++i) {\n\n\t\t\tvectorRegisters[i] = new ShaderRegisterElement(regName, i);\n\n\t\t\tfor (var j:number = 0; j < 4; ++j)\n\t\t\t\tregisterComponents[j][i] = new ShaderRegisterElement(regName, i, j);\n\t\t}\n\n\t\treturn hash;\n\t}\n\n\n\t/**\n\t * Check if the temp register is either used for single or vector use\n\t */\n\tprivate isRegisterUsed(index:number):boolean\n\t{\n\t\tif (this._usedVectorCount[index] > 0)\n\t\t\treturn true;\n\n\t\tfor (var i:number = 0; i < 4; ++i)\n\t\t\tif (this._usedSingleCount[i][index] > 0)\n\t\t\t\treturn true;\n\n\t\treturn false;\n\t}\n\n\n\tprivate _initArray(a:Array<any>, val:any):Array<any>\n\t{\n\t\tvar l:number = a.length;\n\n\t\tfor (var c:number = 0; c < l; c++)\n\t\t\ta[c] = val;\n\n\t\treturn a;\n\t}\n}\n\nexport = RegisterPool;\n","import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport BasicMaterial\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\nimport BasicMaterialPass\t\t\t= require(\"awayjs-renderergl/lib/passes/BasicMaterialPass\");\n\n/**\n * RenderMaterialObject forms an abstract base class for the default shaded materials provided by Stage,\n * using material methods to define their appearance.\n */\nclass RenderBasicMaterialObject extends RenderObjectBase\n{\n\t/**\n\t *\n\t */\n\tpublic static id:string = \"basic\";\n\n\tprivate _material:BasicMaterial;\n\tprivate _screenPass:BasicMaterialPass;\n\n\n\tconstructor(pool:RenderObjectPool, material:BasicMaterial, renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tsuper(pool, material, renderableClass, stage);\n\n\t\tthis._material = material;\n\n\t\tthis._pAddScreenPass(this._screenPass = new BasicMaterialPass(this, material, renderableClass, this._stage));\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdateRenderObject()\n\t{\n\t\tsuper._pUpdateRenderObject();\n\n\t\tthis._pRequiresBlending = (this._material.blendMode != BlendMode.NORMAL || this._material.alphaBlending || (this._material.colorTransform && this._material.colorTransform.alphaMultiplier < 1));\n\t\t//this._screenPass.preserveAlpha = this._pRequiresBlending;\n\t\tthis._screenPass.setBlendMode((this._renderObjectOwner.blendMode == BlendMode.NORMAL && this._pRequiresBlending)? BlendMode.LAYER : this._material.blendMode);\n\t\t//this._screenPass.forceSeparateMVP = false;\n\t}\n}\n\nexport = RenderBasicMaterialObject;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\nimport AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\n\nimport IRenderObject\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderObject\");\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport AnimatorBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\n\n/**\n *\n * @class away.pool.ScreenPasses\n */\nclass RenderObjectBase implements IRenderObject\n{\n\tpublic _forceSeparateMVP:boolean = false;\n\n\tprivate _pool:RenderObjectPool;\n\tpublic _renderObjectOwner:IRenderObjectOwner;\n\tpublic _renderableClass:IRenderableClass;\n\tpublic _stage:Stage;\n\n\tprivate _renderOrderId:number;\n\tprivate _invalidAnimation:boolean = true;\n\tprivate _invalidRenderObject:boolean = true;\n\tprivate _passes:Array<RenderPassBase> = new Array<RenderPassBase>();\n\n\n\n\tpublic _pRequiresBlending:boolean = false;\n\n\tprivate _onPassChangeDelegate:(event:Event) => void;\n\n\tpublic renderObjectId:number;\n\n\t/**\n\t * Indicates whether or not the renderable requires alpha blending during rendering.\n\t */\n\tpublic get requiresBlending():boolean\n\t{\n\t\treturn this._pRequiresBlending;\n\t}\n\n\tpublic get renderOrderId():number\n\t{\n\t\tif (this._invalidAnimation)\n\t\t\tthis._updateAnimation();\n\n\t\treturn this._renderOrderId;\n\t}\n\n\tpublic get passes():Array<RenderPassBase>\n\t{\n\t\tif (this._invalidAnimation)\n\t\t\tthis._updateAnimation();\n\n\t\treturn this._passes;\n\t}\n\n\tconstructor(pool:RenderObjectPool, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tthis._pool = pool;\n\t\tthis.renderObjectId = renderObjectOwner.id;\n\t\tthis._renderObjectOwner = renderObjectOwner;\n\t\tthis._renderableClass = renderableClass;\n\t\tthis._stage = stage;\n\n\n\t\tthis._onPassChangeDelegate = (event:Event) => this.onPassChange(event);\n\t}\n\n\tpublic _iIncludeDependencies(shaderObject:ShaderObjectBase)\n\t{\n\t\tthis._renderableClass._iIncludeDependencies(shaderObject);\n\n\t\tshaderObject.alphaThreshold = this._renderObjectOwner.alphaThreshold;\n\t\tshaderObject.useMipmapping = this._renderObjectOwner.mipmap;\n\t\tshaderObject.useSmoothTextures = this._renderObjectOwner.smooth;\n\n\t\tif (this._renderObjectOwner.assetType = AssetType.MATERIAL) {\n\t\t\tvar material:MaterialBase = <MaterialBase> this._renderObjectOwner;\n\t\t\tshaderObject.useAlphaPremultiplied = material.alphaPremultiplied;\n\t\t\tshaderObject.useBothSides = material.bothSides;\n\t\t\tshaderObject.repeatTextures = material.repeat;\n\t\t\tshaderObject.usesUVTransform = material.animateUVs;\n\t\t\tshaderObject.texture = material.texture;\n\t\t\tshaderObject.color = material.color;\n\t\t}\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._pClearScreenPasses();\n\n\t\tvar len:number = this._passes.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._passes[i].dispose();\n\n\t\tthis._passes = null;\n\n\t\tthis._pool.disposeItem(this._renderObjectOwner);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic invalidateRenderObject()\n\t{\n\t\tthis._invalidRenderObject = true;\n\t\tthis._invalidAnimation = true;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic invalidatePasses()\n\t{\n\t\tvar len:number = this._passes.length;\n\t\tfor (var i:number = 0; i < len; i++)\n\t\t\tthis._passes[i].invalidatePass();\n\n\t\tthis._invalidAnimation = true;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic invalidateAnimation()\n\t{\n\t\tthis._invalidAnimation = true;\n\t}\n\n\t/**\n\t *\n\t * @param renderObjectOwner\n\t */\n\tprivate _updateAnimation()\n\t{\n\t\tif (this._invalidRenderObject)\n\t\t\tthis._pUpdateRenderObject();\n\n\t\tthis._invalidAnimation = false;\n\n\t\tvar enabledGPUAnimation:boolean = this._getEnabledGPUAnimation();\n\n\t\tvar renderOrderId = 0;\n\t\tvar mult:number = 1;\n\t\tvar shaderObject:ShaderObjectBase;\n\t\tvar len:number = this._passes.length;\n\t\tfor (var i:number = 0; i < len; i++) {\n\t\t\tshaderObject = this._passes[i].shader;\n\n\t\t\tif (shaderObject.usesAnimation != enabledGPUAnimation) {\n\t\t\t\tshaderObject.usesAnimation = enabledGPUAnimation;\n\t\t\t\tshaderObject.invalidateProgram();\n\t\t\t}\n\n\t\t\trenderOrderId += shaderObject.programData.id*mult;\n\t\t\tmult *= 1000;\n\t\t}\n\n\t\tthis._renderOrderId = renderOrderId;\n\t}\n\n\t/**\n\t * Performs any processing that needs to occur before any of its passes are used.\n\t *\n\t * @private\n\t */\n\tpublic _pUpdateRenderObject()\n\t{\n\t\tthis._invalidRenderObject = false;\n\n\t\t//overrride to update shader object properties\n\t}\n\n\t/**\n\t * Removes a pass from the renderObjectOwner.\n\t * @param pass The pass to be removed.\n\t */\n\tpublic _pRemoveScreenPass(pass:RenderPassBase)\n\t{\n\t\tpass.removeEventListener(Event.CHANGE, this._onPassChangeDelegate);\n\t\tthis._passes.splice(this._passes.indexOf(pass), 1);\n\t}\n\n\t/**\n\t * Removes all passes from the renderObjectOwner\n\t */\n\tpublic _pClearScreenPasses()\n\t{\n\t\tvar len:number = this._passes.length;\n\t\tfor (var i:number = 0; i < len; ++i)\n\t\t\tthis._passes[i].removeEventListener(Event.CHANGE, this._onPassChangeDelegate);\n\n\t\tthis._passes.length = 0;\n\t}\n\n\t/**\n\t * Adds a pass to the renderObjectOwner\n\t * @param pass\n\t */\n\tpublic _pAddScreenPass(pass:RenderPassBase)\n\t{\n\t\tthis._passes.push(pass);\n\t\tpass.addEventListener(Event.CHANGE, this._onPassChangeDelegate);\n\t}\n\n\t/**\n\t * Listener for when a pass's shader code changes. It recalculates the render order id.\n\t */\n\tprivate onPassChange(event:Event)\n\t{\n\t\tthis.invalidateAnimation();\n\t}\n\n\n\t/**\n\t * test if animation will be able to run on gpu BEFORE compiling materials\n\t * test if the shader objects supports animating the animation set in the vertex shader\n\t * if any object using this material fails to support accelerated animations for any of the shader objects,\n\t * we should do everything on cpu (otherwise we have the cost of both gpu + cpu animations)\n\t */\n\tprivate _getEnabledGPUAnimation():boolean\n\t{\n\t\tif (this._renderObjectOwner.animationSet) {\n\t\t\tthis._renderObjectOwner.animationSet.resetGPUCompatibility();\n\n\t\t\tvar owners:Array<IRenderableOwner> = this._renderObjectOwner.iOwners;\n\t\t\tvar numOwners:number = owners.length;\n\n\t\t\tvar len:number = this._passes.length;\n\t\t\tfor (var i:number = 0; i < len; i++)\n\t\t\t\tfor (var j:number = 0; j < numOwners; j++)\n\t\t\t\t\tif (owners[j].animator)\n\t\t\t\t\t\t(<AnimatorBase> owners[j].animator).testGPUCompatibility(this._passes[i].shader);\n\n\t\t\treturn !this._renderObjectOwner.animationSet.usesCPU;\n\t\t}\n\n\t\treturn false;\n\t}\n}\n\nexport = RenderObjectBase;","import IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport IRenderObjectClass\t\t\t= require(\"awayjs-renderergl/lib/compilation/IRenderObjectClass\");\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * @class away.pool.RenderObjectPool\n */\nclass RenderObjectPool\n{\n\tprivate _renderObjectPool:Object = new Object();\n\tprivate _renderObjectClass:IRenderObjectClass;\n\tprivate _renderableClass:IRenderableClass;\n\tprivate _stage:Stage;\n\n\t/**\n\t * //TODO\n\t *\n\t * @param renderObjectClass\n\t */\n\tconstructor(renderObjectClass:IRenderObjectClass, renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tthis._renderObjectClass = renderObjectClass;\n\t\tthis._renderableClass = renderableClass;\n\t\tthis._stage = stage;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param renderableOwner\n\t * @returns IRenderable\n\t */\n\tpublic getItem(renderObjectOwner:IRenderObjectOwner):RenderObjectBase\n\t{\n\t\treturn (this._renderObjectPool[renderObjectOwner.id] || (this._renderObjectPool[renderObjectOwner.id] = renderObjectOwner._iAddRenderObject(new this._renderObjectClass(this, renderObjectOwner, this._renderableClass, this._stage))))\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param renderableOwner\n\t */\n\tpublic disposeItem(renderObjectOwner:IRenderObjectOwner)\n\t{\n\t\trenderObjectOwner._iRemoveRenderObject(this._renderObjectPool[renderObjectOwner.id]);\n\n\t\tthis._renderObjectPool[renderObjectOwner.id] = null;\n\t}\n}\n\nexport = RenderObjectPool;","import AnimationSetBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport IRenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/IRenderPassBase\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\n\n/**\n * ShaderCompilerBase is an abstract base class for shader compilers that use modular shader methods to assemble a\n * material. Concrete subclasses are used by the default materials.\n *\n * @see away.materials.ShadingMethodBase\n */\nclass ShaderCompilerBase\n{\n\tpublic _pShaderObject:ShaderObjectBase;\n\tpublic _pSharedRegisters:ShaderRegisterData;\n\tpublic _pRegisterCache:ShaderRegisterCache;\n\tpublic _pRenderableClass:IRenderableClass;\n\tpublic _pRenderPass:IRenderPassBase;\n\n\tpublic _pVertexCode:string = ''; // Changed to emtpy string- AwayTS\n\tpublic _pFragmentCode:string = '';// Changed to emtpy string - AwayTS\n\tpublic _pPostAnimationFragmentCode:string = '';// Changed to emtpy string - AwayTS\n\n\t//The attributes that need to be animated by animators.\n\tpublic _pAnimatableAttributes:Array<string>;\n\n\t//The target registers for animated properties, written to by the animators.\n\tpublic _pAnimationTargetRegisters:Array<string>;\n\n\t//The target register to place the animated UV coordinate.\n\tprivate _uvTarget:string;\n\n\t//The souce register providing the UV coordinate to animate.\n\tprivate _uvSource:string;\n\n\t/**\n\t * Creates a new ShaderCompilerBase object.\n\t * @param profile The compatibility profile of the renderer.\n\t */\n\tconstructor(renderableClass:IRenderableClass, renderPass:IRenderPassBase, shaderObject:ShaderObjectBase)\n\t{\n\t\tthis._pRenderableClass = renderableClass;\n\t\tthis._pRenderPass = renderPass;\n\t\tthis._pShaderObject = shaderObject;\n\n\t\tthis._pSharedRegisters = new ShaderRegisterData();\n\n\t\tthis._pRegisterCache = new ShaderRegisterCache(shaderObject.profile);\n\t\tthis._pRegisterCache.vertexAttributesOffset = renderableClass.vertexAttributesOffset;\n\t\tthis._pRegisterCache.reset();\n\t}\n\n\t/**\n\t * Compiles the code after all setup on the compiler has finished.\n\t */\n\tpublic compile()\n\t{\n\t\tthis._pShaderObject.reset();\n\n\t\tthis.pIncludeDependencies();\n\n\t\tthis.pInitRegisterIndices();\n\n\t\tthis.pCompileDependencies();\n\n\t\t//compile custom vertex & fragment codes\n\t\tthis._pVertexCode += this._pRenderPass._iGetVertexCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\n\t\tthis._pPostAnimationFragmentCode += this._pRenderPass._iGetFragmentCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\n\n\t\t//assign the final output color to the output register\n\t\tthis._pPostAnimationFragmentCode += \"mov \" + this._pRegisterCache.fragmentOutputRegister + \", \" + this._pSharedRegisters.shadedTarget + \"\\n\";\n\t\tthis._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.shadedTarget);\n\n\t\t//initialise the required shader constants\n\t\tthis._pShaderObject.initConstantData(this._pRegisterCache, this._pAnimatableAttributes, this._pAnimationTargetRegisters, this._uvSource, this._uvTarget);\n\t\tthis._pRenderPass._iInitConstantData(this._pShaderObject);\n\t}\n\n\tpublic pIncludeDependencies()\n\t{\n\t\tthis._pShaderObject._iIncludeDependencies();\n\n\t\tthis._pShaderObject.outputsNormals = this._pRenderPass._pOutputsNormals(this._pShaderObject);\n\t\tthis._pShaderObject.outputsTangentNormals = this._pShaderObject.outputsNormals && this._pRenderPass._pOutputsTangentNormals(this._pShaderObject);\n\t\tthis._pShaderObject.usesTangentSpace = this._pShaderObject.outputsTangentNormals && this._pRenderPass._pUsesTangentSpace(this._pShaderObject);\n\n\t\tif (!this._pShaderObject.usesTangentSpace && this._pShaderObject.viewDirDependencies > 0)\n\t\t\tthis._pShaderObject.globalPosDependencies++;\n\t}\n\n\t/**\n\t * Compile the code for the methods.\n\t */\n\tpublic pCompileDependencies()\n\t{\n\t\tthis._pSharedRegisters.shadedTarget = this._pRegisterCache.getFreeFragmentVectorTemp();\n\t\tthis._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadedTarget, 1);\n\n\t\t//compile the world-space position if required\n\t\tif (this._pShaderObject.globalPosDependencies > 0)\n\t\t\tthis.compileGlobalPositionCode();\n\n\t\t//Calculate the (possibly animated) UV coordinates.\n\t\tif (this._pShaderObject.uvDependencies > 0)\n\t\t\tthis.compileUVCode();\n\n\t\tif (this._pShaderObject.secondaryUVDependencies > 0)\n\t\t\tthis.compileSecondaryUVCode();\n\n\t\tif (this._pShaderObject.normalDependencies > 0)\n\t\t\tthis.compileNormalCode();\n\n\t\tif (this._pShaderObject.viewDirDependencies > 0)\n\t\t\tthis.compileViewDirCode();\n\n\t\t//collect code from material\n\t\tthis._pVertexCode += this._pRenderableClass._iGetVertexCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\n\t\tthis._pFragmentCode += this._pRenderableClass._iGetFragmentCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\n\n\t\t//collect code from pass\n\t\tthis._pVertexCode += this._pRenderPass._iGetPreLightingVertexCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\n\t\tthis._pFragmentCode += this._pRenderPass._iGetPreLightingFragmentCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\n\t}\n\n\tprivate compileGlobalPositionCode()\n\t{\n\t\tthis._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.globalPositionVertex = this._pRegisterCache.getFreeVertexVectorTemp(), this._pShaderObject.globalPosDependencies);\n\n\t\tvar sceneMatrixReg:ShaderRegisterElement = this._pRegisterCache.getFreeVertexConstant();\n\t\tthis._pRegisterCache.getFreeVertexConstant();\n\t\tthis._pRegisterCache.getFreeVertexConstant();\n\t\tthis._pRegisterCache.getFreeVertexConstant();\n\n\t\tthis._pShaderObject.sceneMatrixIndex = sceneMatrixReg.index*4;\n\n\t\tthis._pVertexCode += \"m44 \" + this._pSharedRegisters.globalPositionVertex + \", \" + this._pSharedRegisters.localPosition + \", \" + sceneMatrixReg + \"\\n\";\n\n\t\tif (this._pShaderObject.usesGlobalPosFragment) {\n\t\t\tthis._pSharedRegisters.globalPositionVarying = this._pRegisterCache.getFreeVarying();\n\t\t\tthis._pVertexCode += \"mov \" + this._pSharedRegisters.globalPositionVarying + \", \" + this._pSharedRegisters.globalPositionVertex + \"\\n\";\n\t\t}\n\t}\n\n\t/**\n\t * Calculate the (possibly animated) UV coordinates.\n\t */\n\tprivate compileUVCode()\n\t{\n\t\tvar uvAttributeReg:ShaderRegisterElement = this._pRegisterCache.getFreeVertexAttribute();\n\t\tthis._pShaderObject.uvBufferIndex = uvAttributeReg.index;\n\n\t\tvar varying:ShaderRegisterElement = this._pRegisterCache.getFreeVarying();\n\n\t\tthis._pSharedRegisters.uvVarying = varying;\n\n\t\tif (this._pShaderObject.usesUVTransform) {\n\t\t\t// a, b, 0, tx\n\t\t\t// c, d, 0, ty\n\t\t\tvar uvTransform1:ShaderRegisterElement = this._pRegisterCache.getFreeVertexConstant();\n\t\t\tvar uvTransform2:ShaderRegisterElement = this._pRegisterCache.getFreeVertexConstant();\n\t\t\tthis._pShaderObject.uvTransformIndex = uvTransform1.index*4;\n\n\t\t\tthis._pVertexCode += \"dp4 \" + varying + \".x, \" + uvAttributeReg + \", \" + uvTransform1 + \"\\n\" +\n\t\t\t\t\t\t\t\t \"dp4 \" + varying + \".y, \" + uvAttributeReg + \", \" + uvTransform2 + \"\\n\" +\n\t\t\t\t\t\t\t\t \"mov \" + varying + \".zw, \" + uvAttributeReg + \".zw \\n\";\n\t\t} else {\n\t\t\tthis._pShaderObject.uvTransformIndex = -1;\n\t\t\tthis._uvTarget = varying.toString();\n\t\t\tthis._uvSource = uvAttributeReg.toString();\n\t\t}\n\t}\n\n\t/**\n\t * Provide the secondary UV coordinates.\n\t */\n\tprivate compileSecondaryUVCode()\n\t{\n\t\tvar uvAttributeReg:ShaderRegisterElement = this._pRegisterCache.getFreeVertexAttribute();\n\t\tthis._pShaderObject.secondaryUVBufferIndex = uvAttributeReg.index;\n\t\tthis._pSharedRegisters.secondaryUVVarying = this._pRegisterCache.getFreeVarying();\n\t\tthis._pVertexCode += \"mov \" + this._pSharedRegisters.secondaryUVVarying + \", \" + uvAttributeReg + \"\\n\";\n\t}\n\n\t/**\n\t * Calculate the view direction.\n\t */\n\tpublic compileViewDirCode()\n\t{\n\t\tvar cameraPositionReg:ShaderRegisterElement = this._pRegisterCache.getFreeVertexConstant();\n\t\tthis._pSharedRegisters.viewDirVarying = this._pRegisterCache.getFreeVarying();\n\t\tthis._pSharedRegisters.viewDirFragment = this._pRegisterCache.getFreeFragmentVectorTemp();\n\t\tthis._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.viewDirFragment, this._pShaderObject.viewDirDependencies);\n\n\t\tthis._pShaderObject.cameraPositionIndex = cameraPositionReg.index*4;\n\n\t\tif (this._pShaderObject.usesTangentSpace) {\n\t\t\tvar temp:ShaderRegisterElement = this._pRegisterCache.getFreeVertexVectorTemp();\n\t\t\tthis._pVertexCode += \"sub \" + temp + \", \" + cameraPositionReg + \", \" + this._pSharedRegisters.localPosition + \"\\n\" +\n\t\t\t\t\"m33 \" + this._pSharedRegisters.viewDirVarying + \".xyz, \" + temp + \", \" + this._pSharedRegisters.animatedTangent + \"\\n\" +\n\t\t\t\t\"mov \" + this._pSharedRegisters.viewDirVarying + \".w, \" + this._pSharedRegisters.localPosition + \".w\\n\";\n\t\t} else {\n\t\t\tthis._pVertexCode += \"sub \" + this._pSharedRegisters.viewDirVarying + \", \" + cameraPositionReg + \", \" + this._pSharedRegisters.globalPositionVertex + \"\\n\";\n\t\t\tthis._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex);\n\t\t}\n\n\t\t//TODO is this required in all cases? (re: distancemappass)\n\t\tthis._pFragmentCode += \"nrm \" + this._pSharedRegisters.viewDirFragment + \".xyz, \" + this._pSharedRegisters.viewDirVarying + \"\\n\" +\n\t\t\t\"mov \" + this._pSharedRegisters.viewDirFragment + \".w,   \" + this._pSharedRegisters.viewDirVarying + \".w\\n\";\n\t}\n\n\t/**\n\t * Calculate the normal.\n\t */\n\tpublic compileNormalCode()\n\t{\n\t\tthis._pSharedRegisters.normalFragment = this._pRegisterCache.getFreeFragmentVectorTemp();\n\t\tthis._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.normalFragment, this._pShaderObject.normalDependencies);\n\n\t\t//simple normal aquisition if no tangent space is being used\n\t\tif (this._pShaderObject.outputsNormals && !this._pShaderObject.outputsTangentNormals) {\n\t\t\tthis._pVertexCode += this._pRenderPass._iGetNormalVertexCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\n\t\t\tthis._pFragmentCode += this._pRenderPass._iGetNormalFragmentCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\n\n\t\t\treturn;\n\t\t}\n\n\t\tvar normalMatrix:Array<ShaderRegisterElement>;\n\n\t\tif (!this._pShaderObject.outputsNormals || !this._pShaderObject.usesTangentSpace) {\n\t\t\tnormalMatrix = new Array<ShaderRegisterElement>(3);\n\t\t\tnormalMatrix[0] = this._pRegisterCache.getFreeVertexConstant();\n\t\t\tnormalMatrix[1] = this._pRegisterCache.getFreeVertexConstant();\n\t\t\tnormalMatrix[2] = this._pRegisterCache.getFreeVertexConstant();\n\n\t\t\tthis._pRegisterCache.getFreeVertexConstant();\n\n\t\t\tthis._pShaderObject.sceneNormalMatrixIndex = normalMatrix[0].index*4;\n\n\t\t\tthis._pSharedRegisters.normalVarying = this._pRegisterCache.getFreeVarying();\n\t\t}\n\n\t\tif (this._pShaderObject.outputsNormals) {\n\t\t\tif (this._pShaderObject.usesTangentSpace) {\n\t\t\t\t// normalize normal + tangent vector and generate (approximated) bitangent used in m33 operation for view\n\t\t\t\tthis._pVertexCode += \"nrm \" + this._pSharedRegisters.animatedNormal + \".xyz, \" + this._pSharedRegisters.animatedNormal + \"\\n\" +\n\t\t\t\t\t\"nrm \" + this._pSharedRegisters.animatedTangent + \".xyz, \" + this._pSharedRegisters.animatedTangent + \"\\n\" +\n\t\t\t\t\t\"crs \" + this._pSharedRegisters.bitangent + \".xyz, \" + this._pSharedRegisters.animatedNormal + \", \" + this._pSharedRegisters.animatedTangent + \"\\n\";\n\n\t\t\t\tthis._pFragmentCode += this._pRenderPass._iGetNormalFragmentCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\n\t\t\t} else {\n\t\t\t\t//Compiles the vertex shader code for tangent-space normal maps.\n\t\t\t\tthis._pSharedRegisters.tangentVarying = this._pRegisterCache.getFreeVarying();\n\t\t\t\tthis._pSharedRegisters.bitangentVarying = this._pRegisterCache.getFreeVarying();\n\t\t\t\tvar temp:ShaderRegisterElement = this._pRegisterCache.getFreeVertexVectorTemp();\n\n\t\t\t\tthis._pVertexCode += \"m33 \" + temp + \".xyz, \" + this._pSharedRegisters.animatedNormal + \", \" + normalMatrix[0] + \"\\n\" +\n\t\t\t\t\t\"nrm \" + this._pSharedRegisters.animatedNormal + \".xyz, \" + temp + \"\\n\" +\n\t\t\t\t\t\"m33 \" + temp + \".xyz, \" + this._pSharedRegisters.animatedTangent + \", \" + normalMatrix[0] + \"\\n\" +\n\t\t\t\t\t\"nrm \" + this._pSharedRegisters.animatedTangent + \".xyz, \" + temp + \"\\n\" +\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.tangentVarying + \".x, \" + this._pSharedRegisters.animatedTangent + \".x  \\n\" +\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.tangentVarying + \".z, \" + this._pSharedRegisters.animatedNormal + \".x  \\n\" +\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.tangentVarying + \".w, \" + this._pSharedRegisters.normalInput + \".w  \\n\" +\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.bitangentVarying + \".x, \" + this._pSharedRegisters.animatedTangent + \".y  \\n\" +\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.bitangentVarying + \".z, \" + this._pSharedRegisters.animatedNormal + \".y  \\n\" +\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.bitangentVarying + \".w, \" + this._pSharedRegisters.normalInput + \".w  \\n\" +\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.normalVarying + \".x, \" + this._pSharedRegisters.animatedTangent + \".z  \\n\" +\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.normalVarying + \".z, \" + this._pSharedRegisters.animatedNormal + \".z  \\n\" +\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.normalVarying + \".w, \" + this._pSharedRegisters.normalInput + \".w  \\n\" +\n\t\t\t\t\t\"crs \" + temp + \".xyz, \" + this._pSharedRegisters.animatedNormal + \", \" + this._pSharedRegisters.animatedTangent + \"\\n\" +\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.tangentVarying + \".y, \" + temp + \".x    \\n\" +\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.bitangentVarying + \".y, \" + temp + \".y  \\n\" +\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.normalVarying + \".y, \" + temp + \".z    \\n\";\n\n\t\t\t\tthis._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedTangent);\n\n\t\t\t\t//Compiles the fragment shader code for tangent-space normal maps.\n\t\t\t\tvar t:ShaderRegisterElement;\n\t\t\t\tvar b:ShaderRegisterElement;\n\t\t\t\tvar n:ShaderRegisterElement;\n\n\t\t\t\tt = this._pRegisterCache.getFreeFragmentVectorTemp();\n\t\t\t\tthis._pRegisterCache.addFragmentTempUsages(t, 1);\n\t\t\t\tb = this._pRegisterCache.getFreeFragmentVectorTemp();\n\t\t\t\tthis._pRegisterCache.addFragmentTempUsages(b, 1);\n\t\t\t\tn = this._pRegisterCache.getFreeFragmentVectorTemp();\n\t\t\t\tthis._pRegisterCache.addFragmentTempUsages(n, 1);\n\n\t\t\t\tthis._pFragmentCode += \"nrm \" + t + \".xyz, \" + this._pSharedRegisters.tangentVarying + \"\\n\" +\n\t\t\t\t\t\"mov \" + t + \".w, \" + this._pSharedRegisters.tangentVarying + \".w\t\\n\" +\n\t\t\t\t\t\"nrm \" + b + \".xyz, \" + this._pSharedRegisters.bitangentVarying + \"\\n\" +\n\t\t\t\t\t\"nrm \" + n + \".xyz, \" + this._pSharedRegisters.normalVarying + \"\\n\";\n\n\t\t\t\t//compile custom fragment code for normal calcs\n\t\t\t\tthis._pFragmentCode += this._pRenderPass._iGetNormalFragmentCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters) +\n\t\t\t\t\t\"m33 \" + this._pSharedRegisters.normalFragment + \".xyz, \" + this._pSharedRegisters.normalFragment + \", \" + t + \"\\n\" +\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.normalFragment + \".w, \" + this._pSharedRegisters.normalVarying + \".w\\n\";\n\n\t\t\t\tthis._pRegisterCache.removeFragmentTempUsage(b);\n\t\t\t\tthis._pRegisterCache.removeFragmentTempUsage(t);\n\t\t\t\tthis._pRegisterCache.removeFragmentTempUsage(n);\n\t\t\t}\n\t\t} else {\n\t\t\t// no output, world space is enough\n\t\t\tthis._pVertexCode += \"m33 \" + this._pSharedRegisters.normalVarying + \".xyz, \" + this._pSharedRegisters.animatedNormal + \", \" + normalMatrix[0] + \"\\n\" +\n\t\t\t\t\"mov \" + this._pSharedRegisters.normalVarying + \".w, \" + this._pSharedRegisters.animatedNormal + \".w\\n\";\n\n\t\t\tthis._pFragmentCode += \"nrm \" + this._pSharedRegisters.normalFragment + \".xyz, \" + this._pSharedRegisters.normalVarying + \"\\n\" +\n\t\t\t\t\"mov \" + this._pSharedRegisters.normalFragment + \".w, \" + this._pSharedRegisters.normalVarying + \".w\\n\";\n\n\t\t\tif (this._pShaderObject.tangentDependencies > 0) {\n\t\t\t\tthis._pSharedRegisters.tangentVarying = this._pRegisterCache.getFreeVarying();\n\n\t\t\t\tthis._pVertexCode += \"m33 \" + this._pSharedRegisters.tangentVarying + \".xyz, \" + this._pSharedRegisters.animatedTangent + \", \" + normalMatrix[0] + \"\\n\" +\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.tangentVarying + \".w, \" + this._pSharedRegisters.animatedTangent + \".w\\n\";\n\t\t\t}\n\t\t}\n\n\t\tif (!this._pShaderObject.usesTangentSpace)\n\t\t\tthis._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedNormal);\n\t}\n\n\t/**\n\t * Reset all the indices to \"unused\".\n\t */\n\tpublic pInitRegisterIndices()\n\t{\n\t\tthis._pShaderObject.pInitRegisterIndices();\n\n\t\tthis._pAnimatableAttributes = new Array<string>(\"va0\");\n\t\tthis._pAnimationTargetRegisters = new Array<string>(\"vt0\");\n\t\tthis._pVertexCode = \"\";\n\t\tthis._pFragmentCode = \"\";\n\t\tthis._pPostAnimationFragmentCode = \"\";\n\n\t\tthis._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.localPosition = this._pRegisterCache.getFreeVertexVectorTemp(), 1);\n\n\t\t//create commonly shared constant registers\n\t\tthis._pSharedRegisters.commons = this._pRegisterCache.getFreeFragmentConstant();\n\t\tthis._pShaderObject.commonsDataIndex = this._pSharedRegisters.commons.index*4;\n\n\t\t//Creates the registers to contain the tangent data.\n\t\t// need to be created FIRST and in this order (for when using tangent space)\n\t\tif (this._pShaderObject.tangentDependencies > 0 || this._pShaderObject.outputsNormals) {\n\t\t\tthis._pSharedRegisters.tangentInput = this._pRegisterCache.getFreeVertexAttribute();\n\t\t\tthis._pShaderObject.tangentBufferIndex = this._pSharedRegisters.tangentInput.index;\n\n\t\t\tthis._pSharedRegisters.animatedTangent = this._pRegisterCache.getFreeVertexVectorTemp();\n\t\t\tthis._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedTangent, 1);\n\n\t\t\tif (this._pShaderObject.usesTangentSpace) {\n\t\t\t\tthis._pSharedRegisters.bitangent = this._pRegisterCache.getFreeVertexVectorTemp();\n\t\t\t\tthis._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.bitangent, 1);\n\t\t\t}\n\n\t\t\tthis._pAnimatableAttributes.push(this._pSharedRegisters.tangentInput.toString());\n\t\t\tthis._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedTangent.toString());\n\t\t}\n\n\t\tif (this._pShaderObject.normalDependencies > 0) {\n\t\t\tthis._pSharedRegisters.normalInput = this._pRegisterCache.getFreeVertexAttribute();\n\t\t\tthis._pShaderObject.normalBufferIndex = this._pSharedRegisters.normalInput.index;\n\n\t\t\tthis._pSharedRegisters.animatedNormal = this._pRegisterCache.getFreeVertexVectorTemp();\n\t\t\tthis._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedNormal, 1);\n\n\t\t\tthis._pAnimatableAttributes.push(this._pSharedRegisters.normalInput.toString());\n\t\t\tthis._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedNormal.toString());\n\t\t}\n\n\t\tif (this._pShaderObject.colorDependencies > 0) {\n\t\t\tthis._pSharedRegisters.colorInput = this._pRegisterCache.getFreeVertexAttribute();\n\t\t\tthis._pShaderObject.colorBufferIndex = this._pSharedRegisters.colorInput.index;\n\n\t\t\tthis._pSharedRegisters.colorVarying = this._pRegisterCache.getFreeVarying();\n\t\t\tthis._pVertexCode += \"mov \" + this._pSharedRegisters.colorVarying + \", \" + this._pSharedRegisters.colorInput + \"\\n\";\n\t\t}\n\t}\n\n\t/**\n\t * Disposes all resources used by the compiler.\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._pRegisterCache.dispose();\n\t\tthis._pRegisterCache = null;\n\t\tthis._pSharedRegisters = null;\n\t}\n\n\t/**\n\t * The generated vertex code.\n\t */\n\tpublic get vertexCode():string\n\t{\n\t\treturn this._pVertexCode;\n\t}\n\n\t/**\n\t * The generated fragment code.\n\t */\n\tpublic get fragmentCode():string\n\t{\n\t\treturn this._pFragmentCode;\n\t}\n\n\t/**\n\t * The generated fragment code.\n\t */\n\tpublic get postAnimationFragmentCode():string\n\t{\n\t\treturn this._pPostAnimationFragmentCode;\n\t}\n\n\t/**\n\t * The register name containing the final shaded colour.\n\t */\n\tpublic get shadedTarget():string\n\t{\n\t\treturn this._pSharedRegisters.shadedTarget.toString();\n\t}\n}\n\nexport = ShaderCompilerBase;","import ContextGLProfile\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProfile\");\n\nimport ShaderLightingObject\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\nimport ShaderCompilerBase\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderCompilerBase\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport IRenderLightingPass\t\t= require(\"awayjs-renderergl/lib/passes/IRenderLightingPass\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\n\n/**\n * ShaderCompilerBase is an abstract base class for shader compilers that use modular shader methods to assemble a\n * material. Concrete subclasses are used by the default materials.\n *\n * @see away.materials.ShadingMethodBase\n */\nclass ShaderLightingCompiler extends ShaderCompilerBase\n{\n\tprivate _shaderLightingObject:ShaderLightingObject;\n\tprivate _renderLightingPass:IRenderLightingPass;\n\tpublic _pointLightFragmentConstants:Array<ShaderRegisterElement>;\n\tpublic _pointLightVertexConstants:Array<ShaderRegisterElement>;\n\tpublic _dirLightFragmentConstants:Array<ShaderRegisterElement>;\n\tpublic _dirLightVertexConstants:Array<ShaderRegisterElement>;\n\n\tpublic _pNumProbeRegisters:number;\n\n\t/**\n\t * Creates a new ShaderCompilerBase object.\n\t * @param profile The compatibility profile of the renderer.\n\t */\n\tconstructor(renderableClass:IRenderableClass, renderLightingPass:IRenderLightingPass, shaderLightingObject:ShaderLightingObject)\n\t{\n\t\tsuper(renderableClass, renderLightingPass, shaderLightingObject);\n\n\t\tthis._shaderLightingObject = shaderLightingObject;\n\t\tthis._renderLightingPass = renderLightingPass;\n\t}\n\n\t/**\n\t * Compile the code for the methods.\n\t */\n\tpublic pCompileDependencies()\n\t{\n\t\tsuper.pCompileDependencies();\n\n\t\t//compile the lighting code\n\t\tif (this._shaderLightingObject.usesShadows)\n\t\t\tthis.pCompileShadowCode();\n\n\t\tif (this._shaderLightingObject.usesLights) {\n\t\t\tthis.initLightRegisters();\n\t\t\tthis.compileLightCode();\n\t\t}\n\n\t\tif (this._shaderLightingObject.usesProbes)\n\t\t\tthis.compileLightProbeCode();\n\n\t\tthis._pVertexCode += this._renderLightingPass._iGetPostLightingVertexCode(this._shaderLightingObject, this._pRegisterCache, this._pSharedRegisters);\n\t\tthis._pFragmentCode += this._renderLightingPass._iGetPostLightingFragmentCode(this._shaderLightingObject, this._pRegisterCache, this._pSharedRegisters);\n\t}\n\n\t/**\n\t * Provides the code to provide shadow mapping.\n\t */\n\tpublic pCompileShadowCode()\n\t{\n\t\tif (this._shaderLightingObject.normalDependencies > 0) {\n\t\t\tthis._pSharedRegisters.shadowTarget = this._pSharedRegisters.normalFragment;\n\t\t} else {\n\t\t\tthis._pSharedRegisters.shadowTarget = this._pRegisterCache.getFreeFragmentVectorTemp();\n\t\t\tthis._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadowTarget, 1);\n\t\t}\n\t}\n\n\t/**\n\t * Initializes constant registers to contain light data.\n\t */\n\tprivate initLightRegisters()\n\t{\n\t\t// init these first so we're sure they're in sequence\n\t\tvar i:number, len:number;\n\n\t\tif (this._dirLightVertexConstants) {\n\t\t\tlen = this._dirLightVertexConstants.length;\n\t\t\tfor (i = 0; i < len; ++i) {\n\t\t\t\tthis._dirLightVertexConstants[i] = this._pRegisterCache.getFreeVertexConstant();\n\n\t\t\t\tif (this._shaderLightingObject.lightVertexConstantIndex == -1)\n\t\t\t\t\tthis._shaderLightingObject.lightVertexConstantIndex = this._dirLightVertexConstants[i].index*4;\n\t\t\t}\n\t\t}\n\n\t\tif (this._pointLightVertexConstants) {\n\t\t\tlen = this._pointLightVertexConstants.length;\n\t\t\tfor (i = 0; i < len; ++i) {\n\t\t\t\tthis._pointLightVertexConstants[i] = this._pRegisterCache.getFreeVertexConstant();\n\n\t\t\t\tif (this._shaderLightingObject.lightVertexConstantIndex == -1)\n\t\t\t\t\tthis._shaderLightingObject.lightVertexConstantIndex = this._pointLightVertexConstants[i].index*4;\n\t\t\t}\n\t\t}\n\n\t\tlen = this._dirLightFragmentConstants.length;\n\t\tfor (i = 0; i < len; ++i) {\n\t\t\tthis._dirLightFragmentConstants[i] = this._pRegisterCache.getFreeFragmentConstant();\n\n\t\t\tif (this._shaderLightingObject.lightFragmentConstantIndex == -1)\n\t\t\t\tthis._shaderLightingObject.lightFragmentConstantIndex = this._dirLightFragmentConstants[i].index*4;\n\t\t}\n\n\t\tlen = this._pointLightFragmentConstants.length;\n\t\tfor (i = 0; i < len; ++i) {\n\t\t\tthis._pointLightFragmentConstants[i] = this._pRegisterCache.getFreeFragmentConstant();\n\n\t\t\tif (this._shaderLightingObject.lightFragmentConstantIndex == -1)\n\t\t\t\tthis._shaderLightingObject.lightFragmentConstantIndex = this._pointLightFragmentConstants[i].index*4;\n\t\t}\n\t}\n\n\t/**\n\t * Compiles the shading code for directional and point lights.\n\t */\n\tprivate compileLightCode()\n\t{\n\t\tvar diffuseColorReg:ShaderRegisterElement;\n\t\tvar specularColorReg:ShaderRegisterElement;\n\t\tvar lightPosReg:ShaderRegisterElement;\n\t\tvar lightDirReg:ShaderRegisterElement;\n\t\tvar vertexRegIndex:number = 0;\n\t\tvar fragmentRegIndex:number = 0;\n\t\tvar addSpec:boolean = this._shaderLightingObject.usesLightsForSpecular;\n\t\tvar addDiff:boolean = this._shaderLightingObject.usesLightsForDiffuse;\n\n\t\t//compile the shading code for directional lights.\n\t\tfor (var i:number = 0; i < this._shaderLightingObject.numDirectionalLights; ++i) {\n\t\t\tif (this._shaderLightingObject.usesTangentSpace) {\n\t\t\t\tlightDirReg = this._dirLightVertexConstants[vertexRegIndex++];\n\n\t\t\t\tvar lightVarying:ShaderRegisterElement = this._pRegisterCache.getFreeVarying();\n\n\t\t\t\tthis._pVertexCode += \"m33 \" + lightVarying + \".xyz, \" + lightDirReg + \", \" + this._pSharedRegisters.animatedTangent + \"\\n\" +\n\t\t\t\t\t\"mov \" + lightVarying + \".w, \" + lightDirReg + \".w\\n\";\n\n\t\t\t\tlightDirReg = this._pRegisterCache.getFreeFragmentVectorTemp();\n\t\t\t\tthis._pRegisterCache.addVertexTempUsages(lightDirReg, 1);\n\n\t\t\t\tthis._pFragmentCode += \"nrm \" + lightDirReg + \".xyz, \" + lightVarying + \"\\n\" +\n\t\t\t\t\t\"mov \" + lightDirReg + \".w, \" + lightVarying + \".w\\n\";\n\n\t\t\t} else {\n\t\t\t\tlightDirReg = this._dirLightFragmentConstants[fragmentRegIndex++];\n\t\t\t}\n\n\t\t\tdiffuseColorReg = this._dirLightFragmentConstants[fragmentRegIndex++];\n\t\t\tspecularColorReg = this._dirLightFragmentConstants[fragmentRegIndex++];\n\n\t\t\tif (addDiff)\n\t\t\t\tthis._pFragmentCode += this._renderLightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject, lightDirReg, diffuseColorReg, this._pRegisterCache, this._pSharedRegisters);\n\n\t\t\tif (addSpec)\n\t\t\t\tthis._pFragmentCode += this._renderLightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject, lightDirReg, specularColorReg, this._pRegisterCache, this._pSharedRegisters);\n\n\t\t\tif (this._shaderLightingObject.usesTangentSpace)\n\t\t\t\tthis._pRegisterCache.removeVertexTempUsage(lightDirReg);\n\t\t}\n\n\t\tvertexRegIndex = 0;\n\t\tfragmentRegIndex = 0;\n\n\t\t//compile the shading code for point lights\n\t\tfor (var i:number = 0; i < this._shaderLightingObject.numPointLights; ++i) {\n\n\t\t\tif (this._shaderLightingObject.usesTangentSpace || !this._shaderLightingObject.usesGlobalPosFragment)\n\t\t\t\tlightPosReg = this._pointLightVertexConstants[vertexRegIndex++];\n\t\t\telse\n\t\t\t\tlightPosReg = this._pointLightFragmentConstants[fragmentRegIndex++];\n\n\t\t\tdiffuseColorReg = this._pointLightFragmentConstants[fragmentRegIndex++];\n\t\t\tspecularColorReg = this._pointLightFragmentConstants[fragmentRegIndex++];\n\n\t\t\tlightDirReg = this._pRegisterCache.getFreeFragmentVectorTemp();\n\t\t\tthis._pRegisterCache.addFragmentTempUsages(lightDirReg, 1);\n\n\t\t\tvar lightVarying:ShaderRegisterElement;\n\n\t\t\tif (this._shaderLightingObject.usesTangentSpace) {\n\t\t\t\tlightVarying = this._pRegisterCache.getFreeVarying();\n\t\t\t\tvar temp:ShaderRegisterElement = this._pRegisterCache.getFreeVertexVectorTemp();\n\t\t\t\tthis._pVertexCode += \"sub \" + temp + \", \" + lightPosReg + \", \" + this._pSharedRegisters.localPosition + \"\\n\" +\n\t\t\t\t\t\"m33 \" + lightVarying + \".xyz, \" + temp + \", \" + this._pSharedRegisters.animatedTangent + \"\\n\" +\n\t\t\t\t\t\"mov \" + lightVarying + \".w, \" + this._pSharedRegisters.localPosition + \".w\\n\";\n\t\t\t} else if (!this._shaderLightingObject.usesGlobalPosFragment) {\n\t\t\t\tlightVarying = this._pRegisterCache.getFreeVarying();\n\t\t\t\tthis._pVertexCode += \"sub \" + lightVarying + \", \" + lightPosReg + \", \" + this._pSharedRegisters.globalPositionVertex + \"\\n\";\n\t\t\t} else {\n\t\t\t\tlightVarying = lightDirReg;\n\t\t\t\tthis._pFragmentCode += \"sub \" + lightDirReg + \", \" + lightPosReg + \", \" + this._pSharedRegisters.globalPositionVarying + \"\\n\";\n\t\t\t}\n\n\t\t\tif (this._shaderLightingObject.usesLightFallOff) {\n\t\t\t\t// calculate attenuation\n\t\t\t\tthis._pFragmentCode += // attenuate\n\t\t\t\t\t\"dp3 \" + lightDirReg + \".w, \" + lightVarying + \", \" + lightVarying + \"\\n\" + // w = d - radius\n\t\t\t\t\t\"sub \" + lightDirReg + \".w, \" + lightDirReg + \".w, \" + diffuseColorReg + \".w\\n\" + // w = (d - radius)/(max-min)\n\t\t\t\t\t\"mul \" + lightDirReg + \".w, \" + lightDirReg + \".w, \" + specularColorReg + \".w\\n\" + // w = clamp(w, 0, 1)\n\t\t\t\t\t\"sat \" + lightDirReg + \".w, \" + lightDirReg + \".w\\n\" + // w = 1-w\n\t\t\t\t\t\"sub \" + lightDirReg + \".w, \" + this._pSharedRegisters.commons + \".w, \" + lightDirReg + \".w\\n\" + // normalize\n\t\t\t\t\t\"nrm \" + lightDirReg + \".xyz, \" + lightVarying + \"\\n\";\n\t\t\t} else {\n\t\t\t\tthis._pFragmentCode += \"nrm \" + lightDirReg + \".xyz, \" + lightVarying + \"\\n\" +\n\t\t\t\t\t\"mov \" + lightDirReg + \".w, \" + lightVarying + \".w\\n\";\n\t\t\t}\n\n\t\t\tif (this._shaderLightingObject.lightFragmentConstantIndex == -1)\n\t\t\t\tthis._shaderLightingObject.lightFragmentConstantIndex = lightPosReg.index*4;\n\n\t\t\tif (addDiff)\n\t\t\t\tthis._pFragmentCode += this._renderLightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject, lightDirReg, diffuseColorReg, this._pRegisterCache, this._pSharedRegisters);\n\n\t\t\tif (addSpec)\n\t\t\t\tthis._pFragmentCode += this._renderLightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject, lightDirReg, specularColorReg, this._pRegisterCache, this._pSharedRegisters);\n\n\t\t\tthis._pRegisterCache.removeFragmentTempUsage(lightDirReg);\n\t\t}\n\t}\n\n\t/**\n\t * Compiles shading code for light probes.\n\t */\n\tprivate compileLightProbeCode()\n\t{\n\t\tvar weightReg:string;\n\t\tvar weightComponents = [ \".x\", \".y\", \".z\", \".w\" ];\n\t\tvar weightRegisters:Array<ShaderRegisterElement> = new Array<ShaderRegisterElement>();\n\t\tvar i:number;\n\t\tvar texReg:ShaderRegisterElement;\n\t\tvar addSpec:boolean = this._shaderLightingObject.usesProbesForSpecular;\n\t\tvar addDiff:boolean = this._shaderLightingObject.usesProbesForDiffuse;\n\n\t\tif (addDiff)\n\t\t\tthis._shaderLightingObject.lightProbeDiffuseIndices = new Array<number>();\n\n\t\tif (addSpec)\n\t\t\tthis._shaderLightingObject.lightProbeSpecularIndices = new Array<number>();\n\n\t\tfor (i = 0; i < this._pNumProbeRegisters; ++i) {\n\t\t\tweightRegisters[i] = this._pRegisterCache.getFreeFragmentConstant();\n\n\t\t\tif (i == 0)\n\t\t\t\tthis._shaderLightingObject.probeWeightsIndex = weightRegisters[i].index*4;\n\t\t}\n\n\t\tfor (i = 0; i < this._shaderLightingObject.numLightProbes; ++i) {\n\t\t\tweightReg = weightRegisters[Math.floor(i/4)].toString() + weightComponents[i%4];\n\n\t\t\tif (addDiff) {\n\t\t\t\ttexReg = this._pRegisterCache.getFreeTextureReg();\n\t\t\t\tthis._shaderLightingObject.lightProbeDiffuseIndices[i] = texReg.index;\n\t\t\t\tthis._pFragmentCode += this._renderLightingPass._iGetPerProbeDiffuseFragmentCode(this._shaderLightingObject, texReg, weightReg, this._pRegisterCache, this._pSharedRegisters);\n\t\t\t}\n\n\t\t\tif (addSpec) {\n\t\t\t\ttexReg = this._pRegisterCache.getFreeTextureReg();\n\t\t\t\tthis._shaderLightingObject.lightProbeSpecularIndices[i] = texReg.index;\n\t\t\t\tthis._pFragmentCode += this._renderLightingPass._iGetPerProbeSpecularFragmentCode(this._shaderLightingObject, texReg, weightReg, this._pRegisterCache, this._pSharedRegisters);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Reset all the indices to \"unused\".\n\t */\n\tpublic pInitRegisterIndices()\n\t{\n\t\tsuper.pInitRegisterIndices();\n\n\t\tthis._shaderLightingObject.lightVertexConstantIndex = -1;\n\t\tthis._shaderLightingObject.lightFragmentConstantIndex = -1;\n\t\tthis._shaderLightingObject.probeWeightsIndex = -1;\n\n\t\tthis._pNumProbeRegisters = Math.ceil(this._shaderLightingObject.numLightProbes/4);\n\n\t\t//init light data\n\t\tif (this._shaderLightingObject.usesTangentSpace || !this._shaderLightingObject.usesGlobalPosFragment) {\n\t\t\tthis._pointLightVertexConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numPointLights);\n\t\t\tthis._pointLightFragmentConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numPointLights*2);\n\t\t} else {\n\t\t\tthis._pointLightFragmentConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numPointLights*3);\n\t\t}\n\n\t\tif (this._shaderLightingObject.usesTangentSpace) {\n\t\t\tthis._dirLightVertexConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numDirectionalLights);\n\t\t\tthis._dirLightFragmentConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numDirectionalLights*2);\n\t\t} else {\n\t\t\tthis._dirLightFragmentConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numDirectionalLights*3);\n\t\t}\n\t}\n}\n\nexport = ShaderLightingCompiler;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport DirectionalLight\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\nimport LightProbe\t\t\t\t\t= require(\"awayjs-display/lib/entities/LightProbe\");\nimport PointLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\nimport LightPickerBase\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport LightSources\t\t\t\t\t= require(\"awayjs-display/lib/materials/LightSources\");\n\nimport ContextGLProfile\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProfile\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\n\nimport IRenderLightingPass\t\t\t= require(\"awayjs-renderergl/lib/passes/IRenderLightingPass\");\nimport ShaderLightingCompiler\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingCompiler\");\n\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport ShaderCompilerBase\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderCompilerBase\");\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\n\n/**\n * ShaderObjectBase keeps track of the number of dependencies for \"named registers\" used across a pass.\n * Named registers are that are not necessarily limited to a single method. They are created by the compiler and\n * passed on to methods. The compiler uses the results to reserve usages through RegisterPool, which can be removed\n * each time a method has been compiled into the shader.\n *\n * @see RegisterPool.addUsage\n */\nclass ShaderLightingObject extends ShaderObjectBase\n{\n\tpublic _renderLightingPass:IRenderLightingPass;\n\n\tprivate _includeCasters:boolean = true;\n\n\t/**\n\t * The first index for the fragment constants containing the light data.\n\t */\n\tpublic lightFragmentConstantIndex:number;\n\n\t/**\n\t * The starting index if the vertex constant to which light data needs to be uploaded.\n\t */\n\tpublic lightVertexConstantIndex:number;\n\n\t/**\n\t * Indices for the light probe diffuse textures.\n\t */\n\tpublic lightProbeDiffuseIndices:Array<number> /*uint*/;\n\n\t/**\n\t * Indices for the light probe specular textures.\n\t */\n\tpublic lightProbeSpecularIndices:Array<number> /*uint*/;\n\n\t/**\n\t * The index of the fragment constant containing the weights for the light probes.\n\t */\n\tpublic probeWeightsIndex:number;\n\n\tpublic numLights:number;\n\tpublic numDirectionalLights:number;\n\tpublic numPointLights:number;\n\tpublic numLightProbes:number;\n\n\tpublic usesLightFallOff:boolean;\n\n\tpublic usesShadows:boolean;\n\n\t/**\n\t * Indicates whether the shader uses any lights.\n\t */\n\tpublic usesLights:boolean;\n\n\t/**\n\t * Indicates whether the shader uses any light probes.\n\t */\n\tpublic usesProbes:boolean;\n\n\t/**\n\t * Indicates whether the lights uses any specular components.\n\t */\n\tpublic usesLightsForSpecular:boolean;\n\n\t/**\n\t * Indicates whether the probes uses any specular components.\n\t */\n\tpublic usesProbesForSpecular:boolean;\n\n\t/**\n\t * Indicates whether the lights uses any diffuse components.\n\t */\n\tpublic usesLightsForDiffuse:boolean;\n\n\t/**\n\t * Indicates whether the probes uses any diffuse components.\n\t */\n\tpublic usesProbesForDiffuse:boolean;\n\n\t/**\n\t * Creates a new MethodCompilerVO object.\n\t */\n\tconstructor(renderableClass:IRenderableClass, renderLightingPass:IRenderLightingPass, stage:Stage)\n\t{\n\t\tsuper(renderableClass, renderLightingPass, stage);\n\n\t\tthis._renderLightingPass = renderLightingPass;\n\t}\n\n\tpublic _iIncludeDependencies()\n\t{\n\t\tthis.numPointLights = this._renderLightingPass.numPointLights;\n\t\tthis.numDirectionalLights = this._renderLightingPass.numDirectionalLights;\n\t\tthis.numLightProbes = this._renderLightingPass.numLightProbes;\n\n\t\tvar numAllLights:number = this._renderLightingPass.numPointLights + this._renderLightingPass.numDirectionalLights;\n\t\tvar numLightProbes:number = this._renderLightingPass.numLightProbes;\n\t\tvar diffuseLightSources:number = this._renderLightingPass._iUsesDiffuse(this)? this._renderLightingPass.diffuseLightSources : 0x00;\n\t\tvar specularLightSources:number = this._renderLightingPass._iUsesSpecular(this)? this._renderLightingPass.specularLightSources : 0x00;\n\t\tvar combinedLightSources:number = diffuseLightSources | specularLightSources;\n\n\t\tthis.usesLightFallOff = this._renderLightingPass.enableLightFallOff && this.profile != ContextGLProfile.BASELINE_CONSTRAINED;\n\t\tthis.numLights = numAllLights + numLightProbes;\n\t\tthis.usesLights = numAllLights > 0 && (combinedLightSources & LightSources.LIGHTS) != 0;\n\t\tthis.usesProbes = numLightProbes > 0 && (combinedLightSources & LightSources.PROBES) != 0;\n\t\tthis.usesLightsForSpecular = numAllLights > 0 && (specularLightSources & LightSources.LIGHTS) != 0;\n\t\tthis.usesProbesForSpecular = numLightProbes > 0 && (specularLightSources & LightSources.PROBES) != 0;\n\t\tthis.usesLightsForDiffuse = numAllLights > 0 && (diffuseLightSources & LightSources.LIGHTS) != 0;\n\t\tthis.usesProbesForDiffuse = numLightProbes > 0 && (diffuseLightSources & LightSources.PROBES) != 0;\n\t\tthis.usesShadows = this._renderLightingPass._iUsesShadows(this);\n\n\t\t//IMPORTANT this must occur after shader lighting initialisation above\n\t\tsuper._iIncludeDependencies();\n\t}\n\n\t/**\n\t * Factory method to create a concrete compiler object for this object\n\t *\n\t * @param materialPassVO\n\t * @returns {away.materials.ShaderLightingCompiler}\n\t */\n\tpublic createCompiler(renderableClass:IRenderableClass, renderPass:IRenderLightingPass):ShaderCompilerBase\n\t{\n\t\treturn new ShaderLightingCompiler(renderableClass, renderPass, this);\n\t}\n\n\t/**\n\t * Clears dependency counts for all registers. Called when recompiling a pass.\n\t */\n\tpublic reset()\n\t{\n\t\tsuper.reset();\n\n\t\tthis.numLights = 0;\n\t\tthis.usesLightFallOff = true;\n\t}\n\n\n\t/**\n\t *\n\t *\n\t * @param renderable\n\t * @param stage\n\t * @param camera\n\t */\n\tpublic _iRender(renderable:RenderableBase, camera:Camera, viewProjection:Matrix3D)\n\t{\n\t\tsuper._iRender(renderable, camera, viewProjection);\n\n\t\tif (this._renderLightingPass.lightPicker)\n\t\t\tthis._renderLightingPass.lightPicker.collectLights(renderable);\n\n\t\tif (this.usesLights)\n\t\t\tthis.updateLights();\n\n\t\tif (this.usesProbes)\n\t\t\tthis.updateProbes();\n\t}\n\n\t/**\n\t * Updates constant data render state used by the lights. This method is optional for subclasses to implement.\n\t */\n\tprivate updateLights()\n\t{\n\t\tvar dirLight:DirectionalLight;\n\t\tvar pointLight:PointLight;\n\t\tvar i:number = 0;\n\t\tvar k:number = 0;\n\t\tvar len:number;\n\t\tvar dirPos:Vector3D;\n\t\tvar total:number = 0;\n\t\tvar numLightTypes:number = this.usesShadows? 2 : 1;\n\t\tvar l:number;\n\t\tvar offset:number;\n\n\t\tthis.ambientR = this.ambientG = this.ambientB = 0;\n\n\t\tl = this.lightVertexConstantIndex;\n\t\tk = this.lightFragmentConstantIndex;\n\n\t\tvar cast:number = 0;\n\t\tvar dirLights:Array<DirectionalLight> = this._renderLightingPass.lightPicker.directionalLights;\n\t\toffset = this._renderLightingPass.directionalLightsOffset;\n\t\tlen = this._renderLightingPass.lightPicker.directionalLights.length;\n\n\t\tif (offset > len) {\n\t\t\tcast = 1;\n\t\t\toffset -= len;\n\t\t}\n\n\t\tfor (; cast < numLightTypes; ++cast) {\n\t\t\tif (cast)\n\t\t\t\tdirLights = this._renderLightingPass.lightPicker.castingDirectionalLights;\n\n\t\t\tlen = dirLights.length;\n\n\t\t\tif (len > this.numDirectionalLights)\n\t\t\t\tlen = this.numDirectionalLights;\n\n\t\t\tfor (i = 0; i < len; ++i) {\n\t\t\t\tdirLight = dirLights[offset + i];\n\t\t\t\tdirPos = dirLight.sceneDirection;\n\n\t\t\t\tthis.ambientR += dirLight._iAmbientR;\n\t\t\t\tthis.ambientG += dirLight._iAmbientG;\n\t\t\t\tthis.ambientB += dirLight._iAmbientB;\n\n\t\t\t\tif (this.usesTangentSpace) {\n\t\t\t\t\tvar x:number = -dirPos.x;\n\t\t\t\t\tvar y:number = -dirPos.y;\n\t\t\t\t\tvar z:number = -dirPos.z;\n\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[0]*x + this._pInverseSceneMatrix[4]*y + this._pInverseSceneMatrix[8]*z;\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[1]*x + this._pInverseSceneMatrix[5]*y + this._pInverseSceneMatrix[9]*z;\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[2]*x + this._pInverseSceneMatrix[6]*y + this._pInverseSceneMatrix[10]*z;\n\t\t\t\t\tthis.vertexConstantData[l++] = 1;\n\t\t\t\t} else {\n\t\t\t\t\tthis.fragmentConstantData[k++] = -dirPos.x;\n\t\t\t\t\tthis.fragmentConstantData[k++] = -dirPos.y;\n\t\t\t\t\tthis.fragmentConstantData[k++] = -dirPos.z;\n\t\t\t\t\tthis.fragmentConstantData[k++] = 1;\n\t\t\t\t}\n\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iDiffuseR;\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iDiffuseG;\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iDiffuseB;\n\t\t\t\tthis.fragmentConstantData[k++] = 1;\n\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iSpecularR;\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iSpecularG;\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iSpecularB;\n\t\t\t\tthis.fragmentConstantData[k++] = 1;\n\n\t\t\t\tif (++total == this.numDirectionalLights) {\n\t\t\t\t\t// break loop\n\t\t\t\t\ti = len;\n\t\t\t\t\tcast = numLightTypes;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// more directional supported than currently picked, need to clamp all to 0\n\t\tif (this.numDirectionalLights > total) {\n\t\t\ti = k + (this.numDirectionalLights - total)*12;\n\n\t\t\twhile (k < i)\n\t\t\t\tthis.fragmentConstantData[k++] = 0;\n\t\t}\n\n\t\ttotal = 0;\n\n\t\tvar pointLights:Array<PointLight> = this._renderLightingPass.lightPicker.pointLights;\n\t\toffset = this._renderLightingPass.pointLightsOffset;\n\t\tlen = this._renderLightingPass.lightPicker.pointLights.length;\n\n\t\tif (offset > len) {\n\t\t\tcast = 1;\n\t\t\toffset -= len;\n\t\t} else {\n\t\t\tcast = 0;\n\t\t}\n\n\t\tfor (; cast < numLightTypes; ++cast) {\n\t\t\tif (cast)\n\t\t\t\tpointLights = this._renderLightingPass.lightPicker.castingPointLights;\n\n\t\t\tlen = pointLights.length;\n\n\t\t\tfor (i = 0; i < len; ++i) {\n\t\t\t\tpointLight = pointLights[offset + i];\n\t\t\t\tdirPos = pointLight.scenePosition;\n\n\t\t\t\tthis.ambientR += pointLight._iAmbientR;\n\t\t\t\tthis.ambientG += pointLight._iAmbientG;\n\t\t\t\tthis.ambientB += pointLight._iAmbientB;\n\n\t\t\t\tif (this.usesTangentSpace) {\n\t\t\t\t\tx = dirPos.x;\n\t\t\t\t\ty = dirPos.y;\n\t\t\t\t\tz = dirPos.z;\n\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[0]*x + this._pInverseSceneMatrix[4]*y + this._pInverseSceneMatrix[8]*z + this._pInverseSceneMatrix[12];\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[1]*x + this._pInverseSceneMatrix[5]*y + this._pInverseSceneMatrix[9]*z + this._pInverseSceneMatrix[13];\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[2]*x + this._pInverseSceneMatrix[6]*y + this._pInverseSceneMatrix[10]*z + this._pInverseSceneMatrix[14];\n\t\t\t\t\tthis.vertexConstantData[l++] = 1;\n\t\t\t\t} else if (!this.usesGlobalPosFragment) {\n\t\t\t\t\tthis.vertexConstantData[l++] = dirPos.x;\n\t\t\t\t\tthis.vertexConstantData[l++] = dirPos.y;\n\t\t\t\t\tthis.vertexConstantData[l++] = dirPos.z;\n\t\t\t\t\tthis.vertexConstantData[l++] = 1;\n\t\t\t\t} else {\n\t\t\t\t\tthis.fragmentConstantData[k++] = dirPos.x;\n\t\t\t\t\tthis.fragmentConstantData[k++] = dirPos.y;\n\t\t\t\t\tthis.fragmentConstantData[k++] = dirPos.z;\n\t\t\t\t\tthis.fragmentConstantData[k++] = 1;\n\t\t\t\t}\n\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iDiffuseR;\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iDiffuseG;\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iDiffuseB;\n\n\t\t\t\tvar radius:number = pointLight._pRadius;\n\t\t\t\tthis.fragmentConstantData[k++] = radius*radius;\n\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iSpecularR;\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iSpecularG;\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iSpecularB;\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._pFallOffFactor;\n\n\t\t\t\tif (++total == this.numPointLights) {\n\t\t\t\t\t// break loop\n\t\t\t\t\ti = len;\n\t\t\t\t\tcast = numLightTypes;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// more directional supported than currently picked, need to clamp all to 0\n\t\tif (this.numPointLights > total) {\n\t\t\ti = k + (total - this.numPointLights)*12;\n\n\t\t\tfor (; k < i; ++k)\n\t\t\t\tthis.fragmentConstantData[k] = 0;\n\t\t}\n\t}\n\n\t/**\n\t * Updates constant data render state used by the light probes. This method is optional for subclasses to implement.\n\t */\n\tprivate updateProbes()\n\t{\n\t\tvar probe:LightProbe;\n\t\tvar lightProbes:Array<LightProbe> = this._renderLightingPass.lightPicker.lightProbes;\n\t\tvar weights:Array<number> = this._renderLightingPass.lightPicker.lightProbeWeights;\n\t\tvar len:number = lightProbes.length - this._renderLightingPass.lightProbesOffset;\n\t\tvar addDiff:boolean = this.usesProbesForDiffuse;\n\t\tvar addSpec:boolean = this.usesProbesForSpecular;\n\n\t\tif (!(addDiff || addSpec))\n\t\t\treturn;\n\n\t\tif (len > this.numLightProbes)\n\t\t\tlen = this.numLightProbes;\n\n\t\tfor (var i:number = 0; i < len; ++i) {\n\t\t\tprobe = lightProbes[ this._renderLightingPass.lightProbesOffset + i];\n\n\t\t\tif (addDiff)\n\t\t\t\tthis._stage.activateCubeTexture(this.lightProbeDiffuseIndices[i], probe.diffuseMap, this.useSmoothTextures, this.useMipmapping);\n\n\t\t\tif (addSpec)\n\t\t\t\tthis._stage.activateCubeTexture(this.lightProbeSpecularIndices[i], probe.specularMap, this.useSmoothTextures, this.useMipmapping);\n\t\t}\n\n\t\tfor (i = 0; i < len; ++i)\n\t\t\tthis.fragmentConstantData[this.probeWeightsIndex + i] = weights[this._renderLightingPass.lightProbesOffset + i];\n\t}\n}\n\nexport = ShaderLightingObject;","import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\nimport Matrix\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\nimport ArgumentError\t\t\t\t= require(\"awayjs-core/lib/errors/ArgumentError\");\nimport Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport LineSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\nimport ContextGLTriangleFace\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTriangleFace\");\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ProgramData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/ProgramData\");\n\nimport AnimationSetBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\nimport AnimatorBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport AnimationRegisterCache\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport IRenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/IRenderPassBase\");\nimport ShaderCompilerBase\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderCompilerBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\n\n/**\n * ShaderObjectBase keeps track of the number of dependencies for \"named registers\" used across a pass.\n * Named registers are that are not necessarily limited to a single method. They are created by the compiler and\n * passed on to methods. The compiler uses the results to reserve usages through RegisterPool, which can be removed\n * each time a method has been compiled into the shader.\n *\n * @see RegisterPool.addUsage\n */\nclass ShaderObjectBase\n{\n\tprivate _renderableClass:IRenderableClass;\n\tprivate _renderPass:IRenderPassBase;\n\tpublic _stage:Stage;\n\tprivate _programData:ProgramData;\n\n\tprivate _invalidShader:boolean = true;\n\tprivate _invalidProgram:boolean = true;\n\tprivate _animationVertexCode:string = \"\";\n\tprivate _animationFragmentCode:string = \"\";\n\n\tpublic get programData():ProgramData\n\t{\n\t\tif (this._invalidProgram)\n\t\t\tthis._updateProgram();\n\n\t\treturn this._programData;\n\t}\n\n\tpublic profile:string;\n\n\tpublic usesAnimation:boolean;\n\n\tprivate _defaultCulling:string = ContextGLTriangleFace.BACK;\n\n\tpublic _pInverseSceneMatrix:Array<number> = new Array<number>();\n\n\tpublic animationRegisterCache:AnimationRegisterCache;\n\n\t/**\n\t * The amount of used vertex constants in the vertex code. Used by the animation code generation to know from which index on registers are available.\n\t */\n\tpublic numUsedVertexConstants:number;\n\n\t/**\n\t * The amount of used fragment constants in the fragment code. Used by the animation code generation to know from which index on registers are available.\n\t */\n\tpublic numUsedFragmentConstants:number;\n\n\t/**\n\t * The amount of used vertex streams in the vertex code. Used by the animation code generation to know from which index on streams are available.\n\t */\n\tpublic numUsedStreams:number;\n\n\t/**\n\t *\n\t */\n\tpublic numUsedTextures:number;\n\n\t/**\n\t *\n\t */\n\tpublic numUsedVaryings:number;\n\n\tpublic animatableAttributes:Array<string>;\n\tpublic animationTargetRegisters:Array<string>;\n\tpublic uvSource:string;\n\tpublic uvTarget:string;\n\n\tpublic useAlphaPremultiplied:boolean;\n\tpublic useBothSides:boolean;\n\tpublic useMipmapping:boolean;\n\tpublic useSmoothTextures:boolean;\n\tpublic repeatTextures:boolean;\n\tpublic usesUVTransform:boolean;\n\tpublic alphaThreshold:number;\n\tpublic texture:Texture2DBase;\n\tpublic color:number;\n\n\n\t//set ambient values to default\n\tpublic ambientR:number = 0xFF;\n\tpublic ambientG:number = 0xFF;\n\tpublic ambientB:number = 0xFF;\n\n\t/**\n\t * Indicates whether the pass requires any fragment animation code.\n\t */\n\tpublic usesFragmentAnimation:boolean;\n\n\t/**\n\t * The amount of dependencies on the projected position.\n\t */\n\tpublic projectionDependencies:number;\n\n\t/**\n\t * The amount of dependencies on the normal vector.\n\t */\n\tpublic normalDependencies:number;\n\n\t/**\n\t * The amount of dependencies on the vertex color.\n\t */\n\tpublic colorDependencies:number;\n\n\t/**\n\t * The amount of dependencies on the view direction.\n\t */\n\tpublic viewDirDependencies:number;\n\n\t/**\n\t * The amount of dependencies on the primary UV coordinates.\n\t */\n\tpublic uvDependencies:number;\n\n\t/**\n\t * The amount of dependencies on the secondary UV coordinates.\n\t */\n\tpublic secondaryUVDependencies:number;\n\n\t/**\n\t * The amount of dependencies on the local position. This can be 0 while hasGlobalPosDependencies is true when\n\t * the global position is used as a temporary value (fe to calculate the view direction)\n\t */\n\tpublic localPosDependencies:number;\n\n\t/**\n\t * The amount of dependencies on the global position. This can be 0 while hasGlobalPosDependencies is true when\n\t * the global position is used as a temporary value (fe to calculate the view direction)\n\t */\n\tpublic globalPosDependencies:number;\n\n\t/**\n\t * The amount of tangent vector dependencies (fragment shader).\n\t */\n\tpublic tangentDependencies:number;\n\n\t/**\n\t *\n\t */\n\tpublic outputsNormals:boolean;\n\n\t/**\n\t *\n\t */\n\tpublic outputsColors:boolean;\n\n\t/**\n\t * Indicates whether or not normal calculations are expected in tangent space. This is only the case if no world-space\n\t * dependencies exist.\n\t */\n\tpublic usesTangentSpace:boolean;\n\n\t/**\n\t * Indicates whether or not normal calculations are output in tangent space.\n\t */\n\tpublic outputsTangentNormals:boolean;\n\n\t/**\n\t * Indicates whether there are any dependencies on the world-space position vector.\n\t */\n\tpublic usesGlobalPosFragment:boolean = false;\n\n\tpublic vertexConstantData:Array<number> = new Array<number>();\n\tpublic fragmentConstantData:Array<number> = new Array<number>();\n\n\t/**\n\t * The index for the common data register.\n\t */\n\tpublic commonsDataIndex:number;\n\n\t/**\n\t * The index for the UV vertex attribute stream.\n\t */\n\tpublic uvBufferIndex:number;\n\n\t/**\n\t * The index for the secondary UV vertex attribute stream.\n\t */\n\tpublic secondaryUVBufferIndex:number;\n\n\t/**\n\t * The index for the vertex normal attribute stream.\n\t */\n\tpublic normalBufferIndex:number;\n\n\t/**\n\t * The index for the color attribute stream.\n\t */\n\tpublic colorBufferIndex:number;\n\n\t/**\n\t * The index for the vertex tangent attribute stream.\n\t */\n\tpublic tangentBufferIndex:number;\n\n\t/**\n\t * The index of the vertex constant containing the view matrix.\n\t */\n\tpublic viewMatrixIndex:number;\n\n\t/**\n\t * The index of the vertex constant containing the scene matrix.\n\t */\n\tpublic sceneMatrixIndex:number;\n\n\t/**\n\t * The index of the vertex constant containing the uniform scene matrix (the inverse transpose).\n\t */\n\tpublic sceneNormalMatrixIndex:number;\n\n\t/**\n\t * The index of the vertex constant containing the camera position.\n\t */\n\tpublic cameraPositionIndex:number;\n\n\t/**\n\t * The index for the UV transformation matrix vertex constant.\n\t */\n\tpublic uvTransformIndex:number;\n\n\t/**\n\t * Creates a new MethodCompilerVO object.\n\t */\n\tconstructor(renderableClass:IRenderableClass, renderPass:IRenderPassBase, stage:Stage)\n\t{\n\t\tthis._renderableClass = renderableClass;\n\t\tthis._renderPass = renderPass;\n\t\tthis._stage = stage;\n\t\tthis.profile = this._stage.profile;\n\t}\n\n\tpublic _iIncludeDependencies()\n\t{\n\t\tthis._renderPass._iIncludeDependencies(this);\n\t}\n\n\t/**\n\t * Factory method to create a concrete compiler object for this object\n\t *\n\t * @param renderableClass\n\t * @param renderPass\n\t * @param stage\n\t * @returns {ShaderCompilerBase}\n\t */\n\tpublic createCompiler(renderableClass:IRenderableClass, renderPass:IRenderPassBase):ShaderCompilerBase\n\t{\n\t\treturn new ShaderCompilerBase(renderableClass, renderPass, this);\n\t}\n\n\t/**\n\t * Clears dependency counts for all registers. Called when recompiling a pass.\n\t */\n\tpublic reset()\n\t{\n\t\tthis.projectionDependencies = 0;\n\t\tthis.normalDependencies = 0;\n\t\tthis.colorDependencies = 0;\n\t\tthis.viewDirDependencies = 0;\n\t\tthis.uvDependencies = 0;\n\t\tthis.secondaryUVDependencies = 0;\n\t\tthis.globalPosDependencies = 0;\n\t\tthis.tangentDependencies = 0;\n\t\tthis.usesGlobalPosFragment = false;\n\t\tthis.usesFragmentAnimation = false;\n\t\tthis.usesTangentSpace = false;\n\t\tthis.outputsNormals = false;\n\t\tthis.outputsTangentNormals = false;\n\t}\n\n\tpublic pInitRegisterIndices()\n\t{\n\t\tthis.commonsDataIndex = -1;\n\t\tthis.cameraPositionIndex = -1;\n\t\tthis.uvBufferIndex = -1;\n\t\tthis.uvTransformIndex = -1;\n\t\tthis.secondaryUVBufferIndex = -1;\n\t\tthis.normalBufferIndex = -1;\n\t\tthis.colorBufferIndex = -1;\n\t\tthis.tangentBufferIndex = -1;\n\t\tthis.sceneMatrixIndex = -1;\n\t\tthis.sceneNormalMatrixIndex = -1;\n\t}\n\n\t/**\n\t * Initializes the unchanging constant data for this shader object.\n\t */\n\tpublic initConstantData(registerCache:ShaderRegisterCache, animatableAttributes:Array<string>, animationTargetRegisters:Array<string>, uvSource:string, uvTarget:string)\n\t{\n\t\t//Updates the amount of used register indices.\n\t\tthis.numUsedVertexConstants = registerCache.numUsedVertexConstants;\n\t\tthis.numUsedFragmentConstants = registerCache.numUsedFragmentConstants;\n\t\tthis.numUsedStreams = registerCache.numUsedStreams;\n\t\tthis.numUsedTextures = registerCache.numUsedTextures;\n\t\tthis.numUsedVaryings = registerCache.numUsedVaryings;\n\t\tthis.numUsedFragmentConstants = registerCache.numUsedFragmentConstants;\n\n\t\tthis.animatableAttributes = animatableAttributes;\n\t\tthis.animationTargetRegisters = animationTargetRegisters;\n\t\tthis.uvSource = uvSource;\n\t\tthis.uvTarget = uvTarget;\n\n\t\tthis.vertexConstantData.length = this.numUsedVertexConstants*4;\n\t\tthis.fragmentConstantData.length = this.numUsedFragmentConstants*4;\n\n\t\t//Initializes commonly required constant values.\n\t\tthis.fragmentConstantData[this.commonsDataIndex] = .5;\n\t\tthis.fragmentConstantData[this.commonsDataIndex + 1] = 0;\n\t\tthis.fragmentConstantData[this.commonsDataIndex + 2] = 1/255;\n\t\tthis.fragmentConstantData[this.commonsDataIndex + 3] = 1;\n\n\t\t//Initializes the default UV transformation matrix.\n\t\tif (this.uvTransformIndex >= 0) {\n\t\t\tthis.vertexConstantData[this.uvTransformIndex] = 1;\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 1] = 0;\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 2] = 0;\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 3] = 0;\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 4] = 0;\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 5] = 1;\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 6] = 0;\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 7] = 0;\n\t\t}\n\n\t\tif (this.cameraPositionIndex >= 0)\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex + 3] = 1;\n\t}\n\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iActivate(camera:Camera)\n\t{\n\t\tif (this.usesAnimation)\n\t\t\t(<AnimationSetBase> this._renderPass.animationSet).activate(this, this._stage);\n\n\t\tthis._stage.context.setCulling(this.useBothSides? ContextGLTriangleFace.NONE : this._defaultCulling, camera.projection.coordinateSystem);\n\n\t\tif (!this.usesTangentSpace && this.cameraPositionIndex >= 0) {\n\t\t\tvar pos:Vector3D = camera.scenePosition;\n\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex] = pos.x;\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex + 1] = pos.y;\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex + 2] = pos.z;\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iDeactivate()\n\t{\n\t\tif (this.usesAnimation)\n\t\t\t(<AnimationSetBase> this._renderPass.animationSet).deactivate(this, this._stage);\n\n\t}\n\n\n\t/**\n\t *\n\t *\n\t * @param renderable\n\t * @param stage\n\t * @param camera\n\t */\n\tpublic _iRender(renderable:RenderableBase, camera:Camera, viewProjection:Matrix3D)\n\t{\n\t\tif (renderable.renderableOwner.animator)\n\t\t\t(<AnimatorBase> renderable.renderableOwner.animator).setRenderState(this, renderable, this._stage, camera, this.numUsedVertexConstants, this.numUsedStreams);\n\n\t\tif (this.uvBufferIndex >= 0)\n\t\t\tthis._stage.activateBuffer(this.uvBufferIndex, renderable.getVertexData(TriangleSubGeometry.UV_DATA), renderable.getVertexOffset(TriangleSubGeometry.UV_DATA), TriangleSubGeometry.UV_FORMAT);\n\n\t\tif (this.secondaryUVBufferIndex >= 0)\n\t\t\tthis._stage.activateBuffer(this.secondaryUVBufferIndex, renderable.getVertexData(TriangleSubGeometry.SECONDARY_UV_DATA), renderable.getVertexOffset(TriangleSubGeometry.SECONDARY_UV_DATA), TriangleSubGeometry.SECONDARY_UV_FORMAT);\n\n\t\tif (this.normalBufferIndex >= 0)\n\t\t\tthis._stage.activateBuffer(this.normalBufferIndex, renderable.getVertexData(TriangleSubGeometry.NORMAL_DATA), renderable.getVertexOffset(TriangleSubGeometry.NORMAL_DATA), TriangleSubGeometry.NORMAL_FORMAT);\n\n\t\tif (this.tangentBufferIndex >= 0)\n\t\t\tthis._stage.activateBuffer(this.tangentBufferIndex, renderable.getVertexData(TriangleSubGeometry.TANGENT_DATA), renderable.getVertexOffset(TriangleSubGeometry.TANGENT_DATA), TriangleSubGeometry.TANGENT_FORMAT);\n\n\t\tif (this.colorBufferIndex >= 0)\n\t\t\tthis._stage.activateBuffer(this.colorBufferIndex, renderable.getVertexData(LineSubGeometry.COLOR_DATA), renderable.getVertexOffset(LineSubGeometry.COLOR_DATA), LineSubGeometry.COLOR_FORMAT);\n\n\n\t\tif (this.usesUVTransform) {\n\t\t\tvar uvTransform:Matrix = renderable.renderableOwner.uvTransform.matrix;\n\n\t\t\tif (uvTransform) {\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex] = uvTransform.a;\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 1] = uvTransform.b;\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 3] = uvTransform.tx;\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 4] = uvTransform.c;\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 5] = uvTransform.d;\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 7] = uvTransform.ty;\n\t\t\t} else {\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex] = 1;\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 1] = 0;\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 3] = 0;\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 4] = 0;\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 5] = 1;\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 7] = 0;\n\t\t\t}\n\t\t}\n\n\t\tif (this.sceneNormalMatrixIndex >= 0)\n\t\t\trenderable.sourceEntity.inverseSceneTransform.copyRawDataTo(this.vertexConstantData, this.sceneNormalMatrixIndex, false);\n\n\t\tif (this.usesTangentSpace && this.cameraPositionIndex >= 0) {\n\n\t\t\trenderable.sourceEntity.inverseSceneTransform.copyRawDataTo(this._pInverseSceneMatrix);\n\t\t\tvar pos:Vector3D = camera.scenePosition;\n\t\t\tvar x:number = pos.x;\n\t\t\tvar y:number = pos.y;\n\t\t\tvar z:number = pos.z;\n\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex] = this._pInverseSceneMatrix[0]*x + this._pInverseSceneMatrix[4]*y + this._pInverseSceneMatrix[8]*z + this._pInverseSceneMatrix[12];\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex + 1] = this._pInverseSceneMatrix[1]*x + this._pInverseSceneMatrix[5]*y + this._pInverseSceneMatrix[9]*z + this._pInverseSceneMatrix[13];\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex + 2] = this._pInverseSceneMatrix[2]*x + this._pInverseSceneMatrix[6]*y + this._pInverseSceneMatrix[10]*z + this._pInverseSceneMatrix[14];\n\t\t}\n\t}\n\t\n\tpublic invalidateProgram()\n\t{\n\t\tthis._invalidProgram = true;\n\t}\n\n\tpublic invalidateShader()\n\t{\n\t\tthis._invalidShader = true;\n\t\tthis._invalidProgram = true;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._programData.dispose();\n\t\tthis._programData = null;\n\t}\n\n\tprivate _updateProgram()\n\t{\n\t\tthis._invalidProgram = false;\n\n\t\tvar compiler:ShaderCompilerBase;\n\n\t\tif (this._invalidShader) {\n\t\t\tthis._invalidShader = false;\n\n\t\t\tcompiler = this.createCompiler(this._renderableClass, this._renderPass);\n\t\t\tcompiler.compile();\n\t\t}\n\n\t\tthis._calcAnimationCode(compiler.shadedTarget);\n\n\t\tvar programData:ProgramData = this._stage.getProgramData(this._animationVertexCode + compiler.vertexCode, compiler.fragmentCode + this._animationFragmentCode + compiler.postAnimationFragmentCode);\n\n\t\t//check program data hasn't changed, keep count of program usages\n\t\tif (this._programData != programData) {\n\t\t\tif (this._programData)\n\t\t\t\tthis._programData.dispose();\n\n\t\t\tthis._programData = programData;\n\n\t\t\tprogramData.usages++;\n\t\t}\n\t}\n\n\tprivate _calcAnimationCode(shadedTarget:string)\n\t{\n\t\t//reset code\n\t\tthis._animationVertexCode = \"\";\n\t\tthis._animationFragmentCode = \"\";\n\n\t\t//check to see if GPU animation is used\n\t\tif (this.usesAnimation) {\n\n\t\t\tvar animationSet:AnimationSetBase = <AnimationSetBase> this._renderPass.animationSet;\n\n\t\t\tthis._animationVertexCode += animationSet.getAGALVertexCode(this);\n\n\t\t\tif (this.uvDependencies > 0 && !this.usesUVTransform)\n\t\t\t\tthis._animationVertexCode += animationSet.getAGALUVCode(this);\n\n\t\t\tif (this.usesFragmentAnimation)\n\t\t\t\tthis._animationFragmentCode += animationSet.getAGALFragmentCode(this, shadedTarget);\n\n\t\t\tanimationSet.doneAGALCode(this);\n\n\t\t} else {\n\t\t\t// simply write attributes to targets, do not animate them\n\t\t\t// projection will pick up on targets[0] to do the projection\n\t\t\tvar len:number = this.animatableAttributes.length;\n\t\t\tfor (var i:number = 0; i < len; ++i)\n\t\t\t\tthis._animationVertexCode += \"mov \" + this.animationTargetRegisters[i] + \", \" + this.animatableAttributes[i] + \"\\n\";\n\n\t\t\tif (this.uvDependencies > 0 && !this.usesUVTransform)\n\t\t\t\tthis._animationVertexCode += \"mov \" + this.uvTarget + \",\" + this.uvSource + \"\\n\";\n\t\t}\n\t}\n}\n\nexport = ShaderObjectBase;","import RegisterPool\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RegisterPool\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\n/**\n * ShaderRegister Cache provides the usage management system for all registers during shading compilation.\n */\nclass ShaderRegisterCache\n{\n\tprivate _fragmentTempCache:RegisterPool;\n\tprivate _vertexTempCache:RegisterPool;\n\tprivate _varyingCache:RegisterPool;\n\tprivate _fragmentConstantsCache:RegisterPool;\n\tprivate _vertexConstantsCache:RegisterPool;\n\tprivate _textureCache:RegisterPool;\n\tprivate _vertexAttributesCache:RegisterPool;\n\tprivate _vertexConstantOffset:number; //TODO: check if this should be initialised to 0\n\tprivate _vertexAttributesOffset:number;//TODO: check if this should be initialised to 0\n\tprivate _varyingsOffset:number;//TODO: check if this should be initialised to 0\n\tprivate _fragmentConstantOffset:number;//TODO: check if this should be initialised to 0\n\n\tprivate _fragmentOutputRegister:ShaderRegisterElement;\n\tprivate _vertexOutputRegister:ShaderRegisterElement;\n\tprivate _numUsedVertexConstants:number = 0;\n\tprivate _numUsedFragmentConstants:number = 0;\n\tprivate _numUsedStreams:number = 0;\n\tprivate _numUsedTextures:number = 0;\n\tprivate _numUsedVaryings:number = 0;\n\tprivate _profile:string;\n\n\t/**\n\t * Create a new ShaderRegisterCache object.\n\t *\n\t * @param profile The compatibility profile used by the renderer.\n\t */\n\tconstructor(profile:string)\n\t{\n\t\tthis._profile = profile;\n\t}\n\n\t/**\n\t * Resets all registers.\n\t */\n\tpublic reset()\n\t{\n\t\tthis._fragmentTempCache = new RegisterPool(\"ft\", 8, false);\n\t\tthis._vertexTempCache = new RegisterPool(\"vt\", 8, false);\n\t\tthis._varyingCache = new RegisterPool(\"v\", 8);\n\t\tthis._textureCache = new RegisterPool(\"fs\", 8);\n\t\tthis._vertexAttributesCache = new RegisterPool(\"va\", 8);\n\t\tthis._fragmentConstantsCache = new RegisterPool(\"fc\", 28);\n\t\tthis._vertexConstantsCache = new RegisterPool(\"vc\", 128);\n\t\tthis._fragmentOutputRegister = new ShaderRegisterElement(\"oc\", -1);\n\t\tthis._vertexOutputRegister = new ShaderRegisterElement(\"op\", -1);\n\t\tthis._numUsedVertexConstants = 0;\n\t\tthis._numUsedStreams = 0;\n\t\tthis._numUsedTextures = 0;\n\t\tthis._numUsedVaryings = 0;\n\t\tthis._numUsedFragmentConstants = 0;\n\n\t\tvar i:number;\n\n\t\tfor (i = 0; i < this._vertexAttributesOffset; ++i)\n\t\t\tthis.getFreeVertexAttribute();\n\n\t\tfor (i = 0; i < this._vertexConstantOffset; ++i)\n\t\t\tthis.getFreeVertexConstant();\n\n\t\tfor (i = 0; i < this._varyingsOffset; ++i)\n\t\t\tthis.getFreeVarying();\n\n\t\tfor (i = 0; i < this._fragmentConstantOffset; ++i)\n\t\t\tthis.getFreeFragmentConstant();\n\t}\n\n\t/**\n\t * Disposes all resources used.\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._fragmentTempCache.dispose();\n\t\tthis._vertexTempCache.dispose();\n\t\tthis._varyingCache.dispose();\n\t\tthis._fragmentConstantsCache.dispose();\n\t\tthis._vertexAttributesCache.dispose();\n\n\t\tthis._fragmentTempCache = null;\n\t\tthis._vertexTempCache = null;\n\t\tthis._varyingCache = null;\n\t\tthis._fragmentConstantsCache = null;\n\t\tthis._vertexAttributesCache = null;\n\t\tthis._fragmentOutputRegister = null;\n\t\tthis._vertexOutputRegister = null;\n\t}\n\n\t/**\n\t * Marks a fragment temporary register as used, so it cannot be retrieved. The register won't be able to be used until removeUsage\n\t * has been called usageCount times again.\n\t * @param register The register to mark as used.\n\t * @param usageCount The amount of usages to add.\n\t */\n\tpublic addFragmentTempUsages(register:ShaderRegisterElement, usageCount:number)\n\t{\n\t\tthis._fragmentTempCache.addUsage(register, usageCount);\n\t}\n\n\t/**\n\t * Removes a usage from a fragment temporary register. When usages reach 0, the register is freed again.\n\t * @param register The register for which to remove a usage.\n\t */\n\tpublic removeFragmentTempUsage(register:ShaderRegisterElement)\n\t{\n\t\tthis._fragmentTempCache.removeUsage(register);\n\t}\n\n\t/**\n\t * Marks a vertex temporary register as used, so it cannot be retrieved. The register won't be able to be used\n\t * until removeUsage has been called usageCount times again.\n\t * @param register The register to mark as used.\n\t * @param usageCount The amount of usages to add.\n\t */\n\tpublic addVertexTempUsages(register:ShaderRegisterElement, usageCount:number)\n\t{\n\t\tthis._vertexTempCache.addUsage(register, usageCount);\n\t}\n\n\t/**\n\t * Removes a usage from a vertex temporary register. When usages reach 0, the register is freed again.\n\t * @param register The register for which to remove a usage.\n\t */\n\tpublic removeVertexTempUsage(register:ShaderRegisterElement)\n\t{\n\t\tthis._vertexTempCache.removeUsage(register);\n\t}\n\n\t/**\n\t * Retrieve an entire fragment temporary register that's still available. The register won't be able to be used until removeUsage\n\t * has been called usageCount times again.\n\t */\n\tpublic getFreeFragmentVectorTemp():ShaderRegisterElement\n\t{\n\t\treturn this._fragmentTempCache.requestFreeVectorReg();\n\t}\n\n\t/**\n\t * Retrieve a single component from a fragment temporary register that's still available.\n\t */\n\tpublic getFreeFragmentSingleTemp():ShaderRegisterElement\n\t{\n\t\treturn this._fragmentTempCache.requestFreeRegComponent();\n\t}\n\n\t/**\n\t * Retrieve an available varying register\n\t */\n\tpublic getFreeVarying():ShaderRegisterElement\n\t{\n\t\t++this._numUsedVaryings;\n\t\treturn this._varyingCache.requestFreeVectorReg();\n\t}\n\n\t/**\n\t * Retrieve an available fragment constant register\n\t */\n\tpublic getFreeFragmentConstant():ShaderRegisterElement\n\t{\n\t\t++this._numUsedFragmentConstants;\n\t\treturn this._fragmentConstantsCache.requestFreeVectorReg();\n\t}\n\n\t/**\n\t * Retrieve an available vertex constant register\n\t */\n\tpublic getFreeVertexConstant():ShaderRegisterElement\n\t{\n\t\t++this._numUsedVertexConstants;\n\t\treturn this._vertexConstantsCache.requestFreeVectorReg();\n\t}\n\n\t/**\n\t * Retrieve an entire vertex temporary register that's still available.\n\t */\n\tpublic getFreeVertexVectorTemp():ShaderRegisterElement\n\t{\n\t\treturn this._vertexTempCache.requestFreeVectorReg();\n\t}\n\n\t/**\n\t * Retrieve a single component from a vertex temporary register that's still available.\n\t */\n\tpublic getFreeVertexSingleTemp():ShaderRegisterElement\n\t{\n\t\treturn this._vertexTempCache.requestFreeRegComponent();\n\t}\n\n\t/**\n\t * Retrieve an available vertex attribute register\n\t */\n\tpublic getFreeVertexAttribute():ShaderRegisterElement\n\t{\n\t\t++this._numUsedStreams;\n\t\treturn this._vertexAttributesCache.requestFreeVectorReg();\n\t}\n\n\t/**\n\t * Retrieve an available texture register\n\t */\n\tpublic getFreeTextureReg():ShaderRegisterElement\n\t{\n\t\t++this._numUsedTextures;\n\t\treturn this._textureCache.requestFreeVectorReg();\n\t}\n\n\t/**\n\t * Indicates the start index from which to retrieve vertex constants.\n\t */\n\tpublic get vertexConstantOffset():number\n\t{\n\t\treturn this._vertexConstantOffset;\n\t}\n\n\tpublic set vertexConstantOffset(vertexConstantOffset:number)\n\t{\n\t\tthis._vertexConstantOffset = vertexConstantOffset;\n\t}\n\n\t/**\n\t * Indicates the start index from which to retrieve vertex attributes.\n\t */\n\tpublic get vertexAttributesOffset():number\n\t{\n\t\treturn this._vertexAttributesOffset;\n\t}\n\n\tpublic set vertexAttributesOffset(value:number)\n\t{\n\t\tthis._vertexAttributesOffset = value;\n\t}\n\n\t/**\n\t * Indicates the start index from which to retrieve varying registers.\n\t */\n\tpublic get varyingsOffset():number\n\t{\n\t\treturn this._varyingsOffset;\n\t}\n\n\tpublic set varyingsOffset(value:number)\n\t{\n\t\tthis._varyingsOffset = value;\n\t}\n\n\t/**\n\t * Indicates the start index from which to retrieve fragment constants.\n\t */\n\tpublic get fragmentConstantOffset():number\n\t{\n\t\treturn this._fragmentConstantOffset;\n\t}\n\n\tpublic set fragmentConstantOffset(value:number)\n\t{\n\t\tthis._fragmentConstantOffset = value;\n\t}\n\n\t/**\n\t * The fragment output register.\n\t */\n\tpublic get fragmentOutputRegister():ShaderRegisterElement\n\t{\n\t\treturn this._fragmentOutputRegister;\n\t}\n\n\t/**\n\t * The amount of used vertex constant registers.\n\t */\n\tpublic get numUsedVertexConstants():number\n\t{\n\t\treturn this._numUsedVertexConstants;\n\t}\n\n\t/**\n\t * The amount of used fragment constant registers.\n\t */\n\tpublic get numUsedFragmentConstants():number\n\t{\n\t\treturn this._numUsedFragmentConstants;\n\t}\n\n\t/**\n\t * The amount of used vertex streams.\n\t */\n\tpublic get numUsedStreams():number\n\t{\n\t\treturn this._numUsedStreams;\n\t}\n\n\t/**\n\t * The amount of used texture slots.\n\t */\n\tpublic get numUsedTextures():number\n\t{\n\t\treturn this._numUsedTextures;\n\t}\n\n\t/**\n\t * The amount of used varying registers.\n\t */\n\tpublic get numUsedVaryings():number\n\t{\n\t\treturn this._numUsedVaryings;\n\t}\n}\n\nexport = ShaderRegisterCache;","import ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\n/**\n * ShaderRegisterData contains the \"named\" registers, generated by the compiler and to be passed on to the methods.\n */\nclass ShaderRegisterData\n{\n\tpublic normalVarying:ShaderRegisterElement;\n\tpublic colorVarying:ShaderRegisterElement\n\tpublic tangentVarying:ShaderRegisterElement;\n\tpublic bitangentVarying:ShaderRegisterElement;\n\tpublic uvVarying:ShaderRegisterElement;\n\tpublic secondaryUVVarying:ShaderRegisterElement;\n\tpublic viewDirVarying:ShaderRegisterElement;\n\tpublic shadowTarget:ShaderRegisterElement;\n\tpublic shadedTarget:ShaderRegisterElement;\n\tpublic globalPositionVertex:ShaderRegisterElement;\n\tpublic globalPositionVarying:ShaderRegisterElement;\n\tpublic localPosition:ShaderRegisterElement;\n\tpublic normalInput:ShaderRegisterElement;\n\tpublic colorInput:ShaderRegisterElement;\n\tpublic tangentInput:ShaderRegisterElement;\n\tpublic animatedNormal:ShaderRegisterElement;\n\tpublic animatedTangent:ShaderRegisterElement;\n\tpublic commons:ShaderRegisterElement;\n\tpublic projectionFragment:ShaderRegisterElement;\n\tpublic normalFragment:ShaderRegisterElement;\n\tpublic viewDirFragment:ShaderRegisterElement;\n\tpublic bitangent:ShaderRegisterElement;\n\n\tconstructor()\n\t{\n\n\t}\n}\n\nexport = ShaderRegisterData;","/**\n * A single register element (an entire register or a single register's component) used by the RegisterPool.\n */\nclass ShaderRegisterElement\n{\n\tprivate _regName:string;\n\tprivate _index:number;\n\tprivate _toStr:string;\n\n\tprivate static COMPONENTS = [\"x\", \"y\", \"z\", \"w\"];\n\n\tpublic _component:number;\n\n\t/**\n\t * Creates a new ShaderRegisterElement object.\n\t *\n\t * @param regName The name of the register.\n\t * @param index The index of the register.\n\t * @param component The register's component, if not the entire register is represented.\n\t */\n\tconstructor(regName:string, index:number, component:number = -1)\n\t{\n\t\tthis._component = component;\n\t\tthis._regName = regName;\n\t\tthis._index = index;\n\n\t\tthis._toStr = this._regName;\n\n\t\tif (this._index >= 0)\n\t\t\tthis._toStr += this._index;\n\n\t\tif (component > -1)\n\t\t\tthis._toStr += \".\" + ShaderRegisterElement.COMPONENTS[component];\n\t}\n\n\t/**\n\t * Converts the register or the components AGAL string representation.\n\t */\n\tpublic toString():string\n\t{\n\t\treturn this._toStr;\n\t}\n\n\t/**\n\t * The register's name.\n\t */\n\tpublic get regName():string\n\t{\n\t\treturn this._regName;\n\t}\n\n\t/**\n\t * The register's index.\n\t */\n\tpublic get index():number\n\t{\n\t\treturn this._index;\n\t}\n}\n\nexport = ShaderRegisterElement;","import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\nimport SkyboxPass\t\t\t\t\t= require(\"awayjs-renderergl/lib/passes/SkyboxPass\");\n\n/**\n * SkyboxRenderObject forms an abstract base class for the default shaded materials provided by Stage,\n * using material methods to define their appearance.\n */\nclass SkyboxRenderObject extends RenderObjectBase\n{\n\t/**\n\t *\n\t */\n\tpublic static id:string = \"skybox\";\n\n\tprivate _screenPass:SkyboxPass;\n\n\tconstructor(pool:RenderObjectPool, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tsuper(pool, renderObjectOwner, renderableClass, stage);\n\n\t\tthis._screenPass = new SkyboxPass(this, renderObjectOwner, renderableClass, this._stage);\n\n\t\tthis._pAddScreenPass(this._screenPass);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pUpdateRenderObject()\n\t{\n\t\tsuper._pUpdateRenderObject();\n\n\t\tthis._pRequiresBlending = (this._renderObjectOwner.blendMode != BlendMode.NORMAL);\n\n\t\tthis._screenPass.setBlendMode((this._renderObjectOwner.blendMode == BlendMode.NORMAL && this._pRequiresBlending)? BlendMode.LAYER : this._renderObjectOwner.blendMode);\n\t}\n}\n\nexport = SkyboxRenderObject;","import Error\t\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\n\nclass AnimationSetError extends Error\n{\n\tconstructor(message:string)\n\t{\n\t\tsuper(message);\n\t}\n}\n\nexport = AnimationSetError;","import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\n\nimport Event\t\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\nimport IAnimationState\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/IAnimationState\");\n\n/**\n * Dispatched to notify changes in an animation state's state.\n */\nclass AnimationStateEvent extends Event\n{\n\t/**\n\t * Dispatched when a non-looping clip node inside an animation state reaches the end of its timeline.\n\t */\n\tpublic static PLAYBACK_COMPLETE:string = \"playbackComplete\";\n\n\tpublic static TRANSITION_COMPLETE:string = \"transitionComplete\";\n\n\tprivate _animator:AnimatorBase;\n\tprivate _animationState:IAnimationState;\n\tprivate _animationNode:AnimationNodeBase;\n\n\t/**\n\t * Create a new <code>AnimatonStateEvent</code>\n\t *\n\t * @param type The event type.\n\t * @param animator The animation state object that is the subject of this event.\n\t * @param animationNode The animation node inside the animation state from which the event originated.\n\t */\n\tconstructor(type:string, animator:AnimatorBase, animationState:IAnimationState, animationNode:AnimationNodeBase)\n\t{\n\t\tsuper(type);\n\n\t\tthis._animator = animator;\n\t\tthis._animationState = animationState;\n\t\tthis._animationNode = animationNode;\n\t}\n\n\t/**\n\t * The animator object that is the subject of this event.\n\t */\n\tpublic get animator():AnimatorBase\n\t{\n\t\treturn this._animator;\n\t}\n\n\t/**\n\t * The animation state object that is the subject of this event.\n\t */\n\tpublic get animationState():IAnimationState\n\t{\n\t\treturn this._animationState;\n\t}\n\n\t/**\n\t * The animation node inside the animation state from which the event originated.\n\t */\n\tpublic get animationNode():AnimationNodeBase\n\t{\n\t\treturn this._animationNode;\n\t}\n\n\t/**\n\t * Clones the event.\n\t *\n\t * @return An exact duplicate of the current object.\n\t */\n\tpublic clone():Event\n\t{\n\t\treturn new AnimationStateEvent(this.type, this._animator, this._animationState, this._animationNode);\n\t}\n}\n\nexport = AnimationStateEvent;","import Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nimport AnimatorBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\n\n/**\n * Dispatched to notify changes in an animator's state.\n */\nclass AnimatorEvent extends Event\n{\n\t/**\n\t * Defines the value of the type property of a start event object.\n\t */\n\tpublic static START:string = \"start\";\n\n\t/**\n\t * Defines the value of the type property of a stop event object.\n\t */\n\tpublic static STOP:string = \"stop\";\n\n\t/**\n\t * Defines the value of the type property of a cycle complete event object.\n\t */\n\tpublic static CYCLE_COMPLETE:string = \"cycle_complete\";\n\n\tprivate _animator:AnimatorBase;\n\n\t/**\n\t * Create a new <code>AnimatorEvent</code> object.\n\t *\n\t * @param type The event type.\n\t * @param animator The animator object that is the subject of this event.\n\t */\n\tconstructor(type:string, animator:AnimatorBase)\n\t{\n\t\tsuper(type);\n\t\tthis._animator = animator;\n\t}\n\n\tpublic get animator():AnimatorBase\n\t{\n\t\treturn this._animator;\n\t}\n\n\t/**\n\t * Clones the event.\n\t *\n\t * @return An exact duplicate of the current event object.\n\t */\n\tpublic clone():Event\n\t{\n\t\treturn new AnimatorEvent(this.type, this._animator);\n\t}\n}\n\nexport = AnimatorEvent;","import Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\n\nclass ShadingMethodEvent extends Event\n{\n\tpublic static SHADER_INVALIDATED:string = \"ShaderInvalidated\";\n\n\tconstructor(type:string)\n\t{\n\n\t\tsuper(type);\n\n\t}\n}\n\nexport = ShadingMethodEvent;","import Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ITexture\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITexture\");\n\nimport Filter3DTaskBase\t\t\t\t= require(\"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase\");\n\nclass Filter3DBase\n{\n\tprivate _tasks:Array<Filter3DTaskBase>;\n\tprivate _requireDepthRender:boolean;\n\tprivate _textureWidth:number;\n\tprivate _textureHeight:number;\n\n\tconstructor()\n\t{\n\t\tthis._tasks = new Array<Filter3DTaskBase>();\n\t}\n\n\tpublic get requireDepthRender():boolean\n\t{\n\t\treturn this._requireDepthRender;\n\t}\n\n\tpublic pAddTask(filter:Filter3DTaskBase)\n\t{\n\t\tthis._tasks.push(filter);\n\n\t\tif (this._requireDepthRender == null)\n\t\t\tthis._requireDepthRender = filter.requireDepthRender;\n\t}\n\n\tpublic get tasks():Filter3DTaskBase[]\n\t{\n\t\treturn this._tasks;\n\t}\n\n\tpublic getMainInputTexture(stage:Stage):ITexture\n\t{\n\t\treturn this._tasks[0].getMainInputTexture(stage);\n\t}\n\n\tpublic get textureWidth():number\n\t{\n\t\treturn this._textureWidth;\n\t}\n\n\tpublic set textureWidth(value:number)\n\t{\n\t\tthis._textureWidth = value;\n\n\t\tfor (var i:number = 0; i < this._tasks.length; ++i)\n\t\t\tthis._tasks[i].textureWidth = value;\n\t}\n\n\tpublic get textureHeight():number\n\t{\n\t\treturn this._textureHeight;\n\t}\n\n\tpublic set textureHeight(value:number)\n\t{\n\t\tthis._textureHeight = value;\n\n\t\tfor (var i:number = 0; i < this._tasks.length; ++i)\n\t\t\tthis._tasks[i].textureHeight = value;\n\t}\n\n\t// link up the filters correctly with the next filter\n\tpublic setRenderTargets(mainTarget:ITexture, stage:Stage)\n\t{\n\t\tthis._tasks[this._tasks.length - 1].target = mainTarget;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tfor (var i:number = 0; i < this._tasks.length; ++i)\n\t\t\tthis._tasks[i].dispose();\n\t}\n\n\tpublic update(stage:Stage, camera:Camera)\n\t{\n\n\t}\n}\n\nexport = Filter3DBase;","import AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\nimport ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport AGALMiniAssembler\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler\");\nimport ContextGLTextureFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFormat\");\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport IProgram\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IProgram\");\nimport ITexture\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITexture\");\n\nclass Filter3DTaskBase\n{\n\tprivate _mainInputTexture:ITexture;\n\n\tprivate _scaledTextureWidth:number = -1;\n\tprivate _scaledTextureHeight:number = -1;\n\tprivate _textureWidth:number = -1;\n\tprivate _textureHeight:number = -1;\n\tprivate _textureDimensionsInvalid:boolean = true;\n\tprivate _program3DInvalid:boolean = true;\n\tprivate _program3D:IProgram;\n\tprivate _target:ITexture;\n\tprivate _requireDepthRender:boolean;\n\tprivate _textureScale:number = 0;\n\n\tconstructor(requireDepthRender:boolean = false)\n\t{\n\n\t\tthis._requireDepthRender = requireDepthRender;\n\n\t}\n\n\t/**\n\t * The texture scale for the input of this texture. This will define the output of the previous entry in the chain\n\t */\n\tpublic get textureScale():number\n\t{\n\t\treturn this._textureScale;\n\t}\n\n\tpublic set textureScale(value:number)\n\t{\n\t\tif (this._textureScale == value)\n\t\t\treturn;\n\n\t\tthis._textureScale = value;\n\t\tthis._scaledTextureWidth = this._textureWidth >> this._textureScale;\n\t\tthis._scaledTextureHeight = this._textureHeight >> this._textureScale;\n\t\tthis._textureDimensionsInvalid = true;\n\t}\n\n\tpublic get target():ITexture\n\t{\n\t\treturn this._target;\n\t}\n\n\tpublic set target(value:ITexture)\n\t{\n\t\tthis._target = value;\n\t}\n\n\tpublic get textureWidth():number\n\t{\n\t\treturn this._textureWidth;\n\t}\n\n\tpublic set textureWidth(value:number)\n\t{\n\t\tif (this._textureWidth == value)\n\t\t\treturn;\n\n\t\tthis._textureWidth = value;\n\t\tthis._scaledTextureWidth = this._textureWidth >> this._textureScale;\n\t\tthis._textureDimensionsInvalid = true;\n\t}\n\n\tpublic get textureHeight():number\n\t{\n\t\treturn this._textureHeight;\n\t}\n\n\tpublic set textureHeight(value:number)\n\t{\n\t\tif (this._textureHeight == value)\n\t\t\treturn;\n\n\t\tthis._textureHeight = value;\n\t\tthis._scaledTextureHeight = this._textureHeight >> this._textureScale;\n\t\tthis._textureDimensionsInvalid = true;\n\t}\n\n\tpublic getMainInputTexture(stage:Stage):ITexture\n\t{\n\t\tif (this._textureDimensionsInvalid)\n\t\t\tthis.pUpdateTextures(stage);\n\n\t\treturn this._mainInputTexture;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tif (this._mainInputTexture)\n\t\t\tthis._mainInputTexture.dispose();\n\n\t\tif (this._program3D)\n\t\t\tthis._program3D.dispose();\n\t}\n\n\tpublic pInvalidateProgram()\n\t{\n\t\tthis._program3DInvalid = true;\n\t}\n\n\tpublic pUpdateProgram(stage:Stage)\n\t{\n\t\tif (this._program3D)\n\t\t\tthis._program3D.dispose();\n\n\t\tthis._program3D = stage.context.createProgram();\n\n\t\tvar vertexByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part vertex 1\\n\" + this.pGetVertexCode() + \"endpart\"))['vertex'].data;\n\t\tvar fragmentByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part fragment 1\\n\" + this.pGetFragmentCode() + \"endpart\"))['fragment'].data;\n\t\tthis._program3D.upload(vertexByteCode, fragmentByteCode);\n\t\tthis._program3DInvalid = false;\n\t}\n\n\tpublic pGetVertexCode():string\n\t{\n\t\t// TODO: imeplement AGAL <> GLSL\n\n\t\treturn \"mov op, va0\\n\" + \"mov v0, va1\\n\";\n\t}\n\n\tpublic pGetFragmentCode():string\n\t{\n\t\tthrow new AbstractMethodError();\n\n\t\treturn null;\n\t}\n\n\tpublic pUpdateTextures(stage:Stage)\n\t{\n\t\tif (this._mainInputTexture)\n\t\t\tthis._mainInputTexture.dispose();\n\n\t\tthis._mainInputTexture = stage.context.createTexture(this._scaledTextureWidth, this._scaledTextureHeight, ContextGLTextureFormat.BGRA, true);\n\n\t\tthis._textureDimensionsInvalid = false;\n\t}\n\n\tpublic getProgram(stage:Stage):IProgram\n\t{\n\t\tif (this._program3DInvalid)\n\t\t\tthis.pUpdateProgram(stage);\n\n\t\treturn this._program3D;\n\t}\n\n\tpublic activate(stage:Stage, camera:Camera, depthTexture:ITexture)\n\t{\n\t}\n\n\tpublic deactivate(stage:Stage)\n\t{\n\t}\n\n\tpublic get requireDepthRender():boolean\n\t{\n\t\treturn this._requireDepthRender;\n\t}\n\n}\n\nexport = Filter3DTaskBase;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport BitmapTexture\t\t\t\t= require(\"awayjs-core/lib/textures/BitmapTexture\");\n\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\nimport BasicMaterial\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\n\n\nclass DefaultMaterialManager\n{\n\tprivate static _defaultBitmapData:BitmapData;\n\tprivate static _defaultTriangleMaterial:BasicMaterial;\n\tprivate static _defaultLineMaterial:BasicMaterial;\n\tprivate static _defaultTexture:BitmapTexture;\n\n\tpublic static getDefaultMaterial(renderableOwner:IRenderableOwner = null):BasicMaterial\n\t{\n\t\tif (renderableOwner != null && renderableOwner.assetType == AssetType.LINE_SUB_MESH) {\n\t\t\tif (!DefaultMaterialManager._defaultLineMaterial)\n\t\t\t\tDefaultMaterialManager.createDefaultLineMaterial();\n\t\t\treturn DefaultMaterialManager._defaultLineMaterial;\n\t\t} else {\n\t\t\tif (!DefaultMaterialManager._defaultTriangleMaterial)\n\t\t\t\tDefaultMaterialManager.createDefaultTriangleMaterial();\n\t\t\treturn DefaultMaterialManager._defaultTriangleMaterial;\n\t\t}\n\t}\n\n\tpublic static getDefaultTexture(renderableOwner:IRenderableOwner = null):BitmapTexture\n\t{\n\t\tif (!DefaultMaterialManager._defaultTexture)\n\t\t\tDefaultMaterialManager.createDefaultTexture();\n\t\treturn DefaultMaterialManager._defaultTexture;\n\t}\n\n\tprivate static createDefaultTexture()\n\t{\n\t\tDefaultMaterialManager._defaultBitmapData = DefaultMaterialManager.createCheckeredBitmapData();\n\t\tDefaultMaterialManager._defaultTexture = new BitmapTexture(DefaultMaterialManager._defaultBitmapData);\n\t\tDefaultMaterialManager._defaultTexture.name = \"defaultTexture\";\n\t}\n\n\tpublic static createCheckeredBitmapData():BitmapData\n\t{\n\t\tvar b:BitmapData = new BitmapData(8, 8, false, 0x000000);\n\t\t//create chekerboard\n\t\tvar i:number, j:number;\n\t\tfor (i = 0; i < 8; i++) {\n\t\t\tfor (j = 0; j < 8; j++) {\n\t\t\t\tif ((j & 1) ^ (i & 1)) {\n\t\t\t\t\tb.setPixel(i, j, 0XFFFFFF);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn b;\n\t}\n\n\tprivate static createDefaultTriangleMaterial()\n\t{\n\t\tif (!DefaultMaterialManager._defaultTexture)\n\t\t\tDefaultMaterialManager.createDefaultTexture();\n\t\tDefaultMaterialManager._defaultTriangleMaterial = new BasicMaterial(DefaultMaterialManager._defaultTexture);\n\t\tDefaultMaterialManager._defaultTriangleMaterial.mipmap = false;\n\t\tDefaultMaterialManager._defaultTriangleMaterial.smooth = false;\n\t\tDefaultMaterialManager._defaultTriangleMaterial.name = \"defaultTriangleMaterial\";\n\t}\n\n\tprivate static createDefaultLineMaterial()\n\t{\n\t\tDefaultMaterialManager._defaultLineMaterial = new BasicMaterial();\n\t\tDefaultMaterialManager._defaultLineMaterial.name = \"defaultLineMaterial\";\n\t}\n}\n\nexport = DefaultMaterialManager;","import Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\nimport TextureUtils\t\t\t\t\t= require(\"awayjs-core/lib/utils/TextureUtils\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport IIndexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IIndexBuffer\");\nimport IVertexBuffer\t\t\t\t= require(\"awayjs-stagegl/lib/base/IVertexBuffer\");\n\nclass RTTBufferManager extends EventDispatcher\n{\n\tprivate static _instances:Array<RTTBufferManagerVO>;\n\n\tprivate _renderToTextureVertexBuffer:IVertexBuffer;\n\tprivate _renderToScreenVertexBuffer:IVertexBuffer;\n\n\tprivate _indexBuffer:IIndexBuffer;\n\tprivate _stage:Stage;\n\tprivate _viewWidth:number = -1;\n\tprivate _viewHeight:number = -1;\n\tprivate _textureWidth:number = -1;\n\tprivate _textureHeight:number = -1;\n\tprivate _renderToTextureRect:Rectangle;\n\tprivate _buffersInvalid:boolean = true;\n\n\tprivate _textureRatioX:number;\n\tprivate _textureRatioY:number;\n\n\tconstructor(stage:Stage)\n\t{\n\t\tsuper();\n\n\t\tthis._renderToTextureRect = new Rectangle();\n\n\t\tthis._stage = stage;\n\n\t}\n\n\tpublic static getInstance(stage:Stage):RTTBufferManager\n\t{\n\t\tif (!stage)\n\t\t\tthrow new Error(\"stage key cannot be null!\");\n\n\t\tif (RTTBufferManager._instances == null)\n\t\t\tRTTBufferManager._instances = new Array<RTTBufferManagerVO>();\n\n\t\tvar rttBufferManager:RTTBufferManager = RTTBufferManager.getRTTBufferManagerFromStage(stage);\n\n\t\tif (rttBufferManager == null) {\n\t\t\trttBufferManager = new RTTBufferManager(stage);\n\n\t\t\tvar vo:RTTBufferManagerVO = new RTTBufferManagerVO();\n\n\t\t\tvo.stage3d = stage;\n\t\t\tvo.rttbfm = rttBufferManager;\n\n\t\t\tRTTBufferManager._instances.push(vo);\n\t\t}\n\n\t\treturn rttBufferManager;\n\n\t}\n\n\tprivate static getRTTBufferManagerFromStage(stage:Stage):RTTBufferManager\n\t{\n\n\t\tvar l:number = RTTBufferManager._instances.length;\n\t\tvar r:RTTBufferManagerVO;\n\n\t\tfor (var c:number = 0; c < l; c++) {\n\t\t\tr = RTTBufferManager._instances[ c ];\n\n\t\t\tif (r.stage3d === stage)\n\t\t\t\treturn r.rttbfm;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate static deleteRTTBufferManager(stage:Stage):void\n\t{\n\t\tvar l:number = RTTBufferManager._instances.length;\n\t\tvar r:RTTBufferManagerVO;\n\n\t\tfor (var c:number = 0; c < l; c++) {\n\t\t\tr = RTTBufferManager._instances[ c ];\n\n\t\t\tif (r.stage3d === stage) {\n\t\t\t\tRTTBufferManager._instances.splice(c, 1);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic get textureRatioX():number\n\t{\n\t\tif (this._buffersInvalid)\n\t\t\tthis.updateRTTBuffers();\n\n\t\treturn this._textureRatioX;\n\t}\n\n\tpublic get textureRatioY():number\n\t{\n\t\tif (this._buffersInvalid)\n\t\t\tthis.updateRTTBuffers();\n\n\t\treturn this._textureRatioY;\n\t}\n\n\tpublic get viewWidth():number\n\t{\n\t\treturn this._viewWidth;\n\t}\n\n\tpublic set viewWidth(value:number)\n\t{\n\t\tif (value == this._viewWidth)\n\t\t\treturn;\n\n\t\tthis._viewWidth = value;\n\n\t\tthis._buffersInvalid = true;\n\n\t\tthis._textureWidth = TextureUtils.getBestPowerOf2(this._viewWidth);\n\n\t\tif (this._textureWidth > this._viewWidth) {\n\t\t\tthis._renderToTextureRect.x = Math.floor((this._textureWidth - this._viewWidth)*.5);\n\t\t\tthis._renderToTextureRect.width = this._viewWidth;\n\t\t} else {\n\t\t\tthis._renderToTextureRect.x = 0;\n\t\t\tthis._renderToTextureRect.width = this._textureWidth;\n\t\t}\n\n\t\tthis.dispatchEvent(new Event(Event.RESIZE));\n\t}\n\n\tpublic get viewHeight():number\n\t{\n\t\treturn this._viewHeight;\n\t}\n\n\tpublic set viewHeight(value:number)\n\t{\n\t\tif (value == this._viewHeight)\n\t\t\treturn;\n\n\t\tthis._viewHeight = value;\n\n\t\tthis._buffersInvalid = true;\n\n\t\tthis._textureHeight = TextureUtils.getBestPowerOf2(this._viewHeight);\n\n\t\tif (this._textureHeight > this._viewHeight) {\n\t\t\tthis._renderToTextureRect.y = Math.floor((this._textureHeight - this._viewHeight)*.5);\n\t\t\tthis._renderToTextureRect.height = this._viewHeight;\n\t\t} else {\n\t\t\tthis._renderToTextureRect.y = 0;\n\t\t\tthis._renderToTextureRect.height = this._textureHeight;\n\t\t}\n\n\t\tthis.dispatchEvent(new Event(Event.RESIZE));\n\t}\n\n\tpublic get renderToTextureVertexBuffer():IVertexBuffer\n\t{\n\t\tif (this._buffersInvalid)\n\t\t\tthis.updateRTTBuffers();\n\n\t\treturn this._renderToTextureVertexBuffer;\n\t}\n\n\tpublic get renderToScreenVertexBuffer():IVertexBuffer\n\t{\n\t\tif (this._buffersInvalid)\n\t\t\tthis.updateRTTBuffers();\n\n\t\treturn this._renderToScreenVertexBuffer;\n\n\t}\n\n\tpublic get indexBuffer():IIndexBuffer\n\t{\n\t\treturn this._indexBuffer;\n\t}\n\n\tpublic get renderToTextureRect():Rectangle\n\t{\n\t\tif (this._buffersInvalid)\n\t\t\tthis.updateRTTBuffers();\n\n\t\treturn this._renderToTextureRect;\n\t}\n\n\tpublic get textureWidth():number\n\t{\n\t\treturn this._textureWidth;\n\t}\n\n\tpublic get textureHeight():number\n\t{\n\t\treturn this._textureHeight;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tRTTBufferManager.deleteRTTBufferManager(this._stage);\n\n\t\tif (this._indexBuffer) {\n\t\t\tthis._indexBuffer.dispose();\n\t\t\tthis._renderToScreenVertexBuffer.dispose();\n\t\t\tthis._renderToTextureVertexBuffer.dispose();\n\t\t\tthis._renderToScreenVertexBuffer = null;\n\t\t\tthis._renderToTextureVertexBuffer = null;\n\t\t\tthis._indexBuffer = null;\n\t\t}\n\t}\n\n\t// todo: place all this in a separate model, since it's used all over the place\n\t// maybe it even has a place in the core (together with screenRect etc)?\n\t// needs to be stored per view of course\n\tprivate updateRTTBuffers()\n\t{\n\t\tvar context:IContextGL = this._stage.context;\n\t\tvar textureVerts:number[];\n\t\tvar screenVerts:number[];\n\n\t\tvar x:number;\n\t\tvar y:number;\n\n\t\tif (this._renderToTextureVertexBuffer == null)\n\t\t\tthis._renderToTextureVertexBuffer = context.createVertexBuffer(4, 5);\n\n\t\tif (this._renderToScreenVertexBuffer == null)\n\t\t\tthis._renderToScreenVertexBuffer = context.createVertexBuffer(4, 5);\n\n\t\tif (!this._indexBuffer) {\n\t\t\tthis._indexBuffer = context.createIndexBuffer(6);\n\n\t\t\tthis._indexBuffer.uploadFromArray([2, 1, 0, 3, 2, 0], 0, 6);\n\t\t}\n\n\t\tthis._textureRatioX = x = Math.min(this._viewWidth/this._textureWidth, 1);\n\t\tthis._textureRatioY = y = Math.min(this._viewHeight/this._textureHeight, 1);\n\n\t\tvar u1:number = (1 - x)*.5;\n\t\tvar u2:number = (x + 1)*.5;\n\t\tvar v1:number = (y + 1)*.5;\n\t\tvar v2:number = (1 - y)*.5;\n\n\t\t// last element contains indices for data per vertex that can be passed to the vertex shader if necessary (ie: frustum corners for deferred rendering)\n\t\ttextureVerts = [    -x, -y, u1, v1, 0, x, -y, u2, v1, 1, x, y, u2, v2, 2, -x, y, u1, v2, 3 ];\n\n\t\tscreenVerts = [     -1, -1, u1, v1, 0, 1, -1, u2, v1, 1, 1, 1, u2, v2, 2, -1, 1, u1, v2, 3 ];\n\n\t\tthis._renderToTextureVertexBuffer.uploadFromArray(textureVerts, 0, 4);\n\t\tthis._renderToScreenVertexBuffer.uploadFromArray(screenVerts, 0, 4);\n\n\t\tthis._buffersInvalid = false;\n\t}\n}\n\nexport = RTTBufferManager;\n\nclass RTTBufferManagerVO\n{\n\tpublic stage3d:Stage;\n\n\tpublic rttbfm:RTTBufferManager;\n}","import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\nimport Matrix\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\nimport Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\n\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\nimport ContextGLMipFilter\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLMipFilter\");\nimport ContextGLTextureFilter\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFilter\");\nimport ContextGLWrapMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLWrapMode\");\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\n\n\n/**\n * BasicMaterialPass forms an abstract base class for the default shaded materials provided by Stage,\n * using material methods to define their appearance.\n */\nclass BasicMaterialPass extends RenderPassBase\n{\n\tprivate _diffuseR:number = 1;\n\tprivate _diffuseG:number = 1;\n\tprivate _diffuseB:number = 1;\n\tprivate _diffuseA:number = 1;\n\n\tprivate _fragmentConstantsIndex:number;\n\tprivate _texturesIndex:number;\n\n\tconstructor(renderObject:RenderObjectBase, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tsuper(renderObject, renderObjectOwner, renderableClass, stage);\n\n\t\tthis._shader = new ShaderObjectBase(renderableClass, this, this._stage);\n\t}\n\n\tpublic _iIncludeDependencies(shaderObject:ShaderObjectBase)\n\t{\n\t\tsuper._iIncludeDependencies(shaderObject);\n\n\t\tif (shaderObject.texture != null)\n\t\t\tshaderObject.uvDependencies++;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGetFragmentCode(shaderObject:ShaderObjectBase, regCache:ShaderRegisterCache, sharedReg:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar targetReg:ShaderRegisterElement = sharedReg.shadedTarget;\n\t\tvar diffuseInputReg:ShaderRegisterElement;\n\n\t\tif (shaderObject.texture != null) {\n\t\t\tdiffuseInputReg = regCache.getFreeTextureReg();\n\n\t\t\tthis._texturesIndex = diffuseInputReg.index;\n\n\t\t\tcode += ShaderCompilerHelper.getTex2DSampleCode(targetReg, sharedReg, diffuseInputReg, shaderObject.texture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping);\n\n\t\t\tif (shaderObject.alphaThreshold > 0) {\n\t\t\t\tvar cutOffReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\n\t\t\t\tthis._fragmentConstantsIndex = cutOffReg.index*4;\n\n\t\t\t\tcode += \"sub \" + targetReg + \".w, \" + targetReg + \".w, \" + cutOffReg + \".x\\n\" + \"kil \" + targetReg + \".w\\n\" + \"add \" + targetReg + \".w, \" + targetReg + \".w, \" + cutOffReg + \".x\\n\";\n\t\t\t}\n\t\t} else if (shaderObject.colorBufferIndex != -1) {\n\n\t\t\tcode += \"mov \" + targetReg + \", \" + sharedReg.colorVarying + \"\\n\";\n\t\t} else {\n\t\t\tdiffuseInputReg = regCache.getFreeFragmentConstant();\n\n\t\t\tthis._fragmentConstantsIndex = diffuseInputReg.index*4;\n\n\t\t\tcode += \"mov \" + targetReg + \", \" + diffuseInputReg + \"\\n\";\n\t\t}\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iActivate(camera:Camera)\n\t{\n\t\tsuper._iActivate(camera);\n\n\t\tif (this._shader.texture != null) {\n\t\t\tthis._stage.activateTexture(this._texturesIndex, this._shader.texture, this._shader.repeatTextures, this._shader.useSmoothTextures, this._shader.useMipmapping);\n\n\t\t\tif (this._shader.alphaThreshold > 0)\n\t\t\t\tthis._shader.fragmentConstantData[this._fragmentConstantsIndex] = this._shader.alphaThreshold;\n\t\t} else if (this._shader.colorBufferIndex == -1) {\n\t\t\tvar index:number = this._fragmentConstantsIndex;\n\t\t\tvar data:Array<number> = this._shader.fragmentConstantData;\n\t\t\tdata[index] = this._diffuseR;\n\t\t\tdata[index + 1] = this._diffuseG;\n\t\t\tdata[index + 2] = this._diffuseB;\n\t\t\tdata[index + 3] = this._diffuseA;\n\t\t}\n\t}\n}\n\nexport = BasicMaterialPass;","import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\nimport Matrix\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\nimport Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\n\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\nimport ContextGLMipFilter\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLMipFilter\");\nimport ContextGLTextureFilter\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFilter\");\nimport ContextGLWrapMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLWrapMode\");\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\n\n/**\n * DepthRenderObject forms an abstract base class for the default shaded materials provided by Stage,\n * using material methods to define their appearance.\n */\nclass DepthPass extends RenderPassBase\n{\n\n\tprivate _fragmentConstantsIndex:number;\n\tprivate _texturesIndex:number;\n\n\tconstructor(renderObject:RenderObjectBase, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tsuper(renderObject, renderObjectOwner, renderableClass, stage);\n\n\t\tthis._shader = new ShaderObjectBase(renderableClass, this, this._stage);\n\t}\n\n\tpublic _iIncludeDependencies(shaderObject:ShaderObjectBase)\n\t{\n\t\tsuper._iIncludeDependencies(shaderObject);\n\n\t\tshaderObject.projectionDependencies++;\n\n\t\tif (shaderObject.alphaThreshold > 0)\n\t\t\tshaderObject.uvDependencies++;\n\t}\n\n\n\tpublic _iInitConstantData(shaderObject:ShaderObjectBase)\n\t{\n\t\tsuper._iInitConstantData(shaderObject);\n\n\t\tvar index:number = this._fragmentConstantsIndex;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tdata[index] = 1.0;\n\t\tdata[index + 1] = 255.0;\n\t\tdata[index + 2] = 65025.0;\n\t\tdata[index + 3] = 16581375.0;\n\t\tdata[index + 4] = 1.0/255.0;\n\t\tdata[index + 5] = 1.0/255.0;\n\t\tdata[index + 6] = 1.0/255.0;\n\t\tdata[index + 7] = 0.0;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGetFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\t\tvar targetReg:ShaderRegisterElement = sharedRegisters.shadedTarget;\n\t\tvar diffuseInputReg:ShaderRegisterElement = registerCache.getFreeTextureReg();\n\t\tvar dataReg1:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar dataReg2:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\n\t\tthis._fragmentConstantsIndex = dataReg1.index*4;\n\n\t\tvar temp1:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tregisterCache.addFragmentTempUsages(temp1, 1);\n\t\tvar temp2:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tregisterCache.addFragmentTempUsages(temp2, 1);\n\n\t\tcode += \"div \" + temp1 + \", \" + sharedRegisters.projectionFragment + \", \" + sharedRegisters.projectionFragment + \".w\\n\" + //\"sub ft2.z, fc0.x, ft2.z\\n\" +    //invert\n\t\t\"mul \" + temp1 + \", \" + dataReg1 + \", \" + temp1 + \".z\\n\" +\n\t\t\"frc \" + temp1 + \", \" + temp1 + \"\\n\" +\n\t\t\"mul \" + temp2 + \", \" + temp1 + \".yzww, \" + dataReg2 + \"\\n\";\n\n\t\t//codeF += \"mov ft1.w, fc1.w\t\\n\" +\n\t\t//    \"mov ft0.w, fc0.x\t\\n\";\n\n\t\tif (shaderObject.texture && shaderObject.alphaThreshold > 0) {\n\t\t\tdiffuseInputReg = registerCache.getFreeTextureReg();\n\n\t\t\tthis._texturesIndex = diffuseInputReg.index;\n\n\t\t\tvar albedo:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\t\tcode += ShaderCompilerHelper.getTex2DSampleCode(albedo, sharedRegisters, diffuseInputReg, shaderObject.texture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping);\n\n\t\t\tvar cutOffReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\n\t\t\tcode += \"sub \" + albedo + \".w, \" + albedo + \".w, \" + cutOffReg + \".x\\n\" +\n\t\t\t\"kil \" + albedo + \".w\\n\";\n\t\t}\n\n\t\tcode += \"sub \" + targetReg + \", \" + temp1 + \", \" + temp2 + \"\\n\";\n\n\t\tregisterCache.removeFragmentTempUsage(temp1);\n\t\tregisterCache.removeFragmentTempUsage(temp2);\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iActivate(camera:Camera)\n\t{\n\t\tsuper._iActivate(camera);\n\n\t\tvar context:IContextGL = this._stage.context;\n\n\t\tif (this._shader.texture && this._shader.alphaThreshold > 0) {\n\t\t\tthis._stage.activateTexture(this._texturesIndex, this._shader.texture, this._shader.repeatTextures, this._shader.useSmoothTextures, this._shader.useMipmapping);\n\n\t\t\tthis._shader.fragmentConstantData[this._fragmentConstantsIndex + 8] = this._shader.alphaThreshold;\n\t\t}\n\t}\n\n}\n\nexport = DepthPass;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\nimport Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport ContextGLMipFilter\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLMipFilter\");\nimport ContextGLTextureFilter\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFilter\");\nimport ContextGLWrapMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLWrapMode\");\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\n\n/**\n * DistancePass is a pass that writes distance values to a depth map as a 32-bit value exploded over the 4 texture channels.\n * This is used to render omnidirectional shadow maps.\n */\nclass DistancePass extends RenderPassBase\n{\n\tprivate _fragmentConstantsIndex:number;\n\tprivate _texturesIndex:number;\n\n\t/**\n\t * Creates a new DistancePass object.\n\t *\n\t * @param material The material to which this pass belongs.\n\t */\n\tconstructor(renderObject:RenderObjectBase, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tsuper(renderObject, renderObjectOwner, renderableClass, stage);\n\n\t\tthis._shader = new ShaderObjectBase(renderableClass, this, this._stage);\n\t}\n\n\t/**\n\t * Initializes the unchanging constant data for this material.\n\t */\n\tpublic _iInitConstantData(shaderObject:ShaderObjectBase)\n\t{\n\t\tsuper._iInitConstantData(shaderObject);\n\n\t\tvar index:number = this._fragmentConstantsIndex;\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\n\t\tdata[index + 4] = 1.0/255.0;\n\t\tdata[index + 5] = 1.0/255.0;\n\t\tdata[index + 6] = 1.0/255.0;\n\t\tdata[index + 7] = 0.0;\n\t}\n\n\tpublic _iIncludeDependencies(shaderObject:ShaderObjectBase)\n\t{\n\t\tsuper._iIncludeDependencies(shaderObject);\n\n\t\tshaderObject.projectionDependencies++;\n\t\tshaderObject.viewDirDependencies++;\n\n\t\tif (shaderObject.alphaThreshold > 0)\n\t\t\tshaderObject.uvDependencies++;\n\n\t\tif (shaderObject.viewDirDependencies > 0)\n\t\t\tshaderObject.globalPosDependencies++;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iGetFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string;\n\t\tvar targetReg:ShaderRegisterElement = sharedRegisters.shadedTarget;\n\t\tvar diffuseInputReg:ShaderRegisterElement = registerCache.getFreeTextureReg();\n\t\tvar dataReg1:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\t\tvar dataReg2:ShaderRegisterElement = registerCache.getFreeFragmentConstant()\n\n\t\tthis._fragmentConstantsIndex = dataReg1.index*4;\n\n\t\tvar temp1:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tregisterCache.addFragmentTempUsages(temp1, 1);\n\t\tvar temp2:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\tregisterCache.addFragmentTempUsages(temp2, 1);\n\n\t\t// squared distance to view\n\t\tcode = \"dp3 \" + temp1 + \".z, \" + sharedRegisters.viewDirVarying + \".xyz, \" + sharedRegisters.viewDirVarying + \".xyz\\n\" +\n\t\t\t   \"mul \" + temp1 + \", \" + dataReg1 + \", \" + temp1 + \".z\\n\" +\n\t\t\t   \"frc \" + temp1 + \", \" + temp1 + \"\\n\" +\n\t\t\t   \"mul \" + temp2 + \", \" + temp1 + \".yzww, \" + dataReg2 + \"\\n\";\n\n\t\tif (shaderObject.alphaThreshold > 0) {\n\t\t\tdiffuseInputReg = registerCache.getFreeTextureReg();\n\n\t\t\tthis._texturesIndex = diffuseInputReg.index;\n\n\t\t\tvar albedo:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\n\t\t\tcode += ShaderCompilerHelper.getTex2DSampleCode(albedo, sharedRegisters, diffuseInputReg, shaderObject.texture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping);\n\n\t\t\tvar cutOffReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\n\n\t\t\tcode += \"sub \" + albedo + \".w, \" + albedo + \".w, \" + cutOffReg + \".x\\n\" +\n\t\t\t\t\"kil \" + albedo + \".w\\n\";\n\t\t}\n\n\t\tcode += \"sub \" + targetReg + \", \" + temp1 + \", \" + temp2 + \"\\n\";\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iActivate(camera:Camera)\n\t{\n\t\tsuper._iActivate(camera);\n\n\t\tvar context:IContextGL = this._stage.context;\n\n\t\tvar f:number = camera.projection.far;\n\n\t\tf = 1/(2*f*f);\n\t\t// sqrt(f*f+f*f) is largest possible distance for any frustum, so we need to divide by it. Rarely a tight fit, but with 32 bits precision, it's enough.\n\t\tvar index:number = this._fragmentConstantsIndex;\n\t\tvar data:Array<number> = this._shader.fragmentConstantData;\n\t\tdata[index] = 1.0*f;\n\t\tdata[index + 1] = 255.0*f;\n\t\tdata[index + 2] = 65025.0*f;\n\t\tdata[index + 3] = 16581375.0*f;\n\n\t\tif (this._shader.alphaThreshold > 0) {\n\t\t\tthis._stage.activateTexture(this._texturesIndex, this._shader.texture, this._shader.repeatTextures, this._shader.useSmoothTextures, this._shader.useMipmapping);\n\n\t\t\tdata[index + 8] = this._shader.alphaThreshold;\n\t\t}\n\t}\n}\n\nexport = DistancePass;","import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\nimport NamedAssetBase\t\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\nimport ArgumentError\t\t\t\t= require(\"awayjs-core/lib/errors/ArgumentError\");\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\n\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport LightPickerBase\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\")\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\n\nimport AnimationSetBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\nimport IRenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/IRenderPassBase\");\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\n\n/**\n * RenderPassBase provides an abstract base class for material shader passes. A material pass constitutes at least\n * a render call per required renderable.\n */\nclass RenderPassBase extends EventDispatcher implements IRenderPassBase\n{\n\tprivate _renderObject:RenderObjectBase;\n\tpublic _renderObjectOwner:IRenderObjectOwner;\n\tpublic _renderableClass:IRenderableClass;\n\tpublic _stage:Stage;\n\t\n\tpublic _shader:ShaderObjectBase;\n\n\tprivate _preserveAlpha:boolean = true;\n\tprivate _forceSeparateMVP:boolean = false;\n\n\tprivate _depthCompareMode:string = ContextGLCompareMode.LESS_EQUAL;\n\n\tprivate _blendFactorSource:string = ContextGLBlendFactor.ONE;\n\tprivate _blendFactorDest:string = ContextGLBlendFactor.ZERO;\n\n\tpublic _pEnableBlending:boolean = false;\n\n\tprivate _writeDepth:boolean = true;\n\n\tpublic get shader():ShaderObjectBase\n\t{\n\t\treturn this._shader;\n\t}\n\n\tpublic get animationSet():AnimationSetBase\n\t{\n\t\treturn <AnimationSetBase> this._renderObjectOwner.animationSet;\n\t}\n\n\t/**\n\t * Indicates whether the output alpha value should remain unchanged compared to the material's original alpha.\n\t */\n\tpublic get preserveAlpha():boolean\n\t{\n\t\treturn this._preserveAlpha;\n\t}\n\n\tpublic set preserveAlpha(value:boolean)\n\t{\n\t\tif (this._preserveAlpha == value)\n\t\t\treturn;\n\n\t\tthis._preserveAlpha = value;\n\n\t\tthis.invalidatePass();\n\t}\n\n\t/**\n\t * Indicates whether the screen projection should be calculated by forcing a separate scene matrix and\n\t * view-projection matrix. This is used to prevent rounding errors when using multiple passes with different\n\t * projection code.\n\t */\n\tpublic get forceSeparateMVP():boolean\n\t{\n\t\treturn this._forceSeparateMVP;\n\t}\n\n\tpublic set forceSeparateMVP(value:boolean)\n\t{\n\t\tif (this._forceSeparateMVP == value)\n\t\t\treturn;\n\n\t\tthis._forceSeparateMVP = value;\n\n\t\tthis.invalidatePass();\n\t}\n\n\t/**\n\t * Creates a new RenderPassBase object.\n\t */\n\tconstructor(renderObject:RenderObjectBase, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tsuper();\n\n\t\tthis._renderObject = renderObject;\n\t\tthis._renderObjectOwner = renderObjectOwner;\n\t\tthis._renderableClass = renderableClass;\n\t\tthis._stage = stage;\n\t}\n\t\n\n\t/**\n\t * Indicate whether this pass should write to the depth buffer or not. Ignored when blending is enabled.\n\t */\n\tpublic get writeDepth():boolean\n\t{\n\t\treturn this._writeDepth;\n\t}\n\n\tpublic set writeDepth(value:boolean)\n\t{\n\t\tthis._writeDepth = value;\n\t}\n\n\t/**\n\t * The depth compare mode used to render the renderables using this material.\n\t *\n\t * @see away.stagegl.ContextGLCompareMode\n\t */\n\tpublic get depthCompareMode():string\n\t{\n\t\treturn this._depthCompareMode;\n\t}\n\n\tpublic set depthCompareMode(value:string)\n\t{\n\t\tthis._depthCompareMode = value;\n\t}\n\n\t/**\n\t * Cleans up any resources used by the current object.\n\t * @param deep Indicates whether other resources should be cleaned up, that could potentially be shared across different instances.\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._shader.dispose();\n\n\t\tthis._shader = null;\n\t}\n\n\t/**\n\t * Renders the current pass. Before calling renderPass, activatePass needs to be called with the same index.\n\t * @param pass The pass used to render the renderable.\n\t * @param renderable The IRenderable object to draw.\n\t * @param stage The Stage object used for rendering.\n\t * @param entityCollector The EntityCollector object that contains the visible scene data.\n\t * @param viewProjection The view-projection matrix used to project to the screen. This is not the same as\n\t * camera.viewProjection as it includes the scaling factors when rendering to textures.\n\t *\n\t * @internal\n\t */\n\tpublic _iRender(renderable:RenderableBase, camera:Camera, viewProjection:Matrix3D)\n\t{\n\t\tthis._shader._iRender(renderable, camera, viewProjection);\n\t}\n\t/**\n\t * The blend mode to use when drawing this renderable. The following blend modes are supported:\n\t * <ul>\n\t * <li>BlendMode.NORMAL: No blending, unless the material inherently needs it</li>\n\t * <li>BlendMode.LAYER: Force blending. This will draw the object the same as NORMAL, but without writing depth writes.</li>\n\t * <li>BlendMode.MULTIPLY</li>\n\t * <li>BlendMode.ADD</li>\n\t * <li>BlendMode.ALPHA</li>\n\t * </ul>\n\t */\n\tpublic setBlendMode(value:string)\n\t{\n\t\tswitch (value) {\n\t\t\tcase BlendMode.NORMAL:\n\t\t\t\tthis._blendFactorSource = ContextGLBlendFactor.ONE;\n\t\t\t\tthis._blendFactorDest = ContextGLBlendFactor.ZERO;\n\t\t\t\tthis._pEnableBlending = false;\n\t\t\t\tbreak;\n\n\t\t\tcase BlendMode.LAYER:\n\t\t\t\tthis._blendFactorSource = ContextGLBlendFactor.SOURCE_ALPHA;\n\t\t\t\tthis._blendFactorDest = ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA;\n\t\t\t\tthis._pEnableBlending = true;\n\t\t\t\tbreak;\n\n\t\t\tcase BlendMode.MULTIPLY:\n\t\t\t\tthis._blendFactorSource = ContextGLBlendFactor.ZERO;\n\t\t\t\tthis._blendFactorDest = ContextGLBlendFactor.SOURCE_COLOR;\n\t\t\t\tthis._pEnableBlending = true;\n\t\t\t\tbreak;\n\n\t\t\tcase BlendMode.ADD:\n\t\t\t\tthis._blendFactorSource = ContextGLBlendFactor.SOURCE_ALPHA;\n\t\t\t\tthis._blendFactorDest = ContextGLBlendFactor.ONE;\n\t\t\t\tthis._pEnableBlending = true;\n\t\t\t\tbreak;\n\n\t\t\tcase BlendMode.ALPHA:\n\t\t\t\tthis._blendFactorSource = ContextGLBlendFactor.ZERO;\n\t\t\t\tthis._blendFactorDest = ContextGLBlendFactor.SOURCE_ALPHA;\n\t\t\t\tthis._pEnableBlending = true;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new ArgumentError(\"Unsupported blend mode!\");\n\t\t}\n\t}\n\n\t/**\n\t * Sets the render state for the pass that is independent of the rendered object. This needs to be called before\n\t * calling renderPass. Before activating a pass, the previously used pass needs to be deactivated.\n\t * @param stage The Stage object which is currently used for rendering.\n\t * @param camera The camera from which the scene is viewed.\n\t * @private\n\t */\n\tpublic _iActivate(camera:Camera)\n\t{\n\t\tthis._stage.context.setDepthTest(( this._writeDepth && !this._pEnableBlending ), this._depthCompareMode);\n\n\t\tif (this._pEnableBlending)\n\t\t\tthis._stage.context.setBlendFactors(this._blendFactorSource, this._blendFactorDest);\n\n\t\tthis._shader._iActivate(camera);\n\t}\n\n\t/**\n\t * Clears the render state for the pass. This needs to be called before activating another pass.\n\t * @param stage The Stage used for rendering\n\t *\n\t * @private\n\t */\n\tpublic _iDeactivate()\n\t{\n\t\tthis._shader._iDeactivate();\n\n\t\t//For the love of god don't remove this if you want your multi-material shadows to not flicker like shit\n\t\tthis._stage.context.setDepthTest(true, ContextGLCompareMode.LESS_EQUAL);\n\t}\n\n\t/**\n\t * Marks the shader program as invalid, so it will be recompiled before the next render.\n\t *\n\t * @param updateMaterial Indicates whether the invalidation should be performed on the entire material. Should always pass \"true\" unless it's called from the material itself.\n\t */\n\tpublic invalidatePass()\n\t{\n\t\tthis._shader.invalidateShader();\n\n\t\tthis.dispatchEvent(new Event(Event.CHANGE));\n\t}\n\n\tpublic _iIncludeDependencies(shaderObject:ShaderObjectBase)\n\t{\n\t\tthis._renderObject._iIncludeDependencies(shaderObject);\n\t\t\n\t\tif (this._forceSeparateMVP)\n\t\t\tshaderObject.globalPosDependencies++;\n\t}\n\n\n\tpublic _iInitConstantData(shaderObject:ShaderObjectBase)\n\t{\n\n\t}\n\n\tpublic _iGetPreLightingVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"\";\n\t}\n\n\tpublic _iGetPreLightingFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"\";\n\t}\n\n\tpublic _iGetVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"\";\n\t}\n\n\tpublic _iGetFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"\";\n\t}\n\n\tpublic _iGetNormalVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"\";\n\t}\n\n\tpublic _iGetNormalFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Indicates whether or not normals are calculated at all.\n\t */\n\tpublic _pOutputsNormals(shaderObject:ShaderObjectBase):boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Indicates whether or not normals are calculated in tangent space.\n\t */\n\tpublic _pOutputsTangentNormals(shaderObject:ShaderObjectBase):boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Indicates whether or not normals are allowed in tangent space. This is only the case if no object-space\n\t * dependencies exist.\n\t */\n\tpublic _pUsesTangentSpace(shaderObject:ShaderObjectBase):boolean\n\t{\n\t\treturn false;\n\t}\n}\n\nexport = RenderPassBase;","import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\nimport Matrix\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\nimport Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\n\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\n\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\nimport ContextGLMipFilter\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLMipFilter\");\nimport ContextGLTextureFilter\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFilter\");\nimport ContextGLWrapMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLWrapMode\");\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport ShaderCompilerHelper\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\n\n/**\n * SkyboxPass forms an abstract base class for the default shaded materials provided by Stage,\n * using material methods to define their appearance.\n */\nclass SkyboxPass extends RenderPassBase\n{\n\tpublic _skybox:Skybox;\n\n\tconstructor(renderObject:RenderObjectBase, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tsuper(renderObject, renderObjectOwner, renderableClass, stage);\n\n\t\tthis._skybox = <Skybox> renderObjectOwner;\n\n\t\tthis._shader = new ShaderObjectBase(renderableClass, this, this._stage);\n\t}\n\n\n\t/**\n\t* @inheritDoc\n\t*/\n\tpublic _iGetFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\t//var cubeMapReg:ShaderRegisterElement = registerCache.getFreeTextureReg();\n\n\t\t//this._texturesIndex = cubeMapReg.index;\n\n\t\t//ShaderCompilerHelper.getTexCubeSampleCode(sharedRegisters.shadedTarget, cubeMapReg, this._cubeTexture, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\n\n\t\tvar mip:string = \",mipnone\";\n\n\t\tif (shaderObject.useMipmapping)\n\t\t\tmip = \",miplinear\";\n\n\t\treturn \"tex ft0, v0, fs0 <cube,\" + ShaderCompilerHelper.getFormatStringForTexture(this._skybox.cubeMap) + \"linear,clamp\" + mip + \">\\n\";\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iActivate(camera:Camera)\n\t{\n\t\tsuper._iActivate(camera);\n\n\t\tvar context:IContextGL = this._stage.context;\n\t\tcontext.setDepthTest(false, ContextGLCompareMode.LESS);\n\t\tthis._stage.activateCubeTexture(0, this._skybox.cubeMap, this._shader.useSmoothTextures, this._shader.useMipmapping);\n\t}\n}\n\nexport = SkyboxPass;","import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport PickingCollisionVO\t\t\t\t= require(\"awayjs-display/lib/pick/PickingCollisionVO\");\nimport IPickingCollider\t\t\t\t\t= require(\"awayjs-display/lib/pick/IPickingCollider\");\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport PickingColliderBase\t\t\t\t= require(\"awayjs-renderergl/lib/pick/PickingColliderBase\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * Pure JS picking collider for display objects. Used with the <code>RaycastPicker</code> picking object.\n *\n * @see away.base.DisplayObject#pickingCollider\n * @see away.pick.RaycastPicker\n *\n * @class away.pick.JSPickingCollider\n */\nclass JSPickingCollider extends PickingColliderBase implements IPickingCollider\n{\n\tprivate _findClosestCollision:boolean;\n\n\t/**\n\t * Creates a new <code>JSPickingCollider</code> object.\n\t *\n\t * @param findClosestCollision Determines whether the picking collider searches for the closest collision along the ray. Defaults to false.\n\t */\n\tconstructor(stage:Stage, findClosestCollision:boolean = false)\n\t{\n\t\tsuper(stage);\n\n\t\tthis._findClosestCollision = findClosestCollision;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pTestRenderableCollision(renderable:RenderableBase, pickingCollisionVO:PickingCollisionVO, shortestCollisionDistance:number):boolean\n\t{\n\t\tvar t:number;\n\t\tvar i0:number, i1:number, i2:number;\n\t\tvar rx:number, ry:number, rz:number;\n\t\tvar nx:number, ny:number, nz:number;\n\t\tvar cx:number, cy:number, cz:number;\n\t\tvar coeff:number, u:number, v:number, w:number;\n\t\tvar p0x:number, p0y:number, p0z:number;\n\t\tvar p1x:number, p1y:number, p1z:number;\n\t\tvar p2x:number, p2y:number, p2z:number;\n\t\tvar s0x:number, s0y:number, s0z:number;\n\t\tvar s1x:number, s1y:number, s1z:number;\n\t\tvar nl:number, nDotV:number, D:number, disToPlane:number;\n\t\tvar Q1Q2:number, Q1Q1:number, Q2Q2:number, RQ1:number, RQ2:number;\n\t\tvar indexData:Array<number> = renderable.getIndexData().data;\n\t\tvar collisionTriangleIndex:number = -1;\n\t\tvar bothSides:boolean = (<MaterialBase> renderable.renderObjectOwner).bothSides;\n\n\t\tvar positionData:Array<number> = renderable.getVertexData(TriangleSubGeometry.POSITION_DATA).data;\n\t\tvar positionStride:number = renderable.getVertexData(TriangleSubGeometry.POSITION_DATA).dataPerVertex;\n\t\tvar positionOffset:number = renderable.getVertexOffset(TriangleSubGeometry.POSITION_DATA);\n\t\tvar uvData:Array<number> = renderable.getVertexData(TriangleSubGeometry.UV_DATA).data;\n\t\tvar uvStride:number = renderable.getVertexData(TriangleSubGeometry.UV_DATA).dataPerVertex;\n\t\tvar uvOffset:number = renderable.getVertexOffset(TriangleSubGeometry.UV_DATA);\n\t\tvar numIndices:number = indexData.length;\n\n\t\tfor (var index:number = 0; index < numIndices; index += 3) { // sweep all triangles\n\t\t\t// evaluate triangle indices\n\t\t\ti0 = positionOffset + indexData[ index ]*positionStride;\n\t\t\ti1 = positionOffset + indexData[ (index + 1) ]*positionStride;\n\t\t\ti2 = positionOffset + indexData[ (index + 2) ]*positionStride;\n\n\t\t\t// evaluate triangle positions\n\t\t\tp0x = positionData[ i0 ];\n\t\t\tp0y = positionData[ (i0 + 1) ];\n\t\t\tp0z = positionData[ (i0 + 2) ];\n\t\t\tp1x = positionData[ i1 ];\n\t\t\tp1y = positionData[ (i1 + 1) ];\n\t\t\tp1z = positionData[ (i1 + 2) ];\n\t\t\tp2x = positionData[ i2 ];\n\t\t\tp2y = positionData[ (i2 + 1) ];\n\t\t\tp2z = positionData[ (i2 + 2) ];\n\n\t\t\t// evaluate sides and triangle normal\n\t\t\ts0x = p1x - p0x; // s0 = p1 - p0\n\t\t\ts0y = p1y - p0y;\n\t\t\ts0z = p1z - p0z;\n\t\t\ts1x = p2x - p0x; // s1 = p2 - p0\n\t\t\ts1y = p2y - p0y;\n\t\t\ts1z = p2z - p0z;\n\t\t\tnx = s0y*s1z - s0z*s1y; // n = s0 x s1\n\t\t\tny = s0z*s1x - s0x*s1z;\n\t\t\tnz = s0x*s1y - s0y*s1x;\n\t\t\tnl = 1/Math.sqrt(nx*nx + ny*ny + nz*nz); // normalize n\n\t\t\tnx *= nl;\n\t\t\tny *= nl;\n\t\t\tnz *= nl;\n\n\t\t\t// -- plane intersection test --\n\t\t\tnDotV = nx*this.rayDirection.x + ny* +this.rayDirection.y + nz*this.rayDirection.z; // rayDirection . normal\n\t\t\tif (( !bothSides && nDotV < 0.0 ) || ( bothSides && nDotV != 0.0 )) { // an intersection must exist\n\t\t\t\t// find collision t\n\t\t\t\tD = -( nx*p0x + ny*p0y + nz*p0z );\n\t\t\t\tdisToPlane = -( nx*this.rayPosition.x + ny*this.rayPosition.y + nz*this.rayPosition.z + D );\n\t\t\t\tt = disToPlane/nDotV;\n\t\t\t\t// find collision point\n\t\t\t\tcx = this.rayPosition.x + t*this.rayDirection.x;\n\t\t\t\tcy = this.rayPosition.y + t*this.rayDirection.y;\n\t\t\t\tcz = this.rayPosition.z + t*this.rayDirection.z;\n\t\t\t\t// collision point inside triangle? ( using barycentric coordinates )\n\t\t\t\tQ1Q2 = s0x*s1x + s0y*s1y + s0z*s1z;\n\t\t\t\tQ1Q1 = s0x*s0x + s0y*s0y + s0z*s0z;\n\t\t\t\tQ2Q2 = s1x*s1x + s1y*s1y + s1z*s1z;\n\t\t\t\trx = cx - p0x;\n\t\t\t\try = cy - p0y;\n\t\t\t\trz = cz - p0z;\n\t\t\t\tRQ1 = rx*s0x + ry*s0y + rz*s0z;\n\t\t\t\tRQ2 = rx*s1x + ry*s1y + rz*s1z;\n\t\t\t\tcoeff = 1/( Q1Q1*Q2Q2 - Q1Q2*Q1Q2 );\n\t\t\t\tv = coeff*( Q2Q2*RQ1 - Q1Q2*RQ2 );\n\t\t\t\tw = coeff*( -Q1Q2*RQ1 + Q1Q1*RQ2 );\n\t\t\t\tif (v < 0)\n\t\t\t\t\tcontinue;\n\t\t\t\tif (w < 0)\n\t\t\t\t\tcontinue;\n\t\t\t\tu = 1 - v - w;\n\t\t\t\tif (!( u < 0 ) && t > 0 && t < shortestCollisionDistance) { // all tests passed\n\t\t\t\t\tshortestCollisionDistance = t;\n\t\t\t\t\tcollisionTriangleIndex = index/3;\n\t\t\t\t\tpickingCollisionVO.rayEntryDistance = t;\n\t\t\t\t\tpickingCollisionVO.localPosition = new Vector3D(cx, cy, cz);\n\t\t\t\t\tpickingCollisionVO.localNormal = new Vector3D(nx, ny, nz);\n\t\t\t\t\tpickingCollisionVO.uv = this._pGetCollisionUV(indexData, uvData, index, v, w, u, uvOffset, uvStride);\n\t\t\t\t\tpickingCollisionVO.index = index;\n//\t\t\t\t\t\tpickingCollisionVO.subGeometryIndex = this.pGetMeshSubMeshIndex(renderable);\n\n\t\t\t\t\t// if not looking for best hit, first found will do...\n\t\t\t\t\tif (!this._findClosestCollision)\n\t\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tif (collisionTriangleIndex >= 0)\n\t\t\treturn true;\n\n\t\treturn false;\n\t}\n}\n\nexport = JSPickingCollider;","import Point\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport AbstractMethodError\t\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nimport ISubMesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/ISubMesh\");\nimport PickingCollisionVO\t\t\t\t= require(\"awayjs-display/lib/pick/PickingCollisionVO\");\nimport Billboard\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\n\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport BillboardRenderable\t\t\t\t= require(\"awayjs-renderergl/lib/pool/BillboardRenderable\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport TriangleSubMeshRenderable\t\t= require(\"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable\");\nimport RenderablePoolBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\n\n/**\n * An abstract base class for all picking collider classes. It should not be instantiated directly.\n *\n * @class away.pick.PickingColliderBase\n */\nclass PickingColliderBase\n{\n\tprivate _billboardRenderablePool:RenderablePoolBase;\n\tprivate _subMeshRenderablePool:RenderablePoolBase;\n\n\tpublic rayPosition:Vector3D;\n\tpublic rayDirection:Vector3D;\n\n\tconstructor(stage:Stage)\n\t{\n\t\t//TODO\n\t\tthis._billboardRenderablePool = RenderablePoolBase.getPool(BillboardRenderable, stage);\n\t\tthis._subMeshRenderablePool = RenderablePoolBase.getPool(TriangleSubMeshRenderable, stage);\n\t}\n\n\tpublic _pPetCollisionNormal(indexData:Array<number> /*uint*/, vertexData:Array<number>, triangleIndex:number):Vector3D // PROTECTED\n\t{\n\t\tvar normal:Vector3D = new Vector3D();\n\t\tvar i0:number = indexData[ triangleIndex ]*3;\n\t\tvar i1:number = indexData[ triangleIndex + 1 ]*3;\n\t\tvar i2:number = indexData[ triangleIndex + 2 ]*3;\n\t\tvar p0:Vector3D = new Vector3D(vertexData[ i0 ], vertexData[ i0 + 1 ], vertexData[ i0 + 2 ]);\n\t\tvar p1:Vector3D = new Vector3D(vertexData[ i1 ], vertexData[ i1 + 1 ], vertexData[ i1 + 2 ]);\n\t\tvar p2:Vector3D = new Vector3D(vertexData[ i2 ], vertexData[ i2 + 1 ], vertexData[ i2 + 2 ]);\n\t\tvar side0:Vector3D = p1.subtract(p0);\n\t\tvar side1:Vector3D = p2.subtract(p0);\n\t\tnormal = side0.crossProduct(side1);\n\t\tnormal.normalize();\n\t\treturn normal;\n\t}\n\n\tpublic _pGetCollisionUV(indexData:Array<number> /*uint*/, uvData:Array<number>, triangleIndex:number, v:number, w:number, u:number, uvOffset:number, uvStride:number):Point // PROTECTED\n\t{\n\t\tvar uv:Point = new Point();\n\t\tvar uIndex:number = indexData[ triangleIndex ]*uvStride + uvOffset;\n\t\tvar uv0:Vector3D = new Vector3D(uvData[ uIndex ], uvData[ uIndex + 1 ]);\n\t\tuIndex = indexData[ triangleIndex + 1 ]*uvStride + uvOffset;\n\t\tvar uv1:Vector3D = new Vector3D(uvData[ uIndex ], uvData[ uIndex + 1 ]);\n\t\tuIndex = indexData[ triangleIndex + 2 ]*uvStride + uvOffset;\n\t\tvar uv2:Vector3D = new Vector3D(uvData[ uIndex ], uvData[ uIndex + 1 ]);\n\t\tuv.x = u*uv0.x + v*uv1.x + w*uv2.x;\n\t\tuv.y = u*uv0.y + v*uv1.y + w*uv2.y;\n\t\treturn uv;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _pTestRenderableCollision(renderable:RenderableBase, pickingCollisionVO:PickingCollisionVO, shortestCollisionDistance:number):boolean\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic setLocalRay(localPosition:Vector3D, localDirection:Vector3D)\n\t{\n\t\tthis.rayPosition = localPosition;\n\t\tthis.rayDirection = localDirection;\n\t}\n\n\t/**\n\t * Tests a <code>Billboard</code> object for a collision with the picking ray.\n\t *\n\t * @param billboard The billboard instance to be tested.\n\t * @param pickingCollisionVO The collision object used to store the collision results\n\t * @param shortestCollisionDistance The current value of the shortest distance to a detected collision along the ray.\n\t * @param findClosest\n\t */\n\tpublic testBillboardCollision(billboard:Billboard, pickingCollisionVO:PickingCollisionVO, shortestCollisionDistance:number)\n\t{\n\t\tthis.setLocalRay(pickingCollisionVO.localRayPosition, pickingCollisionVO.localRayDirection);\n\t\tpickingCollisionVO.renderableOwner = null;\n\n\t\tif (this._pTestRenderableCollision(<RenderableBase> this._billboardRenderablePool.getItem(billboard), pickingCollisionVO, shortestCollisionDistance)) {\n\t\t\tshortestCollisionDistance = pickingCollisionVO.rayEntryDistance;\n\n\t\t\tpickingCollisionVO.renderableOwner = billboard;\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Tests a <code>Mesh</code> object for a collision with the picking ray.\n\t *\n\t * @param mesh The mesh instance to be tested.\n\t * @param pickingCollisionVO The collision object used to store the collision results\n\t * @param shortestCollisionDistance The current value of the shortest distance to a detected collision along the ray.\n\t * @param findClosest\n\t */\n\tpublic testMeshCollision(mesh:Mesh, pickingCollisionVO:PickingCollisionVO, shortestCollisionDistance:number, findClosest:boolean):boolean\n\t{\n\t\tthis.setLocalRay(pickingCollisionVO.localRayPosition, pickingCollisionVO.localRayDirection);\n\t\tpickingCollisionVO.renderableOwner = null;\n\n\t\tvar subMesh:ISubMesh;\n\n\t\tvar len:number = mesh.subMeshes.length;\n\t\tfor (var i:number = 0; i < len; ++i) {\n\t\t\tsubMesh = mesh.subMeshes[i];\n\n\t\t\tif (this._pTestRenderableCollision(<RenderableBase> this._subMeshRenderablePool.getItem(subMesh), pickingCollisionVO, shortestCollisionDistance)) {\n\t\t\t\tshortestCollisionDistance = pickingCollisionVO.rayEntryDistance;\n\n\t\t\t\tpickingCollisionVO.renderableOwner = subMesh;\n\n\t\t\t\tif (!findClosest)\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn pickingCollisionVO.renderableOwner != null;\n\t}\n}\n\nexport = PickingColliderBase;","import Debug\t\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/Debug\");\nimport BitmapData\t\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport Box\t\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Box\");\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\nimport Point\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\nimport Rectangle\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport Scene\t\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/Scene\");\nimport View\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/View\");\nimport IPicker\t\t\t\t\t\t\t= require(\"awayjs-display/lib/pick/IPicker\");\nimport PickingCollisionVO\t\t\t\t= require(\"awayjs-display/lib/pick/PickingCollisionVO\");\nimport EntityCollector\t\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport IEntity\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\n\nimport AGALMiniAssembler\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler\");\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLBlendFactor\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\nimport ContextGLClearMask\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLClearMask\");\nimport ContextGLCompareMode\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\nimport ContextGLProgramType\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\nimport ContextGLTriangleFace\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTriangleFace\");\nimport IContextGL\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport IProgram\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IProgram\");\nimport ITextureBase\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITextureBase\");\n\nimport DefaultRenderer\t\t\t\t\t= require(\"awayjs-renderergl/lib/DefaultRenderer\");\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\n\n/**\n * Picks a 3d object from a view or scene by performing a separate render pass on the scene around the area being picked using key color values,\n * then reading back the color value of the pixel in the render representing the picking ray. Requires multiple passes and readbacks for retriving details\n * on an entity that has its shaderPickingDetails property set to true.\n *\n * A read-back operation from any GPU is not a very efficient process, and the amount of processing used can vary significantly between different hardware.\n *\n * @see away.entities.Entity#shaderPickingDetails\n *\n * @class away.pick.ShaderPicker\n */\nclass ShaderPicker implements IPicker\n{\n\tprivate _opaqueRenderableHead:RenderableBase;\n\tprivate _blendedRenderableHead:RenderableBase;\n\n\tprivate _stage:Stage;\n\tprivate _context:IContextGL;\n\tprivate _onlyMouseEnabled:boolean = true;\n\n\tprivate _objectProgram:IProgram;\n\tprivate _triangleProgram:IProgram;\n\tprivate _bitmapData:BitmapData;\n\tprivate _viewportData:Array<number>;\n\tprivate _boundOffsetScale:Array<number>;\n\tprivate _id:Array<number>;\n\n\tprivate _interactives:Array<RenderableBase> = new Array<RenderableBase>();\n\tprivate _interactiveId:number;\n\tprivate _hitColor:number;\n\tprivate _projX:number;\n\tprivate _projY:number;\n\n\tprivate _hitRenderable:RenderableBase;\n\tprivate _hitEntity:IEntity;\n\tprivate _localHitPosition:Vector3D = new Vector3D();\n\tprivate _hitUV:Point = new Point();\n\tprivate _faceIndex:number;\n\tprivate _subGeometryIndex:number;\n\n\tprivate _localHitNormal:Vector3D = new Vector3D();\n\n\tprivate _rayPos:Vector3D = new Vector3D();\n\tprivate _rayDir:Vector3D = new Vector3D();\n\tprivate _potentialFound:boolean;\n\tprivate static MOUSE_SCISSOR_RECT:Rectangle = new Rectangle(0, 0, 1, 1);\n\n\tprivate _shaderPickingDetails:boolean;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic get onlyMouseEnabled():boolean\n\t{\n\t\treturn this._onlyMouseEnabled;\n\t}\n\n\tpublic set onlyMouseEnabled(value:boolean)\n\t{\n\t\tthis._onlyMouseEnabled = value;\n\t}\n\n\t/**\n\t * Creates a new <code>ShaderPicker</code> object.\n\t *\n\t * @param shaderPickingDetails Determines whether the picker includes a second pass to calculate extra\n\t * properties such as uv and normal coordinates.\n\t */\n\tconstructor(shaderPickingDetails:boolean = false)\n\t{\n\t\tthis._shaderPickingDetails = shaderPickingDetails;\n\n\t\tthis._id = new Array<number>(4);\n\t\tthis._viewportData = new Array<number>(4); // first 2 contain scale, last 2 translation\n\t\tthis._boundOffsetScale = new Array<number>(8); // first 2 contain scale, last 2 translation\n\t\tthis._boundOffsetScale[3] = 0;\n\t\tthis._boundOffsetScale[7] = 1;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getViewCollision(x:number, y:number, view:View):PickingCollisionVO\n\t{\n\t\tvar collector:EntityCollector = <EntityCollector> view.iEntityCollector;\n\n\t\tthis._stage = (<DefaultRenderer> view.renderer).stage;\n\n\t\tif (!this._stage)\n\t\t\treturn null;\n\n\t\tthis._context = <IContextGL> this._stage.context;\n\n\t\tthis._viewportData[0] = view.width;\n\t\tthis._viewportData[1] = view.height;\n\t\tthis._viewportData[2] = -(this._projX = 2*x/view.width - 1);\n\t\tthis._viewportData[3] = this._projY = 2*y/view.height - 1;\n\n\t\t// _potentialFound will be set to true if any object is actually rendered\n\t\tthis._potentialFound = false;\n\n\t\t//reset head values\n\t\tthis._blendedRenderableHead = null;\n\t\tthis._opaqueRenderableHead = null;\n\n\t\tthis.pDraw(collector, null);\n\n\t\t// clear buffers\n\t\tthis._context.setVertexBufferAt(0, null);\n\n\t\tif (!this._context || !this._potentialFound)\n\t\t\treturn null;\n\n\t\tif (!this._bitmapData)\n\t\t\tthis._bitmapData = new BitmapData(1, 1, false, 0);\n\n\t\tthis._context.drawToBitmapData(this._bitmapData);\n\t\tthis._hitColor = this._bitmapData.getPixel(0, 0);\n\n\t\tif (!this._hitColor) {\n\t\t\tthis._context.present();\n\t\t\treturn null;\n\t\t}\n\n\t\tthis._hitRenderable = this._interactives[this._hitColor - 1];\n\t\tthis._hitEntity = this._hitRenderable.sourceEntity;\n\n\t\tif (this._onlyMouseEnabled && !this._hitEntity._iIsMouseEnabled())\n\t\t\treturn null;\n\n\t\tvar _collisionVO:PickingCollisionVO = this._hitEntity._iPickingCollisionVO;\n\t\tif (this._shaderPickingDetails) {\n\t\t\tthis.getHitDetails(view.camera);\n\t\t\t_collisionVO.localPosition = this._localHitPosition;\n\t\t\t_collisionVO.localNormal = this._localHitNormal;\n\t\t\t_collisionVO.uv = this._hitUV;\n\t\t\t_collisionVO.index = this._faceIndex;\n\t\t\t//_collisionVO.subGeometryIndex = this._subGeometryIndex;\n\n\t\t} else {\n\t\t\t_collisionVO.localPosition = null;\n\t\t\t_collisionVO.localNormal = null;\n\t\t\t_collisionVO.uv = null;\n\t\t\t_collisionVO.index = 0;\n\t\t\t//_collisionVO.subGeometryIndex = 0;\n\t\t}\n\n\t\treturn _collisionVO;\n\t}\n\n\t//*/\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic getSceneCollision(position:Vector3D, direction:Vector3D, scene:Scene):PickingCollisionVO\n\t{\n\t\treturn null;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic pDraw(entityCollector:EntityCollector, target:ITextureBase)\n\t{\n\n\t\tvar camera:Camera = entityCollector.camera;\n\n\t\tthis._context.clear(0, 0, 0, 1);\n\t\tthis._stage.scissorRect = ShaderPicker.MOUSE_SCISSOR_RECT;\n\n\t\tthis._interactives.length = this._interactiveId = 0;\n\n\t\tif (!this._objectProgram)\n\t\t\tthis.initObjectProgram();\n\n\t\tthis._context.setBlendFactors(ContextGLBlendFactor.ONE, ContextGLBlendFactor.ZERO);\n\t\tthis._context.setDepthTest(true, ContextGLCompareMode.LESS);\n\t\tthis._context.setProgram(this._objectProgram);\n\t\tthis._context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 4, this._viewportData, 1);\n\t\t//this.drawRenderables(entityCollector.opaqueRenderableHead, camera);\n\t\t//this.drawRenderables(entityCollector.blendedRenderableHead, camera);\n\t\t//TODO: reimplement ShaderPicker inheriting from RendererBase\n\t}\n\n\t/**\n\t * Draw a list of renderables.\n\t * @param renderables The renderables to draw.\n\t * @param camera The camera for which to render.\n\t */\n\tprivate drawRenderables(renderable:RenderableBase, camera:Camera)\n\t{\n\t\tvar matrix:Matrix3D = Matrix3DUtils.CALCULATION_MATRIX;\n\t\tvar viewProjection:Matrix3D = camera.viewProjection;\n\n\t\twhile (renderable) {\n\t\t\t// it's possible that the renderable was already removed from the scene\n\t\t\tif (!renderable.sourceEntity.scene || !renderable.sourceEntity._iIsMouseEnabled()) {\n\t\t\t\trenderable = renderable.next;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis._potentialFound = true;\n\n\t\t\tthis._context.setCulling((<MaterialBase> renderable.renderObjectOwner).bothSides? ContextGLTriangleFace.NONE : ContextGLTriangleFace.BACK, camera.projection.coordinateSystem);\n\n\t\t\tthis._interactives[this._interactiveId++] = renderable;\n\t\t\t// color code so that reading from bitmapdata will contain the correct value\n\t\t\tthis._id[1] = (this._interactiveId >> 8)/255; // on green channel\n\t\t\tthis._id[2] = (this._interactiveId & 0xff)/255; // on blue channel\n\n\t\t\tmatrix.copyFrom(renderable.sourceEntity.getRenderSceneTransform(camera));\n\t\t\tmatrix.append(viewProjection);\n\t\t\tthis._context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, matrix, true);\n\t\t\tthis._context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, this._id, 1);\n\t\t\tthis._stage.activateBuffer(0, renderable.getVertexData(TriangleSubGeometry.POSITION_DATA), renderable.getVertexOffset(TriangleSubGeometry.POSITION_DATA), TriangleSubGeometry.POSITION_FORMAT);\n\t\t\tthis._context.drawTriangles(this._stage.getIndexBuffer(renderable.getIndexData()), 0, renderable.numTriangles);\n\n\t\t\trenderable = renderable.next;\n\t\t}\n\n\t}\n\n\tprivate updateRay(camera:Camera)\n\t{\n\t\tthis._rayPos = camera.scenePosition;\n\n\t\tthis._rayDir = camera.getRay(this._projX, this._projY, 1);\n\t\tthis._rayDir.normalize();\n\t}\n\n\t/**\n\t * Creates the Program that color-codes objects.\n\t */\n\tprivate initObjectProgram()\n\t{\n\t\tvar vertexCode:string;\n\t\tvar fragmentCode:string;\n\n\t\tthis._objectProgram = this._context.createProgram();\n\n\t\tvertexCode = \"m44 vt0, va0, vc0\t\t\t\\n\" + \"mul vt1.xy, vt0.w, vc4.zw\t\\n\" + \"add vt0.xy, vt0.xy, vt1.xy\t\\n\" + \"mul vt0.xy, vt0.xy, vc4.xy\t\\n\" + \"mov op, vt0\t\\n\";\n\t\tfragmentCode = \"mov oc, fc0\"; // write identifier\n\n\t\tDebug.throwPIR('ShaderPicker', 'initTriangleProgram', 'Dependency: initObjectProgram')\n\t\t//_objectProgram.upload(new AGALMiniAssembler().assemble(ContextGLProgramType.VERTEX, vertexCode),new AGALMiniAssembler().assemble(ContextGLProgramType.FRAGMENT, fragmentCode));\n\t}\n\n\t/**\n\t * Creates the Program that renders positions.\n\t */\n\n\tprivate initTriangleProgram()\n\t{\n\t\tvar vertexCode:string;\n\t\tvar fragmentCode:string;\n\n\t\tthis._triangleProgram = this._context.createProgram();\n\n\t\t// todo: add animation code\n\t\tvertexCode = \"add vt0, va0, vc5 \t\t\t\\n\" + \"mul vt0, vt0, vc6 \t\t\t\\n\" + \"mov v0, vt0\t\t\t\t\\n\" + \"m44 vt0, va0, vc0\t\t\t\\n\" + \"mul vt1.xy, vt0.w, vc4.zw\t\\n\" + \"add vt0.xy, vt0.xy, vt1.xy\t\\n\" + \"mul vt0.xy, vt0.xy, vc4.xy\t\\n\" + \"mov op, vt0\t\\n\";\n\t\tfragmentCode = \"mov oc, v0\"; // write identifier\n\n\t\tvar vertexByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part vertex 1\\n\" + vertexCode + \"endpart\"))['vertex'].data;\n\t\tvar fragmentByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part fragment 1\\n\" + fragmentCode + \"endpart\"))['fragment'].data;\n\t\tthis._triangleProgram.upload(vertexByteCode, fragmentByteCode);\n\t}\n\n\t/**\n\t * Gets more detailed information about the hir position, if required.\n\t * @param camera The camera used to view the hit object.\n\t */\n\tprivate getHitDetails(camera:Camera)\n\t{\n\t\tthis.getApproximatePosition(camera);\n\t\tthis.getPreciseDetails(camera);\n\t}\n\n\t/**\n\t * Finds a first-guess approximate position about the hit position.\n\t *\n\t * @param camera The camera used to view the hit object.\n\t */\n\tprivate getApproximatePosition(camera:Camera)\n\t{\n\t\tvar bounds:Box = this._hitRenderable.sourceEntity.getBox();\n\t\tvar col:number;\n\t\tvar scX:number, scY:number, scZ:number;\n\t\tvar offsX:number, offsY:number, offsZ:number;\n\t\tvar localViewProjection:Matrix3D = Matrix3DUtils.CALCULATION_MATRIX;\n\n\t\tlocalViewProjection.copyFrom(this._hitRenderable.sourceEntity.getRenderSceneTransform(camera));\n\t\tlocalViewProjection.append(camera.viewProjection);\n\t\tif (!this._triangleProgram) {\n\t\t\tthis.initTriangleProgram();\n\t\t}\n\n\t\tthis._boundOffsetScale[4] = 1/(scX = bounds.width);\n\t\tthis._boundOffsetScale[5] = 1/(scY = bounds.height);\n\t\tthis._boundOffsetScale[6] = 1/(scZ = bounds.depth);\n\t\tthis._boundOffsetScale[0] = offsX = -bounds.x;\n\t\tthis._boundOffsetScale[1] = offsY = -bounds.y;\n\t\tthis._boundOffsetScale[2] = offsZ = -bounds.z;\n\n\t\tthis._context.setProgram(this._triangleProgram);\n\t\tthis._context.clear(0, 0, 0, 0, 1, 0, ContextGLClearMask.DEPTH);\n\t\tthis._context.setScissorRectangle(ShaderPicker.MOUSE_SCISSOR_RECT);\n\t\tthis._context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, localViewProjection, true);\n\t\tthis._context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, this._boundOffsetScale, 2);\n\n\t\tthis._stage.activateBuffer(0, this._hitRenderable.getVertexData(TriangleSubGeometry.POSITION_DATA), this._hitRenderable.getVertexOffset(TriangleSubGeometry.POSITION_DATA), TriangleSubGeometry.POSITION_FORMAT);\n\t\tthis._context.drawTriangles(this._stage.getIndexBuffer(this._hitRenderable.getIndexData()), 0, this._hitRenderable.numTriangles);\n\n\t\tthis._context.drawToBitmapData(this._bitmapData);\n\n\t\tcol = this._bitmapData.getPixel(0, 0);\n\n\t\tthis._localHitPosition.x = ((col >> 16) & 0xff)*scX/255 - offsX;\n\t\tthis._localHitPosition.y = ((col >> 8) & 0xff)*scY/255 - offsY;\n\t\tthis._localHitPosition.z = (col & 0xff)*scZ/255 - offsZ;\n\t}\n\n\t/**\n\t * Use the approximate position info to find the face under the mouse position from which we can derive the precise\n\t * ray-face intersection point, then use barycentric coordinates to figure out the uv coordinates, etc.\n\t * @param camera The camera used to view the hit object.\n\t */\n\tprivate getPreciseDetails(camera:Camera)\n\t{\n\t\tvar len:number = indices.length;\n\t\tvar x1:number, y1:number, z1:number;\n\t\tvar x2:number, y2:number, z2:number;\n\t\tvar x3:number, y3:number, z3:number;\n\t\tvar i:number = 0, j:number = 1, k:number = 2;\n\t\tvar t1:number, t2:number, t3:number;\n\t\tvar v0x:number, v0y:number, v0z:number;\n\t\tvar v1x:number, v1y:number, v1z:number;\n\t\tvar v2x:number, v2y:number, v2z:number;\n\t\tvar ni1:number, ni2:number, ni3:number;\n\t\tvar n1:number, n2:number, n3:number, nLength:number;\n\t\tvar dot00:number, dot01:number, dot02:number, dot11:number, dot12:number;\n\t\tvar s:number, t:number, invDenom:number;\n\t\tvar x:number = this._localHitPosition.x, y:number = this._localHitPosition.y, z:number = this._localHitPosition.z;\n\t\tvar u:number, v:number;\n\t\tvar ui1:number, ui2:number, ui3:number;\n\t\tvar s0x:number, s0y:number, s0z:number;\n\t\tvar s1x:number, s1y:number, s1z:number;\n\t\tvar nl:number;\n\t\tvar indices:Array<number> = this._hitRenderable.getIndexData().data;\n\n\t\tvar positions:Array<number> = this._hitRenderable.getVertexData(TriangleSubGeometry.POSITION_DATA).data;\n\t\tvar positionStride:number = this._hitRenderable.getVertexData(TriangleSubGeometry.POSITION_DATA).dataPerVertex;\n\t\tvar positionOffset:number = this._hitRenderable.getVertexOffset(TriangleSubGeometry.POSITION_DATA);\n\n\t\tvar uvs:Array<number> = this._hitRenderable.getVertexData(TriangleSubGeometry.UV_DATA).data;\n\t\tvar uvStride:number = this._hitRenderable.getVertexData(TriangleSubGeometry.UV_DATA).dataPerVertex;\n\t\tvar uvOffset:number = this._hitRenderable.getVertexOffset(TriangleSubGeometry.UV_DATA);\n\n\t\tvar normals:Array<number> = this._hitRenderable.getVertexData(TriangleSubGeometry.NORMAL_DATA).data;\n\t\tvar normalStride:number = this._hitRenderable.getVertexData(TriangleSubGeometry.NORMAL_DATA).dataPerVertex;\n\t\tvar normalOffset:number = this._hitRenderable.getVertexOffset(TriangleSubGeometry.NORMAL_DATA);\n\n\t\tthis.updateRay(camera);\n\n\t\twhile (i < len) {\n\t\t\tt1 = positionOffset + indices[i]*positionStride;\n\t\t\tt2 = positionOffset + indices[j]*positionStride;\n\t\t\tt3 = positionOffset + indices[k]*positionStride;\n\t\t\tx1 = positions[t1];\n\t\t\ty1 = positions[t1 + 1];\n\t\t\tz1 = positions[t1 + 2];\n\t\t\tx2 = positions[t2];\n\t\t\ty2 = positions[t2 + 1];\n\t\t\tz2 = positions[t2 + 2];\n\t\t\tx3 = positions[t3];\n\t\t\ty3 = positions[t3 + 1];\n\t\t\tz3 = positions[t3 + 2];\n\n\t\t\t// if within bounds\n\t\t\tif (!(    (x < x1 && x < x2 && x < x3) || (y < y1 && y < y2 && y < y3) || (z < z1 && z < z2 && z < z3) || (x > x1 && x > x2 && x > x3) || (y > y1 && y > y2 && y > y3) || (z > z1 && z > z2 && z > z3))) {\n\n\t\t\t\t// calculate barycentric coords for approximated position\n\t\t\t\tv0x = x3 - x1;\n\t\t\t\tv0y = y3 - y1;\n\t\t\t\tv0z = z3 - z1;\n\t\t\t\tv1x = x2 - x1;\n\t\t\t\tv1y = y2 - y1;\n\t\t\t\tv1z = z2 - z1;\n\t\t\t\tv2x = x - x1;\n\t\t\t\tv2y = y - y1;\n\t\t\t\tv2z = z - z1;\n\t\t\t\tdot00 = v0x*v0x + v0y*v0y + v0z*v0z;\n\t\t\t\tdot01 = v0x*v1x + v0y*v1y + v0z*v1z;\n\t\t\t\tdot02 = v0x*v2x + v0y*v2y + v0z*v2z;\n\t\t\t\tdot11 = v1x*v1x + v1y*v1y + v1z*v1z;\n\t\t\t\tdot12 = v1x*v2x + v1y*v2y + v1z*v2z;\n\t\t\t\tinvDenom = 1/(dot00*dot11 - dot01*dot01);\n\t\t\t\ts = (dot11*dot02 - dot01*dot12)*invDenom;\n\t\t\t\tt = (dot00*dot12 - dot01*dot02)*invDenom;\n\n\t\t\t\t// if inside the current triangle, fetch details hit information\n\t\t\t\tif (s >= 0 && t >= 0 && (s + t) <= 1) {\n\n\t\t\t\t\tni1 = normalOffset + indices[i]*normalStride;\n\t\t\t\t\tni2 = normalOffset + indices[j]*normalStride;\n\t\t\t\t\tni3 = normalOffset + indices[k]*normalStride;\n\n\t\t\t\t\tn1 = indices[ni1] + indices[ni2] + indices[ni3];\n\t\t\t\t\tn2 = indices[ni1 + 1] + indices[ni2 + 1] + indices[ni3 + 1];\n\t\t\t\t\tn3 = indices[ni1 + 2] + indices[ni2 + 2] + indices[ni3 + 2];\n\n\t\t\t\t\tnLength = Math.sqrt(n1*n1 + n2*n2 + n3*n3);\n\n\t\t\t\t\tn1 /= nLength;\n\t\t\t\t\tn2 /= nLength;\n\t\t\t\t\tn3 /= nLength;\n\n\t\t\t\t\t// this is def the triangle, now calculate precise coords\n\t\t\t\t\tthis.getPrecisePosition(this._hitRenderable.sourceEntity.inverseSceneTransform, n1, n2, n3, x1, y1, z1);\n\n\t\t\t\t\tv2x = this._localHitPosition.x - x1;\n\t\t\t\t\tv2y = this._localHitPosition.y - y1;\n\t\t\t\t\tv2z = this._localHitPosition.z - z1;\n\n\t\t\t\t\ts0x = x2 - x1; // s0 = p1 - p0\n\t\t\t\t\ts0y = y2 - y1;\n\t\t\t\t\ts0z = z2 - z1;\n\t\t\t\t\ts1x = x3 - x1; // s1 = p2 - p0\n\t\t\t\t\ts1y = y3 - y1;\n\t\t\t\t\ts1z = z3 - z1;\n\t\t\t\t\tthis._localHitNormal.x = s0y*s1z - s0z*s1y; // n = s0 x s1\n\t\t\t\t\tthis._localHitNormal.y = s0z*s1x - s0x*s1z;\n\t\t\t\t\tthis._localHitNormal.z = s0x*s1y - s0y*s1x;\n\t\t\t\t\tnl = 1/Math.sqrt(this._localHitNormal.x*this._localHitNormal.x + this._localHitNormal.y*this._localHitNormal.y + this._localHitNormal.z*this._localHitNormal.z); // normalize n\n\t\t\t\t\tthis._localHitNormal.x *= nl;\n\t\t\t\t\tthis._localHitNormal.y *= nl;\n\t\t\t\t\tthis._localHitNormal.z *= nl;\n\n\t\t\t\t\tdot02 = v0x*v2x + v0y*v2y + v0z*v2z;\n\t\t\t\t\tdot12 = v1x*v2x + v1y*v2y + v1z*v2z;\n\t\t\t\t\ts = (dot11*dot02 - dot01*dot12)*invDenom;\n\t\t\t\t\tt = (dot00*dot12 - dot01*dot02)*invDenom;\n\n\t\t\t\t\tui1 = uvOffset + indices[i]*uvStride\n\t\t\t\t\tui2 = uvOffset + indices[j]*uvStride\n\t\t\t\t\tui3 = uvOffset + indices[k]*uvStride\n\n\t\t\t\t\tu = uvs[ui1];\n\t\t\t\t\tv = uvs[ui1 + 1];\n\t\t\t\t\tthis._hitUV.x = u + t*(uvs[ui2] - u) + s*(uvs[ui3] - u);\n\t\t\t\t\tthis._hitUV.y = v + t*(uvs[ui2 + 1] - v) + s*(uvs[ui3 + 1] - v);\n\n\t\t\t\t\tthis._faceIndex = i;\n\t\t\t\t\t//TODO add back subGeometryIndex value\n\t\t\t\t\t//this._subGeometryIndex = away.utils.GeometryUtils.getMeshSubGeometryIndex(subGeom);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ti += 3;\n\t\t\tj += 3;\n\t\t\tk += 3;\n\t\t}\n\t}\n\n\t/**\n\t * Finds the precise hit position by unprojecting the screen coordinate back unto the hit face's plane and\n\t * calculating the intersection point.\n\t * @param camera The camera used to render the object.\n\t * @param invSceneTransform The inverse scene transformation of the hit object.\n\t * @param nx The x-coordinate of the face's plane normal.\n\t * @param ny The y-coordinate of the face plane normal.\n\t * @param nz The z-coordinate of the face plane normal.\n\t * @param px The x-coordinate of a point on the face's plane (ie a face vertex)\n\t * @param py The y-coordinate of a point on the face's plane (ie a face vertex)\n\t * @param pz The z-coordinate of a point on the face's plane (ie a face vertex)\n\t */\n\n\tprivate getPrecisePosition(invSceneTransform:Matrix3D, nx:number, ny:number, nz:number, px:number, py:number, pz:number)\n\t{\n\t\t// calculate screen ray and find exact intersection position with triangle\n\t\tvar rx:number, ry:number, rz:number;\n\t\tvar ox:number, oy:number, oz:number;\n\t\tvar t:number;\n\t\tvar raw:Array<number> = Matrix3DUtils.RAW_DATA_CONTAINER;\n\t\tvar cx:number = this._rayPos.x, cy:number = this._rayPos.y, cz:number = this._rayPos.z;\n\n\t\t// unprojected projection point, gives ray dir in cam space\n\t\tox = this._rayDir.x;\n\t\toy = this._rayDir.y;\n\t\toz = this._rayDir.z;\n\n\t\t// transform ray dir and origin (cam pos) to object space\n\t\t//invSceneTransform.copyRawDataTo( raw  );\n\t\tinvSceneTransform.copyRawDataTo(raw);\n\t\trx = raw[0]*ox + raw[4]*oy + raw[8]*oz;\n\t\try = raw[1]*ox + raw[5]*oy + raw[9]*oz;\n\t\trz = raw[2]*ox + raw[6]*oy + raw[10]*oz;\n\n\t\tox = raw[0]*cx + raw[4]*cy + raw[8]*cz + raw[12];\n\t\toy = raw[1]*cx + raw[5]*cy + raw[9]*cz + raw[13];\n\t\toz = raw[2]*cx + raw[6]*cy + raw[10]*cz + raw[14];\n\n\t\tt = ((px - ox)*nx + (py - oy)*ny + (pz - oz)*nz)/(rx*nx + ry*ny + rz*nz);\n\n\t\tthis._localHitPosition.x = ox + rx*t;\n\t\tthis._localHitPosition.y = oy + ry*t;\n\t\tthis._localHitPosition.z = oz + rz*t;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._bitmapData.dispose();\n\t\tif (this._triangleProgram)\n\t\t\tthis._triangleProgram.dispose();\n\n\t\tif (this._objectProgram)\n\t\t\tthis._objectProgram.dispose();\n\n\t\tthis._triangleProgram = null;\n\t\tthis._objectProgram = null;\n\t\tthis._bitmapData = null;\n\t\tthis._hitRenderable = null;\n\t\tthis._hitEntity = null;\n\t}\n}\n\nexport = ShaderPicker;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\n\nimport SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport Billboard\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\n\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\n\n/**\n * @class away.pool.RenderableListItem\n */\nclass BillboardRenderable extends RenderableBase\n{\n\tprivate static _materialGeometry:Object = new Object();\n\n\t/**\n\t *\n\t */\n\tpublic static id:string = \"billboard\";\n\n\tpublic static vertexAttributesOffset:number = 1;\n\n\t/**\n\t *\n\t */\n\tprivate _billboard:Billboard;\n\n\t/**\n\t * //TODO\n\t *\n\t * @param pool\n\t * @param billboard\n\t */\n\tconstructor(pool:RenderablePoolBase, billboard:Billboard, stage:Stage)\n\t{\n\t\tsuper(pool, billboard, billboard, billboard.material, stage);\n\n\t\tthis._billboard = billboard;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @returns {away.base.TriangleSubGeometry}\n\t */\n\tpublic _pGetSubGeometry():SubGeometryBase\n\t{\n\t\tvar material:MaterialBase = this._billboard.material;\n\n\t\tvar geometry:TriangleSubGeometry = BillboardRenderable._materialGeometry[material.id];\n\n\t\tif (!geometry) {\n\t\t\tgeometry = BillboardRenderable._materialGeometry[material.id] = new TriangleSubGeometry(true);\n\t\t\tgeometry.autoDeriveNormals = false;\n\t\t\tgeometry.autoDeriveTangents = false;\n\t\t\tgeometry.updateIndices(Array<number>(0, 1, 2, 0, 2, 3));\n\t\t\tgeometry.updatePositions(Array<number>(0, material.height, 0, material.width, material.height, 0, material.width, 0, 0, 0, 0, 0));\n\t\t\tgeometry.updateVertexNormals(Array<number>(1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0));\n\t\t\tgeometry.updateVertexTangents(Array<number>(0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1));\n\t\t\tgeometry.updateUVs(Array<number>(0, 0, 1, 0, 1, 1, 0, 1));\n\t\t} else {\n\t\t\tgeometry.updatePositions(Array<number>(0, material.height, 0, material.width, material.height, 0, material.width, 0, 0, 0, 0, 0));\n\t\t}\n\n\t\tthis._pVertexDataDirty[TriangleSubGeometry.POSITION_DATA] = true;\n\t\tthis._pVertexDataDirty[TriangleSubGeometry.NORMAL_DATA] = true;\n\t\tthis._pVertexDataDirty[TriangleSubGeometry.TANGENT_DATA] = true;\n\t\tthis._pVertexDataDirty[TriangleSubGeometry.UV_DATA] = true;\n\n\t\treturn geometry;\n\t}\n\n\tpublic static _iIncludeDependencies(shaderObject:ShaderObjectBase)\n\t{\n\n\t}\n\n\tpublic static _iGetVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\n\t\t//get the projection coordinates\n\t\tvar position:ShaderRegisterElement = (shaderObject.globalPosDependencies > 0)? sharedRegisters.globalPositionVertex : sharedRegisters.localPosition;\n\n\t\t//reserving vertex constants for projection matrix\n\t\tvar viewMatrixReg:ShaderRegisterElement = registerCache.getFreeVertexConstant();\n\t\tregisterCache.getFreeVertexConstant();\n\t\tregisterCache.getFreeVertexConstant();\n\t\tregisterCache.getFreeVertexConstant();\n\t\tshaderObject.viewMatrixIndex = viewMatrixReg.index*4;\n\n\t\tif (shaderObject.projectionDependencies > 0) {\n\t\t\tsharedRegisters.projectionFragment = registerCache.getFreeVarying();\n\t\t\tvar temp:ShaderRegisterElement = registerCache.getFreeVertexVectorTemp();\n\t\t\tcode += \"m44 \" + temp + \", \" + position + \", \" + viewMatrixReg + \"\\n\" +\n\t\t\t\"mov \" + sharedRegisters.projectionFragment + \", \" + temp + \"\\n\" +\n\t\t\t\"mov op, \" + temp + \"\\n\";\n\t\t} else {\n\t\t\tcode += \"m44 op, \" + position + \", \" + viewMatrixReg + \"\\n\";\n\t\t}\n\n\t\treturn code;\n\t}\n\n\tpublic _iActivate(pass:RenderPassBase, camera:Camera)\n\t{\n\t\tsuper._iActivate(pass, camera);\n\n\t\t//buffer the same for all materials, so can set here\n\t\tthis._stage.activateBuffer(0, this.getVertexData(TriangleSubGeometry.POSITION_DATA), this.getVertexOffset(TriangleSubGeometry.POSITION_DATA), TriangleSubGeometry.POSITION_FORMAT);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iRender(pass:RenderPassBase, camera:Camera, viewProjection:Matrix3D)\n\t{\n\t\tsuper._iRender(pass, camera, viewProjection);\n\n\t\tvar shader:ShaderObjectBase = pass.shader;\n\n\t\tif (shader.sceneMatrixIndex >= 0) {\n\t\t\tthis.sourceEntity.getRenderSceneTransform(camera).copyRawDataTo(shader.vertexConstantData, shader.sceneMatrixIndex, true);\n\t\t\tviewProjection.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\n\t\t} else {\n\t\t\tvar matrix3D:Matrix3D = Matrix3DUtils.CALCULATION_MATRIX;\n\n\t\t\tmatrix3D.copyFrom(this.sourceEntity.getRenderSceneTransform(camera));\n\t\t\tmatrix3D.append(viewProjection);\n\n\t\t\tmatrix3D.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\n\t\t}\n\n\t\tvar context:IContextGL = this._stage.context;\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 0, shader.vertexConstantData, shader.numUsedVertexConstants);\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, shader.fragmentConstantData, shader.numUsedFragmentConstants);\n\n\t\tthis._stage.context.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);\n\t}\n}\n\nexport = BillboardRenderable;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\nimport LineSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\nimport SubGeometryEvent\t\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport LineSegment\t\t\t\t\t= require(\"awayjs-display/lib/entities/LineSegment\");\nimport DefaultMaterialManager\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\n\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\n\n/**\n * @class away.pool.LineSubMeshRenderable\n */\nclass LineSegmentRenderable extends RenderableBase\n{\n\tprivate static _lineGeometry:Object = new Object();\n\n\tpublic static pONE_VECTOR:Array<number> = Array<number>(1, 1, 1, 1);\n\tpublic static pFRONT_VECTOR:Array<number> = Array<number>(0, 0, -1, 0);\n\n\tprivate _constants:Array<number> = new Array<number>(0, 0, 0, 0);\n\tprivate _calcMatrix:Matrix3D;\n\tprivate _thickness:number = 1.25;\n\n\t/**\n\t *\n\t */\n\tpublic static id:string = \"linesegment\";\n\n\tpublic static vertexAttributesOffset:number = 3;\n\n\t/**\n\t *\n\t */\n\tprivate _lineSegment:LineSegment;\n\n\t/**\n\t * //TODO\n\t *\n\t * @param pool\n\t * @param subMesh\n\t * @param level\n\t * @param dataOffset\n\t */\n\tconstructor(pool:RenderablePoolBase, lineSegment:LineSegment, stage:Stage, level:number = 0, indexOffset:number = 0)\n\t{\n\t\tsuper(pool, lineSegment, lineSegment, lineSegment.material, stage, level, indexOffset);\n\n\t\tthis._lineSegment = lineSegment;\n\n\t\tthis._calcMatrix = new Matrix3D();\n\n\t\tthis._constants[1] = 1/255;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @returns {base.LineSubGeometry}\n\t * @protected\n\t */\n\tpublic _pGetSubGeometry():LineSubGeometry\n\t{\n\t\tvar geometry:LineSubGeometry = LineSegmentRenderable._lineGeometry[this._lineSegment.id] || (LineSegmentRenderable._lineGeometry[this._lineSegment.id] = new LineSubGeometry());\n\n\t\tthis._pVertexDataDirty[LineSubGeometry.START_POSITION_DATA] = true;\n\t\tthis._pVertexDataDirty[LineSubGeometry.END_POSITION_DATA] = true;\n\t\tthis._pVertexDataDirty[LineSubGeometry.THICKNESS_DATA] = true;\n\t\tthis._pVertexDataDirty[LineSubGeometry.COLOR_DATA] = true;\n\n\t\tvar start:Vector3D = this._lineSegment.startPostion;\n\t\tvar end:Vector3D = this._lineSegment.endPosition;\n\n\t\tvar startPositions:Array<number>;\n\t\tvar endPositions:Array<number>;\n\t\tvar thickness:Array<number>;\n\n\t\tif (geometry.indices != null) {\n\t\t\tstartPositions = geometry.startPositions;\n\t\t\tendPositions = geometry.endPositions;\n\t\t\tthickness = geometry.thickness;\n\t\t} else {\n\t\t\tstartPositions = new Array<number>(3);\n\t\t\tendPositions = new Array<number>(3);\n\t\t\tthickness = new Array<number>(1);\n\t\t}\n\n\t\tstartPositions[0] = start.x;\n\t\tstartPositions[1] = start.y;\n\t\tstartPositions[2] = start.z;\n\t\tendPositions[0] = end.x;\n\t\tendPositions[1] = end.y;\n\t\tendPositions[2] = end.z;\n\t\tthickness[0] = this._lineSegment.thickness;\n\n\t\tgeometry.updatePositions(startPositions, endPositions);\n\t\tgeometry.updateThickness(thickness);\n\n\t\treturn geometry;\n\t}\n\n\tpublic static _iIncludeDependencies(shaderObject:ShaderObjectBase)\n\t{\n\t\tshaderObject.colorDependencies++;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static _iGetVertexCode(shader:ShaderObjectBase, regCache:ShaderRegisterCache, sharedReg:ShaderRegisterData):string\n\t{\n\t\treturn \"m44 vt0, va0, vc8\t\t\t\\n\" + // transform Q0 to eye space\n\t\t\t\"m44 vt1, va1, vc8\t\t\t\\n\" + // transform Q1 to eye space\n\t\t\t\"sub vt2, vt1, vt0 \t\t\t\\n\" + // L = Q1 - Q0\n\n\t\t\t\t// test if behind camera near plane\n\t\t\t\t// if 0 - Q0.z < Camera.near then the point needs to be clipped\n\t\t\t\t//\"neg vt5.x, vt0.z\t\t\t\t\\n\" + // 0 - Q0.z\n\t\t\t\"slt vt5.x, vt0.z, vc7.z\t\t\t\\n\" + // behind = ( 0 - Q0.z < -Camera.near ) ? 1 : 0\n\t\t\t\"sub vt5.y, vc5.x, vt5.x\t\t\t\\n\" + // !behind = 1 - behind\n\n\t\t\t\t// p = point on the plane (0,0,-near)\n\t\t\t\t// n = plane normal (0,0,-1)\n\t\t\t\t// D = Q1 - Q0\n\t\t\t\t// t = ( dot( n, ( p - Q0 ) ) / ( dot( n, d )\n\n\t\t\t\t// solve for t where line crosses Camera.near\n\t\t\t\"add vt4.x, vt0.z, vc7.z\t\t\t\\n\" + // Q0.z + ( -Camera.near )\n\t\t\t\"sub vt4.y, vt0.z, vt1.z\t\t\t\\n\" + // Q0.z - Q1.z\n\n\t\t\t\t// fix divide by zero for horizontal lines\n\t\t\t\"seq vt4.z, vt4.y vc6.x\t\t\t\\n\" + // offset = (Q0.z - Q1.z)==0 ? 1 : 0\n\t\t\t\"add vt4.y, vt4.y, vt4.z\t\t\t\\n\" + // ( Q0.z - Q1.z ) + offset\n\n\t\t\t\"div vt4.z, vt4.x, vt4.y\t\t\t\\n\" + // t = ( Q0.z - near ) / ( Q0.z - Q1.z )\n\n\t\t\t\"mul vt4.xyz, vt4.zzz, vt2.xyz\t\\n\" + // t(L)\n\t\t\t\"add vt3.xyz, vt0.xyz, vt4.xyz\t\\n\" + // Qclipped = Q0 + t(L)\n\t\t\t\"mov vt3.w, vc5.x\t\t\t\\n\" + // Qclipped.w = 1\n\n\t\t\t\t// If necessary, replace Q0 with new Qclipped\n\t\t\t\"mul vt0, vt0, vt5.yyyy\t\t\t\\n\" + // !behind * Q0\n\t\t\t\"mul vt3, vt3, vt5.xxxx\t\t\t\\n\" + // behind * Qclipped\n\t\t\t\"add vt0, vt0, vt3\t\t\t\t\\n\" + // newQ0 = Q0 + Qclipped\n\n\t\t\t\t// calculate side vector for line\n\t\t\t\"sub vt2, vt1, vt0 \t\t\t\\n\" + // L = Q1 - Q0\n\t\t\t\"nrm vt2.xyz, vt2.xyz\t\t\t\\n\" + // normalize( L )\n\t\t\t\"nrm vt5.xyz, vt0.xyz\t\t\t\\n\" + // D = normalize( Q1 )\n\t\t\t\"mov vt5.w, vc5.x\t\t\t\t\\n\" + // D.w = 1\n\t\t\t\"crs vt3.xyz, vt2, vt5\t\t\t\\n\" + // S = L x D\n\t\t\t\"nrm vt3.xyz, vt3.xyz\t\t\t\\n\" + // normalize( S )\n\n\t\t\t\t// face the side vector properly for the given point\n\t\t\t\"mul vt3.xyz, vt3.xyz, va2.xxx\t\\n\" + // S *= weight\n\t\t\t\"mov vt3.w, vc5.x\t\t\t\\n\" + // S.w = 1\n\n\t\t\t\t// calculate the amount required to move at the point's distance to correspond to the line's pixel width\n\t\t\t\t// scale the side vector by that amount\n\t\t\t\"dp3 vt4.x, vt0, vc6\t\t\t\\n\" + // distance = dot( view )\n\t\t\t\"mul vt4.x, vt4.x, vc7.x\t\t\t\\n\" + // distance *= vpsod\n\t\t\t\"mul vt3.xyz, vt3.xyz, vt4.xxx\t\\n\" + // S.xyz *= pixelScaleFactor\n\n\t\t\t\t// add scaled side vector to Q0 and transform to clip space\n\t\t\t\"add vt0.xyz, vt0.xyz, vt3.xyz\t\\n\" + // Q0 + S\n\n\t\t\t\"m44 op, vt0, vc0\t\t\t\\n\"  // transform Q0 to clip space\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iActivate(pass:RenderPassBase, camera:Camera)\n\t{\n\t\tsuper._iActivate(pass, camera);\n\n\t\tthis._constants[0] = this._thickness/((this._stage.scissorRect)? Math.min(this._stage.scissorRect.width, this._stage.scissorRect.height) : Math.min(this._stage.width, this._stage.height));\n\n\t\t// value to convert distance from camera to model length per pixel width\n\t\tthis._constants[2] = camera.projection.near;\n\n\t\tvar context:IContextGL = this._stage.context;\n\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, LineSegmentRenderable.pONE_VECTOR, 1);\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 6, LineSegmentRenderable.pFRONT_VECTOR, 1);\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 7, this._constants, 1);\n\n\t\t// projection matrix\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, camera.projection.matrix, true);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iRender(pass:RenderPassBase, camera:Camera, viewProjection:Matrix3D)\n\t{\n\t\tsuper._iRender(pass, camera, viewProjection);\n\n\t\tvar context:IContextGL = this._stage.context;\n\t\tthis._calcMatrix.copyFrom(this.sourceEntity.sceneTransform);\n\t\tthis._calcMatrix.append(camera.inverseSceneTransform);\n\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 8, this._calcMatrix, true);\n\n\t\tthis._stage.activateBuffer(0, this.getVertexData(LineSubGeometry.START_POSITION_DATA), this.getVertexOffset(LineSubGeometry.START_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);\n\t\tthis._stage.activateBuffer(1, this.getVertexData(LineSubGeometry.END_POSITION_DATA), this.getVertexOffset(LineSubGeometry.END_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);\n\t\tthis._stage.activateBuffer(2, this.getVertexData(LineSubGeometry.THICKNESS_DATA), this.getVertexOffset(LineSubGeometry.THICKNESS_DATA), LineSubGeometry.THICKNESS_FORMAT);\n\n\t\tcontext.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param pool\n\t * @param renderableOwner\n\t * @param level\n\t * @param indexOffset\n\t * @returns {away.pool.LineSubMeshRenderable}\n\t * @private\n\t */\n\tpublic _pGetOverflowRenderable(indexOffset:number):RenderableBase\n\t{\n\t\treturn new LineSegmentRenderable(this._pool, <LineSegment> this.renderableOwner, this._stage, this._level + 1, indexOffset);\n\t}\n}\n\nexport = LineSegmentRenderable;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\n\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\nimport LineSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/LineSubMesh\");\nimport LineSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\nimport SubGeometryEvent\t\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport DefaultMaterialManager\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\n\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\n\n/**\n * @class away.pool.LineSubMeshRenderable\n */\nclass LineSubMeshRenderable extends RenderableBase\n{\n\tpublic static pONE_VECTOR:Array<number> = Array<number>(1, 1, 1, 1);\n\tpublic static pFRONT_VECTOR:Array<number> = Array<number>(0, 0, -1, 0);\n\n\tprivate _constants:Array<number> = new Array<number>(0, 0, 0, 0);\n\tprivate _calcMatrix:Matrix3D;\n\tprivate _thickness:number = 1.25;\n\n\t/**\n\t *\n\t */\n\tpublic static id:string = \"linesubmesh\";\n\n\tpublic static vertexAttributesOffset:number = 3;\n\n\t/**\n\t *\n\t */\n\tpublic subMesh:LineSubMesh;\n\n\t/**\n\t * //TODO\n\t *\n\t * @param pool\n\t * @param subMesh\n\t * @param level\n\t * @param dataOffset\n\t */\n\tconstructor(pool:RenderablePoolBase, subMesh:LineSubMesh, stage:Stage, level:number = 0, indexOffset:number = 0)\n\t{\n\t\tsuper(pool, subMesh.parentMesh, subMesh, subMesh.material, stage, level, indexOffset);\n\n\t\tthis.subMesh = subMesh;\n\n\t\tthis._calcMatrix = new Matrix3D();\n\n\t\tthis._constants[1] = 1/255;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @returns {base.LineSubGeometry}\n\t * @protected\n\t */\n\tpublic _pGetSubGeometry():LineSubGeometry\n\t{\n\t\tvar subGeometry:LineSubGeometry = this.subMesh.subGeometry;\n\n\t\tthis._pVertexDataDirty[LineSubGeometry.START_POSITION_DATA] = true;\n\t\tthis._pVertexDataDirty[LineSubGeometry.END_POSITION_DATA] = true;\n\n\t\tif (subGeometry.thickness)\n\t\t\tthis._pVertexDataDirty[LineSubGeometry.THICKNESS_DATA] = true;\n\n\t\tif (subGeometry.startColors)\n\t\t\tthis._pVertexDataDirty[LineSubGeometry.COLOR_DATA] = true;\n\n\t\treturn subGeometry;\n\t}\n\n\tpublic static _iIncludeDependencies(shaderObject:ShaderObjectBase)\n\t{\n\t\tshaderObject.colorDependencies++;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static _iGetVertexCode(shader:ShaderObjectBase, regCache:ShaderRegisterCache, sharedReg:ShaderRegisterData):string\n\t{\n\t\treturn \"m44 vt0, va0, vc8\t\t\t\\n\" + // transform Q0 to eye space\n\t\t\t\"m44 vt1, va1, vc8\t\t\t\\n\" + // transform Q1 to eye space\n\t\t\t\"sub vt2, vt1, vt0 \t\t\t\\n\" + // L = Q1 - Q0\n\n\t\t\t\t// test if behind camera near plane\n\t\t\t\t// if 0 - Q0.z < Camera.near then the point needs to be clipped\n\t\t\t\t//\"neg vt5.x, vt0.z\t\t\t\t\\n\" + // 0 - Q0.z\n\t\t\t\"slt vt5.x, vt0.z, vc7.z\t\t\t\\n\" + // behind = ( 0 - Q0.z < -Camera.near ) ? 1 : 0\n\t\t\t\"sub vt5.y, vc5.x, vt5.x\t\t\t\\n\" + // !behind = 1 - behind\n\n\t\t\t\t// p = point on the plane (0,0,-near)\n\t\t\t\t// n = plane normal (0,0,-1)\n\t\t\t\t// D = Q1 - Q0\n\t\t\t\t// t = ( dot( n, ( p - Q0 ) ) / ( dot( n, d )\n\n\t\t\t\t// solve for t where line crosses Camera.near\n\t\t\t\"add vt4.x, vt0.z, vc7.z\t\t\t\\n\" + // Q0.z + ( -Camera.near )\n\t\t\t\"sub vt4.y, vt0.z, vt1.z\t\t\t\\n\" + // Q0.z - Q1.z\n\n\t\t\t\t// fix divide by zero for horizontal lines\n\t\t\t\"seq vt4.z, vt4.y vc6.x\t\t\t\\n\" + // offset = (Q0.z - Q1.z)==0 ? 1 : 0\n\t\t\t\"add vt4.y, vt4.y, vt4.z\t\t\t\\n\" + // ( Q0.z - Q1.z ) + offset\n\n\t\t\t\"div vt4.z, vt4.x, vt4.y\t\t\t\\n\" + // t = ( Q0.z - near ) / ( Q0.z - Q1.z )\n\n\t\t\t\"mul vt4.xyz, vt4.zzz, vt2.xyz\t\\n\" + // t(L)\n\t\t\t\"add vt3.xyz, vt0.xyz, vt4.xyz\t\\n\" + // Qclipped = Q0 + t(L)\n\t\t\t\"mov vt3.w, vc5.x\t\t\t\\n\" + // Qclipped.w = 1\n\n\t\t\t\t// If necessary, replace Q0 with new Qclipped\n\t\t\t\"mul vt0, vt0, vt5.yyyy\t\t\t\\n\" + // !behind * Q0\n\t\t\t\"mul vt3, vt3, vt5.xxxx\t\t\t\\n\" + // behind * Qclipped\n\t\t\t\"add vt0, vt0, vt3\t\t\t\t\\n\" + // newQ0 = Q0 + Qclipped\n\n\t\t\t\t// calculate side vector for line\n\t\t\t\"sub vt2, vt1, vt0 \t\t\t\\n\" + // L = Q1 - Q0\n\t\t\t\"nrm vt2.xyz, vt2.xyz\t\t\t\\n\" + // normalize( L )\n\t\t\t\"nrm vt5.xyz, vt0.xyz\t\t\t\\n\" + // D = normalize( Q1 )\n\t\t\t\"mov vt5.w, vc5.x\t\t\t\t\\n\" + // D.w = 1\n\t\t\t\"crs vt3.xyz, vt2, vt5\t\t\t\\n\" + // S = L x D\n\t\t\t\"nrm vt3.xyz, vt3.xyz\t\t\t\\n\" + // normalize( S )\n\n\t\t\t\t// face the side vector properly for the given point\n\t\t\t\"mul vt3.xyz, vt3.xyz, va2.xxx\t\\n\" + // S *= weight\n\t\t\t\"mov vt3.w, vc5.x\t\t\t\\n\" + // S.w = 1\n\n\t\t\t\t// calculate the amount required to move at the point's distance to correspond to the line's pixel width\n\t\t\t\t// scale the side vector by that amount\n\t\t\t\"dp3 vt4.x, vt0, vc6\t\t\t\\n\" + // distance = dot( view )\n\t\t\t\"mul vt4.x, vt4.x, vc7.x\t\t\t\\n\" + // distance *= vpsod\n\t\t\t\"mul vt3.xyz, vt3.xyz, vt4.xxx\t\\n\" + // S.xyz *= pixelScaleFactor\n\n\t\t\t\t// add scaled side vector to Q0 and transform to clip space\n\t\t\t\"add vt0.xyz, vt0.xyz, vt3.xyz\t\\n\" + // Q0 + S\n\n\t\t\t\"m44 op, vt0, vc0\t\t\t\\n\"  // transform Q0 to clip space\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iActivate(pass:RenderPassBase, camera:Camera)\n\t{\n\t\tsuper._iActivate(pass, camera);\n\n\t\tthis._constants[0] = this._thickness/((this._stage.scissorRect)? Math.min(this._stage.scissorRect.width, this._stage.scissorRect.height) : Math.min(this._stage.width, this._stage.height));\n\n\t\t// value to convert distance from camera to model length per pixel width\n\t\tthis._constants[2] = camera.projection.near;\n\n\t\tvar context:IContextGL = this._stage.context;\n\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, LineSubMeshRenderable.pONE_VECTOR, 1);\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 6, LineSubMeshRenderable.pFRONT_VECTOR, 1);\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 7, this._constants, 1);\n\n\t\t// projection matrix\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, camera.projection.matrix, true);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iRender(pass:RenderPassBase, camera:Camera, viewProjection:Matrix3D)\n\t{\n\t\tsuper._iRender(pass, camera, viewProjection);\n\n\t\tvar context:IContextGL = this._stage.context;\n\t\tthis._calcMatrix.copyFrom(this.sourceEntity.sceneTransform);\n\t\tthis._calcMatrix.append(camera.inverseSceneTransform);\n\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 8, this._calcMatrix, true);\n\n\t\tthis._stage.activateBuffer(0, this.getVertexData(LineSubGeometry.START_POSITION_DATA), this.getVertexOffset(LineSubGeometry.START_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);\n\t\tthis._stage.activateBuffer(1, this.getVertexData(LineSubGeometry.END_POSITION_DATA), this.getVertexOffset(LineSubGeometry.END_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);\n\t\tthis._stage.activateBuffer(2, this.getVertexData(LineSubGeometry.THICKNESS_DATA), this.getVertexOffset(LineSubGeometry.THICKNESS_DATA), LineSubGeometry.THICKNESS_FORMAT);\n\n\t\tcontext.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param pool\n\t * @param renderableOwner\n\t * @param level\n\t * @param indexOffset\n\t * @returns {away.pool.LineSubMeshRenderable}\n\t * @private\n\t */\n\tpublic _pGetOverflowRenderable(indexOffset:number):RenderableBase\n\t{\n\t\treturn new LineSubMeshRenderable(this._pool, <LineSubMesh> this.renderableOwner, this._stage, this._level + 1, indexOffset);\n\t}\n}\n\nexport = LineSubMeshRenderable;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport IRenderable\t\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderable\");\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\nimport RenderableOwnerEvent\t\t\t= require(\"awayjs-display/lib/events/RenderableOwnerEvent\");\nimport SubGeometryEvent\t\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/render/IRenderer\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\n\nimport IndexData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/IndexData\");\nimport IndexDataPool\t\t\t\t= require(\"awayjs-stagegl/lib/pool/IndexDataPool\");\nimport VertexData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/VertexData\");\nimport VertexDataPool\t\t\t\t= require(\"awayjs-stagegl/lib/pool/VertexDataPool\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\n\n/**\n * @class RenderableListItem\n */\nclass RenderableBase implements IRenderable\n{\n\n\tprivate _onIndicesUpdatedDelegate:(event:SubGeometryEvent) => void;\n\tprivate _onVerticesUpdatedDelegate:(event:SubGeometryEvent) => void;\n\tprivate _onRenderObjectOwnerUpdatedDelegate:(event:RenderableOwnerEvent) => void;\n\n\tprivate _subGeometry:SubGeometryBase;\n\tprivate _geometryDirty:boolean = true;\n\tprivate _indexData:IndexData;\n\tprivate _indexDataDirty:boolean = true;\n\tprivate _vertexData:Object = new Object();\n\tpublic _pVertexDataDirty:Object = new Object();\n\tprivate _vertexOffset:Object = new Object();\n\n\tpublic _level:number;\n\tprivate _indexOffset:number;\n\tprivate _overflow:RenderableBase;\n\tprivate _numTriangles:number;\n\tprivate _concatenateArrays:boolean;\n\n\tpublic JOINT_INDEX_FORMAT:string;\n\tpublic JOINT_WEIGHT_FORMAT:string;\n\n\t/**\n\t *\n\t */\n\tpublic _pool:RenderablePoolBase;\n\n\tpublic _stage:Stage;\n\n\t/**\n\t *\n\t */\n\tpublic get overflow():RenderableBase\n\t{\n\t\tif (this._indexDataDirty)\n\t\t\tthis._updateIndexData();\n\n\t\treturn this._overflow;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic get numTriangles():number\n\t{\n\t\treturn this._numTriangles;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic next:RenderableBase;\n\n\tpublic id:number;\n\n\t/**\n\t *\n\t */\n\tpublic renderObjectId:number;\n\n\t/**\n\t *\n\t */\n\tpublic renderOrderId:number;\n\n\t/**\n\t *\n\t */\n\tpublic zIndex:number;\n\n\t/**\n\t *\n\t */\n\tpublic cascaded:boolean;\n\n\t/**\n\t *\n\t */\n\tpublic renderSceneTransform:Matrix3D;\n\n\t/**\n\t *\n\t */\n\tpublic sourceEntity:IEntity;\n\n\t/**\n\t *\n\t */\n\tpublic renderableOwner:IRenderableOwner;\n\n\n\t/**\n\t *\n\t */\n\tpublic renderObjectOwner:IRenderObjectOwner;\n\n\t/**\n\t *\n\t */\n\tpublic renderObject:RenderObjectBase;\n\n\t/**\n\t *\n\t */\n\tpublic getIndexData():IndexData\n\t{\n\t\tif (this._indexDataDirty)\n\t\t\tthis._updateIndexData();\n\n\t\treturn this._indexData;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic getVertexData(dataType:string):VertexData\n\t{\n\t\tif (this._indexDataDirty)\n\t\t\tthis._updateIndexData();\n\n\t\tif (this._pVertexDataDirty[dataType])\n\t\t\tthis._updateVertexData(dataType);\n\n\t\treturn this._vertexData[this._concatenateArrays? TriangleSubGeometry.VERTEX_DATA : dataType]\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic getVertexOffset(dataType:string):number\n\t{\n\t\tif (this._indexDataDirty)\n\t\t\tthis._updateIndexData();\n\n\t\tif (this._pVertexDataDirty[dataType])\n\t\t\tthis._updateVertexData(dataType);\n\n\t\treturn this._vertexOffset[dataType];\n\t}\n\n\t/**\n\t *\n\t * @param sourceEntity\n\t * @param renderableOwner\n\t * @param subGeometry\n\t * @param animationSubGeometry\n\t */\n\tconstructor(pool:RenderablePoolBase, sourceEntity:IEntity, renderableOwner:IRenderableOwner, renderObjectOwner:IRenderObjectOwner, stage:Stage, level:number = 0, indexOffset:number = 0)\n\t{\n\t\tthis._onIndicesUpdatedDelegate = (event:SubGeometryEvent) => this._onIndicesUpdated(event);\n\t\tthis._onVerticesUpdatedDelegate = (event:SubGeometryEvent) => this._onVerticesUpdated(event);\n\t\tthis._onRenderObjectOwnerUpdatedDelegate = (event:RenderableOwnerEvent) => this._onRenderObjectOwnerUpdated(event);\n\n\t\t//store a reference to the pool for later disposal\n\t\tthis._pool = pool;\n\t\tthis._stage = stage;\n\n\t\t//reference to level of overflow\n\t\tthis._level = level;\n\n\t\t//reference to the offset on indices (if this is an overflow renderable)\n\t\tthis._indexOffset = indexOffset;\n\n\t\tthis.sourceEntity = sourceEntity;\n\n\t\tthis.renderableOwner = renderableOwner;\n\n\t\tthis.renderableOwner.addEventListener(RenderableOwnerEvent.RENDER_OBJECT_OWNER_UPDATED, this._onRenderObjectOwnerUpdatedDelegate)\n\n\t\tthis.renderObjectOwner = renderObjectOwner;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._pool.disposeItem(this.renderableOwner);\n\n\t\tthis._indexData.dispose();\n\t\tthis._indexData = null;\n\n\t\tfor (var dataType in this._vertexData) {\n\t\t\t(<VertexData> this._vertexData[dataType]).dispose();\n\t\t\tthis._vertexData[dataType] = null;\n\t\t}\n\n\t\tif (this._overflow) {\n\t\t\tthis._overflow.dispose();\n\t\t\tthis._overflow = null;\n\t\t}\n\t}\n\n\tpublic invalidateGeometry()\n\t{\n\t\tthis._geometryDirty = true;\n\n\t\t//invalidate indices\n\t\tif (this._level == 0)\n\t\t\tthis._indexDataDirty = true;\n\n\t\tif (this._overflow)\n\t\t\tthis._overflow.invalidateGeometry();\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic invalidateIndexData()\n\t{\n\t\tthis._indexDataDirty = true;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param dataType\n\t */\n\tpublic invalidateVertexData(dataType:string)\n\t{\n\t\tthis._pVertexDataDirty[dataType] = true;\n\t}\n\n\tpublic _pGetSubGeometry():SubGeometryBase\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\tpublic static _iGetVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"\";\n\t}\n\n\tpublic static _iGetFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param subGeometry\n\t * @param offset\n\t * @internal\n\t */\n\tpublic _iFillIndexData(indexOffset:number)\n\t{\n\t\tif (this._geometryDirty)\n\t\t\tthis._updateGeometry();\n\n\t\tthis._indexData = IndexDataPool.getItem(this._subGeometry, this._level, indexOffset);\n\n\t\tthis._numTriangles = this._indexData.data.length/3;\n\n\t\tindexOffset = this._indexData.offset;\n\n\t\t//check if there is more to split\n\t\tif (indexOffset < this._subGeometry.indices.length) {\n\t\t\tif (!this._overflow)\n\t\t\t\tthis._overflow = this._pGetOverflowRenderable(indexOffset);\n\n\t\t\tthis._overflow._iFillIndexData(indexOffset);\n\t\t} else if (this._overflow) {\n\t\t\tthis._overflow.dispose();\n\t\t\tthis._overflow = null;\n\t\t}\n\t}\n\n\tpublic _pGetOverflowRenderable(indexOffset:number):RenderableBase\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n\n\t/**\n\t * Sets the render state for the pass that is independent of the rendered object. This needs to be called before\n\t * calling renderPass. Before activating a pass, the previously used pass needs to be deactivated.\n\t * @param stage The Stage object which is currently used for rendering.\n\t * @param camera The camera from which the scene is viewed.\n\t * @private\n\t */\n\tpublic _iActivate(pass:RenderPassBase, camera:Camera)\n\t{\n\t\tpass._iActivate(camera);\n\t}\n\n\t/**\n\t * Renders an object to the current render target.\n\t *\n\t * @private\n\t */\n\tpublic _iRender(pass:RenderPassBase, camera:Camera, viewProjection:Matrix3D)\n\t{\n\t\tpass._iRender(this, camera, viewProjection);\n\t}\n\n\t/**\n\t * Clears the render state for the pass. This needs to be called before activating another pass.\n\t * @param stage The Stage used for rendering\n\t *\n\t * @private\n\t */\n\tpublic _iDeactivate(pass:RenderPassBase)\n\t{\n\t\tpass._iDeactivate();\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @private\n\t */\n\tprivate _updateGeometry()\n\t{\n\t\tif (this._subGeometry) {\n\t\t\tif (this._level == 0)\n\t\t\t\tthis._subGeometry.removeEventListener(SubGeometryEvent.INDICES_UPDATED, this._onIndicesUpdatedDelegate);\n\t\t\tthis._subGeometry.removeEventListener(SubGeometryEvent.VERTICES_UPDATED, this._onVerticesUpdatedDelegate);\n\t\t}\n\n\t\tthis._subGeometry = this._pGetSubGeometry();\n\n\t\tthis._concatenateArrays = this._subGeometry.concatenateArrays;\n\n\t\tif (this._subGeometry) {\n\t\t\tif (this._level == 0)\n\t\t\t\tthis._subGeometry.addEventListener(SubGeometryEvent.INDICES_UPDATED, this._onIndicesUpdatedDelegate);\n\t\t\tthis._subGeometry.addEventListener(SubGeometryEvent.VERTICES_UPDATED, this._onVerticesUpdatedDelegate);\n\t\t}\n\n\t\t//dispose\n//\t\t\tif (this._indexData) {\n//\t\t\t\tthis._indexData.dispose(); //TODO where is a good place to dispose?\n//\t\t\t\tthis._indexData = null;\n//\t\t\t}\n\n//\t\t\tfor (var dataType in this._vertexData) {\n//\t\t\t\t(<VertexData> this._vertexData[dataType]).dispose(); //TODO where is a good place to dispose?\n//\t\t\t\tthis._vertexData[dataType] = null;\n//\t\t\t}\n\n\t\tthis._geometryDirty = false;\n\n\t\t//specific vertex data types have to be invalidated in the specific renderable\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @private\n\t */\n\tprivate _updateIndexData()\n\t{\n\t\tthis._iFillIndexData(this._indexOffset);\n\n\t\tthis._indexDataDirty = false;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param dataType\n\t * @private\n\t */\n\tprivate _updateVertexData(dataType:string)\n\t{\n\t\tthis._vertexOffset[dataType] = this._subGeometry.getOffset(dataType);\n\n\t\tif (this._subGeometry.concatenateArrays)\n\t\t\tdataType = SubGeometryBase.VERTEX_DATA;\n\n\t\tthis._vertexData[dataType] = VertexDataPool.getItem(this._subGeometry, this.getIndexData(), dataType);\n\n\t\tthis._pVertexDataDirty[dataType] = false;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param event\n\t * @private\n\t */\n\tprivate _onIndicesUpdated(event:SubGeometryEvent)\n\t{\n\t\tthis.invalidateIndexData();\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param event\n\t * @private\n\t */\n\tprivate _onVerticesUpdated(event:SubGeometryEvent)\n\t{\n\t\tthis._concatenateArrays = (<SubGeometryBase> event.target).concatenateArrays;\n\n\t\tthis.invalidateVertexData(event.dataType);\n\t}\n\n\tprivate _onRenderObjectOwnerUpdated(event:RenderableOwnerEvent)\n\t{\n\t\t//TODO flag unused renderObjects for deletion\n\t\tthis.renderObjectOwner = event.renderObjectOwner;\n\t}\n}\n\nexport = RenderableBase;","import IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\nimport IRenderablePool\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderablePool\");\nimport IRenderObject\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderObject\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\nimport RenderBasicMaterialObject\t= require(\"awayjs-renderergl/lib/compilation/RenderBasicMaterialObject\");\nimport SkyboxRenderObject\t\t\t= require(\"awayjs-renderergl/lib/compilation/SkyboxRenderObject\");\nimport DepthRenderObject\t\t\t= require(\"awayjs-renderergl/lib/compilation/DepthRenderObject\");\nimport DistanceRenderObject\t\t\t= require(\"awayjs-renderergl/lib/compilation/DistanceRenderObject\");\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\n\n/**\n * @class away.pool.RenderablePoolBase\n */\nclass RenderablePoolBase implements IRenderablePool\n{\n\tpublic static _pools:Object = new Object();\n\n\tpublic _stage:Stage;\n\tpublic _renderablePool:Object = new Object();\n\tpublic _renderableClass:IRenderableClass;\n\n\tprivate _materialRenderObjectPool:RenderObjectPool;\n\tprivate _skyboxRenderObjectPool:RenderObjectPool;\n\tprivate _depthRenderObjectPool:RenderObjectPool;\n\tprivate _distanceRenderObjectPool:RenderObjectPool;\n\n\t/**\n\t * //TODO\n\t *\n\t * @param renderableClass\n\t */\n\tconstructor(renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tthis._renderableClass = renderableClass;\n\t\tthis._stage = stage;\n\n\t\tthis._materialRenderObjectPool = new RenderObjectPool(RenderBasicMaterialObject, this._renderableClass, this._stage);\n\t\tthis._skyboxRenderObjectPool = new RenderObjectPool(SkyboxRenderObject, this._renderableClass, this._stage);\n\t\tthis._depthRenderObjectPool = new RenderObjectPool(DepthRenderObject, this._renderableClass, this._stage);\n\t\tthis._distanceRenderObjectPool = new RenderObjectPool(DistanceRenderObject, this._renderableClass, this._stage);\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param renderableOwner\n\t * @returns IRenderable\n\t */\n\tpublic getItem(renderableOwner:IRenderableOwner):RenderableBase\n\t{\n\t\treturn (this._renderablePool[renderableOwner.id] || (this._renderablePool[renderableOwner.id] = renderableOwner._iAddRenderable(new this._renderableClass(this, renderableOwner, this._stage))))\n\t}\n\n\t/**\n\t *\n\t * @param material\n\t * @param renderable\n\t */\n\tpublic getMaterialRenderObject(renderObjectOwner:IRenderObjectOwner):RenderObjectBase\n\t{\n\t\treturn this._materialRenderObjectPool.getItem(renderObjectOwner);\n\t}\n\n\t/**\n\t *\n\t * @param material\n\t * @param renderable\n\t */\n\tpublic getSkyboxRenderObject(renderObjectOwner:IRenderObjectOwner):RenderObjectBase\n\t{\n\t\treturn this._skyboxRenderObjectPool.getItem(renderObjectOwner);\n\t}\n\n\t/**\n\t *\n\t * @param material\n\t * @param renderable\n\t */\n\tpublic getDepthRenderObject(renderObjectOwner:IRenderObjectOwner):RenderObjectBase\n\t{\n\t\treturn this._depthRenderObjectPool.getItem(renderObjectOwner);\n\t}\n\n\t/**\n\t *\n\t * @param material\n\t * @param renderable\n\t */\n\tpublic getDistanceRenderObject(renderObjectOwner:IRenderObjectOwner):RenderObjectBase\n\t{\n\t\treturn this._distanceRenderObjectPool.getItem(renderObjectOwner);\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param renderableOwner\n\t */\n\tpublic disposeItem(renderableOwner:IRenderableOwner)\n\t{\n\t\trenderableOwner._iRemoveRenderable(this._renderablePool[renderableOwner.id]);\n\n\t\tthis._renderablePool[renderableOwner.id] = null;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tfor (var id in this._renderablePool)\n\t\t\tthis._renderablePool[id].dispose();\n\n\t\tRenderablePoolBase.disposePool(this._renderableClass, this._stage);\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param renderableClass\n\t * @returns RenderablePoolBase\n\t */\n\tpublic static getPool(renderableClass:IRenderableClass, stage:Stage):RenderablePoolBase\n\t{\n\t\tvar pools:Object = (RenderablePoolBase._pools[stage.stageIndex] || (RenderablePoolBase._pools[stage.stageIndex] = new Object()));\n\n\t\treturn (pools[renderableClass.id] || (pools[renderableClass.id] = new RenderablePoolBase(renderableClass, stage)));\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param renderableClass\n\t */\n\tpublic static disposePool(renderableClass:IRenderableClass, stage:Stage)\n\t{\n\t\tvar pools:Object = RenderablePoolBase._pools[stage.stageIndex];\n\n\t\tif (pools == undefined)\n\t\t\treturn;\n\n\t\tif (pools[renderableClass.id])\n\t\t\tpools[renderableClass.id] = undefined;\n\t}\n}\n\nexport = RenderablePoolBase;","\nimport LineSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/LineSubMesh\");\nimport TriangleSubMesh\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\nimport IRendererPool\t\t\t\t= require(\"awayjs-display/lib/pool/IRendererPool\");\nimport Billboard\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\nimport LineSegment\t\t\t\t\t= require(\"awayjs-display/lib/entities/LineSegment\");\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport BillboardRenderable\t\t\t= require(\"awayjs-renderergl/lib/pool/BillboardRenderable\");\nimport LineSegmentRenderable\t\t= require(\"awayjs-renderergl/lib/pool/LineSegmentRenderable\");\nimport LineSubMeshRenderable\t\t= require(\"awayjs-renderergl/lib/pool/LineSubMeshRenderable\");\nimport TriangleSubMeshRenderable\t= require(\"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable\");\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\n\n/**\n * RendererPoolBase forms an abstract base class for classes that are used in the rendering pipeline to render the\n * contents of a partition\n *\n * @class away.render.RendererPoolBase\n */\nclass RendererPoolBase implements IRendererPool\n{\n\tpublic _billboardRenderablePool:RenderablePoolBase;\n\tpublic _lineSegmentRenderablePool:RenderablePoolBase;\n\tpublic _triangleSubMeshRenderablePool:RenderablePoolBase;\n\tpublic _lineSubMeshRenderablePool:RenderablePoolBase;\n\n\tpublic _pStage:Stage;\n\n\n\tprivate _renderer:RendererBase;\n\t\n\t/**\n\t * Creates a new RendererPoolBase object.\n\t */\n\tconstructor(renderer:RendererBase)\n\t{\n\t\tthis._renderer = renderer;\n\t}\n\n\t/**\n\t * The Stage that will provide the ContextGL used for rendering.\n\t */\n\tpublic get stage():Stage\n\t{\n\t\treturn this._pStage;\n\t}\n\n\tpublic set stage(value:Stage)\n\t{\n\t\tif (this._pStage == value)\n\t\t\treturn;\n\n\t\tif (this._pStage)\n\t\t\tthis.dispose();\n\n\t\tthis._pStage = value;\n\n\t\tif (this._pStage)\n\t\t\tthis._pUpdatePool();\n\t}\n\n\tpublic _pUpdatePool()\n\t{\n\t\tthis._billboardRenderablePool = RenderablePoolBase.getPool(BillboardRenderable, this._pStage);\n\t\tthis._lineSegmentRenderablePool = RenderablePoolBase.getPool(LineSegmentRenderable, this._pStage);\n\t\tthis._triangleSubMeshRenderablePool = RenderablePoolBase.getPool(TriangleSubMeshRenderable, this._pStage);\n\t\tthis._lineSubMeshRenderablePool = RenderablePoolBase.getPool(LineSubMeshRenderable, this._pStage);\n\t}\n\n\t/**\n\t * Disposes the resources used by the RendererPoolBase.\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._billboardRenderablePool.dispose();\n\t\tthis._billboardRenderablePool = null;\n\n\t\tthis._lineSegmentRenderablePool.dispose();\n\t\tthis._lineSegmentRenderablePool = null;\n\n\t\tthis._triangleSubMeshRenderablePool.dispose();\n\t\tthis._triangleSubMeshRenderablePool = null;\n\n\t\tthis._lineSubMeshRenderablePool.dispose();\n\t\tthis._lineSubMeshRenderablePool = null;\n\t}\n\n\t/**\n\t *\n\t * @param billboard\n\t * @protected\n\t */\n\tpublic applyBillboard(billboard:Billboard)\n\t{\n\t\tthis._renderer.applyRenderable(this._billboardRenderablePool.getItem(billboard));\n\t}\n\n\t/**\n\t *\n\t * @param lineSubMesh\n\t */\n\tpublic applyLineSegment(lineSegment:LineSegment)\n\t{\n\t\tthis._renderer.applyRenderable(this._lineSegmentRenderablePool.getItem(lineSegment));\n\t}\n\n\t/**\n\t *\n\t * @param triangleSubMesh\n\t */\n\tpublic applyTriangleSubMesh(triangleSubMesh:TriangleSubMesh)\n\t{\n\t\tthis._renderer.applyRenderable(this._triangleSubMeshRenderablePool.getItem(triangleSubMesh));\n\t}\n\n\t/**\n\t *\n\t * @param lineSubMesh\n\t */\n\tpublic applyLineSubMesh(lineSubMesh:LineSubMesh)\n\t{\n\t\tthis._renderer.applyRenderable(this._lineSubMeshRenderablePool.getItem(lineSubMesh));\n\t}\n}\n\nexport = RendererPoolBase;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport CubeTextureBase\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\n\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\nimport ContextGLMipFilter\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLMipFilter\");\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\nimport ContextGLTextureFilter\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFilter\");\nimport ContextGLWrapMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLWrapMode\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\nimport ShaderCompilerHelper\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\n\n/**\n * @class away.pool.SkyboxRenderable\n */\nclass SkyboxRenderable extends RenderableBase\n{\n\tprivate _vertexArray:Array<number>;\n\n\t/**\n\t *\n\t */\n\tpublic static id:string = \"skybox\";\n\n\tpublic static vertexAttributesOffset:number = 1;\n\n\t/**\n\t *\n\t */\n\tprivate static _geometry:TriangleSubGeometry;\n\n\t/**\n\t * //TODO\n\t *\n\t * @param pool\n\t * @param skybox\n\t */\n\tconstructor(pool:RenderablePoolBase, skybox:Skybox, stage:Stage)\n\t{\n\t\tsuper(pool, skybox, skybox, skybox, stage);\n\n\t\tthis._vertexArray = new Array<number>(0, 0, 0, 0, 1, 1, 1, 1);\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @returns {away.base.TriangleSubGeometry}\n\t * @private\n\t */\n\tpublic _pGetSubGeometry():TriangleSubGeometry\n\t{\n\t\tvar geometry:TriangleSubGeometry = SkyboxRenderable._geometry;\n\n\t\tif (!geometry) {\n\t\t\tgeometry = SkyboxRenderable._geometry = new TriangleSubGeometry(true);\n\t\t\tgeometry.autoDeriveNormals = false;\n\t\t\tgeometry.autoDeriveTangents = false;\n\t\t\tgeometry.updateIndices(Array<number>(0, 1, 2, 2, 3, 0, 6, 5, 4, 4, 7, 6, 2, 6, 7, 7, 3, 2, 4, 5, 1, 1, 0, 4, 4, 0, 3, 3, 7, 4, 2, 1, 5, 5, 6, 2));\n\t\t\tgeometry.updatePositions(Array<number>(-1, 1, -1, 1, 1, -1, 1, 1, 1, -1, 1, 1, -1, -1, -1, 1, -1, -1, 1, -1, 1, -1, -1, 1));\n\t\t}\n\n\t\tthis._pVertexDataDirty[TriangleSubGeometry.POSITION_DATA] = true;\n\n\t\treturn geometry;\n\t}\n\n\tpublic static _iIncludeDependencies(shaderObject:ShaderObjectBase)\n\t{\n\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static _iGetVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\treturn \"mul vt0, va0, vc5\\n\" +\n\t\t\t\"add vt0, vt0, vc4\\n\" +\n\t\t\t\"m44 op, vt0, vc0\\n\" +\n\t\t\t\"mov v0, va0\\n\";\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iRender(pass:RenderPassBase, camera:Camera, viewProjection:Matrix3D)\n\t{\n\t\tsuper._iRender(pass, camera, viewProjection);\n\n\t\tvar context:IContextGL = this._stage.context;\n\t\tvar pos:Vector3D = camera.scenePosition;\n\t\tthis._vertexArray[0] = pos.x;\n\t\tthis._vertexArray[1] = pos.y;\n\t\tthis._vertexArray[2] = pos.z;\n\t\tthis._vertexArray[4] = this._vertexArray[5] = this._vertexArray[6] = camera.projection.far/Math.sqrt(3);\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, viewProjection, true);\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 4, this._vertexArray, 2);\n\n\t\tthis._stage.activateBuffer(0, this.getVertexData(TriangleSubGeometry.POSITION_DATA), this.getVertexOffset(TriangleSubGeometry.POSITION_DATA), TriangleSubGeometry.POSITION_FORMAT);\n\t\tcontext.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);\n\t}\n}\n\nexport = SkyboxRenderable;","import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\n\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\nimport TriangleSubMesh\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\n\nimport ContextGLVertexBufferFormat\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\n\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\n\n/**\n * @class away.pool.TriangleSubMeshRenderable\n */\nclass TriangleSubMeshRenderable extends RenderableBase\n{\n\t/**\n\t *\n\t */\n\tpublic static id:string = \"trianglesubmesh\";\n\n\tpublic static vertexAttributesOffset:number = 1;\n\n\t/**\n\t *\n\t */\n\tpublic subMesh:TriangleSubMesh;\n\n\n\t/**\n\t * //TODO\n\t *\n\t * @param pool\n\t * @param subMesh\n\t * @param level\n\t * @param indexOffset\n\t */\n\tconstructor(pool:RenderablePoolBase, subMesh:TriangleSubMesh, stage:Stage, level:number = 0, indexOffset:number = 0)\n\t{\n\t\tsuper(pool, subMesh.parentMesh, subMesh, subMesh.material, stage, level, indexOffset);\n\n\t\tthis.subMesh = subMesh;\n\t}\n\n\t/**\n\t *\n\t * @returns {SubGeometryBase}\n\t * @protected\n\t */\n\tpublic _pGetSubGeometry():TriangleSubGeometry\n\t{\n\t\tvar subGeometry:TriangleSubGeometry;\n\n\t\tif (this.subMesh.animator)\n\t\t\tsubGeometry = <TriangleSubGeometry> this.subMesh.animator.getRenderableSubGeometry(this, this.subMesh.subGeometry);\n\t\telse\n\t\t\tsubGeometry = this.subMesh.subGeometry;\n\n\t\tthis._pVertexDataDirty[TriangleSubGeometry.POSITION_DATA] = true;\n\n\t\tif (subGeometry.vertexNormals)\n\t\t\tthis._pVertexDataDirty[TriangleSubGeometry.NORMAL_DATA] = true;\n\n\t\tif (subGeometry.vertexTangents)\n\t\t\tthis._pVertexDataDirty[TriangleSubGeometry.TANGENT_DATA] = true;\n\n\t\tif (subGeometry.uvs)\n\t\t\tthis._pVertexDataDirty[TriangleSubGeometry.UV_DATA] = true;\n\n\t\tif (subGeometry.secondaryUVs)\n\t\t\tthis._pVertexDataDirty[TriangleSubGeometry.SECONDARY_UV_DATA] = true;\n\n\t\tif (subGeometry.jointIndices)\n\t\t\tthis._pVertexDataDirty[TriangleSubGeometry.JOINT_INDEX_DATA] = true;\n\n\t\tif (subGeometry.jointWeights)\n\t\t\tthis._pVertexDataDirty[TriangleSubGeometry.JOINT_WEIGHT_DATA] = true;\n\n\t\tswitch(subGeometry.jointsPerVertex) {\n\t\t\tcase 1:\n\t\t\t\tthis.JOINT_INDEX_FORMAT = this.JOINT_WEIGHT_FORMAT = ContextGLVertexBufferFormat.FLOAT_1;\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tthis.JOINT_INDEX_FORMAT = this.JOINT_WEIGHT_FORMAT = ContextGLVertexBufferFormat.FLOAT_2;\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tthis.JOINT_INDEX_FORMAT = this.JOINT_WEIGHT_FORMAT = ContextGLVertexBufferFormat.FLOAT_3;\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tthis.JOINT_INDEX_FORMAT = this.JOINT_WEIGHT_FORMAT = ContextGLVertexBufferFormat.FLOAT_4;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t}\n\n\t\treturn subGeometry;\n\t}\n\n\n\tpublic static _iIncludeDependencies(shaderObject:ShaderObjectBase)\n\t{\n\n\t}\n\n\tpublic static _iGetVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\n\t{\n\t\tvar code:string = \"\";\n\n\t\t//get the projection coordinates\n\t\tvar position:ShaderRegisterElement = (shaderObject.globalPosDependencies > 0)? sharedRegisters.globalPositionVertex : sharedRegisters.localPosition;\n\n\t\t//reserving vertex constants for projection matrix\n\t\tvar viewMatrixReg:ShaderRegisterElement = registerCache.getFreeVertexConstant();\n\t\tregisterCache.getFreeVertexConstant();\n\t\tregisterCache.getFreeVertexConstant();\n\t\tregisterCache.getFreeVertexConstant();\n\t\tshaderObject.viewMatrixIndex = viewMatrixReg.index*4;\n\n\t\tif (shaderObject.projectionDependencies > 0) {\n\t\t\tsharedRegisters.projectionFragment = registerCache.getFreeVarying();\n\t\t\tvar temp:ShaderRegisterElement = registerCache.getFreeVertexVectorTemp();\n\t\t\tcode += \"m44 \" + temp + \", \" + position + \", \" + viewMatrixReg + \"\\n\" +\n\t\t\t\"mov \" + sharedRegisters.projectionFragment + \", \" + temp + \"\\n\" +\n\t\t\t\"mov op, \" + temp + \"\\n\";\n\t\t} else {\n\t\t\tcode += \"m44 op, \" + position + \", \" + viewMatrixReg + \"\\n\";\n\t\t}\n\n\t\treturn code;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic _iRender(pass:RenderPassBase, camera:Camera, viewProjection:Matrix3D)\n\t{\n\t\tsuper._iRender(pass, camera, viewProjection);\n\n\t\tvar shader:ShaderObjectBase = pass.shader;\n\n\t\tif (shader.sceneMatrixIndex >= 0) {\n\t\t\tthis.sourceEntity.getRenderSceneTransform(camera).copyRawDataTo(shader.vertexConstantData, shader.sceneMatrixIndex, true);\n\t\t\tviewProjection.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\n\t\t} else {\n\t\t\tvar matrix3D:Matrix3D = Matrix3DUtils.CALCULATION_MATRIX;\n\n\t\t\tmatrix3D.copyFrom(this.sourceEntity.getRenderSceneTransform(camera));\n\t\t\tmatrix3D.append(viewProjection);\n\n\t\t\tmatrix3D.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\n\t\t}\n\n\t\tvar context:IContextGL = this._stage.context;\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 0, shader.vertexConstantData, shader.numUsedVertexConstants);\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, shader.fragmentConstantData, shader.numUsedFragmentConstants);\n\n\t\tthis._stage.activateBuffer(0, this.getVertexData(TriangleSubGeometry.POSITION_DATA), this.getVertexOffset(TriangleSubGeometry.POSITION_DATA), TriangleSubGeometry.POSITION_FORMAT);\n\t\tthis._stage.context.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param pool\n\t * @param renderableOwner\n\t * @param level\n\t * @param indexOffset\n\t * @returns {away.pool.TriangleSubMeshRenderable}\n\t * @protected\n\t */\n\tpublic _pGetOverflowRenderable(indexOffset:number):RenderableBase\n\t{\n\t\treturn new TriangleSubMeshRenderable(this._pool, <TriangleSubMesh> this.renderableOwner, this._stage, this._level + 1, indexOffset);\n\t}\n}\n\nexport = TriangleSubMeshRenderable;","import Matrix3DUtils\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\n\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\n\n/**\n *  Class Merge merges two or more static meshes into one.<code>Merge</code>\n */\nclass Merge\n{\n\n\t//private const LIMIT:uint = 196605;\n\tprivate _objectSpace:boolean;\n\tprivate _keepMaterial:boolean;\n\tprivate _disposeSources:boolean;\n\tprivate _geomVOs:Array<GeometryVO>;\n\tprivate _toDispose:Array<Mesh>;\n\n\t/**\n\t * @param    keepMaterial    [optional]    Determines if the merged object uses the recevier mesh material information or keeps its source material(s). Defaults to false.\n\t * If false and receiver object has multiple materials, the last material found in receiver submeshes is applied to the merged submesh(es).\n\t * @param    disposeSources  [optional]    Determines if the mesh and geometry source(s) used for the merging are disposed. Defaults to false.\n\t * If true, only receiver geometry and resulting mesh are kept in  memory.\n\t * @param    objectSpace     [optional]    Determines if source mesh(es) is/are merged using objectSpace or worldspace. Defaults to false.\n\t */\n\tconstructor(keepMaterial:boolean = false, disposeSources:boolean = false, objectSpace:boolean = false)\n\t{\n\t\tthis._keepMaterial = keepMaterial;\n\t\tthis._disposeSources = disposeSources;\n\t\tthis._objectSpace = objectSpace;\n\t}\n\n\t/**\n\t * Determines if the mesh and geometry source(s) used for the merging are disposed. Defaults to false.\n\t */\n\tpublic set disposeSources(b:boolean)\n\t{\n\t\tthis._disposeSources = b;\n\t}\n\n\tpublic get disposeSources():boolean\n\t{\n\t\treturn this._disposeSources;\n\t}\n\n\t/**\n\t * Determines if the material source(s) used for the merging are disposed. Defaults to false.\n\t */\n\tpublic set keepMaterial(b:boolean)\n\t{\n\t\tthis._keepMaterial = b;\n\t}\n\n\tpublic get keepMaterial():boolean\n\t{\n\t\treturn this._keepMaterial;\n\t}\n\n\t/**\n\t * Determines if source mesh(es) is/are merged using objectSpace or worldspace. Defaults to false.\n\t */\n\tpublic set objectSpace(b:boolean)\n\t{\n\t\tthis._objectSpace = b;\n\t}\n\n\tpublic get objectSpace():boolean\n\t{\n\t\treturn this._objectSpace;\n\t}\n\n\t/**\n\t * Merges all the children of a container into a single Mesh. If no Mesh object is found, method returns the receiver without modification.\n\t *\n\t * @param    receiver           The Mesh to receive the merged contents of the container.\n\t * @param    objectContainer    The DisplayObjectContainer holding the meshes to be mergd.\n\t *\n\t * @return The merged Mesh instance.\n\t */\n\tpublic applyToContainer(receiver:Mesh, objectContainer:DisplayObjectContainer)\n\t{\n\t\tthis.reset();\n\n\t\t//collect container meshes\n\t\tthis.parseContainer(receiver, objectContainer);\n\n\t\t//collect receiver\n\t\tthis.collect(receiver, false);\n\n\t\t//merge to receiver\n\t\tthis.merge(receiver, this._disposeSources);\n\t}\n\n\t/**\n\t * Merges all the meshes found in the Array&lt;Mesh&gt; into a single Mesh.\n\t *\n\t * @param    receiver    The Mesh to receive the merged contents of the meshes.\n\t * @param    meshes      A series of Meshes to be merged with the reciever mesh.\n\t */\n\tpublic applyToMeshes(receiver:Mesh, meshes:Array<Mesh>)\n\t{\n\t\tthis.reset();\n\n\t\tif (!meshes.length)\n\t\t\treturn;\n\n\t\t//collect meshes in vector\n\t\tfor (var i:number /*uint*/ = 0; i < meshes.length; i++)\n\t\t\tif (meshes[i] != receiver)\n\t\t\t\tthis.collect(meshes[i], this._disposeSources);\n\n\t\t//collect receiver\n\t\tthis.collect(receiver, false);\n\n\t\t//merge to receiver\n\t\tthis.merge(receiver, this._disposeSources);\n\t}\n\n\t/**\n\t *  Merges 2 meshes into one. It is recommand to use apply when 2 meshes are to be merged. If more need to be merged, use either applyToMeshes or applyToContainer methods.\n\t *\n\t * @param    receiver    The Mesh to receive the merged contents of both meshes.\n\t * @param    mesh        The Mesh to be merged with the receiver mesh\n\t */\n\tpublic apply(receiver:Mesh, mesh:Mesh)\n\t{\n\t\tthis.reset();\n\n\t\t//collect mesh\n\t\tthis.collect(mesh, this._disposeSources);\n\n\t\t//collect receiver\n\t\tthis.collect(receiver, false);\n\n\t\t//merge to receiver\n\t\tthis.merge(receiver, this._disposeSources);\n\t}\n\n\tprivate reset()\n\t{\n\t\tthis._toDispose  = new Array<Mesh>();\n\t\tthis._geomVOs = new Array<GeometryVO>();\n\t}\n\n\tprivate merge(destMesh:Mesh, dispose:boolean)\n\t{\n\t\tvar i:number /*uint*/;\n\t\tvar subIdx:number /*uint*/;\n\t\tvar oldGeom:Geometry;\n\t\tvar destGeom:Geometry;\n\t\tvar useSubMaterials:boolean;\n\n\t\toldGeom = destMesh.geometry;\n\t\tdestGeom = destMesh.geometry = new Geometry();\n\t\tsubIdx = destMesh.subMeshes.length;\n\n\t\t// Only apply materials directly to sub-meshes if necessary,\n\t\t// i.e. if there is more than one material available.\n\t\tuseSubMaterials = (this._geomVOs.length > 1);\n\n\t\tfor (i = 0; i < this._geomVOs.length; i++) {\n\t\t\tvar s:number /*uint*/;\n\t\t\tvar data:GeometryVO;\n\t\t\tvar sub:TriangleSubGeometry = new TriangleSubGeometry(true);\n\t\t\tsub.autoDeriveNormals = false;\n\t\t\tsub.autoDeriveTangents = false;\n\n\t\t\tdata = this._geomVOs[i];\n\t\t\tsub.updateIndices(data.indices);\n\t\t\tsub.updatePositions(data.vertices);\n\t\t\tsub.updateVertexNormals(data.normals);\n\t\t\tsub.updateVertexTangents(data.tangents);\n\t\t\tsub.updateUVs(data.uvs);\n\n\t\t\tdestGeom.addSubGeometry(sub);\n\n\t\t\tif (this._keepMaterial && useSubMaterials)\n\t\t\t\tdestMesh.subMeshes[subIdx].material = data.material;\n\t\t}\n\n\t\tif (this._keepMaterial && !useSubMaterials && this._geomVOs.length)\n\t\t\tdestMesh.material = this._geomVOs[0].material;\n\n\t\tif (dispose) {\n\t\t\tvar m:Mesh;\n\t\t\tvar len:number = this._toDispose.length;\n\t\t\tfor (var i:number; i < len; i++) {\n\t\t\t\tm = this._toDispose[i];\n\t\t\t\tm.geometry.dispose();\n\t\t\t\tm.dispose();\n\t\t\t}\n\n\t\t\t//dispose of the original receiver geometry\n\t\t\toldGeom.dispose();\n\t\t}\n\n\t\tthis._toDispose = null;\n\t}\n\n\tprivate collect(mesh:Mesh, dispose:boolean)\n\t{\n\t\tif (mesh.geometry) {\n\t\t\tvar subIdx:number /*uint*/;\n\t\t\tvar subGeometries:Array<TriangleSubGeometry> = <Array<TriangleSubGeometry>> mesh.geometry.subGeometries;\n\t\t\tvar calc:number /*uint*/;\n\t\t\tfor (subIdx = 0; subIdx < subGeometries.length; subIdx++) {\n\t\t\t\tvar i:number /*uint*/;\n\t\t\t\tvar len:number /*uint*/;\n\t\t\t\tvar iIdx:number /*uint*/, vIdx:number /*uint*/, nIdx:number /*uint*/, tIdx:number /*uint*/, uIdx:number /*uint*/;\n\t\t\t\tvar indexOffset:number /*uint*/;\n\t\t\t\tvar subGeom:TriangleSubGeometry;\n\t\t\t\tvar vo:GeometryVO;\n\t\t\t\tvar vertices:Array<number>;\n\t\t\t\tvar normals:Array<number>;\n\t\t\t\tvar tangents:Array<number>;\n\t\t\t\tvar pd:Array<number>, nd:Array<number>, td:Array<number>, ud:Array<number>;\n\n\t\t\t\tsubGeom = subGeometries[subIdx];\n\t\t\t\tpd = subGeom.positions;\n\t\t\t\tnd = subGeom.vertexNormals;\n\t\t\t\ttd = subGeom.vertexTangents;\n\t\t\t\tud = subGeom.uvs;\n\n\t\t\t\t// Get (or create) a VO for this material\n\t\t\t\tvo = this.getSubGeomData(mesh.subMeshes[subIdx].material || mesh.material);\n\n\t\t\t\t// Vertices and normals are copied to temporary vectors, to be transformed\n\t\t\t\t// before concatenated onto those of the data. This is unnecessary if no\n\t\t\t\t// transformation will be performed, i.e. for object space merging.\n\t\t\t\tvertices = (this._objectSpace)? vo.vertices : new Array<number>();\n\t\t\t\tnormals = (this._objectSpace)? vo.normals : new Array<number>();\n\t\t\t\ttangents = (this._objectSpace)? vo.tangents : new Array<number>();\n\n\t\t\t\t// Copy over vertex attributes\n\t\t\t\tvIdx = vertices.length;\n\t\t\t\tnIdx = normals.length;\n\t\t\t\ttIdx = tangents.length;\n\t\t\t\tuIdx = vo.uvs.length;\n\t\t\t\tlen = subGeom.numVertices;\n\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\tcalc = i*3;\n\n\t\t\t\t\t// Position\n\t\t\t\t\tvertices[vIdx++] = pd[calc];\n\t\t\t\t\tvertices[vIdx++] = pd[calc + 1];\n\t\t\t\t\tvertices[vIdx++] = pd[calc + 2];\n\n\t\t\t\t\t// Normal\n\t\t\t\t\tnormals[nIdx++] = nd[calc];\n\t\t\t\t\tnormals[nIdx++] = nd[calc + 1];\n\t\t\t\t\tnormals[nIdx++] = nd[calc + 2];\n\n\t\t\t\t\t// Tangent\n\t\t\t\t\ttangents[tIdx++] = td[calc];\n\t\t\t\t\ttangents[tIdx++] = td[calc + 1];\n\t\t\t\t\ttangents[tIdx++] = td[calc + 2];\n\n\t\t\t\t\t// UV\n\t\t\t\t\tvo.uvs[uIdx++] = ud[i*2];\n\t\t\t\t\tvo.uvs[uIdx++] = ud[i*2 + 1];\n\t\t\t\t}\n\n\t\t\t\t// Copy over triangle indices\n\t\t\t\tindexOffset = (!this._objectSpace)? vo.vertices.length/3 :0;\n\t\t\t\tiIdx = vo.indices.length;\n\t\t\t\tlen = subGeom.numTriangles;\n\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\tcalc = i*3;\n\t\t\t\t\tvo.indices[iIdx++] = subGeom.indices[calc] + indexOffset;\n\t\t\t\t\tvo.indices[iIdx++] = subGeom.indices[calc + 1] + indexOffset;\n\t\t\t\t\tvo.indices[iIdx++] = subGeom.indices[calc + 2] + indexOffset;\n\t\t\t\t}\n\n\t\t\t\tif (!this._objectSpace) {\n\t\t\t\t\tmesh.sceneTransform.transformVectors(vertices, vertices);\n\t\t\t\t\tMatrix3DUtils.deltaTransformVectors(mesh.sceneTransform, normals, normals);\n\t\t\t\t\tMatrix3DUtils.deltaTransformVectors(mesh.sceneTransform, tangents, tangents);\n\n\t\t\t\t\t// Copy vertex data from temporary (transformed) vectors\n\t\t\t\t\tvIdx = vo.vertices.length;\n\t\t\t\t\tnIdx = vo.normals.length;\n\t\t\t\t\ttIdx = vo.tangents.length;\n\t\t\t\t\tlen = vertices.length;\n\t\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\t\tvo.vertices[vIdx++] = vertices[i];\n\t\t\t\t\t\tvo.normals[nIdx++] = normals[i];\n\t\t\t\t\t\tvo.tangents[tIdx++] = tangents[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (dispose)\n\t\t\t\tthis._toDispose.push(mesh);\n\t\t}\n\t}\n\n\tprivate getSubGeomData(material:MaterialBase):GeometryVO\n\t{\n\t\tvar data:GeometryVO;\n\n\t\tif (this._keepMaterial) {\n\t\t\tvar i:number /*uint*/;\n\t\t\tvar len:number /*uint*/;\n\n\t\t\tlen = this._geomVOs.length;\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tif (this._geomVOs[i].material == material) {\n\t\t\t\t\tdata = this._geomVOs[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (this._geomVOs.length) {\n\t\t\t// If materials are not to be kept, all data can be\n\t\t\t// put into a single VO, so return that one.\n\t\t\tdata = this._geomVOs[0];\n\t\t}\n\n\t\t// No data (for this material) found, create new.\n\t\tif (!data) {\n\t\t\tdata = new GeometryVO();\n\t\t\tdata.vertices = new Array<number>();\n\t\t\tdata.normals = new Array<number>();\n\t\t\tdata.tangents = new Array<number>();\n\t\t\tdata.uvs = new Array<number>();\n\t\t\tdata.indices = new Array<number /*uint*/>();\n\t\t\tdata.material = material;\n\n\t\t\tthis._geomVOs.push(data);\n\t\t}\n\n\t\treturn data;\n\t}\n\n\tprivate parseContainer(receiver:Mesh, object:DisplayObjectContainer)\n\t{\n\t\tvar child:DisplayObjectContainer;\n\t\tvar i:number /*uint*/;\n\n\t\tif (object instanceof Mesh && object != (<DisplayObjectContainer> receiver))\n\t\t\tthis.collect(<Mesh> object, this._disposeSources);\n\n\t\tfor (i = 0; i < object.numChildren; ++i) {\n\t\t\tchild = <DisplayObjectContainer> object.getChildAt(i);\n\t\t\tthis.parseContainer(receiver, child);\n\t\t}\n\t}\n}\n\nexport = Merge;\n\nclass GeometryVO\n{\n\tpublic uvs:Array<number>;\n\tpublic vertices:Array<number>;\n\tpublic normals:Array<number>;\n\tpublic tangents:Array<number>;\n\tpublic indices:Array<number /*uint*/>;\n\tpublic material:MaterialBase;\n}\n","import Matrix\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\n\n/**\n * ...\n */\nclass ParticleGeometryTransform\n{\n\tprivate _defaultVertexTransform:Matrix3D;\n\tprivate _defaultInvVertexTransform:Matrix3D;\n\tprivate _defaultUVTransform:Matrix;\n\n\tpublic set vertexTransform(value:Matrix3D)\n\t{\n\t\tthis._defaultVertexTransform = value;\n\t\tthis._defaultInvVertexTransform = value.clone();\n\t\tthis._defaultInvVertexTransform.invert();\n\t\tthis._defaultInvVertexTransform.transpose();\n\t}\n\n\tpublic set UVTransform(value:Matrix)\n\t{\n\t\tthis._defaultUVTransform = value;\n\t}\n\n\tpublic get UVTransform():Matrix\n\t{\n\t\treturn this._defaultUVTransform;\n\t}\n\n\tpublic get vertexTransform():Matrix3D\n\t{\n\t\treturn this._defaultVertexTransform;\n\t}\n\n\tpublic get invVertexTransform():Matrix3D\n\t{\n\t\treturn this._defaultInvVertexTransform;\n\t}\n}\n\nexport = ParticleGeometryTransform;","import Matrix\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Point\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\n\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\n\nimport ParticleData\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleData\");\nimport ParticleGeometry\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/ParticleGeometry\");\nimport ParticleGeometryTransform\t\t= require(\"awayjs-renderergl/lib/tools/data/ParticleGeometryTransform\");\n\n/**\n * ...\n */\nclass ParticleGeometryHelper\n{\n\tpublic static MAX_VERTEX:number /*int*/ = 65535;\n\n\tpublic static generateGeometry(geometries:Array<Geometry>, transforms:Array<ParticleGeometryTransform> = null):ParticleGeometry\n\t{\n\t\tvar indicesVector:Array<Array<number>> /*uint*/ = new Array<Array<number>>() /*uint*/;\n\t\tvar positionsVector:Array<Array<number>> = new Array<Array<number>>();\n\t\tvar normalsVector:Array<Array<number>> = new Array<Array<number>>();\n\t\tvar tangentsVector:Array<Array<number>> = new Array<Array<number>>();\n\t\tvar uvsVector:Array<Array<number>> = new Array<Array<number>>();\n\t\tvar vertexCounters:Array<number> /*uint*/ = new Array<number>() /*uint*/;\n\t\tvar particles:Array<ParticleData> = new Array<ParticleData>();\n\t\tvar subGeometries:Array<TriangleSubGeometry> = new Array<TriangleSubGeometry>();\n\t\tvar numParticles:number /*uint*/ = geometries.length;\n\n\t\tvar sourceSubGeometries:Array<TriangleSubGeometry>;\n\t\tvar sourceSubGeometry:TriangleSubGeometry;\n\t\tvar numSubGeometries:number /*uint*/;\n\t\tvar indices:Array<number> /*uint*/;\n\t\tvar positions:Array<number>;\n\t\tvar normals:Array<number>;\n\t\tvar tangents:Array<number>;\n\t\tvar uvs:Array<number>;\n\t\tvar vertexCounter:number /*uint*/;\n\t\tvar subGeometry:TriangleSubGeometry;\n\t\tvar i:number /*int*/;\n\t\tvar j:number /*int*/;\n\t\tvar sub2SubMap:Array<number> /*int*/ = new Array<number>() /*int*/;\n\n\t\tvar tempVertex:Vector3D = new Vector3D;\n\t\tvar tempNormal:Vector3D = new Vector3D;\n\t\tvar tempTangents:Vector3D = new Vector3D;\n\t\tvar tempUV:Point = new Point;\n\n\t\tfor (i = 0; i < numParticles; i++) {\n\t\t\tsourceSubGeometries = <Array<TriangleSubGeometry>> geometries[i].subGeometries;\n\t\t\tnumSubGeometries = sourceSubGeometries.length;\n\t\t\tfor (var srcIndex:number /*int*/ = 0; srcIndex < numSubGeometries; srcIndex++) {\n\t\t\t\t//create a different particle subgeometry group for each source subgeometry in a particle.\n\t\t\t\tif (sub2SubMap.length <= srcIndex) {\n\t\t\t\t\tsub2SubMap.push(subGeometries.length);\n\t\t\t\t\tindicesVector.push(new Array<number>() /*uint*/);\n\t\t\t\t\tpositionsVector.push(new Array<number>());\n\t\t\t\t\tnormalsVector.push(new Array<number>());\n\t\t\t\t\ttangentsVector.push(new Array<number>());\n\t\t\t\t\tuvsVector.push(new Array<number>());\n\t\t\t\t\tsubGeometries.push(new TriangleSubGeometry(true));\n\t\t\t\t\tvertexCounters.push(0);\n\t\t\t\t}\n\n\t\t\t\tsourceSubGeometry = sourceSubGeometries[srcIndex];\n\n\t\t\t\t//add a new particle subgeometry if this source subgeometry will take us over the maxvertex limit\n\t\t\t\tif (sourceSubGeometry.numVertices + vertexCounters[sub2SubMap[srcIndex]] > ParticleGeometryHelper.MAX_VERTEX) {\n\t\t\t\t\t//update submap and add new subgeom vectors\n\t\t\t\t\tsub2SubMap[srcIndex] = subGeometries.length;\n\t\t\t\t\tindicesVector.push(new Array<number>() /*uint*/);\n\t\t\t\t\tpositionsVector.push(new Array<number>());\n\t\t\t\t\tnormalsVector.push(new Array<number>());\n\t\t\t\t\ttangentsVector.push(new Array<number>());\n\t\t\t\t\tuvsVector.push(new Array<number>());\n\t\t\t\t\tsubGeometries.push(new TriangleSubGeometry(true));\n\t\t\t\t\tvertexCounters.push(0);\n\t\t\t\t}\n\n\t\t\t\tj = sub2SubMap[srcIndex];\n\n\t\t\t\t//select the correct vector\n\t\t\t\tindices = indicesVector[j];\n\t\t\t\tpositions = positionsVector[j];\n\t\t\t\tnormals = normalsVector[j];\n\t\t\t\ttangents = tangentsVector[j];\n\t\t\t\tuvs = uvsVector[j];\n\t\t\t\tvertexCounter = vertexCounters[j];\n\t\t\t\tsubGeometry = subGeometries[j];\n\n\t\t\t\tvar particleData:ParticleData = new ParticleData();\n\t\t\t\tparticleData.numVertices = sourceSubGeometry.numVertices;\n\t\t\t\tparticleData.startVertexIndex = vertexCounter;\n\t\t\t\tparticleData.particleIndex = i;\n\t\t\t\tparticleData.subGeometry = subGeometry;\n\t\t\t\tparticles.push(particleData);\n\n\t\t\t\tvertexCounters[j] += sourceSubGeometry.numVertices;\n\n\t\t\t\tvar k:number /*int*/;\n\t\t\t\tvar tempLen:number /*int*/;\n\t\t\t\tvar compact:TriangleSubGeometry = sourceSubGeometry;\n\t\t\t\tvar product:number /*uint*/;\n\t\t\t\tvar sourcePositions:Array<number>;\n\t\t\t\tvar sourceNormals:Array<number>;\n\t\t\t\tvar sourceTangents:Array<number>;\n\t\t\t\tvar sourceUVs:Array<number>;\n\n\t\t\t\tif (compact) {\n\t\t\t\t\ttempLen = compact.numVertices;\n\t\t\t\t\tcompact.numTriangles;\n\t\t\t\t\tsourcePositions = compact.positions;\n\t\t\t\t\tsourceNormals = compact.vertexNormals;\n\t\t\t\t\tsourceTangents = compact.vertexTangents;\n\t\t\t\t\tsourceUVs = compact.uvs;\n\n\t\t\t\t\tif (transforms) {\n\t\t\t\t\t\tvar particleGeometryTransform:ParticleGeometryTransform = transforms[i];\n\t\t\t\t\t\tvar vertexTransform:Matrix3D = particleGeometryTransform.vertexTransform;\n\t\t\t\t\t\tvar invVertexTransform:Matrix3D = particleGeometryTransform.invVertexTransform;\n\t\t\t\t\t\tvar UVTransform:Matrix = particleGeometryTransform.UVTransform;\n\n\t\t\t\t\t\tfor (k = 0; k < tempLen; k++) {\n\t\t\t\t\t\t\t/*\n\t\t\t\t\t\t\t * 0 - 2: vertex position X, Y, Z\n\t\t\t\t\t\t\t * 3 - 5: normal X, Y, Z\n\t\t\t\t\t\t\t * 6 - 8: tangent X, Y, Z\n\t\t\t\t\t\t\t * 9 - 10: U V\n\t\t\t\t\t\t\t * 11 - 12: Secondary U V*/\n\t\t\t\t\t\t\tproduct = k*3;\n\t\t\t\t\t\t\ttempVertex.x = sourcePositions[product];\n\t\t\t\t\t\t\ttempVertex.y = sourcePositions[product + 1];\n\t\t\t\t\t\t\ttempVertex.z = sourcePositions[product + 2];\n\t\t\t\t\t\t\ttempNormal.x = sourceNormals[product];\n\t\t\t\t\t\t\ttempNormal.y = sourceNormals[product + 1];\n\t\t\t\t\t\t\ttempNormal.z = sourceNormals[product + 2];\n\t\t\t\t\t\t\ttempTangents.x = sourceTangents[product];\n\t\t\t\t\t\t\ttempTangents.y = sourceTangents[product + 1];\n\t\t\t\t\t\t\ttempTangents.z = sourceTangents[product + 2];\n\t\t\t\t\t\t\ttempUV.x = sourceUVs[k*2];\n\t\t\t\t\t\t\ttempUV.y = sourceUVs[k*2 + 1];\n\t\t\t\t\t\t\tif (vertexTransform) {\n\t\t\t\t\t\t\t\ttempVertex = vertexTransform.transformVector(tempVertex);\n\t\t\t\t\t\t\t\ttempNormal = invVertexTransform.deltaTransformVector(tempNormal);\n\t\t\t\t\t\t\t\ttempTangents = invVertexTransform.deltaTransformVector(tempNormal);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (UVTransform)\n\t\t\t\t\t\t\t\ttempUV = UVTransform.transformPoint(tempUV);\n\t\t\t\t\t\t\t//this is faster than that only push one data\n\t\t\t\t\t\t\tsourcePositions.push(tempVertex.x, tempVertex.y, tempVertex.z);\n\t\t\t\t\t\t\tsourceNormals.push(tempNormal.x, tempNormal.y, tempNormal.z);\n\t\t\t\t\t\t\tsourceTangents.push(tempTangents.x, tempTangents.y, tempTangents.z);\n\t\t\t\t\t\t\tsourceUVs.push(tempUV.x, tempUV.y);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (k = 0; k < tempLen; k++) {\n\t\t\t\t\t\t\tproduct = k*3;\n\t\t\t\t\t\t\t//this is faster than that only push one data\n\t\t\t\t\t\t\tpositions.push(sourcePositions[product], sourcePositions[product + 1], sourcePositions[product + 2]);\n\t\t\t\t\t\t\tnormals.push(sourceNormals[product], sourceNormals[product + 1], sourceNormals[product + 2]);\n\t\t\t\t\t\t\ttangents.push(sourceTangents[product], sourceTangents[product + 1], sourceTangents[product + 2]);\n\t\t\t\t\t\t\tuvs.push(sourceUVs[k*2], sourceUVs[k*2 + 1]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t//Todo\n\t\t\t\t}\n\n\t\t\t\tvar sourceIndices:Array<number> /*uint*/ = sourceSubGeometry.indices;\n\t\t\t\ttempLen = sourceSubGeometry.numTriangles;\n\t\t\t\tfor (k = 0; k < tempLen; k++) {\n\t\t\t\t\tproduct = k*3;\n\t\t\t\t\tindices.push(sourceIndices[product] + vertexCounter, sourceIndices[product + 1] + vertexCounter, sourceIndices[product + 2] + vertexCounter);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar particleGeometry:ParticleGeometry = new ParticleGeometry();\n\t\tparticleGeometry.particles = particles;\n\t\tparticleGeometry.numParticles = numParticles;\n\n\t\tnumParticles = subGeometries.length;\n\t\tfor (i = 0; i < numParticles; i++) {\n\t\t\tsubGeometry = subGeometries[i];\n\t\t\tsubGeometry.autoDeriveNormals = false;\n\t\t\tsubGeometry.autoDeriveTangents = false;\n\t\t\tsubGeometry.updateIndices(indicesVector[i]);\n\t\t\tsubGeometry.updatePositions(positionsVector[i]);\n\t\t\tsubGeometry.updateVertexNormals(normalsVector[i]);\n\t\t\tsubGeometry.updateVertexTangents(tangentsVector[i]);\n\t\t\tsubGeometry.updateUVs(uvsVector[i]);\n\t\t\tparticleGeometry.addSubGeometry(subGeometry);\n\t\t}\n\n\t\treturn particleGeometry;\n\t}\n}\n\nexport = ParticleGeometryHelper;","import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\n\n/**\n *\n */\nclass PerspectiveMatrix3D extends Matrix3D\n{\n\tconstructor(v:Array<number> = null)\n\t{\n\t\tsuper(v);\n\t}\n\n\tpublic perspectiveFieldOfViewLH(fieldOfViewY:number, aspectRatio:number, zNear:number, zFar:number)\n\t{\n\t\tvar yScale:number = 1/Math.tan(fieldOfViewY/2);\n\t\tvar xScale:number = yScale/aspectRatio;\n\n\t\tthis.copyRawDataFrom([xScale, 0.0, 0.0, 0.0, 0.0, yScale, 0.0, 0.0, 0.0, 0.0, zFar/(zFar - zNear), 1.0, 0.0, 0.0, (zNear*zFar)/(zNear - zFar), 0.0]);\n\t}\n}\n\nexport = PerspectiveMatrix3D;","import TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nimport ContextGLTextureFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFormat\");\n\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\n\nclass ShaderCompilerHelper\n{\n\t/**\n\t * A helper method that generates standard code for sampling from a texture using the normal uv coordinates.\n\t * @param vo The MethodVO object linking this method with the pass currently being compiled.\n\t * @param sharedReg The shared register object for the shader.\n\t * @param inputReg The texture stream register.\n\t * @param texture The texture which will be assigned to the given slot.\n\t * @param uvReg An optional uv register if coordinates different from the primary uv coordinates are to be used.\n\t * @param forceWrap If true, texture wrapping is enabled regardless of the material setting.\n\t * @return The fragment code that performs the sampling.\n\t *\n\t * @protected\n\t */\n\tpublic static getTex2DSampleCode(targetReg:ShaderRegisterElement, sharedReg:ShaderRegisterData, inputReg:ShaderRegisterElement, texture:TextureProxyBase, smooth:boolean, repeat:boolean, mipmaps:boolean, uvReg:ShaderRegisterElement = null, forceWrap:string = null):string\n\t{\n\t\tvar wrap:string = forceWrap || (repeat? \"wrap\":\"clamp\");\n\t\tvar format:string = ShaderCompilerHelper.getFormatStringForTexture(texture);\n\t\tvar filter:string = (smooth)? (mipmaps? \"linear,miplinear\" : \"linear\") : (mipmaps? \"nearest,mipnearest\" : \"nearest\");\n\n\t\tif (uvReg == null)\n\t\t\tuvReg = sharedReg.uvVarying;\n\n\t\treturn \"tex \" + targetReg + \", \" + uvReg + \", \" + inputReg + \" <2d,\" + filter + \",\" + format + wrap + \">\\n\";\n\n\t}\n\n\n\t/**\n\t * A helper method that generates standard code for sampling from a cube texture.\n\t * @param vo The MethodVO object linking this method with the pass currently being compiled.\n\t * @param targetReg The register in which to store the sampled colour.\n\t * @param inputReg The texture stream register.\n\t * @param texture The cube map which will be assigned to the given slot.\n\t * @param uvReg The direction vector with which to sample the cube map.\n\t *\n\t * @protected\n\t */\n\tpublic static getTexCubeSampleCode(targetReg:ShaderRegisterElement, inputReg:ShaderRegisterElement, texture:TextureProxyBase, smooth:boolean, mipmaps:boolean, uvReg:ShaderRegisterElement):string\n\t{\n\t\tvar filter:string;\n\t\tvar format:string = ShaderCompilerHelper.getFormatStringForTexture(texture);\n\t\tvar filter:string = (smooth)? (mipmaps? \"linear,miplinear\" : \"linear\") : (mipmaps? \"nearest,mipnearest\" : \"nearest\");\n\n\t\treturn \"tex \" + targetReg + \", \" + uvReg + \", \" + inputReg + \" <cube,\" + format + filter + \">\\n\";\n\t}\n\n\t/**\n\t * Generates a texture format string for the sample instruction.\n\t * @param texture The texture for which to get the format string.\n\t * @return\n\t *\n\t * @protected\n\t */\n\tpublic static getFormatStringForTexture(texture:TextureProxyBase):string\n\t{\n\t\tswitch (texture.format) {\n\t\t\tcase ContextGLTextureFormat.COMPRESSED:\n\t\t\t\treturn \"dxt1,\";\n\t\t\t\tbreak;\n\t\t\tcase ContextGLTextureFormat.COMPRESSED_ALPHA:\n\t\t\t\treturn \"dxt5,\";\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn \"\";\n\t\t}\n\t}\n}\n\nexport = ShaderCompilerHelper;","import ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport Description\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Description\");\nimport Header\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Header\");\nimport Mapping\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Mapping\");\nimport Token\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Token\");\n\nclass AGALTokenizer\n{\n\tconstructor()\n\t{\n\t}\n\n\tpublic decribeAGALByteArray(bytes:ByteArray)\n\t{\n\t\tvar header:Header = new Header();\n\n\t\tif (bytes.readUnsignedByte() != 0xa0) {\n\t\t\tthrow \"Bad AGAL: Missing 0xa0 magic byte.\";\n\t\t}\n\n\t\theader.version = bytes.readUnsignedInt();\n\t\tif (header.version >= 0x10) {\n\t\t\tbytes.readUnsignedByte();\n\t\t\theader.version >>= 1;\n\t\t}\n\t\tif (bytes.readUnsignedByte() != 0xa1) {\n\t\t\tthrow \"Bad AGAL: Missing 0xa1 magic byte.\";\n\t\t}\n\n\t\theader.progid = bytes.readUnsignedByte();\n\t\tswitch (header.progid) {\n\t\t\tcase 1:\n\t\t\t\theader.type = \"fragment\";\n\t\t\t\tbreak;\n\t\t\tcase 0:\n\t\t\t\theader.type = \"vertex\";\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\theader.type = \"cpu\";\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\theader.type = \"\";\n\t\t\t\tbreak;\n\t\t}\n\n\t\tvar desc:Description = new Description();\n\t\tvar tokens:Token[] = [];\n\t\twhile (bytes.position < bytes.length) {\n\t\t\tvar token:Token = new Token();\n\n\t\t\ttoken.opcode = bytes.readUnsignedInt();\n\t\t\tvar lutentry = Mapping.agal2glsllut[token.opcode];\n\t\t\tif (!lutentry) {\n\t\t\t\tthrow \"Opcode not valid or not implemented yet: \" + token.opcode;\n\t\t\t}\n\t\t\tif (lutentry.matrixheight) {\n\t\t\t\tdesc.hasmatrix = true;\n\t\t\t}\n\t\t\tif (lutentry.dest) {\n\t\t\t\ttoken.dest.regnum = bytes.readUnsignedShort();\n\t\t\t\ttoken.dest.mask = bytes.readUnsignedByte();\n\t\t\t\ttoken.dest.regtype = bytes.readUnsignedByte();\n\t\t\t\tdesc.regwrite[token.dest.regtype][token.dest.regnum] |= token.dest.mask;\n\t\t\t} else {\n\t\t\t\ttoken.dest = null;\n\t\t\t\tbytes.readUnsignedInt();\n\t\t\t}\n\t\t\tif (lutentry.a) {\n\t\t\t\tthis.readReg(token.a, 1, desc, bytes);\n\t\t\t} else {\n\t\t\t\ttoken.a = null;\n\t\t\t\tbytes.readUnsignedInt();\n\t\t\t\tbytes.readUnsignedInt();\n\t\t\t}\n\t\t\tif (lutentry.b) {\n\t\t\t\tthis.readReg(token.b, lutentry.matrixheight | 0, desc, bytes);\n\t\t\t} else {\n\t\t\t\ttoken.b = null;\n\t\t\t\tbytes.readUnsignedInt();\n\t\t\t\tbytes.readUnsignedInt();\n\t\t\t}\n\t\t\ttokens.push(token);\n\t\t}\n\t\tdesc.header = header;\n\t\tdesc.tokens = tokens;\n\n\t\treturn desc;\n\t}\n\n\tpublic readReg(s, mh, desc, bytes)\n\t{\n\t\ts.regnum = bytes.readUnsignedShort();\n\t\ts.indexoffset = bytes.readByte();\n\t\ts.swizzle = bytes.readUnsignedByte();\n\t\ts.regtype = bytes.readUnsignedByte();\n\t\tdesc.regread[s.regtype][s.regnum] = 0xf; // sould be swizzle to mask? should be |=                                                 \n\t\tif (s.regtype == 0x5) {\n\t\t\t// sampler\n\t\t\ts.lodbiad = s.indexoffset;\n\t\t\ts.indexoffset = undefined;\n\t\t\ts.swizzle = undefined;\n\n\t\t\t// sampler \n\t\t\ts.readmode = bytes.readUnsignedByte();\n\t\t\ts.dim = s.readmode >> 4;\n\t\t\ts.readmode &= 0xf;\n\t\t\ts.special = bytes.readUnsignedByte();\n\t\t\ts.wrap = s.special >> 4;\n\t\t\ts.special &= 0xf;\n\t\t\ts.mipmap = bytes.readUnsignedByte();\n\t\t\ts.filter = s.mipmap >> 4;\n\t\t\ts.mipmap &= 0xf;\n\t\t\tdesc.samplers[s.regnum] = s;\n\t\t} else {\n\t\t\ts.indexregtype = bytes.readUnsignedByte();\n\t\t\ts.indexselect = bytes.readUnsignedByte();\n\t\t\ts.indirectflag = bytes.readUnsignedByte();\n\t\t}\n\t\tif (s.indirectflag) {\n\t\t\tdesc.hasindirect = true;\n\t\t}\n\t\tif (!s.indirectflag && mh) {\n\t\t\tfor (var mhi:number = 0; mhi < mh; mhi++) //TODO wrong, should be |=\n\t\t\t{\n\t\t\t\tdesc.regread[s.regtype][s.regnum + mhi] = desc.regread[s.regtype][s.regnum];\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport = AGALTokenizer;","import Description\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Description\");\nimport Mapping\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Mapping\");\nimport ContextStage3D\t\t\t= require(\"awayjs-stagegl/lib/base/ContextStage3D\");\n\nclass AGLSLParser\n{\n\tpublic parse(desc:Description)\n\t{\n\t\tvar header:string = \"\";\n\t\tvar body:string = \"\";\n\n\t\theader += \"precision highp float;\\n\";\n\t\tvar tag = desc.header.type[0]; //TODO\n\n\t\t// declare uniforms\n\t\tif (desc.header.type == \"vertex\") {\n\t\t\theader += \"uniform float yflip;\\n\";\n\t\t}\n\t\tif (!desc.hasindirect) {\n\t\t\tfor (var i:number = 0; i < desc.regread[0x1].length; i++) {\n\t\t\t\tif (desc.regread[0x1][i]) {\n\t\t\t\t\theader += \"uniform vec4 \" + tag + \"c\" + i + \";\\n\";\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\theader += \"uniform vec4 \" + tag + \"carrr[\" + ContextStage3D.maxvertexconstants + \"];\\n\";                // use max const count instead\n\t\t}\n\n\t\t// declare temps\n\t\tfor (var i = 0; i < desc.regread[0x2].length || i < desc.regwrite[0x2].length; i++) {\n\t\t\tif (desc.regread[0x2][i] || desc.regwrite[0x2][i]) // duh, have to check write only also...\n\t\t\t{\n\t\t\t\theader += \"vec4 \" + tag + \"t\" + i + \";\\n\";\n\t\t\t}\n\t\t}\n\n\t\t// declare streams\n\t\tfor (var i:number = 0; i < desc.regread[0x0].length; i++) {\n\t\t\tif (desc.regread[0x0][i]) {\n\t\t\t\theader += \"attribute vec4 va\" + i + \";\\n\";\n\t\t\t}\n\t\t}\n\n\t\t// declare interpolated\n\t\tfor (var i:number = 0; i < desc.regread[0x4].length || i < desc.regwrite[0x4].length; i++) {\n\t\t\tif (desc.regread[0x4][i] || desc.regwrite[0x4][i]) {\n\t\t\t\theader += \"varying vec4 vi\" + i + \";\\n\";\n\t\t\t}\n\t\t}\n\n\t\t// declare samplers\n\t\tvar samptype:Array<string> = [\"2D\", \"Cube\", \"3D\", \"\"];\n\t\tfor (var i:number = 0; i < desc.samplers.length; i++) {\n\t\t\tif (desc.samplers[i]) {\n\t\t\t\theader += \"uniform sampler\" + samptype[ desc.samplers[i].dim & 3 ] + \" fs\" + i + \";\\n\";\n\t\t\t}\n\t\t}\n\n\t\t// extra gl fluff: setup position and depth adjust temps\n\t\tif (desc.header.type == \"vertex\") {\n\t\t\theader += \"vec4 outpos;\\n\";\n\t\t}\n\t\tif (desc.writedepth) {\n\t\t\theader += \"vec4 tmp_FragDepth;\\n\";\n\t\t}\n\t\t//if ( desc.hasmatrix ) \n\t\t//    header += \"vec4 tmp_matrix;\\n\";\n\n\t\t// start body of code\n\t\tbody += \"void main() {\\n\";\n\n\t\tfor (var i:number = 0; i < desc.tokens.length; i++) {\n\t\t\tvar lutentry = Mapping.agal2glsllut[desc.tokens[i].opcode];\n\t\t\tif (!lutentry) {\n\t\t\t\tthrow \"Opcode not valid or not implemented yet: \"\n\t\t\t\t/*+token.opcode;*/\n\t\t\t}\n\t\t\tvar sublines = lutentry.matrixheight || 1;\n\n\t\t\tfor (var sl:number = 0; sl < sublines; sl++) {\n\t\t\t\tvar line:string = \"  \" + lutentry.s;\n\t\t\t\tif (desc.tokens[i].dest) {\n\t\t\t\t\tif (lutentry.matrixheight) {\n\t\t\t\t\t\tif (((desc.tokens[i].dest.mask >> sl) & 1) != 1) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar destregstring:string = this.regtostring(desc.tokens[i].dest.regtype, desc.tokens[i].dest.regnum, desc, tag);\n\t\t\t\t\t\tvar destcaststring:string = \"float\";\n\t\t\t\t\t\tvar destmaskstring = [\"x\", \"y\", \"z\", \"w\"][sl];\n\t\t\t\t\t\tdestregstring += \".\" + destmaskstring;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar destregstring:string = this.regtostring(desc.tokens[i].dest.regtype, desc.tokens[i].dest.regnum, desc, tag);\n\t\t\t\t\t\tvar destcaststring:string;\n\t\t\t\t\t\tvar destmaskstring:string;\n\t\t\t\t\t\tif (desc.tokens[i].dest.mask != 0xf) {\n\t\t\t\t\t\t\tvar ndest:number = 0;\n\t\t\t\t\t\t\tdestmaskstring = \"\";\n\t\t\t\t\t\t\tif (desc.tokens[i].dest.mask & 1) {\n\t\t\t\t\t\t\t\tndest++;\n\t\t\t\t\t\t\t\tdestmaskstring += \"x\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (desc.tokens[i].dest.mask & 2) {\n\t\t\t\t\t\t\t\tndest++;\n\t\t\t\t\t\t\t\tdestmaskstring += \"y\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (desc.tokens[i].dest.mask & 4) {\n\t\t\t\t\t\t\t\tndest++;\n\t\t\t\t\t\t\t\tdestmaskstring += \"z\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (desc.tokens[i].dest.mask & 8) {\n\t\t\t\t\t\t\t\tndest++;\n\t\t\t\t\t\t\t\tdestmaskstring += \"w\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdestregstring += \".\" + destmaskstring;\n\t\t\t\t\t\t\tswitch (ndest) {\n\t\t\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\t\t\tdestcaststring = \"float\";\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\t\t\tdestcaststring = \"vec2\";\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\t\tdestcaststring = \"vec3\";\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\tthrow \"Unexpected destination mask\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdestcaststring = \"vec4\";\n\t\t\t\t\t\t\tdestmaskstring = \"xyzw\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tline = line.replace(\"%dest\", destregstring);\n\t\t\t\t\tline = line.replace(\"%cast\", destcaststring);\n\t\t\t\t\tline = line.replace(\"%dm\", destmaskstring);\n\t\t\t\t}\n\t\t\t\tvar dwm:number = 0xf;\n\t\t\t\tif (!lutentry.ndwm && lutentry.dest && desc.tokens[i].dest) {\n\t\t\t\t\tdwm = desc.tokens[i].dest.mask;\n\t\t\t\t}\n\t\t\t\tif (desc.tokens[i].a) {\n\t\t\t\t\tline = line.replace(\"%a\", this.sourcetostring(desc.tokens[i].a, 0, dwm, lutentry.scalar, desc, tag));\n\t\t\t\t}\n\t\t\t\tif (desc.tokens[i].b) {\n\t\t\t\t\tline = line.replace(\"%b\", this.sourcetostring(desc.tokens[i].b, sl, dwm, lutentry.scalar, desc, tag));\n\t\t\t\t\tif (desc.tokens[i].b.regtype == 0x5) {\n\t\t\t\t\t\t// sampler dim\n\t\t\t\t\t\tvar texdim = [\"2D\", \"Cube\", \"3D\"][desc.tokens[i].b.dim];\n\t\t\t\t\t\tvar texsize = [\"vec2\", \"vec3\", \"vec3\"][desc.tokens[i].b.dim];\n\t\t\t\t\t\tline = line.replace(\"%texdim\", texdim);\n\t\t\t\t\t\tline = line.replace(\"%texsize\", texsize);\n\t\t\t\t\t\tvar texlod:string = \"\";\n\t\t\t\t\t\tline = line.replace(\"%lod\", texlod);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbody += line;\n\t\t\t}\n\t\t}\n\n\t\t// adjust z from opengl range of -1..1 to 0..1 as in d3d, this also enforces a left handed coordinate system\n\t\tif (desc.header.type == \"vertex\") {\n\t\t\tbody += \"  gl_Position = vec4(outpos.x, outpos.y, outpos.z*2.0 - outpos.w, outpos.w);\\n\";\n\t\t}\n\n\t\t// clamp fragment depth\n\t\tif (desc.writedepth) {\n\t\t\tbody += \"  gl_FragDepth = clamp(tmp_FragDepth,0.0,1.0);\\n\";\n\t\t}\n\n\t\t// close main\n\t\tbody += \"}\\n\";\n\n\t\treturn header + body;\n\t}\n\n\tpublic regtostring(regtype:number, regnum:number, desc:Description, tag)\n\t{\n\t\tswitch (regtype) {\n\t\t\tcase 0x0:\n\t\t\t\treturn \"va\" + regnum;\n\t\t\tcase 0x1:\n\t\t\t\tif (desc.hasindirect && desc.header.type == \"vertex\") {\n\t\t\t\t\treturn \"vcarrr[\" + regnum + \"]\";\n\t\t\t\t} else {\n\t\t\t\t\treturn tag + \"c\" + regnum;\n\t\t\t\t}\n\t\t\tcase 0x2:\n\t\t\t\treturn tag + \"t\" + regnum;\n\t\t\tcase 0x3:\n\t\t\t\treturn desc.header.type == \"vertex\"? \"outpos\" : \"gl_FragColor\";\n\t\t\tcase 0x4:\n\t\t\t\treturn \"vi\" + regnum;\n\t\t\tcase 0x5:\n\t\t\t\treturn \"fs\" + regnum;\n\t\t\tcase 0x6:\n\t\t\t\treturn \"tmp_FragDepth\";\n\t\t\tdefault:\n\t\t\t\tthrow \"Unknown register type\";\n\t\t}\n\t}\n\n\tpublic sourcetostring(s, subline, dwm, isscalar, desc, tag):string\n\t{\n\t\tvar swiz = [ \"x\", \"y\", \"z\", \"w\" ];\n\t\tvar r;\n\n\t\tif (s.indirectflag) {\n\t\t\tr = \"vcarrr[int(\" + this.regtostring(s.indexregtype, s.regnum, desc, tag) + \".\" + swiz[s.indexselect] + \")\";\n\t\t\tvar realofs = subline + s.indexoffset;\n\t\t\tif (realofs < 0) r += realofs.toString();\n\t\t\tif (realofs > 0) r += \"+\" + realofs.toString();\n\t\t\tr += \"]\";\n\t\t} else {\n\t\t\tr = this.regtostring(s.regtype, s.regnum + subline, desc, tag);\n\t\t}\n\n\t\t// samplers never add swizzle        \n\t\tif (s.regtype == 0x5) {\n\t\t\treturn r;\n\t\t}\n\n\t\t// scalar, first component only\n\t\tif (isscalar) {\n\t\t\treturn r + \".\" + swiz[(s.swizzle >> 0) & 3];\n\t\t}\n\n\t\t// identity\n\t\tif (s.swizzle == 0xe4 && dwm == 0xf) {\n\t\t\treturn r;\n\t\t}\n\n\t\t// with destination write mask folded in\n\t\tr += \".\";\n\t\tif (dwm & 1) r += swiz[(s.swizzle >> 0) & 3];\n\t\tif (dwm & 2) r += swiz[(s.swizzle >> 2) & 3];\n\t\tif (dwm & 4) r += swiz[(s.swizzle >> 4) & 3];\n\t\tif (dwm & 8) r += swiz[(s.swizzle >> 6) & 3];\n\t\treturn r;\n\t}\n}\n\nexport = AGLSLParser;","import Header\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Header\");\nimport Token\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Token\");\n\nclass Description\n{\n\tpublic regread:any[] = [\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[]\n\t];\n\tpublic regwrite:any[] = [\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[],\n\t\t[]\n\t];\n\tpublic hasindirect:boolean = false;\n\tpublic writedepth:boolean = false;\n\tpublic hasmatrix:boolean = false;\n\tpublic samplers:any[] = [];\n\n\t// added due to dynamic assignment 3*0xFFFFFFuuuu\n\tpublic tokens:Token[] = [];\n\tpublic header:Header = new Header();\n\n\tconstructor()\n\t{\n\t}\n}\n\nexport = Description;","class Destination\n{\n\tpublic mask:number = 0;\n\tpublic regnum:number = 0;\n\tpublic regtype:number = 0;\n\tpublic dim:number = 0;\n\n\tconstructor()\n\t{\n\t}\n}\n\nexport = Destination;","class Header\n{\n\tpublic progid:number = 0;\n\tpublic version:number = 0;\n\tpublic type:string = \"\";\n\n\tconstructor()\n\t{\n\t}\n}\n\nexport = Header;","import OpLUT\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/OpLUT\");\n\nclass Mapping\n{\n\tstatic agal2glsllut:Array<OpLUT> = [\n\n\t\t//         s \t\t\t\t\t\t\t\t\t\t\t\tflags   dest    a     b \t    mw \t  mh    ndwm  scale dm\t  lod\n\t\tnew OpLUT(\"%dest = %cast(%a);\\n\", 0, true, true, false, null, null, null, null, null, null), //mov\n\t\tnew OpLUT(\"%dest = %cast(%a + %b);\\n\", 0, true, true, true, null, null, null, null, null, null), //add\n\t\tnew OpLUT(\"%dest = %cast(%a - %b);\\n\", 0, true, true, true, null, null, null, null, null, null), //sub\n\t\tnew OpLUT(\"%dest = %cast(%a * %b);\\n\", 0, true, true, true, null, null, null, null, null, null), //mul\n\t\tnew OpLUT(\"%dest = %cast(%a / %b);\\n\", 0, true, true, true, null, null, null, null, null, null), //div\n\t\tnew OpLUT(\"%dest = %cast(1.0) / %a;\\n\", 0, true, true, false, null, null, null, null, null, null), //rcp\n\t\tnew OpLUT(\"%dest = %cast(min(%a,%b));\\n\", 0, true, true, true, null, null, null, null, null, null), //min\n\t\tnew OpLUT(\"%dest = %cast(max(%a,%b));\\n\", 0, true, true, true, null, null, null, null, null, null), //max\n\t\tnew OpLUT(\"%dest = %cast(fract(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), //frc\n\t\tnew OpLUT(\"%dest = %cast(sqrt(abs(%a)));\\n\", 0, true, true, false, null, null, null, null, null, null), //sqt\n\t\tnew OpLUT(\"%dest = %cast(inversesqrt(abs(%a)));\\n\", 0, true, true, false, null, null, null, null, null, null), //rsq\n\t\tnew OpLUT(\"%dest = %cast(pow(abs(%a),%b));\\n\", 0, true, true, true, null, null, null, null, null, null), //pow\n\t\tnew OpLUT(\"%dest = %cast(log2(abs(%a)));\\n\", 0, true, true, false, null, null, null, null, null, null), //log\n\t\tnew OpLUT(\"%dest = %cast(exp2(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), //exp\n\n\t\t//         s \t\t\t\t\t\t\t\t\t\t\t\tflags  \tdest    a     b \t    mw \t  mh    ndwm  scale dm\t  lod\n\t\tnew OpLUT(\"%dest = %cast(normalize(vec3( %a ) ));\\n\", 0, true, true, false, null, null, true, null, null, null), //nrm\n\t\tnew OpLUT(\"%dest = %cast(sin(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), //sin\n\t\tnew OpLUT(\"%dest = %cast(cos(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), //cos\n\t\tnew OpLUT(\"%dest = %cast(cross(vec3(%a),vec3(%b)));\\n\", 0, true, true, true, null, null, true, null, null, null), //crs\n\t\tnew OpLUT(\"%dest = %cast(dot(vec3(%a),vec3(%b)));\\n\", 0, true, true, true, null, null, true, null, null, null), //dp3\n\t\tnew OpLUT(\"%dest = %cast(dot(vec4(%a),vec4(%b)));\\n\", 0, true, true, true, null, null, true, null, null, null), //dp4\n\t\tnew OpLUT(\"%dest = %cast(abs(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), //abs\n\t\tnew OpLUT(\"%dest = %cast(%a * -1.0);\\n\", 0, true, true, false, null, null, null, null, null, null), //neg\n\t\tnew OpLUT(\"%dest = %cast(clamp(%a,0.0,1.0));\\n\", 0, true, true, false, null, null, null, null, null, null), //sat\n\t\tnew OpLUT(\"%dest = %cast(dot(vec3(%a),vec3(%b)));\\n\", null, true, true, true, 3, 3, true, null, null, null), //m33\n\t\tnew OpLUT(\"%dest = %cast(dot(vec4(%a),vec4(%b)));\\n\", null, true, true, true, 4, 4, true, null, null, null), //m44\n\t\tnew OpLUT(\"%dest = %cast(dot(vec4(%a),vec4(%b)));\\n\", null, true, true, true, 4, 3, true, null, null, null), //m43\n\t\tnew OpLUT(\"%dest = %cast(dFdx(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), //dFdx\n\t\tnew OpLUT(\"%dest = %cast(dFdx(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), //dFdx\n\t\tnew OpLUT(\"if (float(%a)==float(%b)) {;\\n\", 0, false, true, true, null, null, null, true, null, null), new OpLUT(\"if (float(%a)!=float(%b)) {;\\n\", 0, false, true, true, null, null, null, true, null, null), new OpLUT(\"if (float(%a)>=float(%b)) {;\\n\", 0, false, true, true, null, null, null, true, null, null), new OpLUT(\"if (float(%a)<float(%b)) {;\\n\", 0, false, true, true, null, null, null, true, null, null), new OpLUT(\"} else {;\\n\", 0, false, false, false, null, null, null, null, null, null), new OpLUT(\"};\\n\", 0, false, false, false, null, null, null, null, null, null), new OpLUT(null, null, null, null, false, null, null, null, null, null, null), new OpLUT(null, null, null, null, false, null, null, null, null, null, null), new OpLUT(null, null, null, null, false, null, null, null, null, null, null), new OpLUT(null, null, null, null, false, null, null, null, null, null, null),\n\n\t\t//         s \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tflags  \tdest    a     b \t    mw \t  mh    ndwm  scale dm\t  lod\n\t\tnew OpLUT(\"%dest = %cast(texture%texdimLod(%b,%texsize(%a)).%dm);\\n\", null, true, true, true, null, null, null, null, true, null), new OpLUT(\"if ( float(%a)<0.0 ) discard;\\n\", null, false, true, false, null, null, null, true, null, null), new OpLUT(\"%dest = %cast(texture%texdim(%b,%texsize(%a)%lod).%dm);\\n\", null, true, true, true, null, null, true, null, true, true), new OpLUT(\"%dest = %cast(greaterThanEqual(%a,%b).%dm);\\n\", 0, true, true, true, null, null, true, null, true, null), new OpLUT(\"%dest = %cast(lessThan(%a,%b).%dm);\\n\", 0, true, true, true, null, null, true, null, true, null), new OpLUT(\"%dest = %cast(sign(%a));\\n\", 0, true, true, false, null, null, null, null, null, null), new OpLUT(\"%dest = %cast(equal(%a,%b).%dm);\\n\", 0, true, true, true, null, null, true, null, true, null), new OpLUT(\"%dest = %cast(notEqual(%a,%b).%dm);\\n\", 0, true, true, true, null, null, true, null, true, null)\n\n\t];\n\n\t//TODO: get rid of hack that fixes including definition file\n\tconstructor(include?:OpLUT)\n\t{\n\n\t}\n}\n\nexport = Mapping;","class OpLUT\n{\n\n\tpublic s:string;\n\tpublic flags:number;\n\tpublic dest:boolean;\n\tpublic a:boolean;\n\tpublic b:boolean;\n\tpublic matrixwidth:number;\n\tpublic matrixheight:number;\n\tpublic ndwm:boolean;\n\tpublic scalar:boolean;\n\tpublic dm:boolean;\n\tpublic lod:boolean;\n\n\tconstructor(s:string, flags:number, dest:boolean, a:boolean, b:boolean, matrixwidth:number, matrixheight:number, ndwm:boolean, scaler:boolean, dm:boolean, lod:boolean)\n\t{\n\t\tthis.s = s;\n\t\tthis.flags = flags;\n\t\tthis.dest = dest;\n\t\tthis.a = a;\n\t\tthis.b = b;\n\t\tthis.matrixwidth = matrixwidth;\n\t\tthis.matrixheight = matrixheight;\n\t\tthis.ndwm = ndwm;\n\t\tthis.scalar = scaler;\n\t\tthis.dm = dm;\n\t\tthis.lod = lod;\n\t}\n}\n\nexport = OpLUT;","class Sampler\n{\n\tpublic lodbias:number = 0;\n\tpublic dim:number = 0;\n\tpublic readmode:number = 0;\n\tpublic special:number = 0;\n\tpublic wrap:number = 0;\n\tpublic mipmap:number = 0;\n\tpublic filter:number = 0;\n\n\tconstructor()\n\t{\n\t}\n}\n\nexport = Sampler;","import Destination\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Destination\");\n\nclass Token\n{\n\tpublic dest:Destination = new Destination();\n\tpublic opcode:number = 0;\n\tpublic a:Destination = new Destination();\n\tpublic b:Destination = new Destination();\n\n\tconstructor()\n\t{\n\t}\n}\n\nexport = Token;","import Sampler\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/Sampler\");\nimport Opcode\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/Opcode\");\nimport OpcodeMap\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/OpcodeMap\");\nimport Part\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/Part\");\nimport RegMap\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/RegMap\");\nimport SamplerMap\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/SamplerMap\");\n\n\nclass AGALMiniAssembler\n{\n\tpublic r:Object;\n\tpublic cur:Part;\n\n\tconstructor()\n\t{\n\t\tthis.r = {};\n\t\tthis.cur = new Part();\n\t}\n\n\tpublic assemble(source:string, ext_part = null, ext_version = null)\n\t{\n\t\tif (!ext_version) {\n\t\t\text_version = 1;\n\t\t}\n\n\t\tif (ext_part) {\n\t\t\tthis.addHeader(ext_part, ext_version);\n\t\t}\n\n\t\tvar lines = source.replace(/[\\f\\n\\r\\v]+/g, \"\\n\").split(\"\\n\"); // handle breaks, then split into lines\n\n\t\tfor (var i in lines) {\n\t\t\tthis.processLine(lines[i], i);\n\t\t}\n\n\t\treturn this.r;\n\t}\n\n\tprivate processLine(line, linenr)\n\t{\n\t\tvar startcomment:number = line.search(\"//\");  // remove comments\n\t\tif (startcomment != -1) {\n\t\t\tline = line.slice(0, startcomment);\n\t\t}\n\t\tline = line.replace(/^\\s+|\\s+$/g, \"\"); // remove outer space\n\t\tif (!(line.length > 0 )) {\n\t\t\treturn;\n\t\t}\n\t\tvar optsi:number = line.search(/<.*>/g); // split of options part <*> if there\n\t\tvar opts:string[] = null;\n\t\tif (optsi != -1) {\n\t\t\topts = line.slice(optsi).match(/([\\w\\.\\-\\+]+)/gi);\n\t\t\tline = line.slice(0, optsi);\n\t\t}\n\n\t\t// get opcode/command\t\t\t\t            \n\t\tvar tokens = line.match(/([\\w\\.\\+\\[\\]]+)/gi); // get tokens in line\n\t\tif (!tokens || tokens.length < 1) {\n\t\t\tif (line.length >= 3) {\n\t\t\t\tconsole.log(\"Warning: bad line \" + linenr + \": \" + line);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t//console.log ( linenr, line, cur, tokens ); \n\t\tswitch (tokens[0]) {\n\t\t\tcase \"part\":\n\t\t\t\tthis.addHeader(tokens[1], Number(tokens[2]));\n\t\t\t\tbreak;\n\t\t\tcase \"endpart\":\n\t\t\t\tif (!this.cur) {\n\t\t\t\t\tthrow \"Unexpected endpart\";\n\t\t\t\t}\n\t\t\t\tthis.cur.data.position = 0;\n\t\t\t\tthis.cur = null;\n\t\t\t\treturn;\n\t\t\tdefault:\n\t\t\t\tif (!this.cur) {\n\t\t\t\t\tconsole.log(\"Warning: bad line \" + linenr + \": \" + line + \" (Outside of any part definition)\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (this.cur.name == \"comment\") {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar op:Opcode = <Opcode> OpcodeMap.map[tokens[0]];\n\t\t\t\tif (!op) {\n\t\t\t\t\tthrow \"Bad opcode \" + tokens[0] + \" \" + linenr + \": \" + line;\n\t\t\t\t}\n\t\t\t\t// console.log( 'AGALMiniAssembler' , 'op' , op );\n\n\t\t\t\tthis.emitOpcode(this.cur, op.opcode);\n\t\t\t\tvar ti:number = 1;\n\t\t\t\tif (op.dest && op.dest != \"none\") {\n\t\t\t\t\tif (!this.emitDest(this.cur, tokens[ti++], op.dest)) {\n\t\t\t\t\t\tthrow \"Bad destination register \" + tokens[ti - 1] + \" \" + linenr + \": \" + line;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.emitZeroDword(this.cur);\n\t\t\t\t}\n\n\t\t\t\tif (op.a && op.a.format != \"none\") {\n\t\t\t\t\tif (!this.emitSource(this.cur, tokens[ti++], op.a)) throw \"Bad source register \" + tokens[ti - 1] + \" \" + linenr + \": \" + line;\n\t\t\t\t} else {\n\t\t\t\t\tthis.emitZeroQword(this.cur);\n\t\t\t\t}\n\n\t\t\t\tif (op.b && op.b.format != \"none\") {\n\t\t\t\t\tif (op.b.format == \"sampler\") {\n\t\t\t\t\t\tif (!this.emitSampler(this.cur, tokens[ti++], op.b, opts)) {\n\t\t\t\t\t\t\tthrow \"Bad sampler register \" + tokens[ti - 1] + \" \" + linenr + \": \" + line;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!this.emitSource(this.cur, tokens[ti++], op.b)) {\n\t\t\t\t\t\t\tthrow \"Bad source register \" + tokens[ti - 1] + \" \" + linenr + \": \" + line;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.emitZeroQword(this.cur);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tpublic emitHeader(pr:Part)\n\t{\n\t\tpr.data.writeUnsignedByte(0xa0); \t// tag version\n\t\tpr.data.writeUnsignedInt(pr.version);\n\t\tif (pr.version >= 0x10) {\n\t\t\tpr.data.writeUnsignedByte(0); // align, for higher versions\n\t\t}\n\t\tpr.data.writeUnsignedByte(0xa1);\t\t// tag program id\n\t\tswitch (pr.name) {\n\t\t\tcase \"fragment\" :\n\t\t\t\tpr.data.writeUnsignedByte(1);\n\t\t\t\tbreak;\n\t\t\tcase \"vertex\" :\n\t\t\t\tpr.data.writeUnsignedByte(0);\n\t\t\t\tbreak;\n\t\t\tcase \"cpu\" :\n\t\t\t\tpr.data.writeUnsignedByte(2);\n\t\t\t\tbreak;\n\t\t\tdefault :\n\t\t\t\tpr.data.writeUnsignedByte(0xff);\n\t\t\t\tbreak; // unknown/comment\n\t\t}\n\t}\n\n\tpublic emitOpcode(pr:Part, opcode)\n\t{\n\t\tpr.data.writeUnsignedInt(opcode);\n\t\t//console.log ( \"Emit opcode: \", opcode ); \n\t}\n\n\tpublic emitZeroDword(pr:Part)\n\t{\n\t\tpr.data.writeUnsignedInt(0);\n\t}\n\n\tpublic emitZeroQword(pr)\n\t{\n\t\tpr.data.writeUnsignedInt(0);\n\t\tpr.data.writeUnsignedInt(0);\n\t}\n\n\tpublic emitDest(pr, token, opdest)\n\t{\n\n\t\t//console.log( 'AGALMiniAssembler' , 'emitDest' , 'RegMap.map' , RegMap.map);\n\t\tvar reg = token.match(/([fov]?[tpocidavs])(\\d*)(\\.[xyzw]{1,4})?/i); // g1: regname, g2:regnum, g3:mask\n\n\t\t// console.log( 'AGALMiniAssembler' , 'emitDest' , 'reg' , reg , reg[1] , RegMap.map[reg[1]] );\n\t\t// console.log( 'AGALMiniAssembler' , 'emitDest' , 'RegMap.map[reg[1]]' , RegMap.map[reg[1]] , 'bool' , !RegMap.map[reg[1]] ) ;\n\n\t\tif (!RegMap.map[reg[1]]) return false;\n\t\tvar em = { num:reg[2]? reg[2] : 0, code:RegMap.map[reg[1]].code, mask:this.stringToMask(reg[3]) };\n\t\tpr.data.writeUnsignedShort(em.num);\n\t\tpr.data.writeUnsignedByte(em.mask);\n\t\tpr.data.writeUnsignedByte(em.code);\n\t\t//console.log ( \"  Emit dest: \", em );\n\t\treturn true;\n\t}\n\n\tpublic stringToMask(s:string):number\n\t{\n\t\tif (!s) return 0xf;\n\t\tvar r = 0;\n\t\tif (s.indexOf(\"x\") != -1) r |= 1;\n\t\tif (s.indexOf(\"y\") != -1) r |= 2;\n\t\tif (s.indexOf(\"z\") != -1) r |= 4;\n\t\tif (s.indexOf(\"w\") != -1) r |= 8;\n\t\treturn r;\n\t}\n\n\tpublic stringToSwizzle(s)\n\t{\n\t\tif (!s) {\n\t\t\treturn 0xe4;\n\t\t}\n\t\tvar chartoindex = { x:0, y:1, z:2, w:3 };\n\t\tvar sw = 0;\n\n\t\tif (s.charAt(0) != \".\") {\n\t\t\tthrow \"Missing . for swizzle\";\n\t\t}\n\n\t\tif (s.length > 1) {\n\t\t\tsw |= chartoindex[s.charAt(1)];\n\t\t}\n\n\t\tif (s.length > 2) {\n\t\t\tsw |= chartoindex[s.charAt(2)] << 2;\n\t\t} else {\n\t\t\tsw |= (sw & 3) << 2;\n\t\t}\n\n\t\tif (s.length > 3) {\n\t\t\tsw |= chartoindex[s.charAt(3)] << 4;\n\t\t} else {\n\t\t\tsw |= (sw & (3 << 2)) << 2;\n\t\t}\n\n\t\tif (s.length > 4) {\n\t\t\tsw |= chartoindex[s.charAt(4)] << 6;\n\t\t} else {\n\t\t\tsw |= (sw & (3 << 4)) << 2;\n\t\t}\n\n\t\treturn sw;\n\t}\n\n\tpublic emitSampler(pr:Part, token, opsrc, opts)\n\t{\n\t\tvar reg:string[] = token.match(/fs(\\d*)/i); // g1:regnum\n\t\tif (!reg || !reg[1]) {\n\t\t\treturn false;\n\t\t}\n\t\tpr.data.writeUnsignedShort(parseInt(reg[1]));\n\t\tpr.data.writeUnsignedByte(0);   // bias\n\t\tpr.data.writeUnsignedByte(0);\n\t\t/*\n\t\t pr.data.writeUnsignedByte ( 0x5 );\n\t\t pr.data.writeUnsignedByte ( 0 );   // readmode, dim\n\t\t pr.data.writeUnsignedByte ( 0 );   // special, wrap\n\t\t pr.data.writeUnsignedByte ( 0 );   // mip, filter\n\t\t */\n\t\tvar samplerbits:number = 0x5;\n\t\tvar sampleroptset:number = 0;\n\t\tfor (var i:number = 0; i < opts.length; i++) {\n\t\t\tvar o:Sampler = <Sampler> SamplerMap.map[ opts[i].toLowerCase() ];\n\n\t\t\t//console.log( 'AGALMiniAssembler' , 'emitSampler' , 'SampleMap opt:' , o , '<-------- WATCH FOR THIS');\n\n\t\t\tif (o) {\n\t\t\t\tif (((sampleroptset >> o.shift) & o.mask) != 0) {\n\t\t\t\t\tconsole.log(\"Warning, duplicate sampler option\");\n\t\t\t\t}\n\t\t\t\tsampleroptset |= o.mask << o.shift;\n\t\t\t\tsamplerbits &= ~(o.mask << o.shift);\n\t\t\t\tsamplerbits |= o.value << o.shift;\n\t\t\t} else {\n\t\t\t\tconsole.log(\"Warning, unknown sampler option: \", opts[i]);\n\t\t\t\t// todo bias\n\t\t\t}\n\t\t}\n\t\tpr.data.writeUnsignedInt(samplerbits);\n\t\treturn true;\n\t}\n\n\tpublic emitSource(pr, token, opsrc)\n\t{\n\t\tvar indexed = token.match(/vc\\[(v[tcai])(\\d+)\\.([xyzw])([\\+\\-]\\d+)?\\](\\.[xyzw]{1,4})?/i); // g1: indexregname, g2:indexregnum, g3:select, [g4:offset], [g5:swizzle]\n\t\tvar reg;\n\t\tif (indexed) {\n\t\t\tif (!RegMap.map[indexed[1]]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar selindex = { x:0, y:1, z:2, w:3 };\n\t\t\tvar em:any = { num:indexed[2] | 0, code:RegMap.map[indexed[1]].code, swizzle:this.stringToSwizzle(indexed[5]), select:selindex[indexed[3]], offset:indexed[4] | 0 };\n\t\t\tpr.data.writeUnsignedShort(em.num);\n\t\t\tpr.data.writeByte(em.offset);\n\t\t\tpr.data.writeUnsignedByte(em.swizzle);\n\t\t\tpr.data.writeUnsignedByte(0x1); // constant reg\n\t\t\tpr.data.writeUnsignedByte(em.code);\n\t\t\tpr.data.writeUnsignedByte(em.select);\n\t\t\tpr.data.writeUnsignedByte(1 << 7);\n\t\t} else {\n\t\t\treg = token.match(/([fov]?[tpocidavs])(\\d*)(\\.[xyzw]{1,4})?/i); // g1: regname, g2:regnum, g3:swizzle\n\t\t\tif (!RegMap.map[reg[1]]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar em:any = { num:reg[2] | 0, code:RegMap.map[reg[1]].code, swizzle:this.stringToSwizzle(reg[3]) };\n\t\t\tpr.data.writeUnsignedShort(em.num);\n\t\t\tpr.data.writeUnsignedByte(0);\n\t\t\tpr.data.writeUnsignedByte(em.swizzle);\n\t\t\tpr.data.writeUnsignedByte(em.code);\n\t\t\tpr.data.writeUnsignedByte(0);\n\t\t\tpr.data.writeUnsignedByte(0);\n\t\t\tpr.data.writeUnsignedByte(0);\n\t\t\t//console.log ( \"  Emit source: \", em, pr.data.length );\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic addHeader(partname, version)\n\t{\n\t\tif (!version) {\n\t\t\tversion = 1;\n\t\t}\n\t\tif (this.r[partname] == undefined) {\n\t\t\tthis.r[partname] = new Part(partname, version);\n\t\t\tthis.emitHeader(this.r[ partname ]);\n\t\t} else if (this.r[partname].version != version) {\n\t\t\tthrow \"Multiple versions for part \" + partname;\n\t\t}\n\t\tthis.cur = this.r[partname];\n\t}\n}\n\nexport = AGALMiniAssembler;","class FS\n{\n\tpublic format:string;\n\tpublic size:number;\n}\n\nexport = FS;\n","class Flags\n{\n\tpublic simple:boolean;\n\tpublic horizontal:boolean;\n\tpublic fragonly:boolean;\n\tpublic matrix:boolean;\n}\n\nexport = Flags;\n","import Opcode\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/Opcode\");\n\nclass OpcodeMap\n{\n\t// dest:\t\t\t\t\t  \t\t\t\t\t   string,  aformat, asize, bformat,   bsize, opcode, simple, horizontal, fragonly   matrix\n\t/*\n\t public static mov:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x00,   true,   null,       null,      null );\n\t public static add:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x01,   true,   null,       null,      null );\n\n\t public static sub:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x02,   true,   null,       null,      null );\n\t public static mul:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x03,   true,   null,       null,      null );\n\t public static div:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x04,   true,   null,       null,      null );\n\t public static rcp:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x05,   true,   null,       null,      null );\n\t public static min:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x06,   true,   null,       null,      null );\n\t public static max:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x07,   true,   null,       null,      null );\n\t public static frc:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x08,   true,   null,       null,      null );\n\t public static sqt:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x09,   true,   null,       null,      null );\n\t public static rsq:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x0a,   true,   null,       null,      null );\n\t public static pow:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x0b,   true,   null,       null,      null );\n\t public static log:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x0c,   true,   null,       null,      null );\n\t public static exp:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x0d,   true,   null,       null,      null );\n\t public static nrm:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x0e,   true,   null,       null,      null );\n\t public static sin:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x0f,   true,   null,       null,      null );\n\t public static cos:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x10,   true,   null,       null,      null );\n\t public static crs:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x11,   true,   true,       null,      null );\n\t public static dp3:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x12,   true,   true,       null,      null );\n\t public static dp4:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x13,   true,   true,       null,      null );\n\t public static abs:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x14,   true,   null,       null,      null );\n\t public static neg:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x15,   true,   null,       null,      null );\n\t public static sat:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"none\",    0,     0x16,   true,   null,       null,      null );\n\n\t public static ted:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"sampler\", 1,     0x26,   true,   null,       true,      null );\n\t public static kil:Opcode = new Opcode( \"none\",   \"scalar\", 1,    \"none\",    0,     0x27,   true,   null,       true,      null );\n\t public static tex:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"sampler\", 1,     0x28,   true,   null,       true,      null );\n\n\t public static m33:Opcode = new Opcode( \"vector\", \"matrix\", 3,    \"vector\",  3,     0x17,   true,   null,       null,      true );\n\t public static m44:Opcode = new Opcode( \"vector\", \"matrix\", 4,    \"vector\",  4,     0x18,   true,   null,       null,      true );\n\t public static m43:Opcode = new Opcode( \"vector\", \"matrix\", 3,    \"vector\",  4,     0x19,   true,   null,       null,      true );\n\n\t public static sge:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x29,   true,   null,       null,      null );\n\t public static slt:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x2a,   true,   null,       null,      null );\n\t public static sgn:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x2b,   true,   null,       null,      null );\n\t public static seq:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x2c,   true,   null,       null,      null );\n\t public static sne:Opcode = new Opcode( \"vector\", \"vector\", 4,    \"vector\",  4,     0x2d,   true,   null,       null,      null );\n\t */\n\n\n\tprivate static _map:Object[];\n\n\tpublic static get map():Object[]\n\t{\n\n\t\tif (!OpcodeMap._map) {\n\n\t\t\tOpcodeMap._map = new Array<Object>();\n\t\t\tOpcodeMap._map['mov'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x00, true, null, null, null);\n\t\t\tOpcodeMap._map['add'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x01, true, null, null, null);\n\t\t\tOpcodeMap._map['sub'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x02, true, null, null, null);\n\t\t\tOpcodeMap._map['mul'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x03, true, null, null, null);\n\t\t\tOpcodeMap._map['div'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x04, true, null, null, null);\n\t\t\tOpcodeMap._map['rcp'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x05, true, null, null, null);\n\t\t\tOpcodeMap._map['min'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x06, true, null, null, null);\n\t\t\tOpcodeMap._map['max'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x07, true, null, null, null);\n\t\t\tOpcodeMap._map['frc'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x08, true, null, null, null);\n\t\t\tOpcodeMap._map['sqt'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x09, true, null, null, null);\n\t\t\tOpcodeMap._map['rsq'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x0a, true, null, null, null);\n\t\t\tOpcodeMap._map['pow'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x0b, true, null, null, null);\n\t\t\tOpcodeMap._map['log'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x0c, true, null, null, null);\n\t\t\tOpcodeMap._map['exp'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x0d, true, null, null, null);\n\t\t\tOpcodeMap._map['nrm'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x0e, true, null, null, null);\n\t\t\tOpcodeMap._map['sin'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x0f, true, null, null, null);\n\t\t\tOpcodeMap._map['cos'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x10, true, null, null, null);\n\t\t\tOpcodeMap._map['crs'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x11, true, true, null, null);\n\t\t\tOpcodeMap._map['dp3'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x12, true, true, null, null);\n\t\t\tOpcodeMap._map['dp4'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x13, true, true, null, null);\n\t\t\tOpcodeMap._map['abs'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x14, true, null, null, null);\n\t\t\tOpcodeMap._map['neg'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x15, true, null, null, null);\n\t\t\tOpcodeMap._map['sat'] = new Opcode(\"vector\", \"vector\", 4, \"none\", 0, 0x16, true, null, null, null);\n\n\t\t\tOpcodeMap._map['ted'] = new Opcode(\"vector\", \"vector\", 4, \"sampler\", 1, 0x26, true, null, true, null);\n\t\t\tOpcodeMap._map['kil'] = new Opcode(\"none\", \"scalar\", 1, \"none\", 0, 0x27, true, null, true, null);\n\t\t\tOpcodeMap._map['tex'] = new Opcode(\"vector\", \"vector\", 4, \"sampler\", 1, 0x28, true, null, true, null);\n\n\t\t\tOpcodeMap._map['m33'] = new Opcode(\"vector\", \"matrix\", 3, \"vector\", 3, 0x17, true, null, null, true);\n\t\t\tOpcodeMap._map['m44'] = new Opcode(\"vector\", \"matrix\", 4, \"vector\", 4, 0x18, true, null, null, true);\n\t\t\tOpcodeMap._map['m43'] = new Opcode(\"vector\", \"matrix\", 3, \"vector\", 4, 0x19, true, null, null, true);\n\n\t\t\tOpcodeMap._map['sge'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x29, true, null, null, null);\n\t\t\tOpcodeMap._map['slt'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x2a, true, null, null, null);\n\t\t\tOpcodeMap._map['sgn'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x2b, true, null, null, null);\n\t\t\tOpcodeMap._map['seq'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x2c, true, null, null, null);\n\t\t\tOpcodeMap._map['sne'] = new Opcode(\"vector\", \"vector\", 4, \"vector\", 4, 0x2d, true, null, null, null);\n\n\n\t\t}\n\n\t\treturn OpcodeMap._map;\n\n\t}\n\n\n\tconstructor()\n\t{\n\t}\n}\n\nexport = OpcodeMap;","import Flags\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/Flags\");\nimport FS\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/FS\");\n\n/**\n *\n */\nclass Opcode\n{\n\tpublic dest:string;\n\tpublic a:FS;\n\tpublic b:FS;\n\tpublic opcode:number;\n\tpublic flags:Flags;\n\n\tconstructor(dest:string, aformat:string, asize:number, bformat:string, bsize:number, opcode:number, simple:boolean, horizontal:boolean, fragonly:boolean, matrix:boolean)\n\t{\n\t\tthis.a = new FS();\n\t\tthis.b = new FS();\n\t\tthis.flags = new Flags();\n\n\t\tthis.dest = dest;\n\t\tthis.a.format = aformat;\n\t\tthis.a.size = asize;\n\t\tthis.b.format = bformat;\n\t\tthis.b.size = bsize;\n\t\tthis.opcode = opcode;\n\t\tthis.flags.simple = simple;\n\t\tthis.flags.horizontal = horizontal;\n\t\tthis.flags.fragonly = fragonly;\n\t\tthis.flags.matrix = matrix;\n\t}\n}\n\nexport = Opcode;\n","import ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nclass Part\n{\n\tpublic name:string = \"\";\n\tpublic version:number = 0;\n\tpublic data:ByteArray;\n\n\tconstructor(name:string = null, version:number = null)\n\t{\n\t\tthis.name = name;\n\t\tthis.version = version;\n\t\tthis.data = new ByteArray();\n\t}\n}\n\nexport = Part;","\nclass Reg\n{\n\n\tpublic code:number;\n\tpublic desc:string;\n\n\tconstructor(code:number, desc:string)\n\t{\n\t\tthis.code = code;\n\t\tthis.desc = desc;\n\t}\n}\n\nclass RegMap\n{\n\n\t/*\n\t public static map = [ new Reg( 0x00, \"vertex attribute\" ),\n\t new Reg( 0x01, \"fragment constant\" ),\n\t new Reg( 0x01, \"vertex constant\" ),\n\t new Reg( 0x02, \"fragment temporary\" ),\n\t new Reg( 0x02, \"vertex temporary\" ),\n\t new Reg( 0x03, \"vertex output\" ),\n\t new Reg( 0x03, \"vertex output\" ),\n\t new Reg( 0x03, \"fragment depth output\" ),\n\t new Reg( 0x03, \"fragment output\" ),\n\t new Reg( 0x03, \"fragment output\" ),\n\t new Reg( 0x04, \"varying\" ),\n\t new Reg( 0x04, \"varying output\" ),\n\t new Reg( 0x04, \"varying input\" ),\n\t new Reg( 0x05, \"sampler\" ) ];\n\t */\n\n\tprivate static _map:any[];\n\tpublic static get map():any[]\n\t{\n\n\t\tif (!RegMap._map) {\n\n\t\t\tRegMap._map = new Array<Object>();\n\t\t\tRegMap._map['va'] = new Reg(0x00, \"vertex attribute\");\n\t\t\tRegMap._map['fc'] = new Reg(0x01, \"fragment constant\");\n\t\t\tRegMap._map['vc'] = new Reg(0x01, \"vertex constant\")\n\t\t\tRegMap._map['ft'] = new Reg(0x02, \"fragment temporary\");\n\t\t\tRegMap._map['vt'] = new Reg(0x02, \"vertex temporary\");\n\t\t\tRegMap._map['vo'] = new Reg(0x03, \"vertex output\");\n\t\t\tRegMap._map['op'] = new Reg(0x03, \"vertex output\");\n\t\t\tRegMap._map['fd'] = new Reg(0x03, \"fragment depth output\");\n\t\t\tRegMap._map['fo'] = new Reg(0x03, \"fragment output\");\n\t\t\tRegMap._map['oc'] = new Reg(0x03, \"fragment output\");\n\t\t\tRegMap._map['v'] = new Reg(0x04, \"varying\")\n\t\t\tRegMap._map['vi'] = new Reg(0x04, \"varying output\");\n\t\t\tRegMap._map['fi'] = new Reg(0x04, \"varying input\");\n\t\t\tRegMap._map['fs'] = new Reg(0x05, \"sampler\");\n\n\n\t\t}\n\n\t\treturn RegMap._map;\n\n\t}\n\n\t/*\n\t public static va:Reg = new Reg( 0x00, \"vertex attribute\" );\n\t public static fc:Reg = new Reg( 0x01, \"fragment constant\" );\n\t public static vc:Reg = new Reg( 0x01, \"vertex constant\" );\n\t public static ft:Reg = new Reg( 0x02, \"fragment temporary\" );\n\t public static vt:Reg = new Reg( 0x02, \"vertex temporary\" );\n\t public static vo:Reg = new Reg( 0x03, \"vertex output\" );\n\t public static op:Reg = new Reg( 0x03, \"vertex output\" );\n\t public static fd:Reg = new Reg( 0x03, \"fragment depth output\" );\n\t public static fo:Reg = new Reg( 0x03, \"fragment output\" );\n\t public static oc:Reg = new Reg( 0x03, \"fragment output\" );\n\t public static v: Reg = new Reg( 0x04, \"varying\" );\n\t public static vi:Reg = new Reg( 0x04, \"varying output\" );\n\t public static fi:Reg = new Reg( 0x04, \"varying input\" );\n\t public static fs:Reg = new Reg( 0x05, \"sampler\" );\n\t */\n\tconstructor()\n\t{\n\t}\n}\n\nexport = RegMap;","import Sampler\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/Sampler\");\n\nclass SamplerMap\n{\n\n\tprivate static _map:Object[];\n\n\tpublic static get map():Object[]\n\t{\n\n\t\tif (!SamplerMap._map) {\n\n\t\t\tSamplerMap._map = new Array<Object>();\n\t\t\tSamplerMap._map['rgba'] = new Sampler(8, 0xf, 0);\n\t\t\tSamplerMap._map['rg'] = new Sampler(8, 0xf, 5);\n\t\t\tSamplerMap._map['r'] = new Sampler(8, 0xf, 4);\n\t\t\tSamplerMap._map['compressed'] = new Sampler(8, 0xf, 1);\n\t\t\tSamplerMap._map['compressed_alpha'] = new Sampler(8, 0xf, 2);\n\t\t\tSamplerMap._map['dxt1'] = new Sampler(8, 0xf, 1);\n\t\t\tSamplerMap._map['dxt5'] = new Sampler(8, 0xf, 2);\n\n\t\t\t// dimension\n\t\t\tSamplerMap._map['2d'] = new Sampler(12, 0xf, 0);\n\t\t\tSamplerMap._map['cube'] = new Sampler(12, 0xf, 1);\n\t\t\tSamplerMap._map['3d'] = new Sampler(12, 0xf, 2);\n\n\t\t\t// special\n\t\t\tSamplerMap._map['centroid'] = new Sampler(16, 1, 1);\n\t\t\tSamplerMap._map['ignoresampler'] = new Sampler(16, 4, 4);\n\n\t\t\t// repeat\n\t\t\tSamplerMap._map['clamp'] = new Sampler(20, 0xf, 0);\n\t\t\tSamplerMap._map['repeat'] = new Sampler(20, 0xf, 1);\n\t\t\tSamplerMap._map['wrap'] = new Sampler(20, 0xf, 1);\n\n\t\t\t// mip\n\t\t\tSamplerMap._map['nomip'] = new Sampler(24, 0xf, 0);\n\t\t\tSamplerMap._map['mipnone'] = new Sampler(24, 0xf, 0);\n\t\t\tSamplerMap._map['mipnearest'] = new Sampler(24, 0xf, 1);\n\t\t\tSamplerMap._map['miplinear'] = new Sampler(24, 0xf, 2);\n\n\t\t\t// filter\n\t\t\tSamplerMap._map['nearest'] = new Sampler(28, 0xf, 0);\n\t\t\tSamplerMap._map['linear'] = new Sampler(28, 0xf, 1);\n\n\t\t}\n\n\t\treturn SamplerMap._map;\n\n\t}\n\n\t/*\n\t public static map =     [ new Sampler( 8, 0xf, 0 ),\n\t new Sampler( 8, 0xf, 5 ),\n\t new Sampler( 8, 0xf, 4 ),\n\t new Sampler( 8, 0xf, 1 ),\n\t new Sampler( 8, 0xf, 2 ),\n\t new Sampler( 8, 0xf, 1 ),\n\t new Sampler( 8, 0xf, 2 ),\n\n\t // dimension\n\t new Sampler( 12, 0xf, 0 ),\n\t new Sampler( 12, 0xf, 1 ),\n\t new Sampler( 12, 0xf, 2 ),\n\n\t // special\n\t new Sampler( 16, 1, 1 ),\n\t new Sampler( 16, 4, 4 ),\n\n\t // repeat\n\t new Sampler( 20, 0xf, 0 ),\n\t new Sampler( 20, 0xf, 1 ),\n\t new Sampler( 20, 0xf, 1 ),\n\n\t // mip\n\t new Sampler( 24, 0xf, 0 ),\n\t new Sampler( 24, 0xf, 0 ),\n\t new Sampler( 24, 0xf, 1 ),\n\t new Sampler( 24, 0xf, 2 ),\n\n\t // filter\n\t new Sampler( 28, 0xf, 0 ),\n\t new Sampler( 28, 0xf, 1 ) ]\n\t */\n\t/*\n\t public static rgba: Sampler = new Sampler( 8, 0xf, 0 );\n\t public static rg: Sampler = new Sampler( 8, 0xf, 5 );\n\t public static r: Sampler = new Sampler( 8, 0xf, 4 );\n\t public static compressed: Sampler = new Sampler( 8, 0xf, 1 );\n\t public static compressed_alpha: Sampler = new Sampler( 8, 0xf, 2 );\n\t public static dxt1: Sampler = new Sampler( 8, 0xf, 1 );\n\t public static dxt5: Sampler = new Sampler( 8, 0xf, 2 );\n\n\t // dimension\n\t public static sampler2d: Sampler = new Sampler( 12, 0xf, 0 );\n\t public static cube: Sampler = new Sampler( 12, 0xf, 1 );\n\t public static sampler3d: Sampler = new Sampler( 12, 0xf, 2 );\n\n\t // special\n\t public static centroid: Sampler = new Sampler( 16, 1, 1 );\n\t public static ignoresampler: Sampler = new Sampler( 16, 4, 4 );\n\n\t // repeat\n\t public static clamp: Sampler = new Sampler( 20, 0xf, 0 );\n\t public static repeat: Sampler = new Sampler( 20, 0xf, 1 );\n\t public static wrap: Sampler = new Sampler( 20, 0xf, 1 );\n\n\t // mip\n\t public static nomip: Sampler = new Sampler( 24, 0xf, 0 );\n\t public static mipnone: Sampler = new Sampler( 24, 0xf, 0 );\n\t public static mipnearest: Sampler = new Sampler( 24, 0xf, 1 );\n\t public static miplinear: Sampler = new Sampler( 24, 0xf, 2 );\n\n\t // filter\n\t public static nearest: Sampler = new Sampler( 28, 0xf, 0 );\n\t public static linear: Sampler = new Sampler( 28, 0xf, 1 );\n\t */\n\tconstructor()\n\t{\n\t}\n}\n\nexport = SamplerMap;","class Sampler\n{\n\tpublic shift:number;\n\tpublic mask:number;\n\tpublic value:number;\n\n\tconstructor(shift:number, mask:number, value:number)\n\t{\n\t\tthis.shift = shift;\n\t\tthis.mask = mask;\n\t\tthis.value = value;\n\t}\n}\n\nexport = Sampler;","class ContextGLBlendFactor\n{\n\tpublic static DESTINATION_ALPHA:string = \"destinationAlpha\";\n\tpublic static DESTINATION_COLOR:string = \"destinationColor\";\n\tpublic static ONE:string = \"one\";\n\tpublic static ONE_MINUS_DESTINATION_ALPHA:string = \"oneMinusDestinationAlpha\";\n\tpublic static ONE_MINUS_DESTINATION_COLOR:string = \"oneMinusDestinationColor\";\n\tpublic static ONE_MINUS_SOURCE_ALPHA:string = \"oneMinusSourceAlpha\";\n\tpublic static ONE_MINUS_SOURCE_COLOR:string = \"oneMinusSourceColor\";\n\tpublic static SOURCE_ALPHA:string = \"sourceAlpha\";\n\tpublic static SOURCE_COLOR:string = \"sourceColor\";\n\tpublic static ZERO:string = \"zero\";\n}\n\nexport = ContextGLBlendFactor;","class ContextGLClearMask\n{\n\tstatic COLOR:number = 1;\n\tstatic DEPTH:number = 2;\n\tstatic STENCIL:number = 4;\n\tstatic ALL:number = ContextGLClearMask.COLOR | ContextGLClearMask.DEPTH | ContextGLClearMask.STENCIL;\n}\n\nexport = ContextGLClearMask;","class ContextGLCompareMode\n{\n\tpublic static ALWAYS:string = \"always\";\n\tpublic static EQUAL:string = \"equal\";\n\tpublic static GREATER:string = \"greater\";\n\tpublic static GREATER_EQUAL:string = \"greaterEqual\";\n\tpublic static LESS:string = \"less\";\n\tpublic static LESS_EQUAL:string = \"lessEqual\";\n\tpublic static NEVER:string = \"never\";\n\tpublic static NOT_EQUAL:string = \"notEqual\";\n}\n\nexport = ContextGLCompareMode;","class ContextGLMipFilter\n{\n\tpublic static MIPLINEAR:string = \"miplinear\";\n\tpublic static MIPNEAREST:string = \"mipnearest\";\n\tpublic static MIPNONE:string = \"mipnone\";\n}\n\nexport = ContextGLMipFilter;","class ContextGLProfile\n{\n\tpublic static BASELINE:string = \"baseline\";\n\tpublic static BASELINE_CONSTRAINED:string = \"baselineConstrained\";\n\tpublic static BASELINE_EXTENDED:string = \"baselineExtended\";\n}\nexport = ContextGLProfile;","class ContextGLProgramType\n{\n\tstatic FRAGMENT:string = \"fragment\";\n\tstatic VERTEX:string = \"vertex\";\n}\n\nexport = ContextGLProgramType;","class ContextGLStencilAction\n{\n\tpublic static DECREMENT_SATURATE:string = \"decrementSaturate\";\n\tpublic static DECREMENT_WRAP:string = \"decrementWrap\";\n\tpublic static INCREMENT_SATURATE:string = \"incrementSaturate\";\n\tpublic static INCREMENT_WRAP:string = \"incrementWrap\";\n\tpublic static INVERT:string = \"invert\";\n\tpublic static KEEP:string = \"keep\";\n\tpublic static SET:string = \"set\";\n\tpublic static ZERO:string = \"zero\";\n}\n\nexport = ContextGLStencilAction;","class ContextGLTextureFilter\n{\n\tpublic static LINEAR:string = \"linear\";\n\tpublic static NEAREST:string = \"nearest\";\n}\n\nexport = ContextGLTextureFilter;","class ContextGLTextureFormat\n{\n\tstatic BGRA:string = \"bgra\";\n\tstatic BGRA_PACKED:string = \"bgraPacked4444\";\n\tstatic BGR_PACKED:string = \"bgrPacked565\";\n\tstatic COMPRESSED:string = \"compressed\";\n\tstatic COMPRESSED_ALPHA:string = \"compressedAlpha\";\n}\n\nexport = ContextGLTextureFormat;","class ContextGLTriangleFace\n{\n\tstatic BACK:string = \"back\";\n\tstatic FRONT:string = \"front\";\n\tstatic FRONT_AND_BACK:string = \"frontAndBack\";\n\tstatic NONE:string = \"none\";\n}\n\nexport = ContextGLTriangleFace;","class ContextGLVertexBufferFormat\n{\n\tstatic BYTES_4:string = \"bytes4\";\n\tstatic FLOAT_1:string = \"float1\";\n\tstatic FLOAT_2:string = \"float2\";\n\tstatic FLOAT_3:string = \"float3\";\n\tstatic FLOAT_4:string = \"float4\";\n}\n\nexport = ContextGLVertexBufferFormat;","class ContextGLWrapMode\n{\n\tpublic static CLAMP:string = \"clamp\";\n\tpublic static REPEAT:string = \"repeat\";\n}\n\nexport = ContextGLWrapMode;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\n\nimport swfobject\t\t\t\t\t= require(\"awayjs-stagegl/lib/swfobject\");\nimport Sampler\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/Sampler\");\nimport ContextGLClearMask\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLClearMask\");\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\nimport CubeTextureFlash\t\t\t\t= require(\"awayjs-stagegl/lib/base/CubeTextureFlash\");\nimport IContextGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport IndexBufferFlash\t\t\t\t= require(\"awayjs-stagegl/lib/base/IndexBufferFlash\");\nimport OpCodes\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/OpCodes\");\nimport ProgramFlash\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ProgramFlash\");\nimport TextureFlash\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/TextureFlash\");\nimport ResourceBaseFlash\t\t\t= require(\"awayjs-stagegl/lib/base/ResourceBaseFlash\");\nimport VertexBufferFlash\t\t\t= require(\"awayjs-stagegl/lib/base/VertexBufferFlash\");\n\nclass ContextStage3D implements IContextGL\n{\n\tpublic static contexts:Object = new Object();\n\tpublic static maxvertexconstants:number = 128;\n\tpublic static maxfragconstants:number = 28;\n\tpublic static maxtemp:number = 8;\n\tpublic static maxstreams:number = 8;\n\tpublic static maxtextures:number = 8;\n\tpublic static defaultsampler = new Sampler();\n\n\tpublic _iDriverInfo;\n\n\tprivate _container:HTMLElement;\n\tprivate _width:number;\n\tprivate _height:number;\n\tprivate _cmdStream:string = \"\";\n\tprivate _errorCheckingEnabled:boolean;\n\tprivate _resources:Array<ResourceBaseFlash>;\n\tprivate _oldCanvas:HTMLCanvasElement;\n\tprivate _oldParent:HTMLElement;\n\n\n\tpublic static debug:boolean = false;\n\tpublic static logStream:boolean = false;\n\n\tpublic _iCallback:(context:IContextGL) => void;\n\n\tpublic get container():HTMLElement\n\t{\n\t\treturn this._container;\n\t}\n\n\tpublic get driverInfo()\n\t{\n\t\treturn this._iDriverInfo;\n\t}\n\n\tpublic get errorCheckingEnabled():boolean\n\t{\n\t\treturn this._errorCheckingEnabled;\n\t}\n\n\tpublic set errorCheckingEnabled(value:boolean)\n\t{\n\t\tif (this._errorCheckingEnabled == value)\n\t\t\treturn;\n\n\t\tthis._errorCheckingEnabled = value;\n\n\t\tthis.addStream(String.fromCharCode(OpCodes.enableErrorChecking, value? OpCodes.trueValue : OpCodes.falseValue));\n\t\tthis.execute();\n\t}\n\n\t//TODO: get rid of hack that fixes including definition file\n\tconstructor(container:HTMLCanvasElement, callback:(context:IContextGL) => void, include?:Sampler)\n\t{\n\t\tthis._resources = new Array<ResourceBaseFlash>();\n\n\t\tvar swfVersionStr = \"11.0.0\";\n\n\t\t// To use express install, set to playerProductInstall.swf, otherwise the empty string.\n\t\tvar flashvars = {\n\t\t\tid:container.id\n\t\t};\n\n\t\tvar params = {\n\t\t\tquality:\"high\",\n\t\t\tbgcolor:\"#ffffff\",\n\t\t\tallowscriptaccess:\"sameDomain\",\n\t\t\tallowfullscreen:\"true\",\n\t\t\twmode:\"direct\"\n\t\t};\n\n\t\tthis._errorCheckingEnabled = false;\n\t\tthis._iDriverInfo = \"Unknown\";\n\n\t\tvar attributes = {\n\t\t\tsalign:\"tl\",\n\t\t\tid:container.id,\n\t\t\tname:container[\"name\"] //TODO: needed?\n\t\t};\n\n\t\tthis._oldCanvas = <HTMLCanvasElement> container.cloneNode(); // keep the old one to restore on dispose\n\t\tthis._oldParent = <HTMLElement> container.parentNode;\n\n\t\tvar context3dObj = this;\n\t\tContextStage3D.contexts[container.id] = this;\n\n\t\tfunction callbackSWFObject(callbackInfo)\n\t\t{\n\t\t\tif (!callbackInfo.success)\n\t\t\t\treturn;\n\n\t\t\tcontext3dObj._container = callbackInfo.ref;\n\t\t\tcontext3dObj._iCallback = callback;\n\t\t}\n\n\t\tswfobject.embedSWF(\"libs/molehill_js_flashbridge.swf\", container.id, String(container.width), String(container.height), swfVersionStr, \"\", flashvars, params, attributes, callbackSWFObject);\n\t}\n\n\tpublic _iAddResource(resource:ResourceBaseFlash)\n\t{\n\t\tthis._resources.push(resource);\n\t}\n\n\tpublic _iRemoveResource(resource:ResourceBaseFlash)\n\t{\n\t\tthis._resources.splice(this._resources.indexOf(resource));\n\t}\n\n\tpublic createTexture(width:number, height:number, format:string, optimizeForRenderToTexture:boolean, streamingLevels:number = 0):TextureFlash\n\t{\n\t\t//TODO:streaming\n\t\treturn new TextureFlash(this, width, height, format, optimizeForRenderToTexture);\n\t}\n\n\tpublic createCubeTexture(size:number, format:string, optimizeForRenderToTexture:boolean, streamingLevels:number = 0):CubeTextureFlash\n\t{\n\t\t//TODO:streaming\n\t\treturn new CubeTextureFlash(this, size, format, optimizeForRenderToTexture);\n\t}\n\n\n\tpublic setTextureAt(sampler:number, texture:ResourceBaseFlash)\n\t{\n\t\tif (texture) {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.setTextureAt) + sampler + \",\" + texture.id + \",\");\n\t\t} else {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.clearTextureAt) + sampler.toString() + \",\");\n\t\t}\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setSamplerStateAt(sampler:number, wrap:string, filter:string, mipfilter:string):void\n\t{\n\t\t//nothing to do here\n\t}\n\n\tpublic setStencilActions(triangleFace:string = \"frontAndBack\", compareMode:string = \"always\", actionOnBothPass:string = \"keep\", actionOnDepthFail:string = \"keep\", actionOnDepthPassStencilFail:string = \"keep\")\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.setStencilActions) + triangleFace + \"$\" + compareMode + \"$\" + actionOnBothPass + \"$\" + actionOnDepthFail + \"$\" + actionOnDepthPassStencilFail + \"$\");\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setStencilReferenceValue(referenceValue:number, readMask:number = 255, writeMask:number = 255)\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.setStencilReferenceValue, referenceValue + OpCodes.intMask, readMask + OpCodes.intMask, writeMask + OpCodes.intMask));\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setCulling(triangleFaceToCull:string, coordinateSystem:string = \"leftHanded\")\n\t{\n\t\t//TODO implement coordinateSystem option\n\t\tthis.addStream(String.fromCharCode(OpCodes.setCulling) + triangleFaceToCull + \"$\");\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic drawTriangles(indexBuffer:IndexBufferFlash, firstIndex:number = 0, numTriangles:number = -1)\n\t{\n\t\tfirstIndex = firstIndex || 0;\n\t\tif (!numTriangles || numTriangles < 0)\n\t\t\tnumTriangles = indexBuffer.numIndices/3;\n\n\t\tthis.addStream(String.fromCharCode(OpCodes.drawTriangles, indexBuffer.id + OpCodes.intMask) + firstIndex + \",\" + numTriangles + \",\");\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setProgramConstantsFromMatrix(programType:string, firstRegister:number, matrix:Matrix3D, transposedMatrix:boolean = false)\n\t{\n\t\t//this._gl.uniformMatrix4fv(this._gl.getUniformLocation(this._currentProgram.glProgram, this._uniformLocationNameDictionary[programType]), !transposedMatrix, new Float32Array(matrix.rawData));\n\n\t\t//TODO remove special case for WebGL matrix calls?\n\t\tvar d:number[] = matrix.rawData;\n\t\tif (transposedMatrix) {\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister, [ d[0], d[4], d[8], d[12] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 1, [ d[1], d[5], d[9], d[13] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 2, [ d[2], d[6], d[10], d[14] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 3, [ d[3], d[7], d[11], d[15] ], 1);\n\t\t} else {\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister, [ d[0], d[1], d[2], d[3] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 1, [ d[4], d[5], d[6], d[7] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 2, [ d[8], d[9], d[10], d[11] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 3, [ d[12], d[13], d[14], d[15] ], 1);\n\t\t}\n\t}\n\n\tpublic setProgramConstantsFromArray(programType:string, firstRegister:number, data:number[], numRegisters:number = -1)\n\t{\n\t\tvar startIndex:number;\n\t\tvar target:number = (programType == ContextGLProgramType.VERTEX)? OpCodes.trueValue : OpCodes.falseValue;\n\t\tfor (var i:number = 0; i < numRegisters; i++) {\n\t\t\tstartIndex = i*4;\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.setProgramConstant, target, (firstRegister + i) + OpCodes.intMask) + data[startIndex] + \",\" + data[startIndex + 1] + \",\" + data[startIndex + 2] + \",\" + data[startIndex + 3] + \",\");\n\n\t\t\tif (ContextStage3D.debug)\n\t\t\t\tthis.execute();\n\t\t}\n\t}\n\n\tpublic setProgram(program:ProgramFlash)\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.setProgram, program.id + OpCodes.intMask));\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic present()\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.present));\n\t\tthis.execute();\n\t}\n\n\tpublic clear(red:number = 0, green:number = 0, blue:number = 0, alpha:number = 1, depth:number = 1, stencil:number = 0, mask:number = ContextGLClearMask.ALL)\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.clear) + red + \",\" + green + \",\" + blue + \",\" + alpha + \",\" + depth + \",\" + stencil + \",\" + mask + \",\");\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic createProgram():ProgramFlash\n\t{\n\t\treturn new ProgramFlash(this);\n\t}\n\n\tpublic createVertexBuffer(numVertices:number, data32PerVertex:number):VertexBufferFlash\n\t{\n\t\treturn new VertexBufferFlash(this, numVertices, data32PerVertex);\n\t}\n\n\tpublic createIndexBuffer(numIndices:number):IndexBufferFlash\n\t{\n\t\treturn new IndexBufferFlash(this, numIndices);\n\t}\n\n\tpublic configureBackBuffer(width:number, height:number, antiAlias:number, enableDepthAndStencil:boolean = true)\n\t{\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\t//TODO: add Anitalias setting\n\t\tthis.addStream(String.fromCharCode(OpCodes.configureBackBuffer) + width + \",\" + height + \",\");\n\t}\n\n\tpublic drawToBitmapData(destination:BitmapData)\n\t{\n\t\t//TODO\n\t}\n\n\tpublic setVertexBufferAt(index:number, buffer:VertexBufferFlash, bufferOffset:number = 0, format:string = null)\n\t{\n\t\tif (buffer) {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.setVertexBufferAt, index + OpCodes.intMask) + buffer.id + \",\" + bufferOffset + \",\" + format + \"$\");\n\t\t} else {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.clearVertexBufferAt, index + OpCodes.intMask));\n\t\t}\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setColorMask(red:boolean, green:boolean, blue:boolean, alpha:boolean)\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.setColorMask, red? OpCodes.trueValue : OpCodes.falseValue, green? OpCodes.trueValue : OpCodes.falseValue, blue? OpCodes.trueValue : OpCodes.falseValue, alpha? OpCodes.trueValue : OpCodes.falseValue));\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setBlendFactors(sourceFactor:string, destinationFactor:string)\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.setBlendFactors) + sourceFactor + \"$\" + destinationFactor + \"$\");\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setRenderToTexture(target:ResourceBaseFlash, enableDepthAndStencil:boolean = false, antiAlias:number = 0, surfaceSelector:number = 0)\n\t{\n\t\tif (target === null || target === undefined) {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.clearRenderToTexture));\n\t\t} else {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.setRenderToTexture, enableDepthAndStencil? OpCodes.trueValue : OpCodes.falseValue) + target.id + \",\" + (antiAlias || 0) + \",\");\n\t\t}\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\n\tpublic setRenderToBackBuffer()\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.clearRenderToTexture));\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setScissorRectangle(rectangle:Rectangle)\n\t{\n\t\tif (rectangle) {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.setScissorRect) + rectangle.x + \",\" + rectangle.y + \",\" + rectangle.width + \",\" + rectangle.height + \",\");\n\t\t} else {\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.clearScissorRect));\n\t\t}\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic setDepthTest(depthMask:boolean, passCompareMode:string)\n\t{\n\t\tthis.addStream(String.fromCharCode(OpCodes.setDepthTest, depthMask? OpCodes.trueValue : OpCodes.falseValue) + passCompareMode + \"$\");\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis.execute();\n\t}\n\n\tpublic dispose()\n\t{\n\t\tif (this._container == null)\n\t\t\treturn;\n\n\t\tconsole.log(\"Context3D dispose, releasing \" + this._resources.length + \" resources.\");\n\n\t\twhile (this._resources.length)\n\t\t\tthis._resources[0].dispose();\n\n\t\tif (this._container) {\n\t\t\t// encode command\n\t\t\tthis.addStream(String.fromCharCode(OpCodes.disposeContext));\n\t\t\tthis.execute();\n\t\t\tswfobject.removeSWF(this._oldCanvas.id);\n\t\t\tif (this._oldCanvas && this._oldParent) {\n\t\t\t\tthis._oldParent.appendChild(this._oldCanvas);\n\t\t\t\tthis._oldParent = null;\n\t\t\t}\n\t\t\tthis._container = null;\n\t\t}\n\n\t\tthis._oldCanvas = null;\n\t}\n\n\tpublic addStream(stream:string)\n\t{\n\t\tthis._cmdStream += stream;\n\t}\n\n\tpublic execute():number\n\t{\n\t\tif (ContextStage3D.logStream)\n\t\t\tconsole.log(this._cmdStream);\n\n\t\tvar result:number = this._container[\"CallFunction\"](\"<invoke name=\\\"execStage3dOpStream\\\" returntype=\\\"javascript\\\"><arguments><string>\" + this._cmdStream + \"</string></arguments></invoke>\");\n\n\t\tif (Number(result) <= -3)\n\t\t\tthrow \"Exec stream failed\";\n\n\t\tthis._cmdStream = \"\";\n\n\t\treturn Number(result);\n\t}\n}\n\nexport = ContextStage3D;\n\n/**\n* global function for flash callback\n*/\nfunction mountain_js_context_available(id, driverInfo)\n{\n\tvar ctx:ContextStage3D = ContextStage3D.contexts[id];\n\tif (ctx._iCallback) {\n\t\tctx._iDriverInfo = driverInfo;\n\t\t// get out of the current JS stack frame and call back from flash player\n\t\tvar timeOutId = window.setTimeout(function ()\n\t\t{\n\t\t\twindow.clearTimeout(timeOutId);\n\t\t\ttry {\n\t\t\t\tctx._iCallback(ctx);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(\"Callback failed during flash initialization with '\" + e.toString() + \"'\");\n\t\t\t}\n\t\t}, 1);\n\t}\n}\n","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\nimport ContextGLClearMask\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLClearMask\");\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\nimport ContextGLMipFilter\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLMipFilter\");\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\nimport ContextGLTextureFilter\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFilter\");\nimport ContextGLTriangleFace\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTriangleFace\");\nimport ContextGLVertexBufferFormat\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\nimport ContextGLWrapMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLWrapMode\");\nimport CubeTextureWebGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/CubeTextureWebGL\");\nimport IContextGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport IndexBufferWebGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/IndexBufferWebGL\");\nimport ProgramWebGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ProgramWebGL\");\nimport TextureBaseWebGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/TextureBaseWebGL\");\nimport TextureWebGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/TextureWebGL\");\nimport SamplerState\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/SamplerState\");\nimport VertexBufferWebGL\t\t\t= require(\"awayjs-stagegl/lib/base/VertexBufferWebGL\");\n\nclass ContextWebGL implements IContextGL\n{\n\tprivate _blendFactorDictionary:Object = new Object();\n\tprivate _depthTestDictionary:Object = new Object();\n\tprivate _textureIndexDictionary:Array<number> = new Array<number>(8);\n\tprivate _textureTypeDictionary:Object = new Object();\n\tprivate _wrapDictionary:Object = new Object();\n\tprivate _filterDictionary:Object = new Object();\n\tprivate _mipmapFilterDictionary:Object = new Object();\n\tprivate _uniformLocationNameDictionary:Object = new Object();\n\tprivate _vertexBufferDimensionDictionary:Object = new Object();\n\n\tprivate _container:HTMLElement;\n\tprivate _width:number;\n\tprivate _height:number;\n\tprivate _drawing:boolean;\n\tprivate _blendEnabled:boolean;\n\tprivate _blendSourceFactor:number;\n\tprivate _blendDestinationFactor:number;\n\n\tprivate _indexBufferList:Array<IndexBufferWebGL> = new Array<IndexBufferWebGL>();\n\tprivate _vertexBufferList:Array<VertexBufferWebGL> = new Array<VertexBufferWebGL>();\n\tprivate _textureList:Array<TextureBaseWebGL> = new Array<TextureBaseWebGL>();\n\tprivate _programList:Array<ProgramWebGL> = new Array<ProgramWebGL>();\n\n\tprivate _samplerStates:Array<SamplerState> = new Array<SamplerState>(8);\n\n\tpublic static MAX_SAMPLERS:number = 8;\n\n\t//@protected\n\tpublic _gl:WebGLRenderingContext;\n\n\t//@protected\n\tpublic _currentProgram:ProgramWebGL;\n\tprivate _activeTexture:number;\n\n\n\tpublic get container():HTMLElement\n\t{\n\t\treturn this._container;\n\t}\n\n\tconstructor(canvas:HTMLCanvasElement)\n\t{\n\t\tthis._container = canvas;\n\n\t\ttry {\n\t\t\tthis._gl = <WebGLRenderingContext> canvas.getContext(\"experimental-webgl\", { premultipliedAlpha:false, alpha:false });\n\n\t\t\tif (!this._gl)\n\t\t\t\tthis._gl = <WebGLRenderingContext> canvas.getContext(\"webgl\", { premultipliedAlpha:false, alpha:false });\n\t\t} catch (e) {\n\t\t\t//this.dispatchEvent( new away.events.AwayEvent( away.events.AwayEvent.INITIALIZE_FAILED, e ) );\n\t\t}\n\n\t\tif (this._gl) {\n\t\t\t//this.dispatchEvent( new away.events.AwayEvent( away.events.AwayEvent.INITIALIZE_SUCCESS ) );\n\t\t\t//setup shortcut dictionaries\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.ONE] = this._gl.ONE;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.DESTINATION_ALPHA] = this._gl.DST_ALPHA;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.DESTINATION_COLOR] = this._gl.DST_COLOR;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.ONE] = this._gl.ONE;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_DESTINATION_ALPHA] = this._gl.ONE_MINUS_DST_ALPHA;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_DESTINATION_COLOR] = this._gl.ONE_MINUS_DST_COLOR;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA] = this._gl.ONE_MINUS_SRC_ALPHA;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_SOURCE_COLOR] = this._gl.ONE_MINUS_SRC_COLOR;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.SOURCE_ALPHA] = this._gl.SRC_ALPHA;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.SOURCE_COLOR] = this._gl.SRC_COLOR;\n\t\t\tthis._blendFactorDictionary[ContextGLBlendFactor.ZERO] = this._gl.ZERO;\n\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.ALWAYS] = this._gl.ALWAYS;\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.EQUAL] = this._gl.EQUAL;\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.GREATER] = this._gl.GREATER;\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.GREATER_EQUAL] = this._gl.GEQUAL;\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.LESS] = this._gl.LESS;\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.LESS_EQUAL] = this._gl.LEQUAL;\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.NEVER] = this._gl.NEVER;\n\t\t\tthis._depthTestDictionary[ContextGLCompareMode.NOT_EQUAL] = this._gl.NOTEQUAL;\n\n\t\t\tthis._textureIndexDictionary[0] = this._gl.TEXTURE0;\n\t\t\tthis._textureIndexDictionary[1] = this._gl.TEXTURE1;\n\t\t\tthis._textureIndexDictionary[2] = this._gl.TEXTURE2;\n\t\t\tthis._textureIndexDictionary[3] = this._gl.TEXTURE3;\n\t\t\tthis._textureIndexDictionary[4] = this._gl.TEXTURE4;\n\t\t\tthis._textureIndexDictionary[5] = this._gl.TEXTURE5;\n\t\t\tthis._textureIndexDictionary[6] = this._gl.TEXTURE6;\n\t\t\tthis._textureIndexDictionary[7] = this._gl.TEXTURE7;\n\n\t\t\tthis._textureTypeDictionary[\"texture2d\"] = this._gl.TEXTURE_2D;\n\t\t\tthis._textureTypeDictionary[\"textureCube\"] = this._gl.TEXTURE_CUBE_MAP;\n\n\t\t\tthis._wrapDictionary[ContextGLWrapMode.REPEAT] = this._gl.REPEAT;\n\t\t\tthis._wrapDictionary[ContextGLWrapMode.CLAMP] = this._gl.CLAMP_TO_EDGE;\n\n\t\t\tthis._filterDictionary[ContextGLTextureFilter.LINEAR] = this._gl.LINEAR;\n\t\t\tthis._filterDictionary[ContextGLTextureFilter.NEAREST] = this._gl.NEAREST;\n\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR] = new Object();\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR][ContextGLMipFilter.MIPNEAREST] = this._gl.LINEAR_MIPMAP_NEAREST;\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR][ContextGLMipFilter.MIPLINEAR] = this._gl.LINEAR_MIPMAP_LINEAR;\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR][ContextGLMipFilter.MIPNONE] = this._gl.LINEAR;\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST] = new Object();\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST][ContextGLMipFilter.MIPNEAREST] = this._gl.NEAREST_MIPMAP_NEAREST;\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST][ContextGLMipFilter.MIPLINEAR] = this._gl.NEAREST_MIPMAP_LINEAR;\n\t\t\tthis._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST][ContextGLMipFilter.MIPNONE] = this._gl.NEAREST;\n\n\t\t\tthis._uniformLocationNameDictionary[ContextGLProgramType.VERTEX] = \"vc\";\n\t\t\tthis._uniformLocationNameDictionary[ContextGLProgramType.FRAGMENT] = \"fc\";\n\n\t\t\tthis._vertexBufferDimensionDictionary[ContextGLVertexBufferFormat.FLOAT_1] = 1;\n\t\t\tthis._vertexBufferDimensionDictionary[ContextGLVertexBufferFormat.FLOAT_2] = 2;\n\t\t\tthis._vertexBufferDimensionDictionary[ContextGLVertexBufferFormat.FLOAT_3] = 3;\n\t\t\tthis._vertexBufferDimensionDictionary[ContextGLVertexBufferFormat.FLOAT_4] = 4;\n\t\t\tthis._vertexBufferDimensionDictionary[ContextGLVertexBufferFormat.BYTES_4] = 4;\n\t\t} else {\n\t\t\t//this.dispatchEvent( new away.events.AwayEvent( away.events.AwayEvent.INITIALIZE_FAILED, e ) );\n\t\t\talert(\"WebGL is not available.\");\n\t\t}\n\n\t\t//defaults\n\t\tfor (var i:number = 0; i < ContextWebGL.MAX_SAMPLERS; ++i) {\n\t\t\tthis._samplerStates[i] = new SamplerState();\n\t\t\tthis._samplerStates[i].wrap = this._gl.REPEAT;\n\t\t\tthis._samplerStates[i].filter = this._gl.LINEAR;\n\t\t\tthis._samplerStates[i].mipfilter = this._gl.LINEAR;\n\t\t}\n\t}\n\n\tpublic gl():WebGLRenderingContext\n\t{\n\t\treturn this._gl;\n\t}\n\n\tpublic clear(red:number = 0, green:number = 0, blue:number = 0, alpha:number = 1, depth:number = 1, stencil:number = 0, mask:number = ContextGLClearMask.ALL)\n\t{\n\t\tif (!this._drawing) {\n\t\t\tthis.updateBlendStatus();\n\t\t\tthis._drawing = true;\n\t\t}\n\n\t\tvar glmask:number = 0;\n\t\tif (mask & ContextGLClearMask.COLOR) glmask |= this._gl.COLOR_BUFFER_BIT;\n\t\tif (mask & ContextGLClearMask.STENCIL) glmask |= this._gl.STENCIL_BUFFER_BIT;\n\t\tif (mask & ContextGLClearMask.DEPTH) glmask |= this._gl.DEPTH_BUFFER_BIT;\n\n\t\tthis._gl.clearColor(red, green, blue, alpha);\n\t\tthis._gl.clearDepth(depth);\n\t\tthis._gl.clearStencil(stencil);\n\t\tthis._gl.clear(glmask);\n\t}\n\n\tpublic configureBackBuffer(width:number, height:number, antiAlias:number, enableDepthAndStencil:boolean = true)\n\t{\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\tif (enableDepthAndStencil) {\n\t\t\tthis._gl.enable(this._gl.STENCIL_TEST);\n\t\t\tthis._gl.enable(this._gl.DEPTH_TEST);\n\t\t}\n\n\t\tthis._gl.viewport['width'] = width;\n\t\tthis._gl.viewport['height'] = height;\n\n\t\tthis._gl.viewport(0, 0, width, height);\n\t}\n\n\tpublic createCubeTexture(size:number, format:string, optimizeForRenderToTexture:boolean, streamingLevels:number = 0):CubeTextureWebGL\n\t{\n\t\tvar texture:CubeTextureWebGL = new CubeTextureWebGL(this._gl, size);\n\t\tthis._textureList.push(texture);\n\t\treturn texture;\n\t}\n\n\tpublic createIndexBuffer(numIndices:number):IndexBufferWebGL\n\t{\n\t\tvar indexBuffer:IndexBufferWebGL = new IndexBufferWebGL(this._gl, numIndices);\n\t\tthis._indexBufferList.push(indexBuffer);\n\t\treturn indexBuffer;\n\t}\n\n\tpublic createProgram():ProgramWebGL\n\t{\n\t\tvar program:ProgramWebGL = new ProgramWebGL(this._gl);\n\t\tthis._programList.push(program);\n\t\treturn program;\n\t}\n\n\tpublic createTexture(width:number, height:number, format:string, optimizeForRenderToTexture:boolean, streamingLevels:number = 0):TextureWebGL\n\t{\n\t\t//TODO streaming\n\t\tvar texture:TextureWebGL = new TextureWebGL(this._gl, width, height);\n\t\tthis._textureList.push(texture);\n\t\treturn texture;\n\t}\n\n\tpublic createVertexBuffer(numVertices:number, data32PerVertex:number):VertexBufferWebGL\n\t{\n\t\tvar vertexBuffer:VertexBufferWebGL = new VertexBufferWebGL(this._gl, numVertices, data32PerVertex);\n\t\tthis._vertexBufferList.push(vertexBuffer);\n\t\treturn vertexBuffer;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tvar i:number;\n\t\tfor (i = 0; i < this._indexBufferList.length; ++i)\n\t\t\tthis._indexBufferList[i].dispose();\n\n\t\tthis._indexBufferList = null;\n\n\t\tfor (i = 0; i < this._vertexBufferList.length; ++i)\n\t\t\tthis._vertexBufferList[i].dispose();\n\n\t\tthis._vertexBufferList = null;\n\n\t\tfor (i = 0; i < this._textureList.length; ++i)\n\t\t\tthis._textureList[i].dispose();\n\n\t\tthis._textureList = null;\n\n\t\tfor (i = 0; i < this._programList.length; ++i)\n\t\t\tthis._programList[i].dispose();\n\n\t\tfor (i = 0; i < this._samplerStates.length; ++i)\n\t\t\tthis._samplerStates[i] = null;\n\n\t\tthis._programList = null;\n\t}\n\n\tpublic drawToBitmapData(destination:BitmapData)\n\t{\n\t\tvar arrayBuffer:ArrayBuffer = new ArrayBuffer(destination.width*destination.height*4);\n\n\t\tthis._gl.readPixels(0, 0, destination.width, destination.height, this._gl.RGBA, this._gl.UNSIGNED_BYTE, new Uint8Array(arrayBuffer));\n\n\t\tvar byteArray:ByteArray = new ByteArray();\n\t\tbyteArray.setArrayBuffer(arrayBuffer);\n\n\t\tdestination.setPixels(new Rectangle(0, 0, destination.width, destination.height), byteArray);\n\t}\n\n\tpublic drawTriangles(indexBuffer:IndexBufferWebGL, firstIndex:number = 0, numTriangles:number = -1)\n\t{\n\t\tif (!this._drawing)\n\t\t\tthrow \"Need to clear before drawing if the buffer has not been cleared since the last present() call.\";\n\n\t\tthis._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER, indexBuffer.glBuffer);\n\t\tthis._gl.drawElements(this._gl.TRIANGLES, (numTriangles == -1)? indexBuffer.numIndices : numTriangles*3, this._gl.UNSIGNED_SHORT, firstIndex);\n\t}\n\n\tpublic present()\n\t{\n\t\tthis._drawing = false;\n\t}\n\n\tpublic setBlendFactors(sourceFactor:string, destinationFactor:string)\n\t{\n\t\tthis._blendEnabled = true;\n\n\t\tthis._blendSourceFactor = this._blendFactorDictionary[sourceFactor];\n\n\t\tthis._blendDestinationFactor = this._blendFactorDictionary[destinationFactor];\n\n\t\tthis.updateBlendStatus();\n\t}\n\n\tpublic setColorMask(red:boolean, green:boolean, blue:boolean, alpha:boolean)\n\t{\n\t\tthis._gl.colorMask(red, green, blue, alpha);\n\t}\n\n\tpublic setCulling(triangleFaceToCull:string, coordinateSystem:string = \"leftHanded\")\n\t{\n\t\tif (triangleFaceToCull == ContextGLTriangleFace.NONE) {\n\t\t\tthis._gl.disable(this._gl.CULL_FACE);\n\t\t} else {\n\t\t\tthis._gl.enable(this._gl.CULL_FACE);\n\t\t\tswitch (triangleFaceToCull) {\n\t\t\t\tcase ContextGLTriangleFace.BACK:\n\t\t\t\t\tthis._gl.cullFace((coordinateSystem == \"leftHanded\")? this._gl.FRONT : this._gl.BACK);\n\t\t\t\t\tbreak\n\t\t\t\tcase ContextGLTriangleFace.FRONT:\n\t\t\t\t\tthis._gl.cullFace((coordinateSystem == \"leftHanded\")? this._gl.BACK : this._gl.FRONT);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextGLTriangleFace.FRONT_AND_BACK:\n\t\t\t\t\tthis._gl.cullFace(this._gl.FRONT_AND_BACK);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow \"Unknown ContextGLTriangleFace type.\"; // TODO error\n\t\t\t}\n\t\t}\n\t}\n\n\t// TODO ContextGLCompareMode\n\tpublic setDepthTest(depthMask:boolean, passCompareMode:string)\n\t{\n\t\tthis._gl.depthFunc(this._depthTestDictionary[passCompareMode]);\n\n\t\tthis._gl.depthMask(depthMask);\n\t}\n\n\tpublic setProgram(program:ProgramWebGL)\n\t{\n\t\t//TODO decide on construction/reference resposibilities\n\t\tthis._currentProgram = program;\n\t\tprogram.focusProgram();\n\t}\n\n\tpublic setProgramConstantsFromMatrix(programType:string, firstRegister:number, matrix:Matrix3D, transposedMatrix:boolean = false)\n\t{\n\t\t//this._gl.uniformMatrix4fv(this._gl.getUniformLocation(this._currentProgram.glProgram, this._uniformLocationNameDictionary[programType]), !transposedMatrix, new Float32Array(matrix.rawData));\n\n\t\t//TODO remove special case for WebGL matrix calls?\n\t\tvar d:number[] = matrix.rawData;\n\t\tif (transposedMatrix) {\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister, [ d[0], d[4], d[8], d[12] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 1, [ d[1], d[5], d[9], d[13] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 2, [ d[2], d[6], d[10], d[14] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 3, [ d[3], d[7], d[11], d[15] ], 1);\n\t\t} else {\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister, [ d[0], d[1], d[2], d[3] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 1, [ d[4], d[5], d[6], d[7] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 2, [ d[8], d[9], d[10], d[11] ], 1);\n\t\t\tthis.setProgramConstantsFromArray(programType, firstRegister + 3, [ d[12], d[13], d[14], d[15] ], 1);\n\t\t}\n\t}\n\n\tpublic static modulo:number = 0;\n\n\tpublic setProgramConstantsFromArray(programType:string, firstRegister:number, data:number[], numRegisters:number = -1)\n\t{\n\t\tvar locationName:string = this._uniformLocationNameDictionary[programType];\n\t\tvar startIndex:number;\n\t\tfor (var i:number = 0; i < numRegisters; i++) {\n\t\t\tstartIndex = i*4;\n\t\t\tthis._gl.uniform4f(this._gl.getUniformLocation(this._currentProgram.glProgram, locationName + (firstRegister + i)), data[startIndex], data[startIndex + 1], data[startIndex + 2], data[startIndex + 3]);\n\t\t}\n\t}\n\n\tpublic setScissorRectangle(rectangle:Rectangle)\n\t{\n\t\tif (!rectangle) {\n\t\t\tthis._gl.disable(this._gl.SCISSOR_TEST);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._gl.enable(this._gl.SCISSOR_TEST);\n\t\tthis._gl.scissor(rectangle.x, rectangle.y, rectangle.width, rectangle.height);\n\t}\n\n\tpublic setTextureAt(sampler:number, texture:TextureBaseWebGL)\n\t{\n\t\tvar samplerState:SamplerState = this._samplerStates[sampler];\n\n\t\tif (this._activeTexture != sampler && (texture || samplerState.type)) {\n\t\t\tthis._activeTexture = sampler;\n\t\t\tthis._gl.activeTexture(this._textureIndexDictionary[sampler]);\n\t\t}\n\n\t\tif (!texture) {\n\t\t\tif (samplerState.type) {\n\t\t\t\tthis._gl.bindTexture(samplerState.type, null);\n\t\t\t\tsamplerState.type = null;\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tvar textureType:number = this._textureTypeDictionary[texture.textureType];\n\t\tsamplerState.type = textureType;\n\n\t\tthis._gl.bindTexture(textureType, texture.glTexture);\n\n\t\tthis._gl.uniform1i(this._gl.getUniformLocation(this._currentProgram.glProgram, \"fs\" + sampler), sampler);\n\n\t\tthis._gl.texParameteri(textureType, this._gl.TEXTURE_WRAP_S, samplerState.wrap);\n\t\tthis._gl.texParameteri(textureType, this._gl.TEXTURE_WRAP_T, samplerState.wrap);\n\n\t\tthis._gl.texParameteri(textureType, this._gl.TEXTURE_MAG_FILTER, samplerState.filter);\n\t\tthis._gl.texParameteri(textureType, this._gl.TEXTURE_MIN_FILTER, samplerState.mipfilter);\n\t}\n\n\tpublic setSamplerStateAt(sampler:number, wrap:string, filter:string, mipfilter:string):void\n\t{\n\t\tif (0 <= sampler && sampler < ContextWebGL.MAX_SAMPLERS) {\n\t\t\tthis._samplerStates[sampler].wrap = this._wrapDictionary[wrap];\n\t\t\tthis._samplerStates[sampler].filter = this._filterDictionary[filter];\n\t\t\tthis._samplerStates[sampler].mipfilter = this._mipmapFilterDictionary[filter][mipfilter];\n\t\t} else {\n\t\t\tthrow \"Sampler is out of bounds.\";\n\t\t}\n\t}\n\n\tpublic setVertexBufferAt(index:number, buffer:VertexBufferWebGL, bufferOffset:number = 0, format:string = null)\n\t{\n\t\tvar location:number = this._currentProgram? this._gl.getAttribLocation(this._currentProgram.glProgram, \"va\" + index) : -1;\n\n\t\tif (!buffer) {\n\t\t\tif (location > -1)\n\t\t\t\tthis._gl.disableVertexAttribArray(location);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._gl.bindBuffer(this._gl.ARRAY_BUFFER, buffer.glBuffer);\n\t\tthis._gl.enableVertexAttribArray(location);\n\t\tthis._gl.vertexAttribPointer(location, this._vertexBufferDimensionDictionary[format], this._gl.FLOAT, false, buffer.data32PerVertex*4, bufferOffset*4);\n\t}\n\n\tpublic setRenderToTexture(target:TextureBaseWebGL, enableDepthAndStencil:boolean = false, antiAlias:number = 0, surfaceSelector:number = 0)\n\t{\n\t\tvar texture:TextureWebGL = <TextureWebGL> target;\n\t\tvar frameBuffer:WebGLFramebuffer = texture.frameBuffer;\n\t\tthis._gl.bindFramebuffer(this._gl.FRAMEBUFFER, frameBuffer);\n\n\t\tif (enableDepthAndStencil) {\n\t\t\tthis._gl.enable(this._gl.STENCIL_TEST);\n\t\t\tthis._gl.enable(this._gl.DEPTH_TEST);\n\t\t}\n\n\t\tthis._gl.viewport(0, 0, texture.width, texture.height );\n\t}\n\n\tpublic setRenderToBackBuffer()\n\t{\n\t\tthis._gl.bindFramebuffer(this._gl.FRAMEBUFFER, null);\n\t}\n\n\tprivate updateBlendStatus()\n\t{\n\t\tif (this._blendEnabled) {\n\t\t\tthis._gl.enable(this._gl.BLEND);\n\t\t\tthis._gl.blendEquation(this._gl.FUNC_ADD);\n\t\t\tthis._gl.blendFunc(this._blendSourceFactor, this._blendDestinationFactor);\n\t\t} else {\n\t\t\tthis._gl.disable(this._gl.BLEND);\n\t\t}\n\t}\n}\n\nexport = ContextWebGL;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\nimport ByteArrayBase\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArrayBase\");\n\nimport ContextStage3D\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextStage3D\");\nimport ICubeTexture\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ICubeTexture\");\nimport OpCodes\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/OpCodes\");\nimport ResourceBaseFlash\t\t\t= require(\"awayjs-stagegl/lib/base/ResourceBaseFlash\");\n\nclass CubeTextureFlash extends ResourceBaseFlash implements ICubeTexture\n{\n\tprivate _context:ContextStage3D;\n\tprivate _size:number;\n\n\tpublic get size():number\n\t{\n\t\treturn this._size;\n\t}\n\n\tconstructor(context:ContextStage3D, size:number, format:string, forRTT:boolean, streaming:boolean = false)\n\t{\n\t\tsuper();\n\n\t\tthis._context = context;\n\t\tthis._size = size;\n\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.initCubeTexture, (forRTT? OpCodes.trueValue : OpCodes.falseValue)) + size + \",\" + streaming + \",\" + format + \"$\");\n\t\tthis._pId = this._context.execute();\n\t\tthis._context._iAddResource(this);\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.disposeCubeTexture) + this._pId.toString() + \",\");\n\t\tthis._context.execute();\n\t\tthis._context._iRemoveResource(this);\n\n\t\tthis._context = null;\n\t}\n\n\tpublic uploadFromData(bitmapData:BitmapData, side:number, miplevel?:number);\n\tpublic uploadFromData(image:HTMLImageElement, side:number, miplevel?:number);\n\tpublic uploadFromData(data:any, side:number, miplevel:number = 0)\n\t{\n\t\tif (data instanceof BitmapData) {\n\t\t\tdata = (<BitmapData> data).imageData.data;\n\t\t} else if (data instanceof HTMLImageElement) {\n\t\t\tvar can = document.createElement(\"canvas\");\n\t\t\tvar w = data.width;\n\t\t\tvar h = data.height;\n\t\t\tcan.width = w;\n\t\t\tcan.height = h;\n\t\t\tvar ctx = can.getContext(\"2d\");\n\t\t\tctx.drawImage(data, 0, 0);\n\t\t\tdata = ctx.getImageData(0, 0, w, h).data;\n\t\t}\n\n\t\tvar pos = 0;\n\t\tvar bytes = ByteArrayBase.internalGetBase64String(data.length, function () {\n\t\t\treturn data[pos++];\n\t\t}, null);\n\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.uploadBytesCubeTexture) + this._pId + \",\" + miplevel + \",\" + side + \",\" + (this.size >> miplevel) + \",\" + bytes + \"%\");\n\t\tthis._context.execute();\n\t}\n\n\tpublic uploadCompressedTextureFromByteArray(data:ByteArray, byteArrayOffset:number /*uint*/, async:boolean = false)\n\t{\n\n\t}\n}\n\nexport = CubeTextureFlash;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport ICubeTexture\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ICubeTexture\");\nimport TextureBaseWebGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/TextureBaseWebGL\");\n\nclass CubeTextureWebGL extends TextureBaseWebGL implements ICubeTexture\n{\n\n\tprivate _textureSelectorDictionary:Array<number> = new Array<number>(6);\n\n\tpublic textureType:string = \"textureCube\";\n\tprivate _texture:WebGLTexture;\n\tprivate _size:number;\n\n\tconstructor(gl:WebGLRenderingContext, size:number)\n\t{\n\t\tsuper(gl);\n\t\tthis._size = size;\n\t\tthis._texture = this._gl.createTexture();\n\n\t\tthis._textureSelectorDictionary[0] = gl.TEXTURE_CUBE_MAP_POSITIVE_X;\n\t\tthis._textureSelectorDictionary[1] = gl.TEXTURE_CUBE_MAP_NEGATIVE_X;\n\t\tthis._textureSelectorDictionary[2] = gl.TEXTURE_CUBE_MAP_POSITIVE_Y;\n\t\tthis._textureSelectorDictionary[3] = gl.TEXTURE_CUBE_MAP_NEGATIVE_Y;\n\t\tthis._textureSelectorDictionary[4] = gl.TEXTURE_CUBE_MAP_POSITIVE_Z;\n\t\tthis._textureSelectorDictionary[5] = gl.TEXTURE_CUBE_MAP_NEGATIVE_Z;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._gl.deleteTexture(this._texture);\n\t}\n\n\tpublic uploadFromData(bitmapData:BitmapData, side:number, miplevel?:number);\n\tpublic uploadFromData(image:HTMLImageElement, side:number, miplevel?:number);\n\tpublic uploadFromData(data:any, side:number, miplevel:number = 0)\n\t{\n\t\tif (data instanceof BitmapData)\n\t\t\tdata = (<BitmapData> data).imageData;\n\n\t\tthis._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP, this._texture);\n\t\tthis._gl.texImage2D(this._textureSelectorDictionary[side], miplevel, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, data);\n\t\tthis._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP, null);\n\t}\n\n\tpublic uploadCompressedTextureFromByteArray(data:ByteArray, byteArrayOffset:number /*uint*/, async:boolean = false)\n\t{\n\n\t}\n\n\tpublic get size():number\n\t{\n\t\treturn this._size;\n\t}\n\n\tpublic get glTexture():WebGLTexture\n\t{\n\t\treturn this._texture;\n\t}\n}\n\nexport = CubeTextureWebGL;","import ContextStage3D\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextStage3D\");\nimport IIndexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IIndexBuffer\");\nimport OpCodes\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/OpCodes\");\nimport ResourceBaseFlash\t\t\t= require(\"awayjs-stagegl/lib/base/ResourceBaseFlash\");\n\nclass IndexBufferFlash extends ResourceBaseFlash implements IIndexBuffer\n{\n\tprivate _context:ContextStage3D;\n\tprivate _numIndices:number;\n\n\tconstructor(context:ContextStage3D, numIndices:number)\n\t{\n\t\tsuper();\n\n\t\tthis._context = context;\n\t\tthis._numIndices = numIndices;\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.initIndexBuffer, numIndices + OpCodes.intMask));\n\t\tthis._pId = this._context.execute();\n\t\tthis._context._iAddResource(this);\n\t}\n\n\tpublic uploadFromArray(data:number[], startOffset:number, count:number):void\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.uploadArrayIndexBuffer, this._pId + OpCodes.intMask) + data.join() + \"#\" + startOffset + \",\" + count + \",\");\n\t\tthis._context.execute();\n\t}\n\n\tpublic dispose():void\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.disposeIndexBuffer, this._pId + OpCodes.intMask));\n\t\tthis._context.execute();\n\t\tthis._context._iRemoveResource(this);\n\n\t\tthis._context = null;\n\t}\n\n\tpublic get numIndices():number\n\t{\n\t\treturn this._numIndices;\n\t}\n}\n\nexport = IndexBufferFlash;","import IIndexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IIndexBuffer\");\n\nclass IndexBufferWebGL implements IIndexBuffer\n{\n\n\tprivate _gl:WebGLRenderingContext;\n\tprivate _numIndices:number;\n\tprivate _buffer:WebGLBuffer;\n\n\tconstructor(gl:WebGLRenderingContext, numIndices:number)\n\t{\n\t\tthis._gl = gl;\n\t\tthis._buffer = this._gl.createBuffer();\n\t\tthis._numIndices = numIndices;\n\t}\n\n\tpublic uploadFromArray(data:number[], startOffset:number, count:number):void\n\t{\n\t\tthis._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER, this._buffer);\n\n\t\t// TODO add index offsets\n\t\tthis._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(data), this._gl.STATIC_DRAW);\n\t}\n\n\tpublic dispose():void\n\t{\n\t\tthis._gl.deleteBuffer(this._buffer);\n\t}\n\n\tpublic get numIndices():number\n\t{\n\t\treturn this._numIndices;\n\t}\n\n\tpublic get glBuffer():WebGLBuffer\n\t{\n\t\treturn this._buffer;\n\t}\n}\n\nexport = IndexBufferWebGL;","class OpCodes\n{\n\tpublic static trueValue:number = 32;\n\tpublic static falseValue:number = 33;\n\tpublic static intMask:number = 63;\n\tpublic static drawTriangles:number = 41;\n\tpublic static setProgramConstant:number = 42;\n\tpublic static setProgram:number = 43;\n\tpublic static present:number = 44;\n\tpublic static clear:number = 45;\n\tpublic static initProgram:number = 46;\n\tpublic static initVertexBuffer:number = 47;\n\tpublic static initIndexBuffer:number = 48;\n\tpublic static configureBackBuffer:number = 49;\n\tpublic static uploadArrayIndexBuffer:number = 50;\n\tpublic static uploadArrayVertexBuffer:number = 51;\n\tpublic static uploadAGALBytesProgram:number = 52;\n\tpublic static setVertexBufferAt:number = 53;\n\tpublic static uploadBytesIndexBuffer:number = 54;\n\tpublic static uploadBytesVertexBuffer:number = 55;\n\tpublic static setColorMask:number = 56;\n\tpublic static setDepthTest:number = 57;\n\tpublic static disposeProgram:number = 58;\n\tpublic static disposeContext:number = 59;\n\t// must skip 60 '<' as it will invalidate xml being passed over the bridge\n\tpublic static disposeVertexBuffer:number = 61;\n\t// must skip 62 '>' as it will invalidate xml being passed over the bridge\n\tpublic static disposeIndexBuffer:number = 63;\n\tpublic static initTexture:number = 64;\n\tpublic static setTextureAt:number = 65;\n\tpublic static uploadBytesTexture:number = 66;\n\tpublic static disposeTexture:number = 67;\n\tpublic static setCulling:number = 68;\n\tpublic static setScissorRect:number = 69;\n\tpublic static clearScissorRect:number = 70;\n\tpublic static setBlendFactors:number = 71;\n\tpublic static setRenderToTexture:number = 72;\n\tpublic static clearTextureAt:number = 73;\n\tpublic static clearVertexBufferAt:number = 74;\n\tpublic static setStencilActions:number = 75;\n\tpublic static setStencilReferenceValue:number = 76;\n\tpublic static initCubeTexture:number = 77;\n\tpublic static disposeCubeTexture:number = 78;\n\tpublic static uploadBytesCubeTexture:number = 79;\n\tpublic static clearRenderToTexture:number = 80;\n\tpublic static enableErrorChecking:number = 81;\n}\n\nexport = OpCodes;","import ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport ContextStage3D\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextStage3D\");\nimport IProgram\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IProgram\");\nimport OpCodes\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/OpCodes\");\nimport ResourceBaseFlash\t\t\t= require(\"awayjs-stagegl/lib/base/ResourceBaseFlash\");\n\nclass ProgramFlash extends ResourceBaseFlash implements IProgram\n{\n\tprivate _context:ContextStage3D;\n\n\tconstructor(context:ContextStage3D)\n\t{\n\t\tsuper();\n\n\t\tthis._context = context;\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.initProgram));\n\t\tthis._pId = this._context.execute();\n\t\tthis._context._iAddResource(this);\n\t}\n\n\tpublic upload(vertexProgram:ByteArray, fragmentProgram:ByteArray)\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.uploadAGALBytesProgram, this._pId + OpCodes.intMask) + vertexProgram.readBase64String(vertexProgram.length) + \"%\" + fragmentProgram.readBase64String(fragmentProgram.length) + \"%\");\n\n\t\tif (ContextStage3D.debug)\n\t\t\tthis._context.execute();\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.disposeProgram, this._pId + OpCodes.intMask));\n\t\tthis._context.execute();\n\t\tthis._context._iRemoveResource(this);\n\n\t\tthis._context = null;\n\t}\n}\n\nexport = ProgramFlash;","import ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport AGALTokenizer\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/AGALTokenizer\");\nimport AGLSLParser\t\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/AGLSLParser\");\nimport IProgram\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IProgram\");\n\n\nclass ProgramWebGL implements IProgram\n{\n\tprivate static _tokenizer:AGALTokenizer = new AGALTokenizer();\n\tprivate static _aglslParser:AGLSLParser = new AGLSLParser();\n\n\tprivate _gl:WebGLRenderingContext;\n\tprivate _program:WebGLProgram;\n\tprivate _vertexShader:WebGLShader;\n\tprivate _fragmentShader:WebGLShader;\n\n\tconstructor(gl:WebGLRenderingContext)\n\t{\n\t\tthis._gl = gl;\n\t\tthis._program = this._gl.createProgram();\n\t}\n\n\tpublic upload(vertexProgram:ByteArray, fragmentProgram:ByteArray)\n\t{\n\t\tvar vertexString:string = ProgramWebGL._aglslParser.parse(ProgramWebGL._tokenizer.decribeAGALByteArray(vertexProgram));\n\t\tvar fragmentString:string = ProgramWebGL._aglslParser.parse(ProgramWebGL._tokenizer.decribeAGALByteArray(fragmentProgram));\n\n\t\tthis._vertexShader = this._gl.createShader(this._gl.VERTEX_SHADER);\n\t\tthis._fragmentShader = this._gl.createShader(this._gl.FRAGMENT_SHADER);\n\n\t\tthis._gl.shaderSource(this._vertexShader, vertexString);\n\t\tthis._gl.compileShader(this._vertexShader);\n\n\t\tif (!this._gl.getShaderParameter(this._vertexShader, this._gl.COMPILE_STATUS)) {\n\t\t\tthrow new Error(this._gl.getShaderInfoLog(this._vertexShader));\n\t\t\treturn;\n\t\t}\n\n\t\tthis._gl.shaderSource(this._fragmentShader, fragmentString);\n\t\tthis._gl.compileShader(this._fragmentShader);\n\n\t\tif (!this._gl.getShaderParameter(this._fragmentShader, this._gl.COMPILE_STATUS)) {\n\t\t\tthrow new Error(this._gl.getShaderInfoLog(this._fragmentShader));\n\t\t\treturn;\n\t\t}\n\n\t\tthis._gl.attachShader(this._program, this._vertexShader);\n\t\tthis._gl.attachShader(this._program, this._fragmentShader);\n\t\tthis._gl.linkProgram(this._program);\n\n\t\tif (!this._gl.getProgramParameter(this._program, this._gl.LINK_STATUS)) {\n\t\t\tthrow new Error(this._gl.getProgramInfoLog(this._program));\n\t\t}\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._gl.deleteProgram(this._program);\n\t}\n\n\tpublic focusProgram()\n\t{\n\t\tthis._gl.useProgram(this._program);\n\t}\n\n\tpublic get glProgram():WebGLProgram\n\t{\n\t\treturn this._program;\n\t}\n}\n\nexport = ProgramWebGL;","class ResourceBaseFlash\n{\n\tpublic _pId:number;\n\n\tpublic get id():number\n\t{\n\t\treturn this._pId;\n\t}\n\n\tpublic dispose()\n\t{\n\n\t}\n}\n\nexport = ResourceBaseFlash;","class SamplerState\n{\n\tpublic type:number;\n\tpublic wrap:number;\n\tpublic filter:number;\n\tpublic mipfilter:number;\n}\n\nexport = SamplerState;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\nimport CubeTextureBase\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\nimport RenderTexture\t\t\t\t= require(\"awayjs-core/lib/textures/RenderTexture\");\nimport Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\nimport TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\nimport CSS\t\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/CSS\");\n\nimport ContextMode\t\t\t\t\t= require(\"awayjs-display/lib/display/ContextMode\");\nimport StageEvent\t\t\t\t\t= require(\"awayjs-display/lib/events/StageEvent\");\n\nimport ContextGLTextureFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFormat\");\nimport ContextGLMipFilter\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLMipFilter\");\nimport ContextGLTextureFilter\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFilter\");\nimport ContextGLWrapMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLWrapMode\");\nimport ContextStage3D\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextStage3D\");\nimport ContextWebGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextWebGL\");\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport ICubeTexture\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ICubeTexture\");\nimport IIndexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IIndexBuffer\");\nimport ITexture\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITexture\");\nimport ITextureBase\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITextureBase\");\nimport IndexData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/IndexData\");\nimport TextureData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/TextureData\");\nimport TextureDataPool\t\t\t\t= require(\"awayjs-stagegl/lib/pool/TextureDataPool\");\nimport ProgramData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/ProgramData\");\nimport ProgramDataPool\t\t\t\t= require(\"awayjs-stagegl/lib/pool/ProgramDataPool\");\nimport VertexData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/VertexData\");\nimport StageManager\t\t\t\t\t= require(\"awayjs-stagegl/lib/managers/StageManager\");\n\n/**\n * Stage provides a proxy class to handle the creation and attachment of the Context\n * (and in turn the back buffer) it uses. Stage should never be created directly,\n * but requested through StageManager.\n *\n * @see away.managers.StageManager\n *\n */\nclass Stage extends EventDispatcher\n{\n\tprivate _programData:Array<ProgramData> = new Array<ProgramData>();\n\tprivate _texturePool:TextureDataPool;\n\tprivate _programDataPool:ProgramDataPool;\n\tprivate _context:IContextGL;\n\tprivate _container:HTMLElement;\n\tprivate _width:number;\n\tprivate _height:number;\n\tprivate _x:number = 0;\n\tprivate _y:number = 0;\n\n\t//private static _frameEventDriver:Shape = new Shape(); // TODO: add frame driver / request animation frame\n\n\tprivate _stageIndex:number = -1;\n\n\tprivate _usesSoftwareRendering:boolean;\n\tprivate _profile:string;\n\tprivate _stageManager:StageManager;\n\tprivate _antiAlias:number = 0;\n\tprivate _enableDepthAndStencil:boolean;\n\tprivate _contextRequested:boolean;\n\n\t//private var _activeVertexBuffers : Vector.<VertexBuffer> = new Vector.<VertexBuffer>(8, true);\n\t//private var _activeTextures : Vector.<TextureBase> = new Vector.<TextureBase>(8, true);\n\tprivate _renderTarget:TextureProxyBase = null;\n\tprivate _renderSurfaceSelector:number = 0;\n\tprivate _scissorRect:Rectangle;\n\tprivate _color:number;\n\tprivate _backBufferDirty:boolean;\n\tprivate _viewPort:Rectangle;\n\tprivate _enterFrame:Event;\n\tprivate _exitFrame:Event;\n\tprivate _viewportUpdated:StageEvent;\n\tprivate _viewportDirty:boolean;\n\tprivate _bufferClear:boolean;\n\n\t//private _mouse3DManager:away.managers.Mouse3DManager;\n\t//private _touch3DManager:Touch3DManager; //TODO: imeplement dependency Touch3DManager\n\n\tprivate _initialised:boolean = false;\n\n\tconstructor(container:HTMLCanvasElement, stageIndex:number, stageManager:StageManager, forceSoftware:boolean = false, profile:string = \"baseline\")\n\t{\n\t\tsuper();\n\n\t\tthis._texturePool = new TextureDataPool();\n\t\tthis._programDataPool = new ProgramDataPool(this);\n\n\t\tthis._container = container;\n\n\t\tthis._stageIndex = stageIndex;\n\n\t\tthis._stageManager = stageManager;\n\n\t\tthis._viewPort = new Rectangle();\n\n\t\tthis._enableDepthAndStencil = true;\n\n\t\tCSS.setElementX(this._container, 0);\n\t\tCSS.setElementY(this._container, 0);\n\n\t\tthis.visible = true;\n\t}\n\n\tpublic getProgramData(vertexString:string, fragmentString:string):ProgramData\n\t{\n\t\treturn this._programDataPool.getItem(vertexString, fragmentString);\n\t}\n\n\tpublic setRenderTarget(target:TextureProxyBase, enableDepthAndStencil:boolean = false, surfaceSelector:number = 0)\n\t{\n\t\tif (this._renderTarget === target && surfaceSelector == this._renderSurfaceSelector && this._enableDepthAndStencil == enableDepthAndStencil)\n\t\t\treturn;\n\n\t\tthis._renderTarget = target;\n\t\tthis._renderSurfaceSelector = surfaceSelector;\n\t\tthis._enableDepthAndStencil = enableDepthAndStencil;\n\t\tif (target instanceof RenderTexture) {\n\t\t\tthis._context.setRenderToTexture(this.getRenderTexture(<RenderTexture> target), enableDepthAndStencil, this._antiAlias, surfaceSelector);\n\t\t} else {\n\t\t\tthis._context.setRenderToBackBuffer();\n\t\t\tthis.configureBackBuffer(this._width, this._height, this._antiAlias, this._enableDepthAndStencil);\n\t\t}\n\t}\n\n\tpublic getRenderTexture(textureProxy:RenderTexture):ITextureBase\n\t{\n\t\tvar textureData:TextureData = this._texturePool.getItem(textureProxy, false);\n\n\t\tif (!textureData.texture)\n\t\t\ttextureData.texture = this._context.createTexture(textureProxy.width, textureProxy.height, ContextGLTextureFormat.BGRA, true);\n\n\t\treturn textureData.texture;\n\t}\n\n\t/**\n\t * Assigns an attribute stream\n\t *\n\t * @param index The attribute stream index for the vertex shader\n\t * @param buffer\n\t * @param offset\n\t * @param stride\n\t * @param format\n\t */\n\tpublic activateBuffer(index:number, buffer:VertexData, offset:number, format:string)\n\t{\n\t\tif (!buffer.contexts[this._stageIndex])\n\t\t\tbuffer.contexts[this._stageIndex] = this._context;\n\n\t\tif (!buffer.buffers[this._stageIndex]) {\n\t\t\tbuffer.buffers[this._stageIndex] = this._context.createVertexBuffer(buffer.data.length/buffer.dataPerVertex, buffer.dataPerVertex);\n\t\t\tbuffer.invalid[this._stageIndex] = true;\n\t\t}\n\n\t\tif (buffer.invalid[this._stageIndex]) {\n\t\t\tbuffer.buffers[this._stageIndex].uploadFromArray(buffer.data, 0, buffer.data.length/buffer.dataPerVertex);\n\t\t\tbuffer.invalid[this._stageIndex] = false;\n\t\t}\n\n\t\tthis._context.setVertexBufferAt(index, buffer.buffers[this._stageIndex], offset, format);\n\t}\n\n\tpublic disposeVertexData(buffer:VertexData)\n\t{\n\t\tbuffer.buffers[this._stageIndex].dispose();\n\t\tbuffer.buffers[this._stageIndex] = null;\n\t}\n\n\tpublic activateRenderTexture(index:number, textureProxy:RenderTexture)\n\t{\n\t\tthis._setSamplerState(index, false, false, false);\n\n\t\tthis._context.setTextureAt(index, this.getRenderTexture(textureProxy));\n\t}\n\n\tpublic activateTexture(index:number, textureProxy:Texture2DBase, repeat:boolean, smooth:boolean, mipmap:boolean)\n\t{\n\t\tthis._setSamplerState(index, repeat, smooth, mipmap);\n\n\t\tvar textureData:TextureData = <TextureData> this._texturePool.getItem(textureProxy, mipmap);\n\n\t\tif (!textureData.texture) {\n\t\t\ttextureData.texture = this._context.createTexture(textureProxy.width, textureProxy.height, ContextGLTextureFormat.BGRA, true);\n\t\t\ttextureData.invalid = true;\n\t\t}\n\n\t\tif (textureData.invalid) {\n\t\t\ttextureData.invalid = false;\n\t\t\tif (mipmap) {\n\t\t\t\tvar mipmapData:Array<BitmapData> = textureProxy._iGetMipmapData();\n\t\t\t\tvar len:number = mipmapData.length;\n\t\t\t\tfor (var i:number = 0; i < len; i++)\n\t\t\t\t\t(<ITexture> textureData.texture).uploadFromData(mipmapData[i], i);\n\t\t\t} else {\n\t\t\t\t(<ITexture> textureData.texture).uploadFromData(textureProxy._iGetTextureData(), 0);\n\t\t\t}\n\t\t}\n\n\t\tthis._context.setTextureAt(index, textureData.texture);\n\t}\n\n\tpublic activateCubeTexture(index:number, textureProxy:CubeTextureBase, smooth:boolean, mipmap:boolean)\n\t{\n\t\tthis._setSamplerState(index, false, smooth, mipmap);\n\n\t\tvar textureData:TextureData = <TextureData> this._texturePool.getItem(textureProxy, mipmap);\n\n\t\tif (!textureData.texture) {\n\t\t\ttextureData.texture = this._context.createCubeTexture(textureProxy.size, ContextGLTextureFormat.BGRA, false);\n\t\t\ttextureData.invalid = true;\n\t\t}\n\n\t\tif (textureData.invalid) {\n\t\t\ttextureData.invalid = false;\n\t\t\tfor (var i:number = 0; i < 6; ++i) {\n\t\t\t\tif (mipmap) {\n\t\t\t\t\tvar mipmapData:Array<BitmapData> = textureProxy._iGetMipmapData(i);\n\t\t\t\t\tvar len:number = mipmapData.length;\n\t\t\t\t\tfor (var j:number = 0; j < len; j++)\n\t\t\t\t\t\t(<ICubeTexture> textureData.texture).uploadFromData(mipmapData[j], i, j);\n\t\t\t\t} else {\n\t\t\t\t\t(<ICubeTexture> textureData.texture).uploadFromData(textureProxy._iGetTextureData(i), i, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._context.setTextureAt(index, textureData.texture);\n\t}\n\n\t/**\n\t * Retrieves the VertexBuffer object that contains triangle indices.\n\t * @param context The ContextWeb for which we request the buffer\n\t * @return The VertexBuffer object that contains triangle indices.\n\t */\n\tpublic getIndexBuffer(buffer:IndexData):IIndexBuffer\n\t{\n\t\tif (!buffer.contexts[this._stageIndex])\n\t\t\tbuffer.contexts[this._stageIndex] = this._context;\n\n\t\tif (!buffer.buffers[this._stageIndex]) {\n\t\t\tbuffer.buffers[this._stageIndex] = this._context.createIndexBuffer(buffer.data.length);\n\t\t\tbuffer.invalid[this._stageIndex] = true;\n\t\t}\n\n\t\tif (buffer.invalid[this._stageIndex]) {\n\t\t\tbuffer.buffers[this._stageIndex].uploadFromArray(buffer.data, 0, buffer.data.length);\n\t\t\tbuffer.invalid[this._stageIndex] = false;\n\t\t}\n\n\t\treturn buffer.buffers[this._stageIndex];\n\t}\n\n\tpublic disposeIndexData(buffer:IndexData)\n\t{\n\t\tbuffer.buffers[this._stageIndex].dispose();\n\t\tbuffer.buffers[this._stageIndex] = null;\n\t}\n\n\t/**\n\t * Requests a Context object to attach to the managed gl canvas.\n\t */\n\tpublic requestContext(forceSoftware:boolean = false, profile:string = \"baseline\", mode:string = \"auto\")\n\t{\n\t\t// If forcing software, we can be certain that the\n\t\t// returned Context will be running software mode.\n\t\t// If not, we can't be sure and should stick to the\n\t\t// old value (will likely be same if re-requesting.)\n\n\t\tif (this._usesSoftwareRendering != null)\n\t\t\tthis._usesSoftwareRendering = forceSoftware;\n\n\t\tthis._profile = profile;\n\n\t\ttry {\n\t\t\tif (mode == ContextMode.FLASH)\n\t\t\t\tnew ContextStage3D(<HTMLCanvasElement> this._container, (context:IContextGL) => this._callback(context));\n\t\t\telse\n\t\t\t\tthis._context = new ContextWebGL(<HTMLCanvasElement> this._container);\n\n\t\t} catch (e) {\n\t\t\ttry {\n\t\t\t\tif (mode == ContextMode.AUTO)\n\t\t\t\t\tnew ContextStage3D(<HTMLCanvasElement> this._container, (context:IContextGL) => this._callback(context));\n\t\t\t\telse\n\t\t\t\t\tthis.dispatchEvent(new Event(Event.ERROR));\n\t\t\t} catch (e) {\n\t\t\t\tthis.dispatchEvent(new Event(Event.ERROR));\n\t\t\t}\n\n\t\t}\n\n\t\tif (this._context)\n\t\t\tthis._callback(this._context);\n\t}\n\n\t/**\n\t * The width of the gl canvas\n\t */\n\tpublic get width()\n\t{\n\t\treturn this._width;\n\t}\n\n\tpublic set width(val:number)\n\t{\n\t\tif (this._width == val)\n\t\t\treturn;\n\n\t\tCSS.setElementWidth(this._container, val);\n\n\t\tthis._width = this._viewPort.width = val;\n\n\t\tthis._backBufferDirty = true;\n\n\t\tthis.notifyViewportUpdated();\n\t}\n\n\t/**\n\t * The height of the gl canvas\n\t */\n\tpublic get height()\n\t{\n\t\treturn this._height;\n\t}\n\n\tpublic set height(val:number)\n\t{\n\t\tif (this._height == val)\n\t\t\treturn;\n\n\t\tCSS.setElementHeight(this._container, val);\n\n\t\tthis._height = this._viewPort.height = val;\n\n\t\tthis._backBufferDirty = true;\n\n\t\tthis.notifyViewportUpdated();\n\t}\n\n\t/**\n\t * The x position of the gl canvas\n\t */\n\tpublic get x()\n\t{\n\t\treturn this._x;\n\t}\n\n\tpublic set x(val:number)\n\t{\n\t\tif (this._x == val)\n\t\t\treturn;\n\n\t\tCSS.setElementX(this._container, val);\n\n\t\tthis._x = this._viewPort.x = val;\n\n\t\tthis.notifyViewportUpdated();\n\t}\n\n\t/**\n\t * The y position of the gl canvas\n\t */\n\tpublic get y()\n\t{\n\t\treturn this._y;\n\t}\n\n\tpublic set y(val:number)\n\t{\n\t\tif (this._y == val)\n\t\t\treturn;\n\n\t\tCSS.setElementY(this._container, val);\n\n\t\tthis._y = this._viewPort.y = val;\n\n\t\tthis.notifyViewportUpdated();\n\t}\n\n\tpublic set visible(val:boolean)\n\t{\n\t\tCSS.setElementVisibility(this._container, val);\n\t}\n\n\tpublic get visible()\n\t{\n\t\treturn CSS.getElementVisibility(this._container);\n\t}\n\n\tpublic get container():HTMLElement\n\t{\n\t\treturn this._container;\n\t}\n\n\t/**\n\t * The Context object associated with the given stage object.\n\t */\n\tpublic get context():IContextGL\n\t{\n\t\treturn this._context;\n\t}\n\n\tprivate notifyViewportUpdated()\n\t{\n\t\tif (this._viewportDirty)\n\t\t\treturn;\n\n\t\tthis._viewportDirty = true;\n\n\t\t//if (!this.hasEventListener(StageEvent.VIEWPORT_UPDATED))\n\t\t//return;\n\n\t\t//if (!_viewportUpdated)\n\t\tthis._viewportUpdated = new StageEvent(StageEvent.VIEWPORT_UPDATED);\n\n\t\tthis.dispatchEvent(this._viewportUpdated);\n\t}\n\n\tprivate notifyEnterFrame()\n\t{\n\t\t//if (!hasEventListener(Event.ENTER_FRAME))\n\t\t//return;\n\n\t\tif (!this._enterFrame)\n\t\t\tthis._enterFrame = new Event(Event.ENTER_FRAME);\n\n\t\tthis.dispatchEvent(this._enterFrame);\n\n\t}\n\n\tprivate notifyExitFrame()\n\t{\n\t\t//if (!hasEventListener(Event.EXIT_FRAME))\n\t\t//return;\n\n\t\tif (!this._exitFrame)\n\t\t\tthis._exitFrame = new Event(Event.EXIT_FRAME);\n\n\t\tthis.dispatchEvent(this._exitFrame);\n\t}\n\n\tpublic get profile():string\n\t{\n\t\treturn this._profile;\n\t}\n\n\t/**\n\t * Disposes the Stage object, freeing the Context attached to the Stage.\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._stageManager.iRemoveStage(this);\n\t\tthis.freeContext();\n\t\tthis._stageManager = null;\n\t\tthis._stageIndex = -1;\n\t}\n\n\t/**\n\t * Configures the back buffer associated with the Stage object.\n\t * @param backBufferWidth The width of the backbuffer.\n\t * @param backBufferHeight The height of the backbuffer.\n\t * @param antiAlias The amount of anti-aliasing to use.\n\t * @param enableDepthAndStencil Indicates whether the back buffer contains a depth and stencil buffer.\n\t */\n\tpublic configureBackBuffer(backBufferWidth:number, backBufferHeight:number, antiAlias:number, enableDepthAndStencil:boolean)\n\t{\n\t\tthis.width = backBufferWidth;\n\t\tthis.height = backBufferHeight;\n\n\t\tthis._antiAlias = antiAlias;\n\t\tthis._enableDepthAndStencil = enableDepthAndStencil;\n\n\t\tif (this._context)\n\t\t\tthis._context.configureBackBuffer(backBufferWidth, backBufferHeight, antiAlias, enableDepthAndStencil);\n\t}\n\n\t/*\n\t * Indicates whether the depth and stencil buffer is used\n\t */\n\tpublic get enableDepthAndStencil():boolean\n\t{\n\t\treturn this._enableDepthAndStencil;\n\t}\n\n\tpublic set enableDepthAndStencil(enableDepthAndStencil:boolean)\n\t{\n\t\tthis._enableDepthAndStencil = enableDepthAndStencil;\n\t\tthis._backBufferDirty = true;\n\t}\n\n\tpublic get renderTarget():TextureProxyBase\n\t{\n\t\treturn this._renderTarget;\n\t}\n\n\tpublic get renderSurfaceSelector():number\n\t{\n\t\treturn this._renderSurfaceSelector;\n\t}\n\n\t/*\n\t * Clear and reset the back buffer when using a shared context\n\t */\n\tpublic clear()\n\t{\n\t\tif (!this._context)\n\t\t\treturn;\n\n\t\tif (this._backBufferDirty) {\n\t\t\tthis.configureBackBuffer(this._width, this._height, this._antiAlias, this._enableDepthAndStencil);\n\t\t\tthis._backBufferDirty = false;\n\t\t}\n\n\t\tthis._context.clear(( this._color & 0xff000000 ) >>> 24, // <--------- Zero-fill right shift\n\t\t\t\t\t\t\t  ( this._color & 0xff0000 ) >>> 16, // <-------------|\n\t\t\t\t\t\t\t  ( this._color & 0xff00 ) >>> 8, // <----------------|\n\t\t\t\t\t\t\t\tthis._color & 0xff);\n\n\t\tthis._bufferClear = true;\n\t}\n\n\t/**\n\t * Registers an event listener object with an EventDispatcher object so that the listener receives notification of an event. Special case for enterframe and exitframe events - will switch StageProxy into automatic render mode.\n\t * You can register event listeners on all nodes in the display list for a specific type of event, phase, and priority.\n\t *\n\t * @param type The type of event.\n\t * @param listener The listener function that processes the event.\n\t * @param useCapture Determines whether the listener works in the capture phase or the target and bubbling phases. If useCapture is set to true, the listener processes the event only during the capture phase and not in the target or bubbling phase. If useCapture is false, the listener processes the event only during the target or bubbling phase. To listen for the event in all three phases, call addEventListener twice, once with useCapture set to true, then again with useCapture set to false.\n\t * @param priority The priority level of the event listener. The priority is designated by a signed 32-bit integer. The higher the number, the higher the priority. All listeners with priority n are processed before listeners of priority n-1. If two or more listeners share the same priority, they are processed in the order in which they were added. The default priority is 0.\n\t * @param useWeakReference Determines whether the reference to the listener is strong or weak. A strong reference (the default) prevents your listener from being garbage-collected. A weak reference does not.\n\t */\n\tpublic addEventListener(type:string, listener:Function)\n\t{\n\t\tsuper.addEventListener(type, listener);\n\n\t\t//away.Debug.throwPIR( 'StageProxy' , 'addEventListener' ,  'EnterFrame, ExitFrame');\n\n\t\t//if ((type == Event.ENTER_FRAME || type == Event.EXIT_FRAME) ){//&& ! this._frameEventDriver.hasEventListener(Event.ENTER_FRAME)){\n\n\t\t//_frameEventDriver.addEventListener(Event.ENTER_FRAME, onEnterFrame, useCapture, priority, useWeakReference);\n\n\t\t//}\n\n\t\t/* Original code\n\t\t if ((type == Event.ENTER_FRAME || type == Event.EXIT_FRAME) && ! _frameEventDriver.hasEventListener(Event.ENTER_FRAME)){\n\n\t\t _frameEventDriver.addEventListener(Event.ENTER_FRAME, onEnterFrame, useCapture, priority, useWeakReference);\n\n\n\t\t }\n\t\t */\n\t}\n\n\t/**\n\t * Removes a listener from the EventDispatcher object. Special case for enterframe and exitframe events - will switch StageProxy out of automatic render mode.\n\t * If there is no matching listener registered with the EventDispatcher object, a call to this method has no effect.\n\t *\n\t * @param type The type of event.\n\t * @param listener The listener object to remove.\n\t * @param useCapture Specifies whether the listener was registered for the capture phase or the target and bubbling phases. If the listener was registered for both the capture phase and the target and bubbling phases, two calls to removeEventListener() are required to remove both, one call with useCapture() set to true, and another call with useCapture() set to false.\n\t */\n\tpublic removeEventListener(type:string, listener:Function)\n\t{\n\t\tsuper.removeEventListener(type, listener);\n\n\t\t/*\n\t\t // Remove the main rendering listener if no EnterFrame listeners remain\n\t\t if (    ! this.hasEventListener(Event.ENTER_FRAME , this.onEnterFrame , this )\n\t\t &&  ! this.hasEventListener(Event.EXIT_FRAME , this.onEnterFrame , this) ) //&& _frameEventDriver.hasEventListener(Event.ENTER_FRAME))\n\t\t {\n\n\t\t //_frameEventDriver.removeEventListener(Event.ENTER_FRAME, this.onEnterFrame, this );\n\n\t\t }\n\t\t */\n\t}\n\n\tpublic get scissorRect():Rectangle\n\t{\n\t\treturn this._scissorRect;\n\t}\n\n\tpublic set scissorRect(value:Rectangle)\n\t{\n\t\tthis._scissorRect = value;\n\n\t\tthis._context.setScissorRectangle(this._scissorRect);\n\t}\n\n\t/**\n\t * The index of the Stage which is managed by this instance of StageProxy.\n\t */\n\tpublic get stageIndex():number\n\t{\n\t\treturn this._stageIndex;\n\t}\n\n\t/**\n\t * Indicates whether the Stage managed by this proxy is running in software mode.\n\t * Remember to wait for the CONTEXT_CREATED event before checking this property,\n\t * as only then will it be guaranteed to be accurate.\n\t */\n\tpublic get usesSoftwareRendering():boolean\n\t{\n\t\treturn this._usesSoftwareRendering;\n\t}\n\n\t/**\n\t * The antiAliasing of the Stage.\n\t */\n\tpublic get antiAlias():number\n\t{\n\t\treturn this._antiAlias;\n\t}\n\n\tpublic set antiAlias(antiAlias:number)\n\t{\n\t\tthis._antiAlias = antiAlias;\n\t\tthis._backBufferDirty = true;\n\t}\n\n\t/**\n\t * A viewPort rectangle equivalent of the Stage size and position.\n\t */\n\tpublic get viewPort():Rectangle\n\t{\n\t\tthis._viewportDirty = false;\n\n\t\treturn this._viewPort;\n\t}\n\n\t/**\n\t * The background color of the Stage.\n\t */\n\tpublic get color():number\n\t{\n\t\treturn this._color;\n\t}\n\n\tpublic set color(color:number)\n\t{\n\t\tthis._color = color;\n\t}\n\n\t/**\n\t * The freshly cleared state of the backbuffer before any rendering\n\t */\n\tpublic get bufferClear():boolean\n\t{\n\t\treturn this._bufferClear;\n\t}\n\n\tpublic set bufferClear(newBufferClear:boolean)\n\t{\n\t\tthis._bufferClear = newBufferClear;\n\t}\n\n\n\tpublic registerProgram(programData:ProgramData)\n\t{\n\t\tvar i:number = 0;\n\t\twhile (this._programData[i] != null)\n\t\t\ti++;\n\n\t\tthis._programData[i] = programData;\n\t\tprogramData.id = i;\n\t}\n\n\tpublic unRegisterProgram(programData:ProgramData)\n\t{\n\t\tthis._programData[programData.id] = null;\n\t\tprogramData.id = -1;\n\t}\n\n\t/*\n\t * Access to fire mouseevents across multiple layered view3D instances\n\t */\n\t//\t\tpublic get mouse3DManager():Mouse3DManager\n\t//\t\t{\n\t//\t\t\treturn this._mouse3DManager;\n\t//\t\t}\n\t//\n\t//\t\tpublic set mouse3DManager(value:Mouse3DManager)\n\t//\t\t{\n\t//\t\t\tthis._mouse3DManager = value;\n\t//\t\t}\n\n\t/* TODO: implement dependency Touch3DManager\n\t public get touch3DManager():Touch3DManager\n\t {\n\t return _touch3DManager;\n\t }\n\n\t public set touch3DManager(value:Touch3DManager)\n\t {\n\t _touch3DManager = value;\n\t }\n\t */\n\n\t/**\n\t * Frees the Context associated with this StageProxy.\n\t */\n\tprivate freeContext()\n\t{\n\t\tif (this._context) {\n\t\t\tthis._context.dispose();\n\n\t\t\tthis.dispatchEvent(new StageEvent(StageEvent.CONTEXT_DISPOSED));\n\t\t}\n\n\t\tthis._context = null;\n\n\t\tthis._initialised = false;\n\t}\n\n\t/**\n\t * The Enter_Frame handler for processing the proxy.ENTER_FRAME and proxy.EXIT_FRAME event handlers.\n\t * Typically the proxy.ENTER_FRAME listener would render the layers for this Stage instance.\n\t */\n\tprivate onEnterFrame(event:Event)\n\t{\n\t\tif (!this._context)\n\t\t\treturn;\n\n\t\t// Clear the stage instance\n\t\tthis.clear();\n\t\t//notify the enterframe listeners\n\t\tthis.notifyEnterFrame();\n\t\t// Call the present() to render the frame\n\t\tif (!this._context)\n\t\t\tthis._context.present();\n\t\t//notify the exitframe listeners\n\t\tthis.notifyExitFrame();\n\t}\n\n\tpublic recoverFromDisposal():boolean\n\t{\n\t\tif (!this._context)\n\t\t\treturn false;\n\n\t\t//away.Debug.throwPIR( 'StageProxy' , 'recoverFromDisposal' , '' );\n\n\t\t/*\n\t\t if (this._iContext.driverInfo == \"Disposed\")\n\t\t {\n\t\t this._iContext = null;\n\t\t this.dispatchEvent(new StageEvent(StageEvent.CONTEXT_DISPOSED));\n\t\t return false;\n\n\t\t }\n\t\t */\n\t\treturn true;\n\n\t}\n\n\tprivate _callback(context:IContextGL)\n\t{\n\t\tthis._context = context;\n\n\t\tthis._container = this._context.container;\n\n\t\t// Only configure back buffer if width and height have been set,\n\t\t// which they may not have been if View.render() has yet to be\n\t\t// invoked for the first time.\n\t\tif (this._width && this._height)\n\t\t\tthis._context.configureBackBuffer(this._width, this._height, this._antiAlias, this._enableDepthAndStencil);\n\n\t\t// Dispatch the appropriate event depending on whether context was\n\t\t// created for the first time or recreated after a device loss.\n\t\tthis.dispatchEvent(new StageEvent(this._initialised? StageEvent.CONTEXT_RECREATED : StageEvent.CONTEXT_CREATED));\n\n\t\tthis._initialised = true;\n\t}\n\n\tprivate _setSamplerState(index:number, repeat:boolean, smooth:boolean, mipmap:boolean)\n\t{\n\t\tvar wrap:string = repeat? ContextGLWrapMode.REPEAT:ContextGLWrapMode.CLAMP;\n\t\tvar filter:string = smooth? ContextGLTextureFilter.LINEAR : ContextGLTextureFilter.NEAREST;\n\t\tvar mipfilter:string = mipmap? ContextGLMipFilter.MIPLINEAR : ContextGLMipFilter.MIPNONE;\n\n\t\tthis._context.setSamplerStateAt(index, wrap, filter, mipfilter);\n\t}\n}\n\nexport = Stage;","import AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\n\nclass TextureBaseWebGL\n{\n\tpublic textureType:string = \"\";\n\tpublic _gl:WebGLRenderingContext;\n\n\tconstructor(gl:WebGLRenderingContext)\n\t{\n\t\tthis._gl = gl;\n\t}\n\n\tpublic dispose():void\n\t{\n\t\tthrow \"Abstract method must be overridden.\";\n\t}\n\n\tpublic get glTexture():WebGLTexture\n\t{\n\t\tthrow new AbstractMethodError();\n\t}\n}\n\nexport = TextureBaseWebGL;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport ByteArrayBase\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArrayBase\");\n\nimport ContextStage3D\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextStage3D\");\nimport ITexture\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITexture\");\nimport OpCodes\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/OpCodes\");\nimport ResourceBaseFlash\t\t\t= require(\"awayjs-stagegl/lib/base/ResourceBaseFlash\");\n\nclass TextureFlash extends ResourceBaseFlash implements ITexture\n{\n\tprivate _context:ContextStage3D;\n\tprivate _width:number;\n\tprivate _height:number;\n\n\tpublic get width():number\n\t{\n\t\treturn this._width;\n\t}\n\n\tpublic get height():number\n\t{\n\t\treturn this._height;\n\t}\n\n\tconstructor(context:ContextStage3D, width:number, height:number, format:string, forRTT:boolean, streaming:boolean = false)\n\t{\n\t\tsuper();\n\n\t\tthis._context = context;\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.initTexture, (forRTT? OpCodes.trueValue : OpCodes.falseValue)) + width + \",\" + height + \",\" + streaming + \",\" + format + \"$\");\n\t\tthis._pId = this._context.execute();\n\t\tthis._context._iAddResource(this);\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.disposeTexture) + this._pId.toString() + \",\");\n\t\tthis._context.execute();\n\t\tthis._context._iRemoveResource(this);\n\n\t\tthis._context = null;\n\t}\n\n\tpublic uploadFromData(bitmapData:BitmapData, miplevel?:number);\n\tpublic uploadFromData(image:HTMLImageElement, miplevel?:number);\n\tpublic uploadFromData(data:any, miplevel:number = 0)\n\t{\n\t\tif (data instanceof BitmapData) {\n\t\t\tdata = (<BitmapData> data).imageData.data;\n\t\t} else if (data instanceof HTMLImageElement) {\n\t\t\tvar can = document.createElement(\"canvas\");\n\t\t\tvar w = data.width;\n\t\t\tvar h = data.height;\n\t\t\tcan.width = w;\n\t\t\tcan.height = h;\n\t\t\tvar ctx = can.getContext(\"2d\");\n\t\t\tctx.drawImage(data, 0, 0);\n\t\t\tdata = ctx.getImageData(0, 0, w, h).data;\n\t\t}\n\n\t\tvar pos = 0;\n\t\tvar bytes = ByteArrayBase.internalGetBase64String(data.length, function () {\n\t\t\treturn data[pos++];\n\t\t}, null);\n\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.uploadBytesTexture) + this._pId + \",\" + miplevel + \",\" + (this._width >> miplevel) + \",\" + (this._height >> miplevel) + \",\" + bytes + \"%\");\n\t\tthis._context.execute();\n\t}\n}\n\nexport = TextureFlash;","import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\nimport ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\n\nimport ITexture\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITexture\");\nimport TextureBaseWebGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/TextureBaseWebGL\");\n\nclass TextureWebGL extends TextureBaseWebGL implements ITexture\n{\n\n\tpublic textureType:string = \"texture2d\";\n\n\tprivate _width:number;\n\tprivate _height:number;\n\n\tprivate _frameBuffer:WebGLFramebuffer;\n\n\tprivate _glTexture:WebGLTexture;\n\n\tconstructor(gl:WebGLRenderingContext, width:number, height:number)\n\t{\n\t\tsuper(gl);\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\tthis._glTexture = this._gl.createTexture();\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._gl.deleteTexture(this._glTexture);\n\t}\n\n\tpublic get width():number\n\t{\n\t\treturn this._width;\n\t}\n\n\tpublic get height():number\n\t{\n\t\treturn this._height;\n\t}\n\n\tpublic get frameBuffer():WebGLFramebuffer\n\t{\n\t\tif (!this._frameBuffer) {\n\t\t\tthis._frameBuffer = this._gl.createFramebuffer();\n\t\t\tthis._gl.bindFramebuffer(this._gl.FRAMEBUFFER, this._frameBuffer);\n\t\t\tthis._gl.bindTexture(this._gl.TEXTURE_2D, this._glTexture);\n\t\t\tthis._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._width, this._height, 0, this._gl.RGBA, this._gl.UNSIGNED_BYTE, null);\n\n\t\t\tvar renderBuffer:WebGLRenderbuffer = this._gl.createRenderbuffer();\n\t\t\tthis._gl.bindRenderbuffer(this._gl.RENDERBUFFER, renderBuffer);\n\t\t\tthis._gl.renderbufferStorage(this._gl.RENDERBUFFER, this._gl.DEPTH_COMPONENT16, this._width, this._height);\n\n\t\t\tthis._gl.framebufferTexture2D(this._gl.FRAMEBUFFER, this._gl.COLOR_ATTACHMENT0, this._gl.TEXTURE_2D, this._glTexture, 0);\n\t\t\tthis._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER, this._gl.DEPTH_ATTACHMENT, this._gl.RENDERBUFFER, renderBuffer);\n\n\t\t\tthis._gl.bindTexture(this._gl.TEXTURE_2D, null);\n\t\t\tthis._gl.bindRenderbuffer(this._gl.RENDERBUFFER, null);\n\t\t\tthis._gl.bindFramebuffer(this._gl.FRAMEBUFFER, null);\n\t\t}\n\n\t\treturn this._frameBuffer;\n\t}\n\n\tpublic uploadFromData(bitmapData:BitmapData, miplevel?:number);\n\tpublic uploadFromData(image:HTMLImageElement, miplevel?:number);\n\tpublic uploadFromData(data:any, miplevel:number = 0)\n\t{\n\t\tif (data instanceof BitmapData)\n\t\t\tdata = (<BitmapData> data).imageData;\n\n\t\tthis._gl.bindTexture(this._gl.TEXTURE_2D, this._glTexture);\n\t\tthis._gl.texImage2D(this._gl.TEXTURE_2D, miplevel, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, data);\n\t\tthis._gl.bindTexture(this._gl.TEXTURE_2D, null);\n\t}\n\n\tpublic uploadCompressedTextureFromByteArray(data:ByteArray, byteArrayOffset:number /*uint*/, async:boolean = false)\n\t{\n\t\tvar ext:Object = this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_s3tc\");\n\t\t//this._gl.compressedTexImage2D(this._gl.TEXTURE_2D, 0, this)\n\t}\n\n\tpublic get glTexture():WebGLTexture\n\t{\n\t\treturn this._glTexture;\n\t}\n\n\tpublic generateMipmaps()\n\t{\n\t\t//TODO: implement generating mipmaps\n\t\t//this._gl.bindTexture( this._gl.TEXTURE_2D, this._glTexture );\n\t\t//this._gl.generateMipmap(this._gl.TEXTURE_2D);\n\t\t//this._gl.bindTexture( this._gl.TEXTURE_2D, null );\n\t}\n}\n\nexport = TextureWebGL;","import ContextStage3D\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextStage3D\");\nimport IVertexBuffer\t\t\t\t= require(\"awayjs-stagegl/lib/base/IVertexBuffer\");\nimport OpCodes\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/OpCodes\");\nimport ResourceBaseFlash\t\t\t= require(\"awayjs-stagegl/lib/base/ResourceBaseFlash\");\n\nclass VertexBufferFlash extends ResourceBaseFlash implements IVertexBuffer\n{\n\tprivate _context:ContextStage3D;\n\tprivate _numVertices:number;\n\tprivate _data32PerVertex:number;\n\n\tconstructor(context:ContextStage3D, numVertices:number, data32PerVertex:number)\n\t{\n\t\tsuper();\n\n\t\tthis._context = context;\n\t\tthis._numVertices = numVertices;\n\t\tthis._data32PerVertex = data32PerVertex;\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.initVertexBuffer, data32PerVertex + OpCodes.intMask) + numVertices.toString() + \",\");\n\t\tthis._pId = this._context.execute();\n\t\tthis._context._iAddResource(this);\n\t}\n\n\tpublic uploadFromArray(data:number[], startVertex:number, numVertices:number)\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.uploadArrayVertexBuffer, this._pId + OpCodes.intMask) + data.join() + \"#\" + [startVertex, numVertices].join() + \",\");\n\t\tthis._context.execute();\n\t}\n\n\tpublic get numVertices():number\n\t{\n\t\treturn this._numVertices;\n\t}\n\n\tpublic get data32PerVertex():number\n\t{\n\t\treturn this._data32PerVertex;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._context.addStream(String.fromCharCode(OpCodes.disposeVertexBuffer, this._pId + OpCodes.intMask));\n\t\tthis._context.execute();\n\t\tthis._context._iRemoveResource(this);\n\n\t\tthis._context = null;\n\t}\n}\n\nexport = VertexBufferFlash;","import IVertexBuffer\t\t\t\t= require(\"awayjs-stagegl/lib/base/IVertexBuffer\");\n\nclass VertexBufferWebGL implements IVertexBuffer\n{\n\n\tprivate _gl:WebGLRenderingContext;\n\tprivate _numVertices:number;\n\tprivate _data32PerVertex:number;\n\tprivate _buffer:WebGLBuffer;\n\n\tconstructor(gl:WebGLRenderingContext, numVertices:number, data32PerVertex:number)\n\t{\n\t\tthis._gl = gl;\n\t\tthis._buffer = this._gl.createBuffer();\n\t\tthis._numVertices = numVertices;\n\t\tthis._data32PerVertex = data32PerVertex;\n\t}\n\n\tpublic uploadFromArray(vertices:number[], startVertex:number, numVertices:number)\n\t{\n\t\tthis._gl.bindBuffer(this._gl.ARRAY_BUFFER, this._buffer);\n\n\t\t//console.log( \"** WARNING upload not fully implemented, startVertex & numVertices not considered.\" );\n\t\t// TODO add offsets , startVertex, numVertices * this._data32PerVertex\n\t\tthis._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array(vertices), this._gl.STATIC_DRAW);\n\t}\n\n\tpublic get numVertices():number\n\t{\n\t\treturn this._numVertices;\n\t}\n\n\tpublic get data32PerVertex():number\n\t{\n\t\treturn this._data32PerVertex;\n\t}\n\n\tpublic get glBuffer():WebGLBuffer\n\t{\n\t\treturn this._buffer;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tthis._gl.deleteBuffer(this._buffer);\n\t}\n}\n\nexport = VertexBufferWebGL;","import EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\nimport ArgumentError\t\t\t\t= require(\"awayjs-core/lib/errors/ArgumentError\");\n\nimport StageEvent\t\t\t\t\t= require(\"awayjs-display/lib/events/StageEvent\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\n/**\n * The StageManager class provides a multiton object that handles management for Stage objects.\n *\n * @see away.base.Stage\n */\nclass StageManager extends EventDispatcher\n{\n\tprivate static STAGE_MAX_QUANTITY:number = 8;\n\tprivate _stages:Array<Stage>;\n\n\tprivate static _instance:StageManager;\n\tprivate static _numStages:number = 0;\n\tprivate _onContextCreatedDelegate:(event:Event) => void;\n\n\t/**\n\t * Creates a new StageManager class.\n\t * @param stage The Stage object that contains the Stage objects to be managed.\n\t * @private\n\t */\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._stages = new Array<Stage>(StageManager.STAGE_MAX_QUANTITY);\n\n\t\tthis._onContextCreatedDelegate = (event:Event) => this.onContextCreated(event);\n\t}\n\n\t/**\n\t * Gets a StageManager instance for the given Stage object.\n\t * @param stage The Stage object that contains the Stage objects to be managed.\n\t * @return The StageManager instance for the given Stage object.\n\t */\n\tpublic static getInstance():StageManager\n\t{\n\t\tif (this._instance == null)\n\t\t\tthis._instance = new StageManager();\n\n\t\treturn this._instance;\n\t}\n\n\t/**\n\t * Requests the Stage for the given index.\n\t *\n\t * @param index The index of the requested Stage.\n\t * @param forceSoftware Whether to force software mode even if hardware acceleration is available.\n\t * @param profile The compatibility profile, an enumeration of ContextProfile\n\t * @return The Stage for the given index.\n\t */\n\tpublic getStageAt(index:number, forceSoftware:boolean = false, profile:string = \"baseline\", mode:string = \"auto\"):Stage\n\t{\n\t\tif (index < 0 || index >= StageManager.STAGE_MAX_QUANTITY)\n\t\t\tthrow new ArgumentError(\"Index is out of bounds [0..\" + StageManager.STAGE_MAX_QUANTITY + \"]\");\n\n\t\tif (!this._stages[index]) {\n\t\t\tStageManager._numStages++;\n\n\t\t\tvar canvas:HTMLCanvasElement = document.createElement(\"canvas\");\n\t\t\tcanvas.id = \"stage\" + index;\n\t\t\tdocument.body.appendChild(canvas);\n\t\t\tvar stage:Stage = this._stages[index] = new Stage(canvas, index, this, forceSoftware, profile);\n\t\t\tstage.addEventListener(StageEvent.CONTEXT_CREATED, this._onContextCreatedDelegate);\n\t\t\tstage.requestContext(forceSoftware, profile, mode);\n\t\t}\n\n\t\treturn stage;\n\t}\n\n\t/**\n\t * Removes a Stage from the manager.\n\t * @param stage\n\t * @private\n\t */\n\tpublic iRemoveStage(stage:Stage)\n\t{\n\t\tStageManager._numStages--;\n\n\t\tstage.removeEventListener(StageEvent.CONTEXT_CREATED, this._onContextCreatedDelegate);\n\n\t\tthis._stages[stage.stageIndex] = null;\n\t}\n\n\t/**\n\t * Get the next available stage. An error is thrown if there are no StageProxies available\n\t * @param forceSoftware Whether to force software mode even if hardware acceleration is available.\n\t * @param profile The compatibility profile, an enumeration of ContextProfile\n\t * @return The allocated stage\n\t */\n\tpublic getFreeStage(forceSoftware:boolean = false, profile:string = \"baseline\", mode:string = \"auto\"):Stage\n\t{\n\t\tvar i:number = 0;\n\t\tvar len:number = this._stages.length;\n\n\t\twhile (i < len) {\n\t\t\tif (!this._stages[i])\n\t\t\t\treturn this.getStageAt(i, forceSoftware, profile, mode);\n\n\t\t\t++i;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Checks if a new stage can be created and managed by the class.\n\t * @return true if there is one slot free for a new stage\n\t */\n\tpublic get hasFreeStage():boolean\n\t{\n\t\treturn StageManager._numStages < StageManager.STAGE_MAX_QUANTITY? true : false;\n\t}\n\n\t/**\n\t * Returns the amount of stage objects that can be created and managed by the class\n\t * @return the amount of free slots\n\t */\n\tpublic get numSlotsFree():number\n\t{\n\t\treturn StageManager.STAGE_MAX_QUANTITY - StageManager._numStages;\n\t}\n\n\t/**\n\t * Returns the amount of Stage objects currently managed by the class.\n\t * @return the amount of slots used\n\t */\n\tpublic get numSlotsUsed():number\n\t{\n\t\treturn StageManager._numStages;\n\t}\n\n\t/**\n\t * The maximum amount of Stage objects that can be managed by the class\n\t */\n\tpublic get numSlotsTotal():number\n\t{\n\t\treturn this._stages.length;\n\t}\n\n\tprivate onContextCreated(event:Event):void\n\t{\n\t\t//var stage:Stage = <Stage> e.target;\n\t\t//document.body.appendChild(stage.canvas)\n\t}\n}\n\nexport = StageManager;","import SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\n\nimport IndexData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/IndexData\");\n\n/**\n *\n */\nclass IndexDataPool\n{\n\tprivate static _pool:Object = new Object();\n\n\tconstructor()\n\t{\n\t}\n\n\tpublic static getItem(subGeometry:SubGeometryBase, level:number, indexOffset:number):IndexData\n\t{\n\t\tvar subGeometryData:Array<IndexData> = <Array<IndexData>> (IndexDataPool._pool[subGeometry.id] || (IndexDataPool._pool[subGeometry.id] = new Array<IndexData>()));\n\n\t\tvar indexData:IndexData = subGeometryData[level] || (subGeometryData[level] = new IndexData(level));\n\t\tindexData.updateData(indexOffset, subGeometry.indices, subGeometry.numVertices);\n\n\t\treturn indexData;\n\t}\n\n\tpublic static disposeItem(id:number, level:number)\n\t{\n\t\tvar subGeometryData:Array<IndexData> = <Array<IndexData>> this._pool[id];\n\n\t\tsubGeometryData[level].dispose();\n\t\tsubGeometryData[level] = null;\n\t}\n\n\tpublic disposeData(id:number)\n\t{\n\t\tvar subGeometryData:Array<IndexData> = <Array<IndexData>> IndexDataPool._pool[id];\n\n\t\tvar len:number = subGeometryData.length;\n\t\tfor (var i:number = 0; i < len; i++) {\n\t\t\tsubGeometryData[i].dispose();\n\t\t\tsubGeometryData[i] = null;\n\t\t}\n\n\t\tIndexDataPool._pool[id] = null;\n\t}\n}\n\nexport = IndexDataPool;","import SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\n\nimport IContextGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport IIndexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IIndexBuffer\");\n\n/**\n *\n */\nclass IndexData\n{\n\tprivate static LIMIT_VERTS:number = 0xffff;\n\n\tprivate static LIMIT_INDICES:number = 0xffffff;\n\n\tprivate _dataDirty = true;\n\n\tpublic invalid:Array<boolean> = new Array(8);\n\n\tpublic contexts:Array<IContextGL> = new Array<IContextGL>(8);\n\n\tpublic buffers:Array<IIndexBuffer> = new Array<IIndexBuffer>(8);\n\n\tpublic data:Array<number>;\n\n\tpublic indexMappings:Array<number>;\n\n\tpublic originalIndices:Array<number>;\n\n\tpublic offset:number;\n\n\tpublic level:number;\n\n\tconstructor(level:number)\n\t{\n\t\tthis.level = level;\n\t}\n\n\tpublic updateData(offset:number, indices:Array<number>, numVertices:number)\n\t{\n\t\tif (this._dataDirty) {\n\t\t\tthis._dataDirty = false;\n\n\t\t\tif (indices.length < IndexData.LIMIT_INDICES && numVertices < IndexData.LIMIT_VERTS) {\n\t\t\t\t//shortcut for those buffers that fit into the maximum buffer sizes\n\t\t\t\tthis.indexMappings = null;\n\t\t\t\tthis.originalIndices = null;\n\t\t\t\tthis.setData(indices);\n\t\t\t\tthis.offset = indices.length;\n\t\t\t} else {\n\t\t\t\tvar i:number;\n\t\t\t\tvar len:number;\n\t\t\t\tvar outIndex:number;\n\t\t\t\tvar j:number;\n\t\t\t\tvar k:number;\n\t\t\t\tvar splitIndices:Array<number> = new Array<number>();\n\n\t\t\t\tthis.indexMappings = new Array<number>(indices.length);\n\t\t\t\tthis.originalIndices = new Array<number>();\n\n\t\t\t\ti = this.indexMappings.length;\n\n\t\t\t\twhile (i--)\n\t\t\t\t\tthis.indexMappings[i] = -1;\n\n\t\t\t\tvar originalIndex:number;\n\t\t\t\tvar splitIndex:number;\n\n\t\t\t\t// Loop over all triangles\n\t\t\t\toutIndex = 0;\n\t\t\t\tlen = indices.length;\n\t\t\t\ti = offset;\n\t\t\t\tk = 0;\n\t\t\t\twhile (i < len && outIndex + 3 < IndexData.LIMIT_INDICES && k + 3 < IndexData.LIMIT_VERTS) {\n\t\t\t\t\t// Loop over all vertices in a triangle //TODO ensure this works for segments or any grouping\n\t\t\t\t\tfor (j = 0; j < 3; j++) {\n\n\t\t\t\t\t\toriginalIndex = indices[i + j];\n\n\t\t\t\t\t\tif (this.indexMappings[originalIndex] >= 0) {\n\t\t\t\t\t\t\tsplitIndex = this.indexMappings[originalIndex];\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t// This vertex does not yet exist in the split list and\n\t\t\t\t\t\t\t// needs to be copied from the long list.\n\t\t\t\t\t\t\tsplitIndex = k++;\n\t\t\t\t\t\t\tthis.indexMappings[originalIndex] = splitIndex;\n\t\t\t\t\t\t\tthis.originalIndices.push(originalIndex);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Store new index, which may have come from the mapping look-up,\n\t\t\t\t\t\t// or from copying a new set of vertex data from the original vector\n\t\t\t\t\t\tsplitIndices[outIndex + j] = splitIndex;\n\t\t\t\t\t}\n\n\t\t\t\t\toutIndex += 3;\n\t\t\t\t\ti += 3\n\t\t\t\t}\n\n\t\t\t\tthis.setData(splitIndices);\n\t\t\t\tthis.offset = i;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic invalidateData()\n\t{\n\t\tthis._dataDirty = true;\n\t}\n\n\tpublic dispose()\n\t{\n\t\tfor (var i:number = 0; i < 8; ++i) {\n\t\t\tif (this.contexts[i]) {\n\t\t\t\tthis.buffers[i].dispose();\n\t\t\t\tthis.buffers[i] = null;\n\t\t\t\tthis.contexts[i] = null;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate disposeBuffers()\n\t{\n\t\tfor (var i:number = 0; i < 8; ++i) {\n\t\t\tif (this.buffers[i]) {\n\t\t\t\tthis.buffers[i].dispose();\n\t\t\t\tthis.buffers[i] = null;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate invalidateBuffers()\n\t{\n\t\tfor (var i:number = 0; i < 8; ++i)\n\t\t\tthis.invalid[i] = true;\n\t}\n\n\t/**\n\t *\n\t * @param data\n\t * @private\n\t */\n\tprivate setData(data:Array<number>)\n\t{\n\t\tif (this.data && this.data.length != data.length)\n\t\t\tthis.disposeBuffers();\n\t\telse\n\t\t\tthis.invalidateBuffers();\n\n\t\tthis.data = data;\n\t}\n}\n\nexport = IndexData;","import TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\nimport ProgramData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/ProgramData\");\n\n/**\n * @class away.pool.ProgramDataPool\n */\nclass ProgramDataPool\n{\n\tprivate _pool:Object = new Object();\n\tprivate _stage:Stage;\n\n\t/**\n\t * //TODO\n\t *\n\t * @param textureDataClass\n\t */\n\tconstructor(stage:Stage)\n\t{\n\t\tthis._stage = stage;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param materialOwner\n\t * @returns ITexture\n\t */\n\tpublic getItem(vertexString:string, fragmentString:string):ProgramData\n\t{\n\t\tvar key:string = vertexString + fragmentString;\n\t\treturn this._pool[key] || (this._pool[key] = new ProgramData(this, this._stage, vertexString, fragmentString));\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param materialOwner\n\t */\n\tpublic disposeItem(key:string)\n\t{\n\t\tthis._pool[key] = null;\n\t}\n}\n\nexport = ProgramDataPool;","import ProgramDataPool\t\t\t\t= require(\"awayjs-stagegl/lib/pool/ProgramDataPool\");\nimport IProgram\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IProgram\");\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\n\n/**\n *\n * @class away.pool.ProgramDataBase\n */\nclass ProgramData\n{\n\tpublic static PROGRAMDATA_ID_COUNT:number = 0;\n\n\tprivate _pool:ProgramDataPool;\n\n\tpublic vertexString:string;\n\n\tpublic fragmentString:string;\n\n\tpublic stage:Stage;\n\n\tpublic usages:number = 0;\n\n\tpublic program:IProgram;\n\n\tpublic id:number;\n\n\tconstructor(pool:ProgramDataPool, context:Stage, vertexString:string, fragmentString:string)\n\t{\n\t\tthis._pool = pool;\n\t\tthis.stage = context;\n\t\tthis.vertexString = vertexString;\n\t\tthis.fragmentString = fragmentString;\n\t\tthis.stage.registerProgram(this);\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic dispose()\n\t{\n\t\tthis.usages--;\n\n\t\tif (!this.usages) {\n\t\t\tthis._pool.disposeItem(this.vertexString + this.fragmentString);\n\n\t\t\tthis.stage.unRegisterProgram(this);\n\n\t\t\tif (this.program)\n\t\t\t\tthis.program.dispose();\n\t\t}\n\n\t\tthis.program = null;\n\t}\n}\n\nexport = ProgramData;","import TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nimport TextureData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/TextureData\");\n\n/**\n * @class away.pool.TextureDataPool\n */\nclass TextureDataPool\n{\n\tprivate _pool:Object = new Object();\n\n\t/**\n\t * //TODO\n\t *\n\t * @param textureDataClass\n\t */\n\tconstructor()\n\t{\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param materialOwner\n\t * @returns ITexture\n\t */\n\tpublic getItem(textureProxy:TextureProxyBase, mipmap:boolean):TextureData\n\t{\n\t\tvar textureData:TextureData = <TextureData> (this._pool[textureProxy.id] || (this._pool[textureProxy.id] = textureProxy._iAddTextureData(new TextureData(this, textureProxy, mipmap))));\n\n\t\tif (!textureData.mipmap && mipmap) {\n\t\t\ttextureData.mipmap = true;\n\t\t\ttextureData.invalidate();\n\t\t}\n\n\t\treturn textureData;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param materialOwner\n\t */\n\tpublic disposeItem(textureProxy:TextureProxyBase)\n\t{\n\t\ttextureProxy._iRemoveTextureData(this._pool[textureProxy.id]);\n\n\t\tthis._pool[textureProxy.id] = null;\n\t}\n}\n\nexport = TextureDataPool;","import ITextureData\t\t\t\t\t= require(\"awayjs-core/lib/pool/ITextureData\");\nimport TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\n\nimport TextureDataPool\t\t\t\t= require(\"awayjs-stagegl/lib/pool/TextureDataPool\");\nimport ITextureBase\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITextureBase\");\n\n/**\n *\n * @class away.pool.TextureDataBase\n */\nclass TextureData implements ITextureData\n{\n\tprivate _pool:TextureDataPool;\n\n\tpublic texture:ITextureBase;\n\n\tpublic textureProxy:TextureProxyBase;\n\n\tpublic mipmap:boolean;\n\n\tpublic invalid:boolean;\n\n\tconstructor(pool:TextureDataPool, textureProxy:TextureProxyBase, mipmap:boolean)\n\t{\n\t\tthis._pool = pool;\n\t\tthis.textureProxy = textureProxy;\n\t\tthis.mipmap = mipmap;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic dispose()\n\t{\n\t\tthis._pool.disposeItem(this.textureProxy);\n\n\t\tthis.texture.dispose();\n\t\tthis.texture = null;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic invalidate()\n\t{\n\t\tthis.invalid = true;\n\t}\n}\n\nexport = TextureData;","import SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\n\nimport IndexData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/IndexData\");\nimport VertexData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/VertexData\");\n\n/**\n *\n */\nclass VertexDataPool\n{\n\tprivate static _pool:Object = new Object();\n\n\tconstructor()\n\t{\n\t}\n\n\tpublic static getItem(subGeometry:SubGeometryBase, indexData:IndexData, dataType:string):VertexData\n\t{\n\t\tif (subGeometry.concatenateArrays)\n\t\t\tdataType = SubGeometryBase.VERTEX_DATA;\n\n\t\tvar subGeometryDictionary:Object = <Object> (VertexDataPool._pool[subGeometry.id] || (VertexDataPool._pool[subGeometry.id] = new Object()));\n\t\tvar subGeometryData:Array<VertexData> = <Array<VertexData>> (subGeometryDictionary[dataType] || (subGeometryDictionary[dataType] = new Array<VertexData>()));\n\n\t\tvar vertexData:VertexData = subGeometryData[indexData.level] || (subGeometryData[indexData.level] = new VertexData(subGeometry, dataType));\n\t\tvertexData.updateData(indexData.originalIndices, indexData.indexMappings);\n\n\t\treturn vertexData;\n\t}\n\n\tpublic static disposeItem(subGeometry:SubGeometryBase, level:number, dataType:string)\n\t{\n\t\tvar subGeometryDictionary:Object = <Object> VertexDataPool._pool[subGeometry.id];\n\t\tvar subGeometryData:Array<VertexData> = <Array<VertexData>> subGeometryDictionary[dataType];\n\n\t\tsubGeometryData[level].dispose();\n\t\tsubGeometryData[level] = null;\n\t}\n\n\tpublic disposeData(subGeometry:SubGeometryBase)\n\t{\n\t\tvar subGeometryDictionary:Object = <Object> VertexDataPool._pool[subGeometry.id];\n\n\t\tfor (var key in subGeometryDictionary) {\n\t\t\tvar subGeometryData:Array<VertexData> = <Array<VertexData>> subGeometryDictionary[key];\n\n\t\t\tvar len:number = subGeometryData.length;\n\t\t\tfor (var i:number = 0; i < len; i++) {\n\t\t\t\tsubGeometryData[i].dispose();\n\t\t\t\tsubGeometryData[i] = null;\n\t\t\t}\n\t\t}\n\n\t\tVertexDataPool._pool[subGeometry.id] = null;\n\t}\n}\n\nexport = VertexDataPool;","import SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\nimport SubGeometryEvent\t\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\n\nimport IContextGL\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\nimport IVertexBuffer\t\t\t\t= require(\"awayjs-stagegl/lib/base/IVertexBuffer\");\n\n/**\n *\n */\nclass VertexData\n{\n\tprivate _onVerticesUpdatedDelegate:(event:SubGeometryEvent) => void;\n\tprivate _subGeometry:SubGeometryBase;\n\tprivate _dataType:string;\n\tprivate _dataDirty = true;\n\n\tpublic invalid:Array<boolean> = new Array<boolean>(8);\n\n\tpublic buffers:Array<IVertexBuffer> = new Array<IVertexBuffer>(8);\n\n\tpublic contexts:Array<IContextGL> = new Array<IContextGL>(8);\n\n\tpublic data:Array<number>;\n\n\tpublic dataPerVertex:number;\n\n\tconstructor(subGeometry:SubGeometryBase, dataType:string)\n\t{\n\t\tthis._subGeometry = subGeometry;\n\t\tthis._dataType = dataType;\n\n\t\tthis._onVerticesUpdatedDelegate = (event:SubGeometryEvent) => this._onVerticesUpdated(event);\n\t\tthis._subGeometry.addEventListener(SubGeometryEvent.VERTICES_UPDATED, this._onVerticesUpdatedDelegate);\n\t}\n\n\tpublic updateData(originalIndices:Array<number> = null, indexMappings:Array<number> = null)\n\t{\n\t\tif (this._dataDirty) {\n\t\t\tthis._dataDirty = false;\n\n\t\t\tthis.dataPerVertex = this._subGeometry.getStride(this._dataType);\n\n\t\t\tvar vertices:Array<number> = this._subGeometry[this._dataType];\n\n\t\t\tif (indexMappings == null) {\n\t\t\t\tthis.setData(vertices);\n\t\t\t} else {\n\t\t\t\tvar splitVerts:Array<number> = new Array<number>(originalIndices.length*this.dataPerVertex);\n\t\t\t\tvar originalIndex:number;\n\t\t\t\tvar splitIndex:number;\n\t\t\t\tvar i:number = 0;\n\t\t\t\tvar j:number = 0;\n\t\t\t\twhile(i < originalIndices.length) {\n\t\t\t\t\toriginalIndex = originalIndices[i];\n\n\t\t\t\t\tsplitIndex = indexMappings[originalIndex]*this.dataPerVertex;\n\t\t\t\t\toriginalIndex *= this.dataPerVertex;\n\n\t\t\t\t\tfor (j = 0; j < this.dataPerVertex; j++)\n\t\t\t\t\t\tsplitVerts[splitIndex + j] = vertices[originalIndex + j];\n\n\t\t\t\t\ti++;\n\t\t\t\t}\n\n\t\t\t\tthis.setData(splitVerts);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic dispose()\n\t{\n\t\tfor (var i:number = 0; i < 8; ++i) {\n\t\t\tif (this.contexts[i]) {\n\t\t\t\tthis.buffers[i].dispose();\n\t\t\t\tthis.buffers[i] = null;\n\t\t\t\tthis.contexts[i] = null;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate disposeBuffers()\n\t{\n\t\tfor (var i:number = 0; i < 8; ++i) {\n\t\t\tif (this.buffers[i]) {\n\t\t\t\tthis.buffers[i].dispose();\n\t\t\t\tthis.buffers[i] = null;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate invalidateBuffers()\n\t{\n\t\tfor (var i:number = 0; i < 8; ++i)\n\t\t\tthis.invalid[i] = true;\n\t}\n\n\t/**\n\t *\n\t * @param data\n\t * @param dataPerVertex\n\t * @private\n\t */\n\tprivate setData(data:Array<number>)\n\t{\n\t\tif (this.data && this.data.length != data.length)\n\t\t\tthis.disposeBuffers();\n\t\telse\n\t\t\tthis.invalidateBuffers();\n\n\t\tthis.data = data;\n\t}\n\n\t/**\n\t * //TODO\n\t *\n\t * @param event\n\t * @private\n\t */\n\tprivate _onVerticesUpdated(event:SubGeometryEvent)\n\t{\n\t\tvar dataType:string = this._subGeometry.concatenateArrays? SubGeometryBase.VERTEX_DATA : event.dataType;\n\n\t\tif (dataType == this._dataType)\n\t\t\tthis._dataDirty = true;\n\t}\n}\n\nexport = VertexData;","/*!\tSWFObject v2.2 <http://code.google.com/p/swfobject/> \n\tis released under the MIT License <http://www.opensource.org/licenses/mit-license.php> \n*/\n\nvar swfobject = function() {\n\t\n\tvar UNDEF = \"undefined\",\n\t\tOBJECT = \"object\",\n\t\tSHOCKWAVE_FLASH = \"Shockwave Flash\",\n\t\tSHOCKWAVE_FLASH_AX = \"ShockwaveFlash.ShockwaveFlash\",\n\t\tFLASH_MIME_TYPE = \"application/x-shockwave-flash\",\n\t\tEXPRESS_INSTALL_ID = \"SWFObjectExprInst\",\n\t\tON_READY_STATE_CHANGE = \"onreadystatechange\",\n\t\t\n\t\twin = window,\n\t\tdoc = document,\n\t\tnav = navigator,\n\t\t\n\t\tplugin = false,\n\t\tdomLoadFnArr = [main],\n\t\tregObjArr = [],\n\t\tobjIdArr = [],\n\t\tlistenersArr = [],\n\t\tstoredAltContent,\n\t\tstoredAltContentId,\n\t\tstoredCallbackFn,\n\t\tstoredCallbackObj,\n\t\tisDomLoaded = false,\n\t\tisExpressInstallActive = false,\n\t\tdynamicStylesheet,\n\t\tdynamicStylesheetMedia,\n\t\tautoHideShow = true,\n\t\n\t/* Centralized function for browser feature detection\n\t\t- User agent string detection is only used when no good alternative is possible\n\t\t- Is executed directly for optimal performance\n\t*/\t\n\tua = function() {\n\t\tvar w3cdom = typeof doc.getElementById != UNDEF && typeof doc.getElementsByTagName != UNDEF && typeof doc.createElement != UNDEF,\n\t\t\tu = nav.userAgent.toLowerCase(),\n\t\t\tp = nav.platform.toLowerCase(),\n\t\t\twindows = p ? /win/.test(p) : /win/.test(u),\n\t\t\tmac = p ? /mac/.test(p) : /mac/.test(u),\n\t\t\twebkit = /webkit/.test(u) ? parseFloat(u.replace(/^.*webkit\\/(\\d+(\\.\\d+)?).*$/, \"$1\")) : false, // returns either the webkit version or false if not webkit\n\t\t\tie = !+\"\\v1\", // feature detection based on Andrea Giammarchi's solution: http://webreflection.blogspot.com/2009/01/32-bytes-to-know-if-your-browser-is-ie.html\n\t\t\tplayerVersion = [0,0,0],\n\t\t\td = null;\n\t\tif (typeof nav.plugins != UNDEF && typeof nav.plugins[SHOCKWAVE_FLASH] == OBJECT) {\n\t\t\td = nav.plugins[SHOCKWAVE_FLASH].description;\n\t\t\tif (d && !(typeof nav.mimeTypes != UNDEF && nav.mimeTypes[FLASH_MIME_TYPE] && !nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)) { // navigator.mimeTypes[\"application/x-shockwave-flash\"].enabledPlugin indicates whether plug-ins are enabled or disabled in Safari 3+\n\t\t\t\tplugin = true;\n\t\t\t\tie = false; // cascaded feature detection for Internet Explorer\n\t\t\t\td = d.replace(/^.*\\s+(\\S+\\s+\\S+$)/, \"$1\");\n\t\t\t\tplayerVersion[0] = parseInt(d.replace(/^(.*)\\..*$/, \"$1\"), 10);\n\t\t\t\tplayerVersion[1] = parseInt(d.replace(/^.*\\.(.*)\\s.*$/, \"$1\"), 10);\n\t\t\t\tplayerVersion[2] = /[a-zA-Z]/.test(d) ? parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/, \"$1\"), 10) : 0;\n\t\t\t}\n\t\t}\n\t\telse if (typeof win.ActiveXObject != UNDEF) {\n\t\t\ttry {\n\t\t\t\tvar a = new ActiveXObject(SHOCKWAVE_FLASH_AX);\n\t\t\t\tif (a) { // a will return null when ActiveX is disabled\n\t\t\t\t\td = a.GetVariable(\"$version\");\n\t\t\t\t\tif (d) {\n\t\t\t\t\t\tie = true; // cascaded feature detection for Internet Explorer\n\t\t\t\t\t\td = d.split(\" \")[1].split(\",\");\n\t\t\t\t\t\tplayerVersion = [parseInt(d[0], 10), parseInt(d[1], 10), parseInt(d[2], 10)];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch(e) {}\n\t\t}\n\t\treturn { w3:w3cdom, pv:playerVersion, wk:webkit, ie:ie, win:windows, mac:mac };\n\t}(),\n\t\n\t/* Cross-browser onDomLoad\n\t\t- Will fire an event as soon as the DOM of a web page is loaded\n\t\t- Internet Explorer workaround based on Diego Perini's solution: http://javascript.nwbox.com/IEContentLoaded/\n\t\t- Regular onload serves as fallback\n\t*/ \n\tonDomLoad = function() {\n\t\tif (!ua.w3) { return; }\n\t\tif ((typeof doc.readyState != UNDEF && doc.readyState == \"complete\") || (typeof doc.readyState == UNDEF && (doc.getElementsByTagName(\"body\")[0] || doc.body))) { // function is fired after onload, e.g. when script is inserted dynamically \n\t\t\tcallDomLoadFunctions();\n\t\t}\n\t\tif (!isDomLoaded) {\n\t\t\tif (typeof doc.addEventListener != UNDEF) {\n\t\t\t\tdoc.addEventListener(\"DOMContentLoaded\", callDomLoadFunctions, false);\n\t\t\t}\t\t\n\t\t\tif (ua.ie && ua.win) {\n\t\t\t\tdoc.attachEvent(ON_READY_STATE_CHANGE, function() {\n\t\t\t\t\tif (doc.readyState == \"complete\") {\n\t\t\t\t\t\tdoc.detachEvent(ON_READY_STATE_CHANGE, arguments.callee);\n\t\t\t\t\t\tcallDomLoadFunctions();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (win == top) { // if not inside an iframe\n\t\t\t\t\t(function(){\n\t\t\t\t\t\tif (isDomLoaded) { return; }\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tdoc.documentElement.doScroll(\"left\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch(e) {\n\t\t\t\t\t\t\tsetTimeout(arguments.callee, 0);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcallDomLoadFunctions();\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (ua.wk) {\n\t\t\t\t(function(){\n\t\t\t\t\tif (isDomLoaded) { return; }\n\t\t\t\t\tif (!/loaded|complete/.test(doc.readyState)) {\n\t\t\t\t\t\tsetTimeout(arguments.callee, 0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tcallDomLoadFunctions();\n\t\t\t\t})();\n\t\t\t}\n\t\t\taddLoadEvent(callDomLoadFunctions);\n\t\t}\n\t}();\n\t\n\tfunction callDomLoadFunctions() {\n\t\tif (isDomLoaded) { return; }\n\t\ttry { // test if we can really add/remove elements to/from the DOM; we don't want to fire it too early\n\t\t\tvar t = doc.getElementsByTagName(\"body\")[0].appendChild(createElement(\"span\"));\n\t\t\tt.parentNode.removeChild(t);\n\t\t}\n\t\tcatch (e) { return; }\n\t\tisDomLoaded = true;\n\t\tvar dl = domLoadFnArr.length;\n\t\tfor (var i = 0; i < dl; i++) {\n\t\t\tdomLoadFnArr[i]();\n\t\t}\n\t}\n\t\n\tfunction addDomLoadEvent(fn) {\n\t\tif (isDomLoaded) {\n\t\t\tfn();\n\t\t}\n\t\telse { \n\t\t\tdomLoadFnArr[domLoadFnArr.length] = fn; // Array.push() is only available in IE5.5+\n\t\t}\n\t}\n\t\n\t/* Cross-browser onload\n\t\t- Based on James Edwards' solution: http://brothercake.com/site/resources/scripts/onload/\n\t\t- Will fire an event as soon as a web page including all of its assets are loaded \n\t */\n\tfunction addLoadEvent(fn) {\n\t\tif (typeof win.addEventListener != UNDEF) {\n\t\t\twin.addEventListener(\"load\", fn, false);\n\t\t}\n\t\telse if (typeof doc.addEventListener != UNDEF) {\n\t\t\tdoc.addEventListener(\"load\", fn, false);\n\t\t}\n\t\telse if (typeof win.attachEvent != UNDEF) {\n\t\t\taddListener(win, \"onload\", fn);\n\t\t}\n\t\telse if (typeof win.onload == \"function\") {\n\t\t\tvar fnOld = win.onload;\n\t\t\twin.onload = function() {\n\t\t\t\tfnOld();\n\t\t\t\tfn();\n\t\t\t};\n\t\t}\n\t\telse {\n\t\t\twin.onload = fn;\n\t\t}\n\t}\n\t\n\t/* Main function\n\t\t- Will preferably execute onDomLoad, otherwise onload (as a fallback)\n\t*/\n\tfunction main() { \n\t\tif (plugin) {\n\t\t\ttestPlayerVersion();\n\t\t}\n\t\telse {\n\t\t\tmatchVersions();\n\t\t}\n\t}\n\t\n\t/* Detect the Flash Player version for non-Internet Explorer browsers\n\t\t- Detecting the plug-in version via the object element is more precise than using the plugins collection item's description:\n\t\t  a. Both release and build numbers can be detected\n\t\t  b. Avoid wrong descriptions by corrupt installers provided by Adobe\n\t\t  c. Avoid wrong descriptions by multiple Flash Player entries in the plugin Array, caused by incorrect browser imports\n\t\t- Disadvantage of this method is that it depends on the availability of the DOM, while the plugins collection is immediately available\n\t*/\n\tfunction testPlayerVersion() {\n\t\tvar b = doc.getElementsByTagName(\"body\")[0];\n\t\tvar o = createElement(OBJECT);\n\t\to.setAttribute(\"type\", FLASH_MIME_TYPE);\n\t\tvar t = b.appendChild(o);\n\t\tif (t) {\n\t\t\tvar counter = 0;\n\t\t\t(function(){\n\t\t\t\tif (typeof t.GetVariable != UNDEF) {\n\t\t\t\t\tvar d = t.GetVariable(\"$version\");\n\t\t\t\t\tif (d) {\n\t\t\t\t\t\td = d.split(\" \")[1].split(\",\");\n\t\t\t\t\t\tua.pv = [parseInt(d[0], 10), parseInt(d[1], 10), parseInt(d[2], 10)];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (counter < 10) {\n\t\t\t\t\tcounter++;\n\t\t\t\t\tsetTimeout(arguments.callee, 10);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tb.removeChild(o);\n\t\t\t\tt = null;\n\t\t\t\tmatchVersions();\n\t\t\t})();\n\t\t}\n\t\telse {\n\t\t\tmatchVersions();\n\t\t}\n\t}\n\t\n\t/* Perform Flash Player and SWF version matching; static publishing only\n\t*/\n\tfunction matchVersions() {\n\t\tvar rl = regObjArr.length;\n\t\tif (rl > 0) {\n\t\t\tfor (var i = 0; i < rl; i++) { // for each registered object element\n\t\t\t\tvar id = regObjArr[i].id;\n\t\t\t\tvar cb = regObjArr[i].callbackFn;\n\t\t\t\tvar cbObj = {success:false, id:id};\n\t\t\t\tif (ua.pv[0] > 0) {\n\t\t\t\t\tvar obj = getElementById(id);\n\t\t\t\t\tif (obj) {\n\t\t\t\t\t\tif (hasPlayerVersion(regObjArr[i].swfVersion) && !(ua.wk && ua.wk < 312)) { // Flash Player version >= published SWF version: Houston, we have a match!\n\t\t\t\t\t\t\tsetVisibility(id, true);\n\t\t\t\t\t\t\tif (cb) {\n\t\t\t\t\t\t\t\tcbObj.success = true;\n\t\t\t\t\t\t\t\tcbObj.ref = getObjectById(id);\n\t\t\t\t\t\t\t\tcb(cbObj);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (regObjArr[i].expressInstall && canExpressInstall()) { // show the Adobe Express Install dialog if set by the web page author and if supported\n\t\t\t\t\t\t\tvar att = {};\n\t\t\t\t\t\t\tatt.data = regObjArr[i].expressInstall;\n\t\t\t\t\t\t\tatt.width = obj.getAttribute(\"width\") || \"0\";\n\t\t\t\t\t\t\tatt.height = obj.getAttribute(\"height\") || \"0\";\n\t\t\t\t\t\t\tif (obj.getAttribute(\"class\")) { att.styleclass = obj.getAttribute(\"class\"); }\n\t\t\t\t\t\t\tif (obj.getAttribute(\"align\")) { att.align = obj.getAttribute(\"align\"); }\n\t\t\t\t\t\t\t// parse HTML object param element's name-value pairs\n\t\t\t\t\t\t\tvar par = {};\n\t\t\t\t\t\t\tvar p = obj.getElementsByTagName(\"param\");\n\t\t\t\t\t\t\tvar pl = p.length;\n\t\t\t\t\t\t\tfor (var j = 0; j < pl; j++) {\n\t\t\t\t\t\t\t\tif (p[j].getAttribute(\"name\").toLowerCase() != \"movie\") {\n\t\t\t\t\t\t\t\t\tpar[p[j].getAttribute(\"name\")] = p[j].getAttribute(\"value\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tshowExpressInstall(att, par, id, cb);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse { // Flash Player and SWF version mismatch or an older Webkit engine that ignores the HTML object element's nested param elements: display alternative content instead of SWF\n\t\t\t\t\t\t\tdisplayAltContent(obj);\n\t\t\t\t\t\t\tif (cb) { cb(cbObj); }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\t// if no Flash Player is installed or the fp version cannot be detected we let the HTML object element do its job (either show a SWF or alternative content)\n\t\t\t\t\tsetVisibility(id, true);\n\t\t\t\t\tif (cb) {\n\t\t\t\t\t\tvar o = getObjectById(id); // test whether there is an HTML object element or not\n\t\t\t\t\t\tif (o && typeof o.SetVariable != UNDEF) { \n\t\t\t\t\t\t\tcbObj.success = true;\n\t\t\t\t\t\t\tcbObj.ref = o;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcb(cbObj);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getObjectById(objectIdStr) {\n\t\tvar r = null;\n\t\tvar o = getElementById(objectIdStr);\n\t\tif (o && o.nodeName == \"OBJECT\") {\n\t\t\tif (typeof o.SetVariable != UNDEF) {\n\t\t\t\tr = o;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar n = o.getElementsByTagName(OBJECT)[0];\n\t\t\t\tif (n) {\n\t\t\t\t\tr = n;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn r;\n\t}\n\t\n\t/* Requirements for Adobe Express Install\n\t\t- only one instance can be active at a time\n\t\t- fp 6.0.65 or higher\n\t\t- Win/Mac OS only\n\t\t- no Webkit engines older than version 312\n\t*/\n\tfunction canExpressInstall() {\n\t\treturn !isExpressInstallActive && hasPlayerVersion(\"6.0.65\") && (ua.win || ua.mac) && !(ua.wk && ua.wk < 312);\n\t}\n\t\n\t/* Show the Adobe Express Install dialog\n\t\t- Reference: http://www.adobe.com/cfusion/knowledgebase/index.cfm?id=6a253b75\n\t*/\n\tfunction showExpressInstall(att, par, replaceElemIdStr, callbackFn) {\n\t\tisExpressInstallActive = true;\n\t\tstoredCallbackFn = callbackFn || null;\n\t\tstoredCallbackObj = {success:false, id:replaceElemIdStr};\n\t\tvar obj = getElementById(replaceElemIdStr);\n\t\tif (obj) {\n\t\t\tif (obj.nodeName == \"OBJECT\") { // static publishing\n\t\t\t\tstoredAltContent = abstractAltContent(obj);\n\t\t\t\tstoredAltContentId = null;\n\t\t\t}\n\t\t\telse { // dynamic publishing\n\t\t\t\tstoredAltContent = obj;\n\t\t\t\tstoredAltContentId = replaceElemIdStr;\n\t\t\t}\n\t\t\tatt.id = EXPRESS_INSTALL_ID;\n\t\t\tif (typeof att.width == UNDEF || (!/%$/.test(att.width) && parseInt(att.width, 10) < 310)) { att.width = \"310\"; }\n\t\t\tif (typeof att.height == UNDEF || (!/%$/.test(att.height) && parseInt(att.height, 10) < 137)) { att.height = \"137\"; }\n\t\t\tdoc.title = doc.title.slice(0, 47) + \" - Flash Player Installation\";\n\t\t\tvar pt = ua.ie && ua.win ? \"ActiveX\" : \"PlugIn\",\n\t\t\t\tfv = \"MMredirectURL=\" + encodeURI(window.location).toString().replace(/&/g,\"%26\") + \"&MMplayerType=\" + pt + \"&MMdoctitle=\" + doc.title;\n\t\t\tif (typeof par.flashvars != UNDEF) {\n\t\t\t\tpar.flashvars += \"&\" + fv;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tpar.flashvars = fv;\n\t\t\t}\n\t\t\t// IE only: when a SWF is loading (AND: not available in cache) wait for the readyState of the object element to become 4 before removing it,\n\t\t\t// because you cannot properly cancel a loading SWF file without breaking browser load references, also obj.onreadystatechange doesn't work\n\t\t\tif (ua.ie && ua.win && obj.readyState != 4) {\n\t\t\t\tvar newObj = createElement(\"div\");\n\t\t\t\treplaceElemIdStr += \"SWFObjectNew\";\n\t\t\t\tnewObj.setAttribute(\"id\", replaceElemIdStr);\n\t\t\t\tobj.parentNode.insertBefore(newObj, obj); // insert placeholder div that will be replaced by the object element that loads expressinstall.swf\n\t\t\t\tobj.style.display = \"none\";\n\t\t\t\t(function(){\n\t\t\t\t\tif (obj.readyState == 4) {\n\t\t\t\t\t\tobj.parentNode.removeChild(obj);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tsetTimeout(arguments.callee, 10);\n\t\t\t\t\t}\n\t\t\t\t})();\n\t\t\t}\n\t\t\tcreateSWF(att, par, replaceElemIdStr);\n\t\t}\n\t}\n\t\n\t/* Functions to abstract and display alternative content\n\t*/\n\tfunction displayAltContent(obj) {\n\t\tif (ua.ie && ua.win && obj.readyState != 4) {\n\t\t\t// IE only: when a SWF is loading (AND: not available in cache) wait for the readyState of the object element to become 4 before removing it,\n\t\t\t// because you cannot properly cancel a loading SWF file without breaking browser load references, also obj.onreadystatechange doesn't work\n\t\t\tvar el = createElement(\"div\");\n\t\t\tobj.parentNode.insertBefore(el, obj); // insert placeholder div that will be replaced by the alternative content\n\t\t\tel.parentNode.replaceChild(abstractAltContent(obj), el);\n\t\t\tobj.style.display = \"none\";\n\t\t\t(function(){\n\t\t\t\tif (obj.readyState == 4) {\n\t\t\t\t\tobj.parentNode.removeChild(obj);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tsetTimeout(arguments.callee, 10);\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\t\telse {\n\t\t\tobj.parentNode.replaceChild(abstractAltContent(obj), obj);\n\t\t}\n\t} \n\n\tfunction abstractAltContent(obj) {\n\t\tvar ac = createElement(\"div\");\n\t\tif (ua.win && ua.ie) {\n\t\t\tac.innerHTML = obj.innerHTML;\n\t\t}\n\t\telse {\n\t\t\tvar nestedObj = obj.getElementsByTagName(OBJECT)[0];\n\t\t\tif (nestedObj) {\n\t\t\t\tvar c = nestedObj.childNodes;\n\t\t\t\tif (c) {\n\t\t\t\t\tvar cl = c.length;\n\t\t\t\t\tfor (var i = 0; i < cl; i++) {\n\t\t\t\t\t\tif (!(c[i].nodeType == 1 && c[i].nodeName == \"PARAM\") && !(c[i].nodeType == 8)) {\n\t\t\t\t\t\t\tac.appendChild(c[i].cloneNode(true));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn ac;\n\t}\n\t\n\t/* Cross-browser dynamic SWF creation\n\t*/\n\tfunction createSWF(attObj, parObj, id) {\n\t\tvar r, el = getElementById(id);\n\t\tif (ua.wk && ua.wk < 312) { return r; }\n\t\tif (el) {\n\t\t\tif (typeof attObj.id == UNDEF) { // if no 'id' is defined for the object element, it will inherit the 'id' from the alternative content\n\t\t\t\tattObj.id = id;\n\t\t\t}\n\t\t\tif (ua.ie && ua.win) { // Internet Explorer + the HTML object element + W3C DOM methods do not combine: fall back to outerHTML\n\t\t\t\tvar att = \"\";\n\t\t\t\tfor (var i in attObj) {\n\t\t\t\t\tif (attObj[i] != Object.prototype[i]) { // filter out prototype additions from other potential libraries\n\t\t\t\t\t\tif (i.toLowerCase() == \"data\") {\n\t\t\t\t\t\t\tparObj.movie = attObj[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (i.toLowerCase() == \"styleclass\") { // 'class' is an ECMA4 reserved keyword\n\t\t\t\t\t\t\tatt += ' class=\"' + attObj[i] + '\"';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (i.toLowerCase() != \"classid\") {\n\t\t\t\t\t\t\tatt += ' ' + i + '=\"' + attObj[i] + '\"';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar par = \"\";\n\t\t\t\tfor (var j in parObj) {\n\t\t\t\t\tif (parObj[j] != Object.prototype[j]) { // filter out prototype additions from other potential libraries\n\t\t\t\t\t\tpar += '<param name=\"' + j + '\" value=\"' + parObj[j] + '\" />';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tel.outerHTML = '<object classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\"' + att + '>' + par + '</object>';\n\t\t\t\tobjIdArr[objIdArr.length] = attObj.id; // stored to fix object 'leaks' on unload (dynamic publishing only)\n\t\t\t\tr = getElementById(attObj.id);\t\n\t\t\t}\n\t\t\telse { // well-behaving browsers\n\t\t\t\tvar o = createElement(OBJECT);\n\t\t\t\to.setAttribute(\"type\", FLASH_MIME_TYPE);\n\t\t\t\tfor (var m in attObj) {\n\t\t\t\t\tif (attObj[m] != Object.prototype[m]) { // filter out prototype additions from other potential libraries\n\t\t\t\t\t\tif (m.toLowerCase() == \"styleclass\") { // 'class' is an ECMA4 reserved keyword\n\t\t\t\t\t\t\to.setAttribute(\"class\", attObj[m]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (m.toLowerCase() != \"classid\") { // filter out IE specific attribute\n\t\t\t\t\t\t\to.setAttribute(m, attObj[m]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (var n in parObj) {\n\t\t\t\t\tif (parObj[n] != Object.prototype[n] && n.toLowerCase() != \"movie\") { // filter out prototype additions from other potential libraries and IE specific param element\n\t\t\t\t\t\tcreateObjParam(o, n, parObj[n]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tel.parentNode.replaceChild(o, el);\n\t\t\t\tr = o;\n\t\t\t}\n\t\t}\n\t\treturn r;\n\t}\n\t\n\tfunction createObjParam(el, pName, pValue) {\n\t\tvar p = createElement(\"param\");\n\t\tp.setAttribute(\"name\", pName);\t\n\t\tp.setAttribute(\"value\", pValue);\n\t\tel.appendChild(p);\n\t}\n\t\n\t/* Cross-browser SWF removal\n\t\t- Especially needed to safely and completely remove a SWF in Internet Explorer\n\t*/\n\tfunction removeSWF(id) {\n\t\tvar obj = getElementById(id);\n\t\tif (obj && obj.nodeName == \"OBJECT\") {\n\t\t\tif (ua.ie && ua.win) {\n\t\t\t\tobj.style.display = \"none\";\n\t\t\t\t(function(){\n\t\t\t\t\tif (obj.readyState == 4) {\n\t\t\t\t\t\tremoveObjectInIE(id);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tsetTimeout(arguments.callee, 10);\n\t\t\t\t\t}\n\t\t\t\t})();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tobj.parentNode.removeChild(obj);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction removeObjectInIE(id) {\n\t\tvar obj = getElementById(id);\n\t\tif (obj) {\n\t\t\tfor (var i in obj) {\n\t\t\t\tif (typeof obj[i] == \"function\") {\n\t\t\t\t\tobj[i] = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tobj.parentNode.removeChild(obj);\n\t\t}\n\t}\n\t\n\t/* Functions to optimize JavaScript compression\n\t*/\n\tfunction getElementById(id) {\n\t\tvar el = null;\n\t\ttry {\n\t\t\tel = doc.getElementById(id);\n\t\t}\n\t\tcatch (e) {}\n\t\treturn el;\n\t}\n\t\n\tfunction createElement(el) {\n\t\treturn doc.createElement(el);\n\t}\n\t\n\t/* Updated attachEvent function for Internet Explorer\n\t\t- Stores attachEvent information in an Array, so on unload the detachEvent functions can be called to avoid memory leaks\n\t*/\t\n\tfunction addListener(target, eventType, fn) {\n\t\ttarget.attachEvent(eventType, fn);\n\t\tlistenersArr[listenersArr.length] = [target, eventType, fn];\n\t}\n\t\n\t/* Flash Player and SWF content version matching\n\t*/\n\tfunction hasPlayerVersion(rv) {\n\t\tvar pv = ua.pv, v = rv.split(\".\");\n\t\tv[0] = parseInt(v[0], 10);\n\t\tv[1] = parseInt(v[1], 10) || 0; // supports short notation, e.g. \"9\" instead of \"9.0.0\"\n\t\tv[2] = parseInt(v[2], 10) || 0;\n\t\treturn (pv[0] > v[0] || (pv[0] == v[0] && pv[1] > v[1]) || (pv[0] == v[0] && pv[1] == v[1] && pv[2] >= v[2])) ? true : false;\n\t}\n\t\n\t/* Cross-browser dynamic CSS creation\n\t\t- Based on Bobby van der Sluis' solution: http://www.bobbyvandersluis.com/articles/dynamicCSS.php\n\t*/\t\n\tfunction createCSS(sel, decl, media, newStyle) {\n\t\tif (ua.ie && ua.mac) { return; }\n\t\tvar h = doc.getElementsByTagName(\"head\")[0];\n\t\tif (!h) { return; } // to also support badly authored HTML pages that lack a head element\n\t\tvar m = (media && typeof media == \"string\") ? media : \"screen\";\n\t\tif (newStyle) {\n\t\t\tdynamicStylesheet = null;\n\t\t\tdynamicStylesheetMedia = null;\n\t\t}\n\t\tif (!dynamicStylesheet || dynamicStylesheetMedia != m) { \n\t\t\t// create dynamic stylesheet + get a global reference to it\n\t\t\tvar s = createElement(\"style\");\n\t\t\ts.setAttribute(\"type\", \"text/css\");\n\t\t\ts.setAttribute(\"media\", m);\n\t\t\tdynamicStylesheet = h.appendChild(s);\n\t\t\tif (ua.ie && ua.win && typeof doc.styleSheets != UNDEF && doc.styleSheets.length > 0) {\n\t\t\t\tdynamicStylesheet = doc.styleSheets[doc.styleSheets.length - 1];\n\t\t\t}\n\t\t\tdynamicStylesheetMedia = m;\n\t\t}\n\t\t// add style rule\n\t\tif (ua.ie && ua.win) {\n\t\t\tif (dynamicStylesheet && typeof dynamicStylesheet.addRule == OBJECT) {\n\t\t\t\tdynamicStylesheet.addRule(sel, decl);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (dynamicStylesheet && typeof doc.createTextNode != UNDEF) {\n\t\t\t\tdynamicStylesheet.appendChild(doc.createTextNode(sel + \" {\" + decl + \"}\"));\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction setVisibility(id, isVisible) {\n\t\tif (!autoHideShow) { return; }\n\t\tvar v = isVisible ? \"visible\" : \"hidden\";\n\t\tif (isDomLoaded && getElementById(id)) {\n\t\t\tgetElementById(id).style.visibility = v;\n\t\t}\n\t\telse {\n\t\t\tcreateCSS(\"#\" + id, \"visibility:\" + v);\n\t\t}\n\t}\n\n\t/* Filter to avoid XSS attacks\n\t*/\n\tfunction urlEncodeIfNecessary(s) {\n\t\tvar regex = /[\\\\\\\"<>\\.;]/;\n\t\tvar hasBadChars = regex.exec(s) != null;\n\t\treturn hasBadChars && typeof encodeURIComponent != UNDEF ? encodeURIComponent(s) : s;\n\t}\n\t\n\t/* Release memory to avoid memory leaks caused by closures, fix hanging audio/video threads and force open sockets/NetConnections to disconnect (Internet Explorer only)\n\t*/\n\tvar cleanup = function() {\n\t\tif (ua.ie && ua.win) {\n\t\t\twindow.attachEvent(\"onunload\", function() {\n\t\t\t\t// remove listeners to avoid memory leaks\n\t\t\t\tvar ll = listenersArr.length;\n\t\t\t\tfor (var i = 0; i < ll; i++) {\n\t\t\t\t\tlistenersArr[i][0].detachEvent(listenersArr[i][1], listenersArr[i][2]);\n\t\t\t\t}\n\t\t\t\t// cleanup dynamically embedded objects to fix audio/video threads and force open sockets and NetConnections to disconnect\n\t\t\t\tvar il = objIdArr.length;\n\t\t\t\tfor (var j = 0; j < il; j++) {\n\t\t\t\t\tremoveSWF(objIdArr[j]);\n\t\t\t\t}\n\t\t\t\t// cleanup library's main closures to avoid memory leaks\n\t\t\t\tfor (var k in ua) {\n\t\t\t\t\tua[k] = null;\n\t\t\t\t}\n\t\t\t\tua = null;\n\t\t\t\tfor (var l in swfobject) {\n\t\t\t\t\tswfobject[l] = null;\n\t\t\t\t}\n\t\t\t\tswfobject = null;\n\t\t\t});\n\t\t}\n\t}();\n\t\n\treturn {\n\t\t/* Public API\n\t\t\t- Reference: http://code.google.com/p/swfobject/wiki/documentation\n\t\t*/ \n\t\tregisterObject: function(objectIdStr, swfVersionStr, xiSwfUrlStr, callbackFn) {\n\t\t\tif (ua.w3 && objectIdStr && swfVersionStr) {\n\t\t\t\tvar regObj = {};\n\t\t\t\tregObj.id = objectIdStr;\n\t\t\t\tregObj.swfVersion = swfVersionStr;\n\t\t\t\tregObj.expressInstall = xiSwfUrlStr;\n\t\t\t\tregObj.callbackFn = callbackFn;\n\t\t\t\tregObjArr[regObjArr.length] = regObj;\n\t\t\t\tsetVisibility(objectIdStr, false);\n\t\t\t}\n\t\t\telse if (callbackFn) {\n\t\t\t\tcallbackFn({success:false, id:objectIdStr});\n\t\t\t}\n\t\t},\n\t\t\n\t\tgetObjectById: function(objectIdStr) {\n\t\t\tif (ua.w3) {\n\t\t\t\treturn getObjectById(objectIdStr);\n\t\t\t}\n\t\t},\n\t\t\n\t\tembedSWF: function(swfUrlStr, replaceElemIdStr, widthStr, heightStr, swfVersionStr, xiSwfUrlStr, flashvarsObj, parObj, attObj, callbackFn) {\n\t\t\tvar callbackObj = {success:false, id:replaceElemIdStr};\n\t\t\tif (ua.w3 && !(ua.wk && ua.wk < 312) && swfUrlStr && replaceElemIdStr && widthStr && heightStr && swfVersionStr) {\n\t\t\t\tsetVisibility(replaceElemIdStr, false);\n\t\t\t\taddDomLoadEvent(function() {\n\t\t\t\t\twidthStr += \"\"; // auto-convert to string\n\t\t\t\t\theightStr += \"\";\n\t\t\t\t\tvar att = {};\n\t\t\t\t\tif (attObj && typeof attObj === OBJECT) {\n\t\t\t\t\t\tfor (var i in attObj) { // copy object to avoid the use of references, because web authors often reuse attObj for multiple SWFs\n\t\t\t\t\t\t\tatt[i] = attObj[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tatt.data = swfUrlStr;\n\t\t\t\t\tatt.width = widthStr;\n\t\t\t\t\tatt.height = heightStr;\n\t\t\t\t\tvar par = {}; \n\t\t\t\t\tif (parObj && typeof parObj === OBJECT) {\n\t\t\t\t\t\tfor (var j in parObj) { // copy object to avoid the use of references, because web authors often reuse parObj for multiple SWFs\n\t\t\t\t\t\t\tpar[j] = parObj[j];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (flashvarsObj && typeof flashvarsObj === OBJECT) {\n\t\t\t\t\t\tfor (var k in flashvarsObj) { // copy object to avoid the use of references, because web authors often reuse flashvarsObj for multiple SWFs\n\t\t\t\t\t\t\tif (typeof par.flashvars != UNDEF) {\n\t\t\t\t\t\t\t\tpar.flashvars += \"&\" + k + \"=\" + flashvarsObj[k];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tpar.flashvars = k + \"=\" + flashvarsObj[k];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (hasPlayerVersion(swfVersionStr)) { // create SWF\n\t\t\t\t\t\tvar obj = createSWF(att, par, replaceElemIdStr);\n\t\t\t\t\t\tif (att.id == replaceElemIdStr) {\n\t\t\t\t\t\t\tsetVisibility(replaceElemIdStr, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcallbackObj.success = true;\n\t\t\t\t\t\tcallbackObj.ref = obj;\n\t\t\t\t\t}\n\t\t\t\t\telse if (xiSwfUrlStr && canExpressInstall()) { // show Adobe Express Install\n\t\t\t\t\t\tatt.data = xiSwfUrlStr;\n\t\t\t\t\t\tshowExpressInstall(att, par, replaceElemIdStr, callbackFn);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse { // show alternative content\n\t\t\t\t\t\tsetVisibility(replaceElemIdStr, true);\n\t\t\t\t\t}\n\t\t\t\t\tif (callbackFn) { callbackFn(callbackObj); }\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (callbackFn) { callbackFn(callbackObj);\t}\n\t\t},\n\t\t\n\t\tswitchOffAutoHideShow: function() {\n\t\t\tautoHideShow = false;\n\t\t},\n\t\t\n\t\tua: ua,\n\t\t\n\t\tgetFlashPlayerVersion: function() {\n\t\t\treturn { major:ua.pv[0], minor:ua.pv[1], release:ua.pv[2] };\n\t\t},\n\t\t\n\t\thasFlashPlayerVersion: hasPlayerVersion,\n\t\t\n\t\tcreateSWF: function(attObj, parObj, replaceElemIdStr) {\n\t\t\tif (ua.w3) {\n\t\t\t\treturn createSWF(attObj, parObj, replaceElemIdStr);\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t},\n\t\t\n\t\tshowExpressInstall: function(att, par, replaceElemIdStr, callbackFn) {\n\t\t\tif (ua.w3 && canExpressInstall()) {\n\t\t\t\tshowExpressInstall(att, par, replaceElemIdStr, callbackFn);\n\t\t\t}\n\t\t},\n\t\t\n\t\tremoveSWF: function(objElemIdStr) {\n\t\t\tif (ua.w3) {\n\t\t\t\tremoveSWF(objElemIdStr);\n\t\t\t}\n\t\t},\n\t\t\n\t\tcreateCSS: function(selStr, declStr, mediaStr, newStyleBoolean) {\n\t\t\tif (ua.w3) {\n\t\t\t\tcreateCSS(selStr, declStr, mediaStr, newStyleBoolean);\n\t\t\t}\n\t\t},\n\t\t\n\t\taddDomLoadEvent: addDomLoadEvent,\n\t\t\n\t\taddLoadEvent: addLoadEvent,\n\t\t\n\t\tgetQueryParamValue: function(param) {\n\t\t\tvar q = doc.location.search || doc.location.hash;\n\t\t\tif (q) {\n\t\t\t\tif (/\\?/.test(q)) { q = q.split(\"?\")[1]; } // strip question mark\n\t\t\t\tif (param == null) {\n\t\t\t\t\treturn urlEncodeIfNecessary(q);\n\t\t\t\t}\n\t\t\t\tvar pairs = q.split(\"&\");\n\t\t\t\tfor (var i = 0; i < pairs.length; i++) {\n\t\t\t\t\tif (pairs[i].substring(0, pairs[i].indexOf(\"=\")) == param) {\n\t\t\t\t\t\treturn urlEncodeIfNecessary(pairs[i].substring((pairs[i].indexOf(\"=\") + 1)));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn \"\";\n\t\t},\n\t\t\n\t\t// For internal usage only\n\t\texpressInstallCallback: function() {\n\t\t\tif (isExpressInstallActive) {\n\t\t\t\tvar obj = getElementById(EXPRESS_INSTALL_ID);\n\t\t\t\tif (obj && storedAltContent) {\n\t\t\t\t\tobj.parentNode.replaceChild(storedAltContent, obj);\n\t\t\t\t\tif (storedAltContentId) {\n\t\t\t\t\t\tsetVisibility(storedAltContentId, true);\n\t\t\t\t\t\tif (ua.ie && ua.win) { storedAltContent.style.display = \"block\"; }\n\t\t\t\t\t}\n\t\t\t\t\tif (storedCallbackFn) { storedCallbackFn(storedCallbackObj); }\n\t\t\t\t}\n\t\t\t\tisExpressInstallActive = false;\n\t\t\t} \n\t\t}\n\t};\n}();\n\nmodule.exports = swfobject;"],"sourceRoot":"/Users/robbateman/WebstormProjects/awayjs-examples/bin/js"}