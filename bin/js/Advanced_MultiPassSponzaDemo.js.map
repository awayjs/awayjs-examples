{
  "version": 3,
  "sources": [
    "node_modules/browserify/node_modules/browser-pack/_prelude.js",
    "src/Advanced_MultiPassSponzaDemo.ts",
    "Advanced_MultiPassSponzaDemo.js"
  ],
  "names": [
    "e",
    "t",
    "n",
    "r",
    "s",
    "o",
    "u",
    "a",
    "require",
    "i",
    "f",
    "Error",
    "code",
    "l",
    "exports",
    "call",
    "length",
    1,
    "module",
    "BlendMode",
    "Event",
    "AssetEvent",
    "ProgressEvent",
    "LoaderEvent",
    "UVTransform",
    "Vector3D",
    "AssetLibrary",
    "AssetLoaderContext",
    "AssetType",
    "URLLoader",
    "URLLoaderDataFormat",
    "URLRequest",
    "ParserUtils",
    "ImageTexture",
    "SpecularBitmapTexture",
    "Keyboard",
    "RequestAnimationFrame",
    "Loader",
    "View",
    "FirstPersonController",
    "Geometry",
    "Mesh",
    "Skybox",
    "DirectionalLight",
    "PointLight",
    "StaticLightPicker",
    "PrimitivePlanePrefab",
    "Cast",
    "Merge",
    "DefaultRenderer",
    "MethodMaterial",
    "MethodMaterialMode",
    "MethodRendererPool",
    "ShadowSoftMethod",
    "EffectFogMethod",
    "AWDParser",
    "Advanced_MultiPassSponzaDemo",
    "this",
    "_assetsRoot",
    "_materialNameStrings",
    "Array",
    "_diffuseTextureStrings",
    "_normalTextureStrings",
    "_specularTextureStrings",
    "_numTexStrings",
    "_meshReference",
    "_flameData",
    "FlameVO",
    "_textureDictionary",
    "Object",
    "_multiMaterialDictionary",
    "_singleMaterialDictionary",
    "vaseMeshes",
    "poleMeshes",
    "colMeshes",
    "_singlePassMaterial",
    "_multiPassMaterial",
    "_cascadeLevels",
    "_shadowOptions",
    "_depthMapSize",
    "_lightDirection",
    "Math",
    "PI",
    "_lightElevation",
    "_lights",
    "_numTextures",
    "_currentTexture",
    "_n",
    "_meshes",
    "_move",
    "_drag",
    "_walkIncrement",
    "_strafeIncrement",
    "_walkSpeed",
    "_strafeSpeed",
    "_walkAcceleration",
    "_strafeAcceleration",
    "_time",
    "init",
    "prototype",
    "initEngine",
    "initLights",
    "initListeners",
    "_loadingTextureStrings",
    "countNumTextures",
    "load",
    "_view",
    "camera",
    "y",
    "z",
    "_cameraController",
    "_directionalLight",
    "color",
    "ambient",
    "ambientColor",
    "scene",
    "addChild",
    "push",
    "updateDirection",
    "flameVO",
    "len",
    "light",
    "radius",
    "fallOff",
    "_lightPicker",
    "_baseShadowMethod",
    "_fogMethod",
    "initObjects",
    "_skyMap",
    "_flameGeometry",
    "mesh",
    "getNewObject",
    "material",
    "_flameMaterial",
    "transform",
    "position",
    "subMeshes",
    "uvTransform",
    "scaleU",
    "_this",
    "window",
    "onresize",
    "event",
    "onResize",
    "document",
    "onmousedown",
    "onMouseDown",
    "onmouseup",
    "onMouseUp",
    "onmousemove",
    "onMouseMove",
    "onkeydown",
    "onKeyDown",
    "onkeyup",
    "onKeyUp",
    "parseAWDDelegate",
    "parseAWD",
    "parseBitmapDelegate",
    "parseBitmap",
    "loadProgressDelegate",
    "loadProgress",
    "onBitmapCompleteDelegate",
    "onBitmapComplete",
    "onAssetCompleteDelegate",
    "onAssetComplete",
    "onResourceCompleteDelegate",
    "onResourceComplete",
    "_timer",
    "onEnterFrame",
    "start",
    "direction",
    "sin",
    "cos",
    "url",
    "loader",
    "substring",
    "dataFormat",
    "ARRAY_BUFFER",
    "_loadingText",
    "addEventListener",
    "COMPLETE",
    "BLOB",
    "PROGRESS",
    "urlReq",
    "P",
    "floor",
    "console",
    "log",
    "urlLoader",
    "target",
    "image",
    "blobToImage",
    "data",
    "onload",
    "removeEventListener",
    "bitmapData",
    "ASSET_COMPLETE",
    "RESOURCE_COMPLETE",
    "loadData",
    "asset",
    "assetType",
    "MESH",
    "merge",
    "name",
    "num",
    "Number",
    "colNum",
    "colMerge",
    "colMesh",
    "applyToMeshes",
    "vaseNum",
    "vaseMerge",
    "vaseMesh",
    "poleNum",
    "poleMerge",
    "poleMesh",
    "textureIndex",
    "indexOf",
    "textureName",
    "normalTextureName",
    "specularTextureName",
    "multiMaterial",
    "mode",
    "MULTI_PASS",
    "lightPicker",
    "shadowMethod",
    "addEffectMethod",
    "repeat",
    "mipmap",
    "specular",
    "alphaThreshold",
    "normalMap",
    "specularMap",
    "onExtraResourceComplete",
    "assetLoaderContext",
    "dependencyBaseUrl",
    "assets",
    "blendMode",
    "ADD",
    "animateUVs",
    "dt",
    "abs",
    "incrementWalk",
    "incrementStrafe",
    "random",
    "diffuse",
    "subMesh",
    "offsetU",
    "rotationY",
    "atan2",
    "x",
    "render",
    "keyCode",
    "UP",
    "W",
    "DOWN",
    "S",
    "LEFT",
    "A",
    "RIGHT",
    "D",
    "F",
    "C",
    "fly",
    "_lastPanAngle",
    "panAngle",
    "_lastTiltAngle",
    "tiltAngle",
    "_lastMouseX",
    "clientX",
    "_lastMouseY",
    "clientY",
    "width",
    "innerWidth",
    "height",
    "innerHeight",
    "awayjs-core/lib/base/BlendMode",
    "undefined",
    "awayjs-core/lib/events/AssetEvent",
    "awayjs-core/lib/events/Event",
    "awayjs-core/lib/events/LoaderEvent",
    "awayjs-core/lib/events/ProgressEvent",
    "awayjs-core/lib/geom/UVTransform",
    "awayjs-core/lib/geom/Vector3D",
    "awayjs-core/lib/library/AssetLibrary",
    "awayjs-core/lib/library/AssetLoaderContext",
    "awayjs-core/lib/library/AssetType",
    "awayjs-core/lib/net/URLLoader",
    "awayjs-core/lib/net/URLLoaderDataFormat",
    "awayjs-core/lib/net/URLRequest",
    "awayjs-core/lib/parsers/ParserUtils",
    "awayjs-core/lib/textures/ImageTexture",
    "awayjs-core/lib/textures/SpecularBitmapTexture",
    "awayjs-core/lib/ui/Keyboard",
    "awayjs-core/lib/utils/RequestAnimationFrame",
    "awayjs-display/lib/base/Geometry",
    "awayjs-display/lib/containers/Loader",
    "awayjs-display/lib/containers/View",
    "awayjs-display/lib/controllers/FirstPersonController",
    "awayjs-display/lib/entities/DirectionalLight",
    "awayjs-display/lib/entities/Mesh",
    "awayjs-display/lib/entities/PointLight",
    "awayjs-display/lib/entities/Skybox",
    "awayjs-display/lib/materials/lightpickers/StaticLightPicker",
    "awayjs-display/lib/prefabs/PrimitivePlanePrefab",
    "awayjs-display/lib/utils/Cast",
    "awayjs-methodmaterials/lib/MethodMaterial",
    "awayjs-methodmaterials/lib/MethodMaterialMode",
    "awayjs-methodmaterials/lib/methods/EffectFogMethod",
    "awayjs-methodmaterials/lib/methods/ShadowSoftMethod",
    "awayjs-methodmaterials/lib/pool/MethodRendererPool",
    "awayjs-parsers/lib/AWDParser",
    "awayjs-renderergl/lib/DefaultRenderer",
    "awayjs-renderergl/lib/tools/commands/Merge"
  ],
  "mappings": "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",
  "file": "Advanced_MultiPassSponzaDemo.js",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    "/*\n\nCrytek Sponza demo using multipass materials in Away3D\n\nDemonstrates:\n\nHow to apply Multipass materials to a model\nHow to enable cascading shadow maps on a multipass material.\nHow to setup multiple lightsources, shadows and fog effects all in the same scene.\nHow to apply specular, normal and diffuse maps to an AWD model.\n\nCode by Rob Bateman & David Lenaerts\nrob@infiniteturtles.co.uk\nhttp://www.infiniteturtles.co.uk\ndavid.lenaerts@gmail.com\nhttp://www.derschmale.com\n\nModel re-modeled by Frank Meinl at Crytek with inspiration from Marko Dabrovic's original, converted to AWD by LoTH\ncontact@crytek.com\nhttp://www.crytek.com/cryengine/cryengine3/downloads\n3dflashlo@gmail.com\nhttp://3dflashlo.wordpress.com\n\nThis code is distributed under the MIT License\n\nCopyright (c) The Away Foundation http://www.theawayfoundation.org\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the “Software”), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n\n*/\n\nimport BlendMode\t\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\nimport Event\t\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\nimport AssetEvent\t\t\t\t\t\t= require(\"awayjs-core/lib/events/AssetEvent\");\nimport ProgressEvent\t\t\t\t\t= require(\"awayjs-core/lib/events/ProgressEvent\");\nimport LoaderEvent\t\t\t\t\t\t= require(\"awayjs-core/lib/events/LoaderEvent\");\nimport UVTransform\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/UVTransform\");\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\nimport AssetLibrary\t\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetLibrary\");\nimport AssetLoaderContext\t\t\t\t= require(\"awayjs-core/lib/library/AssetLoaderContext\");\nimport AssetType\t\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\nimport URLLoader\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLLoader\");\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\nimport ImageCubeTexture\t\t\t\t\t= require(\"awayjs-core/lib/textures/ImageCubeTexture\");\nimport ImageTexture\t\t\t\t\t\t= require(\"awayjs-core/lib/textures/ImageTexture\");\nimport SpecularBitmapTexture\t\t\t= require(\"awayjs-core/lib/textures/SpecularBitmapTexture\");\nimport Keyboard\t\t\t\t\t\t\t= require(\"awayjs-core/lib/ui/Keyboard\");\nimport RequestAnimationFrame\t\t\t= require(\"awayjs-core/lib/utils/RequestAnimationFrame\");\n\nimport Loader\t\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/Loader\");\nimport View\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/View\");\nimport FirstPersonController\t\t\t= require(\"awayjs-display/lib/controllers/FirstPersonController\");\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\nimport ISubMesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/ISubMesh\");\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\nimport Skybox\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\nimport DirectionalLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\nimport PointLight\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\n//\timport CascadeShadowMapper\t\t\t\t= require(\"awayjs-display/lib/entities/CascadeShadowMapper\");\nimport DirectionalShadowMapper\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper\");\nimport StaticLightPicker\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/StaticLightPicker\");\nimport PrimitivePlanePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitivePlanePrefab\");\nimport Cast\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/utils/Cast\");\n\nimport Merge\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/tools/commands/Merge\");\nimport DefaultRenderer\t\t\t\t\t= require(\"awayjs-renderergl/lib/DefaultRenderer\");\n\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\nimport MethodRendererPool\t\t\t\t= require(\"awayjs-methodmaterials/lib/pool/MethodRendererPool\");\nimport ShadowCascadeMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowCascadeMethod\");\nimport ShadowSoftMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowSoftMethod\");\nimport EffectFogMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectFogMethod\");\n\nimport AWDParser\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWDParser\");\n\nclass Advanced_MultiPassSponzaDemo\n{\n\t//root filepath for asset loading\n\tprivate _assetsRoot:string = \"assets/\";\n\t\n\t//default material data strings\n\tprivate _materialNameStrings:Array<string> = Array<string>(\"arch\",            \"Material__298\",  \"bricks\",            \"ceiling\",            \"chain\",             \"column_a\",          \"column_b\",          \"column_c\",          \"fabric_g\",              \"fabric_c\",         \"fabric_f\",               \"details\",          \"fabric_d\",             \"fabric_a\",        \"fabric_e\",              \"flagpole\",          \"floor\",            \"16___Default\",\"Material__25\",\"roof\",       \"leaf\",           \"vase\",         \"vase_hanging\",     \"Material__57\",   \"vase_round\");\n\t\n\t//private const diffuseTextureStrings:Array<string> = Array<string>([\"arch_diff.atf\", \"background.atf\", \"bricks_a_diff.atf\", \"ceiling_a_diff.atf\", \"chain_texture.png\", \"column_a_diff.atf\", \"column_b_diff.atf\", \"column_c_diff.atf\", \"curtain_blue_diff.atf\", \"curtain_diff.atf\", \"curtain_green_diff.atf\", \"details_diff.atf\", \"fabric_blue_diff.atf\", \"fabric_diff.atf\", \"fabric_green_diff.atf\", \"flagpole_diff.atf\", \"floor_a_diff.atf\", \"gi_flag.atf\", \"lion.atf\", \"roof_diff.atf\", \"thorn_diff.png\", \"vase_dif.atf\", \"vase_hanging.atf\", \"vase_plant.png\", \"vase_round.atf\"]);\n\t//private const normalTextureStrings:Array<string> = Array<string>([\"arch_ddn.atf\", \"background_ddn.atf\", \"bricks_a_ddn.atf\", null,                \"chain_texture_ddn.atf\", \"column_a_ddn.atf\", \"column_b_ddn.atf\", \"column_c_ddn.atf\", null,                   null,               null,                     null,               null,                   null,              null,                    null,                null,               null,          \"lion2_ddn.atf\", null,       \"thorn_ddn.atf\", \"vase_ddn.atf\",  null,               null,             \"vase_round_ddn.atf\"]);\n\t//private const specularTextureStrings:Array<string> = Array<string>([\"arch_spec.atf\", null,            \"bricks_a_spec.atf\", \"ceiling_a_spec.atf\", null,                \"column_a_spec.atf\", \"column_b_spec.atf\", \"column_c_spec.atf\", \"curtain_spec.atf\",      \"curtain_spec.atf\", \"curtain_spec.atf\",       \"details_spec.atf\", \"fabric_spec.atf\",      \"fabric_spec.atf\", \"fabric_spec.atf\",       \"flagpole_spec.atf\", \"floor_a_spec.atf\", null,          null,       null,            \"thorn_spec.atf\", null,           null,               \"vase_plant_spec.atf\", \"vase_round_spec.atf\"]);\n\t\n\tprivate _diffuseTextureStrings:Array<string> = Array<string>(\"arch_diff.jpg\", \"background.jpg\", \"bricks_a_diff.jpg\", \"ceiling_a_diff.jpg\", \"chain_texture.png\", \"column_a_diff.jpg\", \"column_b_diff.jpg\", \"column_c_diff.jpg\", \"curtain_blue_diff.jpg\", \"curtain_diff.jpg\", \"curtain_green_diff.jpg\", \"details_diff.jpg\", \"fabric_blue_diff.jpg\", \"fabric_diff.jpg\", \"fabric_green_diff.jpg\", \"flagpole_diff.jpg\", \"floor_a_diff.jpg\", \"gi_flag.jpg\", \"lion.jpg\", \"roof_diff.jpg\", \"thorn_diff.png\", \"vase_dif.jpg\", \"vase_hanging.jpg\", \"vase_plant.png\", \"vase_round.jpg\");\n\tprivate _normalTextureStrings:Array<string> = Array<string>(\"arch_ddn.jpg\", \"background_ddn.jpg\", \"bricks_a_ddn.jpg\", null,                \"chain_texture_ddn.jpg\", \"column_a_ddn.jpg\", \"column_b_ddn.jpg\", \"column_c_ddn.jpg\", null,                   null,               null,                     null,               null,                   null,              null,                    null,                null,               null,          \"lion2_ddn.jpg\", null,       \"thorn_ddn.jpg\", \"vase_ddn.jpg\",  null,               null,             \"vase_round_ddn.jpg\");\n\tprivate _specularTextureStrings:Array<string> = Array<string>(\"arch_spec.jpg\", null,            \"bricks_a_spec.jpg\", \"ceiling_a_spec.jpg\", null,                \"column_a_spec.jpg\", \"column_b_spec.jpg\", \"column_c_spec.jpg\", \"curtain_spec.jpg\",      \"curtain_spec.jpg\", \"curtain_spec.jpg\",       \"details_spec.jpg\", \"fabric_spec.jpg\",      \"fabric_spec.jpg\", \"fabric_spec.jpg\",       \"flagpole_spec.jpg\", \"floor_a_spec.jpg\", null,          null,       null,            \"thorn_spec.jpg\", null,           null,               \"vase_plant_spec.jpg\", \"vase_round_spec.jpg\");\n\tprivate _numTexStrings:Array<number /*uint*/> = Array<number /*uint*/>(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0);\n\tprivate _meshReference:Mesh[] = new Array<Mesh>(25);\n\t\n\t//flame data objects\n\tprivate _flameData:Array<FlameVO> = Array<FlameVO>(new FlameVO(new Vector3D(-625, 165, 219), 0xffaa44), new FlameVO(new Vector3D(485, 165, 219), 0xffaa44), new FlameVO(new Vector3D(-625, 165, -148), 0xffaa44), new FlameVO(new Vector3D(485, 165, -148), 0xffaa44));\n\t\n\t//material dictionaries to hold instances\n\tprivate _textureDictionary:Object = new Object();\n\tprivate _multiMaterialDictionary:Object = new Object();\n\tprivate _singleMaterialDictionary:Object = new Object();\n\t\n\t//private meshDictionary:Dictionary = new Dictionary();\n\tprivate vaseMeshes:Array<Mesh> = new Array<Mesh>();\n\tprivate poleMeshes:Array<Mesh> = new Array<Mesh>();\n\tprivate colMeshes:Array<Mesh> = new Array<Mesh>();\n\t\n\t//engien variablesf\n\tprivate _view:View;\n\tprivate _cameraController:FirstPersonController;\n\t\n\t//gui variables\n\tprivate _singlePassMaterial:boolean = false;\n\tprivate _multiPassMaterial:boolean = true;\n\tprivate _cascadeLevels:number /*uint*/ = 3;\n\tprivate _shadowOptions:string = \"PCF\";\n\tprivate _depthMapSize:number /*uint*/ = 2048;\n\tprivate _lightDirection:number = Math.PI/2;\n\tprivate _lightElevation:number = Math.PI/18;\n\t\n\t//light variables\n\tprivate _lightPicker:StaticLightPicker;\n\tprivate _baseShadowMethod:ShadowSoftMethod;\n\tprivate _cascadeMethod:ShadowCascadeMethod;\n\tprivate _fogMethod : EffectFogMethod;\n\tprivate _cascadeShadowMapper:DirectionalShadowMapper;\n\tprivate _directionalLight:DirectionalLight;\n\tprivate _lights:Array<any> = new Array<any>();\n\t\n\t//material variables\n\tprivate _skyMap:ImageCubeTexture;\n\tprivate _flameMaterial:MethodMaterial;\n\tprivate _numTextures:number /*uint*/ = 0;\n\tprivate _currentTexture:number /*uint*/ = 0;\n\tprivate _loadingTextureStrings:Array<string>;\n\tprivate _n:number /*uint*/ = 0;\n\tprivate _loadingText:string;\n\t\n\t//scene variables\n\tprivate _meshes:Array<Mesh> = new Array<Mesh>();\n\tprivate _flameGeometry:PrimitivePlanePrefab;\n\t\t\t\n\t//rotation variables\n\tprivate _move:boolean = false;\n\tprivate _lastPanAngle:number;\n\tprivate _lastTiltAngle:number;\n\tprivate _lastMouseX:number;\n\tprivate _lastMouseY:number;\n\t\n\t//movement variables\n\tprivate _drag:number = 0.5;\n\tprivate _walkIncrement:number = 10;\n\tprivate _strafeIncrement:number = 10;\n\tprivate _walkSpeed:number = 0;\n\tprivate _strafeSpeed:number = 0;\n\tprivate _walkAcceleration:number = 0;\n\tprivate _strafeAcceleration:number = 0;\n\n\tprivate _timer:RequestAnimationFrame;\n\tprivate _time:number = 0;\n\tprivate parseAWDDelegate:(event:Event) => void;\n\tprivate parseBitmapDelegate:(event:Event) => void;\n\tprivate loadProgressDelegate:(event:ProgressEvent) => void;\n\tprivate onBitmapCompleteDelegate:(event) => void;\n\tprivate onAssetCompleteDelegate:(event:AssetEvent) => void;\n\tprivate onResourceCompleteDelegate:(event:LoaderEvent) => void;\n\n\t/**\n\t * Constructor\n\t */\n\tconstructor()\n\t{\n\t\tthis.init();\n\t}\n\t\n\t/**\n\t * Global initialise function\n\t */\n\tprivate init()\n\t{\n\t\tthis.initEngine();\n\t\tthis.initLights();\n\t\tthis.initListeners();\n\t\t\n\t\t\n\t\t//count textures\n\t\tthis._n = 0;\n\t\tthis._loadingTextureStrings = this._diffuseTextureStrings;\n\t\tthis.countNumTextures();\n\t\t\n\t\t//kickoff asset loading\n\t\tthis._n = 0;\n\t\tthis._loadingTextureStrings = this._diffuseTextureStrings;\n\t\tthis.load(this._loadingTextureStrings[this._n]);\n\t}\n\t\n\t/**\n\t * Initialise the engine\n\t */\n\tprivate initEngine()\n\t{\n\t\t//create the view\n\t\tthis._view = new View(new DefaultRenderer(MethodRendererPool));\n\t\tthis._view.camera.y = 150;\n\t\tthis._view.camera.z = 0;\n\t\t\n\t\t//setup controller to be used on the camera\n\t\tthis._cameraController = new FirstPersonController(this._view.camera, 90, 0, -80, 80);\t\t\t\n\t}\n\t\n\t/**\n\t * Initialise the lights\n\t */\n\tprivate initLights()\n\t{\n\t\t//create lights array\n\t\tthis._lights = new Array<any>();\n\t\t\n\t\t//create global directional light\n//\t\t\tthis._cascadeShadowMapper = new CascadeShadowMapper(3);\n//\t\t\tthis._cascadeShadowMapper.lightOffset = 20000;\n\t\tthis._directionalLight = new DirectionalLight(-1, -15, 1);\n//\t\t\tthis._directionalLight.shadowMapper = this._cascadeShadowMapper;\n\t\tthis._directionalLight.color = 0xeedddd;\n\t\tthis._directionalLight.ambient = .35;\n\t\tthis._directionalLight.ambientColor = 0x808090;\n\t\tthis._view.scene.addChild(this._directionalLight);\n\t\tthis._lights.push(this._directionalLight);\n\n\t\tthis.updateDirection();\n\t\t\n\t\t//create flame lights\n\t\tvar flameVO:FlameVO;\n\t\tvar len:number = this._flameData.length;\n\t\tfor (var i:number = 0; i < len; i++) {\n\t\t\tflameVO = this._flameData[i];\n\t\t\tvar light : PointLight = flameVO.light = new PointLight();\n\t\t\tlight.radius = 200;\n\t\t\tlight.fallOff = 600;\n\t\t\tlight.color = flameVO.color;\n\t\t\tlight.y = 10;\n\t\t\tthis._lights.push(light);\n\t\t}\n\t\t\n\t\t//create our global light picker\n\t\tthis._lightPicker = new StaticLightPicker(this._lights);\n\t\tthis._baseShadowMethod = new ShadowSoftMethod(this._directionalLight , 10 , 5 );\n//\t\t\tthis._baseShadowMethod = new ShadowFilteredMethod(this._directionalLight);\n\t\t\n\t\t//create our global fog method\n\t\tthis._fogMethod = new EffectFogMethod(0, 4000, 0x9090e7);\n//\t\t\tthis._cascadeMethod = new ShadowCascadeMethod(this._baseShadowMethod);\n\t}\n\t\t\t\n\t/**\n\t * Initialise the scene objects\n\t */\n\tprivate initObjects()\n\t{\n\t\t//create skybox\n\t\tthis._view.scene.addChild(new Skybox(this._skyMap));\n\t\t\n\t\t//create flame meshes\n\t\tthis._flameGeometry = new PrimitivePlanePrefab(40, 80, 1, 1, false, true);\n\t\tvar flameVO:FlameVO;\n\t\tvar len:number = this._flameData.length;\n\t\tfor (var i:number = 0; i < len; i++) {\n\t\t\tflameVO = this._flameData[i];\n\t\t\tvar mesh:Mesh = flameVO.mesh = <Mesh> this._flameGeometry.getNewObject();\n\t\t\tmesh.material = this._flameMaterial;\n\t\t\tmesh.transform.position = flameVO.position;\n\t\t\tmesh.subMeshes[0].uvTransform = new UVTransform()\n\t\t\tmesh.subMeshes[0].uvTransform.scaleU = 1/16;\n\t\t\tthis._view.scene.addChild(mesh);\n\t\t\tmesh.addChild(flameVO.light);\n\t\t}\n\t}\n\t\t\n\t/**\n\t * Initialise the listeners\n\t */\n\tprivate initListeners()\n\t{\n\t\t//add listeners\n\t\twindow.onresize  = (event) => this.onResize(event);\n\n\t\tdocument.onmousedown = (event) => this.onMouseDown(event);\n\t\tdocument.onmouseup = (event) => this.onMouseUp(event);\n\t\tdocument.onmousemove = (event) => this.onMouseMove(event);\n\t\tdocument.onkeydown = (event) => this.onKeyDown(event);\n\t\tdocument.onkeyup = (event) => this.onKeyUp(event);\n\n\t\tthis.onResize();\n\n\t\tthis.parseAWDDelegate = (event:Event) => this.parseAWD(event);\n\t\tthis.parseBitmapDelegate = (event) => this.parseBitmap(event);\n\t\tthis.loadProgressDelegate = (event:ProgressEvent) => this.loadProgress(event);\n\t\tthis.onBitmapCompleteDelegate = (event) => this.onBitmapComplete(event);\n\t\tthis.onAssetCompleteDelegate = (event:AssetEvent) => this.onAssetComplete(event);\n\t\tthis.onResourceCompleteDelegate = (event:LoaderEvent) => this.onResourceComplete(event);\n\n\t\tthis._timer = new RequestAnimationFrame(this.onEnterFrame, this);\n\t\tthis._timer.start();\n\t}\n\t\n\t/**\n\t * Updates the material mode between single pass and multi pass\n\t */\n//\t\tprivate updateMaterialPass(materialDictionary:Dictionary)\n//\t\t{\n//\t\t\tvar mesh:Mesh;\n//\t\t\tvar name:string;\n//\t\t\tvar len:number = this._meshes.length;\n//\t\t\tfor (var i:number = 0; i < len; i++) {\n//\t\t\t\tmesh = this._meshes[i];\n//\t\t\t\tif (mesh.name == \"sponza_04\" || mesh.name == \"sponza_379\")\n//\t\t\t\t\tcontinue;\n//\t\t\t\tname = mesh.material.name;\n//\t\t\t\tvar textureIndex:number = this._materialNameStrings.indexOf(name);\n//\t\t\t\tif (textureIndex == -1 || textureIndex >= this._materialNameStrings.length)\n//\t\t\t\t\tcontinue;\n//\n//\t\t\t\tmesh.material = materialDictionary[name];\n//\t\t\t}\n//\t\t}\n\t\n\t/**\n\t * Updates the direction of the directional lightsource\n\t */\n\tprivate updateDirection()\n\t{\n\t\tthis._directionalLight.direction = new Vector3D(\n\t\t\tMath.sin(this._lightElevation)*Math.cos(this._lightDirection),\n\t\t\t-Math.cos(this._lightElevation),\n\t\t\tMath.sin(this._lightElevation)*Math.sin(this._lightDirection)\n\t\t);\n\t}\n\t\n\t/**\n\t * Count the total number of textures to be loaded\n\t */\n\tprivate countNumTextures()\n\t{\n\t\tthis._numTextures++;\n\t\t\n\t\t//skip null textures\n\t\twhile (this._n++ < this._loadingTextureStrings.length - 1)\n\t\t\tif (this._loadingTextureStrings[this._n])\n\t\t\t\tbreak;\n\t\t\n\t\t//switch to next teture set\n\t\tif (this._n < this._loadingTextureStrings.length) {\n\t\t\tthis.countNumTextures();\n\t\t} else if (this._loadingTextureStrings == this._diffuseTextureStrings) {\n\t\t\tthis._n = 0;\n\t\t\tthis._loadingTextureStrings = this._normalTextureStrings;\n\t\t\tthis.countNumTextures();\n\t\t} else if (this._loadingTextureStrings == this._normalTextureStrings) {\n\t\t\tthis._n = 0;\n\t\t\tthis._loadingTextureStrings = this._specularTextureStrings;\n\t\t\tthis.countNumTextures();\n\t\t}\n\t}\n\t\n\t/**\n\t * Global binary file loader\n\t */\n\tprivate load(url:string)\n\t{\n\t\tvar loader:URLLoader = new URLLoader();\n\t\tswitch (url.substring(url.length - 3)) {\n\t\t\tcase \"AWD\": \n\t\t\tcase \"awd\":\n\t\t\t\tloader.dataFormat = URLLoaderDataFormat.ARRAY_BUFFER;\n\t\t\t\tthis._loadingText = \"Loading Model\";\n\t\t\t\tloader.addEventListener(Event.COMPLETE, this.parseAWDDelegate);\n\t\t\t\tbreak;\n\t\t\tcase \"png\": \n\t\t\tcase \"jpg\":\n\t\t\t\tloader.dataFormat = URLLoaderDataFormat.BLOB;\n\t\t\t\tthis._currentTexture++;\n\t\t\t\tthis._loadingText = \"Loading Textures\";\n\t\t\t\tloader.addEventListener(Event.COMPLETE, this.parseBitmapDelegate);\n\t\t\t\turl = \"sponza/\" + url;\n\t\t\t\tbreak;\n//\t\t\t\tcase \"atf\":\n//\t\t\t\t\tthis._currentTexture++;\n//\t\t\t\t\tthis._loadingText = \"Loading Textures\";\n//                    loader.addEventListener(Event.COMPLETE, (event:Event) => this.onATFComplete(event));\n//\t\t\t\t\turl = \"sponza/atf/\" + url;\n//                    break;\n\t\t}\n\t\t\n\t\tloader.addEventListener(ProgressEvent.PROGRESS, this.loadProgressDelegate);\n\t\tvar urlReq:URLRequest = new URLRequest(this._assetsRoot+url);\n\t\tloader.load(urlReq);\n\t\t\n\t}\n\t\n\t/**\n\t * Display current load\n\t */\n\tprivate loadProgress(e:ProgressEvent)\n\t{\n\t\t//TODO work out why the casting on ProgressEvent fails for bytesLoaded and bytesTotal properties\n\t\tvar P:number = Math.floor(e[\"bytesLoaded\"] / e[\"bytesTotal\"] * 100);\n\t\tif (P != 100) {\n\t\t\tconsole.log(this._loadingText + '\\n' + ((this._loadingText == \"Loading Model\")? Math.floor((e[\"bytesLoaded\"] / 1024) << 0) + 'kb | ' + Math.floor((e[\"bytesTotal\"] / 1024) << 0) + 'kb' : this._currentTexture + ' | ' + this._numTextures));\n\t\t}\n\t}\n\t\n\t/**\n\t * Parses the ATF file\n\t */\n//\t\tprivate onATFComplete(e:Event)\n//\t\t{\n//            var loader:URLLoader = URLLoader(e.target);\n//            loader.removeEventListener(Event.COMPLETE, this.onATFComplete);\n//\n//\t\t\tif (!this._textureDictionary[this._loadingTextureStrings[this._n]])\n//\t\t\t{\n//\t\t\t\tthis._textureDictionary[this._loadingTextureStrings[this._n]] = new ATFTexture(loader.data);\n//\t\t\t}\n//\n//            loader.data = null;\n//            loader.close();\n//\t\t\tloader = null;\n//\n//\n//\t\t\t//skip null textures\n//\t\t\twhile (this._n++ < this._loadingTextureStrings.length - 1)\n//\t\t\t\tif (this._loadingTextureStrings[this._n])\n//\t\t\t\t\tbreak;\n//\n//\t\t\t//switch to next teture set\n//            if (this._n < this._loadingTextureStrings.length) {\n//\t\t\t\tthis.load(this._loadingTextureStrings[this._n]);\n//\t\t\t} else if (this._loadingTextureStrings == this._diffuseTextureStrings) {\n//\t\t\t\tthis._n = 0;\n//\t\t\t\tthis._loadingTextureStrings = this._normalTextureStrings;\n//\t\t\t\tthis.load(this._loadingTextureStrings[this._n]);\n//\t\t\t} else if (this._loadingTextureStrings == this._normalTextureStrings) {\n//\t\t\t\tthis._n = 0;\n//\t\t\t\tthis._loadingTextureStrings = this._specularTextureStrings;\n//\t\t\t\tthis.load(this._loadingTextureStrings[this._n]);\n//\t\t\t} else {\n//\t\t\t\tthis.load(\"sponza/sponza.awd\");\n//            }\n//        }\n\t\n\t\n\t/**\n\t * Parses the Bitmap file\n\t */\n\tprivate parseBitmap(e)\n\t{\n\t\tvar urlLoader:URLLoader = <URLLoader> e.target;\n\t\tvar image:HTMLImageElement = ParserUtils.blobToImage(urlLoader.data);\n\t\timage.onload = this.onBitmapCompleteDelegate;\n\t\turlLoader.removeEventListener(Event.COMPLETE, this.parseBitmapDelegate);\n\t\turlLoader.removeEventListener(ProgressEvent.PROGRESS, this.loadProgressDelegate);\n\t\turlLoader = null;\n\t}\n\t\n\t/**\n\t * Listener for bitmap complete event on loader\n\t */\n\tprivate onBitmapComplete(e:Event)\n\t{\n\t\tvar image:HTMLImageElement = <HTMLImageElement> e.target;\n\t\timage.onload = null;\n\n\t\t//create bitmap texture in dictionary\n\t\tif (!this._textureDictionary[this._loadingTextureStrings[this._n]])\n\t\t\tthis._textureDictionary[this._loadingTextureStrings[this._n]] = (this._loadingTextureStrings == this._specularTextureStrings)? new SpecularBitmapTexture(Cast.bitmapData(image)) : new ImageTexture(image);\n\n\t\t//skip null textures\n\t\twhile (this._n++ < this._loadingTextureStrings.length - 1)\n\t\t\tif (this._loadingTextureStrings[this._n])\n\t\t\t\tbreak;\n\t\t\n\t\t//switch to next teture set\n\t\tif (this._n < this._loadingTextureStrings.length) {\n\t\t\tthis.load(this._loadingTextureStrings[this._n]);\n\t\t} else if (this._loadingTextureStrings == this._diffuseTextureStrings) {\n\t\t\tthis._n = 0;\n\t\t\tthis._loadingTextureStrings = this._normalTextureStrings;\n\t\t\tthis.load(this._loadingTextureStrings[this._n]);\n\t\t} else if (this._loadingTextureStrings == this._normalTextureStrings) {\n\t\t\tthis._n = 0;\n\t\t\tthis._loadingTextureStrings = this._specularTextureStrings;\n\t\t\tthis.load(this._loadingTextureStrings[this._n]);\n\t\t} else {\n\t\t\tthis.load(\"sponza/sponza.awd\");\n\t\t}\n\t}\n\t\n\t/**\n\t * Parses the AWD file\n\t */\n\tprivate parseAWD(e)\n\t{\n\t\tconsole.log(\"Parsing Data\");\n\t\tvar urlLoader:URLLoader = <URLLoader> e.target;\n\t\tvar loader:Loader = new Loader(false);\n\n\t\tloader.addEventListener(AssetEvent.ASSET_COMPLETE, this.onAssetCompleteDelegate);\n\t\tloader.addEventListener(LoaderEvent.RESOURCE_COMPLETE, this.onResourceCompleteDelegate);\n\t\tloader.loadData(urlLoader.data, new AssetLoaderContext(false), null, new AWDParser());\n\n\t\turlLoader.removeEventListener(ProgressEvent.PROGRESS, this.loadProgressDelegate);\n\t\turlLoader.removeEventListener(Event.COMPLETE, this.parseAWDDelegate);\n\t\turlLoader = null;\n\t}\n\t\n\t/**\n\t * Listener for asset complete event on loader\n\t */\n\tprivate onAssetComplete(event:AssetEvent)\n\t{\n\t\tif (event.asset.assetType == AssetType.MESH) {\n\t\t\t//store meshes\n\t\t\tthis._meshes.push(<Mesh> event.asset);\n\t\t}\n\t}\n\t\n\t/**\n\t * Triggered once all resources are loaded\n\t */\n\tprivate onResourceComplete(e:LoaderEvent)\n\t{\n\t\tvar merge:Merge = new Merge(false, false, true);\n\n\t\tvar loader:Loader = <Loader> e.target;\n\t\tloader.removeEventListener(AssetEvent.ASSET_COMPLETE, this.onAssetCompleteDelegate);\n\t\tloader.removeEventListener(LoaderEvent.RESOURCE_COMPLETE, this.onResourceCompleteDelegate);\n\t\t\n\t\t//reassign materials\n\t\tvar mesh:Mesh;\n\t\tvar name:string;\n\n\t\tvar len:number = this._meshes.length;\n\t\tfor (var i:number = 0; i < len; i++) {\n\t\t\tmesh = this._meshes[i];\n\t\t\tif (mesh.name == \"sponza_04\" || mesh.name == \"sponza_379\")\n\t\t\t\tcontinue;\n\n\t\t\tvar num:number = Number(mesh.name.substring(7));\n\n\t\t\tname = mesh.material.name;\n\n\t\t\tif (name == \"column_c\" && (num < 22 || num > 33))\n\t\t\t\tcontinue;\n\n\t\t\tvar colNum:number = (num - 125);\n\t\t\tif (name == \"column_b\") {\n\t\t\t\tif (colNum  >=0 && colNum < 132 && (colNum % 11) < 10) {\n\t\t\t\t\tthis.colMeshes.push(mesh);\n\t\t\t\t\tcontinue;\n\t\t\t\t} else {\n\t\t\t\t\tthis.colMeshes.push(mesh);\n\t\t\t\t\tvar colMerge:Merge = new Merge();\n\t\t\t\t\tvar colMesh:Mesh = new Mesh(new Geometry());\n\t\t\t\t\tcolMerge.applyToMeshes(colMesh, this.colMeshes);\n\t\t\t\t\tmesh = colMesh;\n\t\t\t\t\tthis.colMeshes = new Array<Mesh>();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar vaseNum:number = (num - 334);\n\t\t\tif (name == \"vase_hanging\" && (vaseNum % 9) < 5) {\n\t\t\t\tif (vaseNum  >=0 && vaseNum < 370 && (vaseNum % 9) < 4) {\n\t\t\t\t\tthis.vaseMeshes.push(mesh);\n\t\t\t\t\tcontinue;\n\t\t\t\t} else {\n\t\t\t\t\tthis.vaseMeshes.push(mesh);\n\t\t\t\t\tvar vaseMerge:Merge = new Merge();\n\t\t\t\t\tvar vaseMesh:Mesh = new Mesh(new Geometry());\n\t\t\t\t\tvaseMerge.applyToMeshes(vaseMesh, this.vaseMeshes);\n\t\t\t\t\tmesh = vaseMesh;\n\t\t\t\t\tthis.vaseMeshes = new Array<Mesh>();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar poleNum:number = num - 290;\n\t\t\tif (name == \"flagpole\") {\n\t\t\t\tif (poleNum >=0 && poleNum < 320 && (poleNum % 3) < 2) {\n\t\t\t\t\tthis.poleMeshes.push(mesh);\n\t\t\t\t\tcontinue;\n\t\t\t\t} else if (poleNum >=0) {\n\t\t\t\t\tthis.poleMeshes.push(mesh);\n\t\t\t\t\tvar poleMerge:Merge = new Merge();\n\t\t\t\t\tvar poleMesh:Mesh = new Mesh(new Geometry());\n\t\t\t\t\tpoleMerge.applyToMeshes(poleMesh, this.poleMeshes);\n\t\t\t\t\tmesh = poleMesh;\n\t\t\t\t\tthis.poleMeshes = new Array<Mesh>();\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (name == \"flagpole\" && (num == 260 || num == 261 || num == 263 || num == 265 || num == 268 || num == 269 || num == 271 || num == 273))\n\t\t\t\tcontinue;\n\t\t\t\n\t\t\tvar textureIndex:number = this._materialNameStrings.indexOf(name);\n\t\t\tif (textureIndex == -1 || textureIndex >= this._materialNameStrings.length)\n\t\t\t\tcontinue;\n\n\t\t\tthis._numTexStrings[textureIndex]++;\n\t\t\t\n\t\t\tvar textureName:string = this._diffuseTextureStrings[textureIndex];\n\t\t\tvar normalTextureName:string;\n\t\t\tvar specularTextureName:string;\n\t\t\t\n//\t\t\t\t//store single pass materials for use later\n//\t\t\t\tvar singleMaterial:MethodMaterial = this._singleMaterialDictionary[name];\n//\n//\t\t\t\tif (!singleMaterial) {\n//\n//\t\t\t\t\t//create singlepass material\n//\t\t\t\t\tsingleMaterial = new MethodMaterial(this._textureDictionary[textureName]);\n//\n//\t\t\t\t\tsingleMaterial.name = name;\n//\t\t\t\t\tsingleMaterial.lightPicker = this._lightPicker;\n//\t\t\t\t\tsingleMaterial.addMethod(this._fogMethod);\n//\t\t\t\t\tsingleMaterial.mipmap = true;\n//\t\t\t\t\tsingleMaterial.repeat = true;\n//\t\t\t\t\tsingleMaterial.specular = 2;\n//\n//\t\t\t\t\t//use alpha transparancy if texture is png\n//\t\t\t\t\tif (textureName.substring(textureName.length - 3) == \"png\")\n//\t\t\t\t\t\tsingleMaterial.alphaThreshold = 0.5;\n//\n//\t\t\t\t\t//add normal map if it exists\n//\t\t\t\t\tnormalTextureName = this._normalTextureStrings[textureIndex];\n//\t\t\t\t\tif (normalTextureName)\n//\t\t\t\t\t\tsingleMaterial.normalMap = this._textureDictionary[normalTextureName];\n//\n//\t\t\t\t\t//add specular map if it exists\n//\t\t\t\t\tspecularTextureName = this._specularTextureStrings[textureIndex];\n//\t\t\t\t\tif (specularTextureName)\n//\t\t\t\t\t\tsingleMaterial.specularMap = this._textureDictionary[specularTextureName];\n//\n//\t\t\t\t\tthis._singleMaterialDictionary[name] = singleMaterial;\n//\n//\t\t\t\t}\n\n\t\t\t//store multi pass materials for use later\n\t\t\tvar multiMaterial:MethodMaterial = this._multiMaterialDictionary[name];\n\n\t\t\tif (!multiMaterial) {\n\t\t\t\t\n\t\t\t\t//create multipass material\n\t\t\t\tmultiMaterial = new MethodMaterial(this._textureDictionary[textureName]);\n\t\t\t\tmultiMaterial.mode = MethodMaterialMode.MULTI_PASS;\n\t\t\t\tmultiMaterial.name = name;\n\t\t\t\tmultiMaterial.lightPicker = this._lightPicker;\n//\t\t\t\t\tmultiMaterial.shadowMethod = this._cascadeMethod;\n\t\t\t\tmultiMaterial.shadowMethod = this._baseShadowMethod;\n\t\t\t\tmultiMaterial.addEffectMethod(this._fogMethod);\n\t\t\t\tmultiMaterial.repeat = true;\n\t\t\t\tmultiMaterial.mipmap = true;\n\t\t\t\tmultiMaterial.specular = 2;\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t//use alpha transparancy if texture is png\n\t\t\t\tif (textureName.substring(textureName.length - 3) == \"png\")\n\t\t\t\t\tmultiMaterial.alphaThreshold = 0.5;\n\t\t\t\t\n\t\t\t\t//add normal map if it exists\n\t\t\t\tnormalTextureName = this._normalTextureStrings[textureIndex];\n\t\t\t\tif (normalTextureName)\n\t\t\t\t\tmultiMaterial.normalMap = this._textureDictionary[normalTextureName];\n\n\t\t\t\t//add specular map if it exists\n\t\t\t\tspecularTextureName = this._specularTextureStrings[textureIndex];\n\t\t\t\tif (specularTextureName)\n\t\t\t\t\tmultiMaterial.specularMap = this._textureDictionary[specularTextureName];\n\n\t\t\t\t//add to material dictionary\n\t\t\t\tthis._multiMaterialDictionary[name] = multiMaterial;\n\t\t\t}\n\t\t\t/*\n\t\t\tif (_meshReference[textureIndex]) {\n\t\t\t\tvar m:Mesh = mesh.clone() as Mesh;\n\t\t\t\tm.material = multiMaterial;\n\t\t\t\t_view.scene.addChild(m);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t*/\n\t\t\t//default to multipass material\n\t\t\tmesh.material = multiMaterial;\n\n\t\t\tthis._view.scene.addChild(mesh);\n\n\t\t\tthis._meshReference[textureIndex] = mesh;\n\t\t}\n\t\t\n\t\tvar z:number /*uint*/ = 0;\n\t\t\n\t\twhile (z < this._numTexStrings.length)\n\t\t{\n\t\t\tconsole.log(this._diffuseTextureStrings[z], this._numTexStrings[z]);\n\t\t\tz++;\n\t\t}\n\n\t\t//load skybox and flame texture\n\n\t\tAssetLibrary.addEventListener(LoaderEvent.RESOURCE_COMPLETE, (event:LoaderEvent) => this.onExtraResourceComplete(event));\n\n\t\t//setup the url map for textures in the cubemap file\n\t\tvar assetLoaderContext:AssetLoaderContext = new AssetLoaderContext();\n\t\tassetLoaderContext.dependencyBaseUrl = \"assets/skybox/\";\n\n\t\t//environment texture\n\t\tAssetLibrary.load(new URLRequest(\"assets/skybox/hourglass_texture.cube\"), assetLoaderContext);\n\n\t\t//globe textures\n\t\tAssetLibrary.load(new URLRequest(\"assets/fire.png\"));\n\t}\n\n\t/**\n\t * Triggered once extra resources are loaded\n\t */\n\tprivate onExtraResourceComplete(event:LoaderEvent)\n\t{\n\t\tswitch( event.url )\n\t\t{\n\t\t\tcase 'assets/skybox/hourglass_texture.cube':\n\t\t\t\t//create skybox texture map\n\t\t\t\tthis._skyMap = <ImageCubeTexture> event.assets[ 0 ];\n\t\t\t\tbreak;\n\t\t\tcase \"assets/fire.png\" :\n\t\t\t\tthis._flameMaterial = new MethodMaterial(<ImageTexture> event.assets[ 0 ]);\n\t\t\t\tthis._flameMaterial.blendMode = BlendMode.ADD;\n\t\t\t\tthis._flameMaterial.animateUVs = true;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (this._skyMap && this._flameMaterial)\n\t\t\tthis.initObjects();\n\t}\n\n\n\t/**\n\t * Navigation and render loop\n\t */\n\tprivate onEnterFrame(dt:number)\n\t{\t\n\t\tif (this._walkSpeed || this._walkAcceleration) {\n\t\t\tthis._walkSpeed = (this._walkSpeed + this._walkAcceleration)*this._drag;\n\t\t\tif (Math.abs(this._walkSpeed) < 0.01)\n\t\t\t\tthis._walkSpeed = 0;\n\t\t\tthis._cameraController.incrementWalk(this._walkSpeed);\n\t\t}\n\t\t\n\t\tif (this._strafeSpeed || this._strafeAcceleration) {\n\t\t\tthis._strafeSpeed = (this._strafeSpeed + this._strafeAcceleration)*this._drag;\n\t\t\tif (Math.abs(this._strafeSpeed) < 0.01)\n\t\t\t\tthis._strafeSpeed = 0;\n\t\t\tthis._cameraController.incrementStrafe(this._strafeSpeed);\n\t\t}\n\t\t\n\t\t//animate flames\n\t\tvar flameVO:FlameVO;\n\t\tvar len:number = this._flameData.length;\n\t\tfor (var i:number = 0; i < len; i++) {\n\t\t\tflameVO = this._flameData[i];\n\t\t\t//update flame light\n\t\t\tvar light : PointLight = flameVO.light;\n\t\t\t\n\t\t\tif (!light)\n\t\t\t\tcontinue;\n\t\t\t\n\t\t\tlight.fallOff = 380+Math.random()*20;\n\t\t\tlight.radius = 200+Math.random()*30;\n\t\t\tlight.diffuse = .9+Math.random()*.1;\n\t\t\t\n\t\t\t//update flame mesh\n\t\t\tvar mesh : Mesh = flameVO.mesh;\n\t\t\t\n\t\t\tif (!mesh)\n\t\t\t\tcontinue;\n\t\t\t\n\t\t\tvar subMesh:ISubMesh = mesh.subMeshes[0];\n\t\t\tsubMesh.uvTransform.offsetU += 1/16;\n\t\t\tsubMesh.uvTransform.offsetU %= 1;\n\t\t\tmesh.rotationY = Math.atan2(mesh.x - this._view.camera.x, mesh.z - this._view.camera.z)*180/Math.PI;\n\t\t}\n\n\t\tthis._view.render();\n\t\t\n\t}\n\t\n\t\t\t\n\t/**\n\t * Key down listener for camera control\n\t */\n\tprivate onKeyDown(event:KeyboardEvent)\n\t{\n\t\tswitch (event.keyCode) {\n\t\t\tcase Keyboard.UP:\n\t\t\tcase Keyboard.W:\n\t\t\t\tthis._walkAcceleration = this._walkIncrement;\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.DOWN:\n\t\t\tcase Keyboard.S:\n\t\t\t\tthis._walkAcceleration = -this._walkIncrement;\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.LEFT:\n\t\t\tcase Keyboard.A:\n\t\t\t\tthis._strafeAcceleration = -this._strafeIncrement;\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.RIGHT:\n\t\t\tcase Keyboard.D:\n\t\t\t\tthis._strafeAcceleration = this._strafeIncrement;\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.F:\n\t\t\t\t//stage.displayState = StageDisplayState.FULL_SCREEN;\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.C:\n\t\t\t\tthis._cameraController.fly = !this._cameraController.fly;\n\t\t}\n\t}\n\t\n\t/**\n\t * Key up listener for camera control\n\t */\n\tprivate onKeyUp(event:KeyboardEvent)\n\t{\n\t\tswitch (event.keyCode) {\n\t\t\tcase Keyboard.UP:\n\t\t\tcase Keyboard.W:\n\t\t\tcase Keyboard.DOWN:\n\t\t\tcase Keyboard.S:\n\t\t\t\tthis._walkAcceleration = 0;\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.LEFT:\n\t\t\tcase Keyboard.A:\n\t\t\tcase Keyboard.RIGHT:\n\t\t\tcase Keyboard.D:\n\t\t\t\tthis._strafeAcceleration = 0;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Mouse down listener for navigation\n\t */\n\tprivate onMouseDown(event)\n\t{\n\t\tthis._lastPanAngle = this._cameraController.panAngle;\n\t\tthis._lastTiltAngle = this._cameraController.tiltAngle;\n\t\tthis._lastMouseX = event.clientX;\n\t\tthis._lastMouseY = event.clientY;\n\t\tthis._move = true;\n\t}\n\n\t/**\n\t * Mouse up listener for navigation\n\t */\n\tprivate onMouseUp(event)\n\t{\n\t\tthis._move = false;\n\t}\n\n\tprivate onMouseMove(event)\n\t{\n\t\tif (this._move) {\n\t\t\tthis._cameraController.panAngle = 0.3*(event.clientX - this._lastMouseX) + this._lastPanAngle;\n\t\t\tthis._cameraController.tiltAngle = 0.3*(event.clientY - this._lastMouseY) + this._lastTiltAngle;\n\t\t}\n\t}\n\n\t/**\n\t * stage listener for resize events\n\t */\n\tprivate onResize(event = null)\n\t{\n\t\tthis._view.y         = 0;\n\t\tthis._view.x         = 0;\n\t\tthis._view.width     = window.innerWidth;\n\t\tthis._view.height    = window.innerHeight;\n\t}\n}\n\n/**\n* Data class for the Flame objects\n*/\nclass FlameVO\n{\n\tpublic position:Vector3D;\n\tpublic color:number /*uint*/;\n\tpublic mesh:Mesh;\n\tpublic light:PointLight;\n\n\tconstructor(position:Vector3D, color:number /*uint*/)\n\t{\n\t\tthis.position = position;\n\t\tthis.color = color;\n\t}\n}\n\nwindow.onload = function ()\n{\n\tnew Advanced_MultiPassSponzaDemo();\n}",
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/*\r\n\r\nCrytek Sponza demo using multipass materials in Away3D\r\n\r\nDemonstrates:\r\n\r\nHow to apply Multipass materials to a model\r\nHow to enable cascading shadow maps on a multipass material.\r\nHow to setup multiple lightsources, shadows and fog effects all in the same scene.\r\nHow to apply specular, normal and diffuse maps to an AWD model.\r\n\r\nCode by Rob Bateman & David Lenaerts\r\nrob@infiniteturtles.co.uk\r\nhttp://www.infiniteturtles.co.uk\r\ndavid.lenaerts@gmail.com\r\nhttp://www.derschmale.com\r\n\r\nModel re-modeled by Frank Meinl at Crytek with inspiration from Marko Dabrovic's original, converted to AWD by LoTH\r\ncontact@crytek.com\r\nhttp://www.crytek.com/cryengine/cryengine3/downloads\r\n3dflashlo@gmail.com\r\nhttp://3dflashlo.wordpress.com\r\n\r\nThis code is distributed under the MIT License\r\n\r\nCopyright (c) The Away Foundation http://www.theawayfoundation.org\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the “Software”), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n\r\n*/\r\nvar BlendMode = require(\"awayjs-core/lib/base/BlendMode\");\r\nvar Event = require(\"awayjs-core/lib/events/Event\");\r\nvar AssetEvent = require(\"awayjs-core/lib/events/AssetEvent\");\r\nvar ProgressEvent = require(\"awayjs-core/lib/events/ProgressEvent\");\r\nvar LoaderEvent = require(\"awayjs-core/lib/events/LoaderEvent\");\r\nvar UVTransform = require(\"awayjs-core/lib/geom/UVTransform\");\r\nvar Vector3D = require(\"awayjs-core/lib/geom/Vector3D\");\r\nvar AssetLibrary = require(\"awayjs-core/lib/library/AssetLibrary\");\r\nvar AssetLoaderContext = require(\"awayjs-core/lib/library/AssetLoaderContext\");\r\nvar AssetType = require(\"awayjs-core/lib/library/AssetType\");\r\nvar URLLoader = require(\"awayjs-core/lib/net/URLLoader\");\r\nvar URLLoaderDataFormat = require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nvar URLRequest = require(\"awayjs-core/lib/net/URLRequest\");\r\nvar ParserUtils = require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nvar ImageTexture = require(\"awayjs-core/lib/textures/ImageTexture\");\r\nvar SpecularBitmapTexture = require(\"awayjs-core/lib/textures/SpecularBitmapTexture\");\r\nvar Keyboard = require(\"awayjs-core/lib/ui/Keyboard\");\r\nvar RequestAnimationFrame = require(\"awayjs-core/lib/utils/RequestAnimationFrame\");\r\nvar Loader = require(\"awayjs-display/lib/containers/Loader\");\r\nvar View = require(\"awayjs-display/lib/containers/View\");\r\nvar FirstPersonController = require(\"awayjs-display/lib/controllers/FirstPersonController\");\r\nvar Geometry = require(\"awayjs-display/lib/base/Geometry\");\r\nvar Mesh = require(\"awayjs-display/lib/entities/Mesh\");\r\nvar Skybox = require(\"awayjs-display/lib/entities/Skybox\");\r\nvar DirectionalLight = require(\"awayjs-display/lib/entities/DirectionalLight\");\r\nvar PointLight = require(\"awayjs-display/lib/entities/PointLight\");\r\nvar StaticLightPicker = require(\"awayjs-display/lib/materials/lightpickers/StaticLightPicker\");\r\nvar PrimitivePlanePrefab = require(\"awayjs-display/lib/prefabs/PrimitivePlanePrefab\");\r\nvar Cast = require(\"awayjs-display/lib/utils/Cast\");\r\nvar Merge = require(\"awayjs-renderergl/lib/tools/commands/Merge\");\r\nvar DefaultRenderer = require(\"awayjs-renderergl/lib/DefaultRenderer\");\r\nvar MethodMaterial = require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\nvar MethodMaterialMode = require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\r\nvar MethodRendererPool = require(\"awayjs-methodmaterials/lib/pool/MethodRendererPool\");\r\nvar ShadowSoftMethod = require(\"awayjs-methodmaterials/lib/methods/ShadowSoftMethod\");\r\nvar EffectFogMethod = require(\"awayjs-methodmaterials/lib/methods/EffectFogMethod\");\r\nvar AWDParser = require(\"awayjs-parsers/lib/AWDParser\");\r\nvar Advanced_MultiPassSponzaDemo = (function () {\r\n    /**\r\n     * Constructor\r\n     */\r\n    function Advanced_MultiPassSponzaDemo() {\r\n        //root filepath for asset loading\r\n        this._assetsRoot = \"assets/\";\r\n        //default material data strings\r\n        this._materialNameStrings = Array(\"arch\", \"Material__298\", \"bricks\", \"ceiling\", \"chain\", \"column_a\", \"column_b\", \"column_c\", \"fabric_g\", \"fabric_c\", \"fabric_f\", \"details\", \"fabric_d\", \"fabric_a\", \"fabric_e\", \"flagpole\", \"floor\", \"16___Default\", \"Material__25\", \"roof\", \"leaf\", \"vase\", \"vase_hanging\", \"Material__57\", \"vase_round\");\r\n        //private const diffuseTextureStrings:Array<string> = Array<string>([\"arch_diff.atf\", \"background.atf\", \"bricks_a_diff.atf\", \"ceiling_a_diff.atf\", \"chain_texture.png\", \"column_a_diff.atf\", \"column_b_diff.atf\", \"column_c_diff.atf\", \"curtain_blue_diff.atf\", \"curtain_diff.atf\", \"curtain_green_diff.atf\", \"details_diff.atf\", \"fabric_blue_diff.atf\", \"fabric_diff.atf\", \"fabric_green_diff.atf\", \"flagpole_diff.atf\", \"floor_a_diff.atf\", \"gi_flag.atf\", \"lion.atf\", \"roof_diff.atf\", \"thorn_diff.png\", \"vase_dif.atf\", \"vase_hanging.atf\", \"vase_plant.png\", \"vase_round.atf\"]);\r\n        //private const normalTextureStrings:Array<string> = Array<string>([\"arch_ddn.atf\", \"background_ddn.atf\", \"bricks_a_ddn.atf\", null,                \"chain_texture_ddn.atf\", \"column_a_ddn.atf\", \"column_b_ddn.atf\", \"column_c_ddn.atf\", null,                   null,               null,                     null,               null,                   null,              null,                    null,                null,               null,          \"lion2_ddn.atf\", null,       \"thorn_ddn.atf\", \"vase_ddn.atf\",  null,               null,             \"vase_round_ddn.atf\"]);\r\n        //private const specularTextureStrings:Array<string> = Array<string>([\"arch_spec.atf\", null,            \"bricks_a_spec.atf\", \"ceiling_a_spec.atf\", null,                \"column_a_spec.atf\", \"column_b_spec.atf\", \"column_c_spec.atf\", \"curtain_spec.atf\",      \"curtain_spec.atf\", \"curtain_spec.atf\",       \"details_spec.atf\", \"fabric_spec.atf\",      \"fabric_spec.atf\", \"fabric_spec.atf\",       \"flagpole_spec.atf\", \"floor_a_spec.atf\", null,          null,       null,            \"thorn_spec.atf\", null,           null,               \"vase_plant_spec.atf\", \"vase_round_spec.atf\"]);\r\n        this._diffuseTextureStrings = Array(\"arch_diff.jpg\", \"background.jpg\", \"bricks_a_diff.jpg\", \"ceiling_a_diff.jpg\", \"chain_texture.png\", \"column_a_diff.jpg\", \"column_b_diff.jpg\", \"column_c_diff.jpg\", \"curtain_blue_diff.jpg\", \"curtain_diff.jpg\", \"curtain_green_diff.jpg\", \"details_diff.jpg\", \"fabric_blue_diff.jpg\", \"fabric_diff.jpg\", \"fabric_green_diff.jpg\", \"flagpole_diff.jpg\", \"floor_a_diff.jpg\", \"gi_flag.jpg\", \"lion.jpg\", \"roof_diff.jpg\", \"thorn_diff.png\", \"vase_dif.jpg\", \"vase_hanging.jpg\", \"vase_plant.png\", \"vase_round.jpg\");\r\n        this._normalTextureStrings = Array(\"arch_ddn.jpg\", \"background_ddn.jpg\", \"bricks_a_ddn.jpg\", null, \"chain_texture_ddn.jpg\", \"column_a_ddn.jpg\", \"column_b_ddn.jpg\", \"column_c_ddn.jpg\", null, null, null, null, null, null, null, null, null, null, \"lion2_ddn.jpg\", null, \"thorn_ddn.jpg\", \"vase_ddn.jpg\", null, null, \"vase_round_ddn.jpg\");\r\n        this._specularTextureStrings = Array(\"arch_spec.jpg\", null, \"bricks_a_spec.jpg\", \"ceiling_a_spec.jpg\", null, \"column_a_spec.jpg\", \"column_b_spec.jpg\", \"column_c_spec.jpg\", \"curtain_spec.jpg\", \"curtain_spec.jpg\", \"curtain_spec.jpg\", \"details_spec.jpg\", \"fabric_spec.jpg\", \"fabric_spec.jpg\", \"fabric_spec.jpg\", \"flagpole_spec.jpg\", \"floor_a_spec.jpg\", null, null, null, \"thorn_spec.jpg\", null, null, \"vase_plant_spec.jpg\", \"vase_round_spec.jpg\");\r\n        this._numTexStrings = Array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);\r\n        this._meshReference = new Array(25);\r\n        //flame data objects\r\n        this._flameData = Array(new FlameVO(new Vector3D(-625, 165, 219), 0xffaa44), new FlameVO(new Vector3D(485, 165, 219), 0xffaa44), new FlameVO(new Vector3D(-625, 165, -148), 0xffaa44), new FlameVO(new Vector3D(485, 165, -148), 0xffaa44));\r\n        //material dictionaries to hold instances\r\n        this._textureDictionary = new Object();\r\n        this._multiMaterialDictionary = new Object();\r\n        this._singleMaterialDictionary = new Object();\r\n        //private meshDictionary:Dictionary = new Dictionary();\r\n        this.vaseMeshes = new Array();\r\n        this.poleMeshes = new Array();\r\n        this.colMeshes = new Array();\r\n        //gui variables\r\n        this._singlePassMaterial = false;\r\n        this._multiPassMaterial = true;\r\n        this._cascadeLevels = 3;\r\n        this._shadowOptions = \"PCF\";\r\n        this._depthMapSize = 2048;\r\n        this._lightDirection = Math.PI / 2;\r\n        this._lightElevation = Math.PI / 18;\r\n        this._lights = new Array();\r\n        this._numTextures = 0;\r\n        this._currentTexture = 0;\r\n        this._n = 0;\r\n        //scene variables\r\n        this._meshes = new Array();\r\n        //rotation variables\r\n        this._move = false;\r\n        //movement variables\r\n        this._drag = 0.5;\r\n        this._walkIncrement = 10;\r\n        this._strafeIncrement = 10;\r\n        this._walkSpeed = 0;\r\n        this._strafeSpeed = 0;\r\n        this._walkAcceleration = 0;\r\n        this._strafeAcceleration = 0;\r\n        this._time = 0;\r\n        this.init();\r\n    }\r\n    /**\r\n     * Global initialise function\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.init = function () {\r\n        this.initEngine();\r\n        this.initLights();\r\n        this.initListeners();\r\n        //count textures\r\n        this._n = 0;\r\n        this._loadingTextureStrings = this._diffuseTextureStrings;\r\n        this.countNumTextures();\r\n        //kickoff asset loading\r\n        this._n = 0;\r\n        this._loadingTextureStrings = this._diffuseTextureStrings;\r\n        this.load(this._loadingTextureStrings[this._n]);\r\n    };\r\n    /**\r\n     * Initialise the engine\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.initEngine = function () {\r\n        //create the view\r\n        this._view = new View(new DefaultRenderer(MethodRendererPool));\r\n        this._view.camera.y = 150;\r\n        this._view.camera.z = 0;\r\n        //setup controller to be used on the camera\r\n        this._cameraController = new FirstPersonController(this._view.camera, 90, 0, -80, 80);\r\n    };\r\n    /**\r\n     * Initialise the lights\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.initLights = function () {\r\n        //create lights array\r\n        this._lights = new Array();\r\n        //create global directional light\r\n        //\t\t\tthis._cascadeShadowMapper = new CascadeShadowMapper(3);\r\n        //\t\t\tthis._cascadeShadowMapper.lightOffset = 20000;\r\n        this._directionalLight = new DirectionalLight(-1, -15, 1);\r\n        //\t\t\tthis._directionalLight.shadowMapper = this._cascadeShadowMapper;\r\n        this._directionalLight.color = 0xeedddd;\r\n        this._directionalLight.ambient = .35;\r\n        this._directionalLight.ambientColor = 0x808090;\r\n        this._view.scene.addChild(this._directionalLight);\r\n        this._lights.push(this._directionalLight);\r\n        this.updateDirection();\r\n        //create flame lights\r\n        var flameVO;\r\n        var len = this._flameData.length;\r\n        for (var i = 0; i < len; i++) {\r\n            flameVO = this._flameData[i];\r\n            var light = flameVO.light = new PointLight();\r\n            light.radius = 200;\r\n            light.fallOff = 600;\r\n            light.color = flameVO.color;\r\n            light.y = 10;\r\n            this._lights.push(light);\r\n        }\r\n        //create our global light picker\r\n        this._lightPicker = new StaticLightPicker(this._lights);\r\n        this._baseShadowMethod = new ShadowSoftMethod(this._directionalLight, 10, 5);\r\n        //\t\t\tthis._baseShadowMethod = new ShadowFilteredMethod(this._directionalLight);\r\n        //create our global fog method\r\n        this._fogMethod = new EffectFogMethod(0, 4000, 0x9090e7);\r\n        //\t\t\tthis._cascadeMethod = new ShadowCascadeMethod(this._baseShadowMethod);\r\n    };\r\n    /**\r\n     * Initialise the scene objects\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.initObjects = function () {\r\n        //create skybox\r\n        this._view.scene.addChild(new Skybox(this._skyMap));\r\n        //create flame meshes\r\n        this._flameGeometry = new PrimitivePlanePrefab(40, 80, 1, 1, false, true);\r\n        var flameVO;\r\n        var len = this._flameData.length;\r\n        for (var i = 0; i < len; i++) {\r\n            flameVO = this._flameData[i];\r\n            var mesh = flameVO.mesh = this._flameGeometry.getNewObject();\r\n            mesh.material = this._flameMaterial;\r\n            mesh.transform.position = flameVO.position;\r\n            mesh.subMeshes[0].uvTransform = new UVTransform();\r\n            mesh.subMeshes[0].uvTransform.scaleU = 1 / 16;\r\n            this._view.scene.addChild(mesh);\r\n            mesh.addChild(flameVO.light);\r\n        }\r\n    };\r\n    /**\r\n     * Initialise the listeners\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.initListeners = function () {\r\n        var _this = this;\r\n        //add listeners\r\n        window.onresize = function (event) { return _this.onResize(event); };\r\n        document.onmousedown = function (event) { return _this.onMouseDown(event); };\r\n        document.onmouseup = function (event) { return _this.onMouseUp(event); };\r\n        document.onmousemove = function (event) { return _this.onMouseMove(event); };\r\n        document.onkeydown = function (event) { return _this.onKeyDown(event); };\r\n        document.onkeyup = function (event) { return _this.onKeyUp(event); };\r\n        this.onResize();\r\n        this.parseAWDDelegate = function (event) { return _this.parseAWD(event); };\r\n        this.parseBitmapDelegate = function (event) { return _this.parseBitmap(event); };\r\n        this.loadProgressDelegate = function (event) { return _this.loadProgress(event); };\r\n        this.onBitmapCompleteDelegate = function (event) { return _this.onBitmapComplete(event); };\r\n        this.onAssetCompleteDelegate = function (event) { return _this.onAssetComplete(event); };\r\n        this.onResourceCompleteDelegate = function (event) { return _this.onResourceComplete(event); };\r\n        this._timer = new RequestAnimationFrame(this.onEnterFrame, this);\r\n        this._timer.start();\r\n    };\r\n    /**\r\n     * Updates the material mode between single pass and multi pass\r\n     */\r\n    //\t\tprivate updateMaterialPass(materialDictionary:Dictionary)\r\n    //\t\t{\r\n    //\t\t\tvar mesh:Mesh;\r\n    //\t\t\tvar name:string;\r\n    //\t\t\tvar len:number = this._meshes.length;\r\n    //\t\t\tfor (var i:number = 0; i < len; i++) {\r\n    //\t\t\t\tmesh = this._meshes[i];\r\n    //\t\t\t\tif (mesh.name == \"sponza_04\" || mesh.name == \"sponza_379\")\r\n    //\t\t\t\t\tcontinue;\r\n    //\t\t\t\tname = mesh.material.name;\r\n    //\t\t\t\tvar textureIndex:number = this._materialNameStrings.indexOf(name);\r\n    //\t\t\t\tif (textureIndex == -1 || textureIndex >= this._materialNameStrings.length)\r\n    //\t\t\t\t\tcontinue;\r\n    //\r\n    //\t\t\t\tmesh.material = materialDictionary[name];\r\n    //\t\t\t}\r\n    //\t\t}\r\n    /**\r\n     * Updates the direction of the directional lightsource\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.updateDirection = function () {\r\n        this._directionalLight.direction = new Vector3D(Math.sin(this._lightElevation) * Math.cos(this._lightDirection), -Math.cos(this._lightElevation), Math.sin(this._lightElevation) * Math.sin(this._lightDirection));\r\n    };\r\n    /**\r\n     * Count the total number of textures to be loaded\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.countNumTextures = function () {\r\n        this._numTextures++;\r\n        while (this._n++ < this._loadingTextureStrings.length - 1)\r\n            if (this._loadingTextureStrings[this._n])\r\n                break;\r\n        //switch to next teture set\r\n        if (this._n < this._loadingTextureStrings.length) {\r\n            this.countNumTextures();\r\n        }\r\n        else if (this._loadingTextureStrings == this._diffuseTextureStrings) {\r\n            this._n = 0;\r\n            this._loadingTextureStrings = this._normalTextureStrings;\r\n            this.countNumTextures();\r\n        }\r\n        else if (this._loadingTextureStrings == this._normalTextureStrings) {\r\n            this._n = 0;\r\n            this._loadingTextureStrings = this._specularTextureStrings;\r\n            this.countNumTextures();\r\n        }\r\n    };\r\n    /**\r\n     * Global binary file loader\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.load = function (url) {\r\n        var loader = new URLLoader();\r\n        switch (url.substring(url.length - 3)) {\r\n            case \"AWD\":\r\n            case \"awd\":\r\n                loader.dataFormat = URLLoaderDataFormat.ARRAY_BUFFER;\r\n                this._loadingText = \"Loading Model\";\r\n                loader.addEventListener(Event.COMPLETE, this.parseAWDDelegate);\r\n                break;\r\n            case \"png\":\r\n            case \"jpg\":\r\n                loader.dataFormat = URLLoaderDataFormat.BLOB;\r\n                this._currentTexture++;\r\n                this._loadingText = \"Loading Textures\";\r\n                loader.addEventListener(Event.COMPLETE, this.parseBitmapDelegate);\r\n                url = \"sponza/\" + url;\r\n                break;\r\n        }\r\n        loader.addEventListener(ProgressEvent.PROGRESS, this.loadProgressDelegate);\r\n        var urlReq = new URLRequest(this._assetsRoot + url);\r\n        loader.load(urlReq);\r\n    };\r\n    /**\r\n     * Display current load\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.loadProgress = function (e) {\r\n        //TODO work out why the casting on ProgressEvent fails for bytesLoaded and bytesTotal properties\r\n        var P = Math.floor(e[\"bytesLoaded\"] / e[\"bytesTotal\"] * 100);\r\n        if (P != 100) {\r\n            console.log(this._loadingText + '\\n' + ((this._loadingText == \"Loading Model\") ? Math.floor((e[\"bytesLoaded\"] / 1024) << 0) + 'kb | ' + Math.floor((e[\"bytesTotal\"] / 1024) << 0) + 'kb' : this._currentTexture + ' | ' + this._numTextures));\r\n        }\r\n    };\r\n    /**\r\n     * Parses the ATF file\r\n     */\r\n    //\t\tprivate onATFComplete(e:Event)\r\n    //\t\t{\r\n    //            var loader:URLLoader = URLLoader(e.target);\r\n    //            loader.removeEventListener(Event.COMPLETE, this.onATFComplete);\r\n    //\r\n    //\t\t\tif (!this._textureDictionary[this._loadingTextureStrings[this._n]])\r\n    //\t\t\t{\r\n    //\t\t\t\tthis._textureDictionary[this._loadingTextureStrings[this._n]] = new ATFTexture(loader.data);\r\n    //\t\t\t}\r\n    //\r\n    //            loader.data = null;\r\n    //            loader.close();\r\n    //\t\t\tloader = null;\r\n    //\r\n    //\r\n    //\t\t\t//skip null textures\r\n    //\t\t\twhile (this._n++ < this._loadingTextureStrings.length - 1)\r\n    //\t\t\t\tif (this._loadingTextureStrings[this._n])\r\n    //\t\t\t\t\tbreak;\r\n    //\r\n    //\t\t\t//switch to next teture set\r\n    //            if (this._n < this._loadingTextureStrings.length) {\r\n    //\t\t\t\tthis.load(this._loadingTextureStrings[this._n]);\r\n    //\t\t\t} else if (this._loadingTextureStrings == this._diffuseTextureStrings) {\r\n    //\t\t\t\tthis._n = 0;\r\n    //\t\t\t\tthis._loadingTextureStrings = this._normalTextureStrings;\r\n    //\t\t\t\tthis.load(this._loadingTextureStrings[this._n]);\r\n    //\t\t\t} else if (this._loadingTextureStrings == this._normalTextureStrings) {\r\n    //\t\t\t\tthis._n = 0;\r\n    //\t\t\t\tthis._loadingTextureStrings = this._specularTextureStrings;\r\n    //\t\t\t\tthis.load(this._loadingTextureStrings[this._n]);\r\n    //\t\t\t} else {\r\n    //\t\t\t\tthis.load(\"sponza/sponza.awd\");\r\n    //            }\r\n    //        }\r\n    /**\r\n     * Parses the Bitmap file\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.parseBitmap = function (e) {\r\n        var urlLoader = e.target;\r\n        var image = ParserUtils.blobToImage(urlLoader.data);\r\n        image.onload = this.onBitmapCompleteDelegate;\r\n        urlLoader.removeEventListener(Event.COMPLETE, this.parseBitmapDelegate);\r\n        urlLoader.removeEventListener(ProgressEvent.PROGRESS, this.loadProgressDelegate);\r\n        urlLoader = null;\r\n    };\r\n    /**\r\n     * Listener for bitmap complete event on loader\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.onBitmapComplete = function (e) {\r\n        var image = e.target;\r\n        image.onload = null;\r\n        //create bitmap texture in dictionary\r\n        if (!this._textureDictionary[this._loadingTextureStrings[this._n]])\r\n            this._textureDictionary[this._loadingTextureStrings[this._n]] = (this._loadingTextureStrings == this._specularTextureStrings) ? new SpecularBitmapTexture(Cast.bitmapData(image)) : new ImageTexture(image);\r\n        while (this._n++ < this._loadingTextureStrings.length - 1)\r\n            if (this._loadingTextureStrings[this._n])\r\n                break;\r\n        //switch to next teture set\r\n        if (this._n < this._loadingTextureStrings.length) {\r\n            this.load(this._loadingTextureStrings[this._n]);\r\n        }\r\n        else if (this._loadingTextureStrings == this._diffuseTextureStrings) {\r\n            this._n = 0;\r\n            this._loadingTextureStrings = this._normalTextureStrings;\r\n            this.load(this._loadingTextureStrings[this._n]);\r\n        }\r\n        else if (this._loadingTextureStrings == this._normalTextureStrings) {\r\n            this._n = 0;\r\n            this._loadingTextureStrings = this._specularTextureStrings;\r\n            this.load(this._loadingTextureStrings[this._n]);\r\n        }\r\n        else {\r\n            this.load(\"sponza/sponza.awd\");\r\n        }\r\n    };\r\n    /**\r\n     * Parses the AWD file\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.parseAWD = function (e) {\r\n        console.log(\"Parsing Data\");\r\n        var urlLoader = e.target;\r\n        var loader = new Loader(false);\r\n        loader.addEventListener(AssetEvent.ASSET_COMPLETE, this.onAssetCompleteDelegate);\r\n        loader.addEventListener(LoaderEvent.RESOURCE_COMPLETE, this.onResourceCompleteDelegate);\r\n        loader.loadData(urlLoader.data, new AssetLoaderContext(false), null, new AWDParser());\r\n        urlLoader.removeEventListener(ProgressEvent.PROGRESS, this.loadProgressDelegate);\r\n        urlLoader.removeEventListener(Event.COMPLETE, this.parseAWDDelegate);\r\n        urlLoader = null;\r\n    };\r\n    /**\r\n     * Listener for asset complete event on loader\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.onAssetComplete = function (event) {\r\n        if (event.asset.assetType == AssetType.MESH) {\r\n            //store meshes\r\n            this._meshes.push(event.asset);\r\n        }\r\n    };\r\n    /**\r\n     * Triggered once all resources are loaded\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.onResourceComplete = function (e) {\r\n        var _this = this;\r\n        var merge = new Merge(false, false, true);\r\n        var loader = e.target;\r\n        loader.removeEventListener(AssetEvent.ASSET_COMPLETE, this.onAssetCompleteDelegate);\r\n        loader.removeEventListener(LoaderEvent.RESOURCE_COMPLETE, this.onResourceCompleteDelegate);\r\n        //reassign materials\r\n        var mesh;\r\n        var name;\r\n        var len = this._meshes.length;\r\n        for (var i = 0; i < len; i++) {\r\n            mesh = this._meshes[i];\r\n            if (mesh.name == \"sponza_04\" || mesh.name == \"sponza_379\")\r\n                continue;\r\n            var num = Number(mesh.name.substring(7));\r\n            name = mesh.material.name;\r\n            if (name == \"column_c\" && (num < 22 || num > 33))\r\n                continue;\r\n            var colNum = (num - 125);\r\n            if (name == \"column_b\") {\r\n                if (colNum >= 0 && colNum < 132 && (colNum % 11) < 10) {\r\n                    this.colMeshes.push(mesh);\r\n                    continue;\r\n                }\r\n                else {\r\n                    this.colMeshes.push(mesh);\r\n                    var colMerge = new Merge();\r\n                    var colMesh = new Mesh(new Geometry());\r\n                    colMerge.applyToMeshes(colMesh, this.colMeshes);\r\n                    mesh = colMesh;\r\n                    this.colMeshes = new Array();\r\n                }\r\n            }\r\n            var vaseNum = (num - 334);\r\n            if (name == \"vase_hanging\" && (vaseNum % 9) < 5) {\r\n                if (vaseNum >= 0 && vaseNum < 370 && (vaseNum % 9) < 4) {\r\n                    this.vaseMeshes.push(mesh);\r\n                    continue;\r\n                }\r\n                else {\r\n                    this.vaseMeshes.push(mesh);\r\n                    var vaseMerge = new Merge();\r\n                    var vaseMesh = new Mesh(new Geometry());\r\n                    vaseMerge.applyToMeshes(vaseMesh, this.vaseMeshes);\r\n                    mesh = vaseMesh;\r\n                    this.vaseMeshes = new Array();\r\n                }\r\n            }\r\n            var poleNum = num - 290;\r\n            if (name == \"flagpole\") {\r\n                if (poleNum >= 0 && poleNum < 320 && (poleNum % 3) < 2) {\r\n                    this.poleMeshes.push(mesh);\r\n                    continue;\r\n                }\r\n                else if (poleNum >= 0) {\r\n                    this.poleMeshes.push(mesh);\r\n                    var poleMerge = new Merge();\r\n                    var poleMesh = new Mesh(new Geometry());\r\n                    poleMerge.applyToMeshes(poleMesh, this.poleMeshes);\r\n                    mesh = poleMesh;\r\n                    this.poleMeshes = new Array();\r\n                }\r\n            }\r\n            if (name == \"flagpole\" && (num == 260 || num == 261 || num == 263 || num == 265 || num == 268 || num == 269 || num == 271 || num == 273))\r\n                continue;\r\n            var textureIndex = this._materialNameStrings.indexOf(name);\r\n            if (textureIndex == -1 || textureIndex >= this._materialNameStrings.length)\r\n                continue;\r\n            this._numTexStrings[textureIndex]++;\r\n            var textureName = this._diffuseTextureStrings[textureIndex];\r\n            var normalTextureName;\r\n            var specularTextureName;\r\n            //\t\t\t\t//store single pass materials for use later\r\n            //\t\t\t\tvar singleMaterial:MethodMaterial = this._singleMaterialDictionary[name];\r\n            //\r\n            //\t\t\t\tif (!singleMaterial) {\r\n            //\r\n            //\t\t\t\t\t//create singlepass material\r\n            //\t\t\t\t\tsingleMaterial = new MethodMaterial(this._textureDictionary[textureName]);\r\n            //\r\n            //\t\t\t\t\tsingleMaterial.name = name;\r\n            //\t\t\t\t\tsingleMaterial.lightPicker = this._lightPicker;\r\n            //\t\t\t\t\tsingleMaterial.addMethod(this._fogMethod);\r\n            //\t\t\t\t\tsingleMaterial.mipmap = true;\r\n            //\t\t\t\t\tsingleMaterial.repeat = true;\r\n            //\t\t\t\t\tsingleMaterial.specular = 2;\r\n            //\r\n            //\t\t\t\t\t//use alpha transparancy if texture is png\r\n            //\t\t\t\t\tif (textureName.substring(textureName.length - 3) == \"png\")\r\n            //\t\t\t\t\t\tsingleMaterial.alphaThreshold = 0.5;\r\n            //\r\n            //\t\t\t\t\t//add normal map if it exists\r\n            //\t\t\t\t\tnormalTextureName = this._normalTextureStrings[textureIndex];\r\n            //\t\t\t\t\tif (normalTextureName)\r\n            //\t\t\t\t\t\tsingleMaterial.normalMap = this._textureDictionary[normalTextureName];\r\n            //\r\n            //\t\t\t\t\t//add specular map if it exists\r\n            //\t\t\t\t\tspecularTextureName = this._specularTextureStrings[textureIndex];\r\n            //\t\t\t\t\tif (specularTextureName)\r\n            //\t\t\t\t\t\tsingleMaterial.specularMap = this._textureDictionary[specularTextureName];\r\n            //\r\n            //\t\t\t\t\tthis._singleMaterialDictionary[name] = singleMaterial;\r\n            //\r\n            //\t\t\t\t}\r\n            //store multi pass materials for use later\r\n            var multiMaterial = this._multiMaterialDictionary[name];\r\n            if (!multiMaterial) {\r\n                //create multipass material\r\n                multiMaterial = new MethodMaterial(this._textureDictionary[textureName]);\r\n                multiMaterial.mode = MethodMaterialMode.MULTI_PASS;\r\n                multiMaterial.name = name;\r\n                multiMaterial.lightPicker = this._lightPicker;\r\n                //\t\t\t\t\tmultiMaterial.shadowMethod = this._cascadeMethod;\r\n                multiMaterial.shadowMethod = this._baseShadowMethod;\r\n                multiMaterial.addEffectMethod(this._fogMethod);\r\n                multiMaterial.repeat = true;\r\n                multiMaterial.mipmap = true;\r\n                multiMaterial.specular = 2;\r\n                //use alpha transparancy if texture is png\r\n                if (textureName.substring(textureName.length - 3) == \"png\")\r\n                    multiMaterial.alphaThreshold = 0.5;\r\n                //add normal map if it exists\r\n                normalTextureName = this._normalTextureStrings[textureIndex];\r\n                if (normalTextureName)\r\n                    multiMaterial.normalMap = this._textureDictionary[normalTextureName];\r\n                //add specular map if it exists\r\n                specularTextureName = this._specularTextureStrings[textureIndex];\r\n                if (specularTextureName)\r\n                    multiMaterial.specularMap = this._textureDictionary[specularTextureName];\r\n                //add to material dictionary\r\n                this._multiMaterialDictionary[name] = multiMaterial;\r\n            }\r\n            /*\r\n            if (_meshReference[textureIndex]) {\r\n                var m:Mesh = mesh.clone() as Mesh;\r\n                m.material = multiMaterial;\r\n                _view.scene.addChild(m);\r\n                continue;\r\n            }\r\n            */\r\n            //default to multipass material\r\n            mesh.material = multiMaterial;\r\n            this._view.scene.addChild(mesh);\r\n            this._meshReference[textureIndex] = mesh;\r\n        }\r\n        var z = 0;\r\n        while (z < this._numTexStrings.length) {\r\n            console.log(this._diffuseTextureStrings[z], this._numTexStrings[z]);\r\n            z++;\r\n        }\r\n        //load skybox and flame texture\r\n        AssetLibrary.addEventListener(LoaderEvent.RESOURCE_COMPLETE, function (event) { return _this.onExtraResourceComplete(event); });\r\n        //setup the url map for textures in the cubemap file\r\n        var assetLoaderContext = new AssetLoaderContext();\r\n        assetLoaderContext.dependencyBaseUrl = \"assets/skybox/\";\r\n        //environment texture\r\n        AssetLibrary.load(new URLRequest(\"assets/skybox/hourglass_texture.cube\"), assetLoaderContext);\r\n        //globe textures\r\n        AssetLibrary.load(new URLRequest(\"assets/fire.png\"));\r\n    };\r\n    /**\r\n     * Triggered once extra resources are loaded\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.onExtraResourceComplete = function (event) {\r\n        switch (event.url) {\r\n            case 'assets/skybox/hourglass_texture.cube':\r\n                //create skybox texture map\r\n                this._skyMap = event.assets[0];\r\n                break;\r\n            case \"assets/fire.png\":\r\n                this._flameMaterial = new MethodMaterial(event.assets[0]);\r\n                this._flameMaterial.blendMode = BlendMode.ADD;\r\n                this._flameMaterial.animateUVs = true;\r\n                break;\r\n        }\r\n        if (this._skyMap && this._flameMaterial)\r\n            this.initObjects();\r\n    };\r\n    /**\r\n     * Navigation and render loop\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.onEnterFrame = function (dt) {\r\n        if (this._walkSpeed || this._walkAcceleration) {\r\n            this._walkSpeed = (this._walkSpeed + this._walkAcceleration) * this._drag;\r\n            if (Math.abs(this._walkSpeed) < 0.01)\r\n                this._walkSpeed = 0;\r\n            this._cameraController.incrementWalk(this._walkSpeed);\r\n        }\r\n        if (this._strafeSpeed || this._strafeAcceleration) {\r\n            this._strafeSpeed = (this._strafeSpeed + this._strafeAcceleration) * this._drag;\r\n            if (Math.abs(this._strafeSpeed) < 0.01)\r\n                this._strafeSpeed = 0;\r\n            this._cameraController.incrementStrafe(this._strafeSpeed);\r\n        }\r\n        //animate flames\r\n        var flameVO;\r\n        var len = this._flameData.length;\r\n        for (var i = 0; i < len; i++) {\r\n            flameVO = this._flameData[i];\r\n            //update flame light\r\n            var light = flameVO.light;\r\n            if (!light)\r\n                continue;\r\n            light.fallOff = 380 + Math.random() * 20;\r\n            light.radius = 200 + Math.random() * 30;\r\n            light.diffuse = .9 + Math.random() * .1;\r\n            //update flame mesh\r\n            var mesh = flameVO.mesh;\r\n            if (!mesh)\r\n                continue;\r\n            var subMesh = mesh.subMeshes[0];\r\n            subMesh.uvTransform.offsetU += 1 / 16;\r\n            subMesh.uvTransform.offsetU %= 1;\r\n            mesh.rotationY = Math.atan2(mesh.x - this._view.camera.x, mesh.z - this._view.camera.z) * 180 / Math.PI;\r\n        }\r\n        this._view.render();\r\n    };\r\n    /**\r\n     * Key down listener for camera control\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.onKeyDown = function (event) {\r\n        switch (event.keyCode) {\r\n            case Keyboard.UP:\r\n            case Keyboard.W:\r\n                this._walkAcceleration = this._walkIncrement;\r\n                break;\r\n            case Keyboard.DOWN:\r\n            case Keyboard.S:\r\n                this._walkAcceleration = -this._walkIncrement;\r\n                break;\r\n            case Keyboard.LEFT:\r\n            case Keyboard.A:\r\n                this._strafeAcceleration = -this._strafeIncrement;\r\n                break;\r\n            case Keyboard.RIGHT:\r\n            case Keyboard.D:\r\n                this._strafeAcceleration = this._strafeIncrement;\r\n                break;\r\n            case Keyboard.F:\r\n                break;\r\n            case Keyboard.C:\r\n                this._cameraController.fly = !this._cameraController.fly;\r\n        }\r\n    };\r\n    /**\r\n     * Key up listener for camera control\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.onKeyUp = function (event) {\r\n        switch (event.keyCode) {\r\n            case Keyboard.UP:\r\n            case Keyboard.W:\r\n            case Keyboard.DOWN:\r\n            case Keyboard.S:\r\n                this._walkAcceleration = 0;\r\n                break;\r\n            case Keyboard.LEFT:\r\n            case Keyboard.A:\r\n            case Keyboard.RIGHT:\r\n            case Keyboard.D:\r\n                this._strafeAcceleration = 0;\r\n                break;\r\n        }\r\n    };\r\n    /**\r\n     * Mouse down listener for navigation\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.onMouseDown = function (event) {\r\n        this._lastPanAngle = this._cameraController.panAngle;\r\n        this._lastTiltAngle = this._cameraController.tiltAngle;\r\n        this._lastMouseX = event.clientX;\r\n        this._lastMouseY = event.clientY;\r\n        this._move = true;\r\n    };\r\n    /**\r\n     * Mouse up listener for navigation\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.onMouseUp = function (event) {\r\n        this._move = false;\r\n    };\r\n    Advanced_MultiPassSponzaDemo.prototype.onMouseMove = function (event) {\r\n        if (this._move) {\r\n            this._cameraController.panAngle = 0.3 * (event.clientX - this._lastMouseX) + this._lastPanAngle;\r\n            this._cameraController.tiltAngle = 0.3 * (event.clientY - this._lastMouseY) + this._lastTiltAngle;\r\n        }\r\n    };\r\n    /**\r\n     * stage listener for resize events\r\n     */\r\n    Advanced_MultiPassSponzaDemo.prototype.onResize = function (event) {\r\n        if (event === void 0) { event = null; }\r\n        this._view.y = 0;\r\n        this._view.x = 0;\r\n        this._view.width = window.innerWidth;\r\n        this._view.height = window.innerHeight;\r\n    };\r\n    return Advanced_MultiPassSponzaDemo;\r\n})();\r\n/**\r\n* Data class for the Flame objects\r\n*/\r\nvar FlameVO = (function () {\r\n    function FlameVO(position, color /*uint*/) {\r\n        this.position = position;\r\n        this.color = color;\r\n    }\r\n    return FlameVO;\r\n})();\r\nwindow.onload = function () {\r\n    new Advanced_MultiPassSponzaDemo();\r\n};\r\n\r\n\n},{\"awayjs-core/lib/base/BlendMode\":undefined,\"awayjs-core/lib/events/AssetEvent\":undefined,\"awayjs-core/lib/events/Event\":undefined,\"awayjs-core/lib/events/LoaderEvent\":undefined,\"awayjs-core/lib/events/ProgressEvent\":undefined,\"awayjs-core/lib/geom/UVTransform\":undefined,\"awayjs-core/lib/geom/Vector3D\":undefined,\"awayjs-core/lib/library/AssetLibrary\":undefined,\"awayjs-core/lib/library/AssetLoaderContext\":undefined,\"awayjs-core/lib/library/AssetType\":undefined,\"awayjs-core/lib/net/URLLoader\":undefined,\"awayjs-core/lib/net/URLLoaderDataFormat\":undefined,\"awayjs-core/lib/net/URLRequest\":undefined,\"awayjs-core/lib/parsers/ParserUtils\":undefined,\"awayjs-core/lib/textures/ImageTexture\":undefined,\"awayjs-core/lib/textures/SpecularBitmapTexture\":undefined,\"awayjs-core/lib/ui/Keyboard\":undefined,\"awayjs-core/lib/utils/RequestAnimationFrame\":undefined,\"awayjs-display/lib/base/Geometry\":undefined,\"awayjs-display/lib/containers/Loader\":undefined,\"awayjs-display/lib/containers/View\":undefined,\"awayjs-display/lib/controllers/FirstPersonController\":undefined,\"awayjs-display/lib/entities/DirectionalLight\":undefined,\"awayjs-display/lib/entities/Mesh\":undefined,\"awayjs-display/lib/entities/PointLight\":undefined,\"awayjs-display/lib/entities/Skybox\":undefined,\"awayjs-display/lib/materials/lightpickers/StaticLightPicker\":undefined,\"awayjs-display/lib/prefabs/PrimitivePlanePrefab\":undefined,\"awayjs-display/lib/utils/Cast\":undefined,\"awayjs-methodmaterials/lib/MethodMaterial\":undefined,\"awayjs-methodmaterials/lib/MethodMaterialMode\":undefined,\"awayjs-methodmaterials/lib/methods/EffectFogMethod\":undefined,\"awayjs-methodmaterials/lib/methods/ShadowSoftMethod\":undefined,\"awayjs-methodmaterials/lib/pool/MethodRendererPool\":undefined,\"awayjs-parsers/lib/AWDParser\":undefined,\"awayjs-renderergl/lib/DefaultRenderer\":undefined,\"awayjs-renderergl/lib/tools/commands/Merge\":undefined}]},{},[1])\n\n\n//# sourceMappingURL=Advanced_MultiPassSponzaDemo.js.map"
  ],
  "sourceRoot": ""
}